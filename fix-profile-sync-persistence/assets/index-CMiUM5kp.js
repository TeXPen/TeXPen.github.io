const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./ModelLoader-jS5SprEl.js","./index-CBPy_vyv.js"])))=>i.map(i=>d[i]);
var IC=Object.defineProperty;var PC=(e,t,n)=>t in e?IC(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n;var ge=(e,t,n)=>PC(e,typeof t!="symbol"?t+"":t,n);function kC(e,t){for(var n=0;n<t.length;n++){const s=t[n];if(typeof s!="string"&&!Array.isArray(s)){for(const i in s)if(i!=="default"&&!(i in e)){const o=Object.getOwnPropertyDescriptor(s,i);o&&Object.defineProperty(e,i,o.get?o:{enumerable:!0,get:()=>s[i]})}}}return Object.freeze(Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}))}(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const o of i)if(o.type==="childList")for(const c of o.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&s(c)}).observe(document,{childList:!0,subtree:!0});function n(i){const o={};return i.integrity&&(o.integrity=i.integrity),i.referrerPolicy&&(o.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?o.credentials="include":i.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function s(i){if(i.ep)return;i.ep=!0;const o=n(i);fetch(i.href,o)}})();function kv(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var C_={exports:{}},Up={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var jy;function DC(){if(jy)return Up;jy=1;var e=Symbol.for("react.transitional.element"),t=Symbol.for("react.fragment");function n(s,i,o){var c=null;if(o!==void 0&&(c=""+o),i.key!==void 0&&(c=""+i.key),"key"in i){o={};for(var d in i)d!=="key"&&(o[d]=i[d])}else o=i;return i=o.ref,{$$typeof:e,type:s,key:c,ref:i!==void 0?i:null,props:o}}return Up.Fragment=t,Up.jsx=n,Up.jsxs=n,Up}var Uy;function OC(){return Uy||(Uy=1,C_.exports=DC()),C_.exports}var z=OC(),S_={exports:{}},mn={};/**
 * @license React
 * react.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Vy;function $C(){if(Vy)return mn;Vy=1;var e=Symbol.for("react.transitional.element"),t=Symbol.for("react.portal"),n=Symbol.for("react.fragment"),s=Symbol.for("react.strict_mode"),i=Symbol.for("react.profiler"),o=Symbol.for("react.consumer"),c=Symbol.for("react.context"),d=Symbol.for("react.forward_ref"),u=Symbol.for("react.suspense"),h=Symbol.for("react.memo"),g=Symbol.for("react.lazy"),p=Symbol.for("react.activity"),m=Symbol.iterator;function y(j){return j===null||typeof j!="object"?null:(j=m&&j[m]||j["@@iterator"],typeof j=="function"?j:null)}var v={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},T=Object.assign,O={};function E(j,U,N){this.props=j,this.context=U,this.refs=O,this.updater=N||v}E.prototype.isReactComponent={},E.prototype.setState=function(j,U){if(typeof j!="object"&&typeof j!="function"&&j!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,j,U,"setState")},E.prototype.forceUpdate=function(j){this.updater.enqueueForceUpdate(this,j,"forceUpdate")};function S(){}S.prototype=E.prototype;function D(j,U,N){this.props=j,this.context=U,this.refs=O,this.updater=N||v}var I=D.prototype=new S;I.constructor=D,T(I,E.prototype),I.isPureReactComponent=!0;var M=Array.isArray;function C(){}var A={H:null,A:null,T:null,S:null},k=Object.prototype.hasOwnProperty;function R(j,U,N){var q=N.ref;return{$$typeof:e,type:j,key:U,ref:q!==void 0?q:null,props:N}}function G(j,U){return R(j.type,U,j.props)}function te(j){return typeof j=="object"&&j!==null&&j.$$typeof===e}function ee(j){var U={"=":"=0",":":"=2"};return"$"+j.replace(/[=:]/g,function(N){return U[N]})}var X=/\/+/g;function le(j,U){return typeof j=="object"&&j!==null&&j.key!=null?ee(""+j.key):U.toString(36)}function ae(j){switch(j.status){case"fulfilled":return j.value;case"rejected":throw j.reason;default:switch(typeof j.status=="string"?j.then(C,C):(j.status="pending",j.then(function(U){j.status==="pending"&&(j.status="fulfilled",j.value=U)},function(U){j.status==="pending"&&(j.status="rejected",j.reason=U)})),j.status){case"fulfilled":return j.value;case"rejected":throw j.reason}}throw j}function Q(j,U,N,q,ce){var Z=typeof j;(Z==="undefined"||Z==="boolean")&&(j=null);var Me=!1;if(j===null)Me=!0;else switch(Z){case"bigint":case"string":case"number":Me=!0;break;case"object":switch(j.$$typeof){case e:case t:Me=!0;break;case g:return Me=j._init,Q(Me(j._payload),U,N,q,ce)}}if(Me)return ce=ce(j),Me=q===""?"."+le(j,0):q,M(ce)?(N="",Me!=null&&(N=Me.replace(X,"$&/")+"/"),Q(ce,U,N,"",function(Oe){return Oe})):ce!=null&&(te(ce)&&(ce=G(ce,N+(ce.key==null||j&&j.key===ce.key?"":(""+ce.key).replace(X,"$&/")+"/")+Me)),U.push(ce)),1;Me=0;var Pe=q===""?".":q+":";if(M(j))for(var Ne=0;Ne<j.length;Ne++)q=j[Ne],Z=Pe+le(q,Ne),Me+=Q(q,U,N,Z,ce);else if(Ne=y(j),typeof Ne=="function")for(j=Ne.call(j),Ne=0;!(q=j.next()).done;)q=q.value,Z=Pe+le(q,Ne++),Me+=Q(q,U,N,Z,ce);else if(Z==="object"){if(typeof j.then=="function")return Q(ae(j),U,N,q,ce);throw U=String(j),Error("Objects are not valid as a React child (found: "+(U==="[object Object]"?"object with keys {"+Object.keys(j).join(", ")+"}":U)+"). If you meant to render a collection of children, use an array instead.")}return Me}function ne(j,U,N){if(j==null)return j;var q=[],ce=0;return Q(j,q,"","",function(Z){return U.call(N,Z,ce++)}),q}function de(j){if(j._status===-1){var U=j._result;U=U(),U.then(function(N){(j._status===0||j._status===-1)&&(j._status=1,j._result=N)},function(N){(j._status===0||j._status===-1)&&(j._status=2,j._result=N)}),j._status===-1&&(j._status=0,j._result=U)}if(j._status===1)return j._result.default;throw j._result}var ve=typeof reportError=="function"?reportError:function(j){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var U=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof j=="object"&&j!==null&&typeof j.message=="string"?String(j.message):String(j),error:j});if(!window.dispatchEvent(U))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",j);return}console.error(j)},fe={map:ne,forEach:function(j,U,N){ne(j,function(){U.apply(this,arguments)},N)},count:function(j){var U=0;return ne(j,function(){U++}),U},toArray:function(j){return ne(j,function(U){return U})||[]},only:function(j){if(!te(j))throw Error("React.Children.only expected to receive a single React element child.");return j}};return mn.Activity=p,mn.Children=fe,mn.Component=E,mn.Fragment=n,mn.Profiler=i,mn.PureComponent=D,mn.StrictMode=s,mn.Suspense=u,mn.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=A,mn.__COMPILER_RUNTIME={__proto__:null,c:function(j){return A.H.useMemoCache(j)}},mn.cache=function(j){return function(){return j.apply(null,arguments)}},mn.cacheSignal=function(){return null},mn.cloneElement=function(j,U,N){if(j==null)throw Error("The argument must be a React element, but you passed "+j+".");var q=T({},j.props),ce=j.key;if(U!=null)for(Z in U.key!==void 0&&(ce=""+U.key),U)!k.call(U,Z)||Z==="key"||Z==="__self"||Z==="__source"||Z==="ref"&&U.ref===void 0||(q[Z]=U[Z]);var Z=arguments.length-2;if(Z===1)q.children=N;else if(1<Z){for(var Me=Array(Z),Pe=0;Pe<Z;Pe++)Me[Pe]=arguments[Pe+2];q.children=Me}return R(j.type,ce,q)},mn.createContext=function(j){return j={$$typeof:c,_currentValue:j,_currentValue2:j,_threadCount:0,Provider:null,Consumer:null},j.Provider=j,j.Consumer={$$typeof:o,_context:j},j},mn.createElement=function(j,U,N){var q,ce={},Z=null;if(U!=null)for(q in U.key!==void 0&&(Z=""+U.key),U)k.call(U,q)&&q!=="key"&&q!=="__self"&&q!=="__source"&&(ce[q]=U[q]);var Me=arguments.length-2;if(Me===1)ce.children=N;else if(1<Me){for(var Pe=Array(Me),Ne=0;Ne<Me;Ne++)Pe[Ne]=arguments[Ne+2];ce.children=Pe}if(j&&j.defaultProps)for(q in Me=j.defaultProps,Me)ce[q]===void 0&&(ce[q]=Me[q]);return R(j,Z,ce)},mn.createRef=function(){return{current:null}},mn.forwardRef=function(j){return{$$typeof:d,render:j}},mn.isValidElement=te,mn.lazy=function(j){return{$$typeof:g,_payload:{_status:-1,_result:j},_init:de}},mn.memo=function(j,U){return{$$typeof:h,type:j,compare:U===void 0?null:U}},mn.startTransition=function(j){var U=A.T,N={};A.T=N;try{var q=j(),ce=A.S;ce!==null&&ce(N,q),typeof q=="object"&&q!==null&&typeof q.then=="function"&&q.then(C,ve)}catch(Z){ve(Z)}finally{U!==null&&N.types!==null&&(U.types=N.types),A.T=U}},mn.unstable_useCacheRefresh=function(){return A.H.useCacheRefresh()},mn.use=function(j){return A.H.use(j)},mn.useActionState=function(j,U,N){return A.H.useActionState(j,U,N)},mn.useCallback=function(j,U){return A.H.useCallback(j,U)},mn.useContext=function(j){return A.H.useContext(j)},mn.useDebugValue=function(){},mn.useDeferredValue=function(j,U){return A.H.useDeferredValue(j,U)},mn.useEffect=function(j,U){return A.H.useEffect(j,U)},mn.useEffectEvent=function(j){return A.H.useEffectEvent(j)},mn.useId=function(){return A.H.useId()},mn.useImperativeHandle=function(j,U,N){return A.H.useImperativeHandle(j,U,N)},mn.useInsertionEffect=function(j,U){return A.H.useInsertionEffect(j,U)},mn.useLayoutEffect=function(j,U){return A.H.useLayoutEffect(j,U)},mn.useMemo=function(j,U){return A.H.useMemo(j,U)},mn.useOptimistic=function(j,U){return A.H.useOptimistic(j,U)},mn.useReducer=function(j,U,N){return A.H.useReducer(j,U,N)},mn.useRef=function(j){return A.H.useRef(j)},mn.useState=function(j){return A.H.useState(j)},mn.useSyncExternalStore=function(j,U,N){return A.H.useSyncExternalStore(j,U,N)},mn.useTransition=function(){return A.H.useTransition()},mn.version="19.2.2",mn}var Gy;function Dv(){return Gy||(Gy=1,S_.exports=$C()),S_.exports}var we=Dv();const ma=kv(we),Wy=kC({__proto__:null,default:ma},[we]);var I_={exports:{}},Vp={},P_={exports:{}},k_={};/**
 * @license React
 * scheduler.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Hy;function BC(){return Hy||(Hy=1,(function(e){function t(Q,ne){var de=Q.length;Q.push(ne);e:for(;0<de;){var ve=de-1>>>1,fe=Q[ve];if(0<i(fe,ne))Q[ve]=ne,Q[de]=fe,de=ve;else break e}}function n(Q){return Q.length===0?null:Q[0]}function s(Q){if(Q.length===0)return null;var ne=Q[0],de=Q.pop();if(de!==ne){Q[0]=de;e:for(var ve=0,fe=Q.length,j=fe>>>1;ve<j;){var U=2*(ve+1)-1,N=Q[U],q=U+1,ce=Q[q];if(0>i(N,de))q<fe&&0>i(ce,N)?(Q[ve]=ce,Q[q]=de,ve=q):(Q[ve]=N,Q[U]=de,ve=U);else if(q<fe&&0>i(ce,de))Q[ve]=ce,Q[q]=de,ve=q;else break e}}return ne}function i(Q,ne){var de=Q.sortIndex-ne.sortIndex;return de!==0?de:Q.id-ne.id}if(e.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var o=performance;e.unstable_now=function(){return o.now()}}else{var c=Date,d=c.now();e.unstable_now=function(){return c.now()-d}}var u=[],h=[],g=1,p=null,m=3,y=!1,v=!1,T=!1,O=!1,E=typeof setTimeout=="function"?setTimeout:null,S=typeof clearTimeout=="function"?clearTimeout:null,D=typeof setImmediate<"u"?setImmediate:null;function I(Q){for(var ne=n(h);ne!==null;){if(ne.callback===null)s(h);else if(ne.startTime<=Q)s(h),ne.sortIndex=ne.expirationTime,t(u,ne);else break;ne=n(h)}}function M(Q){if(T=!1,I(Q),!v)if(n(u)!==null)v=!0,C||(C=!0,ee());else{var ne=n(h);ne!==null&&ae(M,ne.startTime-Q)}}var C=!1,A=-1,k=5,R=-1;function G(){return O?!0:!(e.unstable_now()-R<k)}function te(){if(O=!1,C){var Q=e.unstable_now();R=Q;var ne=!0;try{e:{v=!1,T&&(T=!1,S(A),A=-1),y=!0;var de=m;try{t:{for(I(Q),p=n(u);p!==null&&!(p.expirationTime>Q&&G());){var ve=p.callback;if(typeof ve=="function"){p.callback=null,m=p.priorityLevel;var fe=ve(p.expirationTime<=Q);if(Q=e.unstable_now(),typeof fe=="function"){p.callback=fe,I(Q),ne=!0;break t}p===n(u)&&s(u),I(Q)}else s(u);p=n(u)}if(p!==null)ne=!0;else{var j=n(h);j!==null&&ae(M,j.startTime-Q),ne=!1}}break e}finally{p=null,m=de,y=!1}ne=void 0}}finally{ne?ee():C=!1}}}var ee;if(typeof D=="function")ee=function(){D(te)};else if(typeof MessageChannel<"u"){var X=new MessageChannel,le=X.port2;X.port1.onmessage=te,ee=function(){le.postMessage(null)}}else ee=function(){E(te,0)};function ae(Q,ne){A=E(function(){Q(e.unstable_now())},ne)}e.unstable_IdlePriority=5,e.unstable_ImmediatePriority=1,e.unstable_LowPriority=4,e.unstable_NormalPriority=3,e.unstable_Profiling=null,e.unstable_UserBlockingPriority=2,e.unstable_cancelCallback=function(Q){Q.callback=null},e.unstable_forceFrameRate=function(Q){0>Q||125<Q?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):k=0<Q?Math.floor(1e3/Q):5},e.unstable_getCurrentPriorityLevel=function(){return m},e.unstable_next=function(Q){switch(m){case 1:case 2:case 3:var ne=3;break;default:ne=m}var de=m;m=ne;try{return Q()}finally{m=de}},e.unstable_requestPaint=function(){O=!0},e.unstable_runWithPriority=function(Q,ne){switch(Q){case 1:case 2:case 3:case 4:case 5:break;default:Q=3}var de=m;m=Q;try{return ne()}finally{m=de}},e.unstable_scheduleCallback=function(Q,ne,de){var ve=e.unstable_now();switch(typeof de=="object"&&de!==null?(de=de.delay,de=typeof de=="number"&&0<de?ve+de:ve):de=ve,Q){case 1:var fe=-1;break;case 2:fe=250;break;case 5:fe=1073741823;break;case 4:fe=1e4;break;default:fe=5e3}return fe=de+fe,Q={id:g++,callback:ne,priorityLevel:Q,startTime:de,expirationTime:fe,sortIndex:-1},de>ve?(Q.sortIndex=de,t(h,Q),n(u)===null&&Q===n(h)&&(T?(S(A),A=-1):T=!0,ae(M,de-ve))):(Q.sortIndex=fe,t(u,Q),v||y||(v=!0,C||(C=!0,ee()))),Q},e.unstable_shouldYield=G,e.unstable_wrapCallback=function(Q){var ne=m;return function(){var de=m;m=ne;try{return Q.apply(this,arguments)}finally{m=de}}}})(k_)),k_}var Qy;function LC(){return Qy||(Qy=1,P_.exports=BC()),P_.exports}var D_={exports:{}},Ua={};/**
 * @license React
 * react-dom.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var qy;function FC(){if(qy)return Ua;qy=1;var e=Dv();function t(u){var h="https://react.dev/errors/"+u;if(1<arguments.length){h+="?args[]="+encodeURIComponent(arguments[1]);for(var g=2;g<arguments.length;g++)h+="&args[]="+encodeURIComponent(arguments[g])}return"Minified React error #"+u+"; visit "+h+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function n(){}var s={d:{f:n,r:function(){throw Error(t(522))},D:n,C:n,L:n,m:n,X:n,S:n,M:n},p:0,findDOMNode:null},i=Symbol.for("react.portal");function o(u,h,g){var p=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:i,key:p==null?null:""+p,children:u,containerInfo:h,implementation:g}}var c=e.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function d(u,h){if(u==="font")return"";if(typeof h=="string")return h==="use-credentials"?h:""}return Ua.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=s,Ua.createPortal=function(u,h){var g=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!h||h.nodeType!==1&&h.nodeType!==9&&h.nodeType!==11)throw Error(t(299));return o(u,h,null,g)},Ua.flushSync=function(u){var h=c.T,g=s.p;try{if(c.T=null,s.p=2,u)return u()}finally{c.T=h,s.p=g,s.d.f()}},Ua.preconnect=function(u,h){typeof u=="string"&&(h?(h=h.crossOrigin,h=typeof h=="string"?h==="use-credentials"?h:"":void 0):h=null,s.d.C(u,h))},Ua.prefetchDNS=function(u){typeof u=="string"&&s.d.D(u)},Ua.preinit=function(u,h){if(typeof u=="string"&&h&&typeof h.as=="string"){var g=h.as,p=d(g,h.crossOrigin),m=typeof h.integrity=="string"?h.integrity:void 0,y=typeof h.fetchPriority=="string"?h.fetchPriority:void 0;g==="style"?s.d.S(u,typeof h.precedence=="string"?h.precedence:void 0,{crossOrigin:p,integrity:m,fetchPriority:y}):g==="script"&&s.d.X(u,{crossOrigin:p,integrity:m,fetchPriority:y,nonce:typeof h.nonce=="string"?h.nonce:void 0})}},Ua.preinitModule=function(u,h){if(typeof u=="string")if(typeof h=="object"&&h!==null){if(h.as==null||h.as==="script"){var g=d(h.as,h.crossOrigin);s.d.M(u,{crossOrigin:g,integrity:typeof h.integrity=="string"?h.integrity:void 0,nonce:typeof h.nonce=="string"?h.nonce:void 0})}}else h==null&&s.d.M(u)},Ua.preload=function(u,h){if(typeof u=="string"&&typeof h=="object"&&h!==null&&typeof h.as=="string"){var g=h.as,p=d(g,h.crossOrigin);s.d.L(u,g,{crossOrigin:p,integrity:typeof h.integrity=="string"?h.integrity:void 0,nonce:typeof h.nonce=="string"?h.nonce:void 0,type:typeof h.type=="string"?h.type:void 0,fetchPriority:typeof h.fetchPriority=="string"?h.fetchPriority:void 0,referrerPolicy:typeof h.referrerPolicy=="string"?h.referrerPolicy:void 0,imageSrcSet:typeof h.imageSrcSet=="string"?h.imageSrcSet:void 0,imageSizes:typeof h.imageSizes=="string"?h.imageSizes:void 0,media:typeof h.media=="string"?h.media:void 0})}},Ua.preloadModule=function(u,h){if(typeof u=="string")if(h){var g=d(h.as,h.crossOrigin);s.d.m(u,{as:typeof h.as=="string"&&h.as!=="script"?h.as:void 0,crossOrigin:g,integrity:typeof h.integrity=="string"?h.integrity:void 0})}else s.d.m(u)},Ua.requestFormReset=function(u){s.d.r(u)},Ua.unstable_batchedUpdates=function(u,h){return u(h)},Ua.useFormState=function(u,h,g){return c.H.useFormState(u,h,g)},Ua.useFormStatus=function(){return c.H.useHostTransitionStatus()},Ua.version="19.2.2",Ua}var Ky;function C1(){if(Ky)return D_.exports;Ky=1;function e(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(t){console.error(t)}}return e(),D_.exports=FC(),D_.exports}/**
 * @license React
 * react-dom-client.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Xy;function zC(){if(Xy)return Vp;Xy=1;var e=LC(),t=Dv(),n=C1();function s(r){var a="https://react.dev/errors/"+r;if(1<arguments.length){a+="?args[]="+encodeURIComponent(arguments[1]);for(var l=2;l<arguments.length;l++)a+="&args[]="+encodeURIComponent(arguments[l])}return"Minified React error #"+r+"; visit "+a+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function i(r){return!(!r||r.nodeType!==1&&r.nodeType!==9&&r.nodeType!==11)}function o(r){var a=r,l=r;if(r.alternate)for(;a.return;)a=a.return;else{r=a;do a=r,(a.flags&4098)!==0&&(l=a.return),r=a.return;while(r)}return a.tag===3?l:null}function c(r){if(r.tag===13){var a=r.memoizedState;if(a===null&&(r=r.alternate,r!==null&&(a=r.memoizedState)),a!==null)return a.dehydrated}return null}function d(r){if(r.tag===31){var a=r.memoizedState;if(a===null&&(r=r.alternate,r!==null&&(a=r.memoizedState)),a!==null)return a.dehydrated}return null}function u(r){if(o(r)!==r)throw Error(s(188))}function h(r){var a=r.alternate;if(!a){if(a=o(r),a===null)throw Error(s(188));return a!==r?null:r}for(var l=r,f=a;;){var _=l.return;if(_===null)break;var w=_.alternate;if(w===null){if(f=_.return,f!==null){l=f;continue}break}if(_.child===w.child){for(w=_.child;w;){if(w===l)return u(_),r;if(w===f)return u(_),a;w=w.sibling}throw Error(s(188))}if(l.return!==f.return)l=_,f=w;else{for(var F=!1,re=_.child;re;){if(re===l){F=!0,l=_,f=w;break}if(re===f){F=!0,f=_,l=w;break}re=re.sibling}if(!F){for(re=w.child;re;){if(re===l){F=!0,l=w,f=_;break}if(re===f){F=!0,f=w,l=_;break}re=re.sibling}if(!F)throw Error(s(189))}}if(l.alternate!==f)throw Error(s(190))}if(l.tag!==3)throw Error(s(188));return l.stateNode.current===l?r:a}function g(r){var a=r.tag;if(a===5||a===26||a===27||a===6)return r;for(r=r.child;r!==null;){if(a=g(r),a!==null)return a;r=r.sibling}return null}var p=Object.assign,m=Symbol.for("react.element"),y=Symbol.for("react.transitional.element"),v=Symbol.for("react.portal"),T=Symbol.for("react.fragment"),O=Symbol.for("react.strict_mode"),E=Symbol.for("react.profiler"),S=Symbol.for("react.consumer"),D=Symbol.for("react.context"),I=Symbol.for("react.forward_ref"),M=Symbol.for("react.suspense"),C=Symbol.for("react.suspense_list"),A=Symbol.for("react.memo"),k=Symbol.for("react.lazy"),R=Symbol.for("react.activity"),G=Symbol.for("react.memo_cache_sentinel"),te=Symbol.iterator;function ee(r){return r===null||typeof r!="object"?null:(r=te&&r[te]||r["@@iterator"],typeof r=="function"?r:null)}var X=Symbol.for("react.client.reference");function le(r){if(r==null)return null;if(typeof r=="function")return r.$$typeof===X?null:r.displayName||r.name||null;if(typeof r=="string")return r;switch(r){case T:return"Fragment";case E:return"Profiler";case O:return"StrictMode";case M:return"Suspense";case C:return"SuspenseList";case R:return"Activity"}if(typeof r=="object")switch(r.$$typeof){case v:return"Portal";case D:return r.displayName||"Context";case S:return(r._context.displayName||"Context")+".Consumer";case I:var a=r.render;return r=r.displayName,r||(r=a.displayName||a.name||"",r=r!==""?"ForwardRef("+r+")":"ForwardRef"),r;case A:return a=r.displayName||null,a!==null?a:le(r.type)||"Memo";case k:a=r._payload,r=r._init;try{return le(r(a))}catch{}}return null}var ae=Array.isArray,Q=t.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,ne=n.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,de={pending:!1,data:null,method:null,action:null},ve=[],fe=-1;function j(r){return{current:r}}function U(r){0>fe||(r.current=ve[fe],ve[fe]=null,fe--)}function N(r,a){fe++,ve[fe]=r.current,r.current=a}var q=j(null),ce=j(null),Z=j(null),Me=j(null);function Pe(r,a){switch(N(Z,a),N(ce,r),N(q,null),a.nodeType){case 9:case 11:r=(r=a.documentElement)&&(r=r.namespaceURI)?Wt(r):0;break;default:if(r=a.tagName,a=a.namespaceURI)a=Wt(a),r=hn(a,r);else switch(r){case"svg":r=1;break;case"math":r=2;break;default:r=0}}U(q),N(q,r)}function Ne(){U(q),U(ce),U(Z)}function Oe(r){r.memoizedState!==null&&N(Me,r);var a=q.current,l=hn(a,r.type);a!==l&&(N(ce,r),N(q,l))}function he(r){ce.current===r&&(U(q),U(ce)),Me.current===r&&(U(Me),zp._currentValue=de)}var H,Te;function ze(r){if(H===void 0)try{throw Error()}catch(l){var a=l.stack.trim().match(/\n( *(at )?)/);H=a&&a[1]||"",Te=-1<l.stack.indexOf(`
    at`)?" (<anonymous>)":-1<l.stack.indexOf("@")?"@unknown:0:0":""}return`
`+H+r+Te}var Re=!1;function He(r,a){if(!r||Re)return"";Re=!0;var l=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var f={DetermineComponentFrameRoot:function(){try{if(a){var st=function(){throw Error()};if(Object.defineProperty(st.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(st,[])}catch(Qe){var je=Qe}Reflect.construct(r,[],st)}else{try{st.call()}catch(Qe){je=Qe}r.call(st.prototype)}}else{try{throw Error()}catch(Qe){je=Qe}(st=r())&&typeof st.catch=="function"&&st.catch(function(){})}}catch(Qe){if(Qe&&je&&typeof Qe.stack=="string")return[Qe.stack,je.stack]}return[null,null]}};f.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var _=Object.getOwnPropertyDescriptor(f.DetermineComponentFrameRoot,"name");_&&_.configurable&&Object.defineProperty(f.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var w=f.DetermineComponentFrameRoot(),F=w[0],re=w[1];if(F&&re){var ye=F.split(`
`),Fe=re.split(`
`);for(_=f=0;f<ye.length&&!ye[f].includes("DetermineComponentFrameRoot");)f++;for(;_<Fe.length&&!Fe[_].includes("DetermineComponentFrameRoot");)_++;if(f===ye.length||_===Fe.length)for(f=ye.length-1,_=Fe.length-1;1<=f&&0<=_&&ye[f]!==Fe[_];)_--;for(;1<=f&&0<=_;f--,_--)if(ye[f]!==Fe[_]){if(f!==1||_!==1)do if(f--,_--,0>_||ye[f]!==Fe[_]){var tt=`
`+ye[f].replace(" at new "," at ");return r.displayName&&tt.includes("<anonymous>")&&(tt=tt.replace("<anonymous>",r.displayName)),tt}while(1<=f&&0<=_);break}}}finally{Re=!1,Error.prepareStackTrace=l}return(l=r?r.displayName||r.name:"")?ze(l):""}function Ke(r,a){switch(r.tag){case 26:case 27:case 5:return ze(r.type);case 16:return ze("Lazy");case 13:return r.child!==a&&a!==null?ze("Suspense Fallback"):ze("Suspense");case 19:return ze("SuspenseList");case 0:case 15:return He(r.type,!1);case 11:return He(r.type.render,!1);case 1:return He(r.type,!0);case 31:return ze("Activity");default:return""}}function Be(r){try{var a="",l=null;do a+=Ke(r,l),l=r,r=r.return;while(r);return a}catch(f){return`
Error generating stack: `+f.message+`
`+f.stack}}var nt=Object.prototype.hasOwnProperty,$e=e.unstable_scheduleCallback,qe=e.unstable_cancelCallback,_t=e.unstable_shouldYield,Je=e.unstable_requestPaint,pt=e.unstable_now,dt=e.unstable_getCurrentPriorityLevel,Gt=e.unstable_ImmediatePriority,vt=e.unstable_UserBlockingPriority,Ze=e.unstable_NormalPriority,rt=e.unstable_LowPriority,kt=e.unstable_IdlePriority,Nt=e.log,gn=e.unstable_setDisableYieldValue,Jt=null,Cn=null;function Fn(r){if(typeof Nt=="function"&&gn(r),Cn&&typeof Cn.setStrictMode=="function")try{Cn.setStrictMode(Jt,r)}catch{}}var tn=Math.clz32?Math.clz32:fs,ta=Math.log,ds=Math.LN2;function fs(r){return r>>>=0,r===0?32:31-(ta(r)/ds|0)|0}var Wa=256,Vn=262144,Er=4194304;function qr(r){var a=r&42;if(a!==0)return a;switch(r&-r){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:return r&261888;case 262144:case 524288:case 1048576:case 2097152:return r&3932160;case 4194304:case 8388608:case 16777216:case 33554432:return r&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return r}}function Pa(r,a,l){var f=r.pendingLanes;if(f===0)return 0;var _=0,w=r.suspendedLanes,F=r.pingedLanes;r=r.warmLanes;var re=f&134217727;return re!==0?(f=re&~w,f!==0?_=qr(f):(F&=re,F!==0?_=qr(F):l||(l=re&~r,l!==0&&(_=qr(l))))):(re=f&~w,re!==0?_=qr(re):F!==0?_=qr(F):l||(l=f&~r,l!==0&&(_=qr(l)))),_===0?0:a!==0&&a!==_&&(a&w)===0&&(w=_&-_,l=a&-a,w>=l||w===32&&(l&4194048)!==0)?a:_}function Ft(r,a){return(r.pendingLanes&~(r.suspendedLanes&~r.pingedLanes)&a)===0}function ns(r,a){switch(r){case 1:case 2:case 4:case 8:case 64:return a+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return a+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Ha(){var r=Er;return Er<<=1,(Er&62914560)===0&&(Er=4194304),r}function Dn(r){for(var a=[],l=0;31>l;l++)a.push(r);return a}function Kr(r,a){r.pendingLanes|=a,a!==268435456&&(r.suspendedLanes=0,r.pingedLanes=0,r.warmLanes=0)}function an(r,a,l,f,_,w){var F=r.pendingLanes;r.pendingLanes=l,r.suspendedLanes=0,r.pingedLanes=0,r.warmLanes=0,r.expiredLanes&=l,r.entangledLanes&=l,r.errorRecoveryDisabledLanes&=l,r.shellSuspendCounter=0;var re=r.entanglements,ye=r.expirationTimes,Fe=r.hiddenUpdates;for(l=F&~l;0<l;){var tt=31-tn(l),st=1<<tt;re[tt]=0,ye[tt]=-1;var je=Fe[tt];if(je!==null)for(Fe[tt]=null,tt=0;tt<je.length;tt++){var Qe=je[tt];Qe!==null&&(Qe.lane&=-536870913)}l&=~st}f!==0&&Qa(r,f,0),w!==0&&_===0&&r.tag!==0&&(r.suspendedLanes|=w&~(F&~a))}function Qa(r,a,l){r.pendingLanes|=a,r.suspendedLanes&=~a;var f=31-tn(a);r.entangledLanes|=a,r.entanglements[f]=r.entanglements[f]|1073741824|l&261930}function L(r,a){var l=r.entangledLanes|=a;for(r=r.entanglements;l;){var f=31-tn(l),_=1<<f;_&a|r[f]&a&&(r[f]|=a),l&=~_}}function ue(r,a){var l=a&-a;return l=(l&42)!==0?1:Y(l),(l&(r.suspendedLanes|a))!==0?0:l}function Y(r){switch(r){case 2:r=1;break;case 8:r=4;break;case 32:r=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:r=128;break;case 268435456:r=134217728;break;default:r=0}return r}function oe(r){return r&=-r,2<r?8<r?(r&134217727)!==0?32:268435456:8:2}function pe(){var r=ne.p;return r!==0?r:(r=window.event,r===void 0?32:$y(r.type))}function Ce(r,a){var l=ne.p;try{return ne.p=r,a()}finally{ne.p=l}}var Ue=Math.random().toString(36).slice(2),Ye="__reactFiber$"+Ue,ct="__reactProps$"+Ue,ft="__reactContainer$"+Ue,Tt="__reactEvents$"+Ue,Et="__reactListeners$"+Ue,nn="__reactHandles$"+Ue,xt="__reactResources$"+Ue,Zt="__reactMarker$"+Ue;function wn(r){delete r[Ye],delete r[ct],delete r[Tt],delete r[Et],delete r[nn]}function Gn(r){var a=r[Ye];if(a)return a;for(var l=r.parentNode;l;){if(a=l[ft]||l[Ye]){if(l=a.alternate,a.child!==null||l!==null&&l.child!==null)for(r=Wr(r);r!==null;){if(l=r[Ye])return l;r=Wr(r)}return a}r=l,l=r.parentNode}return null}function or(r){if(r=r[Ye]||r[ft]){var a=r.tag;if(a===5||a===6||a===13||a===31||a===26||a===27||a===3)return r}return null}function Ir(r){var a=r.tag;if(a===5||a===26||a===27||a===6)return r.stateNode;throw Error(s(33))}function _a(r){var a=r[xt];return a||(a=r[xt]={hoistableStyles:new Map,hoistableScripts:new Map}),a}function nr(r){r[Zt]=!0}var Tr=new Set,Bs={};function na(r,a){Pr(r,a),Pr(r+"Capture",a)}function Pr(r,a){for(Bs[r]=a,r=0;r<a.length;r++)Tr.add(a[r])}var xa=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),mr={},wr={};function hs(r){return nt.call(wr,r)?!0:nt.call(mr,r)?!1:xa.test(r)?wr[r]=!0:(mr[r]=!0,!1)}function qa(r,a,l){if(hs(a))if(l===null)r.removeAttribute(a);else{switch(typeof l){case"undefined":case"function":case"symbol":r.removeAttribute(a);return;case"boolean":var f=a.toLowerCase().slice(0,5);if(f!=="data-"&&f!=="aria-"){r.removeAttribute(a);return}}r.setAttribute(a,""+l)}}function Ka(r,a,l){if(l===null)r.removeAttribute(a);else{switch(typeof l){case"undefined":case"function":case"symbol":case"boolean":r.removeAttribute(a);return}r.setAttribute(a,""+l)}}function ra(r,a,l,f){if(f===null)r.removeAttribute(l);else{switch(typeof f){case"undefined":case"function":case"symbol":case"boolean":r.removeAttribute(l);return}r.setAttributeNS(a,l,""+f)}}function Ar(r){switch(typeof r){case"bigint":case"boolean":case"number":case"string":case"undefined":return r;case"object":return r;default:return""}}function ua(r){var a=r.type;return(r=r.nodeName)&&r.toLowerCase()==="input"&&(a==="checkbox"||a==="radio")}function lt(r,a,l){var f=Object.getOwnPropertyDescriptor(r.constructor.prototype,a);if(!r.hasOwnProperty(a)&&typeof f<"u"&&typeof f.get=="function"&&typeof f.set=="function"){var _=f.get,w=f.set;return Object.defineProperty(r,a,{configurable:!0,get:function(){return _.call(this)},set:function(F){l=""+F,w.call(this,F)}}),Object.defineProperty(r,a,{enumerable:f.enumerable}),{getValue:function(){return l},setValue:function(F){l=""+F},stopTracking:function(){r._valueTracker=null,delete r[a]}}}}function ut(r){if(!r._valueTracker){var a=ua(r)?"checked":"value";r._valueTracker=lt(r,a,""+r[a])}}function At(r){if(!r)return!1;var a=r._valueTracker;if(!a)return!0;var l=a.getValue(),f="";return r&&(f=ua(r)?r.checked?"true":"false":r.value),r=f,r!==l?(a.setValue(r),!0):!1}function En(r){if(r=r||(typeof document<"u"?document:void 0),typeof r>"u")return null;try{return r.activeElement||r.body}catch{return r.body}}var ni=/[\n"\\]/g;function Fr(r){return r.replace(ni,function(a){return"\\"+a.charCodeAt(0).toString(16)+" "})}function ps(r,a,l,f,_,w,F,re){r.name="",F!=null&&typeof F!="function"&&typeof F!="symbol"&&typeof F!="boolean"?r.type=F:r.removeAttribute("type"),a!=null?F==="number"?(a===0&&r.value===""||r.value!=a)&&(r.value=""+Ar(a)):r.value!==""+Ar(a)&&(r.value=""+Ar(a)):F!=="submit"&&F!=="reset"||r.removeAttribute("value"),a!=null?Ie(r,F,Ar(a)):l!=null?Ie(r,F,Ar(l)):f!=null&&r.removeAttribute("value"),_==null&&w!=null&&(r.defaultChecked=!!w),_!=null&&(r.checked=_&&typeof _!="function"&&typeof _!="symbol"),re!=null&&typeof re!="function"&&typeof re!="symbol"&&typeof re!="boolean"?r.name=""+Ar(re):r.removeAttribute("name")}function Pi(r,a,l,f,_,w,F,re){if(w!=null&&typeof w!="function"&&typeof w!="symbol"&&typeof w!="boolean"&&(r.type=w),a!=null||l!=null){if(!(w!=="submit"&&w!=="reset"||a!=null)){ut(r);return}l=l!=null?""+Ar(l):"",a=a!=null?""+Ar(a):l,re||a===r.value||(r.value=a),r.defaultValue=a}f=f??_,f=typeof f!="function"&&typeof f!="symbol"&&!!f,r.checked=re?r.checked:!!f,r.defaultChecked=!!f,F!=null&&typeof F!="function"&&typeof F!="symbol"&&typeof F!="boolean"&&(r.name=F),ut(r)}function Ie(r,a,l){a==="number"&&En(r.ownerDocument)===r||r.defaultValue===""+l||(r.defaultValue=""+l)}function V(r,a,l,f){if(r=r.options,a){a={};for(var _=0;_<l.length;_++)a["$"+l[_]]=!0;for(l=0;l<r.length;l++)_=a.hasOwnProperty("$"+r[l].value),r[l].selected!==_&&(r[l].selected=_),_&&f&&(r[l].defaultSelected=!0)}else{for(l=""+Ar(l),a=null,_=0;_<r.length;_++){if(r[_].value===l){r[_].selected=!0,f&&(r[_].defaultSelected=!0);return}a!==null||r[_].disabled||(a=r[_])}a!==null&&(a.selected=!0)}}function se(r,a,l){if(a!=null&&(a=""+Ar(a),a!==r.value&&(r.value=a),l==null)){r.defaultValue!==a&&(r.defaultValue=a);return}r.defaultValue=l!=null?""+Ar(l):""}function me(r,a,l,f){if(a==null){if(f!=null){if(l!=null)throw Error(s(92));if(ae(f)){if(1<f.length)throw Error(s(93));f=f[0]}l=f}l==null&&(l=""),a=l}l=Ar(a),r.defaultValue=l,f=r.textContent,f===l&&f!==""&&f!==null&&(r.value=f),ut(r)}function be(r,a){if(a){var l=r.firstChild;if(l&&l===r.lastChild&&l.nodeType===3){l.nodeValue=a;return}}r.textContent=a}var Se=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function We(r,a,l){var f=a.indexOf("--")===0;l==null||typeof l=="boolean"||l===""?f?r.setProperty(a,""):a==="float"?r.cssFloat="":r[a]="":f?r.setProperty(a,l):typeof l!="number"||l===0||Se.has(a)?a==="float"?r.cssFloat=l:r[a]=(""+l).trim():r[a]=l+"px"}function ht(r,a,l){if(a!=null&&typeof a!="object")throw Error(s(62));if(r=r.style,l!=null){for(var f in l)!l.hasOwnProperty(f)||a!=null&&a.hasOwnProperty(f)||(f.indexOf("--")===0?r.setProperty(f,""):f==="float"?r.cssFloat="":r[f]="");for(var _ in a)f=a[_],a.hasOwnProperty(_)&&l[_]!==f&&We(r,_,f)}else for(var w in a)a.hasOwnProperty(w)&&We(r,w,a[w])}function bt(r){if(r.indexOf("-")===-1)return!1;switch(r){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var yt=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),Ct=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function Vt(r){return Ct.test(""+r)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":r}function un(){}var vn=null;function Jn(r){return r=r.target||r.srcElement||window,r.correspondingUseElement&&(r=r.correspondingUseElement),r.nodeType===3?r.parentNode:r}var Tn=null,lr=null;function kr(r){var a=or(r);if(a&&(r=a.stateNode)){var l=r[ct]||null;e:switch(r=a.stateNode,a.type){case"input":if(ps(r,l.value,l.defaultValue,l.defaultValue,l.checked,l.defaultChecked,l.type,l.name),a=l.name,l.type==="radio"&&a!=null){for(l=r;l.parentNode;)l=l.parentNode;for(l=l.querySelectorAll('input[name="'+Fr(""+a)+'"][type="radio"]'),a=0;a<l.length;a++){var f=l[a];if(f!==r&&f.form===r.form){var _=f[ct]||null;if(!_)throw Error(s(90));ps(f,_.value,_.defaultValue,_.defaultValue,_.checked,_.defaultChecked,_.type,_.name)}}for(a=0;a<l.length;a++)f=l[a],f.form===r.form&&At(f)}break e;case"textarea":se(r,l.value,l.defaultValue);break e;case"select":a=l.value,a!=null&&V(r,!!l.multiple,a,!1)}}}var gr=!1;function Dr(r,a,l){if(gr)return r(a,l);gr=!0;try{var f=r(a);return f}finally{if(gr=!1,(Tn!==null||lr!==null)&&(ru(),Tn&&(a=Tn,r=lr,lr=Tn=null,kr(a),r)))for(a=0;a<r.length;a++)kr(r[a])}}function Mr(r,a){var l=r.stateNode;if(l===null)return null;var f=l[ct]||null;if(f===null)return null;l=f[a];e:switch(a){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(f=!f.disabled)||(r=r.type,f=!(r==="button"||r==="input"||r==="select"||r==="textarea")),r=!f;break e;default:r=!1}if(r)return null;if(l&&typeof l!="function")throw Error(s(231,a,typeof l));return l}var zr=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Wn=!1;if(zr)try{var _r={};Object.defineProperty(_r,"passive",{get:function(){Wn=!0}}),window.addEventListener("test",_r,_r),window.removeEventListener("test",_r,_r)}catch{Wn=!1}var cr=null,va=null,ka=null;function Xr(){if(ka)return ka;var r,a=va,l=a.length,f,_="value"in cr?cr.value:cr.textContent,w=_.length;for(r=0;r<l&&a[r]===_[r];r++);var F=l-r;for(f=1;f<=F&&a[l-f]===_[w-f];f++);return ka=_.slice(r,1<f?1-f:void 0)}function Ea(r){var a=r.keyCode;return"charCode"in r?(r=r.charCode,r===0&&a===13&&(r=13)):r=a,r===10&&(r=13),32<=r||r===13?r:0}function rr(){return!0}function xr(){return!1}function Sn(r){function a(l,f,_,w,F){this._reactName=l,this._targetInst=_,this.type=f,this.nativeEvent=w,this.target=F,this.currentTarget=null;for(var re in r)r.hasOwnProperty(re)&&(l=r[re],this[re]=l?l(w):w[re]);return this.isDefaultPrevented=(w.defaultPrevented!=null?w.defaultPrevented:w.returnValue===!1)?rr:xr,this.isPropagationStopped=xr,this}return p(a.prototype,{preventDefault:function(){this.defaultPrevented=!0;var l=this.nativeEvent;l&&(l.preventDefault?l.preventDefault():typeof l.returnValue!="unknown"&&(l.returnValue=!1),this.isDefaultPrevented=rr)},stopPropagation:function(){var l=this.nativeEvent;l&&(l.stopPropagation?l.stopPropagation():typeof l.cancelBubble!="unknown"&&(l.cancelBubble=!0),this.isPropagationStopped=rr)},persist:function(){},isPersistent:rr}),a}var On={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(r){return r.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},aa=Sn(On),Xa=p({},On,{view:0,detail:0}),Ls=Sn(Xa),rl,al,ri,lo=p({},Xa,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:ol,button:0,buttons:0,relatedTarget:function(r){return r.relatedTarget===void 0?r.fromElement===r.srcElement?r.toElement:r.fromElement:r.relatedTarget},movementX:function(r){return"movementX"in r?r.movementX:(r!==ri&&(ri&&r.type==="mousemove"?(rl=r.screenX-ri.screenX,al=r.screenY-ri.screenY):al=rl=0,ri=r),rl)},movementY:function(r){return"movementY"in r?r.movementY:al}}),cc=Sn(lo),ki=p({},lo,{dataTransfer:0}),Su=Sn(ki),Iu=p({},Xa,{relatedTarget:0}),sl=Sn(Iu),Pu=p({},On,{animationName:0,elapsedTime:0,pseudoElement:0}),ku=Sn(Pu),Di=p({},On,{clipboardData:function(r){return"clipboardData"in r?r.clipboardData:window.clipboardData}}),Du=Sn(Di),Ou=p({},On,{data:0}),uc=Sn(Ou),dc={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},fc={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},il={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function $u(r){var a=this.nativeEvent;return a.getModifierState?a.getModifierState(r):(r=il[r])?!!a[r]:!1}function ol(){return $u}var ll=p({},Xa,{key:function(r){if(r.key){var a=dc[r.key]||r.key;if(a!=="Unidentified")return a}return r.type==="keypress"?(r=Ea(r),r===13?"Enter":String.fromCharCode(r)):r.type==="keydown"||r.type==="keyup"?fc[r.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:ol,charCode:function(r){return r.type==="keypress"?Ea(r):0},keyCode:function(r){return r.type==="keydown"||r.type==="keyup"?r.keyCode:0},which:function(r){return r.type==="keypress"?Ea(r):r.type==="keydown"||r.type==="keyup"?r.keyCode:0}}),hc=Sn(ll),ai=p({},lo,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),pc=Sn(ai),cl=p({},Xa,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:ol}),Tf=Sn(cl),Bu=p({},On,{propertyName:0,elapsedTime:0,pseudoElement:0}),mc=Sn(Bu),co=p({},lo,{deltaX:function(r){return"deltaX"in r?r.deltaX:"wheelDeltaX"in r?-r.wheelDeltaX:0},deltaY:function(r){return"deltaY"in r?r.deltaY:"wheelDeltaY"in r?-r.wheelDeltaY:"wheelDelta"in r?-r.wheelDelta:0},deltaZ:0,deltaMode:0}),uo=Sn(co),Lu=p({},On,{newState:0,oldState:0}),Fu=Sn(Lu),zu=[9,13,27,32],ul=zr&&"CompositionEvent"in window,Oi=null;zr&&"documentMode"in document&&(Oi=document.documentMode);var Nu=zr&&"TextEvent"in window&&!Oi,dl=zr&&(!ul||Oi&&8<Oi&&11>=Oi),gc=" ",_c=!1;function si(r,a){switch(r){case"keyup":return zu.indexOf(a.keyCode)!==-1;case"keydown":return a.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function ii(r){return r=r.detail,typeof r=="object"&&"data"in r?r.data:null}var rs=!1;function vc(r,a){switch(r){case"compositionend":return ii(a);case"keypress":return a.which!==32?null:(_c=!0,gc);case"textInput":return r=a.data,r===gc&&_c?null:r;default:return null}}function Ru(r,a){if(rs)return r==="compositionend"||!ul&&si(r,a)?(r=Xr(),ka=va=cr=null,rs=!1,r):null;switch(r){case"paste":return null;case"keypress":if(!(a.ctrlKey||a.altKey||a.metaKey)||a.ctrlKey&&a.altKey){if(a.char&&1<a.char.length)return a.char;if(a.which)return String.fromCharCode(a.which)}return null;case"compositionend":return dl&&a.locale!=="ko"?null:a.data;default:return null}}var fo={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function as(r){var a=r&&r.nodeName&&r.nodeName.toLowerCase();return a==="input"?!!fo[r.type]:a==="textarea"}function fl(r,a,l,f){Tn?lr?lr.push(f):lr=[f]:Tn=f,a=Ss(a,"onChange"),0<a.length&&(l=new aa("onChange","change",null,l,f),r.push({event:l,listeners:a}))}var $i=null,oi=null;function ju(r){Pp(r,0)}function Bi(r){var a=Ir(r);if(At(a))return r}function ho(r,a){if(r==="change")return a}var yc=!1;if(zr){var po;if(zr){var mo="oninput"in document;if(!mo){var Li=document.createElement("div");Li.setAttribute("oninput","return;"),mo=typeof Li.oninput=="function"}po=mo}else po=!1;yc=po&&(!document.documentMode||9<document.documentMode)}function Bt(){$i&&($i.detachEvent("onpropertychange",go),oi=$i=null)}function go(r){if(r.propertyName==="value"&&Bi(oi)){var a=[];fl(a,oi,r,Jn(r)),Dr(ju,a)}}function bc(r,a,l){r==="focusin"?(Bt(),$i=a,oi=l,$i.attachEvent("onpropertychange",go)):r==="focusout"&&Bt()}function wc(r){if(r==="selectionchange"||r==="keyup"||r==="keydown")return Bi(oi)}function _o(r,a){if(r==="click")return Bi(a)}function Da(r,a){if(r==="input"||r==="change")return Bi(a)}function vo(r,a){return r===a&&(r!==0||1/r===1/a)||r!==r&&a!==a}var sa=typeof Object.is=="function"?Object.is:vo;function Fs(r,a){if(sa(r,a))return!0;if(typeof r!="object"||r===null||typeof a!="object"||a===null)return!1;var l=Object.keys(r),f=Object.keys(a);if(l.length!==f.length)return!1;for(f=0;f<l.length;f++){var _=l[f];if(!nt.call(a,_)||!sa(r[_],a[_]))return!1}return!0}function hl(r){for(;r&&r.firstChild;)r=r.firstChild;return r}function pl(r,a){var l=hl(r);r=0;for(var f;l;){if(l.nodeType===3){if(f=r+l.textContent.length,r<=a&&f>=a)return{node:l,offset:a-r};r=f}e:{for(;l;){if(l.nextSibling){l=l.nextSibling;break e}l=l.parentNode}l=void 0}l=hl(l)}}function Fi(r,a){return r&&a?r===a?!0:r&&r.nodeType===3?!1:a&&a.nodeType===3?Fi(r,a.parentNode):"contains"in r?r.contains(a):r.compareDocumentPosition?!!(r.compareDocumentPosition(a)&16):!1:!1}function ml(r){r=r!=null&&r.ownerDocument!=null&&r.ownerDocument.defaultView!=null?r.ownerDocument.defaultView:window;for(var a=En(r.document);a instanceof r.HTMLIFrameElement;){try{var l=typeof a.contentWindow.location.href=="string"}catch{l=!1}if(l)r=a.contentWindow;else break;a=En(r.document)}return a}function yo(r){var a=r&&r.nodeName&&r.nodeName.toLowerCase();return a&&(a==="input"&&(r.type==="text"||r.type==="search"||r.type==="tel"||r.type==="url"||r.type==="password")||a==="textarea"||r.contentEditable==="true")}var gl=zr&&"documentMode"in document&&11>=document.documentMode,ss=null,zi=null,ms=null,bo=!1;function _l(r,a,l){var f=l.window===l?l.document:l.nodeType===9?l:l.ownerDocument;bo||ss==null||ss!==En(f)||(f=ss,"selectionStart"in f&&yo(f)?f={start:f.selectionStart,end:f.selectionEnd}:(f=(f.ownerDocument&&f.ownerDocument.defaultView||window).getSelection(),f={anchorNode:f.anchorNode,anchorOffset:f.anchorOffset,focusNode:f.focusNode,focusOffset:f.focusOffset}),ms&&Fs(ms,f)||(ms=f,f=Ss(zi,"onSelect"),0<f.length&&(a=new aa("onSelect","select",null,a,l),r.push({event:a,listeners:f}),a.target=ss)))}function is(r,a){var l={};return l[r.toLowerCase()]=a.toLowerCase(),l["Webkit"+r]="webkit"+a,l["Moz"+r]="moz"+a,l}var zs={animationend:is("Animation","AnimationEnd"),animationiteration:is("Animation","AnimationIteration"),animationstart:is("Animation","AnimationStart"),transitionrun:is("Transition","TransitionRun"),transitionstart:is("Transition","TransitionStart"),transitioncancel:is("Transition","TransitionCancel"),transitionend:is("Transition","TransitionEnd")},wo={},Mo={};zr&&(Mo=document.createElement("div").style,"AnimationEvent"in window||(delete zs.animationend.animation,delete zs.animationiteration.animation,delete zs.animationstart.animation),"TransitionEvent"in window||delete zs.transitionend.transition);function b(r){if(wo[r])return wo[r];if(!zs[r])return r;var a=zs[r],l;for(l in a)if(a.hasOwnProperty(l)&&l in Mo)return wo[r]=a[l];return r}var $=b("animationend"),W=b("animationiteration"),J=b("animationstart"),ie=b("transitionrun"),Ee=b("transitionstart"),Xe=b("transitioncancel"),ot=b("transitionend"),Mt=new Map,St="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");St.push("scrollEnd");function Rt(r,a){Mt.set(r,a),na(a,[r])}var _n=typeof reportError=="function"?reportError:function(r){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var a=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof r=="object"&&r!==null&&typeof r.message=="string"?String(r.message):String(r),error:r});if(!window.dispatchEvent(a))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",r);return}console.error(r)},dn=[],ur=0,gs=0;function xo(){for(var r=ur,a=gs=ur=0;a<r;){var l=dn[a];dn[a++]=null;var f=dn[a];dn[a++]=null;var _=dn[a];dn[a++]=null;var w=dn[a];if(dn[a++]=null,f!==null&&_!==null){var F=f.pending;F===null?_.next=_:(_.next=F.next,F.next=_),f.pending=_}w!==0&&Vu(l,_,w)}}function vl(r,a,l,f){dn[ur++]=r,dn[ur++]=a,dn[ur++]=l,dn[ur++]=f,gs|=f,r.lanes|=f,r=r.alternate,r!==null&&(r.lanes|=f)}function Uu(r,a,l,f){return vl(r,a,l,f),Mc(r)}function Ni(r,a){return vl(r,null,null,a),Mc(r)}function Vu(r,a,l){r.lanes|=l;var f=r.alternate;f!==null&&(f.lanes|=l);for(var _=!1,w=r.return;w!==null;)w.childLanes|=l,f=w.alternate,f!==null&&(f.childLanes|=l),w.tag===22&&(r=w.stateNode,r===null||r._visibility&1||(_=!0)),r=w,w=w.return;return r.tag===3?(w=r.stateNode,_&&a!==null&&(_=31-tn(l),r=w.hiddenUpdates,f=r[_],f===null?r[_]=[a]:f.push(a),a.lane=l|536870912),w):null}function Mc(r){if(50<tu)throw tu=0,nu=null,Error(s(185));for(var a=r.return;a!==null;)r=a,a=r.return;return r.tag===3?r.stateNode:null}var Eo={};function Af(r,a,l,f){this.tag=r,this.key=l,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=a,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=f,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Oa(r,a,l,f){return new Af(r,a,l,f)}function Gu(r){return r=r.prototype,!(!r||!r.isReactComponent)}function _s(r,a){var l=r.alternate;return l===null?(l=Oa(r.tag,a,r.key,r.mode),l.elementType=r.elementType,l.type=r.type,l.stateNode=r.stateNode,l.alternate=r,r.alternate=l):(l.pendingProps=a,l.type=r.type,l.flags=0,l.subtreeFlags=0,l.deletions=null),l.flags=r.flags&65011712,l.childLanes=r.childLanes,l.lanes=r.lanes,l.child=r.child,l.memoizedProps=r.memoizedProps,l.memoizedState=r.memoizedState,l.updateQueue=r.updateQueue,a=r.dependencies,l.dependencies=a===null?null:{lanes:a.lanes,firstContext:a.firstContext},l.sibling=r.sibling,l.index=r.index,l.ref=r.ref,l.refCleanup=r.refCleanup,l}function Cf(r,a){r.flags&=65011714;var l=r.alternate;return l===null?(r.childLanes=0,r.lanes=a,r.child=null,r.subtreeFlags=0,r.memoizedProps=null,r.memoizedState=null,r.updateQueue=null,r.dependencies=null,r.stateNode=null):(r.childLanes=l.childLanes,r.lanes=l.lanes,r.child=l.child,r.subtreeFlags=0,r.deletions=null,r.memoizedProps=l.memoizedProps,r.memoizedState=l.memoizedState,r.updateQueue=l.updateQueue,r.type=l.type,a=l.dependencies,r.dependencies=a===null?null:{lanes:a.lanes,firstContext:a.firstContext}),r}function xc(r,a,l,f,_,w){var F=0;if(f=r,typeof r=="function")Gu(r)&&(F=1);else if(typeof r=="string")F=_C(r,l,q.current)?26:r==="html"||r==="head"||r==="body"?27:5;else e:switch(r){case R:return r=Oa(31,l,a,_),r.elementType=R,r.lanes=w,r;case T:return li(l.children,_,w,a);case O:F=8,_|=24;break;case E:return r=Oa(12,l,a,_|2),r.elementType=E,r.lanes=w,r;case M:return r=Oa(13,l,a,_),r.elementType=M,r.lanes=w,r;case C:return r=Oa(19,l,a,_),r.elementType=C,r.lanes=w,r;default:if(typeof r=="object"&&r!==null)switch(r.$$typeof){case D:F=10;break e;case S:F=9;break e;case I:F=11;break e;case A:F=14;break e;case k:F=16,f=null;break e}F=29,l=Error(s(130,r===null?"null":typeof r,"")),f=null}return a=Oa(F,l,a,_),a.elementType=r,a.type=f,a.lanes=w,a}function li(r,a,l,f){return r=Oa(7,r,f,a),r.lanes=l,r}function Wu(r,a,l){return r=Oa(6,r,null,a),r.lanes=l,r}function Sf(r){var a=Oa(18,null,null,0);return a.stateNode=r,a}function Ec(r,a,l){return a=Oa(4,r.children!==null?r.children:[],r.key,a),a.lanes=l,a.stateNode={containerInfo:r.containerInfo,pendingChildren:null,implementation:r.implementation},a}var If=new WeakMap;function Ya(r,a){if(typeof r=="object"&&r!==null){var l=If.get(r);return l!==void 0?l:(a={value:r,source:a,stack:Be(a)},If.set(r,a),a)}return{value:r,source:a,stack:Be(a)}}var Ri=[],To=0,Tc=null,Ao=0,Ja=[],Za=0,Ns=null,vs=1,ys="";function bs(r,a){Ri[To++]=Ao,Ri[To++]=Tc,Tc=r,Ao=a}function Pf(r,a,l){Ja[Za++]=vs,Ja[Za++]=ys,Ja[Za++]=Ns,Ns=r;var f=vs;r=ys;var _=32-tn(f)-1;f&=~(1<<_),l+=1;var w=32-tn(a)+_;if(30<w){var F=_-_%5;w=(f&(1<<F)-1).toString(32),f>>=F,_-=F,vs=1<<32-tn(a)+_|l<<_|f,ys=w+r}else vs=1<<w|l<<_|f,ys=r}function Hu(r){r.return!==null&&(bs(r,1),Pf(r,1,0))}function Ac(r){for(;r===Tc;)Tc=Ri[--To],Ri[To]=null,Ao=Ri[--To],Ri[To]=null;for(;r===Ns;)Ns=Ja[--Za],Ja[Za]=null,ys=Ja[--Za],Ja[Za]=null,vs=Ja[--Za],Ja[Za]=null}function kf(r,a){Ja[Za++]=vs,Ja[Za++]=ys,Ja[Za++]=Ns,vs=a.id,ys=a.overflow,Ns=r}var ia=null,ar=null,An=!1,ci=null,$a=!1,Qu=Error(s(519));function ui(r){var a=Error(s(418,1<arguments.length&&arguments[1]!==void 0&&arguments[1]?"text":"HTML",""));throw yl(Ya(a,r)),Qu}function qu(r){var a=r.stateNode,l=r.type,f=r.memoizedProps;switch(a[Ye]=r,a[ct]=f,l){case"dialog":Mn("cancel",a),Mn("close",a);break;case"iframe":case"object":case"embed":Mn("load",a);break;case"video":case"audio":for(l=0;l<Kl.length;l++)Mn(Kl[l],a);break;case"source":Mn("error",a);break;case"img":case"image":case"link":Mn("error",a),Mn("load",a);break;case"details":Mn("toggle",a);break;case"input":Mn("invalid",a),Pi(a,f.value,f.defaultValue,f.checked,f.defaultChecked,f.type,f.name,!0);break;case"select":Mn("invalid",a);break;case"textarea":Mn("invalid",a),me(a,f.value,f.defaultValue,f.children)}l=f.children,typeof l!="string"&&typeof l!="number"&&typeof l!="bigint"||a.textContent===""+l||f.suppressHydrationWarning===!0||K(a.textContent,l)?(f.popover!=null&&(Mn("beforetoggle",a),Mn("toggle",a)),f.onScroll!=null&&Mn("scroll",a),f.onScrollEnd!=null&&Mn("scrollend",a),f.onClick!=null&&(a.onclick=un),a=!0):a=!1,a||ui(r,!0)}function Df(r){for(ia=r.return;ia;)switch(ia.tag){case 5:case 31:case 13:$a=!1;return;case 27:case 3:$a=!0;return;default:ia=ia.return}}function Co(r){if(r!==ia)return!1;if(!An)return Df(r),An=!0,!1;var a=r.tag,l;if((l=a!==3&&a!==27)&&((l=a===5)&&(l=r.type,l=!(l!=="form"&&l!=="button")||Lt(r.type,r.memoizedProps)),l=!l),l&&ar&&ui(r),Df(r),a===13){if(r=r.memoizedState,r=r!==null?r.dehydrated:null,!r)throw Error(s(317));ar=ir(r)}else if(a===31){if(r=r.memoizedState,r=r!==null?r.dehydrated:null,!r)throw Error(s(317));ar=ir(r)}else a===27?(a=ar,er(r.type)?(r=Yl,Yl=null,ar=r):ar=a):ar=ia?Ca(r.stateNode.nextSibling):null;return!0}function di(){ar=ia=null,An=!1}function Ku(){var r=ci;return r!==null&&(ha===null?ha=r:ha.push.apply(ha,r),ci=null),r}function yl(r){ci===null?ci=[r]:ci.push(r)}var Cc=j(null),ji=null,Rs=null;function js(r,a,l){N(Cc,a._currentValue),a._currentValue=l}function Us(r){r._currentValue=Cc.current,U(Cc)}function Xu(r,a,l){for(;r!==null;){var f=r.alternate;if((r.childLanes&a)!==a?(r.childLanes|=a,f!==null&&(f.childLanes|=a)):f!==null&&(f.childLanes&a)!==a&&(f.childLanes|=a),r===l)break;r=r.return}}function Sc(r,a,l,f){var _=r.child;for(_!==null&&(_.return=r);_!==null;){var w=_.dependencies;if(w!==null){var F=_.child;w=w.firstContext;e:for(;w!==null;){var re=w;w=_;for(var ye=0;ye<a.length;ye++)if(re.context===a[ye]){w.lanes|=l,re=w.alternate,re!==null&&(re.lanes|=l),Xu(w.return,l,r),f||(F=null);break e}w=re.next}}else if(_.tag===18){if(F=_.return,F===null)throw Error(s(341));F.lanes|=l,w=F.alternate,w!==null&&(w.lanes|=l),Xu(F,l,r),F=null}else F=_.child;if(F!==null)F.return=_;else for(F=_;F!==null;){if(F===r){F=null;break}if(_=F.sibling,_!==null){_.return=F.return,F=_;break}F=F.return}_=F}}function So(r,a,l,f){r=null;for(var _=a,w=!1;_!==null;){if(!w){if((_.flags&524288)!==0)w=!0;else if((_.flags&262144)!==0)break}if(_.tag===10){var F=_.alternate;if(F===null)throw Error(s(387));if(F=F.memoizedProps,F!==null){var re=_.type;sa(_.pendingProps.value,F.value)||(r!==null?r.push(re):r=[re])}}else if(_===Me.current){if(F=_.alternate,F===null)throw Error(s(387));F.memoizedState.memoizedState!==_.memoizedState.memoizedState&&(r!==null?r.push(zp):r=[zp])}_=_.return}r!==null&&Sc(a,r,l,f),a.flags|=262144}function Ic(r){for(r=r.firstContext;r!==null;){if(!sa(r.context._currentValue,r.memoizedValue))return!0;r=r.next}return!1}function Ui(r){ji=r,Rs=null,r=r.dependencies,r!==null&&(r.firstContext=null)}function oa(r){return Of(ji,r)}function bl(r,a){return ji===null&&Ui(r),Of(r,a)}function Of(r,a){var l=a._currentValue;if(a={context:a,memoizedValue:l,next:null},Rs===null){if(r===null)throw Error(s(308));Rs=a,r.dependencies={lanes:0,firstContext:a},r.flags|=524288}else Rs=Rs.next=a;return l}var vm=typeof AbortController<"u"?AbortController:function(){var r=[],a=this.signal={aborted:!1,addEventListener:function(l,f){r.push(f)}};this.abort=function(){a.aborted=!0,r.forEach(function(l){return l()})}},$f=e.unstable_scheduleCallback,ym=e.unstable_NormalPriority,Nr={$$typeof:D,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function Pc(){return{controller:new vm,data:new Map,refCount:0}}function wl(r){r.refCount--,r.refCount===0&&$f(ym,function(){r.controller.abort()})}var Ml=null,kc=0,Io=0,Po=null;function Bf(r,a){if(Ml===null){var l=Ml=[];kc=0,Io=rf(),Po={status:"pending",value:void 0,then:function(f){l.push(f)}}}return kc++,a.then(Lf,Lf),a}function Lf(){if(--kc===0&&Ml!==null){Po!==null&&(Po.status="fulfilled");var r=Ml;Ml=null,Io=0,Po=null;for(var a=0;a<r.length;a++)(0,r[a])()}}function bm(r,a){var l=[],f={status:"pending",value:null,reason:null,then:function(_){l.push(_)}};return r.then(function(){f.status="fulfilled",f.value=a;for(var _=0;_<l.length;_++)(0,l[_])(a)},function(_){for(f.status="rejected",f.reason=_,_=0;_<l.length;_++)(0,l[_])(void 0)}),f}var Yu=Q.S;Q.S=function(r,a){ap=pt(),typeof a=="object"&&a!==null&&typeof a.then=="function"&&Bf(r,a),Yu!==null&&Yu(r,a)};var Vi=j(null);function Ju(){var r=Vi.current;return r!==null?r:Zn.pooledCache}function xl(r,a){a===null?N(Vi,Vi.current):N(Vi,a.pool)}function Ff(){var r=Ju();return r===null?null:{parent:Nr._currentValue,pool:r}}var ko=Error(s(460)),Zu=Error(s(474)),Dc=Error(s(542)),El={then:function(){}};function zf(r){return r=r.status,r==="fulfilled"||r==="rejected"}function Nf(r,a,l){switch(l=r[l],l===void 0?r.push(a):l!==a&&(a.then(un,un),a=l),a.status){case"fulfilled":return a.value;case"rejected":throw r=a.reason,Rf(r),r;default:if(typeof a.status=="string")a.then(un,un);else{if(r=Zn,r!==null&&100<r.shellSuspendCounter)throw Error(s(482));r=a,r.status="pending",r.then(function(f){if(a.status==="pending"){var _=a;_.status="fulfilled",_.value=f}},function(f){if(a.status==="pending"){var _=a;_.status="rejected",_.reason=f}})}switch(a.status){case"fulfilled":return a.value;case"rejected":throw r=a.reason,Rf(r),r}throw Wi=a,ko}}function Gi(r){try{var a=r._init;return a(r._payload)}catch(l){throw l!==null&&typeof l=="object"&&typeof l.then=="function"?(Wi=l,ko):l}}var Wi=null;function ed(){if(Wi===null)throw Error(s(459));var r=Wi;return Wi=null,r}function Rf(r){if(r===ko||r===Dc)throw Error(s(483))}var Do=null,Tl=0;function Oc(r){var a=Tl;return Tl+=1,Do===null&&(Do=[]),Nf(Do,r,a)}function Oo(r,a){a=a.props.ref,r.ref=a!==void 0?a:null}function $c(r,a){throw a.$$typeof===m?Error(s(525)):(r=Object.prototype.toString.call(a),Error(s(31,r==="[object Object]"?"object with keys {"+Object.keys(a).join(", ")+"}":r)))}function jf(r){function a(ke,xe){if(r){var Le=ke.deletions;Le===null?(ke.deletions=[xe],ke.flags|=16):Le.push(xe)}}function l(ke,xe){if(!r)return null;for(;xe!==null;)a(ke,xe),xe=xe.sibling;return null}function f(ke){for(var xe=new Map;ke!==null;)ke.key!==null?xe.set(ke.key,ke):xe.set(ke.index,ke),ke=ke.sibling;return xe}function _(ke,xe){return ke=_s(ke,xe),ke.index=0,ke.sibling=null,ke}function w(ke,xe,Le){return ke.index=Le,r?(Le=ke.alternate,Le!==null?(Le=Le.index,Le<xe?(ke.flags|=67108866,xe):Le):(ke.flags|=67108866,xe)):(ke.flags|=1048576,xe)}function F(ke){return r&&ke.alternate===null&&(ke.flags|=67108866),ke}function re(ke,xe,Le,at){return xe===null||xe.tag!==6?(xe=Wu(Le,ke.mode,at),xe.return=ke,xe):(xe=_(xe,Le),xe.return=ke,xe)}function ye(ke,xe,Le,at){var Ht=Le.type;return Ht===T?tt(ke,xe,Le.props.children,at,Le.key):xe!==null&&(xe.elementType===Ht||typeof Ht=="object"&&Ht!==null&&Ht.$$typeof===k&&Gi(Ht)===xe.type)?(xe=_(xe,Le.props),Oo(xe,Le),xe.return=ke,xe):(xe=xc(Le.type,Le.key,Le.props,null,ke.mode,at),Oo(xe,Le),xe.return=ke,xe)}function Fe(ke,xe,Le,at){return xe===null||xe.tag!==4||xe.stateNode.containerInfo!==Le.containerInfo||xe.stateNode.implementation!==Le.implementation?(xe=Ec(Le,ke.mode,at),xe.return=ke,xe):(xe=_(xe,Le.children||[]),xe.return=ke,xe)}function tt(ke,xe,Le,at,Ht){return xe===null||xe.tag!==7?(xe=li(Le,ke.mode,at,Ht),xe.return=ke,xe):(xe=_(xe,Le),xe.return=ke,xe)}function st(ke,xe,Le){if(typeof xe=="string"&&xe!==""||typeof xe=="number"||typeof xe=="bigint")return xe=Wu(""+xe,ke.mode,Le),xe.return=ke,xe;if(typeof xe=="object"&&xe!==null){switch(xe.$$typeof){case y:return Le=xc(xe.type,xe.key,xe.props,null,ke.mode,Le),Oo(Le,xe),Le.return=ke,Le;case v:return xe=Ec(xe,ke.mode,Le),xe.return=ke,xe;case k:return xe=Gi(xe),st(ke,xe,Le)}if(ae(xe)||ee(xe))return xe=li(xe,ke.mode,Le,null),xe.return=ke,xe;if(typeof xe.then=="function")return st(ke,Oc(xe),Le);if(xe.$$typeof===D)return st(ke,bl(ke,xe),Le);$c(ke,xe)}return null}function je(ke,xe,Le,at){var Ht=xe!==null?xe.key:null;if(typeof Le=="string"&&Le!==""||typeof Le=="number"||typeof Le=="bigint")return Ht!==null?null:re(ke,xe,""+Le,at);if(typeof Le=="object"&&Le!==null){switch(Le.$$typeof){case y:return Le.key===Ht?ye(ke,xe,Le,at):null;case v:return Le.key===Ht?Fe(ke,xe,Le,at):null;case k:return Le=Gi(Le),je(ke,xe,Le,at)}if(ae(Le)||ee(Le))return Ht!==null?null:tt(ke,xe,Le,at,null);if(typeof Le.then=="function")return je(ke,xe,Oc(Le),at);if(Le.$$typeof===D)return je(ke,xe,bl(ke,Le),at);$c(ke,Le)}return null}function Qe(ke,xe,Le,at,Ht){if(typeof at=="string"&&at!==""||typeof at=="number"||typeof at=="bigint")return ke=ke.get(Le)||null,re(xe,ke,""+at,Ht);if(typeof at=="object"&&at!==null){switch(at.$$typeof){case y:return ke=ke.get(at.key===null?Le:at.key)||null,ye(xe,ke,at,Ht);case v:return ke=ke.get(at.key===null?Le:at.key)||null,Fe(xe,ke,at,Ht);case k:return at=Gi(at),Qe(ke,xe,Le,at,Ht)}if(ae(at)||ee(at))return ke=ke.get(Le)||null,tt(xe,ke,at,Ht,null);if(typeof at.then=="function")return Qe(ke,xe,Le,Oc(at),Ht);if(at.$$typeof===D)return Qe(ke,xe,Le,bl(xe,at),Ht);$c(xe,at)}return null}function Ot(ke,xe,Le,at){for(var Ht=null,jn=null,jt=xe,bn=xe=0,kn=null;jt!==null&&bn<Le.length;bn++){jt.index>bn?(kn=jt,jt=null):kn=jt.sibling;var Un=je(ke,jt,Le[bn],at);if(Un===null){jt===null&&(jt=kn);break}r&&jt&&Un.alternate===null&&a(ke,jt),xe=w(Un,xe,bn),jn===null?Ht=Un:jn.sibling=Un,jn=Un,jt=kn}if(bn===Le.length)return l(ke,jt),An&&bs(ke,bn),Ht;if(jt===null){for(;bn<Le.length;bn++)jt=st(ke,Le[bn],at),jt!==null&&(xe=w(jt,xe,bn),jn===null?Ht=jt:jn.sibling=jt,jn=jt);return An&&bs(ke,bn),Ht}for(jt=f(jt);bn<Le.length;bn++)kn=Qe(jt,ke,bn,Le[bn],at),kn!==null&&(r&&kn.alternate!==null&&jt.delete(kn.key===null?bn:kn.key),xe=w(kn,xe,bn),jn===null?Ht=kn:jn.sibling=kn,jn=kn);return r&&jt.forEach(function(rc){return a(ke,rc)}),An&&bs(ke,bn),Ht}function en(ke,xe,Le,at){if(Le==null)throw Error(s(151));for(var Ht=null,jn=null,jt=xe,bn=xe=0,kn=null,Un=Le.next();jt!==null&&!Un.done;bn++,Un=Le.next()){jt.index>bn?(kn=jt,jt=null):kn=jt.sibling;var rc=je(ke,jt,Un.value,at);if(rc===null){jt===null&&(jt=kn);break}r&&jt&&rc.alternate===null&&a(ke,jt),xe=w(rc,xe,bn),jn===null?Ht=rc:jn.sibling=rc,jn=rc,jt=kn}if(Un.done)return l(ke,jt),An&&bs(ke,bn),Ht;if(jt===null){for(;!Un.done;bn++,Un=Le.next())Un=st(ke,Un.value,at),Un!==null&&(xe=w(Un,xe,bn),jn===null?Ht=Un:jn.sibling=Un,jn=Un);return An&&bs(ke,bn),Ht}for(jt=f(jt);!Un.done;bn++,Un=Le.next())Un=Qe(jt,ke,bn,Un.value,at),Un!==null&&(r&&Un.alternate!==null&&jt.delete(Un.key===null?bn:Un.key),xe=w(Un,xe,bn),jn===null?Ht=Un:jn.sibling=Un,jn=Un);return r&&jt.forEach(function(SC){return a(ke,SC)}),An&&bs(ke,bn),Ht}function hr(ke,xe,Le,at){if(typeof Le=="object"&&Le!==null&&Le.type===T&&Le.key===null&&(Le=Le.props.children),typeof Le=="object"&&Le!==null){switch(Le.$$typeof){case y:e:{for(var Ht=Le.key;xe!==null;){if(xe.key===Ht){if(Ht=Le.type,Ht===T){if(xe.tag===7){l(ke,xe.sibling),at=_(xe,Le.props.children),at.return=ke,ke=at;break e}}else if(xe.elementType===Ht||typeof Ht=="object"&&Ht!==null&&Ht.$$typeof===k&&Gi(Ht)===xe.type){l(ke,xe.sibling),at=_(xe,Le.props),Oo(at,Le),at.return=ke,ke=at;break e}l(ke,xe);break}else a(ke,xe);xe=xe.sibling}Le.type===T?(at=li(Le.props.children,ke.mode,at,Le.key),at.return=ke,ke=at):(at=xc(Le.type,Le.key,Le.props,null,ke.mode,at),Oo(at,Le),at.return=ke,ke=at)}return F(ke);case v:e:{for(Ht=Le.key;xe!==null;){if(xe.key===Ht)if(xe.tag===4&&xe.stateNode.containerInfo===Le.containerInfo&&xe.stateNode.implementation===Le.implementation){l(ke,xe.sibling),at=_(xe,Le.children||[]),at.return=ke,ke=at;break e}else{l(ke,xe);break}else a(ke,xe);xe=xe.sibling}at=Ec(Le,ke.mode,at),at.return=ke,ke=at}return F(ke);case k:return Le=Gi(Le),hr(ke,xe,Le,at)}if(ae(Le))return Ot(ke,xe,Le,at);if(ee(Le)){if(Ht=ee(Le),typeof Ht!="function")throw Error(s(150));return Le=Ht.call(Le),en(ke,xe,Le,at)}if(typeof Le.then=="function")return hr(ke,xe,Oc(Le),at);if(Le.$$typeof===D)return hr(ke,xe,bl(ke,Le),at);$c(ke,Le)}return typeof Le=="string"&&Le!==""||typeof Le=="number"||typeof Le=="bigint"?(Le=""+Le,xe!==null&&xe.tag===6?(l(ke,xe.sibling),at=_(xe,Le),at.return=ke,ke=at):(l(ke,xe),at=Wu(Le,ke.mode,at),at.return=ke,ke=at),F(ke)):l(ke,xe)}return function(ke,xe,Le,at){try{Tl=0;var Ht=hr(ke,xe,Le,at);return Do=null,Ht}catch(jt){if(jt===ko||jt===Dc)throw jt;var jn=Oa(29,jt,null,ke.mode);return jn.lanes=at,jn.return=ke,jn}finally{}}}var Hi=jf(!0),Uf=jf(!1),Vs=!1;function td(r){r.updateQueue={baseState:r.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function nd(r,a){r=r.updateQueue,a.updateQueue===r&&(a.updateQueue={baseState:r.baseState,firstBaseUpdate:r.firstBaseUpdate,lastBaseUpdate:r.lastBaseUpdate,shared:r.shared,callbacks:null})}function Gs(r){return{lane:r,tag:0,payload:null,callback:null,next:null}}function fi(r,a,l){var f=r.updateQueue;if(f===null)return null;if(f=f.shared,($n&2)!==0){var _=f.pending;return _===null?a.next=a:(a.next=_.next,_.next=a),f.pending=a,a=Mc(r),Vu(r,null,l),a}return vl(r,f,a,l),Mc(r)}function Al(r,a,l){if(a=a.updateQueue,a!==null&&(a=a.shared,(l&4194048)!==0)){var f=a.lanes;f&=r.pendingLanes,l|=f,a.lanes=l,L(r,l)}}function Bc(r,a){var l=r.updateQueue,f=r.alternate;if(f!==null&&(f=f.updateQueue,l===f)){var _=null,w=null;if(l=l.firstBaseUpdate,l!==null){do{var F={lane:l.lane,tag:l.tag,payload:l.payload,callback:null,next:null};w===null?_=w=F:w=w.next=F,l=l.next}while(l!==null);w===null?_=w=a:w=w.next=a}else _=w=a;l={baseState:f.baseState,firstBaseUpdate:_,lastBaseUpdate:w,shared:f.shared,callbacks:f.callbacks},r.updateQueue=l;return}r=l.lastBaseUpdate,r===null?l.firstBaseUpdate=a:r.next=a,l.lastBaseUpdate=a}var rd=!1;function Cl(){if(rd){var r=Po;if(r!==null)throw r}}function $o(r,a,l,f){rd=!1;var _=r.updateQueue;Vs=!1;var w=_.firstBaseUpdate,F=_.lastBaseUpdate,re=_.shared.pending;if(re!==null){_.shared.pending=null;var ye=re,Fe=ye.next;ye.next=null,F===null?w=Fe:F.next=Fe,F=ye;var tt=r.alternate;tt!==null&&(tt=tt.updateQueue,re=tt.lastBaseUpdate,re!==F&&(re===null?tt.firstBaseUpdate=Fe:re.next=Fe,tt.lastBaseUpdate=ye))}if(w!==null){var st=_.baseState;F=0,tt=Fe=ye=null,re=w;do{var je=re.lane&-536870913,Qe=je!==re.lane;if(Qe?(xn&je)===je:(f&je)===je){je!==0&&je===Io&&(rd=!0),tt!==null&&(tt=tt.next={lane:0,tag:re.tag,payload:re.payload,callback:null,next:null});e:{var Ot=r,en=re;je=a;var hr=l;switch(en.tag){case 1:if(Ot=en.payload,typeof Ot=="function"){st=Ot.call(hr,st,je);break e}st=Ot;break e;case 3:Ot.flags=Ot.flags&-65537|128;case 0:if(Ot=en.payload,je=typeof Ot=="function"?Ot.call(hr,st,je):Ot,je==null)break e;st=p({},st,je);break e;case 2:Vs=!0}}je=re.callback,je!==null&&(r.flags|=64,Qe&&(r.flags|=8192),Qe=_.callbacks,Qe===null?_.callbacks=[je]:Qe.push(je))}else Qe={lane:je,tag:re.tag,payload:re.payload,callback:re.callback,next:null},tt===null?(Fe=tt=Qe,ye=st):tt=tt.next=Qe,F|=je;if(re=re.next,re===null){if(re=_.shared.pending,re===null)break;Qe=re,re=Qe.next,Qe.next=null,_.lastBaseUpdate=Qe,_.shared.pending=null}}while(!0);tt===null&&(ye=st),_.baseState=ye,_.firstBaseUpdate=Fe,_.lastBaseUpdate=tt,w===null&&(_.shared.lanes=0),Ts|=F,r.lanes=F,r.memoizedState=st}}function Vf(r,a){if(typeof r!="function")throw Error(s(191,r));r.call(a)}function Gf(r,a){var l=r.callbacks;if(l!==null)for(r.callbacks=null,r=0;r<l.length;r++)Vf(l[r],a)}var Qi=j(null),Lc=j(0);function Wf(r,a){r=Es,N(Lc,r),N(Qi,a),Es=r|a.baseLanes}function Sl(){N(Lc,Es),N(Qi,Qi.current)}function ad(){Es=Lc.current,U(Qi),U(Lc)}var Ba=j(null),La=null;function Ws(r){var a=r.alternate;N(vr,vr.current&1),N(Ba,r),La===null&&(a===null||Qi.current!==null||a.memoizedState!==null)&&(La=r)}function sd(r){N(vr,vr.current),N(Ba,r),La===null&&(La=r)}function id(r){r.tag===22?(N(vr,vr.current),N(Ba,r),La===null&&(La=r)):hi()}function hi(){N(vr,vr.current),N(Ba,Ba.current)}function Fa(r){U(Ba),La===r&&(La=null),U(vr)}var vr=j(0);function Il(r){for(var a=r;a!==null;){if(a.tag===13){var l=a.memoizedState;if(l!==null&&(l=l.dehydrated,l===null||ja(l)||Xl(l)))return a}else if(a.tag===19&&(a.memoizedProps.revealOrder==="forwards"||a.memoizedProps.revealOrder==="backwards"||a.memoizedProps.revealOrder==="unstable_legacy-backwards"||a.memoizedProps.revealOrder==="together")){if((a.flags&128)!==0)return a}else if(a.child!==null){a.child.return=a,a=a.child;continue}if(a===r)break;for(;a.sibling===null;){if(a.return===null||a.return===r)return null;a=a.return}a.sibling.return=a.return,a=a.sibling}return null}var Hs=0,fn=null,Hn=null,Or=null,Fc=!1,Bo=!1,qi=!1,Pl=0,kl=0,Lo=null,Hf=0;function Cr(){throw Error(s(321))}function od(r,a){if(a===null)return!1;for(var l=0;l<a.length&&l<r.length;l++)if(!sa(r[l],a[l]))return!1;return!0}function ld(r,a,l,f,_,w){return Hs=w,fn=a,a.memoizedState=null,a.updateQueue=null,a.lanes=0,Q.H=r===null||r.memoizedState===null?Th:Ad,qi=!1,w=l(f,_),qi=!1,Bo&&(w=Qf(a,l,f,_)),cd(r),w}function cd(r){Q.H=No;var a=Hn!==null&&Hn.next!==null;if(Hs=0,Or=Hn=fn=null,Fc=!1,kl=0,Lo=null,a)throw Error(s(300));r===null||Rr||(r=r.dependencies,r!==null&&Ic(r)&&(Rr=!0))}function Qf(r,a,l,f){fn=r;var _=0;do{if(Bo&&(Lo=null),kl=0,Bo=!1,25<=_)throw Error(s(301));if(_+=1,Or=Hn=null,r.updateQueue!=null){var w=r.updateQueue;w.lastEffect=null,w.events=null,w.stores=null,w.memoCache!=null&&(w.memoCache.index=0)}Q.H=Cd,w=a(l,f)}while(Bo);return w}function wm(){var r=Q.H,a=r.useState()[0];return a=typeof a.then=="function"?Ki(a):a,r=r.useState()[0],(Hn!==null?Hn.memoizedState:null)!==r&&(fn.flags|=1024),a}function zc(){var r=Pl!==0;return Pl=0,r}function ud(r,a,l){a.updateQueue=r.updateQueue,a.flags&=-2053,r.lanes&=~l}function dd(r){if(Fc){for(r=r.memoizedState;r!==null;){var a=r.queue;a!==null&&(a.pending=null),r=r.next}Fc=!1}Hs=0,Or=Hn=fn=null,Bo=!1,kl=Pl=0,Lo=null}function da(){var r={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Or===null?fn.memoizedState=Or=r:Or=Or.next=r,Or}function $r(){if(Hn===null){var r=fn.alternate;r=r!==null?r.memoizedState:null}else r=Hn.next;var a=Or===null?fn.memoizedState:Or.next;if(a!==null)Or=a,Hn=r;else{if(r===null)throw fn.alternate===null?Error(s(467)):Error(s(310));Hn=r,r={memoizedState:Hn.memoizedState,baseState:Hn.baseState,baseQueue:Hn.baseQueue,queue:Hn.queue,next:null},Or===null?fn.memoizedState=Or=r:Or=Or.next=r}return Or}function Nc(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function Ki(r){var a=kl;return kl+=1,Lo===null&&(Lo=[]),r=Nf(Lo,r,a),a=fn,(Or===null?a.memoizedState:Or.next)===null&&(a=a.alternate,Q.H=a===null||a.memoizedState===null?Th:Ad),r}function Rc(r){if(r!==null&&typeof r=="object"){if(typeof r.then=="function")return Ki(r);if(r.$$typeof===D)return oa(r)}throw Error(s(438,String(r)))}function fd(r){var a=null,l=fn.updateQueue;if(l!==null&&(a=l.memoCache),a==null){var f=fn.alternate;f!==null&&(f=f.updateQueue,f!==null&&(f=f.memoCache,f!=null&&(a={data:f.data.map(function(_){return _.slice()}),index:0})))}if(a==null&&(a={data:[],index:0}),l===null&&(l=Nc(),fn.updateQueue=l),l.memoCache=a,l=a.data[a.index],l===void 0)for(l=a.data[a.index]=Array(r),f=0;f<r;f++)l[f]=G;return a.index++,l}function Qs(r,a){return typeof a=="function"?a(r):a}function Dl(r){var a=$r();return hd(a,Hn,r)}function hd(r,a,l){var f=r.queue;if(f===null)throw Error(s(311));f.lastRenderedReducer=l;var _=r.baseQueue,w=f.pending;if(w!==null){if(_!==null){var F=_.next;_.next=w.next,w.next=F}a.baseQueue=_=w,f.pending=null}if(w=r.baseState,_===null)r.memoizedState=w;else{a=_.next;var re=F=null,ye=null,Fe=a,tt=!1;do{var st=Fe.lane&-536870913;if(st!==Fe.lane?(xn&st)===st:(Hs&st)===st){var je=Fe.revertLane;if(je===0)ye!==null&&(ye=ye.next={lane:0,revertLane:0,gesture:null,action:Fe.action,hasEagerState:Fe.hasEagerState,eagerState:Fe.eagerState,next:null}),st===Io&&(tt=!0);else if((Hs&je)===je){Fe=Fe.next,je===Io&&(tt=!0);continue}else st={lane:0,revertLane:Fe.revertLane,gesture:null,action:Fe.action,hasEagerState:Fe.hasEagerState,eagerState:Fe.eagerState,next:null},ye===null?(re=ye=st,F=w):ye=ye.next=st,fn.lanes|=je,Ts|=je;st=Fe.action,qi&&l(w,st),w=Fe.hasEagerState?Fe.eagerState:l(w,st)}else je={lane:st,revertLane:Fe.revertLane,gesture:Fe.gesture,action:Fe.action,hasEagerState:Fe.hasEagerState,eagerState:Fe.eagerState,next:null},ye===null?(re=ye=je,F=w):ye=ye.next=je,fn.lanes|=st,Ts|=st;Fe=Fe.next}while(Fe!==null&&Fe!==a);if(ye===null?F=w:ye.next=re,!sa(w,r.memoizedState)&&(Rr=!0,tt&&(l=Po,l!==null)))throw l;r.memoizedState=w,r.baseState=F,r.baseQueue=ye,f.lastRenderedState=w}return _===null&&(f.lanes=0),[r.memoizedState,f.dispatch]}function pd(r){var a=$r(),l=a.queue;if(l===null)throw Error(s(311));l.lastRenderedReducer=r;var f=l.dispatch,_=l.pending,w=a.memoizedState;if(_!==null){l.pending=null;var F=_=_.next;do w=r(w,F.action),F=F.next;while(F!==_);sa(w,a.memoizedState)||(Rr=!0),a.memoizedState=w,a.baseQueue===null&&(a.baseState=w),l.lastRenderedState=w}return[w,f]}function md(r,a,l){var f=fn,_=$r(),w=An;if(w){if(l===void 0)throw Error(s(407));l=l()}else l=a();var F=!sa((Hn||_).memoizedState,l);if(F&&(_.memoizedState=l,Rr=!0),_=_.queue,yd(Xf.bind(null,f,_,r),[r]),_.getSnapshot!==a||F||Or!==null&&Or.memoizedState.tag&1){if(f.flags|=2048,Fo(9,{destroy:void 0},Kf.bind(null,f,_,l,a),null),Zn===null)throw Error(s(349));w||(Hs&127)!==0||qf(f,a,l)}return l}function qf(r,a,l){r.flags|=16384,r={getSnapshot:a,value:l},a=fn.updateQueue,a===null?(a=Nc(),fn.updateQueue=a,a.stores=[r]):(l=a.stores,l===null?a.stores=[r]:l.push(r))}function Kf(r,a,l,f){a.value=l,a.getSnapshot=f,Yf(a)&&jc(r)}function Xf(r,a,l){return l(function(){Yf(a)&&jc(r)})}function Yf(r){var a=r.getSnapshot;r=r.value;try{var l=a();return!sa(r,l)}catch{return!0}}function jc(r){var a=Ni(r,2);a!==null&&Aa(a,r,2)}function gd(r){var a=da();if(typeof r=="function"){var l=r;if(r=l(),qi){Fn(!0);try{l()}finally{Fn(!1)}}}return a.memoizedState=a.baseState=r,a.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Qs,lastRenderedState:r},a}function Jf(r,a,l,f){return r.baseState=l,hd(r,Hn,typeof f=="function"?f:Qs)}function Mm(r,a,l,f,_){if(zo(r))throw Error(s(485));if(r=a.action,r!==null){var w={payload:_,action:r,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(F){w.listeners.push(F)}};Q.T!==null?l(!0):w.isTransition=!1,f(w),l=a.pending,l===null?(w.next=a.pending=w,Zf(a,w)):(w.next=l.next,a.pending=l.next=w)}}function Zf(r,a){var l=a.action,f=a.payload,_=r.state;if(a.isTransition){var w=Q.T,F={};Q.T=F;try{var re=l(_,f),ye=Q.S;ye!==null&&ye(F,re),eh(r,a,re)}catch(Fe){_d(r,a,Fe)}finally{w!==null&&F.types!==null&&(w.types=F.types),Q.T=w}}else try{w=l(_,f),eh(r,a,w)}catch(Fe){_d(r,a,Fe)}}function eh(r,a,l){l!==null&&typeof l=="object"&&typeof l.then=="function"?l.then(function(f){th(r,a,f)},function(f){return _d(r,a,f)}):th(r,a,l)}function th(r,a,l){a.status="fulfilled",a.value=l,nh(a),r.state=l,a=r.pending,a!==null&&(l=a.next,l===a?r.pending=null:(l=l.next,a.next=l,Zf(r,l)))}function _d(r,a,l){var f=r.pending;if(r.pending=null,f!==null){f=f.next;do a.status="rejected",a.reason=l,nh(a),a=a.next;while(a!==f)}r.action=null}function nh(r){r=r.listeners;for(var a=0;a<r.length;a++)(0,r[a])()}function rh(r,a){return a}function vd(r,a){if(An){var l=Zn.formState;if(l!==null){e:{var f=fn;if(An){if(ar){t:{for(var _=ar,w=$a;_.nodeType!==8;){if(!w){_=null;break t}if(_=Ca(_.nextSibling),_===null){_=null;break t}}w=_.data,_=w==="F!"||w==="F"?_:null}if(_){ar=Ca(_.nextSibling),f=_.data==="F!";break e}}ui(f)}f=!1}f&&(a=l[0])}}return l=da(),l.memoizedState=l.baseState=a,f={pending:null,lanes:0,dispatch:null,lastRenderedReducer:rh,lastRenderedState:a},l.queue=f,l=Mh.bind(null,fn,f),f.dispatch=l,f=gd(!1),w=Td.bind(null,fn,!1,f.queue),f=da(),_={state:a,dispatch:null,action:r,pending:null},f.queue=_,l=Mm.bind(null,fn,_,w,l),_.dispatch=l,f.memoizedState=r,[a,l,!1]}function ah(r){var a=$r();return sh(a,Hn,r)}function sh(r,a,l){if(a=hd(r,a,rh)[0],r=Dl(Qs)[0],typeof a=="object"&&a!==null&&typeof a.then=="function")try{var f=Ki(a)}catch(F){throw F===ko?Dc:F}else f=a;a=$r();var _=a.queue,w=_.dispatch;return l!==a.memoizedState&&(fn.flags|=2048,Fo(9,{destroy:void 0},ih.bind(null,_,l),null)),[f,w,r]}function ih(r,a){r.action=a}function oh(r){var a=$r(),l=Hn;if(l!==null)return sh(a,l,r);$r(),a=a.memoizedState,l=$r();var f=l.queue.dispatch;return l.memoizedState=r,[a,f,!1]}function Fo(r,a,l,f){return r={tag:r,create:l,deps:f,inst:a,next:null},a=fn.updateQueue,a===null&&(a=Nc(),fn.updateQueue=a),l=a.lastEffect,l===null?a.lastEffect=r.next=r:(f=l.next,l.next=r,r.next=f,a.lastEffect=r),r}function lh(){return $r().memoizedState}function Uc(r,a,l,f){var _=da();fn.flags|=r,_.memoizedState=Fo(1|a,{destroy:void 0},l,f===void 0?null:f)}function Ol(r,a,l,f){var _=$r();f=f===void 0?null:f;var w=_.memoizedState.inst;Hn!==null&&f!==null&&od(f,Hn.memoizedState.deps)?_.memoizedState=Fo(a,w,l,f):(fn.flags|=r,_.memoizedState=Fo(1|a,w,l,f))}function ch(r,a){Uc(8390656,8,r,a)}function yd(r,a){Ol(2048,8,r,a)}function uh(r){fn.flags|=4;var a=fn.updateQueue;if(a===null)a=Nc(),fn.updateQueue=a,a.events=[r];else{var l=a.events;l===null?a.events=[r]:l.push(r)}}function dh(r){var a=$r().memoizedState;return uh({ref:a,nextImpl:r}),function(){if(($n&2)!==0)throw Error(s(440));return a.impl.apply(void 0,arguments)}}function fh(r,a){return Ol(4,2,r,a)}function bd(r,a){return Ol(4,4,r,a)}function hh(r,a){if(typeof a=="function"){r=r();var l=a(r);return function(){typeof l=="function"?l():a(null)}}if(a!=null)return r=r(),a.current=r,function(){a.current=null}}function ph(r,a,l){l=l!=null?l.concat([r]):null,Ol(4,4,hh.bind(null,a,r),l)}function Vc(){}function mh(r,a){var l=$r();a=a===void 0?null:a;var f=l.memoizedState;return a!==null&&od(a,f[1])?f[0]:(l.memoizedState=[r,a],r)}function gh(r,a){var l=$r();a=a===void 0?null:a;var f=l.memoizedState;if(a!==null&&od(a,f[1]))return f[0];if(f=r(),qi){Fn(!0);try{r()}finally{Fn(!1)}}return l.memoizedState=[f,a],f}function wd(r,a,l){return l===void 0||(Hs&1073741824)!==0&&(xn&261930)===0?r.memoizedState=a:(r.memoizedState=l,r=op(),fn.lanes|=r,Ts|=r,l)}function _h(r,a,l,f){return sa(l,a)?l:Qi.current!==null?(r=wd(r,l,f),sa(r,a)||(Rr=!0),r):(Hs&42)===0||(Hs&1073741824)!==0&&(xn&261930)===0?(Rr=!0,r.memoizedState=l):(r=op(),fn.lanes|=r,Ts|=r,a)}function vh(r,a,l,f,_){var w=ne.p;ne.p=w!==0&&8>w?w:8;var F=Q.T,re={};Q.T=re,Td(r,!1,a,l);try{var ye=_(),Fe=Q.S;if(Fe!==null&&Fe(re,ye),ye!==null&&typeof ye=="object"&&typeof ye.then=="function"){var tt=bm(ye,f);$l(r,a,tt,Ra(r))}else $l(r,a,f,Ra(r))}catch(st){$l(r,a,{then:function(){},status:"rejected",reason:st},Ra())}finally{ne.p=w,F!==null&&re.types!==null&&(F.types=re.types),Q.T=F}}function xm(){}function Md(r,a,l,f){if(r.tag!==5)throw Error(s(476));var _=yh(r).queue;vh(r,_,a,de,l===null?xm:function(){return xd(r),l(f)})}function yh(r){var a=r.memoizedState;if(a!==null)return a;a={memoizedState:de,baseState:de,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Qs,lastRenderedState:de},next:null};var l={};return a.next={memoizedState:l,baseState:l,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Qs,lastRenderedState:l},next:null},r.memoizedState=a,r=r.alternate,r!==null&&(r.memoizedState=a),a}function xd(r){var a=yh(r);a.next===null&&(a=r.alternate.memoizedState),$l(r,a.next.queue,{},Ra())}function Ed(){return oa(zp)}function bh(){return $r().memoizedState}function wh(){return $r().memoizedState}function Em(r){for(var a=r.return;a!==null;){switch(a.tag){case 24:case 3:var l=Ra();r=Gs(l);var f=fi(a,r,l);f!==null&&(Aa(f,a,l),Al(f,a,l)),a={cache:Pc()},r.payload=a;return}a=a.return}}function Tm(r,a,l){var f=Ra();l={lane:f,revertLane:0,gesture:null,action:l,hasEagerState:!1,eagerState:null,next:null},zo(r)?xh(a,l):(l=Uu(r,a,l,f),l!==null&&(Aa(l,r,f),Eh(l,a,f)))}function Mh(r,a,l){var f=Ra();$l(r,a,l,f)}function $l(r,a,l,f){var _={lane:f,revertLane:0,gesture:null,action:l,hasEagerState:!1,eagerState:null,next:null};if(zo(r))xh(a,_);else{var w=r.alternate;if(r.lanes===0&&(w===null||w.lanes===0)&&(w=a.lastRenderedReducer,w!==null))try{var F=a.lastRenderedState,re=w(F,l);if(_.hasEagerState=!0,_.eagerState=re,sa(re,F))return vl(r,a,_,0),Zn===null&&xo(),!1}catch{}finally{}if(l=Uu(r,a,_,f),l!==null)return Aa(l,r,f),Eh(l,a,f),!0}return!1}function Td(r,a,l,f){if(f={lane:2,revertLane:rf(),gesture:null,action:f,hasEagerState:!1,eagerState:null,next:null},zo(r)){if(a)throw Error(s(479))}else a=Uu(r,l,f,2),a!==null&&Aa(a,r,2)}function zo(r){var a=r.alternate;return r===fn||a!==null&&a===fn}function xh(r,a){Bo=Fc=!0;var l=r.pending;l===null?a.next=a:(a.next=l.next,l.next=a),r.pending=a}function Eh(r,a,l){if((l&4194048)!==0){var f=a.lanes;f&=r.pendingLanes,l|=f,a.lanes=l,L(r,l)}}var No={readContext:oa,use:Rc,useCallback:Cr,useContext:Cr,useEffect:Cr,useImperativeHandle:Cr,useLayoutEffect:Cr,useInsertionEffect:Cr,useMemo:Cr,useReducer:Cr,useRef:Cr,useState:Cr,useDebugValue:Cr,useDeferredValue:Cr,useTransition:Cr,useSyncExternalStore:Cr,useId:Cr,useHostTransitionStatus:Cr,useFormState:Cr,useActionState:Cr,useOptimistic:Cr,useMemoCache:Cr,useCacheRefresh:Cr};No.useEffectEvent=Cr;var Th={readContext:oa,use:Rc,useCallback:function(r,a){return da().memoizedState=[r,a===void 0?null:a],r},useContext:oa,useEffect:ch,useImperativeHandle:function(r,a,l){l=l!=null?l.concat([r]):null,Uc(4194308,4,hh.bind(null,a,r),l)},useLayoutEffect:function(r,a){return Uc(4194308,4,r,a)},useInsertionEffect:function(r,a){Uc(4,2,r,a)},useMemo:function(r,a){var l=da();a=a===void 0?null:a;var f=r();if(qi){Fn(!0);try{r()}finally{Fn(!1)}}return l.memoizedState=[f,a],f},useReducer:function(r,a,l){var f=da();if(l!==void 0){var _=l(a);if(qi){Fn(!0);try{l(a)}finally{Fn(!1)}}}else _=a;return f.memoizedState=f.baseState=_,r={pending:null,lanes:0,dispatch:null,lastRenderedReducer:r,lastRenderedState:_},f.queue=r,r=r.dispatch=Tm.bind(null,fn,r),[f.memoizedState,r]},useRef:function(r){var a=da();return r={current:r},a.memoizedState=r},useState:function(r){r=gd(r);var a=r.queue,l=Mh.bind(null,fn,a);return a.dispatch=l,[r.memoizedState,l]},useDebugValue:Vc,useDeferredValue:function(r,a){var l=da();return wd(l,r,a)},useTransition:function(){var r=gd(!1);return r=vh.bind(null,fn,r.queue,!0,!1),da().memoizedState=r,[!1,r]},useSyncExternalStore:function(r,a,l){var f=fn,_=da();if(An){if(l===void 0)throw Error(s(407));l=l()}else{if(l=a(),Zn===null)throw Error(s(349));(xn&127)!==0||qf(f,a,l)}_.memoizedState=l;var w={value:l,getSnapshot:a};return _.queue=w,ch(Xf.bind(null,f,w,r),[r]),f.flags|=2048,Fo(9,{destroy:void 0},Kf.bind(null,f,w,l,a),null),l},useId:function(){var r=da(),a=Zn.identifierPrefix;if(An){var l=ys,f=vs;l=(f&~(1<<32-tn(f)-1)).toString(32)+l,a="_"+a+"R_"+l,l=Pl++,0<l&&(a+="H"+l.toString(32)),a+="_"}else l=Hf++,a="_"+a+"r_"+l.toString(32)+"_";return r.memoizedState=a},useHostTransitionStatus:Ed,useFormState:vd,useActionState:vd,useOptimistic:function(r){var a=da();a.memoizedState=a.baseState=r;var l={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return a.queue=l,a=Td.bind(null,fn,!0,l),l.dispatch=a,[r,a]},useMemoCache:fd,useCacheRefresh:function(){return da().memoizedState=Em.bind(null,fn)},useEffectEvent:function(r){var a=da(),l={impl:r};return a.memoizedState=l,function(){if(($n&2)!==0)throw Error(s(440));return l.impl.apply(void 0,arguments)}}},Ad={readContext:oa,use:Rc,useCallback:mh,useContext:oa,useEffect:yd,useImperativeHandle:ph,useInsertionEffect:fh,useLayoutEffect:bd,useMemo:gh,useReducer:Dl,useRef:lh,useState:function(){return Dl(Qs)},useDebugValue:Vc,useDeferredValue:function(r,a){var l=$r();return _h(l,Hn.memoizedState,r,a)},useTransition:function(){var r=Dl(Qs)[0],a=$r().memoizedState;return[typeof r=="boolean"?r:Ki(r),a]},useSyncExternalStore:md,useId:bh,useHostTransitionStatus:Ed,useFormState:ah,useActionState:ah,useOptimistic:function(r,a){var l=$r();return Jf(l,Hn,r,a)},useMemoCache:fd,useCacheRefresh:wh};Ad.useEffectEvent=dh;var Cd={readContext:oa,use:Rc,useCallback:mh,useContext:oa,useEffect:yd,useImperativeHandle:ph,useInsertionEffect:fh,useLayoutEffect:bd,useMemo:gh,useReducer:pd,useRef:lh,useState:function(){return pd(Qs)},useDebugValue:Vc,useDeferredValue:function(r,a){var l=$r();return Hn===null?wd(l,r,a):_h(l,Hn.memoizedState,r,a)},useTransition:function(){var r=pd(Qs)[0],a=$r().memoizedState;return[typeof r=="boolean"?r:Ki(r),a]},useSyncExternalStore:md,useId:bh,useHostTransitionStatus:Ed,useFormState:oh,useActionState:oh,useOptimistic:function(r,a){var l=$r();return Hn!==null?Jf(l,Hn,r,a):(l.baseState=r,[r,l.queue.dispatch])},useMemoCache:fd,useCacheRefresh:wh};Cd.useEffectEvent=dh;function Sd(r,a,l,f){a=r.memoizedState,l=l(f,a),l=l==null?a:p({},a,l),r.memoizedState=l,r.lanes===0&&(r.updateQueue.baseState=l)}var Id={enqueueSetState:function(r,a,l){r=r._reactInternals;var f=Ra(),_=Gs(f);_.payload=a,l!=null&&(_.callback=l),a=fi(r,_,f),a!==null&&(Aa(a,r,f),Al(a,r,f))},enqueueReplaceState:function(r,a,l){r=r._reactInternals;var f=Ra(),_=Gs(f);_.tag=1,_.payload=a,l!=null&&(_.callback=l),a=fi(r,_,f),a!==null&&(Aa(a,r,f),Al(a,r,f))},enqueueForceUpdate:function(r,a){r=r._reactInternals;var l=Ra(),f=Gs(l);f.tag=2,a!=null&&(f.callback=a),a=fi(r,f,l),a!==null&&(Aa(a,r,l),Al(a,r,l))}};function pi(r,a,l,f,_,w,F){return r=r.stateNode,typeof r.shouldComponentUpdate=="function"?r.shouldComponentUpdate(f,w,F):a.prototype&&a.prototype.isPureReactComponent?!Fs(l,f)||!Fs(_,w):!0}function Ah(r,a,l,f){r=a.state,typeof a.componentWillReceiveProps=="function"&&a.componentWillReceiveProps(l,f),typeof a.UNSAFE_componentWillReceiveProps=="function"&&a.UNSAFE_componentWillReceiveProps(l,f),a.state!==r&&Id.enqueueReplaceState(a,a.state,null)}function Xi(r,a){var l=a;if("ref"in a){l={};for(var f in a)f!=="ref"&&(l[f]=a[f])}if(r=r.defaultProps){l===a&&(l=p({},l));for(var _ in r)l[_]===void 0&&(l[_]=r[_])}return l}function Ch(r){_n(r)}function Sh(r){console.error(r)}function Ih(r){_n(r)}function Gc(r,a){try{var l=r.onUncaughtError;l(a.value,{componentStack:a.stack})}catch(f){setTimeout(function(){throw f})}}function Pd(r,a,l){try{var f=r.onCaughtError;f(l.value,{componentStack:l.stack,errorBoundary:a.tag===1?a.stateNode:null})}catch(_){setTimeout(function(){throw _})}}function kd(r,a,l){return l=Gs(l),l.tag=3,l.payload={element:null},l.callback=function(){Gc(r,a)},l}function Ph(r){return r=Gs(r),r.tag=3,r}function kh(r,a,l,f){var _=l.type.getDerivedStateFromError;if(typeof _=="function"){var w=f.value;r.payload=function(){return _(w)},r.callback=function(){Pd(a,l,f)}}var F=l.stateNode;F!==null&&typeof F.componentDidCatch=="function"&&(r.callback=function(){Pd(a,l,f),typeof _!="function"&&(As===null?As=new Set([this]):As.add(this));var re=f.stack;this.componentDidCatch(f.value,{componentStack:re!==null?re:""})})}function Am(r,a,l,f,_){if(l.flags|=32768,f!==null&&typeof f=="object"&&typeof f.then=="function"){if(a=l.alternate,a!==null&&So(a,l,_,!0),l=Ba.current,l!==null){switch(l.tag){case 31:case 13:return La===null?au():l.alternate===null&&Sr===0&&(Sr=3),l.flags&=-257,l.flags|=65536,l.lanes=_,f===El?l.flags|=16384:(a=l.updateQueue,a===null?l.updateQueue=new Set([f]):a.add(f),ef(r,f,_)),!1;case 22:return l.flags|=65536,f===El?l.flags|=16384:(a=l.updateQueue,a===null?(a={transitions:null,markerInstances:null,retryQueue:new Set([f])},l.updateQueue=a):(l=a.retryQueue,l===null?a.retryQueue=new Set([f]):l.add(f)),ef(r,f,_)),!1}throw Error(s(435,l.tag))}return ef(r,f,_),au(),!1}if(An)return a=Ba.current,a!==null?((a.flags&65536)===0&&(a.flags|=256),a.flags|=65536,a.lanes=_,f!==Qu&&(r=Error(s(422),{cause:f}),yl(Ya(r,l)))):(f!==Qu&&(a=Error(s(423),{cause:f}),yl(Ya(a,l))),r=r.current.alternate,r.flags|=65536,_&=-_,r.lanes|=_,f=Ya(f,l),_=kd(r.stateNode,f,_),Bc(r,_),Sr!==4&&(Sr=2)),!1;var w=Error(s(520),{cause:f});if(w=Ya(w,l),Hl===null?Hl=[w]:Hl.push(w),Sr!==4&&(Sr=2),a===null)return!0;f=Ya(f,l),l=a;do{switch(l.tag){case 3:return l.flags|=65536,r=_&-_,l.lanes|=r,r=kd(l.stateNode,f,r),Bc(l,r),!1;case 1:if(a=l.type,w=l.stateNode,(l.flags&128)===0&&(typeof a.getDerivedStateFromError=="function"||w!==null&&typeof w.componentDidCatch=="function"&&(As===null||!As.has(w))))return l.flags|=65536,_&=-_,l.lanes|=_,_=Ph(_),kh(_,r,l,f),Bc(l,_),!1}l=l.return}while(l!==null);return!1}var Bl=Error(s(461)),Rr=!1;function la(r,a,l,f){a.child=r===null?Uf(a,null,l,f):Hi(a,r.child,l,f)}function Dh(r,a,l,f,_){l=l.render;var w=a.ref;if("ref"in f){var F={};for(var re in f)re!=="ref"&&(F[re]=f[re])}else F=f;return Ui(a),f=ld(r,a,l,F,w,_),re=zc(),r!==null&&!Rr?(ud(r,a,_),qs(r,a,_)):(An&&re&&Hu(a),a.flags|=1,la(r,a,f,_),a.child)}function Ll(r,a,l,f,_){if(r===null){var w=l.type;return typeof w=="function"&&!Gu(w)&&w.defaultProps===void 0&&l.compare===null?(a.tag=15,a.type=w,Oh(r,a,w,f,_)):(r=xc(l.type,null,f,a,a.mode,_),r.ref=a.ref,r.return=a,a.child=r)}if(w=r.child,!Ld(r,_)){var F=w.memoizedProps;if(l=l.compare,l=l!==null?l:Fs,l(F,f)&&r.ref===a.ref)return qs(r,a,_)}return a.flags|=1,r=_s(w,f),r.ref=a.ref,r.return=a,a.child=r}function Oh(r,a,l,f,_){if(r!==null){var w=r.memoizedProps;if(Fs(w,f)&&r.ref===a.ref)if(Rr=!1,a.pendingProps=f=w,Ld(r,_))(r.flags&131072)!==0&&(Rr=!0);else return a.lanes=r.lanes,qs(r,a,_)}return Fh(r,a,l,f,_)}function $h(r,a,l,f){var _=f.children,w=r!==null?r.memoizedState:null;if(r===null&&a.stateNode===null&&(a.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),f.mode==="hidden"){if((a.flags&128)!==0){if(w=w!==null?w.baseLanes|l:l,r!==null){for(f=a.child=r.child,_=0;f!==null;)_=_|f.lanes|f.childLanes,f=f.sibling;f=_&~w}else f=0,a.child=null;return Bh(r,a,w,l,f)}if((l&536870912)!==0)a.memoizedState={baseLanes:0,cachePool:null},r!==null&&xl(a,w!==null?w.cachePool:null),w!==null?Wf(a,w):Sl(),id(a);else return f=a.lanes=536870912,Bh(r,a,w!==null?w.baseLanes|l:l,l,f)}else w!==null?(xl(a,w.cachePool),Wf(a,w),hi(),a.memoizedState=null):(r!==null&&xl(a,null),Sl(),hi());return la(r,a,_,l),a.child}function Fl(r,a){return r!==null&&r.tag===22||a.stateNode!==null||(a.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),a.sibling}function Bh(r,a,l,f,_){var w=Ju();return w=w===null?null:{parent:Nr._currentValue,pool:w},a.memoizedState={baseLanes:l,cachePool:w},r!==null&&xl(a,null),Sl(),id(a),r!==null&&So(r,a,f,!0),a.childLanes=_,null}function Ro(r,a){return a=Hc({mode:a.mode,children:a.children},r.mode),a.ref=r.ref,r.child=a,a.return=r,a}function Lh(r,a,l){return Hi(a,r.child,null,l),r=Ro(a,a.pendingProps),r.flags|=2,Fa(a),a.memoizedState=null,r}function Cm(r,a,l){var f=a.pendingProps,_=(a.flags&128)!==0;if(a.flags&=-129,r===null){if(An){if(f.mode==="hidden")return r=Ro(a,f),a.lanes=536870912,Fl(null,r);if(sd(a),(r=ar)?(r=ba(r,$a),r=r!==null&&r.data==="&"?r:null,r!==null&&(a.memoizedState={dehydrated:r,treeContext:Ns!==null?{id:vs,overflow:ys}:null,retryLane:536870912,hydrationErrors:null},l=Sf(r),l.return=a,a.child=l,ia=a,ar=null)):r=null,r===null)throw ui(a);return a.lanes=536870912,null}return Ro(a,f)}var w=r.memoizedState;if(w!==null){var F=w.dehydrated;if(sd(a),_)if(a.flags&256)a.flags&=-257,a=Lh(r,a,l);else if(a.memoizedState!==null)a.child=r.child,a.flags|=128,a=null;else throw Error(s(558));else if(Rr||So(r,a,l,!1),_=(l&r.childLanes)!==0,Rr||_){if(f=Zn,f!==null&&(F=ue(f,l),F!==0&&F!==w.retryLane))throw w.retryLane=F,Ni(r,F),Aa(f,r,F),Bl;au(),a=Lh(r,a,l)}else r=w.treeContext,ar=Ca(F.nextSibling),ia=a,An=!0,ci=null,$a=!1,r!==null&&kf(a,r),a=Ro(a,f),a.flags|=4096;return a}return r=_s(r.child,{mode:f.mode,children:f.children}),r.ref=a.ref,a.child=r,r.return=a,r}function Wc(r,a){var l=a.ref;if(l===null)r!==null&&r.ref!==null&&(a.flags|=4194816);else{if(typeof l!="function"&&typeof l!="object")throw Error(s(284));(r===null||r.ref!==l)&&(a.flags|=4194816)}}function Fh(r,a,l,f,_){return Ui(a),l=ld(r,a,l,f,void 0,_),f=zc(),r!==null&&!Rr?(ud(r,a,_),qs(r,a,_)):(An&&f&&Hu(a),a.flags|=1,la(r,a,l,_),a.child)}function zh(r,a,l,f,_,w){return Ui(a),a.updateQueue=null,l=Qf(a,f,l,_),cd(r),f=zc(),r!==null&&!Rr?(ud(r,a,w),qs(r,a,w)):(An&&f&&Hu(a),a.flags|=1,la(r,a,l,w),a.child)}function Nh(r,a,l,f,_){if(Ui(a),a.stateNode===null){var w=Eo,F=l.contextType;typeof F=="object"&&F!==null&&(w=oa(F)),w=new l(f,w),a.memoizedState=w.state!==null&&w.state!==void 0?w.state:null,w.updater=Id,a.stateNode=w,w._reactInternals=a,w=a.stateNode,w.props=f,w.state=a.memoizedState,w.refs={},td(a),F=l.contextType,w.context=typeof F=="object"&&F!==null?oa(F):Eo,w.state=a.memoizedState,F=l.getDerivedStateFromProps,typeof F=="function"&&(Sd(a,l,F,f),w.state=a.memoizedState),typeof l.getDerivedStateFromProps=="function"||typeof w.getSnapshotBeforeUpdate=="function"||typeof w.UNSAFE_componentWillMount!="function"&&typeof w.componentWillMount!="function"||(F=w.state,typeof w.componentWillMount=="function"&&w.componentWillMount(),typeof w.UNSAFE_componentWillMount=="function"&&w.UNSAFE_componentWillMount(),F!==w.state&&Id.enqueueReplaceState(w,w.state,null),$o(a,f,w,_),Cl(),w.state=a.memoizedState),typeof w.componentDidMount=="function"&&(a.flags|=4194308),f=!0}else if(r===null){w=a.stateNode;var re=a.memoizedProps,ye=Xi(l,re);w.props=ye;var Fe=w.context,tt=l.contextType;F=Eo,typeof tt=="object"&&tt!==null&&(F=oa(tt));var st=l.getDerivedStateFromProps;tt=typeof st=="function"||typeof w.getSnapshotBeforeUpdate=="function",re=a.pendingProps!==re,tt||typeof w.UNSAFE_componentWillReceiveProps!="function"&&typeof w.componentWillReceiveProps!="function"||(re||Fe!==F)&&Ah(a,w,f,F),Vs=!1;var je=a.memoizedState;w.state=je,$o(a,f,w,_),Cl(),Fe=a.memoizedState,re||je!==Fe||Vs?(typeof st=="function"&&(Sd(a,l,st,f),Fe=a.memoizedState),(ye=Vs||pi(a,l,ye,f,je,Fe,F))?(tt||typeof w.UNSAFE_componentWillMount!="function"&&typeof w.componentWillMount!="function"||(typeof w.componentWillMount=="function"&&w.componentWillMount(),typeof w.UNSAFE_componentWillMount=="function"&&w.UNSAFE_componentWillMount()),typeof w.componentDidMount=="function"&&(a.flags|=4194308)):(typeof w.componentDidMount=="function"&&(a.flags|=4194308),a.memoizedProps=f,a.memoizedState=Fe),w.props=f,w.state=Fe,w.context=F,f=ye):(typeof w.componentDidMount=="function"&&(a.flags|=4194308),f=!1)}else{w=a.stateNode,nd(r,a),F=a.memoizedProps,tt=Xi(l,F),w.props=tt,st=a.pendingProps,je=w.context,Fe=l.contextType,ye=Eo,typeof Fe=="object"&&Fe!==null&&(ye=oa(Fe)),re=l.getDerivedStateFromProps,(Fe=typeof re=="function"||typeof w.getSnapshotBeforeUpdate=="function")||typeof w.UNSAFE_componentWillReceiveProps!="function"&&typeof w.componentWillReceiveProps!="function"||(F!==st||je!==ye)&&Ah(a,w,f,ye),Vs=!1,je=a.memoizedState,w.state=je,$o(a,f,w,_),Cl();var Qe=a.memoizedState;F!==st||je!==Qe||Vs||r!==null&&r.dependencies!==null&&Ic(r.dependencies)?(typeof re=="function"&&(Sd(a,l,re,f),Qe=a.memoizedState),(tt=Vs||pi(a,l,tt,f,je,Qe,ye)||r!==null&&r.dependencies!==null&&Ic(r.dependencies))?(Fe||typeof w.UNSAFE_componentWillUpdate!="function"&&typeof w.componentWillUpdate!="function"||(typeof w.componentWillUpdate=="function"&&w.componentWillUpdate(f,Qe,ye),typeof w.UNSAFE_componentWillUpdate=="function"&&w.UNSAFE_componentWillUpdate(f,Qe,ye)),typeof w.componentDidUpdate=="function"&&(a.flags|=4),typeof w.getSnapshotBeforeUpdate=="function"&&(a.flags|=1024)):(typeof w.componentDidUpdate!="function"||F===r.memoizedProps&&je===r.memoizedState||(a.flags|=4),typeof w.getSnapshotBeforeUpdate!="function"||F===r.memoizedProps&&je===r.memoizedState||(a.flags|=1024),a.memoizedProps=f,a.memoizedState=Qe),w.props=f,w.state=Qe,w.context=ye,f=tt):(typeof w.componentDidUpdate!="function"||F===r.memoizedProps&&je===r.memoizedState||(a.flags|=4),typeof w.getSnapshotBeforeUpdate!="function"||F===r.memoizedProps&&je===r.memoizedState||(a.flags|=1024),f=!1)}return w=f,Wc(r,a),f=(a.flags&128)!==0,w||f?(w=a.stateNode,l=f&&typeof l.getDerivedStateFromError!="function"?null:w.render(),a.flags|=1,r!==null&&f?(a.child=Hi(a,r.child,null,_),a.child=Hi(a,null,l,_)):la(r,a,l,_),a.memoizedState=w.state,r=a.child):r=qs(r,a,_),r}function Rh(r,a,l,f){return di(),a.flags|=256,la(r,a,l,f),a.child}var Yi={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function Dd(r){return{baseLanes:r,cachePool:Ff()}}function Od(r,a,l){return r=r!==null?r.childLanes&~l:0,a&&(r|=Na),r}function jh(r,a,l){var f=a.pendingProps,_=!1,w=(a.flags&128)!==0,F;if((F=w)||(F=r!==null&&r.memoizedState===null?!1:(vr.current&2)!==0),F&&(_=!0,a.flags&=-129),F=(a.flags&32)!==0,a.flags&=-33,r===null){if(An){if(_?Ws(a):hi(),(r=ar)?(r=ba(r,$a),r=r!==null&&r.data!=="&"?r:null,r!==null&&(a.memoizedState={dehydrated:r,treeContext:Ns!==null?{id:vs,overflow:ys}:null,retryLane:536870912,hydrationErrors:null},l=Sf(r),l.return=a,a.child=l,ia=a,ar=null)):r=null,r===null)throw ui(a);return Xl(r)?a.lanes=32:a.lanes=536870912,null}var re=f.children;return f=f.fallback,_?(hi(),_=a.mode,re=Hc({mode:"hidden",children:re},_),f=li(f,_,l,null),re.return=a,f.return=a,re.sibling=f,a.child=re,f=a.child,f.memoizedState=Dd(l),f.childLanes=Od(r,F,l),a.memoizedState=Yi,Fl(null,f)):(Ws(a),$d(a,re))}var ye=r.memoizedState;if(ye!==null&&(re=ye.dehydrated,re!==null)){if(w)a.flags&256?(Ws(a),a.flags&=-257,a=Bd(r,a,l)):a.memoizedState!==null?(hi(),a.child=r.child,a.flags|=128,a=null):(hi(),re=f.fallback,_=a.mode,f=Hc({mode:"visible",children:f.children},_),re=li(re,_,l,null),re.flags|=2,f.return=a,re.return=a,f.sibling=re,a.child=f,Hi(a,r.child,null,l),f=a.child,f.memoizedState=Dd(l),f.childLanes=Od(r,F,l),a.memoizedState=Yi,a=Fl(null,f));else if(Ws(a),Xl(re)){if(F=re.nextSibling&&re.nextSibling.dataset,F)var Fe=F.dgst;F=Fe,f=Error(s(419)),f.stack="",f.digest=F,yl({value:f,source:null,stack:null}),a=Bd(r,a,l)}else if(Rr||So(r,a,l,!1),F=(l&r.childLanes)!==0,Rr||F){if(F=Zn,F!==null&&(f=ue(F,l),f!==0&&f!==ye.retryLane))throw ye.retryLane=f,Ni(r,f),Aa(F,r,f),Bl;ja(re)||au(),a=Bd(r,a,l)}else ja(re)?(a.flags|=192,a.child=r.child,a=null):(r=ye.treeContext,ar=Ca(re.nextSibling),ia=a,An=!0,ci=null,$a=!1,r!==null&&kf(a,r),a=$d(a,f.children),a.flags|=4096);return a}return _?(hi(),re=f.fallback,_=a.mode,ye=r.child,Fe=ye.sibling,f=_s(ye,{mode:"hidden",children:f.children}),f.subtreeFlags=ye.subtreeFlags&65011712,Fe!==null?re=_s(Fe,re):(re=li(re,_,l,null),re.flags|=2),re.return=a,f.return=a,f.sibling=re,a.child=f,Fl(null,f),f=a.child,re=r.child.memoizedState,re===null?re=Dd(l):(_=re.cachePool,_!==null?(ye=Nr._currentValue,_=_.parent!==ye?{parent:ye,pool:ye}:_):_=Ff(),re={baseLanes:re.baseLanes|l,cachePool:_}),f.memoizedState=re,f.childLanes=Od(r,F,l),a.memoizedState=Yi,Fl(r.child,f)):(Ws(a),l=r.child,r=l.sibling,l=_s(l,{mode:"visible",children:f.children}),l.return=a,l.sibling=null,r!==null&&(F=a.deletions,F===null?(a.deletions=[r],a.flags|=16):F.push(r)),a.child=l,a.memoizedState=null,l)}function $d(r,a){return a=Hc({mode:"visible",children:a},r.mode),a.return=r,r.child=a}function Hc(r,a){return r=Oa(22,r,null,a),r.lanes=0,r}function Bd(r,a,l){return Hi(a,r.child,null,l),r=$d(a,a.pendingProps.children),r.flags|=2,a.memoizedState=null,r}function Uh(r,a,l){r.lanes|=a;var f=r.alternate;f!==null&&(f.lanes|=a),Xu(r.return,a,l)}function zl(r,a,l,f,_,w){var F=r.memoizedState;F===null?r.memoizedState={isBackwards:a,rendering:null,renderingStartTime:0,last:f,tail:l,tailMode:_,treeForkCount:w}:(F.isBackwards=a,F.rendering=null,F.renderingStartTime=0,F.last=f,F.tail=l,F.tailMode=_,F.treeForkCount=w)}function Sm(r,a,l){var f=a.pendingProps,_=f.revealOrder,w=f.tail;f=f.children;var F=vr.current,re=(F&2)!==0;if(re?(F=F&1|2,a.flags|=128):F&=1,N(vr,F),la(r,a,f,l),f=An?Ao:0,!re&&r!==null&&(r.flags&128)!==0)e:for(r=a.child;r!==null;){if(r.tag===13)r.memoizedState!==null&&Uh(r,l,a);else if(r.tag===19)Uh(r,l,a);else if(r.child!==null){r.child.return=r,r=r.child;continue}if(r===a)break e;for(;r.sibling===null;){if(r.return===null||r.return===a)break e;r=r.return}r.sibling.return=r.return,r=r.sibling}switch(_){case"forwards":for(l=a.child,_=null;l!==null;)r=l.alternate,r!==null&&Il(r)===null&&(_=l),l=l.sibling;l=_,l===null?(_=a.child,a.child=null):(_=l.sibling,l.sibling=null),zl(a,!1,_,l,w,f);break;case"backwards":case"unstable_legacy-backwards":for(l=null,_=a.child,a.child=null;_!==null;){if(r=_.alternate,r!==null&&Il(r)===null){a.child=_;break}r=_.sibling,_.sibling=l,l=_,_=r}zl(a,!0,l,null,w,f);break;case"together":zl(a,!1,null,null,void 0,f);break;default:a.memoizedState=null}return a.child}function qs(r,a,l){if(r!==null&&(a.dependencies=r.dependencies),Ts|=a.lanes,(l&a.childLanes)===0)if(r!==null){if(So(r,a,l,!1),(l&a.childLanes)===0)return null}else return null;if(r!==null&&a.child!==r.child)throw Error(s(153));if(a.child!==null){for(r=a.child,l=_s(r,r.pendingProps),a.child=l,l.return=a;r.sibling!==null;)r=r.sibling,l=l.sibling=_s(r,r.pendingProps),l.return=a;l.sibling=null}return a.child}function Ld(r,a){return(r.lanes&a)!==0?!0:(r=r.dependencies,!!(r!==null&&Ic(r)))}function Im(r,a,l){switch(a.tag){case 3:Pe(a,a.stateNode.containerInfo),js(a,Nr,r.memoizedState.cache),di();break;case 27:case 5:Oe(a);break;case 4:Pe(a,a.stateNode.containerInfo);break;case 10:js(a,a.type,a.memoizedProps.value);break;case 31:if(a.memoizedState!==null)return a.flags|=128,sd(a),null;break;case 13:var f=a.memoizedState;if(f!==null)return f.dehydrated!==null?(Ws(a),a.flags|=128,null):(l&a.child.childLanes)!==0?jh(r,a,l):(Ws(a),r=qs(r,a,l),r!==null?r.sibling:null);Ws(a);break;case 19:var _=(r.flags&128)!==0;if(f=(l&a.childLanes)!==0,f||(So(r,a,l,!1),f=(l&a.childLanes)!==0),_){if(f)return Sm(r,a,l);a.flags|=128}if(_=a.memoizedState,_!==null&&(_.rendering=null,_.tail=null,_.lastEffect=null),N(vr,vr.current),f)break;return null;case 22:return a.lanes=0,$h(r,a,l,a.pendingProps);case 24:js(a,Nr,r.memoizedState.cache)}return qs(r,a,l)}function Vh(r,a,l){if(r!==null)if(r.memoizedProps!==a.pendingProps)Rr=!0;else{if(!Ld(r,l)&&(a.flags&128)===0)return Rr=!1,Im(r,a,l);Rr=(r.flags&131072)!==0}else Rr=!1,An&&(a.flags&1048576)!==0&&Pf(a,Ao,a.index);switch(a.lanes=0,a.tag){case 16:e:{var f=a.pendingProps;if(r=Gi(a.elementType),a.type=r,typeof r=="function")Gu(r)?(f=Xi(r,f),a.tag=1,a=Nh(null,a,r,f,l)):(a.tag=0,a=Fh(null,a,r,f,l));else{if(r!=null){var _=r.$$typeof;if(_===I){a.tag=11,a=Dh(null,a,r,f,l);break e}else if(_===A){a.tag=14,a=Ll(null,a,r,f,l);break e}}throw a=le(r)||r,Error(s(306,a,""))}}return a;case 0:return Fh(r,a,a.type,a.pendingProps,l);case 1:return f=a.type,_=Xi(f,a.pendingProps),Nh(r,a,f,_,l);case 3:e:{if(Pe(a,a.stateNode.containerInfo),r===null)throw Error(s(387));f=a.pendingProps;var w=a.memoizedState;_=w.element,nd(r,a),$o(a,f,null,l);var F=a.memoizedState;if(f=F.cache,js(a,Nr,f),f!==w.cache&&Sc(a,[Nr],l,!0),Cl(),f=F.element,w.isDehydrated)if(w={element:f,isDehydrated:!1,cache:F.cache},a.updateQueue.baseState=w,a.memoizedState=w,a.flags&256){a=Rh(r,a,f,l);break e}else if(f!==_){_=Ya(Error(s(424)),a),yl(_),a=Rh(r,a,f,l);break e}else{switch(r=a.stateNode.containerInfo,r.nodeType){case 9:r=r.body;break;default:r=r.nodeName==="HTML"?r.ownerDocument.body:r}for(ar=Ca(r.firstChild),ia=a,An=!0,ci=null,$a=!0,l=Uf(a,null,f,l),a.child=l;l;)l.flags=l.flags&-3|4096,l=l.sibling}else{if(di(),f===_){a=qs(r,a,l);break e}la(r,a,f,l)}a=a.child}return a;case 26:return Wc(r,a),r===null?(l=ro(a.type,null,a.pendingProps,null))?a.memoizedState=l:An||(l=a.type,r=a.pendingProps,f=Ut(Z.current).createElement(l),f[Ye]=a,f[ct]=r,Ae(f,l,r),nr(f),a.stateNode=f):a.memoizedState=ro(a.type,r.memoizedProps,a.pendingProps,r.memoizedState),null;case 27:return Oe(a),r===null&&An&&(f=a.stateNode=bi(a.type,a.pendingProps,Z.current),ia=a,$a=!0,_=ar,er(a.type)?(Yl=_,ar=Ca(f.firstChild)):ar=_),la(r,a,a.pendingProps.children,l),Wc(r,a),r===null&&(a.flags|=4194304),a.child;case 5:return r===null&&An&&((_=f=ar)&&(f=es(f,a.type,a.pendingProps,$a),f!==null?(a.stateNode=f,ia=a,ar=Ca(f.firstChild),$a=!1,_=!0):_=!1),_||ui(a)),Oe(a),_=a.type,w=a.pendingProps,F=r!==null?r.memoizedProps:null,f=w.children,Lt(_,w)?f=null:F!==null&&Lt(_,F)&&(a.flags|=32),a.memoizedState!==null&&(_=ld(r,a,wm,null,null,l),zp._currentValue=_),Wc(r,a),la(r,a,f,l),a.child;case 6:return r===null&&An&&((r=l=ar)&&(l=qo(l,a.pendingProps,$a),l!==null?(a.stateNode=l,ia=a,ar=null,r=!0):r=!1),r||ui(a)),null;case 13:return jh(r,a,l);case 4:return Pe(a,a.stateNode.containerInfo),f=a.pendingProps,r===null?a.child=Hi(a,null,f,l):la(r,a,f,l),a.child;case 11:return Dh(r,a,a.type,a.pendingProps,l);case 7:return la(r,a,a.pendingProps,l),a.child;case 8:return la(r,a,a.pendingProps.children,l),a.child;case 12:return la(r,a,a.pendingProps.children,l),a.child;case 10:return f=a.pendingProps,js(a,a.type,f.value),la(r,a,f.children,l),a.child;case 9:return _=a.type._context,f=a.pendingProps.children,Ui(a),_=oa(_),f=f(_),a.flags|=1,la(r,a,f,l),a.child;case 14:return Ll(r,a,a.type,a.pendingProps,l);case 15:return Oh(r,a,a.type,a.pendingProps,l);case 19:return Sm(r,a,l);case 31:return Cm(r,a,l);case 22:return $h(r,a,l,a.pendingProps);case 24:return Ui(a),f=oa(Nr),r===null?(_=Ju(),_===null&&(_=Zn,w=Pc(),_.pooledCache=w,w.refCount++,w!==null&&(_.pooledCacheLanes|=l),_=w),a.memoizedState={parent:f,cache:_},td(a),js(a,Nr,_)):((r.lanes&l)!==0&&(nd(r,a),$o(a,null,null,l),Cl()),_=r.memoizedState,w=a.memoizedState,_.parent!==f?(_={parent:f,cache:f},a.memoizedState=_,a.lanes===0&&(a.memoizedState=a.updateQueue.baseState=_),js(a,Nr,f)):(f=w.cache,js(a,Nr,f),f!==_.cache&&Sc(a,[Nr],l,!0))),la(r,a,a.pendingProps.children,l),a.child;case 29:throw a.pendingProps}throw Error(s(156,a.tag))}function ws(r){r.flags|=4}function Fd(r,a,l,f,_){if((a=(r.mode&32)!==0)&&(a=!1),a){if(r.flags|=16777216,(_&335544128)===_)if(r.stateNode.complete)r.flags|=8192;else if(dp())r.flags|=8192;else throw Wi=El,Zu}else r.flags&=-16777217}function Gh(r,a){if(a.type!=="stylesheet"||(a.state.loading&4)!==0)r.flags&=-16777217;else if(r.flags|=16777216,!Cy(a))if(dp())r.flags|=8192;else throw Wi=El,Zu}function Nl(r,a){a!==null&&(r.flags|=4),r.flags&16384&&(a=r.tag!==22?Ha():536870912,r.lanes|=a,Go|=a)}function Rl(r,a){if(!An)switch(r.tailMode){case"hidden":a=r.tail;for(var l=null;a!==null;)a.alternate!==null&&(l=a),a=a.sibling;l===null?r.tail=null:l.sibling=null;break;case"collapsed":l=r.tail;for(var f=null;l!==null;)l.alternate!==null&&(f=l),l=l.sibling;f===null?a||r.tail===null?r.tail=null:r.tail.sibling=null:f.sibling=null}}function dr(r){var a=r.alternate!==null&&r.alternate.child===r.child,l=0,f=0;if(a)for(var _=r.child;_!==null;)l|=_.lanes|_.childLanes,f|=_.subtreeFlags&65011712,f|=_.flags&65011712,_.return=r,_=_.sibling;else for(_=r.child;_!==null;)l|=_.lanes|_.childLanes,f|=_.subtreeFlags,f|=_.flags,_.return=r,_=_.sibling;return r.subtreeFlags|=f,r.childLanes=l,a}function Wh(r,a,l){var f=a.pendingProps;switch(Ac(a),a.tag){case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return dr(a),null;case 1:return dr(a),null;case 3:return l=a.stateNode,f=null,r!==null&&(f=r.memoizedState.cache),a.memoizedState.cache!==f&&(a.flags|=2048),Us(Nr),Ne(),l.pendingContext&&(l.context=l.pendingContext,l.pendingContext=null),(r===null||r.child===null)&&(Co(a)?ws(a):r===null||r.memoizedState.isDehydrated&&(a.flags&256)===0||(a.flags|=1024,Ku())),dr(a),null;case 26:var _=a.type,w=a.memoizedState;return r===null?(ws(a),w!==null?(dr(a),Gh(a,w)):(dr(a),Fd(a,_,null,f,l))):w?w!==r.memoizedState?(ws(a),dr(a),Gh(a,w)):(dr(a),a.flags&=-16777217):(r=r.memoizedProps,r!==f&&ws(a),dr(a),Fd(a,_,r,f,l)),null;case 27:if(he(a),l=Z.current,_=a.type,r!==null&&a.stateNode!=null)r.memoizedProps!==f&&ws(a);else{if(!f){if(a.stateNode===null)throw Error(s(166));return dr(a),null}r=q.current,Co(a)?qu(a):(r=bi(_,f,l),a.stateNode=r,ws(a))}return dr(a),null;case 5:if(he(a),_=a.type,r!==null&&a.stateNode!=null)r.memoizedProps!==f&&ws(a);else{if(!f){if(a.stateNode===null)throw Error(s(166));return dr(a),null}if(w=q.current,Co(a))qu(a);else{var F=Ut(Z.current);switch(w){case 1:w=F.createElementNS("http://www.w3.org/2000/svg",_);break;case 2:w=F.createElementNS("http://www.w3.org/1998/Math/MathML",_);break;default:switch(_){case"svg":w=F.createElementNS("http://www.w3.org/2000/svg",_);break;case"math":w=F.createElementNS("http://www.w3.org/1998/Math/MathML",_);break;case"script":w=F.createElement("div"),w.innerHTML="<script><\/script>",w=w.removeChild(w.firstChild);break;case"select":w=typeof f.is=="string"?F.createElement("select",{is:f.is}):F.createElement("select"),f.multiple?w.multiple=!0:f.size&&(w.size=f.size);break;default:w=typeof f.is=="string"?F.createElement(_,{is:f.is}):F.createElement(_)}}w[Ye]=a,w[ct]=f;e:for(F=a.child;F!==null;){if(F.tag===5||F.tag===6)w.appendChild(F.stateNode);else if(F.tag!==4&&F.tag!==27&&F.child!==null){F.child.return=F,F=F.child;continue}if(F===a)break e;for(;F.sibling===null;){if(F.return===null||F.return===a)break e;F=F.return}F.sibling.return=F.return,F=F.sibling}a.stateNode=w;e:switch(Ae(w,_,f),_){case"button":case"input":case"select":case"textarea":f=!!f.autoFocus;break e;case"img":f=!0;break e;default:f=!1}f&&ws(a)}}return dr(a),Fd(a,a.type,r===null?null:r.memoizedProps,a.pendingProps,l),null;case 6:if(r&&a.stateNode!=null)r.memoizedProps!==f&&ws(a);else{if(typeof f!="string"&&a.stateNode===null)throw Error(s(166));if(r=Z.current,Co(a)){if(r=a.stateNode,l=a.memoizedProps,f=null,_=ia,_!==null)switch(_.tag){case 27:case 5:f=_.memoizedProps}r[Ye]=a,r=!!(r.nodeValue===l||f!==null&&f.suppressHydrationWarning===!0||K(r.nodeValue,l)),r||ui(a,!0)}else r=Ut(r).createTextNode(f),r[Ye]=a,a.stateNode=r}return dr(a),null;case 31:if(l=a.memoizedState,r===null||r.memoizedState!==null){if(f=Co(a),l!==null){if(r===null){if(!f)throw Error(s(318));if(r=a.memoizedState,r=r!==null?r.dehydrated:null,!r)throw Error(s(557));r[Ye]=a}else di(),(a.flags&128)===0&&(a.memoizedState=null),a.flags|=4;dr(a),r=!1}else l=Ku(),r!==null&&r.memoizedState!==null&&(r.memoizedState.hydrationErrors=l),r=!0;if(!r)return a.flags&256?(Fa(a),a):(Fa(a),null);if((a.flags&128)!==0)throw Error(s(558))}return dr(a),null;case 13:if(f=a.memoizedState,r===null||r.memoizedState!==null&&r.memoizedState.dehydrated!==null){if(_=Co(a),f!==null&&f.dehydrated!==null){if(r===null){if(!_)throw Error(s(318));if(_=a.memoizedState,_=_!==null?_.dehydrated:null,!_)throw Error(s(317));_[Ye]=a}else di(),(a.flags&128)===0&&(a.memoizedState=null),a.flags|=4;dr(a),_=!1}else _=Ku(),r!==null&&r.memoizedState!==null&&(r.memoizedState.hydrationErrors=_),_=!0;if(!_)return a.flags&256?(Fa(a),a):(Fa(a),null)}return Fa(a),(a.flags&128)!==0?(a.lanes=l,a):(l=f!==null,r=r!==null&&r.memoizedState!==null,l&&(f=a.child,_=null,f.alternate!==null&&f.alternate.memoizedState!==null&&f.alternate.memoizedState.cachePool!==null&&(_=f.alternate.memoizedState.cachePool.pool),w=null,f.memoizedState!==null&&f.memoizedState.cachePool!==null&&(w=f.memoizedState.cachePool.pool),w!==_&&(f.flags|=2048)),l!==r&&l&&(a.child.flags|=8192),Nl(a,a.updateQueue),dr(a),null);case 4:return Ne(),r===null&&of(a.stateNode.containerInfo),dr(a),null;case 10:return Us(a.type),dr(a),null;case 19:if(U(vr),f=a.memoizedState,f===null)return dr(a),null;if(_=(a.flags&128)!==0,w=f.rendering,w===null)if(_)Rl(f,!1);else{if(Sr!==0||r!==null&&(r.flags&128)!==0)for(r=a.child;r!==null;){if(w=Il(r),w!==null){for(a.flags|=128,Rl(f,!1),r=w.updateQueue,a.updateQueue=r,Nl(a,r),a.subtreeFlags=0,r=l,l=a.child;l!==null;)Cf(l,r),l=l.sibling;return N(vr,vr.current&1|2),An&&bs(a,f.treeForkCount),a.child}r=r.sibling}f.tail!==null&&pt()>Zc&&(a.flags|=128,_=!0,Rl(f,!1),a.lanes=4194304)}else{if(!_)if(r=Il(w),r!==null){if(a.flags|=128,_=!0,r=r.updateQueue,a.updateQueue=r,Nl(a,r),Rl(f,!0),f.tail===null&&f.tailMode==="hidden"&&!w.alternate&&!An)return dr(a),null}else 2*pt()-f.renderingStartTime>Zc&&l!==536870912&&(a.flags|=128,_=!0,Rl(f,!1),a.lanes=4194304);f.isBackwards?(w.sibling=a.child,a.child=w):(r=f.last,r!==null?r.sibling=w:a.child=w,f.last=w)}return f.tail!==null?(r=f.tail,f.rendering=r,f.tail=r.sibling,f.renderingStartTime=pt(),r.sibling=null,l=vr.current,N(vr,_?l&1|2:l&1),An&&bs(a,f.treeForkCount),r):(dr(a),null);case 22:case 23:return Fa(a),ad(),f=a.memoizedState!==null,r!==null?r.memoizedState!==null!==f&&(a.flags|=8192):f&&(a.flags|=8192),f?(l&536870912)!==0&&(a.flags&128)===0&&(dr(a),a.subtreeFlags&6&&(a.flags|=8192)):dr(a),l=a.updateQueue,l!==null&&Nl(a,l.retryQueue),l=null,r!==null&&r.memoizedState!==null&&r.memoizedState.cachePool!==null&&(l=r.memoizedState.cachePool.pool),f=null,a.memoizedState!==null&&a.memoizedState.cachePool!==null&&(f=a.memoizedState.cachePool.pool),f!==l&&(a.flags|=2048),r!==null&&U(Vi),null;case 24:return l=null,r!==null&&(l=r.memoizedState.cache),a.memoizedState.cache!==l&&(a.flags|=2048),Us(Nr),dr(a),null;case 25:return null;case 30:return null}throw Error(s(156,a.tag))}function Pm(r,a){switch(Ac(a),a.tag){case 1:return r=a.flags,r&65536?(a.flags=r&-65537|128,a):null;case 3:return Us(Nr),Ne(),r=a.flags,(r&65536)!==0&&(r&128)===0?(a.flags=r&-65537|128,a):null;case 26:case 27:case 5:return he(a),null;case 31:if(a.memoizedState!==null){if(Fa(a),a.alternate===null)throw Error(s(340));di()}return r=a.flags,r&65536?(a.flags=r&-65537|128,a):null;case 13:if(Fa(a),r=a.memoizedState,r!==null&&r.dehydrated!==null){if(a.alternate===null)throw Error(s(340));di()}return r=a.flags,r&65536?(a.flags=r&-65537|128,a):null;case 19:return U(vr),null;case 4:return Ne(),null;case 10:return Us(a.type),null;case 22:case 23:return Fa(a),ad(),r!==null&&U(Vi),r=a.flags,r&65536?(a.flags=r&-65537|128,a):null;case 24:return Us(Nr),null;case 25:return null;default:return null}}function Hh(r,a){switch(Ac(a),a.tag){case 3:Us(Nr),Ne();break;case 26:case 27:case 5:he(a);break;case 4:Ne();break;case 31:a.memoizedState!==null&&Fa(a);break;case 13:Fa(a);break;case 19:U(vr);break;case 10:Us(a.type);break;case 22:case 23:Fa(a),ad(),r!==null&&U(Vi);break;case 24:Us(Nr)}}function jo(r,a){try{var l=a.updateQueue,f=l!==null?l.lastEffect:null;if(f!==null){var _=f.next;l=_;do{if((l.tag&r)===r){f=void 0;var w=l.create,F=l.inst;f=w(),F.destroy=f}l=l.next}while(l!==_)}}catch(re){Qn(a,a.return,re)}}function mi(r,a,l){try{var f=a.updateQueue,_=f!==null?f.lastEffect:null;if(_!==null){var w=_.next;f=w;do{if((f.tag&r)===r){var F=f.inst,re=F.destroy;if(re!==void 0){F.destroy=void 0,_=a;var ye=l,Fe=re;try{Fe()}catch(tt){Qn(_,ye,tt)}}}f=f.next}while(f!==w)}}catch(tt){Qn(a,a.return,tt)}}function Qh(r){var a=r.updateQueue;if(a!==null){var l=r.stateNode;try{Gf(a,l)}catch(f){Qn(r,r.return,f)}}}function zd(r,a,l){l.props=Xi(r.type,r.memoizedProps),l.state=r.memoizedState;try{l.componentWillUnmount()}catch(f){Qn(r,a,f)}}function jl(r,a){try{var l=r.ref;if(l!==null){switch(r.tag){case 26:case 27:case 5:var f=r.stateNode;break;case 30:f=r.stateNode;break;default:f=r.stateNode}typeof l=="function"?r.refCleanup=l(f):l.current=f}}catch(_){Qn(r,a,_)}}function Ms(r,a){var l=r.ref,f=r.refCleanup;if(l!==null)if(typeof f=="function")try{f()}catch(_){Qn(r,a,_)}finally{r.refCleanup=null,r=r.alternate,r!=null&&(r.refCleanup=null)}else if(typeof l=="function")try{l(null)}catch(_){Qn(r,a,_)}else l.current=null}function Nd(r){var a=r.type,l=r.memoizedProps,f=r.stateNode;try{e:switch(a){case"button":case"input":case"select":case"textarea":l.autoFocus&&f.focus();break e;case"img":l.src?f.src=l.src:l.srcSet&&(f.srcset=l.srcSet)}}catch(_){Qn(r,r.return,_)}}function Rd(r,a,l){try{var f=r.stateNode;Ve(f,r.type,l,a),f[ct]=a}catch(_){Qn(r,r.return,_)}}function qh(r){return r.tag===5||r.tag===3||r.tag===26||r.tag===27&&er(r.type)||r.tag===4}function Qc(r){e:for(;;){for(;r.sibling===null;){if(r.return===null||qh(r.return))return null;r=r.return}for(r.sibling.return=r.return,r=r.sibling;r.tag!==5&&r.tag!==6&&r.tag!==18;){if(r.tag===27&&er(r.type)||r.flags&2||r.child===null||r.tag===4)continue e;r.child.return=r,r=r.child}if(!(r.flags&2))return r.stateNode}}function jd(r,a,l){var f=r.tag;if(f===5||f===6)r=r.stateNode,a?(l.nodeType===9?l.body:l.nodeName==="HTML"?l.ownerDocument.body:l).insertBefore(r,a):(a=l.nodeType===9?l.body:l.nodeName==="HTML"?l.ownerDocument.body:l,a.appendChild(r),l=l._reactRootContainer,l!=null||a.onclick!==null||(a.onclick=un));else if(f!==4&&(f===27&&er(r.type)&&(l=r.stateNode,a=null),r=r.child,r!==null))for(jd(r,a,l),r=r.sibling;r!==null;)jd(r,a,l),r=r.sibling}function qc(r,a,l){var f=r.tag;if(f===5||f===6)r=r.stateNode,a?l.insertBefore(r,a):l.appendChild(r);else if(f!==4&&(f===27&&er(r.type)&&(l=r.stateNode),r=r.child,r!==null))for(qc(r,a,l),r=r.sibling;r!==null;)qc(r,a,l),r=r.sibling}function Kc(r){var a=r.stateNode,l=r.memoizedProps;try{for(var f=r.type,_=a.attributes;_.length;)a.removeAttributeNode(_[0]);Ae(a,f,l),a[Ye]=r,a[ct]=l}catch(w){Qn(r,r.return,w)}}var Ks=!1,jr=!1,Ud=!1,Kh=typeof WeakSet=="function"?WeakSet:Set,Yr=null;function Vd(r,a){if(r=r.containerInfo,wt=ng,r=ml(r),yo(r)){if("selectionStart"in r)var l={start:r.selectionStart,end:r.selectionEnd};else e:{l=(l=r.ownerDocument)&&l.defaultView||window;var f=l.getSelection&&l.getSelection();if(f&&f.rangeCount!==0){l=f.anchorNode;var _=f.anchorOffset,w=f.focusNode;f=f.focusOffset;try{l.nodeType,w.nodeType}catch{l=null;break e}var F=0,re=-1,ye=-1,Fe=0,tt=0,st=r,je=null;t:for(;;){for(var Qe;st!==l||_!==0&&st.nodeType!==3||(re=F+_),st!==w||f!==0&&st.nodeType!==3||(ye=F+f),st.nodeType===3&&(F+=st.nodeValue.length),(Qe=st.firstChild)!==null;)je=st,st=Qe;for(;;){if(st===r)break t;if(je===l&&++Fe===_&&(re=F),je===w&&++tt===f&&(ye=F),(Qe=st.nextSibling)!==null)break;st=je,je=st.parentNode}st=Qe}l=re===-1||ye===-1?null:{start:re,end:ye}}else l=null}l=l||{start:0,end:0}}else l=null;for(Dt={focusedElem:r,selectionRange:l},ng=!1,Yr=a;Yr!==null;)if(a=Yr,r=a.child,(a.subtreeFlags&1028)!==0&&r!==null)r.return=a,Yr=r;else for(;Yr!==null;){switch(a=Yr,w=a.alternate,r=a.flags,a.tag){case 0:if((r&4)!==0&&(r=a.updateQueue,r=r!==null?r.events:null,r!==null))for(l=0;l<r.length;l++)_=r[l],_.ref.impl=_.nextImpl;break;case 11:case 15:break;case 1:if((r&1024)!==0&&w!==null){r=void 0,l=a,_=w.memoizedProps,w=w.memoizedState,f=l.stateNode;try{var Ot=Xi(l.type,_);r=f.getSnapshotBeforeUpdate(Ot,w),f.__reactInternalSnapshotBeforeUpdate=r}catch(en){Qn(l,l.return,en)}}break;case 3:if((r&1024)!==0){if(r=a.stateNode.containerInfo,l=r.nodeType,l===9)Br(r);else if(l===1)switch(r.nodeName){case"HEAD":case"HTML":case"BODY":Br(r);break;default:r.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((r&1024)!==0)throw Error(s(163))}if(r=a.sibling,r!==null){r.return=a.return,Yr=r;break}Yr=a.return}}function km(r,a,l){var f=l.flags;switch(l.tag){case 0:case 11:case 15:Ys(r,l),f&4&&jo(5,l);break;case 1:if(Ys(r,l),f&4)if(r=l.stateNode,a===null)try{r.componentDidMount()}catch(F){Qn(l,l.return,F)}else{var _=Xi(l.type,a.memoizedProps);a=a.memoizedState;try{r.componentDidUpdate(_,a,r.__reactInternalSnapshotBeforeUpdate)}catch(F){Qn(l,l.return,F)}}f&64&&Qh(l),f&512&&jl(l,l.return);break;case 3:if(Ys(r,l),f&64&&(r=l.updateQueue,r!==null)){if(a=null,l.child!==null)switch(l.child.tag){case 27:case 5:a=l.child.stateNode;break;case 1:a=l.child.stateNode}try{Gf(r,a)}catch(F){Qn(l,l.return,F)}}break;case 27:a===null&&f&4&&Kc(l);case 26:case 5:Ys(r,l),a===null&&f&4&&Nd(l),f&512&&jl(l,l.return);break;case 12:Ys(r,l);break;case 31:Ys(r,l),f&4&&Gd(r,l);break;case 13:Ys(r,l),f&4&&Jh(r,l),f&64&&(r=l.memoizedState,r!==null&&(r=r.dehydrated,r!==null&&(l=Rm.bind(null,l),Ko(r,l))));break;case 22:if(f=l.memoizedState!==null||Ks,!f){a=a!==null&&a.memoizedState!==null||jr,_=Ks;var w=jr;Ks=f,(jr=a)&&!w?os(r,l,(l.subtreeFlags&8772)!==0):Ys(r,l),Ks=_,jr=w}break;case 30:break;default:Ys(r,l)}}function Xh(r){var a=r.alternate;a!==null&&(r.alternate=null,Xh(a)),r.child=null,r.deletions=null,r.sibling=null,r.tag===5&&(a=r.stateNode,a!==null&&wn(a)),r.stateNode=null,r.return=null,r.dependencies=null,r.memoizedProps=null,r.memoizedState=null,r.pendingProps=null,r.stateNode=null,r.updateQueue=null}var yr=null,ya=!1;function Xs(r,a,l){for(l=l.child;l!==null;)Yh(r,a,l),l=l.sibling}function Yh(r,a,l){if(Cn&&typeof Cn.onCommitFiberUnmount=="function")try{Cn.onCommitFiberUnmount(Jt,l)}catch{}switch(l.tag){case 26:jr||Ms(l,a),Xs(r,a,l),l.memoizedState?l.memoizedState.count--:l.stateNode&&(l=l.stateNode,l.parentNode.removeChild(l));break;case 27:jr||Ms(l,a);var f=yr,_=ya;er(l.type)&&(yr=l.stateNode,ya=!1),Xs(r,a,l),Is(l.stateNode),yr=f,ya=_;break;case 5:jr||Ms(l,a);case 6:if(f=yr,_=ya,yr=null,Xs(r,a,l),yr=f,ya=_,yr!==null)if(ya)try{(yr.nodeType===9?yr.body:yr.nodeName==="HTML"?yr.ownerDocument.body:yr).removeChild(l.stateNode)}catch(w){Qn(l,a,w)}else try{yr.removeChild(l.stateNode)}catch(w){Qn(l,a,w)}break;case 18:yr!==null&&(ya?(r=yr,Zr(r.nodeType===9?r.body:r.nodeName==="HTML"?r.ownerDocument.body:r,l.stateNode),uf(r)):Zr(yr,l.stateNode));break;case 4:f=yr,_=ya,yr=l.stateNode.containerInfo,ya=!0,Xs(r,a,l),yr=f,ya=_;break;case 0:case 11:case 14:case 15:mi(2,l,a),jr||mi(4,l,a),Xs(r,a,l);break;case 1:jr||(Ms(l,a),f=l.stateNode,typeof f.componentWillUnmount=="function"&&zd(l,a,f)),Xs(r,a,l);break;case 21:Xs(r,a,l);break;case 22:jr=(f=jr)||l.memoizedState!==null,Xs(r,a,l),jr=f;break;default:Xs(r,a,l)}}function Gd(r,a){if(a.memoizedState===null&&(r=a.alternate,r!==null&&(r=r.memoizedState,r!==null))){r=r.dehydrated;try{uf(r)}catch(l){Qn(a,a.return,l)}}}function Jh(r,a){if(a.memoizedState===null&&(r=a.alternate,r!==null&&(r=r.memoizedState,r!==null&&(r=r.dehydrated,r!==null))))try{uf(r)}catch(l){Qn(a,a.return,l)}}function Dm(r){switch(r.tag){case 31:case 13:case 19:var a=r.stateNode;return a===null&&(a=r.stateNode=new Kh),a;case 22:return r=r.stateNode,a=r._retryCache,a===null&&(a=r._retryCache=new Kh),a;default:throw Error(s(435,r.tag))}}function Ul(r,a){var l=Dm(r);a.forEach(function(f){if(!l.has(f)){l.add(f);var _=jm.bind(null,r,f);f.then(_,_)}})}function za(r,a){var l=a.deletions;if(l!==null)for(var f=0;f<l.length;f++){var _=l[f],w=r,F=a,re=F;e:for(;re!==null;){switch(re.tag){case 27:if(er(re.type)){yr=re.stateNode,ya=!1;break e}break;case 5:yr=re.stateNode,ya=!1;break e;case 3:case 4:yr=re.stateNode.containerInfo,ya=!0;break e}re=re.return}if(yr===null)throw Error(s(160));Yh(w,F,_),yr=null,ya=!1,w=_.alternate,w!==null&&(w.return=null),_.return=null}if(a.subtreeFlags&13886)for(a=a.child;a!==null;)Wd(a,r),a=a.sibling}var xs=null;function Wd(r,a){var l=r.alternate,f=r.flags;switch(r.tag){case 0:case 11:case 14:case 15:za(a,r),fa(r),f&4&&(mi(3,r,r.return),jo(3,r),mi(5,r,r.return));break;case 1:za(a,r),fa(r),f&512&&(jr||l===null||Ms(l,l.return)),f&64&&Ks&&(r=r.updateQueue,r!==null&&(f=r.callbacks,f!==null&&(l=r.shared.hiddenCallbacks,r.shared.hiddenCallbacks=l===null?f:l.concat(f))));break;case 26:var _=xs;if(za(a,r),fa(r),f&512&&(jr||l===null||Ms(l,l.return)),f&4){var w=l!==null?l.memoizedState:null;if(f=r.memoizedState,l===null)if(f===null)if(r.stateNode===null){e:{f=r.type,l=r.memoizedProps,_=_.ownerDocument||_;t:switch(f){case"title":w=_.getElementsByTagName("title")[0],(!w||w[Zt]||w[Ye]||w.namespaceURI==="http://www.w3.org/2000/svg"||w.hasAttribute("itemprop"))&&(w=_.createElement(f),_.head.insertBefore(w,_.querySelector("head > title"))),Ae(w,f,l),w[Ye]=r,nr(w),f=w;break e;case"link":var F=Ty("link","href",_).get(f+(l.href||""));if(F){for(var re=0;re<F.length;re++)if(w=F[re],w.getAttribute("href")===(l.href==null||l.href===""?null:l.href)&&w.getAttribute("rel")===(l.rel==null?null:l.rel)&&w.getAttribute("title")===(l.title==null?null:l.title)&&w.getAttribute("crossorigin")===(l.crossOrigin==null?null:l.crossOrigin)){F.splice(re,1);break t}}w=_.createElement(f),Ae(w,f,l),_.head.appendChild(w);break;case"meta":if(F=Ty("meta","content",_).get(f+(l.content||""))){for(re=0;re<F.length;re++)if(w=F[re],w.getAttribute("content")===(l.content==null?null:""+l.content)&&w.getAttribute("name")===(l.name==null?null:l.name)&&w.getAttribute("property")===(l.property==null?null:l.property)&&w.getAttribute("http-equiv")===(l.httpEquiv==null?null:l.httpEquiv)&&w.getAttribute("charset")===(l.charSet==null?null:l.charSet)){F.splice(re,1);break t}}w=_.createElement(f),Ae(w,f,l),_.head.appendChild(w);break;default:throw Error(s(468,f))}w[Ye]=r,nr(w),f=w}r.stateNode=f}else Ay(_,r.type,r.stateNode);else r.stateNode=Ey(_,f,r.memoizedProps);else w!==f?(w===null?l.stateNode!==null&&(l=l.stateNode,l.parentNode.removeChild(l)):w.count--,f===null?Ay(_,r.type,r.stateNode):Ey(_,f,r.memoizedProps)):f===null&&r.stateNode!==null&&Rd(r,r.memoizedProps,l.memoizedProps)}break;case 27:za(a,r),fa(r),f&512&&(jr||l===null||Ms(l,l.return)),l!==null&&f&4&&Rd(r,r.memoizedProps,l.memoizedProps);break;case 5:if(za(a,r),fa(r),f&512&&(jr||l===null||Ms(l,l.return)),r.flags&32){_=r.stateNode;try{be(_,"")}catch(Ot){Qn(r,r.return,Ot)}}f&4&&r.stateNode!=null&&(_=r.memoizedProps,Rd(r,_,l!==null?l.memoizedProps:_)),f&1024&&(Ud=!0);break;case 6:if(za(a,r),fa(r),f&4){if(r.stateNode===null)throw Error(s(162));f=r.memoizedProps,l=r.stateNode;try{l.nodeValue=f}catch(Ot){Qn(r,r.return,Ot)}}break;case 3:if(Jm=null,_=xs,xs=Jl(a.containerInfo),za(a,r),xs=_,fa(r),f&4&&l!==null&&l.memoizedState.isDehydrated)try{uf(a.containerInfo)}catch(Ot){Qn(r,r.return,Ot)}Ud&&(Ud=!1,Zh(r));break;case 4:f=xs,xs=Jl(r.stateNode.containerInfo),za(a,r),fa(r),xs=f;break;case 12:za(a,r),fa(r);break;case 31:za(a,r),fa(r),f&4&&(f=r.updateQueue,f!==null&&(r.updateQueue=null,Ul(r,f)));break;case 13:za(a,r),fa(r),r.child.flags&8192&&r.memoizedState!==null!=(l!==null&&l.memoizedState!==null)&&(Jc=pt()),f&4&&(f=r.updateQueue,f!==null&&(r.updateQueue=null,Ul(r,f)));break;case 22:_=r.memoizedState!==null;var ye=l!==null&&l.memoizedState!==null,Fe=Ks,tt=jr;if(Ks=Fe||_,jr=tt||ye,za(a,r),jr=tt,Ks=Fe,fa(r),f&8192)e:for(a=r.stateNode,a._visibility=_?a._visibility&-2:a._visibility|1,_&&(l===null||ye||Ks||jr||Ji(r)),l=null,a=r;;){if(a.tag===5||a.tag===26){if(l===null){ye=l=a;try{if(w=ye.stateNode,_)F=w.style,typeof F.setProperty=="function"?F.setProperty("display","none","important"):F.display="none";else{re=ye.stateNode;var st=ye.memoizedProps.style,je=st!=null&&st.hasOwnProperty("display")?st.display:null;re.style.display=je==null||typeof je=="boolean"?"":(""+je).trim()}}catch(Ot){Qn(ye,ye.return,Ot)}}}else if(a.tag===6){if(l===null){ye=a;try{ye.stateNode.nodeValue=_?"":ye.memoizedProps}catch(Ot){Qn(ye,ye.return,Ot)}}}else if(a.tag===18){if(l===null){ye=a;try{var Qe=ye.stateNode;_?ln(Qe,!0):ln(ye.stateNode,!1)}catch(Ot){Qn(ye,ye.return,Ot)}}}else if((a.tag!==22&&a.tag!==23||a.memoizedState===null||a===r)&&a.child!==null){a.child.return=a,a=a.child;continue}if(a===r)break e;for(;a.sibling===null;){if(a.return===null||a.return===r)break e;l===a&&(l=null),a=a.return}l===a&&(l=null),a.sibling.return=a.return,a=a.sibling}f&4&&(f=r.updateQueue,f!==null&&(l=f.retryQueue,l!==null&&(f.retryQueue=null,Ul(r,l))));break;case 19:za(a,r),fa(r),f&4&&(f=r.updateQueue,f!==null&&(r.updateQueue=null,Ul(r,f)));break;case 30:break;case 21:break;default:za(a,r),fa(r)}}function fa(r){var a=r.flags;if(a&2){try{for(var l,f=r.return;f!==null;){if(qh(f)){l=f;break}f=f.return}if(l==null)throw Error(s(160));switch(l.tag){case 27:var _=l.stateNode,w=Qc(r);qc(r,w,_);break;case 5:var F=l.stateNode;l.flags&32&&(be(F,""),l.flags&=-33);var re=Qc(r);qc(r,re,F);break;case 3:case 4:var ye=l.stateNode.containerInfo,Fe=Qc(r);jd(r,Fe,ye);break;default:throw Error(s(161))}}catch(tt){Qn(r,r.return,tt)}r.flags&=-3}a&4096&&(r.flags&=-4097)}function Zh(r){if(r.subtreeFlags&1024)for(r=r.child;r!==null;){var a=r;Zh(a),a.tag===5&&a.flags&1024&&a.stateNode.reset(),r=r.sibling}}function Ys(r,a){if(a.subtreeFlags&8772)for(a=a.child;a!==null;)km(r,a.alternate,a),a=a.sibling}function Ji(r){for(r=r.child;r!==null;){var a=r;switch(a.tag){case 0:case 11:case 14:case 15:mi(4,a,a.return),Ji(a);break;case 1:Ms(a,a.return);var l=a.stateNode;typeof l.componentWillUnmount=="function"&&zd(a,a.return,l),Ji(a);break;case 27:Is(a.stateNode);case 26:case 5:Ms(a,a.return),Ji(a);break;case 22:a.memoizedState===null&&Ji(a);break;case 30:Ji(a);break;default:Ji(a)}r=r.sibling}}function os(r,a,l){for(l=l&&(a.subtreeFlags&8772)!==0,a=a.child;a!==null;){var f=a.alternate,_=r,w=a,F=w.flags;switch(w.tag){case 0:case 11:case 15:os(_,w,l),jo(4,w);break;case 1:if(os(_,w,l),f=w,_=f.stateNode,typeof _.componentDidMount=="function")try{_.componentDidMount()}catch(Fe){Qn(f,f.return,Fe)}if(f=w,_=f.updateQueue,_!==null){var re=f.stateNode;try{var ye=_.shared.hiddenCallbacks;if(ye!==null)for(_.shared.hiddenCallbacks=null,_=0;_<ye.length;_++)Vf(ye[_],re)}catch(Fe){Qn(f,f.return,Fe)}}l&&F&64&&Qh(w),jl(w,w.return);break;case 27:Kc(w);case 26:case 5:os(_,w,l),l&&f===null&&F&4&&Nd(w),jl(w,w.return);break;case 12:os(_,w,l);break;case 31:os(_,w,l),l&&F&4&&Gd(_,w);break;case 13:os(_,w,l),l&&F&4&&Jh(_,w);break;case 22:w.memoizedState===null&&os(_,w,l),jl(w,w.return);break;case 30:break;default:os(_,w,l)}a=a.sibling}}function Hd(r,a){var l=null;r!==null&&r.memoizedState!==null&&r.memoizedState.cachePool!==null&&(l=r.memoizedState.cachePool.pool),r=null,a.memoizedState!==null&&a.memoizedState.cachePool!==null&&(r=a.memoizedState.cachePool.pool),r!==l&&(r!=null&&r.refCount++,l!=null&&wl(l))}function Qd(r,a){r=null,a.alternate!==null&&(r=a.alternate.memoizedState.cache),a=a.memoizedState.cache,a!==r&&(a.refCount++,r!=null&&wl(r))}function ls(r,a,l,f){if(a.subtreeFlags&10256)for(a=a.child;a!==null;)Xc(r,a,l,f),a=a.sibling}function Xc(r,a,l,f){var _=a.flags;switch(a.tag){case 0:case 11:case 15:ls(r,a,l,f),_&2048&&jo(9,a);break;case 1:ls(r,a,l,f);break;case 3:ls(r,a,l,f),_&2048&&(r=null,a.alternate!==null&&(r=a.alternate.memoizedState.cache),a=a.memoizedState.cache,a!==r&&(a.refCount++,r!=null&&wl(r)));break;case 12:if(_&2048){ls(r,a,l,f),r=a.stateNode;try{var w=a.memoizedProps,F=w.id,re=w.onPostCommit;typeof re=="function"&&re(F,a.alternate===null?"mount":"update",r.passiveEffectDuration,-0)}catch(ye){Qn(a,a.return,ye)}}else ls(r,a,l,f);break;case 31:ls(r,a,l,f);break;case 13:ls(r,a,l,f);break;case 23:break;case 22:w=a.stateNode,F=a.alternate,a.memoizedState!==null?w._visibility&2?ls(r,a,l,f):Vl(r,a):w._visibility&2?ls(r,a,l,f):(w._visibility|=2,Uo(r,a,l,f,(a.subtreeFlags&10256)!==0||!1)),_&2048&&Hd(F,a);break;case 24:ls(r,a,l,f),_&2048&&Qd(a.alternate,a);break;default:ls(r,a,l,f)}}function Uo(r,a,l,f,_){for(_=_&&((a.subtreeFlags&10256)!==0||!1),a=a.child;a!==null;){var w=r,F=a,re=l,ye=f,Fe=F.flags;switch(F.tag){case 0:case 11:case 15:Uo(w,F,re,ye,_),jo(8,F);break;case 23:break;case 22:var tt=F.stateNode;F.memoizedState!==null?tt._visibility&2?Uo(w,F,re,ye,_):Vl(w,F):(tt._visibility|=2,Uo(w,F,re,ye,_)),_&&Fe&2048&&Hd(F.alternate,F);break;case 24:Uo(w,F,re,ye,_),_&&Fe&2048&&Qd(F.alternate,F);break;default:Uo(w,F,re,ye,_)}a=a.sibling}}function Vl(r,a){if(a.subtreeFlags&10256)for(a=a.child;a!==null;){var l=r,f=a,_=f.flags;switch(f.tag){case 22:Vl(l,f),_&2048&&Hd(f.alternate,f);break;case 24:Vl(l,f),_&2048&&Qd(f.alternate,f);break;default:Vl(l,f)}a=a.sibling}}var Gl=8192;function gi(r,a,l){if(r.subtreeFlags&Gl)for(r=r.child;r!==null;)ep(r,a,l),r=r.sibling}function ep(r,a,l){switch(r.tag){case 26:gi(r,a,l),r.flags&Gl&&r.memoizedState!==null&&vC(l,xs,r.memoizedState,r.memoizedProps);break;case 5:gi(r,a,l);break;case 3:case 4:var f=xs;xs=Jl(r.stateNode.containerInfo),gi(r,a,l),xs=f;break;case 22:r.memoizedState===null&&(f=r.alternate,f!==null&&f.memoizedState!==null?(f=Gl,Gl=16777216,gi(r,a,l),Gl=f):gi(r,a,l));break;default:gi(r,a,l)}}function tp(r){var a=r.alternate;if(a!==null&&(r=a.child,r!==null)){a.child=null;do a=r.sibling,r.sibling=null,r=a;while(r!==null)}}function Wl(r){var a=r.deletions;if((r.flags&16)!==0){if(a!==null)for(var l=0;l<a.length;l++){var f=a[l];Yr=f,rp(f,r)}tp(r)}if(r.subtreeFlags&10256)for(r=r.child;r!==null;)np(r),r=r.sibling}function np(r){switch(r.tag){case 0:case 11:case 15:Wl(r),r.flags&2048&&mi(9,r,r.return);break;case 3:Wl(r);break;case 12:Wl(r);break;case 22:var a=r.stateNode;r.memoizedState!==null&&a._visibility&2&&(r.return===null||r.return.tag!==13)?(a._visibility&=-3,Yc(r)):Wl(r);break;default:Wl(r)}}function Yc(r){var a=r.deletions;if((r.flags&16)!==0){if(a!==null)for(var l=0;l<a.length;l++){var f=a[l];Yr=f,rp(f,r)}tp(r)}for(r=r.child;r!==null;){switch(a=r,a.tag){case 0:case 11:case 15:mi(8,a,a.return),Yc(a);break;case 22:l=a.stateNode,l._visibility&2&&(l._visibility&=-3,Yc(a));break;default:Yc(a)}r=r.sibling}}function rp(r,a){for(;Yr!==null;){var l=Yr;switch(l.tag){case 0:case 11:case 15:mi(8,l,a);break;case 23:case 22:if(l.memoizedState!==null&&l.memoizedState.cachePool!==null){var f=l.memoizedState.cachePool.pool;f!=null&&f.refCount++}break;case 24:wl(l.memoizedState.cache)}if(f=l.child,f!==null)f.return=l,Yr=f;else e:for(l=r;Yr!==null;){f=Yr;var _=f.sibling,w=f.return;if(Xh(f),f===l){Yr=null;break e}if(_!==null){_.return=w,Yr=_;break e}Yr=w}}}var Om={getCacheForType:function(r){var a=oa(Nr),l=a.data.get(r);return l===void 0&&(l=r(),a.data.set(r,l)),l},cacheSignal:function(){return oa(Nr).controller.signal}},$m=typeof WeakMap=="function"?WeakMap:Map,$n=0,Zn=null,yn=null,xn=0,Rn=0,Ta=null,_i=!1,Vo=!1,qd=!1,Es=0,Sr=0,Ts=0,Zi=0,Kd=0,Na=0,Go=0,Hl=null,ha=null,Xd=!1,Jc=0,ap=0,Zc=1/0,eu=null,As=null,Jr=0,vi=null,Wo=null,pn=0,sp=0,ip=null,Bm=null,tu=0,nu=null;function Ra(){return($n&2)!==0&&xn!==0?xn&-xn:Q.T!==null?rf():pe()}function op(){if(Na===0)if((xn&536870912)===0||An){var r=Vn;Vn<<=1,(Vn&3932160)===0&&(Vn=262144),Na=r}else Na=536870912;return r=Ba.current,r!==null&&(r.flags|=32),Na}function Aa(r,a,l){(r===Zn&&(Rn===2||Rn===9)||r.cancelPendingCommit!==null)&&(to(r,0),eo(r,xn,Na,!1)),Kr(r,l),(($n&2)===0||r!==Zn)&&(r===Zn&&(($n&2)===0&&(Zi|=l),Sr===4&&eo(r,xn,Na,!1)),Cs(r))}function lp(r,a,l){if(($n&6)!==0)throw Error(s(327));var f=!l&&(a&127)===0&&(a&r.expiredLanes)===0||Ft(r,a),_=f?Fm(r,a):Zd(r,a,!0),w=f;do{if(_===0){Vo&&!f&&eo(r,a,0,!1);break}else{if(l=r.current.alternate,w&&!cp(l)){_=Zd(r,a,!1),w=!1;continue}if(_===2){if(w=a,r.errorRecoveryDisabledLanes&w)var F=0;else F=r.pendingLanes&-536870913,F=F!==0?F:F&536870912?536870912:0;if(F!==0){a=F;e:{var re=r;_=Hl;var ye=re.current.memoizedState.isDehydrated;if(ye&&(to(re,F).flags|=256),F=Zd(re,F,!1),F!==2){if(qd&&!ye){re.errorRecoveryDisabledLanes|=w,Zi|=w,_=4;break e}w=ha,ha=_,w!==null&&(ha===null?ha=w:ha.push.apply(ha,w))}_=F}if(w=!1,_!==2)continue}}if(_===1){to(r,0),eo(r,a,0,!0);break}e:{switch(f=r,w=_,w){case 0:case 1:throw Error(s(345));case 4:if((a&4194048)!==a)break;case 6:eo(f,a,Na,!_i);break e;case 2:ha=null;break;case 3:case 5:break;default:throw Error(s(329))}if((a&62914560)===a&&(_=Jc+300-pt(),10<_)){if(eo(f,a,Na,!_i),Pa(f,0,!0)!==0)break e;pn=a,f.timeoutHandle=on(Yd.bind(null,f,l,ha,eu,Xd,a,Na,Zi,Go,_i,w,"Throttled",-0,0),_);break e}Yd(f,l,ha,eu,Xd,a,Na,Zi,Go,_i,w,null,-0,0)}}break}while(!0);Cs(r)}function Yd(r,a,l,f,_,w,F,re,ye,Fe,tt,st,je,Qe){if(r.timeoutHandle=-1,st=a.subtreeFlags,st&8192||(st&16785408)===16785408){st={stylesheets:null,count:0,imgCount:0,imgBytes:0,suspenseyImages:[],waitingForImages:!0,waitingForViewTransition:!1,unsuspend:un},ep(a,w,st);var Ot=(w&62914560)===w?Jc-pt():(w&4194048)===w?ap-pt():0;if(Ot=yC(st,Ot),Ot!==null){pn=w,r.cancelPendingCommit=Ot(gp.bind(null,r,a,w,l,f,_,F,re,ye,tt,st,null,je,Qe)),eo(r,w,F,!Fe);return}}gp(r,a,w,l,f,_,F,re,ye)}function cp(r){for(var a=r;;){var l=a.tag;if((l===0||l===11||l===15)&&a.flags&16384&&(l=a.updateQueue,l!==null&&(l=l.stores,l!==null)))for(var f=0;f<l.length;f++){var _=l[f],w=_.getSnapshot;_=_.value;try{if(!sa(w(),_))return!1}catch{return!1}}if(l=a.child,a.subtreeFlags&16384&&l!==null)l.return=a,a=l;else{if(a===r)break;for(;a.sibling===null;){if(a.return===null||a.return===r)return!0;a=a.return}a.sibling.return=a.return,a=a.sibling}}return!0}function eo(r,a,l,f){a&=~Kd,a&=~Zi,r.suspendedLanes|=a,r.pingedLanes&=~a,f&&(r.warmLanes|=a),f=r.expirationTimes;for(var _=a;0<_;){var w=31-tn(_),F=1<<w;f[w]=-1,_&=~F}l!==0&&Qa(r,l,a)}function ru(){return($n&6)===0?(ql(0),!1):!0}function Jd(){if(yn!==null){if(Rn===0)var r=yn.return;else r=yn,Rs=ji=null,dd(r),Do=null,Tl=0,r=yn;for(;r!==null;)Hh(r.alternate,r),r=r.return;yn=null}}function to(r,a){var l=r.timeoutHandle;l!==-1&&(r.timeoutHandle=-1,In(l)),l=r.cancelPendingCommit,l!==null&&(r.cancelPendingCommit=null,l()),pn=0,Jd(),Zn=r,yn=l=_s(r.current,null),xn=a,Rn=0,Ta=null,_i=!1,Vo=Ft(r,a),qd=!1,Go=Na=Kd=Zi=Ts=Sr=0,ha=Hl=null,Xd=!1,(a&8)!==0&&(a|=a&32);var f=r.entangledLanes;if(f!==0)for(r=r.entanglements,f&=a;0<f;){var _=31-tn(f),w=1<<_;a|=r[_],f&=~w}return Es=a,xo(),l}function up(r,a){fn=null,Q.H=No,a===ko||a===Dc?(a=ed(),Rn=3):a===Zu?(a=ed(),Rn=4):Rn=a===Bl?8:a!==null&&typeof a=="object"&&typeof a.then=="function"?6:1,Ta=a,yn===null&&(Sr=1,Gc(r,Ya(a,r.current)))}function dp(){var r=Ba.current;return r===null?!0:(xn&4194048)===xn?La===null:(xn&62914560)===xn||(xn&536870912)!==0?r===La:!1}function Lm(){var r=Q.H;return Q.H=No,r===null?No:r}function fp(){var r=Q.A;return Q.A=Om,r}function au(){Sr=4,_i||(xn&4194048)!==xn&&Ba.current!==null||(Vo=!0),(Ts&134217727)===0&&(Zi&134217727)===0||Zn===null||eo(Zn,xn,Na,!1)}function Zd(r,a,l){var f=$n;$n|=2;var _=Lm(),w=fp();(Zn!==r||xn!==a)&&(eu=null,to(r,a)),a=!1;var F=Sr;e:do try{if(Rn!==0&&yn!==null){var re=yn,ye=Ta;switch(Rn){case 8:Jd(),F=6;break e;case 3:case 2:case 9:case 6:Ba.current===null&&(a=!0);var Fe=Rn;if(Rn=0,Ta=null,Ho(r,re,ye,Fe),l&&Vo){F=0;break e}break;default:Fe=Rn,Rn=0,Ta=null,Ho(r,re,ye,Fe)}}Ql(),F=Sr;break}catch(tt){up(r,tt)}while(!0);return a&&r.shellSuspendCounter++,Rs=ji=null,$n=f,Q.H=_,Q.A=w,yn===null&&(Zn=null,xn=0,xo()),F}function Ql(){for(;yn!==null;)hp(yn)}function Fm(r,a){var l=$n;$n|=2;var f=Lm(),_=fp();Zn!==r||xn!==a?(eu=null,Zc=pt()+500,to(r,a)):Vo=Ft(r,a);e:do try{if(Rn!==0&&yn!==null){a=yn;var w=Ta;t:switch(Rn){case 1:Rn=0,Ta=null,Ho(r,a,w,1);break;case 2:case 9:if(zf(w)){Rn=0,Ta=null,pp(a);break}a=function(){Rn!==2&&Rn!==9||Zn!==r||(Rn=7),Cs(r)},w.then(a,a);break e;case 3:Rn=7;break e;case 4:Rn=5;break e;case 7:zf(w)?(Rn=0,Ta=null,pp(a)):(Rn=0,Ta=null,Ho(r,a,w,7));break;case 5:var F=null;switch(yn.tag){case 26:F=yn.memoizedState;case 5:case 27:var re=yn;if(F?Cy(F):re.stateNode.complete){Rn=0,Ta=null;var ye=re.sibling;if(ye!==null)yn=ye;else{var Fe=re.return;Fe!==null?(yn=Fe,su(Fe)):yn=null}break t}}Rn=0,Ta=null,Ho(r,a,w,5);break;case 6:Rn=0,Ta=null,Ho(r,a,w,6);break;case 8:Jd(),Sr=6;break e;default:throw Error(s(462))}}zm();break}catch(tt){up(r,tt)}while(!0);return Rs=ji=null,Q.H=f,Q.A=_,$n=l,yn!==null?0:(Zn=null,xn=0,xo(),Sr)}function zm(){for(;yn!==null&&!_t();)hp(yn)}function hp(r){var a=Vh(r.alternate,r,Es);r.memoizedProps=r.pendingProps,a===null?su(r):yn=a}function pp(r){var a=r,l=a.alternate;switch(a.tag){case 15:case 0:a=zh(l,a,a.pendingProps,a.type,void 0,xn);break;case 11:a=zh(l,a,a.pendingProps,a.type.render,a.ref,xn);break;case 5:dd(a);default:Hh(l,a),a=yn=Cf(a,Es),a=Vh(l,a,Es)}r.memoizedProps=r.pendingProps,a===null?su(r):yn=a}function Ho(r,a,l,f){Rs=ji=null,dd(a),Do=null,Tl=0;var _=a.return;try{if(Am(r,_,a,l,xn)){Sr=1,Gc(r,Ya(l,r.current)),yn=null;return}}catch(w){if(_!==null)throw yn=_,w;Sr=1,Gc(r,Ya(l,r.current)),yn=null;return}a.flags&32768?(An||f===1?r=!0:Vo||(xn&536870912)!==0?r=!1:(_i=r=!0,(f===2||f===9||f===3||f===6)&&(f=Ba.current,f!==null&&f.tag===13&&(f.flags|=16384))),mp(a,r)):su(a)}function su(r){var a=r;do{if((a.flags&32768)!==0){mp(a,_i);return}r=a.return;var l=Wh(a.alternate,a,Es);if(l!==null){yn=l;return}if(a=a.sibling,a!==null){yn=a;return}yn=a=r}while(a!==null);Sr===0&&(Sr=5)}function mp(r,a){do{var l=Pm(r.alternate,r);if(l!==null){l.flags&=32767,yn=l;return}if(l=r.return,l!==null&&(l.flags|=32768,l.subtreeFlags=0,l.deletions=null),!a&&(r=r.sibling,r!==null)){yn=r;return}yn=r=l}while(r!==null);Sr=6,yn=null}function gp(r,a,l,f,_,w,F,re,ye){r.cancelPendingCommit=null;do iu();while(Jr!==0);if(($n&6)!==0)throw Error(s(327));if(a!==null){if(a===r.current)throw Error(s(177));if(w=a.lanes|a.childLanes,w|=gs,an(r,l,w,F,re,ye),r===Zn&&(yn=Zn=null,xn=0),Wo=a,vi=r,pn=l,sp=w,ip=_,Bm=f,(a.subtreeFlags&10256)!==0||(a.flags&10256)!==0?(r.callbackNode=null,r.callbackPriority=0,Um(Ze,function(){return bp(),null})):(r.callbackNode=null,r.callbackPriority=0),f=(a.flags&13878)!==0,(a.subtreeFlags&13878)!==0||f){f=Q.T,Q.T=null,_=ne.p,ne.p=2,F=$n,$n|=4;try{Vd(r,a,l)}finally{$n=F,ne.p=_,Q.T=f}}Jr=1,Nm(),_p(),vp()}}function Nm(){if(Jr===1){Jr=0;var r=vi,a=Wo,l=(a.flags&13878)!==0;if((a.subtreeFlags&13878)!==0||l){l=Q.T,Q.T=null;var f=ne.p;ne.p=2;var _=$n;$n|=4;try{Wd(a,r);var w=Dt,F=ml(r.containerInfo),re=w.focusedElem,ye=w.selectionRange;if(F!==re&&re&&re.ownerDocument&&Fi(re.ownerDocument.documentElement,re)){if(ye!==null&&yo(re)){var Fe=ye.start,tt=ye.end;if(tt===void 0&&(tt=Fe),"selectionStart"in re)re.selectionStart=Fe,re.selectionEnd=Math.min(tt,re.value.length);else{var st=re.ownerDocument||document,je=st&&st.defaultView||window;if(je.getSelection){var Qe=je.getSelection(),Ot=re.textContent.length,en=Math.min(ye.start,Ot),hr=ye.end===void 0?en:Math.min(ye.end,Ot);!Qe.extend&&en>hr&&(F=hr,hr=en,en=F);var ke=pl(re,en),xe=pl(re,hr);if(ke&&xe&&(Qe.rangeCount!==1||Qe.anchorNode!==ke.node||Qe.anchorOffset!==ke.offset||Qe.focusNode!==xe.node||Qe.focusOffset!==xe.offset)){var Le=st.createRange();Le.setStart(ke.node,ke.offset),Qe.removeAllRanges(),en>hr?(Qe.addRange(Le),Qe.extend(xe.node,xe.offset)):(Le.setEnd(xe.node,xe.offset),Qe.addRange(Le))}}}}for(st=[],Qe=re;Qe=Qe.parentNode;)Qe.nodeType===1&&st.push({element:Qe,left:Qe.scrollLeft,top:Qe.scrollTop});for(typeof re.focus=="function"&&re.focus(),re=0;re<st.length;re++){var at=st[re];at.element.scrollLeft=at.left,at.element.scrollTop=at.top}}ng=!!wt,Dt=wt=null}finally{$n=_,ne.p=f,Q.T=l}}r.current=a,Jr=2}}function _p(){if(Jr===2){Jr=0;var r=vi,a=Wo,l=(a.flags&8772)!==0;if((a.subtreeFlags&8772)!==0||l){l=Q.T,Q.T=null;var f=ne.p;ne.p=2;var _=$n;$n|=4;try{km(r,a.alternate,a)}finally{$n=_,ne.p=f,Q.T=l}}Jr=3}}function vp(){if(Jr===4||Jr===3){Jr=0,Je();var r=vi,a=Wo,l=pn,f=Bm;(a.subtreeFlags&10256)!==0||(a.flags&10256)!==0?Jr=5:(Jr=0,Wo=vi=null,yp(r,r.pendingLanes));var _=r.pendingLanes;if(_===0&&(As=null),oe(l),a=a.stateNode,Cn&&typeof Cn.onCommitFiberRoot=="function")try{Cn.onCommitFiberRoot(Jt,a,void 0,(a.current.flags&128)===128)}catch{}if(f!==null){a=Q.T,_=ne.p,ne.p=2,Q.T=null;try{for(var w=r.onRecoverableError,F=0;F<f.length;F++){var re=f[F];w(re.value,{componentStack:re.stack})}}finally{Q.T=a,ne.p=_}}(pn&3)!==0&&iu(),Cs(r),_=r.pendingLanes,(l&261930)!==0&&(_&42)!==0?r===nu?tu++:(tu=0,nu=r):tu=0,ql(0)}}function yp(r,a){(r.pooledCacheLanes&=a)===0&&(a=r.pooledCache,a!=null&&(r.pooledCache=null,wl(a)))}function iu(){return Nm(),_p(),vp(),bp()}function bp(){if(Jr!==5)return!1;var r=vi,a=sp;sp=0;var l=oe(pn),f=Q.T,_=ne.p;try{ne.p=32>l?32:l,Q.T=null,l=ip,ip=null;var w=vi,F=pn;if(Jr=0,Wo=vi=null,pn=0,($n&6)!==0)throw Error(s(331));var re=$n;if($n|=4,np(w.current),Xc(w,w.current,F,l),$n=re,ql(0,!1),Cn&&typeof Cn.onPostCommitFiberRoot=="function")try{Cn.onPostCommitFiberRoot(Jt,w)}catch{}return!0}finally{ne.p=_,Q.T=f,yp(r,a)}}function wp(r,a,l){a=Ya(l,a),a=kd(r.stateNode,a,2),r=fi(r,a,2),r!==null&&(Kr(r,2),Cs(r))}function Qn(r,a,l){if(r.tag===3)wp(r,r,l);else for(;a!==null;){if(a.tag===3){wp(a,r,l);break}else if(a.tag===1){var f=a.stateNode;if(typeof a.type.getDerivedStateFromError=="function"||typeof f.componentDidCatch=="function"&&(As===null||!As.has(f))){r=Ya(l,r),l=Ph(2),f=fi(a,l,2),f!==null&&(kh(l,f,a,r),Kr(f,2),Cs(f));break}}a=a.return}}function ef(r,a,l){var f=r.pingCache;if(f===null){f=r.pingCache=new $m;var _=new Set;f.set(a,_)}else _=f.get(a),_===void 0&&(_=new Set,f.set(a,_));_.has(l)||(qd=!0,_.add(l),r=Mp.bind(null,r,a,l),a.then(r,r))}function Mp(r,a,l){var f=r.pingCache;f!==null&&f.delete(a),r.pingedLanes|=r.suspendedLanes&l,r.warmLanes&=~l,Zn===r&&(xn&l)===l&&(Sr===4||Sr===3&&(xn&62914560)===xn&&300>pt()-Jc?($n&2)===0&&to(r,0):Kd|=l,Go===xn&&(Go=0)),Cs(r)}function xp(r,a){a===0&&(a=Ha()),r=Ni(r,a),r!==null&&(Kr(r,a),Cs(r))}function Rm(r){var a=r.memoizedState,l=0;a!==null&&(l=a.retryLane),xp(r,l)}function jm(r,a){var l=0;switch(r.tag){case 31:case 13:var f=r.stateNode,_=r.memoizedState;_!==null&&(l=_.retryLane);break;case 19:f=r.stateNode;break;case 22:f=r.stateNode._retryCache;break;default:throw Error(s(314))}f!==null&&f.delete(a),xp(r,l)}function Um(r,a){return $e(r,a)}var ou=null,Qo=null,tf=!1,lu=!1,nf=!1,yi=0;function Cs(r){r!==Qo&&r.next===null&&(Qo===null?ou=Qo=r:Qo=Qo.next=r),lu=!0,tf||(tf=!0,Gm())}function ql(r,a){if(!nf&&lu){nf=!0;do for(var l=!1,f=ou;f!==null;){if(r!==0){var _=f.pendingLanes;if(_===0)var w=0;else{var F=f.suspendedLanes,re=f.pingedLanes;w=(1<<31-tn(42|r)+1)-1,w&=_&~(F&~re),w=w&201326741?w&201326741|1:w?w|2:0}w!==0&&(l=!0,Cp(f,w))}else w=xn,w=Pa(f,f===Zn?w:0,f.cancelPendingCommit!==null||f.timeoutHandle!==-1),(w&3)===0||Ft(f,w)||(l=!0,Cp(f,w));f=f.next}while(l);nf=!1}}function Vm(){Ep()}function Ep(){lu=tf=!1;var r=0;yi!==0&&It()&&(r=yi);for(var a=pt(),l=null,f=ou;f!==null;){var _=f.next,w=Tp(f,a);w===0?(f.next=null,l===null?ou=_:l.next=_,_===null&&(Qo=l)):(l=f,(r!==0||(w&3)!==0)&&(lu=!0)),f=_}Jr!==0&&Jr!==5||ql(r),yi!==0&&(yi=0)}function Tp(r,a){for(var l=r.suspendedLanes,f=r.pingedLanes,_=r.expirationTimes,w=r.pendingLanes&-62914561;0<w;){var F=31-tn(w),re=1<<F,ye=_[F];ye===-1?((re&l)===0||(re&f)!==0)&&(_[F]=ns(re,a)):ye<=a&&(r.expiredLanes|=re),w&=~re}if(a=Zn,l=xn,l=Pa(r,r===a?l:0,r.cancelPendingCommit!==null||r.timeoutHandle!==-1),f=r.callbackNode,l===0||r===a&&(Rn===2||Rn===9)||r.cancelPendingCommit!==null)return f!==null&&f!==null&&qe(f),r.callbackNode=null,r.callbackPriority=0;if((l&3)===0||Ft(r,l)){if(a=l&-l,a===r.callbackPriority)return a;switch(f!==null&&qe(f),oe(l)){case 2:case 8:l=vt;break;case 32:l=Ze;break;case 268435456:l=kt;break;default:l=Ze}return f=Ap.bind(null,r),l=$e(l,f),r.callbackPriority=a,r.callbackNode=l,a}return f!==null&&f!==null&&qe(f),r.callbackPriority=2,r.callbackNode=null,2}function Ap(r,a){if(Jr!==0&&Jr!==5)return r.callbackNode=null,r.callbackPriority=0,null;var l=r.callbackNode;if(iu()&&r.callbackNode!==l)return null;var f=xn;return f=Pa(r,r===Zn?f:0,r.cancelPendingCommit!==null||r.timeoutHandle!==-1),f===0?null:(lp(r,f,a),Tp(r,pt()),r.callbackNode!=null&&r.callbackNode===l?Ap.bind(null,r):null)}function Cp(r,a){if(iu())return null;lp(r,a,!0)}function Gm(){sr(function(){($n&6)!==0?$e(Gt,Vm):Ep()})}function rf(){if(yi===0){var r=Io;r===0&&(r=Wa,Wa<<=1,(Wa&261888)===0&&(Wa=256)),yi=r}return yi}function Sp(r){return r==null||typeof r=="symbol"||typeof r=="boolean"?null:typeof r=="function"?r:Vt(""+r)}function Ip(r,a){var l=a.ownerDocument.createElement("input");return l.name=a.name,l.value=a.value,r.id&&l.setAttribute("form",r.id),a.parentNode.insertBefore(l,a),r=new FormData(r),l.parentNode.removeChild(l),r}function Wm(r,a,l,f,_){if(a==="submit"&&l&&l.stateNode===_){var w=Sp((_[ct]||null).action),F=f.submitter;F&&(a=(a=F[ct]||null)?Sp(a.formAction):F.getAttribute("formAction"),a!==null&&(w=a,F=null));var re=new aa("action","action",null,f,_);r.push({event:re,listeners:[{instance:null,listener:function(){if(f.defaultPrevented){if(yi!==0){var ye=F?Ip(_,F):new FormData(_);Md(l,{pending:!0,data:ye,method:_.method,action:w},null,ye)}}else typeof w=="function"&&(re.preventDefault(),ye=F?Ip(_,F):new FormData(_),Md(l,{pending:!0,data:ye,method:_.method,action:w},w,ye))},currentTarget:_}]})}}for(var af=0;af<St.length;af++){var sf=St[af],Hm=sf.toLowerCase(),Qm=sf[0].toUpperCase()+sf.slice(1);Rt(Hm,"on"+Qm)}Rt($,"onAnimationEnd"),Rt(W,"onAnimationIteration"),Rt(J,"onAnimationStart"),Rt("dblclick","onDoubleClick"),Rt("focusin","onFocus"),Rt("focusout","onBlur"),Rt(ie,"onTransitionRun"),Rt(Ee,"onTransitionStart"),Rt(Xe,"onTransitionCancel"),Rt(ot,"onTransitionEnd"),Pr("onMouseEnter",["mouseout","mouseover"]),Pr("onMouseLeave",["mouseout","mouseover"]),Pr("onPointerEnter",["pointerout","pointerover"]),Pr("onPointerLeave",["pointerout","pointerover"]),na("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),na("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),na("onBeforeInput",["compositionend","keypress","textInput","paste"]),na("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),na("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),na("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Kl="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),qm=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(Kl));function Pp(r,a){a=(a&4)!==0;for(var l=0;l<r.length;l++){var f=r[l],_=f.event;f=f.listeners;e:{var w=void 0;if(a)for(var F=f.length-1;0<=F;F--){var re=f[F],ye=re.instance,Fe=re.currentTarget;if(re=re.listener,ye!==w&&_.isPropagationStopped())break e;w=re,_.currentTarget=Fe;try{w(_)}catch(tt){_n(tt)}_.currentTarget=null,w=ye}else for(F=0;F<f.length;F++){if(re=f[F],ye=re.instance,Fe=re.currentTarget,re=re.listener,ye!==w&&_.isPropagationStopped())break e;w=re,_.currentTarget=Fe;try{w(_)}catch(tt){_n(tt)}_.currentTarget=null,w=ye}}}}function Mn(r,a){var l=a[Tt];l===void 0&&(l=a[Tt]=new Set);var f=r+"__bubble";l.has(f)||(Ur(a,r,2,!1),l.add(f))}function kp(r,a,l){var f=0;a&&(f|=4),Ur(l,r,f,a)}var qt="_reactListening"+Math.random().toString(36).slice(2);function of(r){if(!r[qt]){r[qt]=!0,Tr.forEach(function(l){l!=="selectionchange"&&(qm.has(l)||kp(l,!1,r),kp(l,!0,r))});var a=r.nodeType===9?r:r.ownerDocument;a===null||a[qt]||(a[qt]=!0,kp("selectionchange",!1,a))}}function Ur(r,a,l,f){switch($y(a)){case 2:var _=MC;break;case 8:_=xC;break;default:_=M_}l=_.bind(null,a,l,r),_=void 0,!Wn||a!=="touchstart"&&a!=="touchmove"&&a!=="wheel"||(_=!0),f?_!==void 0?r.addEventListener(a,l,{capture:!0,passive:_}):r.addEventListener(a,l,!0):_!==void 0?r.addEventListener(a,l,{passive:_}):r.addEventListener(a,l,!1)}function Vr(r,a,l,f,_){var w=f;if((a&1)===0&&(a&2)===0&&f!==null)e:for(;;){if(f===null)return;var F=f.tag;if(F===3||F===4){var re=f.stateNode.containerInfo;if(re===_)break;if(F===4)for(F=f.return;F!==null;){var ye=F.tag;if((ye===3||ye===4)&&F.stateNode.containerInfo===_)return;F=F.return}for(;re!==null;){if(F=Gn(re),F===null)return;if(ye=F.tag,ye===5||ye===6||ye===26||ye===27){f=w=F;continue e}re=re.parentNode}}f=f.return}Dr(function(){var Fe=w,tt=Jn(l),st=[];e:{var je=Mt.get(r);if(je!==void 0){var Qe=aa,Ot=r;switch(r){case"keypress":if(Ea(l)===0)break e;case"keydown":case"keyup":Qe=hc;break;case"focusin":Ot="focus",Qe=sl;break;case"focusout":Ot="blur",Qe=sl;break;case"beforeblur":case"afterblur":Qe=sl;break;case"click":if(l.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":Qe=cc;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":Qe=Su;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":Qe=Tf;break;case $:case W:case J:Qe=ku;break;case ot:Qe=mc;break;case"scroll":case"scrollend":Qe=Ls;break;case"wheel":Qe=uo;break;case"copy":case"cut":case"paste":Qe=Du;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":Qe=pc;break;case"toggle":case"beforetoggle":Qe=Fu}var en=(a&4)!==0,hr=!en&&(r==="scroll"||r==="scrollend"),ke=en?je!==null?je+"Capture":null:je;en=[];for(var xe=Fe,Le;xe!==null;){var at=xe;if(Le=at.stateNode,at=at.tag,at!==5&&at!==26&&at!==27||Le===null||ke===null||(at=Mr(xe,ke),at!=null&&en.push(Gr(xe,at,Le))),hr)break;xe=xe.return}0<en.length&&(je=new Qe(je,Ot,null,l,tt),st.push({event:je,listeners:en}))}}if((a&7)===0){e:{if(je=r==="mouseover"||r==="pointerover",Qe=r==="mouseout"||r==="pointerout",je&&l!==vn&&(Ot=l.relatedTarget||l.fromElement)&&(Gn(Ot)||Ot[ft]))break e;if((Qe||je)&&(je=tt.window===tt?tt:(je=tt.ownerDocument)?je.defaultView||je.parentWindow:window,Qe?(Ot=l.relatedTarget||l.toElement,Qe=Fe,Ot=Ot?Gn(Ot):null,Ot!==null&&(hr=o(Ot),en=Ot.tag,Ot!==hr||en!==5&&en!==27&&en!==6)&&(Ot=null)):(Qe=null,Ot=Fe),Qe!==Ot)){if(en=cc,at="onMouseLeave",ke="onMouseEnter",xe="mouse",(r==="pointerout"||r==="pointerover")&&(en=pc,at="onPointerLeave",ke="onPointerEnter",xe="pointer"),hr=Qe==null?je:Ir(Qe),Le=Ot==null?je:Ir(Ot),je=new en(at,xe+"leave",Qe,l,tt),je.target=hr,je.relatedTarget=Le,at=null,Gn(tt)===Fe&&(en=new en(ke,xe+"enter",Ot,l,tt),en.target=Le,en.relatedTarget=hr,at=en),hr=at,Qe&&Ot)t:{for(en=h_,ke=Qe,xe=Ot,Le=0,at=ke;at;at=en(at))Le++;at=0;for(var Ht=xe;Ht;Ht=en(Ht))at++;for(;0<Le-at;)ke=en(ke),Le--;for(;0<at-Le;)xe=en(xe),at--;for(;Le--;){if(ke===xe||xe!==null&&ke===xe.alternate){en=ke;break t}ke=en(ke),xe=en(xe)}en=null}else en=null;Qe!==null&&Dp(st,je,Qe,en,!1),Ot!==null&&hr!==null&&Dp(st,hr,Ot,en,!0)}}e:{if(je=Fe?Ir(Fe):window,Qe=je.nodeName&&je.nodeName.toLowerCase(),Qe==="select"||Qe==="input"&&je.type==="file")var jn=ho;else if(as(je))if(yc)jn=Da;else{jn=wc;var jt=bc}else Qe=je.nodeName,!Qe||Qe.toLowerCase()!=="input"||je.type!=="checkbox"&&je.type!=="radio"?Fe&&bt(Fe.elementType)&&(jn=ho):jn=_o;if(jn&&(jn=jn(r,Fe))){fl(st,jn,l,tt);break e}jt&&jt(r,je,Fe),r==="focusout"&&Fe&&je.type==="number"&&Fe.memoizedProps.value!=null&&Ie(je,"number",je.value)}switch(jt=Fe?Ir(Fe):window,r){case"focusin":(as(jt)||jt.contentEditable==="true")&&(ss=jt,zi=Fe,ms=null);break;case"focusout":ms=zi=ss=null;break;case"mousedown":bo=!0;break;case"contextmenu":case"mouseup":case"dragend":bo=!1,_l(st,l,tt);break;case"selectionchange":if(gl)break;case"keydown":case"keyup":_l(st,l,tt)}var bn;if(ul)e:{switch(r){case"compositionstart":var kn="onCompositionStart";break e;case"compositionend":kn="onCompositionEnd";break e;case"compositionupdate":kn="onCompositionUpdate";break e}kn=void 0}else rs?si(r,l)&&(kn="onCompositionEnd"):r==="keydown"&&l.keyCode===229&&(kn="onCompositionStart");kn&&(dl&&l.locale!=="ko"&&(rs||kn!=="onCompositionStart"?kn==="onCompositionEnd"&&rs&&(bn=Xr()):(cr=tt,va="value"in cr?cr.value:cr.textContent,rs=!0)),jt=Ss(Fe,kn),0<jt.length&&(kn=new uc(kn,r,null,l,tt),st.push({event:kn,listeners:jt}),bn?kn.data=bn:(bn=ii(l),bn!==null&&(kn.data=bn)))),(bn=Nu?vc(r,l):Ru(r,l))&&(kn=Ss(Fe,"onBeforeInput"),0<kn.length&&(jt=new uc("onBeforeInput","beforeinput",null,l,tt),st.push({event:jt,listeners:kn}),jt.data=bn)),Wm(st,r,Fe,l,tt)}Pp(st,a)})}function Gr(r,a,l){return{instance:r,listener:a,currentTarget:l}}function Ss(r,a){for(var l=a+"Capture",f=[];r!==null;){var _=r,w=_.stateNode;if(_=_.tag,_!==5&&_!==26&&_!==27||w===null||(_=Mr(r,l),_!=null&&f.unshift(Gr(r,_,w)),_=Mr(r,a),_!=null&&f.push(Gr(r,_,w))),r.tag===3)return f;r=r.return}return[]}function h_(r){if(r===null)return null;do r=r.return;while(r&&r.tag!==5&&r.tag!==27);return r||null}function Dp(r,a,l,f,_){for(var w=a._reactName,F=[];l!==null&&l!==f;){var re=l,ye=re.alternate,Fe=re.stateNode;if(re=re.tag,ye!==null&&ye===f)break;re!==5&&re!==26&&re!==27||Fe===null||(ye=Fe,_?(Fe=Mr(l,w),Fe!=null&&F.unshift(Gr(l,Fe,ye))):_||(Fe=Mr(l,w),Fe!=null&&F.push(Gr(l,Fe,ye)))),l=l.return}F.length!==0&&r.push({event:a,listeners:F})}var Km=/\r\n?/g,P=/\u0000|\uFFFD/g;function B(r){return(typeof r=="string"?r:""+r).replace(Km,`
`).replace(P,"")}function K(r,a){return a=B(a),B(r)===a}function _e(r,a,l,f,_,w){switch(l){case"children":typeof f=="string"?a==="body"||a==="textarea"&&f===""||be(r,f):(typeof f=="number"||typeof f=="bigint")&&a!=="body"&&be(r,""+f);break;case"className":Ka(r,"class",f);break;case"tabIndex":Ka(r,"tabindex",f);break;case"dir":case"role":case"viewBox":case"width":case"height":Ka(r,l,f);break;case"style":ht(r,f,w);break;case"data":if(a!=="object"){Ka(r,"data",f);break}case"src":case"href":if(f===""&&(a!=="a"||l!=="href")){r.removeAttribute(l);break}if(f==null||typeof f=="function"||typeof f=="symbol"||typeof f=="boolean"){r.removeAttribute(l);break}f=Vt(""+f),r.setAttribute(l,f);break;case"action":case"formAction":if(typeof f=="function"){r.setAttribute(l,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof w=="function"&&(l==="formAction"?(a!=="input"&&_e(r,a,"name",_.name,_,null),_e(r,a,"formEncType",_.formEncType,_,null),_e(r,a,"formMethod",_.formMethod,_,null),_e(r,a,"formTarget",_.formTarget,_,null)):(_e(r,a,"encType",_.encType,_,null),_e(r,a,"method",_.method,_,null),_e(r,a,"target",_.target,_,null)));if(f==null||typeof f=="symbol"||typeof f=="boolean"){r.removeAttribute(l);break}f=Vt(""+f),r.setAttribute(l,f);break;case"onClick":f!=null&&(r.onclick=un);break;case"onScroll":f!=null&&Mn("scroll",r);break;case"onScrollEnd":f!=null&&Mn("scrollend",r);break;case"dangerouslySetInnerHTML":if(f!=null){if(typeof f!="object"||!("__html"in f))throw Error(s(61));if(l=f.__html,l!=null){if(_.children!=null)throw Error(s(60));r.innerHTML=l}}break;case"multiple":r.multiple=f&&typeof f!="function"&&typeof f!="symbol";break;case"muted":r.muted=f&&typeof f!="function"&&typeof f!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(f==null||typeof f=="function"||typeof f=="boolean"||typeof f=="symbol"){r.removeAttribute("xlink:href");break}l=Vt(""+f),r.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",l);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":f!=null&&typeof f!="function"&&typeof f!="symbol"?r.setAttribute(l,""+f):r.removeAttribute(l);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":f&&typeof f!="function"&&typeof f!="symbol"?r.setAttribute(l,""):r.removeAttribute(l);break;case"capture":case"download":f===!0?r.setAttribute(l,""):f!==!1&&f!=null&&typeof f!="function"&&typeof f!="symbol"?r.setAttribute(l,f):r.removeAttribute(l);break;case"cols":case"rows":case"size":case"span":f!=null&&typeof f!="function"&&typeof f!="symbol"&&!isNaN(f)&&1<=f?r.setAttribute(l,f):r.removeAttribute(l);break;case"rowSpan":case"start":f==null||typeof f=="function"||typeof f=="symbol"||isNaN(f)?r.removeAttribute(l):r.setAttribute(l,f);break;case"popover":Mn("beforetoggle",r),Mn("toggle",r),qa(r,"popover",f);break;case"xlinkActuate":ra(r,"http://www.w3.org/1999/xlink","xlink:actuate",f);break;case"xlinkArcrole":ra(r,"http://www.w3.org/1999/xlink","xlink:arcrole",f);break;case"xlinkRole":ra(r,"http://www.w3.org/1999/xlink","xlink:role",f);break;case"xlinkShow":ra(r,"http://www.w3.org/1999/xlink","xlink:show",f);break;case"xlinkTitle":ra(r,"http://www.w3.org/1999/xlink","xlink:title",f);break;case"xlinkType":ra(r,"http://www.w3.org/1999/xlink","xlink:type",f);break;case"xmlBase":ra(r,"http://www.w3.org/XML/1998/namespace","xml:base",f);break;case"xmlLang":ra(r,"http://www.w3.org/XML/1998/namespace","xml:lang",f);break;case"xmlSpace":ra(r,"http://www.w3.org/XML/1998/namespace","xml:space",f);break;case"is":qa(r,"is",f);break;case"innerText":case"textContent":break;default:(!(2<l.length)||l[0]!=="o"&&l[0]!=="O"||l[1]!=="n"&&l[1]!=="N")&&(l=yt.get(l)||l,qa(r,l,f))}}function De(r,a,l,f,_,w){switch(l){case"style":ht(r,f,w);break;case"dangerouslySetInnerHTML":if(f!=null){if(typeof f!="object"||!("__html"in f))throw Error(s(61));if(l=f.__html,l!=null){if(_.children!=null)throw Error(s(60));r.innerHTML=l}}break;case"children":typeof f=="string"?be(r,f):(typeof f=="number"||typeof f=="bigint")&&be(r,""+f);break;case"onScroll":f!=null&&Mn("scroll",r);break;case"onScrollEnd":f!=null&&Mn("scrollend",r);break;case"onClick":f!=null&&(r.onclick=un);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!Bs.hasOwnProperty(l))e:{if(l[0]==="o"&&l[1]==="n"&&(_=l.endsWith("Capture"),a=l.slice(2,_?l.length-7:void 0),w=r[ct]||null,w=w!=null?w[l]:null,typeof w=="function"&&r.removeEventListener(a,w,_),typeof f=="function")){typeof w!="function"&&w!==null&&(l in r?r[l]=null:r.hasAttribute(l)&&r.removeAttribute(l)),r.addEventListener(a,f,_);break e}l in r?r[l]=f:f===!0?r.setAttribute(l,""):qa(r,l,f)}}}function Ae(r,a,l){switch(a){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":Mn("error",r),Mn("load",r);var f=!1,_=!1,w;for(w in l)if(l.hasOwnProperty(w)){var F=l[w];if(F!=null)switch(w){case"src":f=!0;break;case"srcSet":_=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(s(137,a));default:_e(r,a,w,F,l,null)}}_&&_e(r,a,"srcSet",l.srcSet,l,null),f&&_e(r,a,"src",l.src,l,null);return;case"input":Mn("invalid",r);var re=w=F=_=null,ye=null,Fe=null;for(f in l)if(l.hasOwnProperty(f)){var tt=l[f];if(tt!=null)switch(f){case"name":_=tt;break;case"type":F=tt;break;case"checked":ye=tt;break;case"defaultChecked":Fe=tt;break;case"value":w=tt;break;case"defaultValue":re=tt;break;case"children":case"dangerouslySetInnerHTML":if(tt!=null)throw Error(s(137,a));break;default:_e(r,a,f,tt,l,null)}}Pi(r,w,re,ye,Fe,F,_,!1);return;case"select":Mn("invalid",r),f=F=w=null;for(_ in l)if(l.hasOwnProperty(_)&&(re=l[_],re!=null))switch(_){case"value":w=re;break;case"defaultValue":F=re;break;case"multiple":f=re;default:_e(r,a,_,re,l,null)}a=w,l=F,r.multiple=!!f,a!=null?V(r,!!f,a,!1):l!=null&&V(r,!!f,l,!0);return;case"textarea":Mn("invalid",r),w=_=f=null;for(F in l)if(l.hasOwnProperty(F)&&(re=l[F],re!=null))switch(F){case"value":f=re;break;case"defaultValue":_=re;break;case"children":w=re;break;case"dangerouslySetInnerHTML":if(re!=null)throw Error(s(91));break;default:_e(r,a,F,re,l,null)}me(r,f,_,w);return;case"option":for(ye in l)if(l.hasOwnProperty(ye)&&(f=l[ye],f!=null))switch(ye){case"selected":r.selected=f&&typeof f!="function"&&typeof f!="symbol";break;default:_e(r,a,ye,f,l,null)}return;case"dialog":Mn("beforetoggle",r),Mn("toggle",r),Mn("cancel",r),Mn("close",r);break;case"iframe":case"object":Mn("load",r);break;case"video":case"audio":for(f=0;f<Kl.length;f++)Mn(Kl[f],r);break;case"image":Mn("error",r),Mn("load",r);break;case"details":Mn("toggle",r);break;case"embed":case"source":case"link":Mn("error",r),Mn("load",r);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(Fe in l)if(l.hasOwnProperty(Fe)&&(f=l[Fe],f!=null))switch(Fe){case"children":case"dangerouslySetInnerHTML":throw Error(s(137,a));default:_e(r,a,Fe,f,l,null)}return;default:if(bt(a)){for(tt in l)l.hasOwnProperty(tt)&&(f=l[tt],f!==void 0&&De(r,a,tt,f,l,void 0));return}}for(re in l)l.hasOwnProperty(re)&&(f=l[re],f!=null&&_e(r,a,re,f,l,null))}function Ve(r,a,l,f){switch(a){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var _=null,w=null,F=null,re=null,ye=null,Fe=null,tt=null;for(Qe in l){var st=l[Qe];if(l.hasOwnProperty(Qe)&&st!=null)switch(Qe){case"checked":break;case"value":break;case"defaultValue":ye=st;default:f.hasOwnProperty(Qe)||_e(r,a,Qe,null,f,st)}}for(var je in f){var Qe=f[je];if(st=l[je],f.hasOwnProperty(je)&&(Qe!=null||st!=null))switch(je){case"type":w=Qe;break;case"name":_=Qe;break;case"checked":Fe=Qe;break;case"defaultChecked":tt=Qe;break;case"value":F=Qe;break;case"defaultValue":re=Qe;break;case"children":case"dangerouslySetInnerHTML":if(Qe!=null)throw Error(s(137,a));break;default:Qe!==st&&_e(r,a,je,Qe,f,st)}}ps(r,F,re,ye,Fe,tt,w,_);return;case"select":Qe=F=re=je=null;for(w in l)if(ye=l[w],l.hasOwnProperty(w)&&ye!=null)switch(w){case"value":break;case"multiple":Qe=ye;default:f.hasOwnProperty(w)||_e(r,a,w,null,f,ye)}for(_ in f)if(w=f[_],ye=l[_],f.hasOwnProperty(_)&&(w!=null||ye!=null))switch(_){case"value":je=w;break;case"defaultValue":re=w;break;case"multiple":F=w;default:w!==ye&&_e(r,a,_,w,f,ye)}a=re,l=F,f=Qe,je!=null?V(r,!!l,je,!1):!!f!=!!l&&(a!=null?V(r,!!l,a,!0):V(r,!!l,l?[]:"",!1));return;case"textarea":Qe=je=null;for(re in l)if(_=l[re],l.hasOwnProperty(re)&&_!=null&&!f.hasOwnProperty(re))switch(re){case"value":break;case"children":break;default:_e(r,a,re,null,f,_)}for(F in f)if(_=f[F],w=l[F],f.hasOwnProperty(F)&&(_!=null||w!=null))switch(F){case"value":je=_;break;case"defaultValue":Qe=_;break;case"children":break;case"dangerouslySetInnerHTML":if(_!=null)throw Error(s(91));break;default:_!==w&&_e(r,a,F,_,f,w)}se(r,je,Qe);return;case"option":for(var Ot in l)if(je=l[Ot],l.hasOwnProperty(Ot)&&je!=null&&!f.hasOwnProperty(Ot))switch(Ot){case"selected":r.selected=!1;break;default:_e(r,a,Ot,null,f,je)}for(ye in f)if(je=f[ye],Qe=l[ye],f.hasOwnProperty(ye)&&je!==Qe&&(je!=null||Qe!=null))switch(ye){case"selected":r.selected=je&&typeof je!="function"&&typeof je!="symbol";break;default:_e(r,a,ye,je,f,Qe)}return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var en in l)je=l[en],l.hasOwnProperty(en)&&je!=null&&!f.hasOwnProperty(en)&&_e(r,a,en,null,f,je);for(Fe in f)if(je=f[Fe],Qe=l[Fe],f.hasOwnProperty(Fe)&&je!==Qe&&(je!=null||Qe!=null))switch(Fe){case"children":case"dangerouslySetInnerHTML":if(je!=null)throw Error(s(137,a));break;default:_e(r,a,Fe,je,f,Qe)}return;default:if(bt(a)){for(var hr in l)je=l[hr],l.hasOwnProperty(hr)&&je!==void 0&&!f.hasOwnProperty(hr)&&De(r,a,hr,void 0,f,je);for(tt in f)je=f[tt],Qe=l[tt],!f.hasOwnProperty(tt)||je===Qe||je===void 0&&Qe===void 0||De(r,a,tt,je,f,Qe);return}}for(var ke in l)je=l[ke],l.hasOwnProperty(ke)&&je!=null&&!f.hasOwnProperty(ke)&&_e(r,a,ke,null,f,je);for(st in f)je=f[st],Qe=l[st],!f.hasOwnProperty(st)||je===Qe||je==null&&Qe==null||_e(r,a,st,je,f,Qe)}function it(r){switch(r){case"css":case"script":case"font":case"img":case"image":case"input":case"link":return!0;default:return!1}}function gt(){if(typeof performance.getEntriesByType=="function"){for(var r=0,a=0,l=performance.getEntriesByType("resource"),f=0;f<l.length;f++){var _=l[f],w=_.transferSize,F=_.initiatorType,re=_.duration;if(w&&re&&it(F)){for(F=0,re=_.responseEnd,f+=1;f<l.length;f++){var ye=l[f],Fe=ye.startTime;if(Fe>re)break;var tt=ye.transferSize,st=ye.initiatorType;tt&&it(st)&&(ye=ye.responseEnd,F+=tt*(ye<re?1:(re-Fe)/(ye-Fe)))}if(--f,a+=8*(w+F)/(_.duration/1e3),r++,10<r)break}}if(0<r)return a/r/1e6}return navigator.connection&&(r=navigator.connection.downlink,typeof r=="number")?r:5}var wt=null,Dt=null;function Ut(r){return r.nodeType===9?r:r.ownerDocument}function Wt(r){switch(r){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function hn(r,a){if(r===0)switch(a){case"svg":return 1;case"math":return 2;default:return 0}return r===1&&a==="foreignObject"?0:r}function Lt(r,a){return r==="textarea"||r==="noscript"||typeof a.children=="string"||typeof a.children=="number"||typeof a.children=="bigint"||typeof a.dangerouslySetInnerHTML=="object"&&a.dangerouslySetInnerHTML!==null&&a.dangerouslySetInnerHTML.__html!=null}var Kt=null;function It(){var r=window.event;return r&&r.type==="popstate"?r===Kt?!1:(Kt=r,!0):(Kt=null,!1)}var on=typeof setTimeout=="function"?setTimeout:void 0,In=typeof clearTimeout=="function"?clearTimeout:void 0,qn=typeof Promise=="function"?Promise:void 0,sr=typeof queueMicrotask=="function"?queueMicrotask:typeof qn<"u"?function(r){return qn.resolve(null).then(r).catch(fr)}:on;function fr(r){setTimeout(function(){throw r})}function er(r){return r==="head"}function Zr(r,a){var l=a,f=0;do{var _=l.nextSibling;if(r.removeChild(l),_&&_.nodeType===8)if(l=_.data,l==="/$"||l==="/&"){if(f===0){r.removeChild(_),uf(a);return}f--}else if(l==="$"||l==="$?"||l==="$~"||l==="$!"||l==="&")f++;else if(l==="html")Is(r.ownerDocument.documentElement);else if(l==="head"){l=r.ownerDocument.head,Is(l);for(var w=l.firstChild;w;){var F=w.nextSibling,re=w.nodeName;w[Zt]||re==="SCRIPT"||re==="STYLE"||re==="LINK"&&w.rel.toLowerCase()==="stylesheet"||l.removeChild(w),w=F}}else l==="body"&&Is(r.ownerDocument.body);l=_}while(l);uf(a)}function ln(r,a){var l=r;r=0;do{var f=l.nextSibling;if(l.nodeType===1?a?(l._stashedDisplay=l.style.display,l.style.display="none"):(l.style.display=l._stashedDisplay||"",l.getAttribute("style")===""&&l.removeAttribute("style")):l.nodeType===3&&(a?(l._stashedText=l.nodeValue,l.nodeValue=""):l.nodeValue=l._stashedText||""),f&&f.nodeType===8)if(l=f.data,l==="/$"){if(r===0)break;r--}else l!=="$"&&l!=="$?"&&l!=="$~"&&l!=="$!"||r++;l=f}while(l)}function Br(r){var a=r.firstChild;for(a&&a.nodeType===10&&(a=a.nextSibling);a;){var l=a;switch(a=a.nextSibling,l.nodeName){case"HTML":case"HEAD":case"BODY":Br(l),wn(l);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(l.rel.toLowerCase()==="stylesheet")continue}r.removeChild(l)}}function es(r,a,l,f){for(;r.nodeType===1;){var _=l;if(r.nodeName.toLowerCase()!==a.toLowerCase()){if(!f&&(r.nodeName!=="INPUT"||r.type!=="hidden"))break}else if(f){if(!r[Zt])switch(a){case"meta":if(!r.hasAttribute("itemprop"))break;return r;case"link":if(w=r.getAttribute("rel"),w==="stylesheet"&&r.hasAttribute("data-precedence"))break;if(w!==_.rel||r.getAttribute("href")!==(_.href==null||_.href===""?null:_.href)||r.getAttribute("crossorigin")!==(_.crossOrigin==null?null:_.crossOrigin)||r.getAttribute("title")!==(_.title==null?null:_.title))break;return r;case"style":if(r.hasAttribute("data-precedence"))break;return r;case"script":if(w=r.getAttribute("src"),(w!==(_.src==null?null:_.src)||r.getAttribute("type")!==(_.type==null?null:_.type)||r.getAttribute("crossorigin")!==(_.crossOrigin==null?null:_.crossOrigin))&&w&&r.hasAttribute("async")&&!r.hasAttribute("itemprop"))break;return r;default:return r}}else if(a==="input"&&r.type==="hidden"){var w=_.name==null?null:""+_.name;if(_.type==="hidden"&&r.getAttribute("name")===w)return r}else return r;if(r=Ca(r.nextSibling),r===null)break}return null}function qo(r,a,l){if(a==="")return null;for(;r.nodeType!==3;)if((r.nodeType!==1||r.nodeName!=="INPUT"||r.type!=="hidden")&&!l||(r=Ca(r.nextSibling),r===null))return null;return r}function ba(r,a){for(;r.nodeType!==8;)if((r.nodeType!==1||r.nodeName!=="INPUT"||r.type!=="hidden")&&!a||(r=Ca(r.nextSibling),r===null))return null;return r}function ja(r){return r.data==="$?"||r.data==="$~"}function Xl(r){return r.data==="$!"||r.data==="$?"&&r.ownerDocument.readyState!=="loading"}function Ko(r,a){var l=r.ownerDocument;if(r.data==="$~")r._reactRetry=a;else if(r.data!=="$?"||l.readyState!=="loading")a();else{var f=function(){a(),l.removeEventListener("DOMContentLoaded",f)};l.addEventListener("DOMContentLoaded",f),r._reactRetry=f}}function Ca(r){for(;r!=null;r=r.nextSibling){var a=r.nodeType;if(a===1||a===3)break;if(a===8){if(a=r.data,a==="$"||a==="$!"||a==="$?"||a==="$~"||a==="&"||a==="F!"||a==="F")break;if(a==="/$"||a==="/&")return null}}return r}var Yl=null;function ir(r){r=r.nextSibling;for(var a=0;r;){if(r.nodeType===8){var l=r.data;if(l==="/$"||l==="/&"){if(a===0)return Ca(r.nextSibling);a--}else l!=="$"&&l!=="$!"&&l!=="$?"&&l!=="$~"&&l!=="&"||a++}r=r.nextSibling}return null}function Wr(r){r=r.previousSibling;for(var a=0;r;){if(r.nodeType===8){var l=r.data;if(l==="$"||l==="$!"||l==="$?"||l==="$~"||l==="&"){if(a===0)return r;a--}else l!=="/$"&&l!=="/&"||a++}r=r.previousSibling}return null}function bi(r,a,l){switch(a=Ut(l),r){case"html":if(r=a.documentElement,!r)throw Error(s(452));return r;case"head":if(r=a.head,!r)throw Error(s(453));return r;case"body":if(r=a.body,!r)throw Error(s(454));return r;default:throw Error(s(451))}}function Is(r){for(var a=r.attributes;a.length;)r.removeAttributeNode(a[0]);wn(r)}var pa=new Map,cu=new Set;function Jl(r){return typeof r.getRootNode=="function"?r.getRootNode():r.nodeType===9?r:r.ownerDocument}var Ps=ne.d;ne.d={f:Op,r:p_,D:$p,C:Xm,L:Bp,m:lf,X:g_,S:m_,M:__};function Op(){var r=Ps.f(),a=ru();return r||a}function p_(r){var a=or(r);a!==null&&a.tag===5&&a.type==="form"?xd(a):Ps.r(r)}var no=typeof document>"u"?null:document;function uu(r,a,l){var f=no;if(f&&typeof a=="string"&&a){var _=Fr(a);_='link[rel="'+r+'"][href="'+_+'"]',typeof l=="string"&&(_+='[crossorigin="'+l+'"]'),cu.has(_)||(cu.add(_),r={rel:r,crossOrigin:l,href:a},f.querySelector(_)===null&&(a=f.createElement("link"),Ae(a,"link",r),nr(a),f.head.appendChild(a)))}}function $p(r){Ps.D(r),uu("dns-prefetch",r,null)}function Xm(r,a){Ps.C(r,a),uu("preconnect",r,a)}function Bp(r,a,l){Ps.L(r,a,l);var f=no;if(f&&r&&a){var _='link[rel="preload"][as="'+Fr(a)+'"]';a==="image"&&l&&l.imageSrcSet?(_+='[imagesrcset="'+Fr(l.imageSrcSet)+'"]',typeof l.imageSizes=="string"&&(_+='[imagesizes="'+Fr(l.imageSizes)+'"]')):_+='[href="'+Fr(r)+'"]';var w=_;switch(a){case"style":w=wa(r);break;case"script":w=cf(r)}pa.has(w)||(r=p({rel:"preload",href:a==="image"&&l&&l.imageSrcSet?void 0:r,as:a},l),pa.set(w,r),f.querySelector(_)!==null||a==="style"&&f.querySelector(Lp(w))||a==="script"&&f.querySelector(Fp(w))||(a=f.createElement("link"),Ae(a,"link",r),nr(a),f.head.appendChild(a)))}}function lf(r,a){Ps.m(r,a);var l=no;if(l&&r){var f=a&&typeof a.as=="string"?a.as:"script",_='link[rel="modulepreload"][as="'+Fr(f)+'"][href="'+Fr(r)+'"]',w=_;switch(f){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":w=cf(r)}if(!pa.has(w)&&(r=p({rel:"modulepreload",href:r},a),pa.set(w,r),l.querySelector(_)===null)){switch(f){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(l.querySelector(Fp(w)))return}f=l.createElement("link"),Ae(f,"link",r),nr(f),l.head.appendChild(f)}}}function m_(r,a,l){Ps.S(r,a,l);var f=no;if(f&&r){var _=_a(f).hoistableStyles,w=wa(r);a=a||"default";var F=_.get(w);if(!F){var re={loading:0,preload:null};if(F=f.querySelector(Lp(w)))re.loading=5;else{r=p({rel:"stylesheet",href:r,"data-precedence":a},l),(l=pa.get(w))&&v_(r,l);var ye=F=f.createElement("link");nr(ye),Ae(ye,"link",r),ye._p=new Promise(function(Fe,tt){ye.onload=Fe,ye.onerror=tt}),ye.addEventListener("load",function(){re.loading|=1}),ye.addEventListener("error",function(){re.loading|=2}),re.loading|=4,Ym(F,a,f)}F={type:"stylesheet",instance:F,count:1,state:re},_.set(w,F)}}}function g_(r,a){Ps.X(r,a);var l=no;if(l&&r){var f=_a(l).hoistableScripts,_=cf(r),w=f.get(_);w||(w=l.querySelector(Fp(_)),w||(r=p({src:r,async:!0},a),(a=pa.get(_))&&y_(r,a),w=l.createElement("script"),nr(w),Ae(w,"link",r),l.head.appendChild(w)),w={type:"script",instance:w,count:1,state:null},f.set(_,w))}}function __(r,a){Ps.M(r,a);var l=no;if(l&&r){var f=_a(l).hoistableScripts,_=cf(r),w=f.get(_);w||(w=l.querySelector(Fp(_)),w||(r=p({src:r,async:!0,type:"module"},a),(a=pa.get(_))&&y_(r,a),w=l.createElement("script"),nr(w),Ae(w,"link",r),l.head.appendChild(w)),w={type:"script",instance:w,count:1,state:null},f.set(_,w))}}function ro(r,a,l,f){var _=(_=Z.current)?Jl(_):null;if(!_)throw Error(s(446));switch(r){case"meta":case"title":return null;case"style":return typeof l.precedence=="string"&&typeof l.href=="string"?(a=wa(l.href),l=_a(_).hoistableStyles,f=l.get(a),f||(f={type:"style",instance:null,count:0,state:null},l.set(a,f)),f):{type:"void",instance:null,count:0,state:null};case"link":if(l.rel==="stylesheet"&&typeof l.href=="string"&&typeof l.precedence=="string"){r=wa(l.href);var w=_a(_).hoistableStyles,F=w.get(r);if(F||(_=_.ownerDocument||_,F={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},w.set(r,F),(w=_.querySelector(Lp(r)))&&!w._p&&(F.instance=w,F.state.loading=5),pa.has(r)||(l={rel:"preload",as:"style",href:l.href,crossOrigin:l.crossOrigin,integrity:l.integrity,media:l.media,hrefLang:l.hrefLang,referrerPolicy:l.referrerPolicy},pa.set(r,l),w||gC(_,r,l,F.state))),a&&f===null)throw Error(s(528,""));return F}if(a&&f!==null)throw Error(s(529,""));return null;case"script":return a=l.async,l=l.src,typeof l=="string"&&a&&typeof a!="function"&&typeof a!="symbol"?(a=cf(l),l=_a(_).hoistableScripts,f=l.get(a),f||(f={type:"script",instance:null,count:0,state:null},l.set(a,f)),f):{type:"void",instance:null,count:0,state:null};default:throw Error(s(444,r))}}function wa(r){return'href="'+Fr(r)+'"'}function Lp(r){return'link[rel="stylesheet"]['+r+"]"}function xy(r){return p({},r,{"data-precedence":r.precedence,precedence:null})}function gC(r,a,l,f){r.querySelector('link[rel="preload"][as="style"]['+a+"]")?f.loading=1:(a=r.createElement("link"),f.preload=a,a.addEventListener("load",function(){return f.loading|=1}),a.addEventListener("error",function(){return f.loading|=2}),Ae(a,"link",l),nr(a),r.head.appendChild(a))}function cf(r){return'[src="'+Fr(r)+'"]'}function Fp(r){return"script[async]"+r}function Ey(r,a,l){if(a.count++,a.instance===null)switch(a.type){case"style":var f=r.querySelector('style[data-href~="'+Fr(l.href)+'"]');if(f)return a.instance=f,nr(f),f;var _=p({},l,{"data-href":l.href,"data-precedence":l.precedence,href:null,precedence:null});return f=(r.ownerDocument||r).createElement("style"),nr(f),Ae(f,"style",_),Ym(f,l.precedence,r),a.instance=f;case"stylesheet":_=wa(l.href);var w=r.querySelector(Lp(_));if(w)return a.state.loading|=4,a.instance=w,nr(w),w;f=xy(l),(_=pa.get(_))&&v_(f,_),w=(r.ownerDocument||r).createElement("link"),nr(w);var F=w;return F._p=new Promise(function(re,ye){F.onload=re,F.onerror=ye}),Ae(w,"link",f),a.state.loading|=4,Ym(w,l.precedence,r),a.instance=w;case"script":return w=cf(l.src),(_=r.querySelector(Fp(w)))?(a.instance=_,nr(_),_):(f=l,(_=pa.get(w))&&(f=p({},l),y_(f,_)),r=r.ownerDocument||r,_=r.createElement("script"),nr(_),Ae(_,"link",f),r.head.appendChild(_),a.instance=_);case"void":return null;default:throw Error(s(443,a.type))}else a.type==="stylesheet"&&(a.state.loading&4)===0&&(f=a.instance,a.state.loading|=4,Ym(f,l.precedence,r));return a.instance}function Ym(r,a,l){for(var f=l.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),_=f.length?f[f.length-1]:null,w=_,F=0;F<f.length;F++){var re=f[F];if(re.dataset.precedence===a)w=re;else if(w!==_)break}w?w.parentNode.insertBefore(r,w.nextSibling):(a=l.nodeType===9?l.head:l,a.insertBefore(r,a.firstChild))}function v_(r,a){r.crossOrigin==null&&(r.crossOrigin=a.crossOrigin),r.referrerPolicy==null&&(r.referrerPolicy=a.referrerPolicy),r.title==null&&(r.title=a.title)}function y_(r,a){r.crossOrigin==null&&(r.crossOrigin=a.crossOrigin),r.referrerPolicy==null&&(r.referrerPolicy=a.referrerPolicy),r.integrity==null&&(r.integrity=a.integrity)}var Jm=null;function Ty(r,a,l){if(Jm===null){var f=new Map,_=Jm=new Map;_.set(l,f)}else _=Jm,f=_.get(l),f||(f=new Map,_.set(l,f));if(f.has(r))return f;for(f.set(r,null),l=l.getElementsByTagName(r),_=0;_<l.length;_++){var w=l[_];if(!(w[Zt]||w[Ye]||r==="link"&&w.getAttribute("rel")==="stylesheet")&&w.namespaceURI!=="http://www.w3.org/2000/svg"){var F=w.getAttribute(a)||"";F=r+F;var re=f.get(F);re?re.push(w):f.set(F,[w])}}return f}function Ay(r,a,l){r=r.ownerDocument||r,r.head.insertBefore(l,a==="title"?r.querySelector("head > title"):null)}function _C(r,a,l){if(l===1||a.itemProp!=null)return!1;switch(r){case"meta":case"title":return!0;case"style":if(typeof a.precedence!="string"||typeof a.href!="string"||a.href==="")break;return!0;case"link":if(typeof a.rel!="string"||typeof a.href!="string"||a.href===""||a.onLoad||a.onError)break;switch(a.rel){case"stylesheet":return r=a.disabled,typeof a.precedence=="string"&&r==null;default:return!0}case"script":if(a.async&&typeof a.async!="function"&&typeof a.async!="symbol"&&!a.onLoad&&!a.onError&&a.src&&typeof a.src=="string")return!0}return!1}function Cy(r){return!(r.type==="stylesheet"&&(r.state.loading&3)===0)}function vC(r,a,l,f){if(l.type==="stylesheet"&&(typeof f.media!="string"||matchMedia(f.media).matches!==!1)&&(l.state.loading&4)===0){if(l.instance===null){var _=wa(f.href),w=a.querySelector(Lp(_));if(w){a=w._p,a!==null&&typeof a=="object"&&typeof a.then=="function"&&(r.count++,r=Zm.bind(r),a.then(r,r)),l.state.loading|=4,l.instance=w,nr(w);return}w=a.ownerDocument||a,f=xy(f),(_=pa.get(_))&&v_(f,_),w=w.createElement("link"),nr(w);var F=w;F._p=new Promise(function(re,ye){F.onload=re,F.onerror=ye}),Ae(w,"link",f),l.instance=w}r.stylesheets===null&&(r.stylesheets=new Map),r.stylesheets.set(l,a),(a=l.state.preload)&&(l.state.loading&3)===0&&(r.count++,l=Zm.bind(r),a.addEventListener("load",l),a.addEventListener("error",l))}}var b_=0;function yC(r,a){return r.stylesheets&&r.count===0&&tg(r,r.stylesheets),0<r.count||0<r.imgCount?function(l){var f=setTimeout(function(){if(r.stylesheets&&tg(r,r.stylesheets),r.unsuspend){var w=r.unsuspend;r.unsuspend=null,w()}},6e4+a);0<r.imgBytes&&b_===0&&(b_=62500*gt());var _=setTimeout(function(){if(r.waitingForImages=!1,r.count===0&&(r.stylesheets&&tg(r,r.stylesheets),r.unsuspend)){var w=r.unsuspend;r.unsuspend=null,w()}},(r.imgBytes>b_?50:800)+a);return r.unsuspend=l,function(){r.unsuspend=null,clearTimeout(f),clearTimeout(_)}}:null}function Zm(){if(this.count--,this.count===0&&(this.imgCount===0||!this.waitingForImages)){if(this.stylesheets)tg(this,this.stylesheets);else if(this.unsuspend){var r=this.unsuspend;this.unsuspend=null,r()}}}var eg=null;function tg(r,a){r.stylesheets=null,r.unsuspend!==null&&(r.count++,eg=new Map,a.forEach(bC,r),eg=null,Zm.call(r))}function bC(r,a){if(!(a.state.loading&4)){var l=eg.get(r);if(l)var f=l.get(null);else{l=new Map,eg.set(r,l);for(var _=r.querySelectorAll("link[data-precedence],style[data-precedence]"),w=0;w<_.length;w++){var F=_[w];(F.nodeName==="LINK"||F.getAttribute("media")!=="not all")&&(l.set(F.dataset.precedence,F),f=F)}f&&l.set(null,f)}_=a.instance,F=_.getAttribute("data-precedence"),w=l.get(F)||f,w===f&&l.set(null,_),l.set(F,_),this.count++,f=Zm.bind(this),_.addEventListener("load",f),_.addEventListener("error",f),w?w.parentNode.insertBefore(_,w.nextSibling):(r=r.nodeType===9?r.head:r,r.insertBefore(_,r.firstChild)),a.state.loading|=4}}var zp={$$typeof:D,Provider:null,Consumer:null,_currentValue:de,_currentValue2:de,_threadCount:0};function wC(r,a,l,f,_,w,F,re,ye){this.tag=1,this.containerInfo=r,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=Dn(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Dn(0),this.hiddenUpdates=Dn(null),this.identifierPrefix=f,this.onUncaughtError=_,this.onCaughtError=w,this.onRecoverableError=F,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=ye,this.incompleteTransitions=new Map}function Sy(r,a,l,f,_,w,F,re,ye,Fe,tt,st){return r=new wC(r,a,l,F,ye,Fe,tt,st,re),a=1,w===!0&&(a|=24),w=Oa(3,null,null,a),r.current=w,w.stateNode=r,a=Pc(),a.refCount++,r.pooledCache=a,a.refCount++,w.memoizedState={element:f,isDehydrated:l,cache:a},td(w),r}function Iy(r){return r?(r=Eo,r):Eo}function Py(r,a,l,f,_,w){_=Iy(_),f.context===null?f.context=_:f.pendingContext=_,f=Gs(a),f.payload={element:l},w=w===void 0?null:w,w!==null&&(f.callback=w),l=fi(r,f,a),l!==null&&(Aa(l,r,a),Al(l,r,a))}function ky(r,a){if(r=r.memoizedState,r!==null&&r.dehydrated!==null){var l=r.retryLane;r.retryLane=l!==0&&l<a?l:a}}function w_(r,a){ky(r,a),(r=r.alternate)&&ky(r,a)}function Dy(r){if(r.tag===13||r.tag===31){var a=Ni(r,67108864);a!==null&&Aa(a,r,67108864),w_(r,67108864)}}function Oy(r){if(r.tag===13||r.tag===31){var a=Ra();a=Y(a);var l=Ni(r,a);l!==null&&Aa(l,r,a),w_(r,a)}}var ng=!0;function MC(r,a,l,f){var _=Q.T;Q.T=null;var w=ne.p;try{ne.p=2,M_(r,a,l,f)}finally{ne.p=w,Q.T=_}}function xC(r,a,l,f){var _=Q.T;Q.T=null;var w=ne.p;try{ne.p=8,M_(r,a,l,f)}finally{ne.p=w,Q.T=_}}function M_(r,a,l,f){if(ng){var _=x_(f);if(_===null)Vr(r,a,f,rg,l),By(r,f);else if(TC(_,r,a,l,f))f.stopPropagation();else if(By(r,f),a&4&&-1<EC.indexOf(r)){for(;_!==null;){var w=or(_);if(w!==null)switch(w.tag){case 3:if(w=w.stateNode,w.current.memoizedState.isDehydrated){var F=qr(w.pendingLanes);if(F!==0){var re=w;for(re.pendingLanes|=2,re.entangledLanes|=2;F;){var ye=1<<31-tn(F);re.entanglements[1]|=ye,F&=~ye}Cs(w),($n&6)===0&&(Zc=pt()+500,ql(0))}}break;case 31:case 13:re=Ni(w,2),re!==null&&Aa(re,w,2),ru(),w_(w,2)}if(w=x_(f),w===null&&Vr(r,a,f,rg,l),w===_)break;_=w}_!==null&&f.stopPropagation()}else Vr(r,a,f,null,l)}}function x_(r){return r=Jn(r),E_(r)}var rg=null;function E_(r){if(rg=null,r=Gn(r),r!==null){var a=o(r);if(a===null)r=null;else{var l=a.tag;if(l===13){if(r=c(a),r!==null)return r;r=null}else if(l===31){if(r=d(a),r!==null)return r;r=null}else if(l===3){if(a.stateNode.current.memoizedState.isDehydrated)return a.tag===3?a.stateNode.containerInfo:null;r=null}else a!==r&&(r=null)}}return rg=r,null}function $y(r){switch(r){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(dt()){case Gt:return 2;case vt:return 8;case Ze:case rt:return 32;case kt:return 268435456;default:return 32}default:return 32}}var T_=!1,Zl=null,ec=null,tc=null,Np=new Map,Rp=new Map,nc=[],EC="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function By(r,a){switch(r){case"focusin":case"focusout":Zl=null;break;case"dragenter":case"dragleave":ec=null;break;case"mouseover":case"mouseout":tc=null;break;case"pointerover":case"pointerout":Np.delete(a.pointerId);break;case"gotpointercapture":case"lostpointercapture":Rp.delete(a.pointerId)}}function jp(r,a,l,f,_,w){return r===null||r.nativeEvent!==w?(r={blockedOn:a,domEventName:l,eventSystemFlags:f,nativeEvent:w,targetContainers:[_]},a!==null&&(a=or(a),a!==null&&Dy(a)),r):(r.eventSystemFlags|=f,a=r.targetContainers,_!==null&&a.indexOf(_)===-1&&a.push(_),r)}function TC(r,a,l,f,_){switch(a){case"focusin":return Zl=jp(Zl,r,a,l,f,_),!0;case"dragenter":return ec=jp(ec,r,a,l,f,_),!0;case"mouseover":return tc=jp(tc,r,a,l,f,_),!0;case"pointerover":var w=_.pointerId;return Np.set(w,jp(Np.get(w)||null,r,a,l,f,_)),!0;case"gotpointercapture":return w=_.pointerId,Rp.set(w,jp(Rp.get(w)||null,r,a,l,f,_)),!0}return!1}function Ly(r){var a=Gn(r.target);if(a!==null){var l=o(a);if(l!==null){if(a=l.tag,a===13){if(a=c(l),a!==null){r.blockedOn=a,Ce(r.priority,function(){Oy(l)});return}}else if(a===31){if(a=d(l),a!==null){r.blockedOn=a,Ce(r.priority,function(){Oy(l)});return}}else if(a===3&&l.stateNode.current.memoizedState.isDehydrated){r.blockedOn=l.tag===3?l.stateNode.containerInfo:null;return}}}r.blockedOn=null}function ag(r){if(r.blockedOn!==null)return!1;for(var a=r.targetContainers;0<a.length;){var l=x_(r.nativeEvent);if(l===null){l=r.nativeEvent;var f=new l.constructor(l.type,l);vn=f,l.target.dispatchEvent(f),vn=null}else return a=or(l),a!==null&&Dy(a),r.blockedOn=l,!1;a.shift()}return!0}function Fy(r,a,l){ag(r)&&l.delete(a)}function AC(){T_=!1,Zl!==null&&ag(Zl)&&(Zl=null),ec!==null&&ag(ec)&&(ec=null),tc!==null&&ag(tc)&&(tc=null),Np.forEach(Fy),Rp.forEach(Fy)}function sg(r,a){r.blockedOn===a&&(r.blockedOn=null,T_||(T_=!0,e.unstable_scheduleCallback(e.unstable_NormalPriority,AC)))}var ig=null;function zy(r){ig!==r&&(ig=r,e.unstable_scheduleCallback(e.unstable_NormalPriority,function(){ig===r&&(ig=null);for(var a=0;a<r.length;a+=3){var l=r[a],f=r[a+1],_=r[a+2];if(typeof f!="function"){if(E_(f||l)===null)continue;break}var w=or(l);w!==null&&(r.splice(a,3),a-=3,Md(w,{pending:!0,data:_,method:l.method,action:f},f,_))}}))}function uf(r){function a(ye){return sg(ye,r)}Zl!==null&&sg(Zl,r),ec!==null&&sg(ec,r),tc!==null&&sg(tc,r),Np.forEach(a),Rp.forEach(a);for(var l=0;l<nc.length;l++){var f=nc[l];f.blockedOn===r&&(f.blockedOn=null)}for(;0<nc.length&&(l=nc[0],l.blockedOn===null);)Ly(l),l.blockedOn===null&&nc.shift();if(l=(r.ownerDocument||r).$$reactFormReplay,l!=null)for(f=0;f<l.length;f+=3){var _=l[f],w=l[f+1],F=_[ct]||null;if(typeof w=="function")F||zy(l);else if(F){var re=null;if(w&&w.hasAttribute("formAction")){if(_=w,F=w[ct]||null)re=F.formAction;else if(E_(_)!==null)continue}else re=F.action;typeof re=="function"?l[f+1]=re:(l.splice(f,3),f-=3),zy(l)}}}function Ny(){function r(w){w.canIntercept&&w.info==="react-transition"&&w.intercept({handler:function(){return new Promise(function(F){return _=F})},focusReset:"manual",scroll:"manual"})}function a(){_!==null&&(_(),_=null),f||setTimeout(l,20)}function l(){if(!f&&!navigation.transition){var w=navigation.currentEntry;w&&w.url!=null&&navigation.navigate(w.url,{state:w.getState(),info:"react-transition",history:"replace"})}}if(typeof navigation=="object"){var f=!1,_=null;return navigation.addEventListener("navigate",r),navigation.addEventListener("navigatesuccess",a),navigation.addEventListener("navigateerror",a),setTimeout(l,100),function(){f=!0,navigation.removeEventListener("navigate",r),navigation.removeEventListener("navigatesuccess",a),navigation.removeEventListener("navigateerror",a),_!==null&&(_(),_=null)}}}function A_(r){this._internalRoot=r}og.prototype.render=A_.prototype.render=function(r){var a=this._internalRoot;if(a===null)throw Error(s(409));var l=a.current,f=Ra();Py(l,f,r,a,null,null)},og.prototype.unmount=A_.prototype.unmount=function(){var r=this._internalRoot;if(r!==null){this._internalRoot=null;var a=r.containerInfo;Py(r.current,2,null,r,null,null),ru(),a[ft]=null}};function og(r){this._internalRoot=r}og.prototype.unstable_scheduleHydration=function(r){if(r){var a=pe();r={blockedOn:null,target:r,priority:a};for(var l=0;l<nc.length&&a!==0&&a<nc[l].priority;l++);nc.splice(l,0,r),l===0&&Ly(r)}};var Ry=t.version;if(Ry!=="19.2.2")throw Error(s(527,Ry,"19.2.2"));ne.findDOMNode=function(r){var a=r._reactInternals;if(a===void 0)throw typeof r.render=="function"?Error(s(188)):(r=Object.keys(r).join(","),Error(s(268,r)));return r=h(a),r=r!==null?g(r):null,r=r===null?null:r.stateNode,r};var CC={bundleType:0,version:"19.2.2",rendererPackageName:"react-dom",currentDispatcherRef:Q,reconcilerVersion:"19.2.2"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var lg=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!lg.isDisabled&&lg.supportsFiber)try{Jt=lg.inject(CC),Cn=lg}catch{}}return Vp.createRoot=function(r,a){if(!i(r))throw Error(s(299));var l=!1,f="",_=Ch,w=Sh,F=Ih;return a!=null&&(a.unstable_strictMode===!0&&(l=!0),a.identifierPrefix!==void 0&&(f=a.identifierPrefix),a.onUncaughtError!==void 0&&(_=a.onUncaughtError),a.onCaughtError!==void 0&&(w=a.onCaughtError),a.onRecoverableError!==void 0&&(F=a.onRecoverableError)),a=Sy(r,1,!1,null,null,l,f,null,_,w,F,Ny),r[ft]=a.current,of(r),new A_(a)},Vp.hydrateRoot=function(r,a,l){if(!i(r))throw Error(s(299));var f=!1,_="",w=Ch,F=Sh,re=Ih,ye=null;return l!=null&&(l.unstable_strictMode===!0&&(f=!0),l.identifierPrefix!==void 0&&(_=l.identifierPrefix),l.onUncaughtError!==void 0&&(w=l.onUncaughtError),l.onCaughtError!==void 0&&(F=l.onCaughtError),l.onRecoverableError!==void 0&&(re=l.onRecoverableError),l.formState!==void 0&&(ye=l.formState)),a=Sy(r,1,!0,a,l??null,f,_,ye,w,F,re,Ny),a.context=Iy(null),l=a.current,f=Ra(),f=Y(f),_=Gs(f),_.callback=null,fi(l,_,f),l=f,a.current.lanes=l,Kr(a,l),Cs(a),r[ft]=a.current,of(r),new og(a)},Vp.version="19.2.2",Vp}var Yy;function NC(){if(Yy)return I_.exports;Yy=1;function e(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(t){console.error(t)}}return e(),I_.exports=zC(),I_.exports}var RC=NC();const jC=kv(RC),S1=we.createContext(void 0),ti=()=>{const e=we.useContext(S1);if(!e)throw new Error("useAppContext must be used within an AppProvider");return e},UC="modulepreload",VC=function(e,t){return new URL(e,t).href},Jy={},vf=function(t,n,s){let i=Promise.resolve();if(n&&n.length>0){let c=function(g){return Promise.all(g.map(p=>Promise.resolve(p).then(m=>({status:"fulfilled",value:m}),m=>({status:"rejected",reason:m}))))};const d=document.getElementsByTagName("link"),u=document.querySelector("meta[property=csp-nonce]"),h=(u==null?void 0:u.nonce)||(u==null?void 0:u.getAttribute("nonce"));i=c(n.map(g=>{if(g=VC(g,s),g in Jy)return;Jy[g]=!0;const p=g.endsWith(".css"),m=p?'[rel="stylesheet"]':"";if(!!s)for(let T=d.length-1;T>=0;T--){const O=d[T];if(O.href===g&&(!p||O.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${g}"]${m}`))return;const v=document.createElement("link");if(v.rel=p?"stylesheet":UC,p||(v.as="script"),v.crossOrigin="",v.href=g,h&&v.setAttribute("nonce",h),document.head.appendChild(v),p)return new Promise((T,O)=>{v.addEventListener("load",T),v.addEventListener("error",()=>O(new Error(`Unable to preload CSS for ${g}`)))})}))}function o(c){const d=new Event("vite:preloadError",{cancelable:!0});if(d.payload=c,window.dispatchEvent(d),!d.defaultPrevented)throw c}return i.then(c=>{for(const d of c||[])d.status==="rejected"&&o(d.reason);return t().catch(o)})};class GC{constructor(t){this.processor=t,this.pendingRequest=null,this.isProcessing=!1,this.abortController=null}infer(t,n){return new Promise((s,i)=>{var o;this.pendingRequest&&this.pendingRequest.reject(new Error("Skipped")),this.pendingRequest={blob:t,options:n,resolve:s,reject:i},this.isProcessing?(o=this.abortController)==null||o.abort():this.processNext()})}async processNext(){if(this.isProcessing)return;if(!this.pendingRequest){this.isProcessing=!1;return}this.isProcessing=!0;const t=this.pendingRequest;this.pendingRequest=null,this.abortController=new AbortController;const n=this.abortController.signal;try{await this.processor(t,n)}catch(s){console.error("[InferenceQueue] Processor error:",s);try{t.reject(s)}catch{}}finally{this.isProcessing=!1,this.abortController=null,this.pendingRequest&&this.processNext()}}async dispose(){this.pendingRequest&&(this.pendingRequest.reject(new Error("Aborted")),this.pendingRequest=null),this.abortController&&(this.abortController.abort(),this.abortController=null),this.isProcessing=!1}getIsInferring(){return this.isProcessing}}const Ln={ID:"Ji-Ha/TexTeller3-ONNX-dynamic",DEFAULT_PROVIDER:"wasm",IMAGE_SIZE:448,MEAN:[.9545467],STD:[.15394445],ENCODER_INPUT_NAME:"pixel_values",DECODER_INPUT_NAME:"decoder_input_ids",DECODER_OUTPUT_NAME:"logits",TOKENS:{EOS:"</s>",BOS:"<s>",PAD:"<pad>"},PROVIDERS:{WEBGPU:"webgpu",WASM:"wasm"},CHECKSUMS:{"encoder_model.onnx":"ae5e60838e4498412a02561e9f9ef176f30207a8405e002c4105f93c421efabc","encoder_model_fp16.onnx":"f78538bdee77c4eccb8e0b54f9058b087f08167b7500d893b308266323b3a23b","encoder_model_int8.onnx":"f6757c000c4cda7f6286a999193446b6618735e97cf2b46b8e0d62e51cfc71a8","encoder_model_int4.onnx":"cd6b555997aeedf9926a5397c3741a9947143d4d27c6c17b6f21dcaa359b40de","decoder_model_merged.onnx":"4fc84dbc62be9a9115ffdf51de055ac39b12dacc2a5c70d921252d17ff745ad3","decoder_model_merged_int8.onnx":"2590040b23aa50e76af8ad6c211edd34c1ed47439e31fd7b4ff935051b2efcac","decoder_model_merged_int4.onnx":"db0c9bfe85401afa7f9468eab5e00dd1b9f19b11f425530123fcac8c47fa9871"},FILE_SIZES:{"encoder_model.onnx":344*1024*1024,"encoder_model_fp16.onnx":172*1024*1024,"encoder_model_int8.onnx":883e5,"encoder_model_int4.onnx":476e5,"decoder_model.onnx":909*1024*1024,"decoder_model_merged.onnx":909*1024*1024,"decoder_model_merged_int8.onnx":229*1024*1024,"decoder_model_merged_int4.onnx":176*1024*1024}},cg={NUM_BEAMS:1,DEFAULT_TEMPERATURE:1,DEFAULT_TOP_K:40,DEFAULT_TOP_P:.9};class vu{constructor(){this.worker=null,this.currentModelId=Ln.ID,this.isLoading=!1,this.pendingRequests=new Map,this.queue=new GC((t,n)=>this.runInference(t,n))}static getInstance(){return vu.instance||(vu.instance=new vu),vu.instance}initWorker(){this.worker||(this.worker=new Worker(new URL(""+new URL("InferenceWorker-Bn74Bm0o.js",import.meta.url).href,import.meta.url),{type:"module"}),this.worker.onmessage=t=>{const{type:n,id:s,data:i,error:o}=t.data,c=this.pendingRequests.get(s);c&&(n==="success"?(c.resolve(i),this.pendingRequests.delete(s)):n==="error"?(c.reject(new Error(o)),this.pendingRequests.delete(s)):n==="progress"?c.onProgress&&c.onProgress(i.status,i.progress):n==="debug_image"&&c.onPreprocess&&c.onPreprocess(i))},this.worker.onerror=t=>{console.error("Worker error:",t)})}async init(t,n={}){this.initWorker();const s=crypto.randomUUID();return new Promise((i,o)=>{this.pendingRequests.set(s,{resolve:i,reject:o,onProgress:t}),this.worker.postMessage({type:"init",id:s,data:n})})}async infer(t,n){return!n.num_beams&&!n.do_sample&&(n.num_beams=1),this.queue.infer(t,n)}async runInference(t,n){this.initWorker();const s=crypto.randomUUID();return new Promise(i=>{const{onPreprocess:o,...c}=t.options,d=()=>{this.pendingRequests.delete(s),n.removeEventListener("abort",u)},u=()=>{d(),t.reject(new Error("Aborted")),i()};if(n.aborted){u();return}n.addEventListener("abort",u),this.pendingRequests.set(s,{resolve:g=>{d(),t.resolve(g),i()},reject:g=>{d(),t.reject(g),i()},onPreprocess:o});const h={blob:t.blob,options:c,debug:!!o};this.worker.postMessage({type:"infer",id:s,data:h})})}async dispose(t=!1){if(!this.worker)return;const n=crypto.randomUUID();return new Promise((s,i)=>{this.pendingRequests.set(n,{resolve:s,reject:i}),this.worker.postMessage({type:"dispose",id:n,data:{force:t}})}).then(()=>{this.worker.terminate(),this.worker=null,this.pendingRequests.clear()})}disposeSync(){this.worker&&(this.worker.terminate(),this.worker=null)}}function I1(){return typeof window<"u"?(window.__texpen_inference_service__||(window.__texpen_inference_service__=new vu),window.__texpen_inference_service__):vu.getInstance()}const O_=I1();typeof window<"u"&&window.addEventListener("beforeunload",()=>{I1().disposeSync()});function WC(e,t,n,s,i,o=Ln.ID){const[c,d]=we.useState(cg.NUM_BEAMS),[u,h]=we.useState(!0),[g,p]=we.useState(cg.DEFAULT_TEMPERATURE),[m,y]=we.useState(cg.DEFAULT_TOP_K),[v,T]=we.useState(cg.DEFAULT_TOP_P),[O,E]=we.useState({encoderModelUrl:Ln.ID,decoderModelUrl:Ln.ID,tokenizerUrl:Ln.ID,imageSize:Ln.IMAGE_SIZE,encoderInputName:Ln.ENCODER_INPUT_NAME,decoderInputName:Ln.DECODER_INPUT_NAME,decoderOutputName:Ln.DECODER_OUTPUT_NAME,mean:[...Ln.MEAN],std:[...Ln.STD],invert:!1,eosToken:Ln.TOKENS.EOS,bosToken:Ln.TOKENS.BOS,padToken:Ln.TOKENS.PAD,preferredProvider:"webgpu"}),[S,D]=we.useState("idle"),[I,M]=we.useState(!1),C=we.useRef(0),A=we.useRef(null),k=we.useRef(null),[R,G]=we.useState(""),[te,ee]=we.useState(0),[X,le]=we.useState(!1),[ae,Q]=we.useState(!1),[ne,de]=we.useState(!1),[ve,fe]=we.useState(!1);we.useEffect(()=>{async function q(){try{const{getSessionOptions:ce}=await vf(async()=>{const{getSessionOptions:he}=await import("./index-CBPy_vyv.js");return{getSessionOptions:he}},[],import.meta.url);if(!t)return;const Z=ce(t,{overall:n,encoder:s,decoder:i}),Me=[Z.encoder_model_file_name,Z.decoder_model_file_name],Ne=await(await caches.open("transformers-cache")).keys(),Oe=Me.every(he=>Ne.some(H=>H.url.includes(he)));de(Oe),le(!!Oe)}catch(ce){console.warn("Cache API is not available or failed:",ce),le(!1)}finally{fe(!0)}}q()},[O.encoderModelUrl,t,n,s,i]);const j=we.useRef(null);we.useEffect(()=>{let q=!1;return X&&(async()=>{if(t)try{const{downloadManager:Z}=await vf(async()=>{const{downloadManager:Pe}=await Promise.resolve().then(()=>wy);return{downloadManager:Pe}},void 0,import.meta.url);Z.setQuotaErrorHandler(async()=>window.confirm(`Couldn't save checkpoints to persistent storage (e.g. Incognito Mode). 

The download will continue in memory, but will be lost if you refresh the page.`)),D("loading");const Me=ne?"Loading model from cache...":"Downloading model... (Inference paused)";G(Me),await O_.init((Pe,Ne)=>{if(q)return;let Oe=Pe;Pe.startsWith("Loading model")?Oe=Me:Oe=Pe,G(Oe),Ne!==void 0&&ee(Ne)},{device:t,modelId:o,quantization:n,encoderQuantization:s,decoderQuantization:i}),q||(D("idle"),G(""),j.current={provider:t,modelId:o,quantization:n,encoderQuantization:s,decoderQuantization:i})}catch(Z){if(q)return;if(Z instanceof Error&&Z.message.includes("aborted by user")){console.log("Model loading aborted by user."),D("idle"),G("");return}console.error("Failed to initialize model:",Z),D("error"),G("Failed to load model")}})(),()=>{q=!0,j.current&&(j.current.provider!==t||j.current.modelId!==o||j.current.quantization!==n||j.current.encoderQuantization!==s||j.current.decoderQuantization!==i)&&X&&(console.log("[useInkModel] Settings changed, disposing model..."),O_.dispose().catch(Me=>{console.warn("Model disposal during cleanup:",Me.message)}))}},[t,o,n,s,i,X,ne]);const U=we.useCallback(async(q,ce)=>S==="loading"?(console.log("Inference queued: Model is currently loading."),A.current&&A.current.resolve(null),Q(!0),new Promise((Z,Me)=>{A.current={canvas:q,options:ce,resolve:Z,reject:Me}})):!X&&!ne?(console.warn("Inference skipped: User has not confirmed model download."),null):(C.current+=1,M(!0),D("inferencing"),new Promise((Z,Me)=>{k.current&&(clearTimeout(k.current.timer),k.current.resolve(null),C.current-=1);const Pe=setTimeout(()=>{k.current=null,q.toBlob(async Ne=>{if(!Ne)return C.current-=1,C.current===0&&M(!1),D("error"),Me(new Error("Failed to create blob from canvas"));try{const Oe=await O_.infer(Ne,{num_beams:c,do_sample:u,temperature:g,top_k:m,top_p:v,onPreprocess:ce==null?void 0:ce.onPreprocess});if(Oe){const he=Oe.candidates.map((H,Te)=>({id:Te,latex:H}));D("success"),Z({latex:Oe.latex,candidates:he,debugImage:Oe.debugImage})}else Z(null)}catch(Oe){const he=Oe;he.message==="Aborted"||he.message==="Skipped"||he.name==="AbortError"?(console.log("Inference aborted/skipped:",he.message),Z(null)):(console.error("Inference error:",Oe),D("error"),Me(Oe))}finally{C.current-=1,C.current===0&&M(!1)}},"image/png")},100);k.current={timer:Pe,resolve:Z}})),[c,u,g,m,v,S,X,ne]),N=we.useCallback(async(q,ce)=>{try{const Z=new Image;Z.crossOrigin="anonymous",await new Promise((Ne,Oe)=>{Z.onload=Ne,Z.onerror=Oe,Z.src=q});const Me=document.createElement("canvas");Me.width=Z.width,Me.height=Z.height;const Pe=Me.getContext("2d");if(!Pe)throw new Error("Failed to get canvas context");return Pe.drawImage(Z,0,0),await U(Me,ce)}catch(Z){return console.error("Error loading reference image:",Z),D("error"),null}},[U]);return we.useEffect(()=>{if(S==="idle"&&A.current){console.log("[useInkModel] Processing queued inference");const{canvas:q,options:ce,resolve:Z,reject:Me}=A.current;A.current=null,Q(!1),U(q,ce).then(Z).catch(Me)}},[S,U]),{config:O,setConfig:E,status:S,infer:U,inferFromUrl:N,isInferencing:I,loadingPhase:R,numCandidates:c,setNumCandidates:d,progress:te,userConfirmed:X,setUserConfirmed:le,isLoadedFromCache:ne,isInitialized:ve,doSample:u,setDoSample:h,temperature:g,setTemperature:p,topK:m,setTopK:y,topP:v,setTopP:T,isGenerationQueued:ae}}const P1=we.createContext(void 0),gm=()=>{const e=we.useContext(P1);if(!e)throw new Error("useThemeContext must be used within a ThemeProvider");return e};async function k1(){if(!navigator.gpu)return!1;try{return!!await navigator.gpu.requestAdapter()}catch{return!1}}async function HC(){const e=await k1(),t=navigator.deviceMemory;return{hasGPU:e,memoryGB:t}}const $_={latex:"",candidates:[],selectedIndex:0,debugImage:null,uploadPreview:null,showUploadResult:!1,loadedStrokes:null};function QC(e){const[t,n]=we.useState($_),[s,i]=we.useState($_),o=e==="draw"?t:s,c=e==="draw"?n:i,d=o.latex,u=o.candidates,h=o.selectedIndex,g=o.debugImage,p=t.loadedStrokes,m=s.uploadPreview,y=s.showUploadResult,v=le=>{c(ae=>({...ae,latex:le}))},T=le=>{c(ae=>({...ae,selectedIndex:le}))},O=le=>{c(ae=>{var Q;return{...ae,selectedIndex:le,latex:((Q=ae.candidates[le])==null?void 0:Q.latex)||""}})},E=le=>{i(ae=>({...ae,uploadPreview:le}))},S=le=>{i(ae=>({...ae,showUploadResult:le}))},D=()=>{c($_)},I=le=>{n(ae=>({...ae,latex:le.latex,candidates:le.candidates,selectedIndex:0,debugImage:le.debugImage}))},M=le=>{i(ae=>({...ae,latex:le.latex,candidates:le.candidates,selectedIndex:0,debugImage:le.debugImage}))},C=(le,ae)=>{n({latex:le,candidates:[],selectedIndex:0,debugImage:null,uploadPreview:null,showUploadResult:!1,loadedStrokes:ae})},[A,k]=we.useState(null),R=we.useRef({draw:0,upload:0});return{latex:d,candidates:u,selectedIndex:h,debugImage:g,loadedStrokes:p,uploadPreview:m,showUploadResult:y,setLatex:v,setSelectedIndex:T,selectCandidate:O,setUploadPreview:E,setShowUploadResult:S,clearTabState:D,updateDrawResult:I,updateUploadResult:M,loadDrawState:C,setDrawState:n,setUploadState:i,activeInferenceTab:A,startDrawInference:()=>{R.current.draw+=1,k("draw")},endDrawInference:()=>{R.current.draw-=1,R.current.draw===0&&k(le=>le==="draw"?null:le)},startUploadInference:()=>{R.current.upload+=1,k("upload")},endUploadInference:()=>{R.current.upload-=1,R.current.upload===0&&k(le=>le==="upload"?null:le)}}}const Zy="texpen_settings_v1",qC=({children:e})=>{const{theme:t}=gm(),[n,s]=we.useState(null),[i,o]=we.useState("balanced"),[c,d]=we.useState("int8"),[u,h]=we.useState("int8"),[g,p]=we.useState("int8"),[m,y]=we.useState(Ln.ID),[v,T]=we.useState("draw"),[O,E]=we.useState(()=>typeof window<"u"?window.innerWidth>=768:!0),[S,D]=we.useState(!1),[I,M]=we.useState(Date.now().toString()),[C,A]=we.useState(!1),[k,R]=we.useState(null),[G,te]=we.useState(null),[ee,X]=we.useState({isOpen:!1,title:"",message:"",onConfirm:()=>{}}),le=Ye=>{switch(Ye){case"high_quality":return{enc:"fp32",dec:"fp32"};case"fast":return{enc:"fp16",dec:"fp32"};case"balanced":return{enc:"int8",dec:"int8"};case"low_memory":return{enc:"int4",dec:"int4"};default:return null}},ae=we.useCallback((Ye,ct,ft)=>{s(Ye),o(ct);let Tt,Et;if(ct==="custom"&&ft)Tt=ft.enc,Et=ft.dec;else{const xt=le(ct);xt?(Tt=xt.enc,Et=xt.dec):(Tt="int8",Et="int8")}d(Tt),h(Tt),p(Et);const nn=(ft==null?void 0:ft.modelId)||m||Ln.ID;ft!=null&&ft.modelId&&y(ft.modelId);try{const xt={provider:Ye,performanceProfile:ct,encQuantization:Tt,decQuantization:Et,customModelId:nn};localStorage.setItem(Zy,JSON.stringify(xt))}catch(xt){console.error("Failed to save settings",xt)}},[m]);we.useEffect(()=>{(async()=>{const ct=await HC(),ft=localStorage.getItem(Zy);let Tt=null;if(ft)try{Tt=JSON.parse(ft)}catch(Gn){console.error("Failed to parse settings",Gn)}let Et=(Tt==null?void 0:Tt.provider)||(ct.hasGPU?"webgpu":"wasm");Et==="webgpu"&&!ct.hasGPU?(console.log("[AppProvider] WebGPU preference found but not available, falling back to WASM"),Et="wasm"):console.log("[AppProvider] Initializing Provider:",Et);let nn=(Tt==null?void 0:Tt.performanceProfile)||(Et==="webgpu"?"high_quality":"balanced"),xt="int8",Zt="int8";if(nn==="custom"&&(Tt!=null&&Tt.encQuantization))xt=Tt.encQuantization,Zt=Tt.decQuantization||"int8";else{const Gn=le(nn);Gn?(xt=Gn.enc,Zt=Gn.dec):(nn="balanced",xt="int8",Zt="int8")}const wn=(Tt==null?void 0:Tt.customModelId)||Ln.ID;s(Et),o(nn),d(xt),h(xt),p(Zt),y(wn)})()},[]);const Q=Ye=>{if(Ye===n)return;let ct=i;Ye==="webgpu"?(i==="balanced"||i==="low_memory")&&(console.log("[AppProvider] Switching to WebGPU: Upgrading profile to High Quality"),ct="high_quality"):Ye==="wasm"&&console.log("[AppProvider] Switching to WASM: Keeping current profile"),ct==="custom"?ae(Ye,ct,{enc:u,dec:g,modelId:m}):ae(Ye,ct,{enc:"int8",dec:"int8",modelId:m})},ne=Ye=>{Ye!==i&&ae(n||"wasm",Ye,{enc:u,dec:g,modelId:m})},de=Ye=>{ae(n||"wasm","custom",{enc:Ye,dec:g==="fp32"?"fp32":Ye,modelId:m})},ve=Ye=>{ae(n||"wasm","custom",{enc:Ye,dec:g,modelId:m})},fe=Ye=>{ae(n||"wasm","custom",{enc:u,dec:Ye,modelId:m})},j=Ye=>{ae(n||"wasm",i,{enc:u,dec:g,modelId:Ye})},{config:U,setConfig:N,status:q,infer:ce,inferFromUrl:Z,loadingPhase:Me,isInferencing:Pe,numCandidates:Ne,setNumCandidates:Oe,doSample:he,setDoSample:H,temperature:Te,setTemperature:ze,topK:Re,setTopK:He,topP:Ke,setTopP:Be,progress:nt,userConfirmed:$e,setUserConfirmed:qe,isLoadedFromCache:_t,isInitialized:Je,isGenerationQueued:pt}=WC(t,n,c,u,g,m),{latex:dt,candidates:Gt,selectedIndex:vt,debugImage:Ze,loadedStrokes:rt,uploadPreview:kt,showUploadResult:Nt,setLatex:gn,setSelectedIndex:Jt,selectCandidate:Cn,setUploadPreview:Fn,setShowUploadResult:tn,clearTabState:ta,updateDrawResult:ds,updateUploadResult:fs,loadDrawState:Wa,setDrawState:Vn,setUploadState:Er,activeInferenceTab:qr,startDrawInference:Pa,endDrawInference:Ft,startUploadInference:ns,endUploadInference:Ha}=QC(v),Dn=()=>ta(),Kr=async Ye=>{Pa();try{const ct=await ce(Ye,{onPreprocess:ft=>Vn(Tt=>({...Tt,debugImage:ft}))});return ct?(ds(ct),ct):null}finally{Ft()}},an=async Ye=>{ns();try{const ct=await Z(Ye,{onPreprocess:ft=>Er(Tt=>({...Tt,debugImage:ft}))});return ct?(fs(ct),ct):null}finally{Ha()}},Qa=Ye=>{X({isOpen:!0,...Ye})},L=()=>X(Ye=>({...Ye,isOpen:!1})),ue=Ye=>{A(!0),R(Ye||null)},Y=()=>{A(!1),R(null)},oe=()=>M(Date.now().toString()),Ue={config:U,setConfig:N,status:q,latex:dt,setLatex:gn,candidates:Gt,loadedStrokes:rt,infer:Kr,inferFromUrl:an,clearModel:Dn,loadingPhase:Me,isInferencing:Pe,isGenerationQueued:pt,debugImage:Ze,numCandidates:Ne,setNumCandidates:Oe,doSample:he,setDoSample:H,temperature:Te,setTemperature:ze,topK:Re,setTopK:He,topP:Ke,setTopP:Be,provider:n||"wasm",setProvider:Q,quantization:c,setQuantization:de,encoderQuantization:u,setEncoderQuantization:ve,decoderQuantization:g,setDecoderQuantization:fe,performanceProfile:i,setPerformanceProfile:ne,progress:nt,userConfirmed:$e,setUserConfirmed:qe,customModelId:m,setCustomModelId:j,isLoadedFromCache:_t,isInitialized:Je,showPreviewInput:S,setShowPreviewInput:D,isSettingsOpen:C,settingsFocus:k,openSettings:ue,closeSettings:Y,isSidebarOpen:O,toggleSidebar:()=>E(Ye=>!Ye),selectedIndex:vt,setSelectedIndex:Jt,selectCandidate:Cn,loadFromHistory:Ye=>{Wa(Ye.latex,Ye.strokes||null),T("draw"),oe()},activeTab:v,setActiveTab:T,sessionId:I,refreshSession:oe,uploadPreview:kt,showUploadResult:Nt,setUploadPreview:Fn,setShowUploadResult:tn,activeInferenceTab:qr,customNotification:G,setCustomNotification:te,dialogConfig:ee,openDialog:Qa,closeDialog:L};return z.jsx(S1.Provider,{value:Ue,children:e})},KC=()=>{const[e,t]=we.useState(()=>{if(typeof window<"u"){const s=localStorage.getItem("texpen_theme");if(s==="dark"||s==="light")return s;if(window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches)return"dark"}return"light"});return we.useEffect(()=>{const s=window.matchMedia("(prefers-color-scheme: dark)"),i=o=>{localStorage.getItem("texpen_theme")||t(o.matches?"dark":"light")};return s.addEventListener("change",i),()=>s.removeEventListener("change",i)},[]),we.useEffect(()=>{const s=window.document.documentElement;e==="dark"?s.classList.add("dark"):s.classList.remove("dark"),localStorage.setItem("texpen_theme",e)},[e]),{theme:e,toggleTheme:()=>{t(s=>s==="dark"?"light":"dark")}}},XC=({children:e})=>{const{theme:t,toggleTheme:n}=KC();return z.jsx(P1.Provider,{value:{theme:t,toggleTheme:n},children:e})},YC=()=>{const[e,t]=we.useState(()=>{if(typeof window>"u")return[];try{const o=window.localStorage.getItem("texpen_history");return o?JSON.parse(o):[]}catch(o){return console.warn("Failed to load history from localStorage:",o),[]}});return we.useEffect(()=>{try{window.localStorage.setItem("texpen_history",JSON.stringify(e))}catch(o){console.warn("Failed to save history to localStorage:",o)}},[e]),{history:e,addToHistory:o=>{t(c=>{if(c.length>0&&c[0].sessionId===o.sessionId){const d=c[0];if(d.latex===o.latex)return c;const h=[...d.versions||[]];h.length===0&&h.push({...d,versions:void 0}),h.push({...o,versions:void 0});const g={...o,versions:h},p=[...c];return p[0]=g,p}return[{...o,versions:[{...o,versions:void 0}]},...c].slice(0,20)})},deleteHistoryItem:o=>{t(c=>c.filter(d=>d.id!==o))},clearHistory:()=>{t([])}}},D1=we.createContext(void 0),i_=()=>{const e=we.useContext(D1);if(!e)throw new Error("useHistoryContext must be used within a HistoryProvider");return e},JC=({children:e})=>{const{history:t,addToHistory:n,deleteHistoryItem:s,clearHistory:i}=YC(),[o,c]=ma.useState("all");return z.jsx(D1.Provider,{value:{history:t,addToHistory:n,deleteHistoryItem:s,clearHistory:i,filterMode:o,setFilterMode:c},children:e})},ZC=()=>z.jsxs("div",{className:"fixed inset-0 overflow-hidden pointer-events-none -z-10 bg-[#fafafa] dark:bg-[#050505] transition-colors duration-500",children:[z.jsx("div",{className:"absolute top-0 left-0 w-full h-full bg-gradient-to-br from-white via-[#fafafa] to-slate-100 dark:from-[#0a0a1a] dark:via-[#050505] dark:to-[#1a0a1a] opacity-80 transition-colors duration-500"}),z.jsx("div",{className:"absolute -top-[20%] -left-[10%] w-[50vw] h-[50vw] bg-cyan-300/30 dark:bg-cyan-500/20 rounded-full blur-[100px] mix-blend-multiply dark:mix-blend-screen animate-blob"}),z.jsx("div",{className:"absolute -bottom-[20%] -right-[10%] w-[50vw] h-[50vw] bg-purple-300/30 dark:bg-purple-500/20 rounded-full blur-[100px] mix-blend-multiply dark:mix-blend-screen animate-blob animation-delay-2000"}),z.jsx("div",{className:"absolute top-[40%] left-[40%] w-[40vw] h-[40vw] bg-pink-300/20 dark:bg-pink-500/10 rounded-full blur-[100px] mix-blend-multiply dark:mix-blend-screen animate-blob animation-delay-4000"}),z.jsx("div",{className:"absolute inset-0 opacity-[0.03]",style:{backgroundImage:"linear-gradient(currentColor 1px, transparent 1px), linear-gradient(90deg, currentColor 1px, transparent 1px)",backgroundSize:"40px 40px"}})]}),eS=({className:e})=>z.jsx("svg",{className:e,viewBox:"0 0 433.2472 127.14722",xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink",version:"1.1",children:z.jsxs("g",{enableBackground:"new",children:[z.jsx("symbol",{id:"font_0_3",children:z.jsx("path",{d:"M .63 .67700007 L .019000002 .67700007 L 0 .45200003 L .025000003 .45200003 C .039 .61300006 .054 .646 .20500002 .646 C .223 .646 .24900003 .646 .259 .64400008 C .28 .64000007 .28 .629 .28 .606 L .28 .079 C .28 .045 .28 .031000002 .17500001 .031000002 L .135 .031000002 L .135 0 C .17600002 .003 .278 .003 .324 .003 C .37 .003 .473 .003 .514 0 L .514 .031000002 L .47400005 .031000002 C .36900003 .031000002 .36900003 .045 .36900003 .079 L .36900003 .606 C .36900003 .62600007 .36900003 .64000007 .387 .64400008 C .398 .646 .425 .646 .444 .646 C .595 .646 .61 .61300006 .624 .45200003 L .64900007 .45200003 L .63 .67700007 Z "})}),z.jsx("symbol",{id:"font_0_1",children:z.jsx("path",{d:"M .10300001 .078 C .10300001 .042000005 .101 .031000002 .024000004 .031000002 L 0 .031000002 L 0 0 L .577 0 L .619 .25800003 L .59400007 .25800003 C .56900009 .104 .54600009 .031000002 .374 .031000002 L .24100003 .031000002 C .194 .031000002 .192 .038000004 .192 .071 L .192 .33800004 L .28200004 .33800004 C .37900005 .33800004 .39000003 .30600003 .39000003 .22100002 L .41500003 .22100002 L .41500003 .48600004 L .39000003 .48600004 C .39000003 .4 .37900005 .36900003 .28200004 .36900003 L .192 .36900003 L .192 .609 C .192 .642 .194 .64900007 .24100003 .64900007 L .37000004 .64900007 C .52300009 .64900007 .55 .59400007 .56600007 .455 L .591 .455 L .563 .68 L 0 .68 L 0 .64900007 L .024000004 .64900007 C .101 .64900007 .10300001 .638 .10300001 .60200008 L .10300001 .078 Z "})}),z.jsx("symbol",{id:"font_0_4",children:z.jsx("path",{d:"M .37800003 .386 L .51500007 .587 C .53700008 .619 .57100006 .651 .66 .652 L .66 .683 C .62100008 .68200007 .57400009 .68 .549 .68 C .50900009 .68 .46100004 .68 .42100004 .683 L .42100004 .652 C .46100004 .651 .48300005 .629 .48300005 .606 C .48300005 .596 .481 .59400007 .47400005 .583 L .36 .41400004 L .23100002 .60700008 C .22900002 .61 .224 .61800006 .224 .62200006 C .224 .634 .246 .651 .28900004 .652 L .28900004 .683 C .25400005 .68 .18100001 .68 .143 .68 C .112 .68 .05 .68100008 .013 .683 L .013 .652 L .032 .652 C .08700001 .652 .106000009 .64500007 .125 .61700007 L .30900003 .33900003 L .14500001 .097 C .131 .07700001 .100999999 .031000002 0 .031000002 L 0 0 C .036000004 .001 .07800001 .003 .111 .003 C .148 .003 .20300001 .003 .23900001 0 L .23900001 .031000002 C .193 .032 .176 .059000005 .176 .07700001 C .176 .086 .179 .09 .186 .101 L .32800005 .31100003 L .48600007 .072000008 C .48800005 .068 .49100007 .064 .49100007 .061000006 C .49100007 .049000004 .46900005 .032 .42600004 .031000002 L .42600004 0 C .46100004 .003 .53400006 .003 .572 .003 C .614 .003 .66 .002 .702 0 L .702 .031000002 L .683 .031000002 C .63100007 .031000002 .61 .036000004 .58900007 .067 L .37800003 .386 Z "})}),z.jsx("use",{href:"#font_0_3",transform:"matrix(110.69555,0,0,-110.69555,17.82115,89.480548)",fill:"currentColor"}),z.jsx("use",{href:"#font_0_1",transform:"matrix(110.69555,0,0,-110.69555,78.98906,113.31388)",fill:"currentColor"}),z.jsx("use",{href:"#font_0_4",transform:"matrix(110.69555,0,0,-110.69555,139.49279,89.480548)",fill:"currentColor"}),z.jsx("symbol",{id:"font_0_2",children:z.jsx("path",{d:"M .19200002 .316 L .36100004 .316 C .48100005 .316 .589 .397 .589 .497 C .589 .595 .49000005 .683 .35300002 .683 L 0 .683 L 0 .652 L .024000004 .652 C .10100001 .652 .103000018 .64100006 .103000018 .605 L .103000018 .078 C .103000018 .042000005 .10100001 .031000002 .024000004 .031000002 L 0 .031000002 L 0 0 C .035 .003 .10900001 .003 .14700002 .003 C .18500002 .003 .26000003 .003 .29500003 0 L .29500003 .031000002 L .27100004 .031000002 C .19400002 .031000002 .19200002 .042000005 .19200002 .078 L .19200002 .316 M .18900001 .342 L .18900001 .61200007 C .18900001 .64500007 .19100002 .652 .238 .652 L .32700003 .652 C .48600004 .652 .48600004 .546 .48600004 .497 C .48600004 .45000003 .48600004 .342 .32700003 .342 L .18900001 .342 Z "})}),z.jsx("symbol",{id:"font_0_5",children:z.jsx("path",{d:"M .08400001 .263 C .09 .41200004 .17400001 .43700005 .20800002 .43700005 C .31100003 .43700005 .321 .30200003 .321 .263 L .08400001 .263 M .083000008 .24200002 L .36200003 .24200002 C .38400004 .24200002 .38700003 .24200002 .38700003 .263 C .38700003 .36200003 .33300004 .45900003 .20800002 .45900003 C .09200001 .45900003 0 .35600005 0 .23100002 C 0 .097 .105000007 0 .22000002 0 C .342 0 .38700003 .111 .38700003 .13000001 C .38700003 .14000002 .379 .14200002 .374 .14200002 C .365 .14200002 .36300005 .136 .36100004 .128 C .326 .025000003 .236 .025000003 .22600001 .025000003 C .17600002 .025000003 .136 .055000005 .113000009 .092 C .083000008 .14000002 .083000008 .20600002 .083000008 .24200002 Z "})}),z.jsx("symbol",{id:"font_0_6",children:z.jsx("path",{d:"M .07800001 .344 L .07800001 .076000008 C .07800001 .031000002 .067 .031000002 0 .031000002 L 0 0 C .035 .001 .08600001 .003 .113000009 .003 C .139 .003 .191 .001 .225 0 L .225 .031000002 C .158 .031000002 .147 .031000002 .147 .076000008 L .147 .26000003 C .147 .36400003 .218 .42000003 .282 .42000003 C .345 .42000003 .356 .36600004 .356 .30900003 L .356 .076000008 C .356 .031000002 .345 .031000002 .278 .031000002 L .278 0 C .31300003 .001 .36400003 .003 .391 .003 C .41700004 .003 .46900005 .001 .503 0 L .503 .031000002 C .451 .031000002 .42600004 .031000002 .425 .061000006 L .425 .252 C .425 .33800004 .425 .36900003 .39400003 .40500004 C .38000003 .42200003 .347 .44200004 .289 .44200004 C .216 .44200004 .169 .39900003 .141 .337 L .141 .44200004 L 0 .43100003 L 0 .4 C .07000001 .4 .07800001 .393 .07800001 .344 Z "})}),z.jsx("use",{href:"#font_0_2",transform:"matrix(110.69555,0,0,-110.69555,240.33644,89.480548)",className:"text-cyan-500 dark:text-cyan-400",fill:"currentColor"}),z.jsx("use",{href:"#font_0_5",transform:"matrix(110.69555,0,0,-110.69555,311.84577,90.6982)",className:"text-cyan-500 dark:text-cyan-400",fill:"currentColor"}),z.jsx("use",{href:"#font_0_6",transform:"matrix(110.69555,0,0,-110.69555,361.43739,89.480548)",className:"text-cyan-500 dark:text-cyan-400",fill:"currentColor"})]})});function Mu(e){"@babel/helpers - typeof";return Mu=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Mu(e)}function tS(e,t){if(Mu(e)!="object"||!e)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var s=n.call(e,t);if(Mu(s)!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function O1(e){var t=tS(e,"string");return Mu(t)=="symbol"?t:t+""}function rm(e,t,n){return(t=O1(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function eb(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,s)}return n}function Yt(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?eb(Object(n),!0).forEach(function(s){rm(e,s,n[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):eb(Object(n)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(n,s))})}return e}function nS(e){if(Array.isArray(e))return e}function rS(e,t){var n=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(n!=null){var s,i,o,c,d=[],u=!0,h=!1;try{if(o=(n=n.call(e)).next,t===0){if(Object(n)!==n)return;u=!1}else for(;!(u=(s=o.call(n)).done)&&(d.push(s.value),d.length!==t);u=!0);}catch(g){h=!0,i=g}finally{try{if(!u&&n.return!=null&&(c=n.return(),Object(c)!==c))return}finally{if(h)throw i}}return d}}function K0(e,t){(t==null||t>e.length)&&(t=e.length);for(var n=0,s=Array(t);n<t;n++)s[n]=e[n];return s}function $1(e,t){if(e){if(typeof e=="string")return K0(e,t);var n={}.toString.call(e).slice(8,-1);return n==="Object"&&e.constructor&&(n=e.constructor.name),n==="Map"||n==="Set"?Array.from(e):n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?K0(e,t):void 0}}function aS(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Zo(e,t){return nS(e)||rS(e,t)||$1(e,t)||aS()}function sS(e,t){if(e==null)return{};var n={};for(var s in e)if({}.hasOwnProperty.call(e,s)){if(t.indexOf(s)!==-1)continue;n[s]=e[s]}return n}function tl(e,t){if(e==null)return{};var n,s,i=sS(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(s=0;s<o.length;s++)n=o[s],t.indexOf(n)===-1&&{}.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}var iS=["defaultInputValue","defaultMenuIsOpen","defaultValue","inputValue","menuIsOpen","onChange","onInputChange","onMenuClose","onMenuOpen","value"];function oS(e){var t=e.defaultInputValue,n=t===void 0?"":t,s=e.defaultMenuIsOpen,i=s===void 0?!1:s,o=e.defaultValue,c=o===void 0?null:o,d=e.inputValue,u=e.menuIsOpen,h=e.onChange,g=e.onInputChange,p=e.onMenuClose,m=e.onMenuOpen,y=e.value,v=tl(e,iS),T=we.useState(d!==void 0?d:n),O=Zo(T,2),E=O[0],S=O[1],D=we.useState(u!==void 0?u:i),I=Zo(D,2),M=I[0],C=I[1],A=we.useState(y!==void 0?y:c),k=Zo(A,2),R=k[0],G=k[1],te=we.useCallback(function(de,ve){typeof h=="function"&&h(de,ve),G(de)},[h]),ee=we.useCallback(function(de,ve){var fe;typeof g=="function"&&(fe=g(de,ve)),S(fe!==void 0?fe:de)},[g]),X=we.useCallback(function(){typeof m=="function"&&m(),C(!0)},[m]),le=we.useCallback(function(){typeof p=="function"&&p(),C(!1)},[p]),ae=d!==void 0?d:E,Q=u!==void 0?u:M,ne=y!==void 0?y:R;return Yt(Yt({},v),{},{inputValue:ae,menuIsOpen:Q,onChange:te,onInputChange:ee,onMenuClose:le,onMenuOpen:X,value:ne})}function rn(){return rn=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var s in n)({}).hasOwnProperty.call(n,s)&&(e[s]=n[s])}return e},rn.apply(null,arguments)}function lS(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function tb(e,t){for(var n=0;n<t.length;n++){var s=t[n];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,O1(s.key),s)}}function cS(e,t,n){return t&&tb(e.prototype,t),n&&tb(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function X0(e,t){return X0=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,s){return n.__proto__=s,n},X0(e,t)}function uS(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&X0(e,t)}function Vg(e){return Vg=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},Vg(e)}function B1(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(B1=function(){return!!e})()}function dS(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function fS(e,t){if(t&&(Mu(t)=="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return dS(e)}function hS(e){var t=B1();return function(){var n,s=Vg(e);if(t){var i=Vg(this).constructor;n=Reflect.construct(s,arguments,i)}else n=s.apply(this,arguments);return fS(this,n)}}function pS(e){if(Array.isArray(e))return K0(e)}function mS(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function gS(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Ov(e){return pS(e)||mS(e)||$1(e)||gS()}function _S(e){if(e.sheet)return e.sheet;for(var t=0;t<document.styleSheets.length;t++)if(document.styleSheets[t].ownerNode===e)return document.styleSheets[t]}function vS(e){var t=document.createElement("style");return t.setAttribute("data-emotion",e.key),e.nonce!==void 0&&t.setAttribute("nonce",e.nonce),t.appendChild(document.createTextNode("")),t.setAttribute("data-s",""),t}var yS=(function(){function e(n){var s=this;this._insertTag=function(i){var o;s.tags.length===0?s.insertionPoint?o=s.insertionPoint.nextSibling:s.prepend?o=s.container.firstChild:o=s.before:o=s.tags[s.tags.length-1].nextSibling,s.container.insertBefore(i,o),s.tags.push(i)},this.isSpeedy=n.speedy===void 0?!0:n.speedy,this.tags=[],this.ctr=0,this.nonce=n.nonce,this.key=n.key,this.container=n.container,this.prepend=n.prepend,this.insertionPoint=n.insertionPoint,this.before=null}var t=e.prototype;return t.hydrate=function(s){s.forEach(this._insertTag)},t.insert=function(s){this.ctr%(this.isSpeedy?65e3:1)===0&&this._insertTag(vS(this));var i=this.tags[this.tags.length-1];if(this.isSpeedy){var o=_S(i);try{o.insertRule(s,o.cssRules.length)}catch{}}else i.appendChild(document.createTextNode(s));this.ctr++},t.flush=function(){this.tags.forEach(function(s){var i;return(i=s.parentNode)==null?void 0:i.removeChild(s)}),this.tags=[],this.ctr=0},e})(),Va="-ms-",Gg="-moz-",Kn="-webkit-",L1="comm",$v="rule",Bv="decl",bS="@import",F1="@keyframes",wS="@layer",MS=Math.abs,o_=String.fromCharCode,xS=Object.assign;function ES(e,t){return Sa(e,0)^45?(((t<<2^Sa(e,0))<<2^Sa(e,1))<<2^Sa(e,2))<<2^Sa(e,3):0}function z1(e){return e.trim()}function TS(e,t){return(e=t.exec(e))?e[0]:e}function Yn(e,t,n){return e.replace(t,n)}function Y0(e,t){return e.indexOf(t)}function Sa(e,t){return e.charCodeAt(t)|0}function um(e,t,n){return e.slice(t,n)}function so(e){return e.length}function Lv(e){return e.length}function ug(e,t){return t.push(e),e}function AS(e,t){return e.map(t).join("")}var l_=1,bf=1,N1=0,us=0,ca=0,xf="";function c_(e,t,n,s,i,o,c){return{value:e,root:t,parent:n,type:s,props:i,children:o,line:l_,column:bf,length:c,return:""}}function Gp(e,t){return xS(c_("",null,null,"",null,null,0),e,{length:-e.length},t)}function CS(){return ca}function SS(){return ca=us>0?Sa(xf,--us):0,bf--,ca===10&&(bf=1,l_--),ca}function Os(){return ca=us<N1?Sa(xf,us++):0,bf++,ca===10&&(bf=1,l_++),ca}function oo(){return Sa(xf,us)}function Dg(){return us}function _m(e,t){return um(xf,e,t)}function dm(e){switch(e){case 0:case 9:case 10:case 13:case 32:return 5;case 33:case 43:case 44:case 47:case 62:case 64:case 126:case 59:case 123:case 125:return 4;case 58:return 3;case 34:case 39:case 40:case 91:return 2;case 41:case 93:return 1}return 0}function R1(e){return l_=bf=1,N1=so(xf=e),us=0,[]}function j1(e){return xf="",e}function Og(e){return z1(_m(us-1,J0(e===91?e+2:e===40?e+1:e)))}function IS(e){for(;(ca=oo())&&ca<33;)Os();return dm(e)>2||dm(ca)>3?"":" "}function PS(e,t){for(;--t&&Os()&&!(ca<48||ca>102||ca>57&&ca<65||ca>70&&ca<97););return _m(e,Dg()+(t<6&&oo()==32&&Os()==32))}function J0(e){for(;Os();)switch(ca){case e:return us;case 34:case 39:e!==34&&e!==39&&J0(ca);break;case 40:e===41&&J0(e);break;case 92:Os();break}return us}function kS(e,t){for(;Os()&&e+ca!==57;)if(e+ca===84&&oo()===47)break;return"/*"+_m(t,us-1)+"*"+o_(e===47?e:Os())}function DS(e){for(;!dm(oo());)Os();return _m(e,us)}function OS(e){return j1($g("",null,null,null,[""],e=R1(e),0,[0],e))}function $g(e,t,n,s,i,o,c,d,u){for(var h=0,g=0,p=c,m=0,y=0,v=0,T=1,O=1,E=1,S=0,D="",I=i,M=o,C=s,A=D;O;)switch(v=S,S=Os()){case 40:if(v!=108&&Sa(A,p-1)==58){Y0(A+=Yn(Og(S),"&","&\f"),"&\f")!=-1&&(E=-1);break}case 34:case 39:case 91:A+=Og(S);break;case 9:case 10:case 13:case 32:A+=IS(v);break;case 92:A+=PS(Dg()-1,7);continue;case 47:switch(oo()){case 42:case 47:ug($S(kS(Os(),Dg()),t,n),u);break;default:A+="/"}break;case 123*T:d[h++]=so(A)*E;case 125*T:case 59:case 0:switch(S){case 0:case 125:O=0;case 59+g:E==-1&&(A=Yn(A,/\f/g,"")),y>0&&so(A)-p&&ug(y>32?rb(A+";",s,n,p-1):rb(Yn(A," ","")+";",s,n,p-2),u);break;case 59:A+=";";default:if(ug(C=nb(A,t,n,h,g,i,d,D,I=[],M=[],p),o),S===123)if(g===0)$g(A,t,C,C,I,o,p,d,M);else switch(m===99&&Sa(A,3)===110?100:m){case 100:case 108:case 109:case 115:$g(e,C,C,s&&ug(nb(e,C,C,0,0,i,d,D,i,I=[],p),M),i,M,p,d,s?I:M);break;default:$g(A,C,C,C,[""],M,0,d,M)}}h=g=y=0,T=E=1,D=A="",p=c;break;case 58:p=1+so(A),y=v;default:if(T<1){if(S==123)--T;else if(S==125&&T++==0&&SS()==125)continue}switch(A+=o_(S),S*T){case 38:E=g>0?1:(A+="\f",-1);break;case 44:d[h++]=(so(A)-1)*E,E=1;break;case 64:oo()===45&&(A+=Og(Os())),m=oo(),g=p=so(D=A+=DS(Dg())),S++;break;case 45:v===45&&so(A)==2&&(T=0)}}return o}function nb(e,t,n,s,i,o,c,d,u,h,g){for(var p=i-1,m=i===0?o:[""],y=Lv(m),v=0,T=0,O=0;v<s;++v)for(var E=0,S=um(e,p+1,p=MS(T=c[v])),D=e;E<y;++E)(D=z1(T>0?m[E]+" "+S:Yn(S,/&\f/g,m[E])))&&(u[O++]=D);return c_(e,t,n,i===0?$v:d,u,h,g)}function $S(e,t,n){return c_(e,t,n,L1,o_(CS()),um(e,2,-2),0)}function rb(e,t,n,s){return c_(e,t,n,Bv,um(e,0,s),um(e,s+1,-1),s)}function yf(e,t){for(var n="",s=Lv(e),i=0;i<s;i++)n+=t(e[i],i,e,t)||"";return n}function BS(e,t,n,s){switch(e.type){case wS:if(e.children.length)break;case bS:case Bv:return e.return=e.return||e.value;case L1:return"";case F1:return e.return=e.value+"{"+yf(e.children,s)+"}";case $v:e.value=e.props.join(",")}return so(n=yf(e.children,s))?e.return=e.value+"{"+n+"}":""}function LS(e){var t=Lv(e);return function(n,s,i,o){for(var c="",d=0;d<t;d++)c+=e[d](n,s,i,o)||"";return c}}function FS(e){return function(t){t.root||(t=t.return)&&e(t)}}function zS(e){var t=Object.create(null);return function(n){return t[n]===void 0&&(t[n]=e(n)),t[n]}}var NS=function(t,n,s){for(var i=0,o=0;i=o,o=oo(),i===38&&o===12&&(n[s]=1),!dm(o);)Os();return _m(t,us)},RS=function(t,n){var s=-1,i=44;do switch(dm(i)){case 0:i===38&&oo()===12&&(n[s]=1),t[s]+=NS(us-1,n,s);break;case 2:t[s]+=Og(i);break;case 4:if(i===44){t[++s]=oo()===58?"&\f":"",n[s]=t[s].length;break}default:t[s]+=o_(i)}while(i=Os());return t},jS=function(t,n){return j1(RS(R1(t),n))},ab=new WeakMap,US=function(t){if(!(t.type!=="rule"||!t.parent||t.length<1)){for(var n=t.value,s=t.parent,i=t.column===s.column&&t.line===s.line;s.type!=="rule";)if(s=s.parent,!s)return;if(!(t.props.length===1&&n.charCodeAt(0)!==58&&!ab.get(s))&&!i){ab.set(t,!0);for(var o=[],c=jS(n,o),d=s.props,u=0,h=0;u<c.length;u++)for(var g=0;g<d.length;g++,h++)t.props[h]=o[u]?c[u].replace(/&\f/g,d[g]):d[g]+" "+c[u]}}},VS=function(t){if(t.type==="decl"){var n=t.value;n.charCodeAt(0)===108&&n.charCodeAt(2)===98&&(t.return="",t.value="")}};function U1(e,t){switch(ES(e,t)){case 5103:return Kn+"print-"+e+e;case 5737:case 4201:case 3177:case 3433:case 1641:case 4457:case 2921:case 5572:case 6356:case 5844:case 3191:case 6645:case 3005:case 6391:case 5879:case 5623:case 6135:case 4599:case 4855:case 4215:case 6389:case 5109:case 5365:case 5621:case 3829:return Kn+e+e;case 5349:case 4246:case 4810:case 6968:case 2756:return Kn+e+Gg+e+Va+e+e;case 6828:case 4268:return Kn+e+Va+e+e;case 6165:return Kn+e+Va+"flex-"+e+e;case 5187:return Kn+e+Yn(e,/(\w+).+(:[^]+)/,Kn+"box-$1$2"+Va+"flex-$1$2")+e;case 5443:return Kn+e+Va+"flex-item-"+Yn(e,/flex-|-self/,"")+e;case 4675:return Kn+e+Va+"flex-line-pack"+Yn(e,/align-content|flex-|-self/,"")+e;case 5548:return Kn+e+Va+Yn(e,"shrink","negative")+e;case 5292:return Kn+e+Va+Yn(e,"basis","preferred-size")+e;case 6060:return Kn+"box-"+Yn(e,"-grow","")+Kn+e+Va+Yn(e,"grow","positive")+e;case 4554:return Kn+Yn(e,/([^-])(transform)/g,"$1"+Kn+"$2")+e;case 6187:return Yn(Yn(Yn(e,/(zoom-|grab)/,Kn+"$1"),/(image-set)/,Kn+"$1"),e,"")+e;case 5495:case 3959:return Yn(e,/(image-set\([^]*)/,Kn+"$1$`$1");case 4968:return Yn(Yn(e,/(.+:)(flex-)?(.*)/,Kn+"box-pack:$3"+Va+"flex-pack:$3"),/s.+-b[^;]+/,"justify")+Kn+e+e;case 4095:case 3583:case 4068:case 2532:return Yn(e,/(.+)-inline(.+)/,Kn+"$1$2")+e;case 8116:case 7059:case 5753:case 5535:case 5445:case 5701:case 4933:case 4677:case 5533:case 5789:case 5021:case 4765:if(so(e)-1-t>6)switch(Sa(e,t+1)){case 109:if(Sa(e,t+4)!==45)break;case 102:return Yn(e,/(.+:)(.+)-([^]+)/,"$1"+Kn+"$2-$3$1"+Gg+(Sa(e,t+3)==108?"$3":"$2-$3"))+e;case 115:return~Y0(e,"stretch")?U1(Yn(e,"stretch","fill-available"),t)+e:e}break;case 4949:if(Sa(e,t+1)!==115)break;case 6444:switch(Sa(e,so(e)-3-(~Y0(e,"!important")&&10))){case 107:return Yn(e,":",":"+Kn)+e;case 101:return Yn(e,/(.+:)([^;!]+)(;|!.+)?/,"$1"+Kn+(Sa(e,14)===45?"inline-":"")+"box$3$1"+Kn+"$2$3$1"+Va+"$2box$3")+e}break;case 5936:switch(Sa(e,t+11)){case 114:return Kn+e+Va+Yn(e,/[svh]\w+-[tblr]{2}/,"tb")+e;case 108:return Kn+e+Va+Yn(e,/[svh]\w+-[tblr]{2}/,"tb-rl")+e;case 45:return Kn+e+Va+Yn(e,/[svh]\w+-[tblr]{2}/,"lr")+e}return Kn+e+Va+e+e}return e}var GS=function(t,n,s,i){if(t.length>-1&&!t.return)switch(t.type){case Bv:t.return=U1(t.value,t.length);break;case F1:return yf([Gp(t,{value:Yn(t.value,"@","@"+Kn)})],i);case $v:if(t.length)return AS(t.props,function(o){switch(TS(o,/(::plac\w+|:read-\w+)/)){case":read-only":case":read-write":return yf([Gp(t,{props:[Yn(o,/:(read-\w+)/,":"+Gg+"$1")]})],i);case"::placeholder":return yf([Gp(t,{props:[Yn(o,/:(plac\w+)/,":"+Kn+"input-$1")]}),Gp(t,{props:[Yn(o,/:(plac\w+)/,":"+Gg+"$1")]}),Gp(t,{props:[Yn(o,/:(plac\w+)/,Va+"input-$1")]})],i)}return""})}},WS=[GS],HS=function(t){var n=t.key;if(n==="css"){var s=document.querySelectorAll("style[data-emotion]:not([data-s])");Array.prototype.forEach.call(s,function(T){var O=T.getAttribute("data-emotion");O.indexOf(" ")!==-1&&(document.head.appendChild(T),T.setAttribute("data-s",""))})}var i=t.stylisPlugins||WS,o={},c,d=[];c=t.container||document.head,Array.prototype.forEach.call(document.querySelectorAll('style[data-emotion^="'+n+' "]'),function(T){for(var O=T.getAttribute("data-emotion").split(" "),E=1;E<O.length;E++)o[O[E]]=!0;d.push(T)});var u,h=[US,VS];{var g,p=[BS,FS(function(T){g.insert(T)})],m=LS(h.concat(i,p)),y=function(O){return yf(OS(O),m)};u=function(O,E,S,D){g=S,y(O?O+"{"+E.styles+"}":E.styles),D&&(v.inserted[E.name]=!0)}}var v={key:n,sheet:new yS({key:n,container:c,nonce:t.nonce,speedy:t.speedy,prepend:t.prepend,insertionPoint:t.insertionPoint}),nonce:t.nonce,inserted:o,registered:{},insert:u};return v.sheet.hydrate(d),v},B_={exports:{}},tr={};/** @license React v16.13.1
 * react-is.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var sb;function QS(){if(sb)return tr;sb=1;var e=typeof Symbol=="function"&&Symbol.for,t=e?Symbol.for("react.element"):60103,n=e?Symbol.for("react.portal"):60106,s=e?Symbol.for("react.fragment"):60107,i=e?Symbol.for("react.strict_mode"):60108,o=e?Symbol.for("react.profiler"):60114,c=e?Symbol.for("react.provider"):60109,d=e?Symbol.for("react.context"):60110,u=e?Symbol.for("react.async_mode"):60111,h=e?Symbol.for("react.concurrent_mode"):60111,g=e?Symbol.for("react.forward_ref"):60112,p=e?Symbol.for("react.suspense"):60113,m=e?Symbol.for("react.suspense_list"):60120,y=e?Symbol.for("react.memo"):60115,v=e?Symbol.for("react.lazy"):60116,T=e?Symbol.for("react.block"):60121,O=e?Symbol.for("react.fundamental"):60117,E=e?Symbol.for("react.responder"):60118,S=e?Symbol.for("react.scope"):60119;function D(M){if(typeof M=="object"&&M!==null){var C=M.$$typeof;switch(C){case t:switch(M=M.type,M){case u:case h:case s:case o:case i:case p:return M;default:switch(M=M&&M.$$typeof,M){case d:case g:case v:case y:case c:return M;default:return C}}case n:return C}}}function I(M){return D(M)===h}return tr.AsyncMode=u,tr.ConcurrentMode=h,tr.ContextConsumer=d,tr.ContextProvider=c,tr.Element=t,tr.ForwardRef=g,tr.Fragment=s,tr.Lazy=v,tr.Memo=y,tr.Portal=n,tr.Profiler=o,tr.StrictMode=i,tr.Suspense=p,tr.isAsyncMode=function(M){return I(M)||D(M)===u},tr.isConcurrentMode=I,tr.isContextConsumer=function(M){return D(M)===d},tr.isContextProvider=function(M){return D(M)===c},tr.isElement=function(M){return typeof M=="object"&&M!==null&&M.$$typeof===t},tr.isForwardRef=function(M){return D(M)===g},tr.isFragment=function(M){return D(M)===s},tr.isLazy=function(M){return D(M)===v},tr.isMemo=function(M){return D(M)===y},tr.isPortal=function(M){return D(M)===n},tr.isProfiler=function(M){return D(M)===o},tr.isStrictMode=function(M){return D(M)===i},tr.isSuspense=function(M){return D(M)===p},tr.isValidElementType=function(M){return typeof M=="string"||typeof M=="function"||M===s||M===h||M===o||M===i||M===p||M===m||typeof M=="object"&&M!==null&&(M.$$typeof===v||M.$$typeof===y||M.$$typeof===c||M.$$typeof===d||M.$$typeof===g||M.$$typeof===O||M.$$typeof===E||M.$$typeof===S||M.$$typeof===T)},tr.typeOf=D,tr}var ib;function qS(){return ib||(ib=1,B_.exports=QS()),B_.exports}var L_,ob;function KS(){if(ob)return L_;ob=1;var e=qS(),t={childContextTypes:!0,contextType:!0,contextTypes:!0,defaultProps:!0,displayName:!0,getDefaultProps:!0,getDerivedStateFromError:!0,getDerivedStateFromProps:!0,mixins:!0,propTypes:!0,type:!0},n={name:!0,length:!0,prototype:!0,caller:!0,callee:!0,arguments:!0,arity:!0},s={$$typeof:!0,render:!0,defaultProps:!0,displayName:!0,propTypes:!0},i={$$typeof:!0,compare:!0,defaultProps:!0,displayName:!0,propTypes:!0,type:!0},o={};o[e.ForwardRef]=s,o[e.Memo]=i;function c(v){return e.isMemo(v)?i:o[v.$$typeof]||t}var d=Object.defineProperty,u=Object.getOwnPropertyNames,h=Object.getOwnPropertySymbols,g=Object.getOwnPropertyDescriptor,p=Object.getPrototypeOf,m=Object.prototype;function y(v,T,O){if(typeof T!="string"){if(m){var E=p(T);E&&E!==m&&y(v,E,O)}var S=u(T);h&&(S=S.concat(h(T)));for(var D=c(v),I=c(T),M=0;M<S.length;++M){var C=S[M];if(!n[C]&&!(O&&O[C])&&!(I&&I[C])&&!(D&&D[C])){var A=g(T,C);try{d(v,C,A)}catch{}}}}return v}return L_=y,L_}KS();var XS=!0;function YS(e,t,n){var s="";return n.split(" ").forEach(function(i){e[i]!==void 0?t.push(e[i]+";"):i&&(s+=i+" ")}),s}var V1=function(t,n,s){var i=t.key+"-"+n.name;(s===!1||XS===!1)&&t.registered[i]===void 0&&(t.registered[i]=n.styles)},JS=function(t,n,s){V1(t,n,s);var i=t.key+"-"+n.name;if(t.inserted[n.name]===void 0){var o=n;do t.insert(n===o?"."+i:"",o,t.sheet,!0),o=o.next;while(o!==void 0)}};function ZS(e){for(var t=0,n,s=0,i=e.length;i>=4;++s,i-=4)n=e.charCodeAt(s)&255|(e.charCodeAt(++s)&255)<<8|(e.charCodeAt(++s)&255)<<16|(e.charCodeAt(++s)&255)<<24,n=(n&65535)*1540483477+((n>>>16)*59797<<16),n^=n>>>24,t=(n&65535)*1540483477+((n>>>16)*59797<<16)^(t&65535)*1540483477+((t>>>16)*59797<<16);switch(i){case 3:t^=(e.charCodeAt(s+2)&255)<<16;case 2:t^=(e.charCodeAt(s+1)&255)<<8;case 1:t^=e.charCodeAt(s)&255,t=(t&65535)*1540483477+((t>>>16)*59797<<16)}return t^=t>>>13,t=(t&65535)*1540483477+((t>>>16)*59797<<16),((t^t>>>15)>>>0).toString(36)}var e3={animationIterationCount:1,aspectRatio:1,borderImageOutset:1,borderImageSlice:1,borderImageWidth:1,boxFlex:1,boxFlexGroup:1,boxOrdinalGroup:1,columnCount:1,columns:1,flex:1,flexGrow:1,flexPositive:1,flexShrink:1,flexNegative:1,flexOrder:1,gridRow:1,gridRowEnd:1,gridRowSpan:1,gridRowStart:1,gridColumn:1,gridColumnEnd:1,gridColumnSpan:1,gridColumnStart:1,msGridRow:1,msGridRowSpan:1,msGridColumn:1,msGridColumnSpan:1,fontWeight:1,lineHeight:1,opacity:1,order:1,orphans:1,scale:1,tabSize:1,widows:1,zIndex:1,zoom:1,WebkitLineClamp:1,fillOpacity:1,floodOpacity:1,stopOpacity:1,strokeDasharray:1,strokeDashoffset:1,strokeMiterlimit:1,strokeOpacity:1,strokeWidth:1},t3=/[A-Z]|^ms/g,n3=/_EMO_([^_]+?)_([^]*?)_EMO_/g,G1=function(t){return t.charCodeAt(1)===45},lb=function(t){return t!=null&&typeof t!="boolean"},F_=zS(function(e){return G1(e)?e:e.replace(t3,"-$&").toLowerCase()}),cb=function(t,n){switch(t){case"animation":case"animationName":if(typeof n=="string")return n.replace(n3,function(s,i,o){return io={name:i,styles:o,next:io},i})}return e3[t]!==1&&!G1(t)&&typeof n=="number"&&n!==0?n+"px":n};function fm(e,t,n){if(n==null)return"";var s=n;if(s.__emotion_styles!==void 0)return s;switch(typeof n){case"boolean":return"";case"object":{var i=n;if(i.anim===1)return io={name:i.name,styles:i.styles,next:io},i.name;var o=n;if(o.styles!==void 0){var c=o.next;if(c!==void 0)for(;c!==void 0;)io={name:c.name,styles:c.styles,next:io},c=c.next;var d=o.styles+";";return d}return r3(e,t,n)}case"function":{if(e!==void 0){var u=io,h=n(e);return io=u,fm(e,t,h)}break}}var g=n;return g}function r3(e,t,n){var s="";if(Array.isArray(n))for(var i=0;i<n.length;i++)s+=fm(e,t,n[i])+";";else for(var o in n){var c=n[o];if(typeof c!="object"){var d=c;lb(d)&&(s+=F_(o)+":"+cb(o,d)+";")}else if(Array.isArray(c)&&typeof c[0]=="string"&&t==null)for(var u=0;u<c.length;u++)lb(c[u])&&(s+=F_(o)+":"+cb(o,c[u])+";");else{var h=fm(e,t,c);switch(o){case"animation":case"animationName":{s+=F_(o)+":"+h+";";break}default:s+=o+"{"+h+"}"}}}return s}var ub=/label:\s*([^\s;{]+)\s*(;|$)/g,io;function W1(e,t,n){if(e.length===1&&typeof e[0]=="object"&&e[0]!==null&&e[0].styles!==void 0)return e[0];var s=!0,i="";io=void 0;var o=e[0];if(o==null||o.raw===void 0)s=!1,i+=fm(n,t,o);else{var c=o;i+=c[0]}for(var d=1;d<e.length;d++)if(i+=fm(n,t,e[d]),s){var u=o;i+=u[d]}ub.lastIndex=0;for(var h="",g;(g=ub.exec(i))!==null;)h+="-"+g[1];var p=ZS(i)+h;return{name:p,styles:i,next:io}}var a3=function(t){return t()},s3=Wy.useInsertionEffect?Wy.useInsertionEffect:!1,i3=s3||a3,H1=we.createContext(typeof HTMLElement<"u"?HS({key:"css"}):null);H1.Provider;var o3=function(t){return we.forwardRef(function(n,s){var i=we.useContext(H1);return t(n,i,s)})},l3=we.createContext({}),Fv={}.hasOwnProperty,Z0="__EMOTION_TYPE_PLEASE_DO_NOT_USE__",c3=function(t,n){var s={};for(var i in n)Fv.call(n,i)&&(s[i]=n[i]);return s[Z0]=t,s},u3=function(t){var n=t.cache,s=t.serialized,i=t.isStringTag;return V1(n,s,i),i3(function(){return JS(n,s,i)}),null},d3=o3(function(e,t,n){var s=e.css;typeof s=="string"&&t.registered[s]!==void 0&&(s=t.registered[s]);var i=e[Z0],o=[s],c="";typeof e.className=="string"?c=YS(t.registered,o,e.className):e.className!=null&&(c=e.className+" ");var d=W1(o,void 0,we.useContext(l3));c+=t.key+"-"+d.name;var u={};for(var h in e)Fv.call(e,h)&&h!=="css"&&h!==Z0&&(u[h]=e[h]);return u.className=c,n&&(u.ref=n),we.createElement(we.Fragment,null,we.createElement(u3,{cache:t,serialized:d,isStringTag:typeof i=="string"}),we.createElement(i,u))}),f3=d3,Qt=function(t,n){var s=arguments;if(n==null||!Fv.call(n,"css"))return we.createElement.apply(void 0,s);var i=s.length,o=new Array(i);o[0]=f3,o[1]=c3(t,n);for(var c=2;c<i;c++)o[c]=s[c];return we.createElement.apply(null,o)};(function(e){var t;t||(t=e.JSX||(e.JSX={}))})(Qt||(Qt={}));function zv(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return W1(t)}function h3(){var e=zv.apply(void 0,arguments),t="animation-"+e.name;return{name:t,styles:"@keyframes "+t+"{"+e.styles+"}",anim:1,toString:function(){return"_EMO_"+this.name+"_"+this.styles+"_EMO_"}}}function p3(e,t){return t||(t=e.slice(0)),Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(t)}}))}var Nv=C1();const m3=kv(Nv),g3=Math.min,_3=Math.max,Wg=Math.round,dg=Math.floor,Hg=e=>({x:e,y:e});function v3(e){const{x:t,y:n,width:s,height:i}=e;return{width:s,height:i,top:n,left:t,right:t+s,bottom:n+i,x:t,y:n}}function u_(){return typeof window<"u"}function Q1(e){return K1(e)?(e.nodeName||"").toLowerCase():"#document"}function el(e){var t;return(e==null||(t=e.ownerDocument)==null?void 0:t.defaultView)||window}function q1(e){var t;return(t=(K1(e)?e.ownerDocument:e.document)||window.document)==null?void 0:t.documentElement}function K1(e){return u_()?e instanceof Node||e instanceof el(e).Node:!1}function y3(e){return u_()?e instanceof Element||e instanceof el(e).Element:!1}function Rv(e){return u_()?e instanceof HTMLElement||e instanceof el(e).HTMLElement:!1}function db(e){return!u_()||typeof ShadowRoot>"u"?!1:e instanceof ShadowRoot||e instanceof el(e).ShadowRoot}const b3=new Set(["inline","contents"]);function X1(e){const{overflow:t,overflowX:n,overflowY:s,display:i}=jv(e);return/auto|scroll|overlay|hidden|clip/.test(t+s+n)&&!b3.has(i)}function w3(){return typeof CSS>"u"||!CSS.supports?!1:CSS.supports("-webkit-backdrop-filter","none")}const M3=new Set(["html","body","#document"]);function x3(e){return M3.has(Q1(e))}function jv(e){return el(e).getComputedStyle(e)}function E3(e){if(Q1(e)==="html")return e;const t=e.assignedSlot||e.parentNode||db(e)&&e.host||q1(e);return db(t)?t.host:t}function Y1(e){const t=E3(e);return x3(t)?e.ownerDocument?e.ownerDocument.body:e.body:Rv(t)&&X1(t)?t:Y1(t)}function Qg(e,t,n){var s;t===void 0&&(t=[]),n===void 0&&(n=!0);const i=Y1(e),o=i===((s=e.ownerDocument)==null?void 0:s.body),c=el(i);if(o){const d=ev(c);return t.concat(c,c.visualViewport||[],X1(i)?i:[],d&&n?Qg(d):[])}return t.concat(i,Qg(i,[],n))}function ev(e){return e.parent&&Object.getPrototypeOf(e.parent)?e.frameElement:null}function T3(e){const t=jv(e);let n=parseFloat(t.width)||0,s=parseFloat(t.height)||0;const i=Rv(e),o=i?e.offsetWidth:n,c=i?e.offsetHeight:s,d=Wg(n)!==o||Wg(s)!==c;return d&&(n=o,s=c),{width:n,height:s,$:d}}function Uv(e){return y3(e)?e:e.contextElement}function fb(e){const t=Uv(e);if(!Rv(t))return Hg(1);const n=t.getBoundingClientRect(),{width:s,height:i,$:o}=T3(t);let c=(o?Wg(n.width):n.width)/s,d=(o?Wg(n.height):n.height)/i;return(!c||!Number.isFinite(c))&&(c=1),(!d||!Number.isFinite(d))&&(d=1),{x:c,y:d}}const A3=Hg(0);function C3(e){const t=el(e);return!w3()||!t.visualViewport?A3:{x:t.visualViewport.offsetLeft,y:t.visualViewport.offsetTop}}function S3(e,t,n){return!1}function hb(e,t,n,s){t===void 0&&(t=!1);const i=e.getBoundingClientRect(),o=Uv(e);let c=Hg(1);t&&(c=fb(e));const d=S3()?C3(o):Hg(0);let u=(i.left+d.x)/c.x,h=(i.top+d.y)/c.y,g=i.width/c.x,p=i.height/c.y;if(o){const m=el(o),y=s;let v=m,T=ev(v);for(;T&&s&&y!==v;){const O=fb(T),E=T.getBoundingClientRect(),S=jv(T),D=E.left+(T.clientLeft+parseFloat(S.paddingLeft))*O.x,I=E.top+(T.clientTop+parseFloat(S.paddingTop))*O.y;u*=O.x,h*=O.y,g*=O.x,p*=O.y,u+=D,h+=I,v=el(T),T=ev(v)}}return v3({width:g,height:p,x:u,y:h})}function J1(e,t){return e.x===t.x&&e.y===t.y&&e.width===t.width&&e.height===t.height}function I3(e,t){let n=null,s;const i=q1(e);function o(){var d;clearTimeout(s),(d=n)==null||d.disconnect(),n=null}function c(d,u){d===void 0&&(d=!1),u===void 0&&(u=1),o();const h=e.getBoundingClientRect(),{left:g,top:p,width:m,height:y}=h;if(d||t(),!m||!y)return;const v=dg(p),T=dg(i.clientWidth-(g+m)),O=dg(i.clientHeight-(p+y)),E=dg(g),D={rootMargin:-v+"px "+-T+"px "+-O+"px "+-E+"px",threshold:_3(0,g3(1,u))||1};let I=!0;function M(C){const A=C[0].intersectionRatio;if(A!==u){if(!I)return c();A?c(!1,A):s=setTimeout(()=>{c(!1,1e-7)},1e3)}A===1&&!J1(h,e.getBoundingClientRect())&&c(),I=!1}try{n=new IntersectionObserver(M,{...D,root:i.ownerDocument})}catch{n=new IntersectionObserver(M,D)}n.observe(e)}return c(!0),o}function P3(e,t,n,s){s===void 0&&(s={});const{ancestorScroll:i=!0,ancestorResize:o=!0,elementResize:c=typeof ResizeObserver=="function",layoutShift:d=typeof IntersectionObserver=="function",animationFrame:u=!1}=s,h=Uv(e),g=i||o?[...h?Qg(h):[],...Qg(t)]:[];g.forEach(E=>{i&&E.addEventListener("scroll",n,{passive:!0}),o&&E.addEventListener("resize",n)});const p=h&&d?I3(h,n):null;let m=-1,y=null;c&&(y=new ResizeObserver(E=>{let[S]=E;S&&S.target===h&&y&&(y.unobserve(t),cancelAnimationFrame(m),m=requestAnimationFrame(()=>{var D;(D=y)==null||D.observe(t)})),n()}),h&&!u&&y.observe(h),y.observe(t));let v,T=u?hb(e):null;u&&O();function O(){const E=hb(e);T&&!J1(T,E)&&n(),T=E,v=requestAnimationFrame(O)}return n(),()=>{var E;g.forEach(S=>{i&&S.removeEventListener("scroll",n),o&&S.removeEventListener("resize",n)}),p==null||p(),(E=y)==null||E.disconnect(),y=null,u&&cancelAnimationFrame(v)}}var tv=we.useLayoutEffect,k3=["className","clearValue","cx","getStyles","getClassNames","getValue","hasValue","isMulti","isRtl","options","selectOption","selectProps","setValue","theme"],qg=function(){};function D3(e,t){return t?t[0]==="-"?e+t:e+"__"+t:e}function O3(e,t){for(var n=arguments.length,s=new Array(n>2?n-2:0),i=2;i<n;i++)s[i-2]=arguments[i];var o=[].concat(s);if(t&&e)for(var c in t)t.hasOwnProperty(c)&&t[c]&&o.push("".concat(D3(e,c)));return o.filter(function(d){return d}).map(function(d){return String(d).trim()}).join(" ")}var pb=function(t){return U3(t)?t.filter(Boolean):Mu(t)==="object"&&t!==null?[t]:[]},Z1=function(t){t.className,t.clearValue,t.cx,t.getStyles,t.getClassNames,t.getValue,t.hasValue,t.isMulti,t.isRtl,t.options,t.selectOption,t.selectProps,t.setValue,t.theme;var n=tl(t,k3);return Yt({},n)},ea=function(t,n,s){var i=t.cx,o=t.getStyles,c=t.getClassNames,d=t.className;return{css:o(n,t),className:i(s??{},c(n,t),d)}};function d_(e){return[document.documentElement,document.body,window].indexOf(e)>-1}function $3(e){return d_(e)?window.innerHeight:e.clientHeight}function e2(e){return d_(e)?window.pageYOffset:e.scrollTop}function Kg(e,t){if(d_(e)){window.scrollTo(0,t);return}e.scrollTop=t}function B3(e){var t=getComputedStyle(e),n=t.position==="absolute",s=/(auto|scroll)/;if(t.position==="fixed")return document.documentElement;for(var i=e;i=i.parentElement;)if(t=getComputedStyle(i),!(n&&t.position==="static")&&s.test(t.overflow+t.overflowY+t.overflowX))return i;return document.documentElement}function L3(e,t,n,s){return n*((e=e/s-1)*e*e+1)+t}function fg(e,t){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:200,s=arguments.length>3&&arguments[3]!==void 0?arguments[3]:qg,i=e2(e),o=t-i,c=10,d=0;function u(){d+=c;var h=L3(d,i,o,n);Kg(e,h),d<n?window.requestAnimationFrame(u):s(e)}u()}function mb(e,t){var n=e.getBoundingClientRect(),s=t.getBoundingClientRect(),i=t.offsetHeight/3;s.bottom+i>n.bottom?Kg(e,Math.min(t.offsetTop+t.clientHeight-e.offsetHeight+i,e.scrollHeight)):s.top-i<n.top&&Kg(e,Math.max(t.offsetTop-i,0))}function F3(e){var t=e.getBoundingClientRect();return{bottom:t.bottom,height:t.height,left:t.left,right:t.right,top:t.top,width:t.width}}function gb(){try{return document.createEvent("TouchEvent"),!0}catch{return!1}}function z3(){try{return/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)}catch{return!1}}var t2=!1,N3={get passive(){return t2=!0}},hg=typeof window<"u"?window:{};hg.addEventListener&&hg.removeEventListener&&(hg.addEventListener("p",qg,N3),hg.removeEventListener("p",qg,!1));var R3=t2;function j3(e){return e!=null}function U3(e){return Array.isArray(e)}function pg(e,t,n){return e?t:n}var V3=function(t){for(var n=arguments.length,s=new Array(n>1?n-1:0),i=1;i<n;i++)s[i-1]=arguments[i];var o=Object.entries(t).filter(function(c){var d=Zo(c,1),u=d[0];return!s.includes(u)});return o.reduce(function(c,d){var u=Zo(d,2),h=u[0],g=u[1];return c[h]=g,c},{})},G3=["children","innerProps"],W3=["children","innerProps"];function H3(e){var t=e.maxHeight,n=e.menuEl,s=e.minHeight,i=e.placement,o=e.shouldScroll,c=e.isFixedPosition,d=e.controlHeight,u=B3(n),h={placement:"bottom",maxHeight:t};if(!n||!n.offsetParent)return h;var g=u.getBoundingClientRect(),p=g.height,m=n.getBoundingClientRect(),y=m.bottom,v=m.height,T=m.top,O=n.offsetParent.getBoundingClientRect(),E=O.top,S=c?window.innerHeight:$3(u),D=e2(u),I=parseInt(getComputedStyle(n).marginBottom,10),M=parseInt(getComputedStyle(n).marginTop,10),C=E-M,A=S-T,k=C+D,R=p-D-T,G=y-S+D+I,te=D+T-M,ee=160;switch(i){case"auto":case"bottom":if(A>=v)return{placement:"bottom",maxHeight:t};if(R>=v&&!c)return o&&fg(u,G,ee),{placement:"bottom",maxHeight:t};if(!c&&R>=s||c&&A>=s){o&&fg(u,G,ee);var X=c?A-I:R-I;return{placement:"bottom",maxHeight:X}}if(i==="auto"||c){var le=t,ae=c?C:k;return ae>=s&&(le=Math.min(ae-I-d,t)),{placement:"top",maxHeight:le}}if(i==="bottom")return o&&Kg(u,G),{placement:"bottom",maxHeight:t};break;case"top":if(C>=v)return{placement:"top",maxHeight:t};if(k>=v&&!c)return o&&fg(u,te,ee),{placement:"top",maxHeight:t};if(!c&&k>=s||c&&C>=s){var Q=t;return(!c&&k>=s||c&&C>=s)&&(Q=c?C-M:k-M),o&&fg(u,te,ee),{placement:"top",maxHeight:Q}}return{placement:"bottom",maxHeight:t};default:throw new Error('Invalid placement provided "'.concat(i,'".'))}return h}function Q3(e){var t={bottom:"top",top:"bottom"};return e?t[e]:"bottom"}var n2=function(t){return t==="auto"?"bottom":t},q3=function(t,n){var s,i=t.placement,o=t.theme,c=o.borderRadius,d=o.spacing,u=o.colors;return Yt((s={label:"menu"},rm(s,Q3(i),"100%"),rm(s,"position","absolute"),rm(s,"width","100%"),rm(s,"zIndex",1),s),n?{}:{backgroundColor:u.neutral0,borderRadius:c,boxShadow:"0 0 0 1px hsla(0, 0%, 0%, 0.1), 0 4px 11px hsla(0, 0%, 0%, 0.1)",marginBottom:d.menuGutter,marginTop:d.menuGutter})},r2=we.createContext(null),K3=function(t){var n=t.children,s=t.minMenuHeight,i=t.maxMenuHeight,o=t.menuPlacement,c=t.menuPosition,d=t.menuShouldScrollIntoView,u=t.theme,h=we.useContext(r2)||{},g=h.setPortalPlacement,p=we.useRef(null),m=we.useState(i),y=Zo(m,2),v=y[0],T=y[1],O=we.useState(null),E=Zo(O,2),S=E[0],D=E[1],I=u.spacing.controlHeight;return tv(function(){var M=p.current;if(M){var C=c==="fixed",A=d&&!C,k=H3({maxHeight:i,menuEl:M,minHeight:s,placement:o,shouldScroll:A,isFixedPosition:C,controlHeight:I});T(k.maxHeight),D(k.placement),g==null||g(k.placement)}},[i,o,c,d,s,g,I]),n({ref:p,placerProps:Yt(Yt({},t),{},{placement:S||n2(o),maxHeight:v})})},X3=function(t){var n=t.children,s=t.innerRef,i=t.innerProps;return Qt("div",rn({},ea(t,"menu",{menu:!0}),{ref:s},i),n)},Y3=X3,J3=function(t,n){var s=t.maxHeight,i=t.theme.spacing.baseUnit;return Yt({maxHeight:s,overflowY:"auto",position:"relative",WebkitOverflowScrolling:"touch"},n?{}:{paddingBottom:i,paddingTop:i})},Z3=function(t){var n=t.children,s=t.innerProps,i=t.innerRef,o=t.isMulti;return Qt("div",rn({},ea(t,"menuList",{"menu-list":!0,"menu-list--is-multi":o}),{ref:i},s),n)},a2=function(t,n){var s=t.theme,i=s.spacing.baseUnit,o=s.colors;return Yt({textAlign:"center"},n?{}:{color:o.neutral40,padding:"".concat(i*2,"px ").concat(i*3,"px")})},eI=a2,tI=a2,nI=function(t){var n=t.children,s=n===void 0?"No options":n,i=t.innerProps,o=tl(t,G3);return Qt("div",rn({},ea(Yt(Yt({},o),{},{children:s,innerProps:i}),"noOptionsMessage",{"menu-notice":!0,"menu-notice--no-options":!0}),i),s)},rI=function(t){var n=t.children,s=n===void 0?"Loading...":n,i=t.innerProps,o=tl(t,W3);return Qt("div",rn({},ea(Yt(Yt({},o),{},{children:s,innerProps:i}),"loadingMessage",{"menu-notice":!0,"menu-notice--loading":!0}),i),s)},aI=function(t){var n=t.rect,s=t.offset,i=t.position;return{left:n.left,position:i,top:s,width:n.width,zIndex:1}},sI=function(t){var n=t.appendTo,s=t.children,i=t.controlElement,o=t.innerProps,c=t.menuPlacement,d=t.menuPosition,u=we.useRef(null),h=we.useRef(null),g=we.useState(n2(c)),p=Zo(g,2),m=p[0],y=p[1],v=we.useMemo(function(){return{setPortalPlacement:y}},[]),T=we.useState(null),O=Zo(T,2),E=O[0],S=O[1],D=we.useCallback(function(){if(i){var A=F3(i),k=d==="fixed"?0:window.pageYOffset,R=A[m]+k;(R!==(E==null?void 0:E.offset)||A.left!==(E==null?void 0:E.rect.left)||A.width!==(E==null?void 0:E.rect.width))&&S({offset:R,rect:A})}},[i,d,m,E==null?void 0:E.offset,E==null?void 0:E.rect.left,E==null?void 0:E.rect.width]);tv(function(){D()},[D]);var I=we.useCallback(function(){typeof h.current=="function"&&(h.current(),h.current=null),i&&u.current&&(h.current=P3(i,u.current,D,{elementResize:"ResizeObserver"in window}))},[i,D]);tv(function(){I()},[I]);var M=we.useCallback(function(A){u.current=A,I()},[I]);if(!n&&d!=="fixed"||!E)return null;var C=Qt("div",rn({ref:M},ea(Yt(Yt({},t),{},{offset:E.offset,position:d,rect:E.rect}),"menuPortal",{"menu-portal":!0}),o),s);return Qt(r2.Provider,{value:v},n?Nv.createPortal(C,n):C)},iI=function(t){var n=t.isDisabled,s=t.isRtl;return{label:"container",direction:s?"rtl":void 0,pointerEvents:n?"none":void 0,position:"relative"}},oI=function(t){var n=t.children,s=t.innerProps,i=t.isDisabled,o=t.isRtl;return Qt("div",rn({},ea(t,"container",{"--is-disabled":i,"--is-rtl":o}),s),n)},lI=function(t,n){var s=t.theme.spacing,i=t.isMulti,o=t.hasValue,c=t.selectProps.controlShouldRenderValue;return Yt({alignItems:"center",display:i&&o&&c?"flex":"grid",flex:1,flexWrap:"wrap",WebkitOverflowScrolling:"touch",position:"relative",overflow:"hidden"},n?{}:{padding:"".concat(s.baseUnit/2,"px ").concat(s.baseUnit*2,"px")})},cI=function(t){var n=t.children,s=t.innerProps,i=t.isMulti,o=t.hasValue;return Qt("div",rn({},ea(t,"valueContainer",{"value-container":!0,"value-container--is-multi":i,"value-container--has-value":o}),s),n)},uI=function(){return{alignItems:"center",alignSelf:"stretch",display:"flex",flexShrink:0}},dI=function(t){var n=t.children,s=t.innerProps;return Qt("div",rn({},ea(t,"indicatorsContainer",{indicators:!0}),s),n)},_b,fI=["size"],hI=["innerProps","isRtl","size"],pI={name:"8mmkcg",styles:"display:inline-block;fill:currentColor;line-height:1;stroke:currentColor;stroke-width:0"},s2=function(t){var n=t.size,s=tl(t,fI);return Qt("svg",rn({height:n,width:n,viewBox:"0 0 20 20","aria-hidden":"true",focusable:"false",css:pI},s))},Vv=function(t){return Qt(s2,rn({size:20},t),Qt("path",{d:"M14.348 14.849c-0.469 0.469-1.229 0.469-1.697 0l-2.651-3.030-2.651 3.029c-0.469 0.469-1.229 0.469-1.697 0-0.469-0.469-0.469-1.229 0-1.697l2.758-3.15-2.759-3.152c-0.469-0.469-0.469-1.228 0-1.697s1.228-0.469 1.697 0l2.652 3.031 2.651-3.031c0.469-0.469 1.228-0.469 1.697 0s0.469 1.229 0 1.697l-2.758 3.152 2.758 3.15c0.469 0.469 0.469 1.229 0 1.698z"}))},i2=function(t){return Qt(s2,rn({size:20},t),Qt("path",{d:"M4.516 7.548c0.436-0.446 1.043-0.481 1.576 0l3.908 3.747 3.908-3.747c0.533-0.481 1.141-0.446 1.574 0 0.436 0.445 0.408 1.197 0 1.615-0.406 0.418-4.695 4.502-4.695 4.502-0.217 0.223-0.502 0.335-0.787 0.335s-0.57-0.112-0.789-0.335c0 0-4.287-4.084-4.695-4.502s-0.436-1.17 0-1.615z"}))},o2=function(t,n){var s=t.isFocused,i=t.theme,o=i.spacing.baseUnit,c=i.colors;return Yt({label:"indicatorContainer",display:"flex",transition:"color 150ms"},n?{}:{color:s?c.neutral60:c.neutral20,padding:o*2,":hover":{color:s?c.neutral80:c.neutral40}})},mI=o2,gI=function(t){var n=t.children,s=t.innerProps;return Qt("div",rn({},ea(t,"dropdownIndicator",{indicator:!0,"dropdown-indicator":!0}),s),n||Qt(i2,null))},_I=o2,vI=function(t){var n=t.children,s=t.innerProps;return Qt("div",rn({},ea(t,"clearIndicator",{indicator:!0,"clear-indicator":!0}),s),n||Qt(Vv,null))},yI=function(t,n){var s=t.isDisabled,i=t.theme,o=i.spacing.baseUnit,c=i.colors;return Yt({label:"indicatorSeparator",alignSelf:"stretch",width:1},n?{}:{backgroundColor:s?c.neutral10:c.neutral20,marginBottom:o*2,marginTop:o*2})},bI=function(t){var n=t.innerProps;return Qt("span",rn({},n,ea(t,"indicatorSeparator",{"indicator-separator":!0})))},wI=h3(_b||(_b=p3([`
  0%, 80%, 100% { opacity: 0; }
  40% { opacity: 1; }
`]))),MI=function(t,n){var s=t.isFocused,i=t.size,o=t.theme,c=o.colors,d=o.spacing.baseUnit;return Yt({label:"loadingIndicator",display:"flex",transition:"color 150ms",alignSelf:"center",fontSize:i,lineHeight:1,marginRight:i,textAlign:"center",verticalAlign:"middle"},n?{}:{color:s?c.neutral60:c.neutral20,padding:d*2})},z_=function(t){var n=t.delay,s=t.offset;return Qt("span",{css:zv({animation:"".concat(wI," 1s ease-in-out ").concat(n,"ms infinite;"),backgroundColor:"currentColor",borderRadius:"1em",display:"inline-block",marginLeft:s?"1em":void 0,height:"1em",verticalAlign:"top",width:"1em"},"","")})},xI=function(t){var n=t.innerProps,s=t.isRtl,i=t.size,o=i===void 0?4:i,c=tl(t,hI);return Qt("div",rn({},ea(Yt(Yt({},c),{},{innerProps:n,isRtl:s,size:o}),"loadingIndicator",{indicator:!0,"loading-indicator":!0}),n),Qt(z_,{delay:0,offset:s}),Qt(z_,{delay:160,offset:!0}),Qt(z_,{delay:320,offset:!s}))},EI=function(t,n){var s=t.isDisabled,i=t.isFocused,o=t.theme,c=o.colors,d=o.borderRadius,u=o.spacing;return Yt({label:"control",alignItems:"center",cursor:"default",display:"flex",flexWrap:"wrap",justifyContent:"space-between",minHeight:u.controlHeight,outline:"0 !important",position:"relative",transition:"all 100ms"},n?{}:{backgroundColor:s?c.neutral5:c.neutral0,borderColor:s?c.neutral10:i?c.primary:c.neutral20,borderRadius:d,borderStyle:"solid",borderWidth:1,boxShadow:i?"0 0 0 1px ".concat(c.primary):void 0,"&:hover":{borderColor:i?c.primary:c.neutral30}})},TI=function(t){var n=t.children,s=t.isDisabled,i=t.isFocused,o=t.innerRef,c=t.innerProps,d=t.menuIsOpen;return Qt("div",rn({ref:o},ea(t,"control",{control:!0,"control--is-disabled":s,"control--is-focused":i,"control--menu-is-open":d}),c,{"aria-disabled":s||void 0}),n)},AI=TI,CI=["data"],SI=function(t,n){var s=t.theme.spacing;return n?{}:{paddingBottom:s.baseUnit*2,paddingTop:s.baseUnit*2}},II=function(t){var n=t.children,s=t.cx,i=t.getStyles,o=t.getClassNames,c=t.Heading,d=t.headingProps,u=t.innerProps,h=t.label,g=t.theme,p=t.selectProps;return Qt("div",rn({},ea(t,"group",{group:!0}),u),Qt(c,rn({},d,{selectProps:p,theme:g,getStyles:i,getClassNames:o,cx:s}),h),Qt("div",null,n))},PI=function(t,n){var s=t.theme,i=s.colors,o=s.spacing;return Yt({label:"group",cursor:"default",display:"block"},n?{}:{color:i.neutral40,fontSize:"75%",fontWeight:500,marginBottom:"0.25em",paddingLeft:o.baseUnit*3,paddingRight:o.baseUnit*3,textTransform:"uppercase"})},kI=function(t){var n=Z1(t);n.data;var s=tl(n,CI);return Qt("div",rn({},ea(t,"groupHeading",{"group-heading":!0}),s))},DI=II,OI=["innerRef","isDisabled","isHidden","inputClassName"],$I=function(t,n){var s=t.isDisabled,i=t.value,o=t.theme,c=o.spacing,d=o.colors;return Yt(Yt({visibility:s?"hidden":"visible",transform:i?"translateZ(0)":""},BI),n?{}:{margin:c.baseUnit/2,paddingBottom:c.baseUnit/2,paddingTop:c.baseUnit/2,color:d.neutral80})},l2={gridArea:"1 / 2",font:"inherit",minWidth:"2px",border:0,margin:0,outline:0,padding:0},BI={flex:"1 1 auto",display:"inline-grid",gridArea:"1 / 1 / 2 / 3",gridTemplateColumns:"0 min-content","&:after":Yt({content:'attr(data-value) " "',visibility:"hidden",whiteSpace:"pre"},l2)},LI=function(t){return Yt({label:"input",color:"inherit",background:0,opacity:t?0:1,width:"100%"},l2)},FI=function(t){var n=t.cx,s=t.value,i=Z1(t),o=i.innerRef,c=i.isDisabled,d=i.isHidden,u=i.inputClassName,h=tl(i,OI);return Qt("div",rn({},ea(t,"input",{"input-container":!0}),{"data-value":s||""}),Qt("input",rn({className:n({input:!0},u),ref:o,style:LI(d),disabled:c},h)))},zI=FI,NI=function(t,n){var s=t.theme,i=s.spacing,o=s.borderRadius,c=s.colors;return Yt({label:"multiValue",display:"flex",minWidth:0},n?{}:{backgroundColor:c.neutral10,borderRadius:o/2,margin:i.baseUnit/2})},RI=function(t,n){var s=t.theme,i=s.borderRadius,o=s.colors,c=t.cropWithEllipsis;return Yt({overflow:"hidden",textOverflow:c||c===void 0?"ellipsis":void 0,whiteSpace:"nowrap"},n?{}:{borderRadius:i/2,color:o.neutral80,fontSize:"85%",padding:3,paddingLeft:6})},jI=function(t,n){var s=t.theme,i=s.spacing,o=s.borderRadius,c=s.colors,d=t.isFocused;return Yt({alignItems:"center",display:"flex"},n?{}:{borderRadius:o/2,backgroundColor:d?c.dangerLight:void 0,paddingLeft:i.baseUnit,paddingRight:i.baseUnit,":hover":{backgroundColor:c.dangerLight,color:c.danger}})},c2=function(t){var n=t.children,s=t.innerProps;return Qt("div",s,n)},UI=c2,VI=c2;function GI(e){var t=e.children,n=e.innerProps;return Qt("div",rn({role:"button"},n),t||Qt(Vv,{size:14}))}var WI=function(t){var n=t.children,s=t.components,i=t.data,o=t.innerProps,c=t.isDisabled,d=t.removeProps,u=t.selectProps,h=s.Container,g=s.Label,p=s.Remove;return Qt(h,{data:i,innerProps:Yt(Yt({},ea(t,"multiValue",{"multi-value":!0,"multi-value--is-disabled":c})),o),selectProps:u},Qt(g,{data:i,innerProps:Yt({},ea(t,"multiValueLabel",{"multi-value__label":!0})),selectProps:u},n),Qt(p,{data:i,innerProps:Yt(Yt({},ea(t,"multiValueRemove",{"multi-value__remove":!0})),{},{"aria-label":"Remove ".concat(n||"option")},d),selectProps:u}))},HI=WI,QI=function(t,n){var s=t.isDisabled,i=t.isFocused,o=t.isSelected,c=t.theme,d=c.spacing,u=c.colors;return Yt({label:"option",cursor:"default",display:"block",fontSize:"inherit",width:"100%",userSelect:"none",WebkitTapHighlightColor:"rgba(0, 0, 0, 0)"},n?{}:{backgroundColor:o?u.primary:i?u.primary25:"transparent",color:s?u.neutral20:o?u.neutral0:"inherit",padding:"".concat(d.baseUnit*2,"px ").concat(d.baseUnit*3,"px"),":active":{backgroundColor:s?void 0:o?u.primary:u.primary50}})},qI=function(t){var n=t.children,s=t.isDisabled,i=t.isFocused,o=t.isSelected,c=t.innerRef,d=t.innerProps;return Qt("div",rn({},ea(t,"option",{option:!0,"option--is-disabled":s,"option--is-focused":i,"option--is-selected":o}),{ref:c,"aria-disabled":s},d),n)},KI=qI,XI=function(t,n){var s=t.theme,i=s.spacing,o=s.colors;return Yt({label:"placeholder",gridArea:"1 / 1 / 2 / 3"},n?{}:{color:o.neutral50,marginLeft:i.baseUnit/2,marginRight:i.baseUnit/2})},YI=function(t){var n=t.children,s=t.innerProps;return Qt("div",rn({},ea(t,"placeholder",{placeholder:!0}),s),n)},JI=YI,ZI=function(t,n){var s=t.isDisabled,i=t.theme,o=i.spacing,c=i.colors;return Yt({label:"singleValue",gridArea:"1 / 1 / 2 / 3",maxWidth:"100%",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},n?{}:{color:s?c.neutral40:c.neutral80,marginLeft:o.baseUnit/2,marginRight:o.baseUnit/2})},eP=function(t){var n=t.children,s=t.isDisabled,i=t.innerProps;return Qt("div",rn({},ea(t,"singleValue",{"single-value":!0,"single-value--is-disabled":s}),i),n)},tP=eP,nP={ClearIndicator:vI,Control:AI,DropdownIndicator:gI,DownChevron:i2,CrossIcon:Vv,Group:DI,GroupHeading:kI,IndicatorsContainer:dI,IndicatorSeparator:bI,Input:zI,LoadingIndicator:xI,Menu:Y3,MenuList:Z3,MenuPortal:sI,LoadingMessage:rI,NoOptionsMessage:nI,MultiValue:HI,MultiValueContainer:UI,MultiValueLabel:VI,MultiValueRemove:GI,Option:KI,Placeholder:JI,SelectContainer:oI,SingleValue:tP,ValueContainer:cI},rP=function(t){return Yt(Yt({},nP),t.components)},vb=Number.isNaN||function(t){return typeof t=="number"&&t!==t};function aP(e,t){return!!(e===t||vb(e)&&vb(t))}function sP(e,t){if(e.length!==t.length)return!1;for(var n=0;n<e.length;n++)if(!aP(e[n],t[n]))return!1;return!0}function iP(e,t){t===void 0&&(t=sP);var n=null;function s(){for(var i=[],o=0;o<arguments.length;o++)i[o]=arguments[o];if(n&&n.lastThis===this&&t(i,n.lastArgs))return n.lastResult;var c=e.apply(this,i);return n={lastResult:c,lastArgs:i,lastThis:this},c}return s.clear=function(){n=null},s}var oP={name:"7pg0cj-a11yText",styles:"label:a11yText;z-index:9999;border:0;clip:rect(1px, 1px, 1px, 1px);height:1px;width:1px;position:absolute;overflow:hidden;padding:0;white-space:nowrap"},lP=function(t){return Qt("span",rn({css:oP},t))},yb=lP,cP={guidance:function(t){var n=t.isSearchable,s=t.isMulti,i=t.tabSelectsValue,o=t.context,c=t.isInitialFocus;switch(o){case"menu":return"Use Up and Down to choose options, press Enter to select the currently focused option, press Escape to exit the menu".concat(i?", press Tab to select the option and exit the menu":"",".");case"input":return c?"".concat(t["aria-label"]||"Select"," is focused ").concat(n?",type to refine list":"",", press Down to open the menu, ").concat(s?" press left to focus selected values":""):"";case"value":return"Use left and right to toggle between focused values, press Backspace to remove the currently focused value";default:return""}},onChange:function(t){var n=t.action,s=t.label,i=s===void 0?"":s,o=t.labels,c=t.isDisabled;switch(n){case"deselect-option":case"pop-value":case"remove-value":return"option ".concat(i,", deselected.");case"clear":return"All selected options have been cleared.";case"initial-input-focus":return"option".concat(o.length>1?"s":""," ").concat(o.join(","),", selected.");case"select-option":return c?"option ".concat(i," is disabled. Select another option."):"option ".concat(i,", selected.");default:return""}},onFocus:function(t){var n=t.context,s=t.focused,i=t.options,o=t.label,c=o===void 0?"":o,d=t.selectValue,u=t.isDisabled,h=t.isSelected,g=t.isAppleDevice,p=function(T,O){return T&&T.length?"".concat(T.indexOf(O)+1," of ").concat(T.length):""};if(n==="value"&&d)return"value ".concat(c," focused, ").concat(p(d,s),".");if(n==="menu"&&g){var m=u?" disabled":"",y="".concat(h?" selected":"").concat(m);return"".concat(c).concat(y,", ").concat(p(i,s),".")}return""},onFilter:function(t){var n=t.inputValue,s=t.resultsMessage;return"".concat(s).concat(n?" for search term "+n:"",".")}},uP=function(t){var n=t.ariaSelection,s=t.focusedOption,i=t.focusedValue,o=t.focusableOptions,c=t.isFocused,d=t.selectValue,u=t.selectProps,h=t.id,g=t.isAppleDevice,p=u.ariaLiveMessages,m=u.getOptionLabel,y=u.inputValue,v=u.isMulti,T=u.isOptionDisabled,O=u.isSearchable,E=u.menuIsOpen,S=u.options,D=u.screenReaderStatus,I=u.tabSelectsValue,M=u.isLoading,C=u["aria-label"],A=u["aria-live"],k=we.useMemo(function(){return Yt(Yt({},cP),p||{})},[p]),R=we.useMemo(function(){var ae="";if(n&&k.onChange){var Q=n.option,ne=n.options,de=n.removedValue,ve=n.removedValues,fe=n.value,j=function(Pe){return Array.isArray(Pe)?null:Pe},U=de||Q||j(fe),N=U?m(U):"",q=ne||ve||void 0,ce=q?q.map(m):[],Z=Yt({isDisabled:U&&T(U,d),label:N,labels:ce},n);ae=k.onChange(Z)}return ae},[n,k,T,d,m]),G=we.useMemo(function(){var ae="",Q=s||i,ne=!!(s&&d&&d.includes(s));if(Q&&k.onFocus){var de={focused:Q,label:m(Q),isDisabled:T(Q,d),isSelected:ne,options:o,context:Q===s?"menu":"value",selectValue:d,isAppleDevice:g};ae=k.onFocus(de)}return ae},[s,i,m,T,k,o,d,g]),te=we.useMemo(function(){var ae="";if(E&&S.length&&!M&&k.onFilter){var Q=D({count:o.length});ae=k.onFilter({inputValue:y,resultsMessage:Q})}return ae},[o,y,E,k,S,D,M]),ee=(n==null?void 0:n.action)==="initial-input-focus",X=we.useMemo(function(){var ae="";if(k.guidance){var Q=i?"value":E?"menu":"input";ae=k.guidance({"aria-label":C,context:Q,isDisabled:s&&T(s,d),isMulti:v,isSearchable:O,tabSelectsValue:I,isInitialFocus:ee})}return ae},[C,s,i,v,T,O,E,k,d,I,ee]),le=Qt(we.Fragment,null,Qt("span",{id:"aria-selection"},R),Qt("span",{id:"aria-focused"},G),Qt("span",{id:"aria-results"},te),Qt("span",{id:"aria-guidance"},X));return Qt(we.Fragment,null,Qt(yb,{id:h},ee&&le),Qt(yb,{"aria-live":A,"aria-atomic":"false","aria-relevant":"additions text",role:"log"},c&&!ee&&le))},dP=uP,nv=[{base:"A",letters:"A"},{base:"AA",letters:""},{base:"AE",letters:""},{base:"AO",letters:""},{base:"AU",letters:""},{base:"AV",letters:""},{base:"AY",letters:""},{base:"B",letters:"B"},{base:"C",letters:"C"},{base:"D",letters:"D"},{base:"DZ",letters:""},{base:"Dz",letters:""},{base:"E",letters:"E"},{base:"F",letters:"F"},{base:"G",letters:"G"},{base:"H",letters:"H"},{base:"I",letters:"I"},{base:"J",letters:"J"},{base:"K",letters:"K"},{base:"L",letters:"L"},{base:"LJ",letters:""},{base:"Lj",letters:""},{base:"M",letters:"M"},{base:"N",letters:"N"},{base:"NJ",letters:""},{base:"Nj",letters:""},{base:"O",letters:"O"},{base:"OI",letters:""},{base:"OO",letters:""},{base:"OU",letters:""},{base:"P",letters:"P"},{base:"Q",letters:"Q"},{base:"R",letters:"R"},{base:"S",letters:"S"},{base:"T",letters:"T"},{base:"TZ",letters:""},{base:"U",letters:"U"},{base:"V",letters:"V"},{base:"VY",letters:""},{base:"W",letters:"W"},{base:"X",letters:"X"},{base:"Y",letters:"Y"},{base:"Z",letters:"Z"},{base:"a",letters:"a"},{base:"aa",letters:""},{base:"ae",letters:""},{base:"ao",letters:""},{base:"au",letters:""},{base:"av",letters:""},{base:"ay",letters:""},{base:"b",letters:"b"},{base:"c",letters:"c"},{base:"d",letters:"d"},{base:"dz",letters:""},{base:"e",letters:"e"},{base:"f",letters:"f"},{base:"g",letters:"g"},{base:"h",letters:"h"},{base:"hv",letters:""},{base:"i",letters:"i"},{base:"j",letters:"j"},{base:"k",letters:"k"},{base:"l",letters:"l"},{base:"lj",letters:""},{base:"m",letters:"m"},{base:"n",letters:"n"},{base:"nj",letters:""},{base:"o",letters:"o"},{base:"oi",letters:""},{base:"ou",letters:""},{base:"oo",letters:""},{base:"p",letters:"p"},{base:"q",letters:"q"},{base:"r",letters:"r"},{base:"s",letters:"s"},{base:"t",letters:"t"},{base:"tz",letters:""},{base:"u",letters:"u"},{base:"v",letters:"v"},{base:"vy",letters:""},{base:"w",letters:"w"},{base:"x",letters:"x"},{base:"y",letters:"y"},{base:"z",letters:"z"}],fP=new RegExp("["+nv.map(function(e){return e.letters}).join("")+"]","g"),u2={};for(var N_=0;N_<nv.length;N_++)for(var R_=nv[N_],j_=0;j_<R_.letters.length;j_++)u2[R_.letters[j_]]=R_.base;var d2=function(t){return t.replace(fP,function(n){return u2[n]})},hP=iP(d2),bb=function(t){return t.replace(/^\s+|\s+$/g,"")},pP=function(t){return"".concat(t.label," ").concat(t.value)},mP=function(t){return function(n,s){if(n.data.__isNew__)return!0;var i=Yt({ignoreCase:!0,ignoreAccents:!0,stringify:pP,trim:!0,matchFrom:"any"},t),o=i.ignoreCase,c=i.ignoreAccents,d=i.stringify,u=i.trim,h=i.matchFrom,g=u?bb(s):s,p=u?bb(d(n)):d(n);return o&&(g=g.toLowerCase(),p=p.toLowerCase()),c&&(g=hP(g),p=d2(p)),h==="start"?p.substr(0,g.length)===g:p.indexOf(g)>-1}},gP=["innerRef"];function _P(e){var t=e.innerRef,n=tl(e,gP),s=V3(n,"onExited","in","enter","exit","appear");return Qt("input",rn({ref:t},s,{css:zv({label:"dummyInput",background:0,border:0,caretColor:"transparent",fontSize:"inherit",gridArea:"1 / 1 / 2 / 3",outline:0,padding:0,width:1,color:"transparent",left:-100,opacity:0,position:"relative",transform:"scale(.01)"},"","")}))}var vP=function(t){t.cancelable&&t.preventDefault(),t.stopPropagation()};function yP(e){var t=e.isEnabled,n=e.onBottomArrive,s=e.onBottomLeave,i=e.onTopArrive,o=e.onTopLeave,c=we.useRef(!1),d=we.useRef(!1),u=we.useRef(0),h=we.useRef(null),g=we.useCallback(function(O,E){if(h.current!==null){var S=h.current,D=S.scrollTop,I=S.scrollHeight,M=S.clientHeight,C=h.current,A=E>0,k=I-M-D,R=!1;k>E&&c.current&&(s&&s(O),c.current=!1),A&&d.current&&(o&&o(O),d.current=!1),A&&E>k?(n&&!c.current&&n(O),C.scrollTop=I,R=!0,c.current=!0):!A&&-E>D&&(i&&!d.current&&i(O),C.scrollTop=0,R=!0,d.current=!0),R&&vP(O)}},[n,s,i,o]),p=we.useCallback(function(O){g(O,O.deltaY)},[g]),m=we.useCallback(function(O){u.current=O.changedTouches[0].clientY},[]),y=we.useCallback(function(O){var E=u.current-O.changedTouches[0].clientY;g(O,E)},[g]),v=we.useCallback(function(O){if(O){var E=R3?{passive:!1}:!1;O.addEventListener("wheel",p,E),O.addEventListener("touchstart",m,E),O.addEventListener("touchmove",y,E)}},[y,m,p]),T=we.useCallback(function(O){O&&(O.removeEventListener("wheel",p,!1),O.removeEventListener("touchstart",m,!1),O.removeEventListener("touchmove",y,!1))},[y,m,p]);return we.useEffect(function(){if(t){var O=h.current;return v(O),function(){T(O)}}},[t,v,T]),function(O){h.current=O}}var wb=["boxSizing","height","overflow","paddingRight","position"],Mb={boxSizing:"border-box",overflow:"hidden",position:"relative",height:"100%"};function xb(e){e.cancelable&&e.preventDefault()}function Eb(e){e.stopPropagation()}function Tb(){var e=this.scrollTop,t=this.scrollHeight,n=e+this.offsetHeight;e===0?this.scrollTop=1:n===t&&(this.scrollTop=e-1)}function Ab(){return"ontouchstart"in window||navigator.maxTouchPoints}var Cb=!!(typeof window<"u"&&window.document&&window.document.createElement),Wp=0,df={capture:!1,passive:!1};function bP(e){var t=e.isEnabled,n=e.accountForScrollbars,s=n===void 0?!0:n,i=we.useRef({}),o=we.useRef(null),c=we.useCallback(function(u){if(Cb){var h=document.body,g=h&&h.style;if(s&&wb.forEach(function(v){var T=g&&g[v];i.current[v]=T}),s&&Wp<1){var p=parseInt(i.current.paddingRight,10)||0,m=document.body?document.body.clientWidth:0,y=window.innerWidth-m+p||0;Object.keys(Mb).forEach(function(v){var T=Mb[v];g&&(g[v]=T)}),g&&(g.paddingRight="".concat(y,"px"))}h&&Ab()&&(h.addEventListener("touchmove",xb,df),u&&(u.addEventListener("touchstart",Tb,df),u.addEventListener("touchmove",Eb,df))),Wp+=1}},[s]),d=we.useCallback(function(u){if(Cb){var h=document.body,g=h&&h.style;Wp=Math.max(Wp-1,0),s&&Wp<1&&wb.forEach(function(p){var m=i.current[p];g&&(g[p]=m)}),h&&Ab()&&(h.removeEventListener("touchmove",xb,df),u&&(u.removeEventListener("touchstart",Tb,df),u.removeEventListener("touchmove",Eb,df)))}},[s]);return we.useEffect(function(){if(t){var u=o.current;return c(u),function(){d(u)}}},[t,c,d]),function(u){o.current=u}}var wP=function(t){var n=t.target;return n.ownerDocument.activeElement&&n.ownerDocument.activeElement.blur()},MP={name:"1kfdb0e",styles:"position:fixed;left:0;bottom:0;right:0;top:0"};function xP(e){var t=e.children,n=e.lockEnabled,s=e.captureEnabled,i=s===void 0?!0:s,o=e.onBottomArrive,c=e.onBottomLeave,d=e.onTopArrive,u=e.onTopLeave,h=yP({isEnabled:i,onBottomArrive:o,onBottomLeave:c,onTopArrive:d,onTopLeave:u}),g=bP({isEnabled:n}),p=function(y){h(y),g(y)};return Qt(we.Fragment,null,n&&Qt("div",{onClick:wP,css:MP}),t(p))}var EP={name:"1a0ro4n-requiredInput",styles:"label:requiredInput;opacity:0;pointer-events:none;position:absolute;bottom:0;left:0;right:0;width:100%"},TP=function(t){var n=t.name,s=t.onFocus;return Qt("input",{required:!0,name:n,tabIndex:-1,"aria-hidden":"true",onFocus:s,css:EP,value:"",onChange:function(){}})},AP=TP;function Gv(e){var t;return typeof window<"u"&&window.navigator!=null?e.test(((t=window.navigator.userAgentData)===null||t===void 0?void 0:t.platform)||window.navigator.platform):!1}function CP(){return Gv(/^iPhone/i)}function f2(){return Gv(/^Mac/i)}function SP(){return Gv(/^iPad/i)||f2()&&navigator.maxTouchPoints>1}function IP(){return CP()||SP()}function PP(){return f2()||IP()}var kP=function(t){return t.label},DP=function(t){return t.label},OP=function(t){return t.value},$P=function(t){return!!t.isDisabled},BP={clearIndicator:_I,container:iI,control:EI,dropdownIndicator:mI,group:SI,groupHeading:PI,indicatorsContainer:uI,indicatorSeparator:yI,input:$I,loadingIndicator:MI,loadingMessage:tI,menu:q3,menuList:J3,menuPortal:aI,multiValue:NI,multiValueLabel:RI,multiValueRemove:jI,noOptionsMessage:eI,option:QI,placeholder:XI,singleValue:ZI,valueContainer:lI},LP={primary:"#2684FF",primary75:"#4C9AFF",primary50:"#B2D4FF",primary25:"#DEEBFF",danger:"#DE350B",dangerLight:"#FFBDAD",neutral0:"hsl(0, 0%, 100%)",neutral5:"hsl(0, 0%, 95%)",neutral10:"hsl(0, 0%, 90%)",neutral20:"hsl(0, 0%, 80%)",neutral30:"hsl(0, 0%, 70%)",neutral40:"hsl(0, 0%, 60%)",neutral50:"hsl(0, 0%, 50%)",neutral60:"hsl(0, 0%, 40%)",neutral70:"hsl(0, 0%, 30%)",neutral80:"hsl(0, 0%, 20%)",neutral90:"hsl(0, 0%, 10%)"},FP=4,h2=4,zP=38,NP=h2*2,RP={baseUnit:h2,controlHeight:zP,menuGutter:NP},U_={borderRadius:FP,colors:LP,spacing:RP},jP={"aria-live":"polite",backspaceRemovesValue:!0,blurInputOnSelect:gb(),captureMenuScroll:!gb(),classNames:{},closeMenuOnSelect:!0,closeMenuOnScroll:!1,components:{},controlShouldRenderValue:!0,escapeClearsValue:!1,filterOption:mP(),formatGroupLabel:kP,getOptionLabel:DP,getOptionValue:OP,isDisabled:!1,isLoading:!1,isMulti:!1,isRtl:!1,isSearchable:!0,isOptionDisabled:$P,loadingMessage:function(){return"Loading..."},maxMenuHeight:300,minMenuHeight:140,menuIsOpen:!1,menuPlacement:"bottom",menuPosition:"absolute",menuShouldBlockScroll:!1,menuShouldScrollIntoView:!z3(),noOptionsMessage:function(){return"No options"},openMenuOnFocus:!1,openMenuOnClick:!0,options:[],pageSize:5,placeholder:"Select...",screenReaderStatus:function(t){var n=t.count;return"".concat(n," result").concat(n!==1?"s":""," available")},styles:{},tabIndex:0,tabSelectsValue:!0,unstyled:!1};function Sb(e,t,n,s){var i=g2(e,t,n),o=_2(e,t,n),c=m2(e,t),d=Xg(e,t);return{type:"option",data:t,isDisabled:i,isSelected:o,label:c,value:d,index:s}}function Bg(e,t){return e.options.map(function(n,s){if("options"in n){var i=n.options.map(function(c,d){return Sb(e,c,t,d)}).filter(function(c){return Pb(e,c)});return i.length>0?{type:"group",data:n,options:i,index:s}:void 0}var o=Sb(e,n,t,s);return Pb(e,o)?o:void 0}).filter(j3)}function p2(e){return e.reduce(function(t,n){return n.type==="group"?t.push.apply(t,Ov(n.options.map(function(s){return s.data}))):t.push(n.data),t},[])}function Ib(e,t){return e.reduce(function(n,s){return s.type==="group"?n.push.apply(n,Ov(s.options.map(function(i){return{data:i.data,id:"".concat(t,"-").concat(s.index,"-").concat(i.index)}}))):n.push({data:s.data,id:"".concat(t,"-").concat(s.index)}),n},[])}function UP(e,t){return p2(Bg(e,t))}function Pb(e,t){var n=e.inputValue,s=n===void 0?"":n,i=t.data,o=t.isSelected,c=t.label,d=t.value;return(!y2(e)||!o)&&v2(e,{label:c,value:d,data:i},s)}function VP(e,t){var n=e.focusedValue,s=e.selectValue,i=s.indexOf(n);if(i>-1){var o=t.indexOf(n);if(o>-1)return n;if(i<t.length)return t[i]}return null}function GP(e,t){var n=e.focusedOption;return n&&t.indexOf(n)>-1?n:t[0]}var V_=function(t,n){var s,i=(s=t.find(function(o){return o.data===n}))===null||s===void 0?void 0:s.id;return i||null},m2=function(t,n){return t.getOptionLabel(n)},Xg=function(t,n){return t.getOptionValue(n)};function g2(e,t,n){return typeof e.isOptionDisabled=="function"?e.isOptionDisabled(t,n):!1}function _2(e,t,n){if(n.indexOf(t)>-1)return!0;if(typeof e.isOptionSelected=="function")return e.isOptionSelected(t,n);var s=Xg(e,t);return n.some(function(i){return Xg(e,i)===s})}function v2(e,t,n){return e.filterOption?e.filterOption(t,n):!0}var y2=function(t){var n=t.hideSelectedOptions,s=t.isMulti;return n===void 0?s:n},WP=1,b2=(function(e){uS(n,e);var t=hS(n);function n(s){var i;if(lS(this,n),i=t.call(this,s),i.state={ariaSelection:null,focusedOption:null,focusedOptionId:null,focusableOptionsWithIds:[],focusedValue:null,inputIsHidden:!1,isFocused:!1,selectValue:[],clearFocusValueOnUpdate:!1,prevWasFocused:!1,inputIsHiddenAfterUpdate:void 0,prevProps:void 0,instancePrefix:"",isAppleDevice:!1},i.blockOptionHover=!1,i.isComposing=!1,i.commonProps=void 0,i.initialTouchX=0,i.initialTouchY=0,i.openAfterFocus=!1,i.scrollToFocusedOptionOnUpdate=!1,i.userIsDragging=void 0,i.controlRef=null,i.getControlRef=function(u){i.controlRef=u},i.focusedOptionRef=null,i.getFocusedOptionRef=function(u){i.focusedOptionRef=u},i.menuListRef=null,i.getMenuListRef=function(u){i.menuListRef=u},i.inputRef=null,i.getInputRef=function(u){i.inputRef=u},i.focus=i.focusInput,i.blur=i.blurInput,i.onChange=function(u,h){var g=i.props,p=g.onChange,m=g.name;h.name=m,i.ariaOnChange(u,h),p(u,h)},i.setValue=function(u,h,g){var p=i.props,m=p.closeMenuOnSelect,y=p.isMulti,v=p.inputValue;i.onInputChange("",{action:"set-value",prevInputValue:v}),m&&(i.setState({inputIsHiddenAfterUpdate:!y}),i.onMenuClose()),i.setState({clearFocusValueOnUpdate:!0}),i.onChange(u,{action:h,option:g})},i.selectOption=function(u){var h=i.props,g=h.blurInputOnSelect,p=h.isMulti,m=h.name,y=i.state.selectValue,v=p&&i.isOptionSelected(u,y),T=i.isOptionDisabled(u,y);if(v){var O=i.getOptionValue(u);i.setValue(y.filter(function(E){return i.getOptionValue(E)!==O}),"deselect-option",u)}else if(!T)p?i.setValue([].concat(Ov(y),[u]),"select-option",u):i.setValue(u,"select-option");else{i.ariaOnChange(u,{action:"select-option",option:u,name:m});return}g&&i.blurInput()},i.removeValue=function(u){var h=i.props.isMulti,g=i.state.selectValue,p=i.getOptionValue(u),m=g.filter(function(v){return i.getOptionValue(v)!==p}),y=pg(h,m,m[0]||null);i.onChange(y,{action:"remove-value",removedValue:u}),i.focusInput()},i.clearValue=function(){var u=i.state.selectValue;i.onChange(pg(i.props.isMulti,[],null),{action:"clear",removedValues:u})},i.popValue=function(){var u=i.props.isMulti,h=i.state.selectValue,g=h[h.length-1],p=h.slice(0,h.length-1),m=pg(u,p,p[0]||null);g&&i.onChange(m,{action:"pop-value",removedValue:g})},i.getFocusedOptionId=function(u){return V_(i.state.focusableOptionsWithIds,u)},i.getFocusableOptionsWithIds=function(){return Ib(Bg(i.props,i.state.selectValue),i.getElementId("option"))},i.getValue=function(){return i.state.selectValue},i.cx=function(){for(var u=arguments.length,h=new Array(u),g=0;g<u;g++)h[g]=arguments[g];return O3.apply(void 0,[i.props.classNamePrefix].concat(h))},i.getOptionLabel=function(u){return m2(i.props,u)},i.getOptionValue=function(u){return Xg(i.props,u)},i.getStyles=function(u,h){var g=i.props.unstyled,p=BP[u](h,g);p.boxSizing="border-box";var m=i.props.styles[u];return m?m(p,h):p},i.getClassNames=function(u,h){var g,p;return(g=(p=i.props.classNames)[u])===null||g===void 0?void 0:g.call(p,h)},i.getElementId=function(u){return"".concat(i.state.instancePrefix,"-").concat(u)},i.getComponents=function(){return rP(i.props)},i.buildCategorizedOptions=function(){return Bg(i.props,i.state.selectValue)},i.getCategorizedOptions=function(){return i.props.menuIsOpen?i.buildCategorizedOptions():[]},i.buildFocusableOptions=function(){return p2(i.buildCategorizedOptions())},i.getFocusableOptions=function(){return i.props.menuIsOpen?i.buildFocusableOptions():[]},i.ariaOnChange=function(u,h){i.setState({ariaSelection:Yt({value:u},h)})},i.onMenuMouseDown=function(u){u.button===0&&(u.stopPropagation(),u.preventDefault(),i.focusInput())},i.onMenuMouseMove=function(u){i.blockOptionHover=!1},i.onControlMouseDown=function(u){if(!u.defaultPrevented){var h=i.props.openMenuOnClick;i.state.isFocused?i.props.menuIsOpen?u.target.tagName!=="INPUT"&&u.target.tagName!=="TEXTAREA"&&i.onMenuClose():h&&i.openMenu("first"):(h&&(i.openAfterFocus=!0),i.focusInput()),u.target.tagName!=="INPUT"&&u.target.tagName!=="TEXTAREA"&&u.preventDefault()}},i.onDropdownIndicatorMouseDown=function(u){if(!(u&&u.type==="mousedown"&&u.button!==0)&&!i.props.isDisabled){var h=i.props,g=h.isMulti,p=h.menuIsOpen;i.focusInput(),p?(i.setState({inputIsHiddenAfterUpdate:!g}),i.onMenuClose()):i.openMenu("first"),u.preventDefault()}},i.onClearIndicatorMouseDown=function(u){u&&u.type==="mousedown"&&u.button!==0||(i.clearValue(),u.preventDefault(),i.openAfterFocus=!1,u.type==="touchend"?i.focusInput():setTimeout(function(){return i.focusInput()}))},i.onScroll=function(u){typeof i.props.closeMenuOnScroll=="boolean"?u.target instanceof HTMLElement&&d_(u.target)&&i.props.onMenuClose():typeof i.props.closeMenuOnScroll=="function"&&i.props.closeMenuOnScroll(u)&&i.props.onMenuClose()},i.onCompositionStart=function(){i.isComposing=!0},i.onCompositionEnd=function(){i.isComposing=!1},i.onTouchStart=function(u){var h=u.touches,g=h&&h.item(0);g&&(i.initialTouchX=g.clientX,i.initialTouchY=g.clientY,i.userIsDragging=!1)},i.onTouchMove=function(u){var h=u.touches,g=h&&h.item(0);if(g){var p=Math.abs(g.clientX-i.initialTouchX),m=Math.abs(g.clientY-i.initialTouchY),y=5;i.userIsDragging=p>y||m>y}},i.onTouchEnd=function(u){i.userIsDragging||(i.controlRef&&!i.controlRef.contains(u.target)&&i.menuListRef&&!i.menuListRef.contains(u.target)&&i.blurInput(),i.initialTouchX=0,i.initialTouchY=0)},i.onControlTouchEnd=function(u){i.userIsDragging||i.onControlMouseDown(u)},i.onClearIndicatorTouchEnd=function(u){i.userIsDragging||i.onClearIndicatorMouseDown(u)},i.onDropdownIndicatorTouchEnd=function(u){i.userIsDragging||i.onDropdownIndicatorMouseDown(u)},i.handleInputChange=function(u){var h=i.props.inputValue,g=u.currentTarget.value;i.setState({inputIsHiddenAfterUpdate:!1}),i.onInputChange(g,{action:"input-change",prevInputValue:h}),i.props.menuIsOpen||i.onMenuOpen()},i.onInputFocus=function(u){i.props.onFocus&&i.props.onFocus(u),i.setState({inputIsHiddenAfterUpdate:!1,isFocused:!0}),(i.openAfterFocus||i.props.openMenuOnFocus)&&i.openMenu("first"),i.openAfterFocus=!1},i.onInputBlur=function(u){var h=i.props.inputValue;if(i.menuListRef&&i.menuListRef.contains(document.activeElement)){i.inputRef.focus();return}i.props.onBlur&&i.props.onBlur(u),i.onInputChange("",{action:"input-blur",prevInputValue:h}),i.onMenuClose(),i.setState({focusedValue:null,isFocused:!1})},i.onOptionHover=function(u){if(!(i.blockOptionHover||i.state.focusedOption===u)){var h=i.getFocusableOptions(),g=h.indexOf(u);i.setState({focusedOption:u,focusedOptionId:g>-1?i.getFocusedOptionId(u):null})}},i.shouldHideSelectedOptions=function(){return y2(i.props)},i.onValueInputFocus=function(u){u.preventDefault(),u.stopPropagation(),i.focus()},i.onKeyDown=function(u){var h=i.props,g=h.isMulti,p=h.backspaceRemovesValue,m=h.escapeClearsValue,y=h.inputValue,v=h.isClearable,T=h.isDisabled,O=h.menuIsOpen,E=h.onKeyDown,S=h.tabSelectsValue,D=h.openMenuOnFocus,I=i.state,M=I.focusedOption,C=I.focusedValue,A=I.selectValue;if(!T&&!(typeof E=="function"&&(E(u),u.defaultPrevented))){switch(i.blockOptionHover=!0,u.key){case"ArrowLeft":if(!g||y)return;i.focusValue("previous");break;case"ArrowRight":if(!g||y)return;i.focusValue("next");break;case"Delete":case"Backspace":if(y)return;if(C)i.removeValue(C);else{if(!p)return;g?i.popValue():v&&i.clearValue()}break;case"Tab":if(i.isComposing||u.shiftKey||!O||!S||!M||D&&i.isOptionSelected(M,A))return;i.selectOption(M);break;case"Enter":if(u.keyCode===229)break;if(O){if(!M||i.isComposing)return;i.selectOption(M);break}return;case"Escape":O?(i.setState({inputIsHiddenAfterUpdate:!1}),i.onInputChange("",{action:"menu-close",prevInputValue:y}),i.onMenuClose()):v&&m&&i.clearValue();break;case" ":if(y)return;if(!O){i.openMenu("first");break}if(!M)return;i.selectOption(M);break;case"ArrowUp":O?i.focusOption("up"):i.openMenu("last");break;case"ArrowDown":O?i.focusOption("down"):i.openMenu("first");break;case"PageUp":if(!O)return;i.focusOption("pageup");break;case"PageDown":if(!O)return;i.focusOption("pagedown");break;case"Home":if(!O)return;i.focusOption("first");break;case"End":if(!O)return;i.focusOption("last");break;default:return}u.preventDefault()}},i.state.instancePrefix="react-select-"+(i.props.instanceId||++WP),i.state.selectValue=pb(s.value),s.menuIsOpen&&i.state.selectValue.length){var o=i.getFocusableOptionsWithIds(),c=i.buildFocusableOptions(),d=c.indexOf(i.state.selectValue[0]);i.state.focusableOptionsWithIds=o,i.state.focusedOption=c[d],i.state.focusedOptionId=V_(o,c[d])}return i}return cS(n,[{key:"componentDidMount",value:function(){this.startListeningComposition(),this.startListeningToTouch(),this.props.closeMenuOnScroll&&document&&document.addEventListener&&document.addEventListener("scroll",this.onScroll,!0),this.props.autoFocus&&this.focusInput(),this.props.menuIsOpen&&this.state.focusedOption&&this.menuListRef&&this.focusedOptionRef&&mb(this.menuListRef,this.focusedOptionRef),PP()&&this.setState({isAppleDevice:!0})}},{key:"componentDidUpdate",value:function(i){var o=this.props,c=o.isDisabled,d=o.menuIsOpen,u=this.state.isFocused;(u&&!c&&i.isDisabled||u&&d&&!i.menuIsOpen)&&this.focusInput(),u&&c&&!i.isDisabled?this.setState({isFocused:!1},this.onMenuClose):!u&&!c&&i.isDisabled&&this.inputRef===document.activeElement&&this.setState({isFocused:!0}),this.menuListRef&&this.focusedOptionRef&&this.scrollToFocusedOptionOnUpdate&&(mb(this.menuListRef,this.focusedOptionRef),this.scrollToFocusedOptionOnUpdate=!1)}},{key:"componentWillUnmount",value:function(){this.stopListeningComposition(),this.stopListeningToTouch(),document.removeEventListener("scroll",this.onScroll,!0)}},{key:"onMenuOpen",value:function(){this.props.onMenuOpen()}},{key:"onMenuClose",value:function(){this.onInputChange("",{action:"menu-close",prevInputValue:this.props.inputValue}),this.props.onMenuClose()}},{key:"onInputChange",value:function(i,o){this.props.onInputChange(i,o)}},{key:"focusInput",value:function(){this.inputRef&&this.inputRef.focus()}},{key:"blurInput",value:function(){this.inputRef&&this.inputRef.blur()}},{key:"openMenu",value:function(i){var o=this,c=this.state,d=c.selectValue,u=c.isFocused,h=this.buildFocusableOptions(),g=i==="first"?0:h.length-1;if(!this.props.isMulti){var p=h.indexOf(d[0]);p>-1&&(g=p)}this.scrollToFocusedOptionOnUpdate=!(u&&this.menuListRef),this.setState({inputIsHiddenAfterUpdate:!1,focusedValue:null,focusedOption:h[g],focusedOptionId:this.getFocusedOptionId(h[g])},function(){return o.onMenuOpen()})}},{key:"focusValue",value:function(i){var o=this.state,c=o.selectValue,d=o.focusedValue;if(this.props.isMulti){this.setState({focusedOption:null});var u=c.indexOf(d);d||(u=-1);var h=c.length-1,g=-1;if(c.length){switch(i){case"previous":u===0?g=0:u===-1?g=h:g=u-1;break;case"next":u>-1&&u<h&&(g=u+1);break}this.setState({inputIsHidden:g!==-1,focusedValue:c[g]})}}}},{key:"focusOption",value:function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"first",o=this.props.pageSize,c=this.state.focusedOption,d=this.getFocusableOptions();if(d.length){var u=0,h=d.indexOf(c);c||(h=-1),i==="up"?u=h>0?h-1:d.length-1:i==="down"?u=(h+1)%d.length:i==="pageup"?(u=h-o,u<0&&(u=0)):i==="pagedown"?(u=h+o,u>d.length-1&&(u=d.length-1)):i==="last"&&(u=d.length-1),this.scrollToFocusedOptionOnUpdate=!0,this.setState({focusedOption:d[u],focusedValue:null,focusedOptionId:this.getFocusedOptionId(d[u])})}}},{key:"getTheme",value:(function(){return this.props.theme?typeof this.props.theme=="function"?this.props.theme(U_):Yt(Yt({},U_),this.props.theme):U_})},{key:"getCommonProps",value:function(){var i=this.clearValue,o=this.cx,c=this.getStyles,d=this.getClassNames,u=this.getValue,h=this.selectOption,g=this.setValue,p=this.props,m=p.isMulti,y=p.isRtl,v=p.options,T=this.hasValue();return{clearValue:i,cx:o,getStyles:c,getClassNames:d,getValue:u,hasValue:T,isMulti:m,isRtl:y,options:v,selectOption:h,selectProps:p,setValue:g,theme:this.getTheme()}}},{key:"hasValue",value:function(){var i=this.state.selectValue;return i.length>0}},{key:"hasOptions",value:function(){return!!this.getFocusableOptions().length}},{key:"isClearable",value:function(){var i=this.props,o=i.isClearable,c=i.isMulti;return o===void 0?c:o}},{key:"isOptionDisabled",value:function(i,o){return g2(this.props,i,o)}},{key:"isOptionSelected",value:function(i,o){return _2(this.props,i,o)}},{key:"filterOption",value:function(i,o){return v2(this.props,i,o)}},{key:"formatOptionLabel",value:function(i,o){if(typeof this.props.formatOptionLabel=="function"){var c=this.props.inputValue,d=this.state.selectValue;return this.props.formatOptionLabel(i,{context:o,inputValue:c,selectValue:d})}else return this.getOptionLabel(i)}},{key:"formatGroupLabel",value:function(i){return this.props.formatGroupLabel(i)}},{key:"startListeningComposition",value:(function(){document&&document.addEventListener&&(document.addEventListener("compositionstart",this.onCompositionStart,!1),document.addEventListener("compositionend",this.onCompositionEnd,!1))})},{key:"stopListeningComposition",value:function(){document&&document.removeEventListener&&(document.removeEventListener("compositionstart",this.onCompositionStart),document.removeEventListener("compositionend",this.onCompositionEnd))}},{key:"startListeningToTouch",value:(function(){document&&document.addEventListener&&(document.addEventListener("touchstart",this.onTouchStart,!1),document.addEventListener("touchmove",this.onTouchMove,!1),document.addEventListener("touchend",this.onTouchEnd,!1))})},{key:"stopListeningToTouch",value:function(){document&&document.removeEventListener&&(document.removeEventListener("touchstart",this.onTouchStart),document.removeEventListener("touchmove",this.onTouchMove),document.removeEventListener("touchend",this.onTouchEnd))}},{key:"renderInput",value:(function(){var i=this.props,o=i.isDisabled,c=i.isSearchable,d=i.inputId,u=i.inputValue,h=i.tabIndex,g=i.form,p=i.menuIsOpen,m=i.required,y=this.getComponents(),v=y.Input,T=this.state,O=T.inputIsHidden,E=T.ariaSelection,S=this.commonProps,D=d||this.getElementId("input"),I=Yt(Yt(Yt({"aria-autocomplete":"list","aria-expanded":p,"aria-haspopup":!0,"aria-errormessage":this.props["aria-errormessage"],"aria-invalid":this.props["aria-invalid"],"aria-label":this.props["aria-label"],"aria-labelledby":this.props["aria-labelledby"],"aria-required":m,role:"combobox","aria-activedescendant":this.state.isAppleDevice?void 0:this.state.focusedOptionId||""},p&&{"aria-controls":this.getElementId("listbox")}),!c&&{"aria-readonly":!0}),this.hasValue()?(E==null?void 0:E.action)==="initial-input-focus"&&{"aria-describedby":this.getElementId("live-region")}:{"aria-describedby":this.getElementId("placeholder")});return c?we.createElement(v,rn({},S,{autoCapitalize:"none",autoComplete:"off",autoCorrect:"off",id:D,innerRef:this.getInputRef,isDisabled:o,isHidden:O,onBlur:this.onInputBlur,onChange:this.handleInputChange,onFocus:this.onInputFocus,spellCheck:"false",tabIndex:h,form:g,type:"text",value:u},I)):we.createElement(_P,rn({id:D,innerRef:this.getInputRef,onBlur:this.onInputBlur,onChange:qg,onFocus:this.onInputFocus,disabled:o,tabIndex:h,inputMode:"none",form:g,value:""},I))})},{key:"renderPlaceholderOrValue",value:function(){var i=this,o=this.getComponents(),c=o.MultiValue,d=o.MultiValueContainer,u=o.MultiValueLabel,h=o.MultiValueRemove,g=o.SingleValue,p=o.Placeholder,m=this.commonProps,y=this.props,v=y.controlShouldRenderValue,T=y.isDisabled,O=y.isMulti,E=y.inputValue,S=y.placeholder,D=this.state,I=D.selectValue,M=D.focusedValue,C=D.isFocused;if(!this.hasValue()||!v)return E?null:we.createElement(p,rn({},m,{key:"placeholder",isDisabled:T,isFocused:C,innerProps:{id:this.getElementId("placeholder")}}),S);if(O)return I.map(function(k,R){var G=k===M,te="".concat(i.getOptionLabel(k),"-").concat(i.getOptionValue(k));return we.createElement(c,rn({},m,{components:{Container:d,Label:u,Remove:h},isFocused:G,isDisabled:T,key:te,index:R,removeProps:{onClick:function(){return i.removeValue(k)},onTouchEnd:function(){return i.removeValue(k)},onMouseDown:function(X){X.preventDefault()}},data:k}),i.formatOptionLabel(k,"value"))});if(E)return null;var A=I[0];return we.createElement(g,rn({},m,{data:A,isDisabled:T}),this.formatOptionLabel(A,"value"))}},{key:"renderClearIndicator",value:function(){var i=this.getComponents(),o=i.ClearIndicator,c=this.commonProps,d=this.props,u=d.isDisabled,h=d.isLoading,g=this.state.isFocused;if(!this.isClearable()||!o||u||!this.hasValue()||h)return null;var p={onMouseDown:this.onClearIndicatorMouseDown,onTouchEnd:this.onClearIndicatorTouchEnd,"aria-hidden":"true"};return we.createElement(o,rn({},c,{innerProps:p,isFocused:g}))}},{key:"renderLoadingIndicator",value:function(){var i=this.getComponents(),o=i.LoadingIndicator,c=this.commonProps,d=this.props,u=d.isDisabled,h=d.isLoading,g=this.state.isFocused;if(!o||!h)return null;var p={"aria-hidden":"true"};return we.createElement(o,rn({},c,{innerProps:p,isDisabled:u,isFocused:g}))}},{key:"renderIndicatorSeparator",value:function(){var i=this.getComponents(),o=i.DropdownIndicator,c=i.IndicatorSeparator;if(!o||!c)return null;var d=this.commonProps,u=this.props.isDisabled,h=this.state.isFocused;return we.createElement(c,rn({},d,{isDisabled:u,isFocused:h}))}},{key:"renderDropdownIndicator",value:function(){var i=this.getComponents(),o=i.DropdownIndicator;if(!o)return null;var c=this.commonProps,d=this.props.isDisabled,u=this.state.isFocused,h={onMouseDown:this.onDropdownIndicatorMouseDown,onTouchEnd:this.onDropdownIndicatorTouchEnd,"aria-hidden":"true"};return we.createElement(o,rn({},c,{innerProps:h,isDisabled:d,isFocused:u}))}},{key:"renderMenu",value:function(){var i=this,o=this.getComponents(),c=o.Group,d=o.GroupHeading,u=o.Menu,h=o.MenuList,g=o.MenuPortal,p=o.LoadingMessage,m=o.NoOptionsMessage,y=o.Option,v=this.commonProps,T=this.state.focusedOption,O=this.props,E=O.captureMenuScroll,S=O.inputValue,D=O.isLoading,I=O.loadingMessage,M=O.minMenuHeight,C=O.maxMenuHeight,A=O.menuIsOpen,k=O.menuPlacement,R=O.menuPosition,G=O.menuPortalTarget,te=O.menuShouldBlockScroll,ee=O.menuShouldScrollIntoView,X=O.noOptionsMessage,le=O.onMenuScrollToTop,ae=O.onMenuScrollToBottom;if(!A)return null;var Q=function(N,q){var ce=N.type,Z=N.data,Me=N.isDisabled,Pe=N.isSelected,Ne=N.label,Oe=N.value,he=T===Z,H=Me?void 0:function(){return i.onOptionHover(Z)},Te=Me?void 0:function(){return i.selectOption(Z)},ze="".concat(i.getElementId("option"),"-").concat(q),Re={id:ze,onClick:Te,onMouseMove:H,onMouseOver:H,tabIndex:-1,role:"option","aria-selected":i.state.isAppleDevice?void 0:Pe};return we.createElement(y,rn({},v,{innerProps:Re,data:Z,isDisabled:Me,isSelected:Pe,key:ze,label:Ne,type:ce,value:Oe,isFocused:he,innerRef:he?i.getFocusedOptionRef:void 0}),i.formatOptionLabel(N.data,"menu"))},ne;if(this.hasOptions())ne=this.getCategorizedOptions().map(function(U){if(U.type==="group"){var N=U.data,q=U.options,ce=U.index,Z="".concat(i.getElementId("group"),"-").concat(ce),Me="".concat(Z,"-heading");return we.createElement(c,rn({},v,{key:Z,data:N,options:q,Heading:d,headingProps:{id:Me,data:U.data},label:i.formatGroupLabel(U.data)}),U.options.map(function(Pe){return Q(Pe,"".concat(ce,"-").concat(Pe.index))}))}else if(U.type==="option")return Q(U,"".concat(U.index))});else if(D){var de=I({inputValue:S});if(de===null)return null;ne=we.createElement(p,v,de)}else{var ve=X({inputValue:S});if(ve===null)return null;ne=we.createElement(m,v,ve)}var fe={minMenuHeight:M,maxMenuHeight:C,menuPlacement:k,menuPosition:R,menuShouldScrollIntoView:ee},j=we.createElement(K3,rn({},v,fe),function(U){var N=U.ref,q=U.placerProps,ce=q.placement,Z=q.maxHeight;return we.createElement(u,rn({},v,fe,{innerRef:N,innerProps:{onMouseDown:i.onMenuMouseDown,onMouseMove:i.onMenuMouseMove},isLoading:D,placement:ce}),we.createElement(xP,{captureEnabled:E,onTopArrive:le,onBottomArrive:ae,lockEnabled:te},function(Me){return we.createElement(h,rn({},v,{innerRef:function(Ne){i.getMenuListRef(Ne),Me(Ne)},innerProps:{role:"listbox","aria-multiselectable":v.isMulti,id:i.getElementId("listbox")},isLoading:D,maxHeight:Z,focusedOption:T}),ne)}))});return G||R==="fixed"?we.createElement(g,rn({},v,{appendTo:G,controlElement:this.controlRef,menuPlacement:k,menuPosition:R}),j):j}},{key:"renderFormField",value:function(){var i=this,o=this.props,c=o.delimiter,d=o.isDisabled,u=o.isMulti,h=o.name,g=o.required,p=this.state.selectValue;if(g&&!this.hasValue()&&!d)return we.createElement(AP,{name:h,onFocus:this.onValueInputFocus});if(!(!h||d))if(u)if(c){var m=p.map(function(T){return i.getOptionValue(T)}).join(c);return we.createElement("input",{name:h,type:"hidden",value:m})}else{var y=p.length>0?p.map(function(T,O){return we.createElement("input",{key:"i-".concat(O),name:h,type:"hidden",value:i.getOptionValue(T)})}):we.createElement("input",{name:h,type:"hidden",value:""});return we.createElement("div",null,y)}else{var v=p[0]?this.getOptionValue(p[0]):"";return we.createElement("input",{name:h,type:"hidden",value:v})}}},{key:"renderLiveRegion",value:function(){var i=this.commonProps,o=this.state,c=o.ariaSelection,d=o.focusedOption,u=o.focusedValue,h=o.isFocused,g=o.selectValue,p=this.getFocusableOptions();return we.createElement(dP,rn({},i,{id:this.getElementId("live-region"),ariaSelection:c,focusedOption:d,focusedValue:u,isFocused:h,selectValue:g,focusableOptions:p,isAppleDevice:this.state.isAppleDevice}))}},{key:"render",value:function(){var i=this.getComponents(),o=i.Control,c=i.IndicatorsContainer,d=i.SelectContainer,u=i.ValueContainer,h=this.props,g=h.className,p=h.id,m=h.isDisabled,y=h.menuIsOpen,v=this.state.isFocused,T=this.commonProps=this.getCommonProps();return we.createElement(d,rn({},T,{className:g,innerProps:{id:p,onKeyDown:this.onKeyDown},isDisabled:m,isFocused:v}),this.renderLiveRegion(),we.createElement(o,rn({},T,{innerRef:this.getControlRef,innerProps:{onMouseDown:this.onControlMouseDown,onTouchEnd:this.onControlTouchEnd},isDisabled:m,isFocused:v,menuIsOpen:y}),we.createElement(u,rn({},T,{isDisabled:m}),this.renderPlaceholderOrValue(),this.renderInput()),we.createElement(c,rn({},T,{isDisabled:m}),this.renderClearIndicator(),this.renderLoadingIndicator(),this.renderIndicatorSeparator(),this.renderDropdownIndicator())),this.renderMenu(),this.renderFormField())}}],[{key:"getDerivedStateFromProps",value:function(i,o){var c=o.prevProps,d=o.clearFocusValueOnUpdate,u=o.inputIsHiddenAfterUpdate,h=o.ariaSelection,g=o.isFocused,p=o.prevWasFocused,m=o.instancePrefix,y=i.options,v=i.value,T=i.menuIsOpen,O=i.inputValue,E=i.isMulti,S=pb(v),D={};if(c&&(v!==c.value||y!==c.options||T!==c.menuIsOpen||O!==c.inputValue)){var I=T?UP(i,S):[],M=T?Ib(Bg(i,S),"".concat(m,"-option")):[],C=d?VP(o,S):null,A=GP(o,I),k=V_(M,A);D={selectValue:S,focusedOption:A,focusedOptionId:k,focusableOptionsWithIds:M,focusedValue:C,clearFocusValueOnUpdate:!1}}var R=u!=null&&i!==c?{inputIsHidden:u,inputIsHiddenAfterUpdate:void 0}:{},G=h,te=g&&p;return g&&!te&&(G={value:pg(E,S,S[0]||null),options:S,action:"initial-input-focus"},te=!p),(h==null?void 0:h.action)==="initial-input-focus"&&(G=null),Yt(Yt(Yt({},D),R),{},{prevProps:i,ariaSelection:G,prevWasFocused:te})}}]),n})(we.Component);b2.defaultProps=jP;var HP=we.forwardRef(function(e,t){var n=oS(e);return we.createElement(b2,rn({ref:t},n))}),Lg=HP;const kb=[{value:Ln.PROVIDERS.WEBGPU,label:"WebGPU (Fastest)"},{value:Ln.PROVIDERS.WASM,label:"WASM (Most Compatible, CPU)"}];function QP({value:e,onChange:t}){const{theme:n}=gm(),[s,i]=we.useState(kb);we.useEffect(()=>{k1().then(d=>{d||i(kb.filter(u=>u.value!==Ln.PROVIDERS.WEBGPU))})},[]);const o=s.find(d=>d.value===e),c={control:d=>({...d,width:"auto",minWidth:"200px",backgroundColor:n==="dark"?"rgba(255, 255, 255, 0.05)":"rgba(0, 0, 0, 0.05)",border:`1px solid ${n==="dark"?"rgba(255, 255, 255, 0.1)":"rgba(0, 0, 0, 0.1)"}`,borderRadius:"0.5rem",boxShadow:"none",cursor:"pointer",padding:"2px 8px",minHeight:"auto",display:"flex",alignItems:"center","&:hover":{backgroundColor:n==="dark"?"rgba(255, 255, 255, 0.08)":"rgba(0, 0, 0, 0.08)",borderColor:n==="dark"?"rgba(255, 255, 255, 0.2)":"rgba(0, 0, 0, 0.2)"}}),valueContainer:d=>({...d,padding:"0 4px 0 0",margin:0}),input:d=>({...d,margin:"0px",color:n==="dark"?"white":"black"}),indicatorSeparator:()=>({display:"none"}),indicatorsContainer:d=>({...d,height:"auto",padding:0}),dropdownIndicator:d=>({...d,padding:0,color:n==="dark"?"rgba(255, 255, 255, 0.4)":"rgba(0, 0, 0, 0.4)"}),singleValue:d=>({...d,color:n==="dark"?"rgba(255, 255, 255, 0.8)":"rgba(0, 0, 0, 0.8)",fontSize:"0.75rem",margin:0}),menu:d=>({...d,backgroundColor:n==="dark"?"#1a1a1a":"white",border:`1px solid ${n==="dark"?"rgba(255, 255, 255, 0.1)":"rgba(0, 0, 0, 0.1)"}`,borderRadius:"0.75rem",boxShadow:"0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05)",zIndex:50,overflow:"hidden"}),option:(d,{isSelected:u,isFocused:h})=>({...d,backgroundColor:u?"rgb(6 182 212)":h?n==="dark"?"rgba(255, 255, 255, 0.05)":"rgba(0, 0, 0, 0.05)":"transparent",color:u?"white":n==="dark"?"rgba(255, 255, 255, 0.8)":"#1f2937",fontSize:"0.875rem",cursor:"pointer",padding:"8px 12px"})};return z.jsx(Lg,{value:o,onChange:d=>t((d==null?void 0:d.value)||"wasm"),options:s,isSearchable:!1,styles:c,placeholder:"Select provider..."})}const mg=[{value:"fp32",label:"FP32"},{value:"fp16",label:"FP16"},{value:"int8",label:"Int8"},{value:"int4",label:"Int4"}],Db=[{value:"high_quality",label:"Highest Quality",description:"Best accuracy, uses FP32"},{value:"fast",label:"Fastest",description:"Balanced speed/quality (FP16 Enc / FP32 Dec)"},{value:"balanced",label:"Balanced",description:"Good for CPU (Int8)"},{value:"low_memory",label:"Lowest Memory",description:"Smallest download (Int4)"}],Yg=({content:e,children:t,width:n="w-48",side:s="top"})=>{const i=we.useRef(null),[o,c]=we.useState(null),[d,u]=we.useState(!1);we.useLayoutEffect(()=>{if(!d||!i.current)return;const y=()=>{if(i.current){const v=i.current.getBoundingClientRect(),T=window.innerHeight,O=window.scrollY,E=window.scrollX;let S=s;s==="top"&&v.top<40?S="bottom":s==="bottom"&&v.bottom>T-40&&(S="top");const D=S==="top"?v.top+O-8:v.bottom+O+8;c({top:D,left:v.left+v.width/2+E,side:S})}};return y(),window.addEventListener("resize",y),window.addEventListener("scroll",y,!0),()=>{window.removeEventListener("resize",y),window.removeEventListener("scroll",y,!0)}},[s,d]),we.useEffect(()=>{if(!d)return;const y=v=>{i.current&&!i.current.contains(v.target)&&u(!1)};return document.addEventListener("mousedown",y),()=>{document.removeEventListener("mousedown",y)}},[d]);const h=()=>u(!0),g=()=>u(!1),p=d&&o?z.jsx("div",{className:`absolute z-[9999] ${n} p-2 bg-white dark:bg-[#111] border border-black/10 dark:border-white/10 rounded-lg shadow-xl text-left pointer-events-auto transition-opacity duration-200 ${d?"opacity-100":"opacity-0"}`,style:{top:o.top,left:o.left,transform:`translateX(-50%) ${o.side==="top"?"translateY(-100%)":""}`},onMouseDown:y=>y.stopPropagation(),children:z.jsx("div",{className:"text-[10px] text-slate-500 dark:text-white/60 leading-tight",children:e})}):null,{createPortal:m}=m3;return z.jsxs(z.Fragment,{children:[z.jsx("div",{ref:i,className:"relative inline-block",onMouseEnter:h,onMouseLeave:g,onClick:y=>{y.stopPropagation(),u(!d)},children:t}),d&&m(p,document.body)]})},Jg=({className:e="w-3.5 h-3.5 text-slate-400 dark:text-white/30 hover:text-cyan-600 dark:hover:text-cyan-400"})=>z.jsx("svg",{className:`cursor-help transition-colors ${e}`,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:z.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})});class qP{constructor(t,n,s){this.chunkSize=4*1024*1024,this.concurrency=4,this.url=t,this.store=n,this.abortController=new AbortController,s!=null&&s.chunkSize&&(this.chunkSize=s.chunkSize),s!=null&&s.concurrency&&(this.concurrency=s.concurrency),this.onProgress=s==null?void 0:s.onProgress}async start(){var g;const t=await fetch(this.url,{method:"HEAD",signal:this.abortController.signal});if(!t.ok)throw new Error(`Failed to fetch metadata for ${this.url}: ${t.statusText}`);const n=parseInt(t.headers.get("Content-Length")||"0",10),s=t.headers.get("ETag"),i=t.headers.get("Content-Type")||"application/octet-stream";if(n===0)throw new Error(`Invalid content length for ${this.url}`);const o=await this.store.initFile(this.url,n,i,s,this.chunkSize),c=[];let d=0;for(let p=0;p<o.totalChunks;p++)if(!o.chunks[p])c.push(p);else{const m=p*this.chunkSize,y=Math.min(m+this.chunkSize,n);d+=y-m}if(c.length===0){(g=this.onProgress)==null||g.call(this,{loaded:n,total:n});return}let u=0,h=0;return new Promise((p,m)=>{this.rejecter=m;const y=async()=>{var O;if(this.abortController.signal.aborted)return;if(h>=c.length){u===0&&p();return}const T=c[h++];u++;try{await this.downloadChunk(T,n);const E=T*this.chunkSize,S=Math.min(E+this.chunkSize,n);d+=S-E,(O=this.onProgress)==null||O.call(this,{loaded:d,total:n}),u--,y()}catch(E){if(u--,this.abortController.signal.aborted)return;this.abortController.abort(),m(E)}},v=Math.min(this.concurrency,c.length);for(let T=0;T<v;T++)y()})}async downloadChunk(t,n){const s=t*this.chunkSize,i=Math.min(s+this.chunkSize,n)-1,o=await fetch(this.url,{headers:{Range:`bytes=${s}-${i}`},signal:this.abortController.signal});if(!o.ok)throw new Error(`Failed to download chunk ${t}: ${o.statusText}`);const c=await o.blob();await this.store.saveChunk(this.url,t,c)}abort(){this.abortController.abort(),this.rejecter&&this.rejecter(new Error("Download aborted"))}}const rv=(e,t)=>t.some(n=>e instanceof n);let Ob,$b;function KP(){return Ob||(Ob=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function XP(){return $b||($b=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const av=new WeakMap,G_=new WeakMap,f_=new WeakMap;function YP(e){const t=new Promise((n,s)=>{const i=()=>{e.removeEventListener("success",o),e.removeEventListener("error",c)},o=()=>{n(wu(e.result)),i()},c=()=>{s(e.error),i()};e.addEventListener("success",o),e.addEventListener("error",c)});return f_.set(t,e),t}function JP(e){if(av.has(e))return;const t=new Promise((n,s)=>{const i=()=>{e.removeEventListener("complete",o),e.removeEventListener("error",c),e.removeEventListener("abort",c)},o=()=>{n(),i()},c=()=>{s(e.error||new DOMException("AbortError","AbortError")),i()};e.addEventListener("complete",o),e.addEventListener("error",c),e.addEventListener("abort",c)});av.set(e,t)}let sv={get(e,t,n){if(e instanceof IDBTransaction){if(t==="done")return av.get(e);if(t==="store")return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return wu(e[t])},set(e,t,n){return e[t]=n,!0},has(e,t){return e instanceof IDBTransaction&&(t==="done"||t==="store")?!0:t in e}};function w2(e){sv=e(sv)}function ZP(e){return XP().includes(e)?function(...t){return e.apply(iv(this),t),wu(this.request)}:function(...t){return wu(e.apply(iv(this),t))}}function ek(e){return typeof e=="function"?ZP(e):(e instanceof IDBTransaction&&JP(e),rv(e,KP())?new Proxy(e,sv):e)}function wu(e){if(e instanceof IDBRequest)return YP(e);if(G_.has(e))return G_.get(e);const t=ek(e);return t!==e&&(G_.set(e,t),f_.set(t,e)),t}const iv=e=>f_.get(e);function tk(e,t,{blocked:n,upgrade:s,blocking:i,terminated:o}={}){const c=indexedDB.open(e,t),d=wu(c);return s&&c.addEventListener("upgradeneeded",u=>{s(wu(c.result),u.oldVersion,u.newVersion,wu(c.transaction),u)}),n&&c.addEventListener("blocked",u=>n(u.oldVersion,u.newVersion,u)),d.then(u=>{o&&u.addEventListener("close",()=>o()),i&&u.addEventListener("versionchange",h=>i(h.oldVersion,h.newVersion,h))}).catch(()=>{}),d}const nk=["get","getKey","getAll","getAllKeys","count"],rk=["put","add","delete","clear"],W_=new Map;function Bb(e,t){if(!(e instanceof IDBDatabase&&!(t in e)&&typeof t=="string"))return;if(W_.get(t))return W_.get(t);const n=t.replace(/FromIndex$/,""),s=t!==n,i=rk.includes(n);if(!(n in(s?IDBIndex:IDBObjectStore).prototype)||!(i||nk.includes(n)))return;const o=async function(c,...d){const u=this.transaction(c,i?"readwrite":"readonly");let h=u.store;return s&&(h=h.index(d.shift())),(await Promise.all([h[n](...d),i&&u.done]))[0]};return W_.set(t,o),o}w2(e=>({...e,get:(t,n,s)=>Bb(t,n)||e.get(t,n,s),has:(t,n)=>!!Bb(t,n)||e.has(t,n)}));const ak=["continue","continuePrimaryKey","advance"],Lb={},ov=new WeakMap,M2=new WeakMap,sk={get(e,t){if(!ak.includes(t))return e[t];let n=Lb[t];return n||(n=Lb[t]=function(...s){ov.set(this,M2.get(this)[t](...s))}),n}};async function*ik(...e){let t=this;if(t instanceof IDBCursor||(t=await t.openCursor(...e)),!t)return;t=t;const n=new Proxy(t,sk);for(M2.set(n,t),f_.set(n,iv(t));t;)yield n,t=await(ov.get(n)||t.continue()),ov.delete(n)}function Fb(e,t){return t===Symbol.asyncIterator&&rv(e,[IDBIndex,IDBObjectStore,IDBCursor])||t==="iterate"&&rv(e,[IDBIndex,IDBObjectStore])}w2(e=>({...e,get(t,n,s){return Fb(t,n)?ik:e.get(t,n,s)},has(t,n){return Fb(t,n)||e.has(t,n)}}));const _f=class _f{constructor(){this.dbPromise=tk(_f.DB_NAME,_f.DB_VERSION,{upgrade(t,n){t.objectStoreNames.contains("metadata")||t.createObjectStore("metadata",{keyPath:"url"}),t.objectStoreNames.contains("chunks")&&n<2&&t.deleteObjectStore("chunks"),t.objectStoreNames.contains("chunks")||t.createObjectStore("chunks")}})}async getMetadata(t){return await(await this.dbPromise).get("metadata",t)}async initFile(t,n,s,i,o){const d=(await this.dbPromise).transaction("metadata","readwrite"),u=d.objectStore("metadata"),h=await u.get(t),g=Math.ceil(n/o);if(h)if(h.etag!==i||h.totalBytes!==n)console.warn(`[ChunkStore] File changed for ${t}, resetting.`);else return h;const p={url:t,totalBytes:n,mimeType:s,etag:i,lastModified:Date.now(),chunkSize:o,totalChunks:g,chunks:new Array(g).fill(!1)};return await u.put(p),await d.done,p}async saveChunk(t,n,s){const o=(await this.dbPromise).transaction(["metadata","chunks"],"readwrite");await o.objectStore("chunks").put(s,[t,n]);const c=o.objectStore("metadata"),d=await c.get(t);d&&(d.chunks[n]||(d.chunks[n]=!0,d.lastModified=Date.now(),await c.put(d))),await o.done}async getChunk(t,n){return await(await this.dbPromise).get("chunks",[t,n])}async deleteFile(t){const s=(await this.dbPromise).transaction(["metadata","chunks"],"readwrite");await s.objectStore("metadata").delete(t);const i=s.objectStore("chunks"),o=IDBKeyRange.bound([t,0],[t,1/0]);let c=await i.openCursor(o);for(;c;)await c.delete(),c=await c.continue();await s.done}async clearAll(){const n=(await this.dbPromise).transaction(["metadata","chunks"],"readwrite");await n.objectStore("metadata").clear(),await n.objectStore("chunks").clear(),await n.done}async getStream(t){const n=await this.dbPromise,s=await n.get("metadata",t);if(!s)throw new Error(`Missing metadata for ${t}`);let i=0;const o=s.totalChunks;return new ReadableStream({async pull(c){if(i>=o){c.close();return}try{const d=await n.get("chunks",[t,i]);if(!d){c.error(new Error(`Missing chunk ${i} for ${t}`));return}const u=await d.arrayBuffer();c.enqueue(new Uint8Array(u)),i++}catch(d){c.error(d)}}})}};_f.DB_NAME="texpen-downloads-v3",_f.DB_VERSION=2;let lv=_f;const Fg=new Map,mu=[],ok=(e,t,n)=>{if(t&&typeof t.init=="function"&&typeof t.createInferenceSessionHandler=="function"){const s=Fg.get(e);if(s===void 0)Fg.set(e,{backend:t,priority:n});else{if(s.priority>n)return;if(s.priority===n&&s.backend!==t)throw new Error(`cannot register backend "${e}" using priority ${n}`)}if(n>=0){const i=mu.indexOf(e);i!==-1&&mu.splice(i,1);for(let o=0;o<mu.length;o++)if(Fg.get(mu[o]).priority<=n){mu.splice(o,0,e);return}mu.push(e)}return}throw new TypeError("not a valid backend")},lk=async e=>{const t=Fg.get(e);if(!t)return"backend not found.";if(t.initialized)return t.backend;if(t.aborted)return t.error;{const n=!!t.initPromise;try{return n||(t.initPromise=t.backend.init(e)),await t.initPromise,t.initialized=!0,t.backend}catch(s){return n||(t.error=`${s}`,t.aborted=!0),t.error}finally{delete t.initPromise}}},ck=async e=>{const t=e.executionProviders||[],n=t.map(u=>typeof u=="string"?u:u.name),s=n.length===0?mu:n;let i;const o=[],c=new Set;for(const u of s){const h=await lk(u);typeof h=="string"?o.push({name:u,err:h}):(i||(i=h),i===h&&c.add(u))}if(!i)throw new Error(`no available backend found. ERR: ${o.map(u=>`[${u.name}] ${u.err}`).join(", ")}`);for(const{name:u,err:h}of o)n.includes(u)&&console.warn(`removing requested execution provider "${u}" from session options because it is not available: ${h}`);const d=t.filter(u=>c.has(typeof u=="string"?u:u.name));return[i,new Proxy(e,{get:(u,h)=>h==="executionProviders"?d:Reflect.get(u,h)})]},uk="1.23.2";let zb="warning";const Ia={wasm:{},webgl:{},webgpu:{},versions:{common:uk},set logLevel(e){if(e!==void 0){if(typeof e!="string"||["verbose","info","warning","error","fatal"].indexOf(e)===-1)throw new Error(`Unsupported logging level: ${e}`);zb=e}},get logLevel(){return zb}};Object.defineProperty(Ia,"logLevel",{enumerable:!0});const dk=Ia,fk=(e,t)=>{const n=typeof document<"u"?document.createElement("canvas"):new OffscreenCanvas(1,1);n.width=e.dims[3],n.height=e.dims[2];const s=n.getContext("2d");if(s!=null){let i,o;(t==null?void 0:t.tensorLayout)!==void 0&&t.tensorLayout==="NHWC"?(i=e.dims[2],o=e.dims[3]):(i=e.dims[3],o=e.dims[2]);const c=(t==null?void 0:t.format)!==void 0?t.format:"RGB",d=t==null?void 0:t.norm;let u,h;d===void 0||d.mean===void 0?u=[255,255,255,255]:typeof d.mean=="number"?u=[d.mean,d.mean,d.mean,d.mean]:(u=[d.mean[0],d.mean[1],d.mean[2],0],d.mean[3]!==void 0&&(u[3]=d.mean[3])),d===void 0||d.bias===void 0?h=[0,0,0,0]:typeof d.bias=="number"?h=[d.bias,d.bias,d.bias,d.bias]:(h=[d.bias[0],d.bias[1],d.bias[2],0],d.bias[3]!==void 0&&(h[3]=d.bias[3]));const g=o*i;let p=0,m=g,y=g*2,v=-1;c==="RGBA"?(p=0,m=g,y=g*2,v=g*3):c==="RGB"?(p=0,m=g,y=g*2):c==="RBG"&&(p=0,y=g,m=g*2);for(let T=0;T<o;T++)for(let O=0;O<i;O++){const E=(e.data[p++]-h[0])*u[0],S=(e.data[m++]-h[1])*u[1],D=(e.data[y++]-h[2])*u[2],I=v===-1?255:(e.data[v++]-h[3])*u[3];s.fillStyle="rgba("+E+","+S+","+D+","+I+")",s.fillRect(O,T,1,1)}if("toDataURL"in n)return n.toDataURL();throw new Error("toDataURL is not supported")}else throw new Error("Can not access image data")},hk=(e,t)=>{const n=typeof document<"u"?document.createElement("canvas").getContext("2d"):new OffscreenCanvas(1,1).getContext("2d");let s;if(n!=null){let i,o,c;(t==null?void 0:t.tensorLayout)!==void 0&&t.tensorLayout==="NHWC"?(i=e.dims[2],o=e.dims[1],c=e.dims[3]):(i=e.dims[3],o=e.dims[2],c=e.dims[1]);const d=t!==void 0&&t.format!==void 0?t.format:"RGB",u=t==null?void 0:t.norm;let h,g;u===void 0||u.mean===void 0?h=[255,255,255,255]:typeof u.mean=="number"?h=[u.mean,u.mean,u.mean,u.mean]:(h=[u.mean[0],u.mean[1],u.mean[2],255],u.mean[3]!==void 0&&(h[3]=u.mean[3])),u===void 0||u.bias===void 0?g=[0,0,0,0]:typeof u.bias=="number"?g=[u.bias,u.bias,u.bias,u.bias]:(g=[u.bias[0],u.bias[1],u.bias[2],0],u.bias[3]!==void 0&&(g[3]=u.bias[3]));const p=o*i;if(t!==void 0&&(t.format!==void 0&&c===4&&t.format!=="RGBA"||c===3&&t.format!=="RGB"&&t.format!=="BGR"))throw new Error("Tensor format doesn't match input tensor dims");const m=4;let y=0,v=1,T=2,O=3,E=0,S=p,D=p*2,I=-1;d==="RGBA"?(E=0,S=p,D=p*2,I=p*3):d==="RGB"?(E=0,S=p,D=p*2):d==="RBG"&&(E=0,D=p,S=p*2),s=n.createImageData(i,o);for(let M=0;M<o*i;y+=m,v+=m,T+=m,O+=m,M++)s.data[y]=(e.data[E++]-g[0])*h[0],s.data[v]=(e.data[S++]-g[1])*h[1],s.data[T]=(e.data[D++]-g[2])*h[2],s.data[O]=I===-1?255:(e.data[I++]-g[3])*h[3]}else throw new Error("Can not access image data");return s},H_=(e,t)=>{if(e===void 0)throw new Error("Image buffer must be defined");if(t.height===void 0||t.width===void 0)throw new Error("Image height and width must be defined");if(t.tensorLayout==="NHWC")throw new Error("NHWC Tensor layout is not supported yet");const{height:n,width:s}=t,i=t.norm??{mean:255,bias:0};let o,c;typeof i.mean=="number"?o=[i.mean,i.mean,i.mean,i.mean]:o=[i.mean[0],i.mean[1],i.mean[2],i.mean[3]??255],typeof i.bias=="number"?c=[i.bias,i.bias,i.bias,i.bias]:c=[i.bias[0],i.bias[1],i.bias[2],i.bias[3]??0];const d=t.format!==void 0?t.format:"RGBA",u=t.tensorFormat!==void 0&&t.tensorFormat!==void 0?t.tensorFormat:"RGB",h=n*s,g=u==="RGBA"?new Float32Array(h*4):new Float32Array(h*3);let p=4,m=0,y=1,v=2,T=3,O=0,E=h,S=h*2,D=-1;d==="RGB"&&(p=3,m=0,y=1,v=2,T=-1),u==="RGBA"?D=h*3:u==="RBG"?(O=0,S=h,E=h*2):u==="BGR"&&(S=0,E=h,O=h*2);for(let M=0;M<h;M++,m+=p,v+=p,y+=p,T+=p)g[O++]=(e[m]+c[0])/o[0],g[E++]=(e[y]+c[1])/o[1],g[S++]=(e[v]+c[2])/o[2],D!==-1&&T!==-1&&(g[D++]=(e[T]+c[3])/o[3]);return u==="RGBA"?new Zs("float32",g,[1,4,n,s]):new Zs("float32",g,[1,3,n,s])},pk=async(e,t)=>{const n=typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement,s=typeof ImageData<"u"&&e instanceof ImageData,i=typeof ImageBitmap<"u"&&e instanceof ImageBitmap,o=typeof e=="string";let c,d=t??{};const u=()=>{if(typeof document<"u")return document.createElement("canvas");if(typeof OffscreenCanvas<"u")return new OffscreenCanvas(1,1);throw new Error("Canvas is not supported")},h=g=>typeof HTMLCanvasElement<"u"&&g instanceof HTMLCanvasElement||g instanceof OffscreenCanvas?g.getContext("2d"):null;if(n){const g=u();g.width=e.width,g.height=e.height;const p=h(g);if(p!=null){let m=e.height,y=e.width;if(t!==void 0&&t.resizedHeight!==void 0&&t.resizedWidth!==void 0&&(m=t.resizedHeight,y=t.resizedWidth),t!==void 0){if(d=t,t.tensorFormat!==void 0)throw new Error("Image input config format must be RGBA for HTMLImageElement");d.tensorFormat="RGBA",d.height=m,d.width=y}else d.tensorFormat="RGBA",d.height=m,d.width=y;p.drawImage(e,0,0),c=p.getImageData(0,0,y,m).data}else throw new Error("Can not access image data")}else if(s){let g,p;if(t!==void 0&&t.resizedWidth!==void 0&&t.resizedHeight!==void 0?(g=t.resizedHeight,p=t.resizedWidth):(g=e.height,p=e.width),t!==void 0&&(d=t),d.format="RGBA",d.height=g,d.width=p,t!==void 0){const m=u();m.width=p,m.height=g;const y=h(m);if(y!=null)y.putImageData(e,0,0),c=y.getImageData(0,0,p,g).data;else throw new Error("Can not access image data")}else c=e.data}else if(i){if(t===void 0)throw new Error("Please provide image config with format for Imagebitmap");const g=u();g.width=e.width,g.height=e.height;const p=h(g);if(p!=null){const m=e.height,y=e.width;return p.drawImage(e,0,0,y,m),c=p.getImageData(0,0,y,m).data,d.height=m,d.width=y,H_(c,d)}else throw new Error("Can not access image data")}else{if(o)return new Promise((g,p)=>{const m=u(),y=h(m);if(!e||!y)return p();const v=new Image;v.crossOrigin="Anonymous",v.src=e,v.onload=()=>{m.width=v.width,m.height=v.height,y.drawImage(v,0,0,m.width,m.height);const T=y.getImageData(0,0,m.width,m.height);d.height=m.height,d.width=m.width,g(H_(T.data,d))}});throw new Error("Input data provided is not supported - aborted tensor creation")}if(c!==void 0)return H_(c,d);throw new Error("Input data provided is not supported - aborted tensor creation")},mk=(e,t)=>{const{width:n,height:s,download:i,dispose:o}=t,c=[1,s,n,4];return new Zs({location:"texture",type:"float32",texture:e,dims:c,download:i,dispose:o})},gk=(e,t)=>{const{dataType:n,dims:s,download:i,dispose:o}=t;return new Zs({location:"gpu-buffer",type:n??"float32",gpuBuffer:e,dims:s,download:i,dispose:o})},_k=(e,t)=>{const{dataType:n,dims:s,download:i,dispose:o}=t;return new Zs({location:"ml-tensor",type:n??"float32",mlTensor:e,dims:s,download:i,dispose:o})},vk=(e,t,n)=>new Zs({location:"cpu-pinned",type:e,data:t,dims:n??[t.length]}),mf=new Map([["float32",Float32Array],["uint8",Uint8Array],["int8",Int8Array],["uint16",Uint16Array],["int16",Int16Array],["int32",Int32Array],["bool",Uint8Array],["float64",Float64Array],["uint32",Uint32Array],["int4",Uint8Array],["uint4",Uint8Array]]),zg=new Map([[Float32Array,"float32"],[Uint8Array,"uint8"],[Int8Array,"int8"],[Uint16Array,"uint16"],[Int16Array,"int16"],[Int32Array,"int32"],[Float64Array,"float64"],[Uint32Array,"uint32"]]);let Nb=!1;const yk=()=>{if(!Nb){Nb=!0;const e=typeof BigInt64Array<"u"&&BigInt64Array.from,t=typeof BigUint64Array<"u"&&BigUint64Array.from,n=globalThis.Float16Array,s=typeof n<"u"&&n.from;e&&(mf.set("int64",BigInt64Array),zg.set(BigInt64Array,"int64")),t&&(mf.set("uint64",BigUint64Array),zg.set(BigUint64Array,"uint64")),s?(mf.set("float16",n),zg.set(n,"float16")):mf.set("float16",Uint16Array)}},bk=e=>{let t=1;for(let n=0;n<e.length;n++){const s=e[n];if(typeof s!="number"||!Number.isSafeInteger(s))throw new TypeError(`dims[${n}] must be an integer, got: ${s}`);if(s<0)throw new RangeError(`dims[${n}] must be a non-negative integer, got: ${s}`);t*=s}return t},wk=(e,t)=>{switch(e.location){case"cpu":return new Zs(e.type,e.data,t);case"cpu-pinned":return new Zs({location:"cpu-pinned",data:e.data,type:e.type,dims:t});case"texture":return new Zs({location:"texture",texture:e.texture,type:e.type,dims:t});case"gpu-buffer":return new Zs({location:"gpu-buffer",gpuBuffer:e.gpuBuffer,type:e.type,dims:t});case"ml-tensor":return new Zs({location:"ml-tensor",mlTensor:e.mlTensor,type:e.type,dims:t});default:throw new Error(`tensorReshape: tensor location ${e.location} is not supported`)}};let Zs=class{constructor(t,n,s){yk();let i,o;if(typeof t=="object"&&"location"in t)switch(this.dataLocation=t.location,i=t.type,o=t.dims,t.location){case"cpu-pinned":{const d=mf.get(i);if(!d)throw new TypeError(`unsupported type "${i}" to create tensor from pinned buffer`);if(!(t.data instanceof d))throw new TypeError(`buffer should be of type ${d.name}`);this.cpuData=t.data;break}case"texture":{if(i!=="float32")throw new TypeError(`unsupported type "${i}" to create tensor from texture`);this.gpuTextureData=t.texture,this.downloader=t.download,this.disposer=t.dispose;break}case"gpu-buffer":{if(i!=="float32"&&i!=="float16"&&i!=="int32"&&i!=="int64"&&i!=="uint32"&&i!=="uint8"&&i!=="bool"&&i!=="uint4"&&i!=="int4")throw new TypeError(`unsupported type "${i}" to create tensor from gpu buffer`);this.gpuBufferData=t.gpuBuffer,this.downloader=t.download,this.disposer=t.dispose;break}case"ml-tensor":{if(i!=="float32"&&i!=="float16"&&i!=="int32"&&i!=="int64"&&i!=="uint32"&&i!=="uint64"&&i!=="int8"&&i!=="uint8"&&i!=="bool"&&i!=="uint4"&&i!=="int4")throw new TypeError(`unsupported type "${i}" to create tensor from MLTensor`);this.mlTensorData=t.mlTensor,this.downloader=t.download,this.disposer=t.dispose;break}default:throw new Error(`Tensor constructor: unsupported location '${this.dataLocation}'`)}else{let d,u;if(typeof t=="string")if(i=t,u=s,t==="string"){if(!Array.isArray(n))throw new TypeError("A string tensor's data must be a string array.");d=n}else{const h=mf.get(t);if(h===void 0)throw new TypeError(`Unsupported tensor type: ${t}.`);if(Array.isArray(n)){if(t==="float16"&&h===Uint16Array||t==="uint4"||t==="int4")throw new TypeError(`Creating a ${t} tensor from number array is not supported. Please use ${h.name} as data.`);t==="uint64"||t==="int64"?d=h.from(n,BigInt):d=h.from(n)}else if(n instanceof h)d=n;else if(n instanceof Uint8ClampedArray)if(t==="uint8")d=Uint8Array.from(n);else throw new TypeError("A Uint8ClampedArray tensor's data must be type of uint8");else if(t==="float16"&&n instanceof Uint16Array&&h!==Uint16Array)d=new globalThis.Float16Array(n.buffer,n.byteOffset,n.length);else throw new TypeError(`A ${i} tensor's data must be type of ${h}`)}else if(u=n,Array.isArray(t)){if(t.length===0)throw new TypeError("Tensor type cannot be inferred from an empty array.");const h=typeof t[0];if(h==="string")i="string",d=t;else if(h==="boolean")i="bool",d=Uint8Array.from(t);else throw new TypeError(`Invalid element type of data array: ${h}.`)}else if(t instanceof Uint8ClampedArray)i="uint8",d=Uint8Array.from(t);else{const h=zg.get(t.constructor);if(h===void 0)throw new TypeError(`Unsupported type for tensor data: ${t.constructor}.`);i=h,d=t}if(u===void 0)u=[d.length];else if(!Array.isArray(u))throw new TypeError("A tensor's dims must be a number array");o=u,this.cpuData=d,this.dataLocation="cpu"}const c=bk(o);if(this.cpuData&&c!==this.cpuData.length&&!((i==="uint4"||i==="int4")&&Math.ceil(c/2)===this.cpuData.length))throw new Error(`Tensor's size(${c}) does not match data length(${this.cpuData.length}).`);this.type=i,this.dims=o,this.size=c}static async fromImage(t,n){return pk(t,n)}static fromTexture(t,n){return mk(t,n)}static fromGpuBuffer(t,n){return gk(t,n)}static fromMLTensor(t,n){return _k(t,n)}static fromPinnedBuffer(t,n,s){return vk(t,n,s)}toDataURL(t){return fk(this,t)}toImageData(t){return hk(this,t)}get data(){if(this.ensureValid(),!this.cpuData)throw new Error("The data is not on CPU. Use `getData()` to download GPU data to CPU, or use `texture` or `gpuBuffer` property to access the GPU data directly.");return this.cpuData}get location(){return this.dataLocation}get texture(){if(this.ensureValid(),!this.gpuTextureData)throw new Error("The data is not stored as a WebGL texture.");return this.gpuTextureData}get gpuBuffer(){if(this.ensureValid(),!this.gpuBufferData)throw new Error("The data is not stored as a WebGPU buffer.");return this.gpuBufferData}get mlTensor(){if(this.ensureValid(),!this.mlTensorData)throw new Error("The data is not stored as a WebNN MLTensor.");return this.mlTensorData}async getData(t){switch(this.ensureValid(),this.dataLocation){case"cpu":case"cpu-pinned":return this.data;case"texture":case"gpu-buffer":case"ml-tensor":{if(!this.downloader)throw new Error("The current tensor is not created with a specified data downloader.");if(this.isDownloading)throw new Error("The current tensor is being downloaded.");try{this.isDownloading=!0;const n=await this.downloader();return this.downloader=void 0,this.dataLocation="cpu",this.cpuData=n,t&&this.disposer&&(this.disposer(),this.disposer=void 0),n}finally{this.isDownloading=!1}}default:throw new Error(`cannot get data from location: ${this.dataLocation}`)}}dispose(){if(this.isDownloading)throw new Error("The current tensor is being downloaded.");this.disposer&&(this.disposer(),this.disposer=void 0),this.cpuData=void 0,this.gpuTextureData=void 0,this.gpuBufferData=void 0,this.mlTensorData=void 0,this.downloader=void 0,this.isDownloading=void 0,this.dataLocation="none"}ensureValid(){if(this.dataLocation==="none")throw new Error("The tensor is disposed.")}reshape(t){if(this.ensureValid(),this.downloader||this.disposer)throw new Error("Cannot reshape a tensor that owns GPU resource.");return wk(this,t)}};const hf=Zs,x2=(e,t)=>{(typeof Ia.trace>"u"?!Ia.wasm.trace:!Ia.trace)||console.timeStamp(`${e}::ORT::${t}`)},E2=(e,t)=>{var i;const n=((i=new Error().stack)==null?void 0:i.split(/\r\n|\r|\n/g))||[];let s=!1;for(let o=0;o<n.length;o++){if(s&&!n[o].includes("TRACE_FUNC")){let c=`FUNC_${e}::${n[o].trim().split(" ")[1]}`;t&&(c+=`::${t}`),x2("CPU",c);return}n[o].includes("TRACE_FUNC")&&(s=!0)}},cv=e=>{(typeof Ia.trace>"u"?!Ia.wasm.trace:!Ia.trace)||E2("BEGIN",e)},uv=e=>{(typeof Ia.trace>"u"?!Ia.wasm.trace:!Ia.trace)||E2("END",e)},dv=e=>{(typeof Ia.trace>"u"?!Ia.wasm.trace:!Ia.trace)||console.time(`ORT::${e}`)},fv=e=>{(typeof Ia.trace>"u"?!Ia.wasm.trace:!Ia.trace)||console.timeEnd(`ORT::${e}`)};let Mk=class T2{constructor(t){this.handler=t}async run(t,n,s){cv(),dv("InferenceSession.run");const i={};let o={};if(typeof t!="object"||t===null||t instanceof hf||Array.isArray(t))throw new TypeError("'feeds' must be an object that use input names as keys and OnnxValue as corresponding values.");let c=!0;if(typeof n=="object"){if(n===null)throw new TypeError("Unexpected argument[1]: cannot be null.");if(n instanceof hf)throw new TypeError("'fetches' cannot be a Tensor");if(Array.isArray(n)){if(n.length===0)throw new TypeError("'fetches' cannot be an empty array.");c=!1;for(const h of n){if(typeof h!="string")throw new TypeError("'fetches' must be a string array or an object.");if(this.outputNames.indexOf(h)===-1)throw new RangeError(`'fetches' contains invalid output name: ${h}.`);i[h]=null}if(typeof s=="object"&&s!==null)o=s;else if(typeof s<"u")throw new TypeError("'options' must be an object.")}else{let h=!1;const g=Object.getOwnPropertyNames(n);for(const p of this.outputNames)if(g.indexOf(p)!==-1){const m=n[p];(m===null||m instanceof hf)&&(h=!0,c=!1,i[p]=m)}if(h){if(typeof s=="object"&&s!==null)o=s;else if(typeof s<"u")throw new TypeError("'options' must be an object.")}else o=n}}else if(typeof n<"u")throw new TypeError("Unexpected argument[1]: must be 'fetches' or 'options'.");for(const h of this.inputNames)if(typeof t[h]>"u")throw new Error(`input '${h}' is missing in 'feeds'.`);if(c)for(const h of this.outputNames)i[h]=null;const d=await this.handler.run(t,i,o),u={};for(const h in d)if(Object.hasOwnProperty.call(d,h)){const g=d[h];g instanceof hf?u[h]=g:u[h]=new hf(g.type,g.data,g.dims)}return fv("InferenceSession.run"),uv(),u}async release(){return this.handler.dispose()}static async create(t,n,s,i){cv(),dv("InferenceSession.create");let o,c={};if(typeof t=="string"){if(o=t,typeof n=="object"&&n!==null)c=n;else if(typeof n<"u")throw new TypeError("'options' must be an object.")}else if(t instanceof Uint8Array){if(o=t,typeof n=="object"&&n!==null)c=n;else if(typeof n<"u")throw new TypeError("'options' must be an object.")}else if(t instanceof ArrayBuffer||typeof SharedArrayBuffer<"u"&&t instanceof SharedArrayBuffer){const g=t;let p=0,m=t.byteLength;if(typeof n=="object"&&n!==null)c=n;else if(typeof n=="number"){if(p=n,!Number.isSafeInteger(p))throw new RangeError("'byteOffset' must be an integer.");if(p<0||p>=g.byteLength)throw new RangeError(`'byteOffset' is out of range [0, ${g.byteLength}).`);if(m=t.byteLength-p,typeof s=="number"){if(m=s,!Number.isSafeInteger(m))throw new RangeError("'byteLength' must be an integer.");if(m<=0||p+m>g.byteLength)throw new RangeError(`'byteLength' is out of range (0, ${g.byteLength-p}].`);if(typeof i=="object"&&i!==null)c=i;else if(typeof i<"u")throw new TypeError("'options' must be an object.")}else if(typeof s<"u")throw new TypeError("'byteLength' must be a number.")}else if(typeof n<"u")throw new TypeError("'options' must be an object.");o=new Uint8Array(g,p,m)}else throw new TypeError("Unexpected argument[0]: must be 'path' or 'buffer'.");const[d,u]=await ck(c),h=await d.createInferenceSessionHandler(o,u);return fv("InferenceSession.create"),uv(),new T2(h)}startProfiling(){this.handler.startProfiling()}endProfiling(){this.handler.endProfiling()}get inputNames(){return this.handler.inputNames}get outputNames(){return this.handler.outputNames}get inputMetadata(){return this.handler.inputMetadata}get outputMetadata(){return this.handler.outputMetadata}};const xk=Mk,Ek=Object.freeze(Object.defineProperty({__proto__:null,InferenceSession:xk,TRACE:x2,TRACE_EVENT_BEGIN:dv,TRACE_EVENT_END:fv,TRACE_FUNC_BEGIN:cv,TRACE_FUNC_END:uv,Tensor:hf,env:dk,registerBackend:ok},Symbol.toStringTag,{value:"Module"}));/*!
 * ONNX Runtime Web v1.22.0-dev.20250409-89f8206ba4
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Licensed under the MIT License.
 */var Wv=Object.defineProperty,Tk=Object.getOwnPropertyDescriptor,Ak=Object.getOwnPropertyNames,Ck=Object.prototype.hasOwnProperty,Sk=(e=>typeof require<"u"?require:typeof Proxy<"u"?new Proxy(e,{get:(t,n)=>(typeof require<"u"?require:t)[n]}):e)(function(e){if(typeof require<"u")return require.apply(this,arguments);throw Error('Dynamic require of "'+e+'" is not supported')}),mt=(e,t)=>()=>(e&&(t=e(e=0)),t),Ef=(e,t)=>{for(var n in t)Wv(e,n,{get:t[n],enumerable:!0})},Ik=(e,t,n,s)=>{if(t&&typeof t=="object"||typeof t=="function")for(let i of Ak(t))!Ck.call(e,i)&&i!==n&&Wv(e,i,{get:()=>t[i],enumerable:!(s=Tk(t,i))||s.enumerable});return e},hm=e=>Ik(Wv({},"__esModule",{value:!0}),e),Hp,ac,yu,Rb,A2,C2=mt(()=>{Hp=new Map,ac=[],yu=(e,t,n)=>{if(t&&typeof t.init=="function"&&typeof t.createInferenceSessionHandler=="function"){let s=Hp.get(e);if(s===void 0)Hp.set(e,{backend:t,priority:n});else{if(s.priority>n)return;if(s.priority===n&&s.backend!==t)throw new Error(`cannot register backend "${e}" using priority ${n}`)}if(n>=0){let i=ac.indexOf(e);i!==-1&&ac.splice(i,1);for(let o=0;o<ac.length;o++)if(Hp.get(ac[o]).priority<=n){ac.splice(o,0,e);return}ac.push(e)}return}throw new TypeError("not a valid backend")},Rb=async e=>{let t=Hp.get(e);if(!t)return"backend not found.";if(t.initialized)return t.backend;if(t.aborted)return t.error;{let n=!!t.initPromise;try{return n||(t.initPromise=t.backend.init(e)),await t.initPromise,t.initialized=!0,t.backend}catch(s){return n||(t.error=`${s}`,t.aborted=!0),t.error}finally{delete t.initPromise}}},A2=async e=>{let t=e.executionProviders||[],n=t.map(u=>typeof u=="string"?u:u.name),s=n.length===0?ac:n,i,o=[],c=new Set;for(let u of s){let h=await Rb(u);typeof h=="string"?o.push({name:u,err:h}):(i||(i=h),i===h&&c.add(u))}if(!i)throw new Error(`no available backend found. ERR: ${o.map(u=>`[${u.name}] ${u.err}`).join(", ")}`);for(let{name:u,err:h}of o)n.includes(u)&&console.warn(`removing requested execution provider "${u}" from session options because it is not available: ${h}`);let d=t.filter(u=>c.has(typeof u=="string"?u:u.name));return[i,new Proxy(e,{get:(u,h)=>h==="executionProviders"?d:Reflect.get(u,h)})]}}),Pk=mt(()=>{C2()}),S2,kk=mt(()=>{S2="1.22.0-dev.20250409-89f8206ba4"}),Q_,Js,I2=mt(()=>{kk(),Q_="warning",Js={wasm:{},webgl:{},webgpu:{},versions:{common:S2},set logLevel(e){if(e!==void 0){if(typeof e!="string"||["verbose","info","warning","error","fatal"].indexOf(e)===-1)throw new Error(`Unsupported logging level: ${e}`);Q_=e}},get logLevel(){return Q_}},Object.defineProperty(Js,"logLevel",{enumerable:!0})}),br,Dk=mt(()=>{I2(),br=Js}),P2,k2,Ok=mt(()=>{P2=(e,t)=>{let n=typeof document<"u"?document.createElement("canvas"):new OffscreenCanvas(1,1);n.width=e.dims[3],n.height=e.dims[2];let s=n.getContext("2d");if(s!=null){let i,o;(t==null?void 0:t.tensorLayout)!==void 0&&t.tensorLayout==="NHWC"?(i=e.dims[2],o=e.dims[3]):(i=e.dims[3],o=e.dims[2]);let c=(t==null?void 0:t.format)!==void 0?t.format:"RGB",d=t==null?void 0:t.norm,u,h;d===void 0||d.mean===void 0?u=[255,255,255,255]:typeof d.mean=="number"?u=[d.mean,d.mean,d.mean,d.mean]:(u=[d.mean[0],d.mean[1],d.mean[2],0],d.mean[3]!==void 0&&(u[3]=d.mean[3])),d===void 0||d.bias===void 0?h=[0,0,0,0]:typeof d.bias=="number"?h=[d.bias,d.bias,d.bias,d.bias]:(h=[d.bias[0],d.bias[1],d.bias[2],0],d.bias[3]!==void 0&&(h[3]=d.bias[3]));let g=o*i,p=0,m=g,y=g*2,v=-1;c==="RGBA"?(p=0,m=g,y=g*2,v=g*3):c==="RGB"?(p=0,m=g,y=g*2):c==="RBG"&&(p=0,y=g,m=g*2);for(let T=0;T<o;T++)for(let O=0;O<i;O++){let E=(e.data[p++]-h[0])*u[0],S=(e.data[m++]-h[1])*u[1],D=(e.data[y++]-h[2])*u[2],I=v===-1?255:(e.data[v++]-h[3])*u[3];s.fillStyle="rgba("+E+","+S+","+D+","+I+")",s.fillRect(O,T,1,1)}if("toDataURL"in n)return n.toDataURL();throw new Error("toDataURL is not supported")}else throw new Error("Can not access image data")},k2=(e,t)=>{let n=typeof document<"u"?document.createElement("canvas").getContext("2d"):new OffscreenCanvas(1,1).getContext("2d"),s;if(n!=null){let i,o,c;(t==null?void 0:t.tensorLayout)!==void 0&&t.tensorLayout==="NHWC"?(i=e.dims[2],o=e.dims[1],c=e.dims[3]):(i=e.dims[3],o=e.dims[2],c=e.dims[1]);let d=t!==void 0&&t.format!==void 0?t.format:"RGB",u=t==null?void 0:t.norm,h,g;u===void 0||u.mean===void 0?h=[255,255,255,255]:typeof u.mean=="number"?h=[u.mean,u.mean,u.mean,u.mean]:(h=[u.mean[0],u.mean[1],u.mean[2],255],u.mean[3]!==void 0&&(h[3]=u.mean[3])),u===void 0||u.bias===void 0?g=[0,0,0,0]:typeof u.bias=="number"?g=[u.bias,u.bias,u.bias,u.bias]:(g=[u.bias[0],u.bias[1],u.bias[2],0],u.bias[3]!==void 0&&(g[3]=u.bias[3]));let p=o*i;if(t!==void 0&&(t.format!==void 0&&c===4&&t.format!=="RGBA"||c===3&&t.format!=="RGB"&&t.format!=="BGR"))throw new Error("Tensor format doesn't match input tensor dims");let m=4,y=0,v=1,T=2,O=3,E=0,S=p,D=p*2,I=-1;d==="RGBA"?(E=0,S=p,D=p*2,I=p*3):d==="RGB"?(E=0,S=p,D=p*2):d==="RBG"&&(E=0,D=p,S=p*2),s=n.createImageData(i,o);for(let M=0;M<o*i;y+=m,v+=m,T+=m,O+=m,M++)s.data[y]=(e.data[E++]-g[0])*h[0],s.data[v]=(e.data[S++]-g[1])*h[1],s.data[T]=(e.data[D++]-g[2])*h[2],s.data[O]=I===-1?255:(e.data[I++]-g[3])*h[3]}else throw new Error("Can not access image data");return s}}),gg,D2,O2,$2,B2,L2,$k=mt(()=>{Hv(),gg=(e,t)=>{if(e===void 0)throw new Error("Image buffer must be defined");if(t.height===void 0||t.width===void 0)throw new Error("Image height and width must be defined");if(t.tensorLayout==="NHWC")throw new Error("NHWC Tensor layout is not supported yet");let{height:n,width:s}=t,i=t.norm??{mean:255,bias:0},o,c;typeof i.mean=="number"?o=[i.mean,i.mean,i.mean,i.mean]:o=[i.mean[0],i.mean[1],i.mean[2],i.mean[3]??255],typeof i.bias=="number"?c=[i.bias,i.bias,i.bias,i.bias]:c=[i.bias[0],i.bias[1],i.bias[2],i.bias[3]??0];let d=t.format!==void 0?t.format:"RGBA",u=t.tensorFormat!==void 0&&t.tensorFormat!==void 0?t.tensorFormat:"RGB",h=n*s,g=u==="RGBA"?new Float32Array(h*4):new Float32Array(h*3),p=4,m=0,y=1,v=2,T=3,O=0,E=h,S=h*2,D=-1;d==="RGB"&&(p=3,m=0,y=1,v=2,T=-1),u==="RGBA"?D=h*3:u==="RBG"?(O=0,S=h,E=h*2):u==="BGR"&&(S=0,E=h,O=h*2);for(let I=0;I<h;I++,m+=p,v+=p,y+=p,T+=p)g[O++]=(e[m]+c[0])/o[0],g[E++]=(e[y]+c[1])/o[1],g[S++]=(e[v]+c[2])/o[2],D!==-1&&T!==-1&&(g[D++]=(e[T]+c[3])/o[3]);return u==="RGBA"?new Ds("float32",g,[1,4,n,s]):new Ds("float32",g,[1,3,n,s])},D2=async(e,t)=>{let n=typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement,s=typeof ImageData<"u"&&e instanceof ImageData,i=typeof ImageBitmap<"u"&&e instanceof ImageBitmap,o=typeof e=="string",c,d=t??{},u=()=>{if(typeof document<"u")return document.createElement("canvas");if(typeof OffscreenCanvas<"u")return new OffscreenCanvas(1,1);throw new Error("Canvas is not supported")},h=g=>typeof HTMLCanvasElement<"u"&&g instanceof HTMLCanvasElement||g instanceof OffscreenCanvas?g.getContext("2d"):null;if(n){let g=u();g.width=e.width,g.height=e.height;let p=h(g);if(p!=null){let m=e.height,y=e.width;if(t!==void 0&&t.resizedHeight!==void 0&&t.resizedWidth!==void 0&&(m=t.resizedHeight,y=t.resizedWidth),t!==void 0){if(d=t,t.tensorFormat!==void 0)throw new Error("Image input config format must be RGBA for HTMLImageElement");d.tensorFormat="RGBA",d.height=m,d.width=y}else d.tensorFormat="RGBA",d.height=m,d.width=y;p.drawImage(e,0,0),c=p.getImageData(0,0,y,m).data}else throw new Error("Can not access image data")}else if(s){let g,p;if(t!==void 0&&t.resizedWidth!==void 0&&t.resizedHeight!==void 0?(g=t.resizedHeight,p=t.resizedWidth):(g=e.height,p=e.width),t!==void 0&&(d=t),d.format="RGBA",d.height=g,d.width=p,t!==void 0){let m=u();m.width=p,m.height=g;let y=h(m);if(y!=null)y.putImageData(e,0,0),c=y.getImageData(0,0,p,g).data;else throw new Error("Can not access image data")}else c=e.data}else if(i){if(t===void 0)throw new Error("Please provide image config with format for Imagebitmap");let g=u();g.width=e.width,g.height=e.height;let p=h(g);if(p!=null){let m=e.height,y=e.width;return p.drawImage(e,0,0,y,m),c=p.getImageData(0,0,y,m).data,d.height=m,d.width=y,gg(c,d)}else throw new Error("Can not access image data")}else{if(o)return new Promise((g,p)=>{let m=u(),y=h(m);if(!e||!y)return p();let v=new Image;v.crossOrigin="Anonymous",v.src=e,v.onload=()=>{m.width=v.width,m.height=v.height,y.drawImage(v,0,0,m.width,m.height);let T=y.getImageData(0,0,m.width,m.height);d.height=m.height,d.width=m.width,g(gg(T.data,d))}});throw new Error("Input data provided is not supported - aborted tensor creation")}if(c!==void 0)return gg(c,d);throw new Error("Input data provided is not supported - aborted tensor creation")},O2=(e,t)=>{let{width:n,height:s,download:i,dispose:o}=t,c=[1,s,n,4];return new Ds({location:"texture",type:"float32",texture:e,dims:c,download:i,dispose:o})},$2=(e,t)=>{let{dataType:n,dims:s,download:i,dispose:o}=t;return new Ds({location:"gpu-buffer",type:n??"float32",gpuBuffer:e,dims:s,download:i,dispose:o})},B2=(e,t)=>{let{dataType:n,dims:s,download:i,dispose:o}=t;return new Ds({location:"ml-tensor",type:n??"float32",mlTensor:e,dims:s,download:i,dispose:o})},L2=(e,t,n)=>new Ds({location:"cpu-pinned",type:e,data:t,dims:n??[t.length]})}),gu,am,q_,F2,Bk=mt(()=>{gu=new Map([["float32",Float32Array],["uint8",Uint8Array],["int8",Int8Array],["uint16",Uint16Array],["int16",Int16Array],["int32",Int32Array],["bool",Uint8Array],["float64",Float64Array],["uint32",Uint32Array],["int4",Uint8Array],["uint4",Uint8Array]]),am=new Map([[Float32Array,"float32"],[Uint8Array,"uint8"],[Int8Array,"int8"],[Uint16Array,"uint16"],[Int16Array,"int16"],[Int32Array,"int32"],[Float64Array,"float64"],[Uint32Array,"uint32"]]),q_=!1,F2=()=>{if(!q_){q_=!0;let e=typeof BigInt64Array<"u"&&BigInt64Array.from,t=typeof BigUint64Array<"u"&&BigUint64Array.from,n=globalThis.Float16Array,s=typeof n<"u"&&n.from;e&&(gu.set("int64",BigInt64Array),am.set(BigInt64Array,"int64")),t&&(gu.set("uint64",BigUint64Array),am.set(BigUint64Array,"uint64")),s?(gu.set("float16",n),am.set(n,"float16")):gu.set("float16",Uint16Array)}}}),z2,N2,Lk=mt(()=>{Hv(),z2=e=>{let t=1;for(let n=0;n<e.length;n++){let s=e[n];if(typeof s!="number"||!Number.isSafeInteger(s))throw new TypeError(`dims[${n}] must be an integer, got: ${s}`);if(s<0)throw new RangeError(`dims[${n}] must be a non-negative integer, got: ${s}`);t*=s}return t},N2=(e,t)=>{switch(e.location){case"cpu":return new Ds(e.type,e.data,t);case"cpu-pinned":return new Ds({location:"cpu-pinned",data:e.data,type:e.type,dims:t});case"texture":return new Ds({location:"texture",texture:e.texture,type:e.type,dims:t});case"gpu-buffer":return new Ds({location:"gpu-buffer",gpuBuffer:e.gpuBuffer,type:e.type,dims:t});case"ml-tensor":return new Ds({location:"ml-tensor",mlTensor:e.mlTensor,type:e.type,dims:t});default:throw new Error(`tensorReshape: tensor location ${e.location} is not supported`)}}}),Ds,Hv=mt(()=>{Ok(),$k(),Bk(),Lk(),Ds=class{constructor(e,t,n){F2();let s,i;if(typeof e=="object"&&"location"in e)switch(this.dataLocation=e.location,s=e.type,i=e.dims,e.location){case"cpu-pinned":{let c=gu.get(s);if(!c)throw new TypeError(`unsupported type "${s}" to create tensor from pinned buffer`);if(!(e.data instanceof c))throw new TypeError(`buffer should be of type ${c.name}`);this.cpuData=e.data;break}case"texture":{if(s!=="float32")throw new TypeError(`unsupported type "${s}" to create tensor from texture`);this.gpuTextureData=e.texture,this.downloader=e.download,this.disposer=e.dispose;break}case"gpu-buffer":{if(s!=="float32"&&s!=="float16"&&s!=="int32"&&s!=="int64"&&s!=="uint32"&&s!=="uint8"&&s!=="bool"&&s!=="uint4"&&s!=="int4")throw new TypeError(`unsupported type "${s}" to create tensor from gpu buffer`);this.gpuBufferData=e.gpuBuffer,this.downloader=e.download,this.disposer=e.dispose;break}case"ml-tensor":{if(s!=="float32"&&s!=="float16"&&s!=="int32"&&s!=="int64"&&s!=="uint32"&&s!=="uint64"&&s!=="int8"&&s!=="uint8"&&s!=="bool"&&s!=="uint4"&&s!=="int4")throw new TypeError(`unsupported type "${s}" to create tensor from MLTensor`);this.mlTensorData=e.mlTensor,this.downloader=e.download,this.disposer=e.dispose;break}default:throw new Error(`Tensor constructor: unsupported location '${this.dataLocation}'`)}else{let c,d;if(typeof e=="string")if(s=e,d=n,e==="string"){if(!Array.isArray(t))throw new TypeError("A string tensor's data must be a string array.");c=t}else{let u=gu.get(e);if(u===void 0)throw new TypeError(`Unsupported tensor type: ${e}.`);if(Array.isArray(t)){if(e==="float16"&&u===Uint16Array||e==="uint4"||e==="int4")throw new TypeError(`Creating a ${e} tensor from number array is not supported. Please use ${u.name} as data.`);e==="uint64"||e==="int64"?c=u.from(t,BigInt):c=u.from(t)}else if(t instanceof u)c=t;else if(t instanceof Uint8ClampedArray)if(e==="uint8")c=Uint8Array.from(t);else throw new TypeError("A Uint8ClampedArray tensor's data must be type of uint8");else if(e==="float16"&&t instanceof Uint16Array&&u!==Uint16Array)c=new globalThis.Float16Array(t.buffer,t.byteOffset,t.length);else throw new TypeError(`A ${s} tensor's data must be type of ${u}`)}else if(d=t,Array.isArray(e)){if(e.length===0)throw new TypeError("Tensor type cannot be inferred from an empty array.");let u=typeof e[0];if(u==="string")s="string",c=e;else if(u==="boolean")s="bool",c=Uint8Array.from(e);else throw new TypeError(`Invalid element type of data array: ${u}.`)}else if(e instanceof Uint8ClampedArray)s="uint8",c=Uint8Array.from(e);else{let u=am.get(e.constructor);if(u===void 0)throw new TypeError(`Unsupported type for tensor data: ${e.constructor}.`);s=u,c=e}if(d===void 0)d=[c.length];else if(!Array.isArray(d))throw new TypeError("A tensor's dims must be a number array");i=d,this.cpuData=c,this.dataLocation="cpu"}let o=z2(i);if(this.cpuData&&o!==this.cpuData.length&&!((s==="uint4"||s==="int4")&&Math.ceil(o/2)===this.cpuData.length))throw new Error(`Tensor's size(${o}) does not match data length(${this.cpuData.length}).`);this.type=s,this.dims=i,this.size=o}static async fromImage(e,t){return D2(e,t)}static fromTexture(e,t){return O2(e,t)}static fromGpuBuffer(e,t){return $2(e,t)}static fromMLTensor(e,t){return B2(e,t)}static fromPinnedBuffer(e,t,n){return L2(e,t,n)}toDataURL(e){return P2(this,e)}toImageData(e){return k2(this,e)}get data(){if(this.ensureValid(),!this.cpuData)throw new Error("The data is not on CPU. Use `getData()` to download GPU data to CPU, or use `texture` or `gpuBuffer` property to access the GPU data directly.");return this.cpuData}get location(){return this.dataLocation}get texture(){if(this.ensureValid(),!this.gpuTextureData)throw new Error("The data is not stored as a WebGL texture.");return this.gpuTextureData}get gpuBuffer(){if(this.ensureValid(),!this.gpuBufferData)throw new Error("The data is not stored as a WebGPU buffer.");return this.gpuBufferData}get mlTensor(){if(this.ensureValid(),!this.mlTensorData)throw new Error("The data is not stored as a WebNN MLTensor.");return this.mlTensorData}async getData(e){switch(this.ensureValid(),this.dataLocation){case"cpu":case"cpu-pinned":return this.data;case"texture":case"gpu-buffer":case"ml-tensor":{if(!this.downloader)throw new Error("The current tensor is not created with a specified data downloader.");if(this.isDownloading)throw new Error("The current tensor is being downloaded.");try{this.isDownloading=!0;let t=await this.downloader();return this.downloader=void 0,this.dataLocation="cpu",this.cpuData=t,e&&this.disposer&&(this.disposer(),this.disposer=void 0),t}finally{this.isDownloading=!1}}default:throw new Error(`cannot get data from location: ${this.dataLocation}`)}}dispose(){if(this.isDownloading)throw new Error("The current tensor is being downloaded.");this.disposer&&(this.disposer(),this.disposer=void 0),this.cpuData=void 0,this.gpuTextureData=void 0,this.gpuBufferData=void 0,this.mlTensorData=void 0,this.downloader=void 0,this.isDownloading=void 0,this.dataLocation="none"}ensureValid(){if(this.dataLocation==="none")throw new Error("The tensor is disposed.")}reshape(e){if(this.ensureValid(),this.downloader||this.disposer)throw new Error("Cannot reshape a tensor that owns GPU resource.");return N2(this,e)}}}),Ci,R2=mt(()=>{Hv(),Ci=Ds}),pm,K_,Si,ei,j2=mt(()=>{I2(),pm=(e,t)=>{(typeof Js.trace>"u"?!Js.wasm.trace:!Js.trace)||console.timeStamp(`${e}::ORT::${t}`)},K_=(e,t)=>{var i;let n=((i=new Error().stack)==null?void 0:i.split(/\r\n|\r|\n/g))||[],s=!1;for(let o=0;o<n.length;o++){if(s&&!n[o].includes("TRACE_FUNC")){let c=`FUNC_${e}::${n[o].trim().split(" ")[1]}`;t&&(c+=`::${t}`),pm("CPU",c);return}n[o].includes("TRACE_FUNC")&&(s=!0)}},Si=e=>{(typeof Js.trace>"u"?!Js.wasm.trace:!Js.trace)||K_("BEGIN",e)},ei=e=>{(typeof Js.trace>"u"?!Js.wasm.trace:!Js.trace)||K_("END",e)}}),U2,Fk=mt(()=>{C2(),R2(),j2(),U2=class V2{constructor(t){this.handler=t}async run(t,n,s){Si();let i={},o={};if(typeof t!="object"||t===null||t instanceof Ci||Array.isArray(t))throw new TypeError("'feeds' must be an object that use input names as keys and OnnxValue as corresponding values.");let c=!0;if(typeof n=="object"){if(n===null)throw new TypeError("Unexpected argument[1]: cannot be null.");if(n instanceof Ci)throw new TypeError("'fetches' cannot be a Tensor");if(Array.isArray(n)){if(n.length===0)throw new TypeError("'fetches' cannot be an empty array.");c=!1;for(let h of n){if(typeof h!="string")throw new TypeError("'fetches' must be a string array or an object.");if(this.outputNames.indexOf(h)===-1)throw new RangeError(`'fetches' contains invalid output name: ${h}.`);i[h]=null}if(typeof s=="object"&&s!==null)o=s;else if(typeof s<"u")throw new TypeError("'options' must be an object.")}else{let h=!1,g=Object.getOwnPropertyNames(n);for(let p of this.outputNames)if(g.indexOf(p)!==-1){let m=n[p];(m===null||m instanceof Ci)&&(h=!0,c=!1,i[p]=m)}if(h){if(typeof s=="object"&&s!==null)o=s;else if(typeof s<"u")throw new TypeError("'options' must be an object.")}else o=n}}else if(typeof n<"u")throw new TypeError("Unexpected argument[1]: must be 'fetches' or 'options'.");for(let h of this.inputNames)if(typeof t[h]>"u")throw new Error(`input '${h}' is missing in 'feeds'.`);if(c)for(let h of this.outputNames)i[h]=null;let d=await this.handler.run(t,i,o),u={};for(let h in d)if(Object.hasOwnProperty.call(d,h)){let g=d[h];g instanceof Ci?u[h]=g:u[h]=new Ci(g.type,g.data,g.dims)}return ei(),u}async release(){return this.handler.dispose()}static async create(t,n,s,i){Si();let o,c={};if(typeof t=="string"){if(o=t,typeof n=="object"&&n!==null)c=n;else if(typeof n<"u")throw new TypeError("'options' must be an object.")}else if(t instanceof Uint8Array){if(o=t,typeof n=="object"&&n!==null)c=n;else if(typeof n<"u")throw new TypeError("'options' must be an object.")}else if(t instanceof ArrayBuffer||typeof SharedArrayBuffer<"u"&&t instanceof SharedArrayBuffer){let g=t,p=0,m=t.byteLength;if(typeof n=="object"&&n!==null)c=n;else if(typeof n=="number"){if(p=n,!Number.isSafeInteger(p))throw new RangeError("'byteOffset' must be an integer.");if(p<0||p>=g.byteLength)throw new RangeError(`'byteOffset' is out of range [0, ${g.byteLength}).`);if(m=t.byteLength-p,typeof s=="number"){if(m=s,!Number.isSafeInteger(m))throw new RangeError("'byteLength' must be an integer.");if(m<=0||p+m>g.byteLength)throw new RangeError(`'byteLength' is out of range (0, ${g.byteLength-p}].`);if(typeof i=="object"&&i!==null)c=i;else if(typeof i<"u")throw new TypeError("'options' must be an object.")}else if(typeof s<"u")throw new TypeError("'byteLength' must be a number.")}else if(typeof n<"u")throw new TypeError("'options' must be an object.");o=new Uint8Array(g,p,m)}else throw new TypeError("Unexpected argument[0]: must be 'path' or 'buffer'.");let[d,u]=await A2(c),h=await d.createInferenceSessionHandler(o,u);return ei(),new V2(h)}startProfiling(){this.handler.startProfiling()}endProfiling(){this.handler.endProfiling()}get inputNames(){return this.handler.inputNames}get outputNames(){return this.handler.outputNames}get inputMetadata(){return this.handler.inputMetadata}get outputMetadata(){return this.handler.outputMetadata}}}),Qv,zk=mt(()=>{Fk(),Qv=U2}),Nk=mt(()=>{}),Rk=mt(()=>{}),jk=mt(()=>{}),Uk=mt(()=>{}),G2={};Ef(G2,{InferenceSession:()=>Qv,TRACE:()=>pm,TRACE_FUNC_BEGIN:()=>Si,TRACE_FUNC_END:()=>ei,Tensor:()=>Ci,env:()=>br,registerBackend:()=>yu});var Ii=mt(()=>{Pk(),Dk(),zk(),R2(),Nk(),Rk(),j2(),jk(),Uk()}),qv=mt(()=>{}),W2={};Ef(W2,{default:()=>H2});var X_,Y_,H2,Vk=mt(()=>{var e;YA(),Au(),Kv(),X_="ort-wasm-proxy-worker",Y_=((e=globalThis.self)==null?void 0:e.name)===X_,Y_&&(self.onmessage=t=>{let{type:n,in:s}=t.data;try{switch(n){case"init-wasm":Xv(s.wasm).then(()=>{py(s).then(()=>{postMessage({type:n})},i=>{postMessage({type:n,err:i})})},i=>{postMessage({type:n,err:i})});break;case"init-ep":{let{epName:i,env:o}=s;my(o,i).then(()=>{postMessage({type:n})},c=>{postMessage({type:n,err:c})});break}case"copy-from":{let{buffer:i}=s,o=s_(i);postMessage({type:n,out:o});break}case"create":{let{model:i,options:o}=s;gy(i,o).then(c=>{postMessage({type:n,out:c})},c=>{postMessage({type:n,err:c})});break}case"release":_y(s),postMessage({type:n});break;case"run":{let{sessionId:i,inputIndices:o,inputs:c,outputIndices:d,options:u}=s;vy(i,o,c,d,new Array(d.length).fill(null),u).then(h=>{h.some(g=>g[3]!=="cpu")?postMessage({type:n,err:"Proxy does not support non-cpu tensor location."}):postMessage({type:n,out:h},by([...c,...h]))},h=>{postMessage({type:n,err:h})});break}case"end-profiling":yy(s),postMessage({type:n});break;default:}}catch(i){postMessage({type:n,err:i})}}),H2=Y_?null:t=>new Worker(t??ks,{type:"module",name:X_})}),Q2={};Ef(Q2,{default:()=>q2});var J_,Z_,q2,jb,Gk=mt(()=>{var e,t;Z_=(J_=import.meta.url,async function(n={}){var Mo;var s,i,o=n,c=new Promise((b,$)=>{s=b,i=$}),d=typeof window=="object",u=typeof WorkerGlobalScope<"u",h=u&&((Mo=self.name)==null?void 0:Mo.startsWith("em-pthread"));o.mountExternalData=(b,$)=>{b.startsWith("./")&&(b=b.substring(2)),(o.Eb||(o.Eb=new Map)).set(b,$)},o.unmountExternalData=()=>{delete o.Eb};var g=globalThis.SharedArrayBuffer??new WebAssembly.Memory({initial:0,maximum:0,pc:!0}).buffer.constructor;let p=b=>async(...$)=>{var W;try{if(o.Fb)throw Error("Session already started");let J=o.Fb={dc:$[0],errors:[]},ie=await b(...$);if(o.Fb!==J)throw Error("Session mismatch");(W=o.Jb)==null||W.flush();let Ee=J.errors;if(0<Ee.length){let Xe=await Promise.all(Ee);if(Xe=Xe.filter(ot=>ot),0<Xe.length)throw Error(Xe.join(`
`))}return ie}finally{o.Fb=null}};o.jsepInit=(b,$)=>{if(b==="webgpu"){[o.Jb,o.Ub,o.Yb,o.Kb,o.Xb,o.jb,o.Zb,o.ac,o.Vb,o.Wb,o.$b]=$;let W=o.Jb;o.jsepRegisterBuffer=(J,ie,Ee,Xe)=>W.registerBuffer(J,ie,Ee,Xe),o.jsepGetBuffer=J=>W.getBuffer(J),o.jsepCreateDownloader=(J,ie,Ee)=>W.createDownloader(J,ie,Ee),o.jsepOnCreateSession=J=>{W.onCreateSession(J)},o.jsepOnReleaseSession=J=>{W.onReleaseSession(J)},o.jsepOnRunStart=J=>W.onRunStart(J),o.bc=(J,ie)=>{W.upload(J,ie)}}else if(b==="webnn"){let W=$[0];[o.nc,o.Nb,o.webnnEnsureTensor,o.Ob,o.webnnDownloadTensor]=$.slice(1),o.webnnReleaseTensorId=o.Nb,o.webnnUploadTensor=o.Ob,o.webnnOnRunStart=J=>W.onRunStart(J),o.webnnOnRunEnd=W.onRunEnd.bind(W),o.webnnRegisterMLContext=(J,ie)=>{W.registerMLContext(J,ie)},o.webnnOnReleaseSession=J=>{W.onReleaseSession(J)},o.webnnCreateMLTensorDownloader=(J,ie)=>W.createMLTensorDownloader(J,ie),o.webnnRegisterMLTensor=(J,ie,Ee,Xe)=>W.registerMLTensor(J,ie,Ee,Xe),o.webnnCreateMLContext=J=>W.createMLContext(J),o.webnnRegisterMLConstant=(J,ie,Ee,Xe,ot,Mt)=>W.registerMLConstant(J,ie,Ee,Xe,ot,o.Eb,Mt),o.webnnRegisterGraphInput=W.registerGraphInput.bind(W),o.webnnIsGraphInput=W.isGraphInput.bind(W),o.webnnCreateTemporaryTensor=W.createTemporaryTensor.bind(W),o.webnnIsInt64Supported=W.isInt64Supported.bind(W)}};let m=()=>{let b=($,W,J)=>(...ie)=>{let Ee=Dr,Xe=W==null?void 0:W();ie=$(...ie);let ot=W==null?void 0:W();return Xe!==ot&&($=ot,J(Xe),W=J=null),Dr!=Ee?new Promise((Mt,St)=>{va={resolve:Mt,reject:St}}):ie};(()=>{for(let $ of["_OrtAppendExecutionProvider","_OrtCreateSession","_OrtRun","_OrtRunWithBinding","_OrtBindInput"])o[$]=b(o[$],()=>o[$],W=>o[$]=W)})(),p!==void 0&&(o._OrtRun=p(o._OrtRun),o._OrtRunWithBinding=p(o._OrtRunWithBinding)),m=void 0};o.asyncInit=()=>{m==null||m()};var y,v,T=Object.assign({},o),O=(b,$)=>{throw $},E="";(d||u)&&(u?E=self.location.href:typeof document<"u"&&document.currentScript&&(E=document.currentScript.src),J_&&(E=J_),E=E.startsWith("blob:")?"":E.slice(0,E.replace(/[?#].*/,"").lastIndexOf("/")+1),u&&(v=b=>{var $=new XMLHttpRequest;return $.open("GET",b,!1),$.responseType="arraybuffer",$.send(null),new Uint8Array($.response)}),y=async b=>{if(j(b))return new Promise((W,J)=>{var ie=new XMLHttpRequest;ie.open("GET",b,!0),ie.responseType="arraybuffer",ie.onload=()=>{ie.status==200||ie.status==0&&ie.response?W(ie.response):J(ie.status)},ie.onerror=J,ie.send(null)});var $=await fetch(b,{credentials:"same-origin"});if($.ok)return $.arrayBuffer();throw Error($.status+" : "+$.url)});var S=console.log.bind(console),D=console.error.bind(console),I=S,M=D;Object.assign(o,T),T=null;var C,A,k,R,G,te,ee,X,le,ae,Q,ne,de,ve=o.wasmBinary,fe=!1,j=b=>b.startsWith("file://");function U(){return C.buffer!=R.buffer&&H(),R}function N(){return C.buffer!=R.buffer&&H(),G}function q(){return C.buffer!=R.buffer&&H(),te}function ce(){return C.buffer!=R.buffer&&H(),ee}function Z(){return C.buffer!=R.buffer&&H(),X}function Me(){return C.buffer!=R.buffer&&H(),le}function Pe(){return C.buffer!=R.buffer&&H(),ae}function Ne(){return C.buffer!=R.buffer&&H(),de}if(h){let b=function($){try{var W=$.data,J=W.Bb;if(J==="load"){let ie=[];self.onmessage=Ee=>ie.push(Ee),self.startWorker=()=>{postMessage({Bb:"loaded"});for(let Ee of ie)b(Ee);self.onmessage=b};for(let Ee of W.Rb)o[Ee]&&!o[Ee].proxy||(o[Ee]=(...Xe)=>{postMessage({Bb:"callHandler",Qb:Ee,args:Xe})},Ee=="print"&&(I=o[Ee]),Ee=="printErr"&&(M=o[Ee]));C=W.kc,H(),Oe(W.lc)}else if(J==="run"){Wa(W.Ab),sa(W.Ab,0,0,1,0,0),ta(),Se(W.Ab),he||(wc(),he=!0);try{Vn(W.fc,W.Hb)}catch(ie){if(ie!="unwind")throw ie}}else W.target!=="setimmediate"&&(J==="checkMailbox"?he&&We():J&&(M(`worker: received unknown command ${J}`),M(W)))}catch(ie){throw Fs(),ie}};var Oe,he=!1;M=function(...$){$=$.join(" "),console.error($)},self.alert=function(...$){postMessage({Bb:"alert",text:$.join(" "),ic:_o()})},self.onunhandledrejection=$=>{throw $.reason||$},self.onmessage=b}function H(){var b=C.buffer;o.HEAP8=R=new Int8Array(b),o.HEAP16=te=new Int16Array(b),o.HEAPU8=G=new Uint8Array(b),o.HEAPU16=ee=new Uint16Array(b),o.HEAP32=X=new Int32Array(b),o.HEAPU32=le=new Uint32Array(b),o.HEAPF32=ae=new Float32Array(b),o.HEAPF64=de=new Float64Array(b),o.HEAP64=Q=new BigInt64Array(b),o.HEAPU64=ne=new BigUint64Array(b)}function Te(){h?startWorker(o):Bt.Ca()}h||(C=new WebAssembly.Memory({initial:256,maximum:65536,shared:!0}),H());var ze,Re=0,He=null;function Ke(){if(--Re==0&&He){var b=He;He=null,b()}}function Be(b){throw M(b="Aborted("+b+")"),fe=!0,b=new WebAssembly.RuntimeError(b+". Build with -sASSERTIONS for more info."),i(b),b}function nt(){return{a:{L:_t,Aa:qe,b:qr,$:Ft,A:Kr,pa:an,X:ue,Z:Y,qa:oe,na:pe,ga:Ce,ma:Ue,J:Ye,Y:ct,V:ft,oa:Tt,W:Et,va:Zt,E:nr,Q:Bs,O:Ka,D:Ar,u:ua,r:lt,P:ut,z:V,R:se,ja:me,T:ht,aa:yt,M:Ct,F:Vt,ia:Se,sa:un,t:Tn,Ba:lr,w:Ea,o:xr,l:aa,c:xa,n:Ls,j:lo,v:cc,p:ki,f:Su,s:Iu,m:sl,e:Pu,k:ku,i:Di,g:Du,d:Ou,da:uc,ea:$u,fa:ol,ba:ll,ca:hc,N:cl,xa:Tf,ua:mc,h:Lu,C:Fu,G:zu,ta:Bu,x:ul,ra:Oi,U:Nu,q:pc,y:dl,K:gc,S:_c,za:vc,ya:Ru,ka:$i,la:oi,_:Nt,B:ju,I:Bi,ha:ho,H:po,a:C,wa:rt}}}var $e={829644:(b,$,W,J,ie)=>{if(o===void 0||!o.Eb)return 1;if((b=Dn(Number(b>>>0))).startsWith("./")&&(b=b.substring(2)),!(b=o.Eb.get(b)))return 2;if($=Number($>>>0),W=Number(W>>>0),J=Number(J>>>0),$+W>b.byteLength)return 3;try{let Ee=b.subarray($,$+W);switch(ie){case 0:N().set(Ee,J>>>0);break;case 1:o.mc?o.mc(J,Ee):o.bc(J,Ee);break;default:return 4}return 0}catch{return 4}},830468:(b,$,W)=>{o.Ob(b,N().subarray($>>>0,$+W>>>0))},830532:()=>o.nc(),830574:b=>{o.Nb(b)},830611:()=>{o.Vb()},830642:()=>{o.Wb()},830671:()=>{o.$b()},830696:b=>o.Ub(b),830729:b=>o.Yb(b),830761:(b,$,W)=>{o.Kb(Number(b),Number($),Number(W),!0)},830824:(b,$,W)=>{o.Kb(Number(b),Number($),Number(W))},830881:()=>typeof wasmOffsetConverter<"u",830938:b=>{o.jb("Abs",b,void 0)},830989:b=>{o.jb("Neg",b,void 0)},831040:b=>{o.jb("Floor",b,void 0)},831093:b=>{o.jb("Ceil",b,void 0)},831145:b=>{o.jb("Reciprocal",b,void 0)},831203:b=>{o.jb("Sqrt",b,void 0)},831255:b=>{o.jb("Exp",b,void 0)},831306:b=>{o.jb("Erf",b,void 0)},831357:b=>{o.jb("Sigmoid",b,void 0)},831412:(b,$,W)=>{o.jb("HardSigmoid",b,{alpha:$,beta:W})},831491:b=>{o.jb("Log",b,void 0)},831542:b=>{o.jb("Sin",b,void 0)},831593:b=>{o.jb("Cos",b,void 0)},831644:b=>{o.jb("Tan",b,void 0)},831695:b=>{o.jb("Asin",b,void 0)},831747:b=>{o.jb("Acos",b,void 0)},831799:b=>{o.jb("Atan",b,void 0)},831851:b=>{o.jb("Sinh",b,void 0)},831903:b=>{o.jb("Cosh",b,void 0)},831955:b=>{o.jb("Asinh",b,void 0)},832008:b=>{o.jb("Acosh",b,void 0)},832061:b=>{o.jb("Atanh",b,void 0)},832114:b=>{o.jb("Tanh",b,void 0)},832166:b=>{o.jb("Not",b,void 0)},832217:(b,$,W)=>{o.jb("Clip",b,{min:$,max:W})},832286:b=>{o.jb("Clip",b,void 0)},832338:(b,$)=>{o.jb("Elu",b,{alpha:$})},832396:b=>{o.jb("Gelu",b,void 0)},832448:b=>{o.jb("Relu",b,void 0)},832500:(b,$)=>{o.jb("LeakyRelu",b,{alpha:$})},832564:(b,$)=>{o.jb("ThresholdedRelu",b,{alpha:$})},832634:(b,$)=>{o.jb("Cast",b,{to:$})},832692:b=>{o.jb("Add",b,void 0)},832743:b=>{o.jb("Sub",b,void 0)},832794:b=>{o.jb("Mul",b,void 0)},832845:b=>{o.jb("Div",b,void 0)},832896:b=>{o.jb("Pow",b,void 0)},832947:b=>{o.jb("Equal",b,void 0)},833e3:b=>{o.jb("Greater",b,void 0)},833055:b=>{o.jb("GreaterOrEqual",b,void 0)},833117:b=>{o.jb("Less",b,void 0)},833169:b=>{o.jb("LessOrEqual",b,void 0)},833228:(b,$,W,J,ie)=>{o.jb("ReduceMean",b,{keepDims:!!$,noopWithEmptyAxes:!!W,axes:J?Array.from(Z().subarray(Number(J)>>>0,Number(ie)>>>0)):[]})},833403:(b,$,W,J,ie)=>{o.jb("ReduceMax",b,{keepDims:!!$,noopWithEmptyAxes:!!W,axes:J?Array.from(Z().subarray(Number(J)>>>0,Number(ie)>>>0)):[]})},833577:(b,$,W,J,ie)=>{o.jb("ReduceMin",b,{keepDims:!!$,noopWithEmptyAxes:!!W,axes:J?Array.from(Z().subarray(Number(J)>>>0,Number(ie)>>>0)):[]})},833751:(b,$,W,J,ie)=>{o.jb("ReduceProd",b,{keepDims:!!$,noopWithEmptyAxes:!!W,axes:J?Array.from(Z().subarray(Number(J)>>>0,Number(ie)>>>0)):[]})},833926:(b,$,W,J,ie)=>{o.jb("ReduceSum",b,{keepDims:!!$,noopWithEmptyAxes:!!W,axes:J?Array.from(Z().subarray(Number(J)>>>0,Number(ie)>>>0)):[]})},834100:(b,$,W,J,ie)=>{o.jb("ReduceL1",b,{keepDims:!!$,noopWithEmptyAxes:!!W,axes:J?Array.from(Z().subarray(Number(J)>>>0,Number(ie)>>>0)):[]})},834273:(b,$,W,J,ie)=>{o.jb("ReduceL2",b,{keepDims:!!$,noopWithEmptyAxes:!!W,axes:J?Array.from(Z().subarray(Number(J)>>>0,Number(ie)>>>0)):[]})},834446:(b,$,W,J,ie)=>{o.jb("ReduceLogSum",b,{keepDims:!!$,noopWithEmptyAxes:!!W,axes:J?Array.from(Z().subarray(Number(J)>>>0,Number(ie)>>>0)):[]})},834623:(b,$,W,J,ie)=>{o.jb("ReduceSumSquare",b,{keepDims:!!$,noopWithEmptyAxes:!!W,axes:J?Array.from(Z().subarray(Number(J)>>>0,Number(ie)>>>0)):[]})},834803:(b,$,W,J,ie)=>{o.jb("ReduceLogSumExp",b,{keepDims:!!$,noopWithEmptyAxes:!!W,axes:J?Array.from(Z().subarray(Number(J)>>>0,Number(ie)>>>0)):[]})},834983:b=>{o.jb("Where",b,void 0)},835036:(b,$,W)=>{o.jb("Transpose",b,{perm:$?Array.from(Z().subarray(Number($)>>>0,Number(W)>>>0)):[]})},835160:(b,$,W,J)=>{o.jb("DepthToSpace",b,{blocksize:$,mode:Dn(W),format:J?"NHWC":"NCHW"})},835293:(b,$,W,J)=>{o.jb("DepthToSpace",b,{blocksize:$,mode:Dn(W),format:J?"NHWC":"NCHW"})},835426:(b,$,W,J,ie,Ee,Xe,ot,Mt,St,Rt,_n,dn,ur,gs)=>{o.jb("ConvTranspose",b,{format:Mt?"NHWC":"NCHW",autoPad:$,dilations:[W],group:J,kernelShape:[ie],pads:[Ee,Xe],strides:[ot],wIsConst:()=>!!U()[St>>>0],outputPadding:Rt?Array.from(Z().subarray(Number(Rt)>>>0,Number(_n)>>>0)):[],outputShape:dn?Array.from(Z().subarray(Number(dn)>>>0,Number(ur)>>>0)):[],activation:Dn(gs)})},835859:(b,$,W,J,ie,Ee,Xe,ot,Mt,St,Rt,_n,dn,ur)=>{o.jb("ConvTranspose",b,{format:ot?"NHWC":"NCHW",autoPad:$,dilations:Array.from(Z().subarray(Number(W)>>>0,2+(Number(W)>>>0)>>>0)),group:J,kernelShape:Array.from(Z().subarray(Number(ie)>>>0,2+(Number(ie)>>>0)>>>0)),pads:Array.from(Z().subarray(Number(Ee)>>>0,4+(Number(Ee)>>>0)>>>0)),strides:Array.from(Z().subarray(Number(Xe)>>>0,2+(Number(Xe)>>>0)>>>0)),wIsConst:()=>!!U()[Mt>>>0],outputPadding:St?Array.from(Z().subarray(Number(St)>>>0,Number(Rt)>>>0)):[],outputShape:_n?Array.from(Z().subarray(Number(_n)>>>0,Number(dn)>>>0)):[],activation:Dn(ur)})},836520:(b,$,W,J,ie,Ee,Xe,ot,Mt,St,Rt,_n,dn,ur,gs)=>{o.jb("ConvTranspose",b,{format:Mt?"NHWC":"NCHW",autoPad:$,dilations:[W],group:J,kernelShape:[ie],pads:[Ee,Xe],strides:[ot],wIsConst:()=>!!U()[St>>>0],outputPadding:Rt?Array.from(Z().subarray(Number(Rt)>>>0,Number(_n)>>>0)):[],outputShape:dn?Array.from(Z().subarray(Number(dn)>>>0,Number(ur)>>>0)):[],activation:Dn(gs)})},836953:(b,$,W,J,ie,Ee,Xe,ot,Mt,St,Rt,_n,dn,ur)=>{o.jb("ConvTranspose",b,{format:ot?"NHWC":"NCHW",autoPad:$,dilations:Array.from(Z().subarray(Number(W)>>>0,2+(Number(W)>>>0)>>>0)),group:J,kernelShape:Array.from(Z().subarray(Number(ie)>>>0,2+(Number(ie)>>>0)>>>0)),pads:Array.from(Z().subarray(Number(Ee)>>>0,4+(Number(Ee)>>>0)>>>0)),strides:Array.from(Z().subarray(Number(Xe)>>>0,2+(Number(Xe)>>>0)>>>0)),wIsConst:()=>!!U()[Mt>>>0],outputPadding:St?Array.from(Z().subarray(Number(St)>>>0,Number(Rt)>>>0)):[],outputShape:_n?Array.from(Z().subarray(Number(_n)>>>0,Number(dn)>>>0)):[],activation:Dn(ur)})},837614:(b,$)=>{o.jb("GlobalAveragePool",b,{format:$?"NHWC":"NCHW"})},837705:(b,$,W,J,ie,Ee,Xe,ot,Mt,St,Rt,_n,dn,ur)=>{o.jb("AveragePool",b,{format:ur?"NHWC":"NCHW",auto_pad:$,ceil_mode:W,count_include_pad:J,storage_order:ie,dilations:Ee?Array.from(Z().subarray(Number(Ee)>>>0,Number(Xe)>>>0)):[],kernel_shape:ot?Array.from(Z().subarray(Number(ot)>>>0,Number(Mt)>>>0)):[],pads:St?Array.from(Z().subarray(Number(St)>>>0,Number(Rt)>>>0)):[],strides:_n?Array.from(Z().subarray(Number(_n)>>>0,Number(dn)>>>0)):[]})},838184:(b,$)=>{o.jb("GlobalAveragePool",b,{format:$?"NHWC":"NCHW"})},838275:(b,$,W,J,ie,Ee,Xe,ot,Mt,St,Rt,_n,dn,ur)=>{o.jb("AveragePool",b,{format:ur?"NHWC":"NCHW",auto_pad:$,ceil_mode:W,count_include_pad:J,storage_order:ie,dilations:Ee?Array.from(Z().subarray(Number(Ee)>>>0,Number(Xe)>>>0)):[],kernel_shape:ot?Array.from(Z().subarray(Number(ot)>>>0,Number(Mt)>>>0)):[],pads:St?Array.from(Z().subarray(Number(St)>>>0,Number(Rt)>>>0)):[],strides:_n?Array.from(Z().subarray(Number(_n)>>>0,Number(dn)>>>0)):[]})},838754:(b,$)=>{o.jb("GlobalMaxPool",b,{format:$?"NHWC":"NCHW"})},838841:(b,$,W,J,ie,Ee,Xe,ot,Mt,St,Rt,_n,dn,ur)=>{o.jb("MaxPool",b,{format:ur?"NHWC":"NCHW",auto_pad:$,ceil_mode:W,count_include_pad:J,storage_order:ie,dilations:Ee?Array.from(Z().subarray(Number(Ee)>>>0,Number(Xe)>>>0)):[],kernel_shape:ot?Array.from(Z().subarray(Number(ot)>>>0,Number(Mt)>>>0)):[],pads:St?Array.from(Z().subarray(Number(St)>>>0,Number(Rt)>>>0)):[],strides:_n?Array.from(Z().subarray(Number(_n)>>>0,Number(dn)>>>0)):[]})},839316:(b,$)=>{o.jb("GlobalMaxPool",b,{format:$?"NHWC":"NCHW"})},839403:(b,$,W,J,ie,Ee,Xe,ot,Mt,St,Rt,_n,dn,ur)=>{o.jb("MaxPool",b,{format:ur?"NHWC":"NCHW",auto_pad:$,ceil_mode:W,count_include_pad:J,storage_order:ie,dilations:Ee?Array.from(Z().subarray(Number(Ee)>>>0,Number(Xe)>>>0)):[],kernel_shape:ot?Array.from(Z().subarray(Number(ot)>>>0,Number(Mt)>>>0)):[],pads:St?Array.from(Z().subarray(Number(St)>>>0,Number(Rt)>>>0)):[],strides:_n?Array.from(Z().subarray(Number(_n)>>>0,Number(dn)>>>0)):[]})},839878:(b,$,W,J,ie)=>{o.jb("Gemm",b,{alpha:$,beta:W,transA:J,transB:ie})},839982:b=>{o.jb("MatMul",b,void 0)},840036:(b,$,W,J)=>{o.jb("ArgMax",b,{keepDims:!!$,selectLastIndex:!!W,axis:J})},840144:(b,$,W,J)=>{o.jb("ArgMin",b,{keepDims:!!$,selectLastIndex:!!W,axis:J})},840252:(b,$)=>{o.jb("Softmax",b,{axis:$})},840315:(b,$)=>{o.jb("Concat",b,{axis:$})},840375:(b,$,W,J,ie)=>{o.jb("Split",b,{axis:$,numOutputs:W,splitSizes:J?Array.from(Z().subarray(Number(J)>>>0,Number(ie)>>>0)):[]})},840531:b=>{o.jb("Expand",b,void 0)},840585:(b,$)=>{o.jb("Gather",b,{axis:Number($)})},840656:(b,$)=>{o.jb("GatherElements",b,{axis:Number($)})},840735:(b,$)=>{o.jb("GatherND",b,{batch_dims:Number($)})},840814:(b,$,W,J,ie,Ee,Xe,ot,Mt,St,Rt)=>{o.jb("Resize",b,{antialias:$,axes:W?Array.from(Z().subarray(Number(W)>>>0,Number(J)>>>0)):[],coordinateTransformMode:Dn(ie),cubicCoeffA:Ee,excludeOutside:Xe,extrapolationValue:ot,keepAspectRatioPolicy:Dn(Mt),mode:Dn(St),nearestMode:Dn(Rt)})},841176:(b,$,W,J,ie,Ee,Xe)=>{o.jb("Slice",b,{starts:$?Array.from(Z().subarray(Number($)>>>0,Number(W)>>>0)):[],ends:J?Array.from(Z().subarray(Number(J)>>>0,Number(ie)>>>0)):[],axes:Ee?Array.from(Z().subarray(Number(Ee)>>>0,Number(Xe)>>>0)):[]})},841440:b=>{o.jb("Tile",b,void 0)},841492:(b,$,W)=>{o.jb("InstanceNormalization",b,{epsilon:$,format:W?"NHWC":"NCHW"})},841606:(b,$,W)=>{o.jb("InstanceNormalization",b,{epsilon:$,format:W?"NHWC":"NCHW"})},841720:b=>{o.jb("Range",b,void 0)},841773:(b,$)=>{o.jb("Einsum",b,{equation:Dn($)})},841854:(b,$,W,J,ie)=>{o.jb("Pad",b,{mode:$,value:W,pads:J?Array.from(Z().subarray(Number(J)>>>0,Number(ie)>>>0)):[]})},841997:(b,$,W,J,ie,Ee)=>{o.jb("BatchNormalization",b,{epsilon:$,momentum:W,spatial:!!ie,trainingMode:!!J,format:Ee?"NHWC":"NCHW"})},842166:(b,$,W,J,ie,Ee)=>{o.jb("BatchNormalization",b,{epsilon:$,momentum:W,spatial:!!ie,trainingMode:!!J,format:Ee?"NHWC":"NCHW"})},842335:(b,$,W)=>{o.jb("CumSum",b,{exclusive:Number($),reverse:Number(W)})},842432:(b,$,W)=>{o.jb("DequantizeLinear",b,{axis:$,blockSize:W})},842522:(b,$,W,J,ie)=>{o.jb("GridSample",b,{align_corners:$,mode:Dn(W),padding_mode:Dn(J),format:ie?"NHWC":"NCHW"})},842692:(b,$,W,J,ie)=>{o.jb("GridSample",b,{align_corners:$,mode:Dn(W),padding_mode:Dn(J),format:ie?"NHWC":"NCHW"})},842862:(b,$)=>{o.jb("ScatterND",b,{reduction:Dn($)})},842947:(b,$,W,J,ie,Ee,Xe,ot,Mt)=>{o.jb("Attention",b,{numHeads:$,isUnidirectional:W,maskFilterValue:J,scale:ie,doRotary:Ee,qkvHiddenSizes:Xe?Array.from(Z().subarray(Number(ot)>>>0,Number(ot)+Xe>>>0)):[],pastPresentShareBuffer:!!Mt})},843219:b=>{o.jb("BiasAdd",b,void 0)},843274:b=>{o.jb("BiasSplitGelu",b,void 0)},843335:b=>{o.jb("FastGelu",b,void 0)},843391:(b,$,W,J,ie,Ee,Xe,ot,Mt,St,Rt,_n,dn,ur,gs,xo)=>{o.jb("Conv",b,{format:_n?"NHWC":"NCHW",auto_pad:$,dilations:W?Array.from(Z().subarray(Number(W)>>>0,Number(J)>>>0)):[],group:ie,kernel_shape:Ee?Array.from(Z().subarray(Number(Ee)>>>0,Number(Xe)>>>0)):[],pads:ot?Array.from(Z().subarray(Number(ot)>>>0,Number(Mt)>>>0)):[],strides:St?Array.from(Z().subarray(Number(St)>>>0,Number(Rt)>>>0)):[],w_is_const:()=>!!U()[Number(dn)>>>0],activation:Dn(ur),activation_params:gs?Array.from(Pe().subarray(Number(gs)>>>0,Number(xo)>>>0)):[]})},843975:b=>{o.jb("Gelu",b,void 0)},844027:(b,$,W,J,ie,Ee,Xe,ot,Mt)=>{o.jb("GroupQueryAttention",b,{numHeads:$,kvNumHeads:W,scale:J,softcap:ie,doRotary:Ee,rotaryInterleaved:Xe,smoothSoftmax:ot,localWindowSize:Mt})},844244:(b,$,W,J)=>{o.jb("LayerNormalization",b,{axis:$,epsilon:W,simplified:!!J})},844355:(b,$,W,J)=>{o.jb("LayerNormalization",b,{axis:$,epsilon:W,simplified:!!J})},844466:(b,$,W,J,ie,Ee)=>{o.jb("MatMulNBits",b,{k:$,n:W,accuracyLevel:J,bits:ie,blockSize:Ee})},844593:(b,$,W,J,ie,Ee)=>{o.jb("MultiHeadAttention",b,{numHeads:$,isUnidirectional:W,maskFilterValue:J,scale:ie,doRotary:Ee})},844752:(b,$)=>{o.jb("QuickGelu",b,{alpha:$})},844816:(b,$,W,J,ie)=>{o.jb("RotaryEmbedding",b,{interleaved:!!$,numHeads:W,rotaryEmbeddingDim:J,scale:ie})},844955:(b,$,W)=>{o.jb("SkipLayerNormalization",b,{epsilon:$,simplified:!!W})},845057:(b,$,W)=>{o.jb("SkipLayerNormalization",b,{epsilon:$,simplified:!!W})},845159:(b,$,W,J)=>{o.jb("GatherBlockQuantized",b,{gatherAxis:$,quantizeAxis:W,blockSize:J})},845280:b=>{o.Zb(b)},845314:(b,$)=>o.ac(Number(b),Number($),o.Fb.dc,o.Fb.errors)};function qe(b,$,W){return Xr(async()=>{await o.Xb(Number(b),Number($),Number(W))})}function _t(){return typeof wasmOffsetConverter<"u"}class Je{constructor($){ge(this,"name","ExitStatus");this.message=`Program terminated with exit(${$})`,this.status=$}}var pt=b=>{b.terminate(),b.onmessage=()=>{}},dt=[],Gt=b=>{gn.length==0&&(fs(),ds(gn[0]));var $=gn.pop();if(!$)return 6;Jt.push($),Fn[b.Ab]=$,$.Ab=b.Ab;var W={Bb:"run",fc:b.ec,Hb:b.Hb,Ab:b.Ab};return $.postMessage(W,b.Mb),0},vt=0,Ze=(b,$,...W)=>{for(var J=2*W.length,ie=ms(),Ee=zi(8*J),Xe=Ee>>>3,ot=0;ot<W.length;ot++){var Mt=W[ot];typeof Mt=="bigint"?(Q[Xe+2*ot]=1n,Q[Xe+2*ot+1]=Mt):(Q[Xe+2*ot]=0n,Ne()[Xe+2*ot+1>>>0]=Mt)}return b=hl(b,0,J,Ee,$),ss(ie),b};function rt(b){if(h)return Ze(0,1,b);if(k=b,!(0<vt)){for(var $ of Jt)pt($);for($ of gn)pt($);gn=[],Jt=[],Fn={},fe=!0}O(0,new Je(b))}function kt(b){if(h)return Ze(1,0,b);Nt(b)}var Nt=b=>{if(k=b,h)throw kt(b),"unwind";rt(b)},gn=[],Jt=[],Cn=[],Fn={},tn=b=>{var $=b.Ab;delete Fn[$],gn.push(b),Jt.splice(Jt.indexOf(b),1),b.Ab=0,pl($)};function ta(){Cn.forEach(b=>b())}var ds=b=>new Promise($=>{b.onmessage=ie=>{var Ee=(ie=ie.data).Bb;if(ie.Gb&&ie.Gb!=_o()){var Xe=Fn[ie.Gb];Xe?Xe.postMessage(ie,ie.Mb):M(`Internal error! Worker sent a message "${Ee}" to target pthread ${ie.Gb}, but that thread no longer exists!`)}else Ee==="checkMailbox"?We():Ee==="spawnThread"?Gt(ie):Ee==="cleanupThread"?tn(Fn[ie.hc]):Ee==="loaded"?(b.loaded=!0,$(b)):Ee==="alert"?alert(`Thread ${ie.ic}: ${ie.text}`):ie.target==="setimmediate"?b.postMessage(ie):Ee==="callHandler"?o[ie.Qb](...ie.args):Ee&&M(`worker sent an unknown command ${Ee}`)},b.onerror=ie=>{throw M(`worker sent an error! ${ie.filename}:${ie.lineno}: ${ie.message}`),ie};var W,J=[];for(W of[])o.propertyIsEnumerable(W)&&J.push(W);b.postMessage({Bb:"load",Rb:J,kc:C,lc:A})});function fs(){var b=new Worker((()=>{let $=URL;return import.meta.url>"file:"&&import.meta.url<"file;"?new $("ort.bundle.min.mjs",import.meta.url):new URL(import.meta.url)})(),{type:"module",workerData:"em-pthread",name:"em-pthread"});gn.push(b)}var Wa=b=>{H();var $=Me()[b+52>>>2>>>0];b=Me()[b+56>>>2>>>0],gl($,$-b),ss($)},Vn=(b,$)=>{vt=0,b=bo(b,$),0<vt?k=b:Fi(b)};class Er{constructor($){this.Ib=$-24}}function qr(b,$,W){var J=new Er(b>>>=0);throw $>>>=0,W>>>=0,Me()[J.Ib+16>>>2>>>0]=0,Me()[J.Ib+4>>>2>>>0]=$,Me()[J.Ib+8>>>2>>>0]=W,b}function Pa(b,$,W,J){return h?Ze(2,1,b,$,W,J):Ft(b,$,W,J)}function Ft(b,$,W,J){if(b>>>=0,W>>>=0,J>>>=0,g===void 0)return 6;var ie=[];return h&&ie.length===0?Pa(b,$>>>=0,W,J):(b={ec:W,Ab:b,Hb:J,Mb:ie},h?(b.Bb="spawnThread",postMessage(b,ie),0):Gt(b))}var ns=typeof TextDecoder<"u"?new TextDecoder:void 0,Ha=(b,$=0,W=NaN)=>{var J=($>>>=0)+W;for(W=$;b[W]&&!(W>=J);)++W;if(16<W-$&&b.buffer&&ns)return ns.decode(b.buffer instanceof ArrayBuffer?b.subarray($,W):b.slice($,W));for(J="";$<W;){var ie=b[$++];if(128&ie){var Ee=63&b[$++];if((224&ie)==192)J+=String.fromCharCode((31&ie)<<6|Ee);else{var Xe=63&b[$++];65536>(ie=(240&ie)==224?(15&ie)<<12|Ee<<6|Xe:(7&ie)<<18|Ee<<12|Xe<<6|63&b[$++])?J+=String.fromCharCode(ie):(ie-=65536,J+=String.fromCharCode(55296|ie>>10,56320|1023&ie))}}else J+=String.fromCharCode(ie)}return J},Dn=(b,$)=>(b>>>=0)?Ha(N(),b,$):"";function Kr(b,$,W){return h?Ze(3,1,b,$,W):0}function an(b,$){if(h)return Ze(4,1,b,$)}var Qa=b=>{for(var $=0,W=0;W<b.length;++W){var J=b.charCodeAt(W);127>=J?$++:2047>=J?$+=2:55296<=J&&57343>=J?($+=4,++W):$+=3}return $},L=(b,$,W)=>{var J=N();if($>>>=0,0<W){var ie=$;W=$+W-1;for(var Ee=0;Ee<b.length;++Ee){var Xe=b.charCodeAt(Ee);if(55296<=Xe&&57343>=Xe&&(Xe=65536+((1023&Xe)<<10)|1023&b.charCodeAt(++Ee)),127>=Xe){if($>=W)break;J[$++>>>0]=Xe}else{if(2047>=Xe){if($+1>=W)break;J[$++>>>0]=192|Xe>>6}else{if(65535>=Xe){if($+2>=W)break;J[$++>>>0]=224|Xe>>12}else{if($+3>=W)break;J[$++>>>0]=240|Xe>>18,J[$++>>>0]=128|Xe>>12&63}J[$++>>>0]=128|Xe>>6&63}J[$++>>>0]=128|63&Xe}}J[$>>>0]=0,b=$-ie}else b=0;return b};function ue(b,$){if(h)return Ze(5,1,b,$)}function Y(b,$,W){if(h)return Ze(6,1,b,$,W)}function oe(b,$,W){return h?Ze(7,1,b,$,W):0}function pe(b,$){if(h)return Ze(8,1,b,$)}function Ce(b,$,W){if(h)return Ze(9,1,b,$,W)}function Ue(b,$,W,J){if(h)return Ze(10,1,b,$,W,J)}function Ye(b,$,W,J){if(h)return Ze(11,1,b,$,W,J)}function ct(b,$,W,J){if(h)return Ze(12,1,b,$,W,J)}function ft(b){if(h)return Ze(13,1,b)}function Tt(b,$){if(h)return Ze(14,1,b,$)}function Et(b,$,W){if(h)return Ze(15,1,b,$,W)}var nn,xt,Zt=()=>Be(""),wn=b=>{for(var $="";N()[b>>>0];)$+=nn[N()[b++>>>0]];return $},Gn={},or={};function Ir(b,$,W={}){return(function(J,ie,Ee={}){var Xe=ie.name;if(!J)throw new xt(`type "${Xe}" must have a positive integer typeid pointer`);if(or.hasOwnProperty(J)){if(Ee.Sb)return;throw new xt(`Cannot register type '${Xe}' twice`)}or[J]=ie,Gn.hasOwnProperty(J)&&(ie=Gn[J],delete Gn[J],ie.forEach(ot=>ot()))})(b,$,W)}var _a=(b,$,W)=>{switch($){case 1:return W?J=>U()[J>>>0]:J=>N()[J>>>0];case 2:return W?J=>q()[J>>>1>>>0]:J=>ce()[J>>>1>>>0];case 4:return W?J=>Z()[J>>>2>>>0]:J=>Me()[J>>>2>>>0];case 8:return W?J=>Q[J>>>3]:J=>ne[J>>>3];default:throw new TypeError(`invalid integer width (${$}): ${b}`)}};function nr(b,$,W){W>>>=0,Ir(b>>>=0,{name:$=wn($>>>0),fromWireType:J=>J,toWireType:function(J,ie){if(typeof ie!="bigint"&&typeof ie!="number")throw ie=ie===null?"null":(J=typeof ie)=="object"||J==="array"||J==="function"?ie.toString():""+ie,new TypeError(`Cannot convert "${ie}" to ${this.name}`);return typeof ie=="number"&&(ie=BigInt(ie)),ie},Cb:Tr,readValueFromPointer:_a($,W,$.indexOf("u")==-1),Db:null})}var Tr=8;function Bs(b,$,W,J){Ir(b>>>=0,{name:$=wn($>>>0),fromWireType:function(ie){return!!ie},toWireType:function(ie,Ee){return Ee?W:J},Cb:Tr,readValueFromPointer:function(ie){return this.fromWireType(N()[ie>>>0])},Db:null})}var na=[],Pr=[];function xa(b){9<(b>>>=0)&&--Pr[b+1]==0&&(Pr[b]=void 0,na.push(b))}var mr=b=>{if(!b)throw new xt("Cannot use deleted val. handle = "+b);return Pr[b]},wr=b=>{switch(b){case void 0:return 2;case null:return 4;case!0:return 6;case!1:return 8;default:let $=na.pop()||Pr.length;return Pr[$]=b,Pr[$+1]=1,$}};function hs(b){return this.fromWireType(Me()[b>>>2>>>0])}var qa={name:"emscripten::val",fromWireType:b=>{var $=mr(b);return xa(b),$},toWireType:(b,$)=>wr($),Cb:Tr,readValueFromPointer:hs,Db:null};function Ka(b){return Ir(b>>>0,qa)}var ra=(b,$)=>{switch($){case 4:return function(W){return this.fromWireType(Pe()[W>>>2>>>0])};case 8:return function(W){return this.fromWireType(Ne()[W>>>3>>>0])};default:throw new TypeError(`invalid float width (${$}): ${b}`)}};function Ar(b,$,W){W>>>=0,Ir(b>>>=0,{name:$=wn($>>>0),fromWireType:J=>J,toWireType:(J,ie)=>ie,Cb:Tr,readValueFromPointer:ra($,W),Db:null})}function ua(b,$,W,J,ie){if(b>>>=0,W>>>=0,$=wn($>>>0),ie===-1&&(ie=4294967295),ie=ot=>ot,J===0){var Ee=32-8*W;ie=ot=>ot<<Ee>>>Ee}var Xe=$.includes("unsigned")?function(ot,Mt){return Mt>>>0}:function(ot,Mt){return Mt};Ir(b,{name:$,fromWireType:ie,toWireType:Xe,Cb:Tr,readValueFromPointer:_a($,W,J!==0),Db:null})}function lt(b,$,W){function J(Ee){var Xe=Me()[Ee>>>2>>>0];return Ee=Me()[Ee+4>>>2>>>0],new ie(U().buffer,Ee,Xe)}var ie=[Int8Array,Uint8Array,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array,BigInt64Array,BigUint64Array][$];Ir(b>>>=0,{name:W=wn(W>>>0),fromWireType:J,Cb:Tr,readValueFromPointer:J},{Sb:!0})}function ut(b,$){Ir(b>>>=0,{name:$=wn($>>>0),fromWireType:function(W){for(var J,ie=Me()[W>>>2>>>0],Ee=W+4,Xe=Ee,ot=0;ot<=ie;++ot){var Mt=Ee+ot;ot!=ie&&N()[Mt>>>0]!=0||(Xe=Dn(Xe,Mt-Xe),J===void 0?J=Xe:(J+="\0",J+=Xe),Xe=Mt+1)}return Da(W),J},toWireType:function(W,J){J instanceof ArrayBuffer&&(J=new Uint8Array(J));var ie=typeof J=="string";if(!(ie||J instanceof Uint8Array||J instanceof Uint8ClampedArray||J instanceof Int8Array))throw new xt("Cannot pass non-string to std::string");var Ee=ie?Qa(J):J.length,Xe=vo(4+Ee+1),ot=Xe+4;if(Me()[Xe>>>2>>>0]=Ee,ie)L(J,ot,Ee+1);else if(ie)for(ie=0;ie<Ee;++ie){var Mt=J.charCodeAt(ie);if(255<Mt)throw Da(Xe),new xt("String has UTF-16 code units that do not fit in 8 bits");N()[ot+ie>>>0]=Mt}else for(ie=0;ie<Ee;++ie)N()[ot+ie>>>0]=J[ie];return W!==null&&W.push(Da,Xe),Xe},Cb:Tr,readValueFromPointer:hs,Db(W){Da(W)}})}var At=typeof TextDecoder<"u"?new TextDecoder("utf-16le"):void 0,En=(b,$)=>{for(var W=b>>1,J=W+$/2;!(W>=J)&&ce()[W>>>0];)++W;if(32<(W<<=1)-b&&At)return At.decode(N().slice(b,W));for(W="",J=0;!(J>=$/2);++J){var ie=q()[b+2*J>>>1>>>0];if(ie==0)break;W+=String.fromCharCode(ie)}return W},ni=(b,$,W)=>{if(W??(W=2147483647),2>W)return 0;var J=$;W=(W-=2)<2*b.length?W/2:b.length;for(var ie=0;ie<W;++ie){var Ee=b.charCodeAt(ie);q()[$>>>1>>>0]=Ee,$+=2}return q()[$>>>1>>>0]=0,$-J},Fr=b=>2*b.length,ps=(b,$)=>{for(var W=0,J="";!(W>=$/4);){var ie=Z()[b+4*W>>>2>>>0];if(ie==0)break;++W,65536<=ie?(ie-=65536,J+=String.fromCharCode(55296|ie>>10,56320|1023&ie)):J+=String.fromCharCode(ie)}return J},Pi=(b,$,W)=>{if($>>>=0,W??(W=2147483647),4>W)return 0;var J=$;W=J+W-4;for(var ie=0;ie<b.length;++ie){var Ee=b.charCodeAt(ie);if(55296<=Ee&&57343>=Ee&&(Ee=65536+((1023&Ee)<<10)|1023&b.charCodeAt(++ie)),Z()[$>>>2>>>0]=Ee,($+=4)+4>W)break}return Z()[$>>>2>>>0]=0,$-J},Ie=b=>{for(var $=0,W=0;W<b.length;++W){var J=b.charCodeAt(W);55296<=J&&57343>=J&&++W,$+=4}return $};function V(b,$,W){if(b>>>=0,$>>>=0,W=wn(W>>>=0),$===2)var J=En,ie=ni,Ee=Fr,Xe=ot=>ce()[ot>>>1>>>0];else $===4&&(J=ps,ie=Pi,Ee=Ie,Xe=ot=>Me()[ot>>>2>>>0]);Ir(b,{name:W,fromWireType:ot=>{for(var Mt,St=Me()[ot>>>2>>>0],Rt=ot+4,_n=0;_n<=St;++_n){var dn=ot+4+_n*$;_n!=St&&Xe(dn)!=0||(Rt=J(Rt,dn-Rt),Mt===void 0?Mt=Rt:(Mt+="\0",Mt+=Rt),Rt=dn+$)}return Da(ot),Mt},toWireType:(ot,Mt)=>{if(typeof Mt!="string")throw new xt(`Cannot pass non-string to C++ string type ${W}`);var St=Ee(Mt),Rt=vo(4+St+$);return Me()[Rt>>>2>>>0]=St/$,ie(Mt,Rt+4,St+$),ot!==null&&ot.push(Da,Rt),Rt},Cb:Tr,readValueFromPointer:hs,Db(ot){Da(ot)}})}function se(b,$){Ir(b>>>=0,{Tb:!0,name:$=wn($>>>0),Cb:0,fromWireType:()=>{},toWireType:()=>{}})}function me(b){sa(b>>>0,!u,1,!d,131072,!1),ta()}var be=b=>{if(!fe)try{if(b(),!(0<vt))try{h?Fi(k):Nt(k)}catch($){$ instanceof Je||$=="unwind"||O(0,$)}}catch($){$ instanceof Je||$=="unwind"||O(0,$)}};function Se(b){b>>>=0,typeof Atomics.jc=="function"&&(Atomics.jc(Z(),b>>>2,b).value.then(We),b+=128,Atomics.store(Z(),b>>>2,1))}var We=()=>{var b=_o();b&&(Se(b),be(yo))};function ht(b,$){(b>>>=0)==$>>>0?setTimeout(We):h?postMessage({Gb:b,Bb:"checkMailbox"}):(b=Fn[b])&&b.postMessage({Bb:"checkMailbox"})}var bt=[];function yt(b,$,W,J,ie){for($>>>=0,J/=2,bt.length=J,W=ie>>>0>>>3,ie=0;ie<J;ie++)bt[ie]=Q[W+2*ie]?Q[W+2*ie+1]:Ne()[W+2*ie+1>>>0];return($?$e[$]:go[b])(...bt)}var Ct=()=>{vt=0};function Vt(b){b>>>=0,h?postMessage({Bb:"cleanupThread",hc:b}):tn(Fn[b])}function un(b){}var vn=(b,$)=>{var W=or[b];if(W===void 0)throw b=bc(b),W=wn(b),Da(b),new xt(`${$} has unknown type ${W}`);return W},Jn=(b,$,W)=>{var J=[];return b=b.toWireType(J,W),J.length&&(Me()[$>>>2>>>0]=wr(J)),b};function Tn(b,$,W){return $>>>=0,W>>>=0,b=mr(b>>>0),$=vn($,"emval::as"),Jn($,W,b)}function lr(b,$){return $>>>=0,b=mr(b>>>0),($=vn($,"emval::as")).toWireType(null,b)}var kr=b=>{try{b()}catch($){Be($)}},gr=0,Dr=null,Mr=0,zr=[],Wn={},_r={},cr=0,va=null,ka=[];function Xr(b){return(function($){if(!fe){if(gr===0){var W=!1,J=!1;$((ie=0)=>{if(!fe&&(Mr=ie,W=!0,J)){gr=2,kr(()=>zs(Dr)),typeof MainLoop<"u"&&MainLoop.Pb&&MainLoop.resume(),ie=!1;try{var Ee=(function(){var Mt=Z()[Dr+8>>>2>>>0];return Mt=Bt[_r[Mt]],--vt,Mt()})()}catch(Mt){Ee=Mt,ie=!0}var Xe=!1;if(!Dr){var ot=va;ot&&(va=null,(ie?ot.reject:ot.resolve)(Ee),Xe=!0)}if(ie&&!Xe)throw Ee}}),J=!0,W||(gr=1,Dr=(function(){var ie=vo(65548),Ee=ie+12;Me()[ie>>>2>>>0]=Ee,Me()[ie+4>>>2>>>0]=Ee+65536,Ee=zr[0];var Xe=Wn[Ee];return Xe===void 0&&(Xe=cr++,Wn[Ee]=Xe,_r[Xe]=Ee),Ee=Xe,Z()[ie+8>>>2>>>0]=Ee,ie})(),typeof MainLoop<"u"&&MainLoop.Pb&&MainLoop.pause(),kr(()=>_l(Dr)))}else gr===2?(gr=0,kr(wo),Da(Dr),Dr=null,ka.forEach(be)):Be(`invalid state: ${gr}`);return Mr}})($=>{b().then($)})}function Ea(b){return b>>>=0,Xr(async()=>{var $=await mr(b);return wr($)})}var rr=[];function xr(b,$,W,J){return W>>>=0,J>>>=0,(b=rr[b>>>0])(null,$=mr($>>>0),W,J)}var Sn={},On=b=>{var $=Sn[b];return $===void 0?wn(b):$};function aa(b,$,W,J,ie){return W>>>=0,J>>>=0,ie>>>=0,(b=rr[b>>>0])($=mr($>>>0),$[W=On(W)],J,ie)}var Xa=()=>typeof globalThis=="object"?globalThis:Function("return this")();function Ls(b){return(b>>>=0)==0?wr(Xa()):(b=On(b),wr(Xa()[b]))}var rl=b=>{var $=rr.length;return rr.push(b),$},al=(b,$)=>{for(var W=Array(b),J=0;J<b;++J)W[J]=vn(Me()[$+4*J>>>2>>>0],"parameter "+J);return W},ri=(b,$)=>Object.defineProperty($,"name",{value:b});function lo(b,$,W){var J=($=al(b,$>>>0)).shift();b--;var ie=`return function (obj, func, destructorsRef, args) {
`,Ee=0,Xe=[];W===0&&Xe.push("obj");for(var ot=["retType"],Mt=[J],St=0;St<b;++St)Xe.push("arg"+St),ot.push("argType"+St),Mt.push($[St]),ie+=`  var arg${St} = argType${St}.readValueFromPointer(args${Ee?"+"+Ee:""});
`,Ee+=$[St].Cb;return ie+=`  var rv = ${W===1?"new func":"func.call"}(${Xe.join(", ")});
`,J.Tb||(ot.push("emval_returnValue"),Mt.push(Jn),ie+=`  return emval_returnValue(retType, destructorsRef, rv);
`),ot.push(ie+`};
`),b=(function(Rt){var _n=Function;if(!(_n instanceof Function))throw new TypeError(`new_ called with constructor type ${typeof _n} which is not a function`);var dn=ri(_n.name||"unknownFunctionName",function(){});return dn.prototype=_n.prototype,dn=new dn,(Rt=_n.apply(dn,Rt))instanceof Object?Rt:dn})(ot)(...Mt),W=`methodCaller<(${$.map(Rt=>Rt.name).join(", ")}) => ${J.name}>`,rl(ri(W,b))}function cc(b){return b=On(b>>>0),wr(o[b])}function ki(b,$){return $>>>=0,b=mr(b>>>0),$=mr($),wr(b[$])}function Su(b){9<(b>>>=0)&&(Pr[b+1]+=1)}function Iu(){return wr([])}function sl(b){b=mr(b>>>0);for(var $=Array(b.length),W=0;W<b.length;W++)$[W]=b[W];return wr($)}function Pu(b){return wr(On(b>>>0))}function ku(){return wr({})}function Di(b){for(var $=mr(b>>>=0);$.length;){var W=$.pop();$.pop()(W)}xa(b)}function Du(b,$,W){$>>>=0,W>>>=0,b=mr(b>>>0),$=mr($),W=mr(W),b[$]=W}function Ou(b,$){return $>>>=0,b=(b=vn(b>>>0,"_emval_take_value")).readValueFromPointer($),wr(b)}function uc(b,$){b=-9007199254740992>b||9007199254740992<b?NaN:Number(b),$>>>=0,b=new Date(1e3*b),Z()[$>>>2>>>0]=b.getUTCSeconds(),Z()[$+4>>>2>>>0]=b.getUTCMinutes(),Z()[$+8>>>2>>>0]=b.getUTCHours(),Z()[$+12>>>2>>>0]=b.getUTCDate(),Z()[$+16>>>2>>>0]=b.getUTCMonth(),Z()[$+20>>>2>>>0]=b.getUTCFullYear()-1900,Z()[$+24>>>2>>>0]=b.getUTCDay(),b=(b.getTime()-Date.UTC(b.getUTCFullYear(),0,1,0,0,0,0))/864e5|0,Z()[$+28>>>2>>>0]=b}var dc=b=>b%4==0&&(b%100!=0||b%400==0),fc=[0,31,60,91,121,152,182,213,244,274,305,335],il=[0,31,59,90,120,151,181,212,243,273,304,334];function $u(b,$){b=-9007199254740992>b||9007199254740992<b?NaN:Number(b),$>>>=0,b=new Date(1e3*b),Z()[$>>>2>>>0]=b.getSeconds(),Z()[$+4>>>2>>>0]=b.getMinutes(),Z()[$+8>>>2>>>0]=b.getHours(),Z()[$+12>>>2>>>0]=b.getDate(),Z()[$+16>>>2>>>0]=b.getMonth(),Z()[$+20>>>2>>>0]=b.getFullYear()-1900,Z()[$+24>>>2>>>0]=b.getDay();var W=(dc(b.getFullYear())?fc:il)[b.getMonth()]+b.getDate()-1|0;Z()[$+28>>>2>>>0]=W,Z()[$+36>>>2>>>0]=-60*b.getTimezoneOffset(),W=new Date(b.getFullYear(),6,1).getTimezoneOffset();var J=new Date(b.getFullYear(),0,1).getTimezoneOffset();b=0|(W!=J&&b.getTimezoneOffset()==Math.min(J,W)),Z()[$+32>>>2>>>0]=b}function ol(b){b>>>=0;var $=new Date(Z()[b+20>>>2>>>0]+1900,Z()[b+16>>>2>>>0],Z()[b+12>>>2>>>0],Z()[b+8>>>2>>>0],Z()[b+4>>>2>>>0],Z()[b>>>2>>>0],0),W=Z()[b+32>>>2>>>0],J=$.getTimezoneOffset(),ie=new Date($.getFullYear(),6,1).getTimezoneOffset(),Ee=new Date($.getFullYear(),0,1).getTimezoneOffset(),Xe=Math.min(Ee,ie);return 0>W?Z()[b+32>>>2>>>0]=+(ie!=Ee&&Xe==J):0<W!=(Xe==J)&&(ie=Math.max(Ee,ie),$.setTime($.getTime()+6e4*((0<W?Xe:ie)-J))),Z()[b+24>>>2>>>0]=$.getDay(),W=(dc($.getFullYear())?fc:il)[$.getMonth()]+$.getDate()-1|0,Z()[b+28>>>2>>>0]=W,Z()[b>>>2>>>0]=$.getSeconds(),Z()[b+4>>>2>>>0]=$.getMinutes(),Z()[b+8>>>2>>>0]=$.getHours(),Z()[b+12>>>2>>>0]=$.getDate(),Z()[b+16>>>2>>>0]=$.getMonth(),Z()[b+20>>>2>>>0]=$.getYear(),b=$.getTime(),BigInt(isNaN(b)?-1:b/1e3)}function ll(b,$,W,J,ie,Ee,Xe){return h?Ze(16,1,b,$,W,J,ie,Ee,Xe):-52}function hc(b,$,W,J,ie,Ee){if(h)return Ze(17,1,b,$,W,J,ie,Ee)}var ai={},pc=()=>performance.timeOrigin+performance.now();function cl(b,$){if(h)return Ze(18,1,b,$);if(ai[b]&&(clearTimeout(ai[b].id),delete ai[b]),!$)return 0;var W=setTimeout(()=>{delete ai[b],be(()=>ml(b,performance.timeOrigin+performance.now()))},$);return ai[b]={id:W,qc:$},0}function Tf(b,$,W,J){b>>>=0,$>>>=0,W>>>=0,J>>>=0;var ie=new Date().getFullYear(),Ee=new Date(ie,0,1).getTimezoneOffset();ie=new Date(ie,6,1).getTimezoneOffset();var Xe=Math.max(Ee,ie);Me()[b>>>2>>>0]=60*Xe,Z()[$>>>2>>>0]=+(Ee!=ie),b=($=ot=>{var Mt=Math.abs(ot);return`UTC${0<=ot?"-":"+"}${String(Math.floor(Mt/60)).padStart(2,"0")}${String(Mt%60).padStart(2,"0")}`})(Ee),$=$(ie),ie<Ee?(L(b,W,17),L($,J,17)):(L(b,J,17),L($,W,17))}var Bu=()=>Date.now();function mc(b,$,W){return 0<=b&&3>=b?(b===0?b=Date.now():b=performance.timeOrigin+performance.now(),Q[W>>>0>>>3]=BigInt(Math.round(1e6*b)),0):28}var co=[],uo=(b,$)=>{co.length=0;for(var W;W=N()[b++>>>0];){var J=W!=105;$+=(J&=W!=112)&&$%8?4:0,co.push(W==112?Me()[$>>>2>>>0]:W==106?Q[$>>>3]:W==105?Z()[$>>>2>>>0]:Ne()[$>>>3>>>0]),$+=J?8:4}return co};function Lu(b,$,W){return b>>>=0,$=uo($>>>0,W>>>0),$e[b](...$)}function Fu(b,$,W){return b>>>=0,$=uo($>>>0,W>>>0),$e[b](...$)}var zu=()=>{};function ul(b,$){return M(Dn(b>>>0,$>>>0))}var Oi=()=>{throw vt+=1,"unwind"};function Nu(){return 4294901760}var dl=()=>navigator.hardwareConcurrency;function gc(){return Be("Cannot use emscripten_pc_get_function without -sUSE_OFFSET_CONVERTER"),0}function _c(b){b>>>=0;var $=N().length;if(b<=$||4294901760<b)return!1;for(var W=1;4>=W;W*=2){var J=$*(1+.2/W);J=Math.min(J,b+100663296);e:{J=(Math.min(4294901760,65536*Math.ceil(Math.max(b,J)/65536))-C.buffer.byteLength+65535)/65536|0;try{C.grow(J),H();var ie=1;break e}catch{}ie=void 0}if(ie)return!0}return!1}var si=()=>(Be("Cannot use convertFrameToPC (needed by __builtin_return_address) without -sUSE_OFFSET_CONVERTER"),0),ii={},rs=b=>{b.forEach($=>{si()})};function vc(){var b=Error().stack.toString().split(`
`);return b[0]=="Error"&&b.shift(),rs(b),ii.Lb=si(),ii.cc=b,ii.Lb}function Ru(b,$,W){if(b>>>=0,$>>>=0,ii.Lb==b)var J=ii.cc;else(J=Error().stack.toString().split(`
`))[0]=="Error"&&J.shift(),rs(J);for(var ie=3;J[ie]&&si()!=b;)++ie;for(b=0;b<W&&J[b+ie];++b)Z()[$+4*b>>>2>>>0]=si();return b}var fo,as={},fl=()=>{if(!fo){var b,$={USER:"web_user",LOGNAME:"web_user",PATH:"/",PWD:"/",HOME:"/home/web_user",LANG:(typeof navigator=="object"&&navigator.languages&&navigator.languages[0]||"C").replace("-","_")+".UTF-8",_:"./this.program"};for(b in as)as[b]===void 0?delete $[b]:$[b]=as[b];var W=[];for(b in $)W.push(`${b}=${$[b]}`);fo=W}return fo};function $i(b,$){if(h)return Ze(19,1,b,$);b>>>=0,$>>>=0;var W=0;return fl().forEach((J,ie)=>{var Ee=$+W;for(ie=Me()[b+4*ie>>>2>>>0]=Ee,Ee=0;Ee<J.length;++Ee)U()[ie++>>>0]=J.charCodeAt(Ee);U()[ie>>>0]=0,W+=J.length+1}),0}function oi(b,$){if(h)return Ze(20,1,b,$);b>>>=0,$>>>=0;var W=fl();Me()[b>>>2>>>0]=W.length;var J=0;return W.forEach(ie=>J+=ie.length+1),Me()[$>>>2>>>0]=J,0}function ju(b){return h?Ze(21,1,b):52}function Bi(b,$,W,J){return h?Ze(22,1,b,$,W,J):52}function ho(b,$,W,J){return h?Ze(23,1,b,$,W,J):70}var yc=[null,[],[]];function po(b,$,W,J){if(h)return Ze(24,1,b,$,W,J);$>>>=0,W>>>=0,J>>>=0;for(var ie=0,Ee=0;Ee<W;Ee++){var Xe=Me()[$>>>2>>>0],ot=Me()[$+4>>>2>>>0];$+=8;for(var Mt=0;Mt<ot;Mt++){var St=N()[Xe+Mt>>>0],Rt=yc[b];St===0||St===10?((b===1?I:M)(Ha(Rt)),Rt.length=0):Rt.push(St)}ie+=ot}return Me()[J>>>2>>>0]=ie,0}h||(function(){for(var b=o.numThreads-1;b--;)fs();dt.unshift(()=>{Re++,(function($){h?$():Promise.all(gn.map(ds)).then($)})(()=>Ke())})})();for(var mo=Array(256),Li=0;256>Li;++Li)mo[Li]=String.fromCharCode(Li);nn=mo,xt=o.BindingError=class extends Error{constructor(b){super(b),this.name="BindingError"}},o.InternalError=class extends Error{constructor(b){super(b),this.name="InternalError"}},Pr.push(0,1,void 0,1,null,1,!0,1,!1,1),o.count_emval_handles=()=>Pr.length/2-5-na.length;var Bt,go=[rt,kt,Pa,Kr,an,ue,Y,oe,pe,Ce,Ue,Ye,ct,ft,Tt,Et,ll,hc,cl,$i,oi,ju,Bi,ho,po];(async function(){function b(J,ie){return Bt=J.exports,Bt=(function(){var Ee=Bt,Xe={};for(let[ot,Mt]of Object.entries(Ee))Xe[ot]=typeof Mt=="function"?(...St)=>{zr.push(ot);try{return Mt(...St)}finally{fe||(zr.pop(),Dr&&gr===1&&zr.length===0&&(gr=0,vt+=1,kr(is),typeof Fibers<"u"&&Fibers.rc()))}}:Mt;return Xe})(),Bt=(function(){var Ee=Bt,Xe=Mt=>St=>Mt(St)>>>0,ot=Mt=>()=>Mt()>>>0;return(Ee=Object.assign({},Ee)).Da=Xe(Ee.Da),Ee.fb=ot(Ee.fb),Ee.hb=Xe(Ee.hb),Ee.tb=Xe(Ee.tb),Ee.ub=ot(Ee.ub),Ee.__cxa_get_exception_ptr=Xe(Ee.__cxa_get_exception_ptr),Ee})(),Cn.push(Bt.ib),A=ie,Ke(),Bt}Re++;var $=nt();if(o.instantiateWasm)return new Promise(J=>{o.instantiateWasm($,(ie,Ee)=>{b(ie,Ee),J(ie.exports)})});if(h)return new Promise(J=>{Oe=ie=>{var Ee=new WebAssembly.Instance(ie,nt());J(b(Ee,ie))}});ze??(ze=o.locateFile?o.locateFile?o.locateFile("ort-wasm-simd-threaded.jsep.wasm",E):E+"ort-wasm-simd-threaded.jsep.wasm":new URL(""+new URL("ort-wasm-simd-threaded.jsep-B0T3yYHD.wasm",import.meta.url).href,import.meta.url).href);try{var W=await(async function(J){var ie=ze;if(!ve&&typeof WebAssembly.instantiateStreaming=="function"&&!j(ie))try{var Ee=fetch(ie,{credentials:"same-origin"});return await WebAssembly.instantiateStreaming(Ee,J)}catch(Xe){M(`wasm streaming compile failed: ${Xe}`),M("falling back to ArrayBuffer instantiation")}return(async function(Xe,ot){try{var Mt=await(async function(St){if(!ve)try{var Rt=await y(St);return new Uint8Array(Rt)}catch{}if(St==ze&&ve)St=new Uint8Array(ve);else{if(!v)throw"both async and sync fetching of the wasm failed";St=v(St)}return St})(Xe);return await WebAssembly.instantiate(Mt,ot)}catch(St){M(`failed to asynchronously prepare wasm: ${St}`),Be(St)}})(ie,J)})($);return b(W.instance,W.module)}catch(J){return i(J),Promise.reject(J)}})();var bc=b=>(bc=Bt.Da)(b),wc=()=>(wc=Bt.Ea)();o._OrtInit=(b,$)=>(o._OrtInit=Bt.Fa)(b,$),o._OrtGetLastError=(b,$)=>(o._OrtGetLastError=Bt.Ga)(b,$),o._OrtCreateSessionOptions=(b,$,W,J,ie,Ee,Xe,ot,Mt,St)=>(o._OrtCreateSessionOptions=Bt.Ha)(b,$,W,J,ie,Ee,Xe,ot,Mt,St),o._OrtAppendExecutionProvider=(b,$,W,J,ie)=>(o._OrtAppendExecutionProvider=Bt.Ia)(b,$,W,J,ie),o._OrtAddFreeDimensionOverride=(b,$,W)=>(o._OrtAddFreeDimensionOverride=Bt.Ja)(b,$,W),o._OrtAddSessionConfigEntry=(b,$,W)=>(o._OrtAddSessionConfigEntry=Bt.Ka)(b,$,W),o._OrtReleaseSessionOptions=b=>(o._OrtReleaseSessionOptions=Bt.La)(b),o._OrtCreateSession=(b,$,W)=>(o._OrtCreateSession=Bt.Ma)(b,$,W),o._OrtReleaseSession=b=>(o._OrtReleaseSession=Bt.Na)(b),o._OrtGetInputOutputCount=(b,$,W)=>(o._OrtGetInputOutputCount=Bt.Oa)(b,$,W),o._OrtGetInputOutputMetadata=(b,$,W,J)=>(o._OrtGetInputOutputMetadata=Bt.Pa)(b,$,W,J),o._OrtFree=b=>(o._OrtFree=Bt.Qa)(b),o._OrtCreateTensor=(b,$,W,J,ie,Ee)=>(o._OrtCreateTensor=Bt.Ra)(b,$,W,J,ie,Ee),o._OrtGetTensorData=(b,$,W,J,ie)=>(o._OrtGetTensorData=Bt.Sa)(b,$,W,J,ie),o._OrtReleaseTensor=b=>(o._OrtReleaseTensor=Bt.Ta)(b),o._OrtCreateRunOptions=(b,$,W,J)=>(o._OrtCreateRunOptions=Bt.Ua)(b,$,W,J),o._OrtAddRunConfigEntry=(b,$,W)=>(o._OrtAddRunConfigEntry=Bt.Va)(b,$,W),o._OrtReleaseRunOptions=b=>(o._OrtReleaseRunOptions=Bt.Wa)(b),o._OrtCreateBinding=b=>(o._OrtCreateBinding=Bt.Xa)(b),o._OrtBindInput=(b,$,W)=>(o._OrtBindInput=Bt.Ya)(b,$,W),o._OrtBindOutput=(b,$,W,J)=>(o._OrtBindOutput=Bt.Za)(b,$,W,J),o._OrtClearBoundOutputs=b=>(o._OrtClearBoundOutputs=Bt._a)(b),o._OrtReleaseBinding=b=>(o._OrtReleaseBinding=Bt.$a)(b),o._OrtRunWithBinding=(b,$,W,J,ie)=>(o._OrtRunWithBinding=Bt.ab)(b,$,W,J,ie),o._OrtRun=(b,$,W,J,ie,Ee,Xe,ot)=>(o._OrtRun=Bt.bb)(b,$,W,J,ie,Ee,Xe,ot),o._OrtEndProfiling=b=>(o._OrtEndProfiling=Bt.cb)(b),o._JsepOutput=(b,$,W)=>(o._JsepOutput=Bt.db)(b,$,W),o._JsepGetNodeName=b=>(o._JsepGetNodeName=Bt.eb)(b);var _o=()=>(_o=Bt.fb)(),Da=o._free=b=>(Da=o._free=Bt.gb)(b),vo=o._malloc=b=>(vo=o._malloc=Bt.hb)(b),sa=(b,$,W,J,ie,Ee)=>(sa=Bt.kb)(b,$,W,J,ie,Ee),Fs=()=>(Fs=Bt.lb)(),hl=(b,$,W,J,ie)=>(hl=Bt.mb)(b,$,W,J,ie),pl=b=>(pl=Bt.nb)(b),Fi=b=>(Fi=Bt.ob)(b),ml=(b,$)=>(ml=Bt.pb)(b,$),yo=()=>(yo=Bt.qb)(),gl=(b,$)=>(gl=Bt.rb)(b,$),ss=b=>(ss=Bt.sb)(b),zi=b=>(zi=Bt.tb)(b),ms=()=>(ms=Bt.ub)(),bo=o.dynCall_ii=(b,$)=>(bo=o.dynCall_ii=Bt.vb)(b,$),_l=b=>(_l=Bt.wb)(b),is=()=>(is=Bt.xb)(),zs=b=>(zs=Bt.yb)(b),wo=()=>(wo=Bt.zb)();return o.stackSave=()=>ms(),o.stackRestore=b=>ss(b),o.stackAlloc=b=>zi(b),o.setValue=function(b,$,W="i8"){switch(W.endsWith("*")&&(W="*"),W){case"i1":case"i8":U()[b>>>0]=$;break;case"i16":q()[b>>>1>>>0]=$;break;case"i32":Z()[b>>>2>>>0]=$;break;case"i64":Q[b>>>3]=BigInt($);break;case"float":Pe()[b>>>2>>>0]=$;break;case"double":Ne()[b>>>3>>>0]=$;break;case"*":Me()[b>>>2>>>0]=$;break;default:Be(`invalid type for setValue: ${W}`)}},o.getValue=function(b,$="i8"){switch($.endsWith("*")&&($="*"),$){case"i1":case"i8":return U()[b>>>0];case"i16":return q()[b>>>1>>>0];case"i32":return Z()[b>>>2>>>0];case"i64":return Q[b>>>3];case"float":return Pe()[b>>>2>>>0];case"double":return Ne()[b>>>3>>>0];case"*":return Me()[b>>>2>>>0];default:Be(`invalid type for getValue: ${$}`)}},o.UTF8ToString=Dn,o.stringToUTF8=L,o.lengthBytesUTF8=Qa,(function b(){if(0<Re)He=b;else if(h)s(o),Te();else{for(;0<dt.length;)dt.shift()(o);0<Re?He=b:(o.calledRun=!0,fe||(Te(),s(o)))}})(),o.PTR_SIZE=4,c}),q2=Z_,jb=(t=(e=globalThis.self)==null?void 0:e.name)==null?void 0:t.startsWith("em-pthread"),jb&&Z_()}),e0,hv,Ub,ks,K2,_g,Vb,Gb,t0,Wb,n0,X2,r0,Y2,Kv=mt(()=>{qv(),e0=typeof location>"u"?void 0:location.origin,hv=import.meta.url>"file:"&&import.meta.url<"file;",Ub=()=>{{if(hv){let e=URL;return new URL(new e("ort.bundle.min.mjs",import.meta.url).href,e0).href}return import.meta.url}},ks=Ub(),K2=()=>{if(ks&&!ks.startsWith("blob:"))return ks.substring(0,ks.lastIndexOf("/")+1)},_g=(e,t)=>{try{let n=t??ks;return(n?new URL(e,n):new URL(e)).origin===e0}catch{return!1}},Vb=(e,t)=>{let n=t??ks;try{return(n?new URL(e,n):new URL(e)).href}catch{return}},Gb=(e,t)=>`${t??"./"}${e}`,t0=async e=>{let t=await(await fetch(e,{credentials:"same-origin"})).blob();return URL.createObjectURL(t)},Wb=async e=>(await import(e)).default,n0=(Vk(),hm(W2)).default,X2=async()=>{if(!ks)throw new Error("Failed to load proxy worker: cannot determine the script source URL.");if(_g(ks))return[void 0,n0()];let e=await t0(ks);return[e,n0(e)]},r0=(Gk(),hm(Q2)).default,Y2=async(e,t,n)=>{if(!e&&!t&&r0&&ks&&_g(ks))return[void 0,r0];{let s="ort-wasm-simd-threaded.jsep.mjs",i=e??Vb(s,t),o=n&&i&&!_g(i,t),c=o?await t0(i):i??Gb(s,t);return[o?c:void 0,await Wb(c)]}}}),a0,vg,Qp,s0,Hb,Qb,qb,Xv,pr,Au=mt(()=>{Kv(),vg=!1,Qp=!1,s0=!1,Hb=()=>{if(typeof SharedArrayBuffer>"u")return!1;try{return typeof MessageChannel<"u"&&new MessageChannel().port1.postMessage(new SharedArrayBuffer(1)),WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,2,1,0,5,4,1,3,1,1,10,11,1,9,0,65,0,254,16,2,0,26,11]))}catch{return!1}},Qb=()=>{try{return WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,2,1,0,10,30,1,28,0,65,0,253,15,253,12,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,253,186,1,26,11]))}catch{return!1}},qb=()=>{try{return WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,5,1,96,0,1,123,3,2,1,0,10,19,1,17,0,65,1,253,15,65,2,253,15,65,3,253,15,253,147,2,11]))}catch{return!1}},Xv=async e=>{if(vg)return Promise.resolve();if(Qp)throw new Error("multiple calls to 'initializeWebAssembly()' detected.");if(s0)throw new Error("previous call to 'initializeWebAssembly()' failed.");Qp=!0;let t=e.initTimeout,n=e.numThreads;if(e.simd!==!1){if(e.simd==="relaxed"){if(!qb())throw new Error("Relaxed WebAssembly SIMD is not supported in the current environment.")}else if(!Qb())throw new Error("WebAssembly SIMD is not supported in the current environment.")}let s=Hb();n>1&&!s&&(typeof self<"u"&&!self.crossOriginIsolated&&console.warn("env.wasm.numThreads is set to "+n+", but this will not work unless you enable crossOriginIsolated mode. See https://web.dev/cross-origin-isolation-guide/ for more info."),console.warn("WebAssembly multi-threading is not supported in the current environment. Falling back to single-threading."),e.numThreads=n=1);let i=e.wasmPaths,o=typeof i=="string"?i:void 0,c=i==null?void 0:i.mjs,d=(c==null?void 0:c.href)??c,u=i==null?void 0:i.wasm,h=(u==null?void 0:u.href)??u,g=e.wasmBinary,[p,m]=await Y2(d,o,n>1),y=!1,v=[];if(t>0&&v.push(new Promise(T=>{setTimeout(()=>{y=!0,T()},t)})),v.push(new Promise((T,O)=>{let E={numThreads:n};if(g)E.wasmBinary=g;else if(h||o)E.locateFile=S=>h??o+S;else if(d&&d.indexOf("blob:")!==0)E.locateFile=S=>new URL(S,d).href;else if(p){let S=K2();S&&(E.locateFile=D=>S+D)}m(E).then(S=>{Qp=!1,vg=!0,a0=S,T(),p&&URL.revokeObjectURL(p)},S=>{Qp=!1,s0=!0,O(S)})})),await Promise.race(v),y)throw new Error(`WebAssembly backend initializing failed due to timeout: ${t}ms`)},pr=()=>{if(vg&&a0)return a0;throw new Error("WebAssembly is not initialized yet.")}}),Ai,Zg,Xn,Yv=mt(()=>{Au(),Ai=(e,t)=>{let n=pr(),s=n.lengthBytesUTF8(e)+1,i=n._malloc(s);return n.stringToUTF8(e,i,s),t.push(i),i},Zg=(e,t,n,s)=>{if(typeof e=="object"&&e!==null){if(n.has(e))throw new Error("Circular reference in options");n.add(e)}Object.entries(e).forEach(([i,o])=>{let c=t?t+i:i;if(typeof o=="object")Zg(o,c+".",n,s);else if(typeof o=="string"||typeof o=="number")s(c,o.toString());else if(typeof o=="boolean")s(c,o?"1":"0");else throw new Error(`Can't handle extra config type: ${typeof o}`)})},Xn=e=>{let t=pr(),n=t.stackSave();try{let s=t.PTR_SIZE,i=t.stackAlloc(2*s);t._OrtGetLastError(i,i+s);let o=Number(t.getValue(i,s===4?"i32":"i64")),c=t.getValue(i+s,"*"),d=c?t.UTF8ToString(c):"";throw new Error(`${e} ERROR_CODE: ${o}, ERROR_MESSAGE: ${d}`)}finally{t.stackRestore(n)}}}),J2,Wk=mt(()=>{Au(),Yv(),J2=e=>{let t=pr(),n=0,s=[],i=e||{};try{if((e==null?void 0:e.logSeverityLevel)===void 0)i.logSeverityLevel=2;else if(typeof e.logSeverityLevel!="number"||!Number.isInteger(e.logSeverityLevel)||e.logSeverityLevel<0||e.logSeverityLevel>4)throw new Error(`log serverity level is not valid: ${e.logSeverityLevel}`);if((e==null?void 0:e.logVerbosityLevel)===void 0)i.logVerbosityLevel=0;else if(typeof e.logVerbosityLevel!="number"||!Number.isInteger(e.logVerbosityLevel))throw new Error(`log verbosity level is not valid: ${e.logVerbosityLevel}`);(e==null?void 0:e.terminate)===void 0&&(i.terminate=!1);let o=0;return(e==null?void 0:e.tag)!==void 0&&(o=Ai(e.tag,s)),n=t._OrtCreateRunOptions(i.logSeverityLevel,i.logVerbosityLevel,!!i.terminate,o),n===0&&Xn("Can't create run options."),(e==null?void 0:e.extra)!==void 0&&Zg(e.extra,"",new WeakSet,(c,d)=>{let u=Ai(c,s),h=Ai(d,s);t._OrtAddRunConfigEntry(n,u,h)!==0&&Xn(`Can't set a run config entry: ${c} - ${d}.`)}),[n,s]}catch(o){throw n!==0&&t._OrtReleaseRunOptions(n),s.forEach(c=>t._free(c)),o}}}),Kb,Xb,Yb,qp,Jb,Z2,Hk=mt(()=>{Au(),Yv(),Kb=e=>{switch(e){case"disabled":return 0;case"basic":return 1;case"extended":return 2;case"all":return 99;default:throw new Error(`unsupported graph optimization level: ${e}`)}},Xb=e=>{switch(e){case"sequential":return 0;case"parallel":return 1;default:throw new Error(`unsupported execution mode: ${e}`)}},Yb=e=>{e.extra||(e.extra={}),e.extra.session||(e.extra.session={});let t=e.extra.session;t.use_ort_model_bytes_directly||(t.use_ort_model_bytes_directly="1"),e.executionProviders&&e.executionProviders.some(n=>(typeof n=="string"?n:n.name)==="webgpu")&&(e.enableMemPattern=!1)},qp=(e,t,n,s)=>{let i=Ai(t,s),o=Ai(n,s);pr()._OrtAddSessionConfigEntry(e,i,o)!==0&&Xn(`Can't set a session config entry: ${t} - ${n}.`)},Jb=async(e,t,n)=>{for(let s of t){let i=typeof s=="string"?s:s.name,o=[];switch(i){case"webnn":if(i="WEBNN",typeof s!="string"){let g=s==null?void 0:s.deviceType;g&&qp(e,"deviceType",g,n)}break;case"webgpu":if(i="JS",typeof s!="string"){let g=s;if(g!=null&&g.preferredLayout){if(g.preferredLayout!=="NCHW"&&g.preferredLayout!=="NHWC")throw new Error(`preferredLayout must be either 'NCHW' or 'NHWC': ${g.preferredLayout}`);qp(e,"preferredLayout",g.preferredLayout,n)}}break;case"wasm":case"cpu":continue;default:throw new Error(`not supported execution provider: ${i}`)}let c=Ai(i,n),d=o.length,u=0,h=0;if(d>0){u=pr()._malloc(d*pr().PTR_SIZE),n.push(u),h=pr()._malloc(d*pr().PTR_SIZE),n.push(h);for(let g=0;g<d;g++)pr().setValue(u+g*pr().PTR_SIZE,o[g][0],"*"),pr().setValue(h+g*pr().PTR_SIZE,o[g][1],"*")}await pr()._OrtAppendExecutionProvider(e,c,u,h,d)!==0&&Xn(`Can't append execution provider: ${i}.`)}},Z2=async e=>{let t=pr(),n=0,s=[],i=e||{};Yb(i);try{let o=Kb(i.graphOptimizationLevel??"all"),c=Xb(i.executionMode??"sequential"),d=typeof i.logId=="string"?Ai(i.logId,s):0,u=i.logSeverityLevel??2;if(!Number.isInteger(u)||u<0||u>4)throw new Error(`log serverity level is not valid: ${u}`);let h=i.logVerbosityLevel??0;if(!Number.isInteger(h)||h<0||h>4)throw new Error(`log verbosity level is not valid: ${h}`);let g=typeof i.optimizedModelFilePath=="string"?Ai(i.optimizedModelFilePath,s):0;if(n=t._OrtCreateSessionOptions(o,!!i.enableCpuMemArena,!!i.enableMemPattern,c,!!i.enableProfiling,0,d,u,h,g),n===0&&Xn("Can't create session options."),i.executionProviders&&await Jb(n,i.executionProviders,s),i.enableGraphCapture!==void 0){if(typeof i.enableGraphCapture!="boolean")throw new Error(`enableGraphCapture must be a boolean value: ${i.enableGraphCapture}`);qp(n,"enableGraphCapture",i.enableGraphCapture.toString(),s)}if(i.freeDimensionOverrides)for(let[p,m]of Object.entries(i.freeDimensionOverrides)){if(typeof p!="string")throw new Error(`free dimension override name must be a string: ${p}`);if(typeof m!="number"||!Number.isInteger(m)||m<0)throw new Error(`free dimension override value must be a non-negative integer: ${m}`);let y=Ai(p,s);t._OrtAddFreeDimensionOverride(n,y,m)!==0&&Xn(`Can't set a free dimension override: ${p} - ${m}.`)}return i.extra!==void 0&&Zg(i.extra,"",new WeakSet,(p,m)=>{qp(n,p,m,s)}),[n,s]}catch(o){throw n!==0&&t._OrtReleaseSessionOptions(n)!==0&&Xn("Can't release session options."),s.forEach(c=>t._free(c)),o}}}),pf,Jo,_u,Jv,e_,Zv,ey,pv,Xt=mt(()=>{pf=e=>{switch(e){case"int8":return 3;case"uint8":return 2;case"bool":return 9;case"int16":return 5;case"uint16":return 4;case"int32":return 6;case"uint32":return 12;case"float16":return 10;case"float32":return 1;case"float64":return 11;case"string":return 8;case"int64":return 7;case"uint64":return 13;case"int4":return 22;case"uint4":return 21;default:throw new Error(`unsupported data type: ${e}`)}},Jo=e=>{switch(e){case 3:return"int8";case 2:return"uint8";case 9:return"bool";case 5:return"int16";case 4:return"uint16";case 6:return"int32";case 12:return"uint32";case 10:return"float16";case 1:return"float32";case 11:return"float64";case 8:return"string";case 7:return"int64";case 13:return"uint64";case 22:return"int4";case 21:return"uint4";default:throw new Error(`unsupported data type: ${e}`)}},_u=(e,t)=>{let n=[-1,4,1,1,2,2,4,8,-1,1,2,8,4,8,-1,-1,-1,-1,-1,-1,-1,.5,.5][e],s=typeof t=="number"?t:t.reduce((i,o)=>i*o,1);return n>0?Math.ceil(s*n):void 0},Jv=e=>{switch(e){case"float16":return typeof Float16Array<"u"&&Float16Array.from?Float16Array:Uint16Array;case"float32":return Float32Array;case"uint8":return Uint8Array;case"int8":return Int8Array;case"uint16":return Uint16Array;case"int16":return Int16Array;case"int32":return Int32Array;case"bool":return Uint8Array;case"float64":return Float64Array;case"uint32":return Uint32Array;case"int64":return BigInt64Array;case"uint64":return BigUint64Array;default:throw new Error(`unsupported type: ${e}`)}},e_=e=>{switch(e){case"verbose":return 0;case"info":return 1;case"warning":return 2;case"error":return 3;case"fatal":return 4;default:throw new Error(`unsupported logging level: ${e}`)}},Zv=e=>e==="float32"||e==="float16"||e==="int32"||e==="int64"||e==="uint32"||e==="uint8"||e==="bool"||e==="uint4"||e==="int4",ey=e=>e==="float32"||e==="float16"||e==="int32"||e==="int64"||e==="uint32"||e==="uint64"||e==="int8"||e==="uint8"||e==="bool"||e==="uint4"||e==="int4",pv=e=>{switch(e){case"none":return 0;case"cpu":return 1;case"cpu-pinned":return 2;case"texture":return 3;case"gpu-buffer":return 4;case"ml-tensor":return 5;default:throw new Error(`unsupported data location: ${e}`)}}}),ty,eE=mt(()=>{qv(),ty=async e=>{if(typeof e=="string"){let t=await fetch(e);if(!t.ok)throw new Error(`failed to load external data file: ${e}`);let n=t.headers.get("Content-Length"),s=n?parseInt(n,10):0;if(s<1073741824)return new Uint8Array(await t.arrayBuffer());{if(!t.body)throw new Error(`failed to load external data file: ${e}, no response body.`);let i=t.body.getReader(),o;try{o=new ArrayBuffer(s)}catch(d){if(d instanceof RangeError){let u=Math.ceil(s/65536);o=new WebAssembly.Memory({initial:u,maximum:u}).buffer}else throw d}let c=0;for(;;){let{done:d,value:u}=await i.read();if(d)break;let h=u.byteLength;new Uint8Array(o,c,h).set(u),c+=h}return new Uint8Array(o,0,s)}}else return e instanceof Blob?new Uint8Array(await e.arrayBuffer()):e instanceof Uint8Array?e:new Uint8Array(e)}}),Zb,ew,tw,nw,ny,rw,Pn,nl=mt(()=>{Xt(),Zb=["V","I","W","E","F"],ew=(e,t)=>{console.log(`[${Zb[e]},${new Date().toISOString()}]${t}`)},ny=(e,t)=>{tw=e,nw=t},rw=(e,t)=>{let n=e_(e),s=e_(tw);n>=s&&ew(n,typeof t=="function"?t():t)},Pn=(...e)=>{nw&&rw(...e)}}),aw,wf,Ge,t_,tE,nE,rE,sn=mt(()=>{aw=class{static calcMatMulShape(e,t){return e[1]!==t[0]?void 0:[e[0],t[1]]}},wf=class{static calcShape(e,t,n=!1){let s=e.length,i=t.length;if(s===0)return t;if(i===0)return e;let o=Math.max(e.length,t.length),c=new Array(o);if(n){if(s<2||i<2)return;let d=aw.calcMatMulShape([e[s-2],e[s-1]],[t[i-2],t[i-1]]);if(d===void 0)return;[c[o-2],c[o-1]]=d}for(let d=n?3:1;d<=o;d++){let u=s-d<0?1:e[s-d],h=i-d<0?1:t[i-d];if(u!==h&&u>1&&h>1)return;let g=Math.max(u,h);if(u&&h)c[o-d]=Math.max(u,h);else{if(g>1)return;c[o-d]=0}}return c}static isValidBroadcast(e,t){let n=e.length,s=t.length;if(n>s)return!1;for(let i=1;i<=n;i++)if(e[n-i]!==1&&e[n-i]!==t[s-i])return!1;return!0}},Ge=class Ng{static size(t){return Ng.getSizeFromDimensionRange(t,0,t.length)}static convertShape(t,n=4){let s=t.length;if(s===0)return[];let i=new Array(s),o=s-1;for(;o>=0;){if(t[o]%n===0){i[o]=t[o]/n;break}if(n%t[o]!==0)throw new Error("cannot convert shape");i[o]=1,n/=t[o],o--}for(o--;o>=0;o--)i[o]=t[o];return i}static sizeFromDimension(t,n){if(n<0||n>t.length)throw new Error(`invalid dimension of ${n} for sizeFromDimension as Tensor has ${t.length} dimensions.`);return Ng.getSizeFromDimensionRange(t,n,t.length)}static sizeToDimension(t,n){if(n<0||n>t.length)throw new Error(`invalid dimension of ${n} for sizeToDimension as Tensor has ${t.length} dimensions.`);return Ng.getSizeFromDimensionRange(t,0,n)}static getSizeFromDimensionRange(t,n,s){let i=1;for(let o=n;o<s;o++){if(t[o]<0)throw new Error("cannot get valid size from specified dimension range. Most likely the range contains negative values in them.");i*=Number(t[o])}return i}static computeStrides(t){let n=t.length;if(n===0)return[];if(n===1)return[1];let s=new Array(n);s[n-1]=1,s[n-2]=t[n-1];for(let i=n-3;i>=0;--i)s[i]=s[i+1]*t[i+1];return s}static normalizeAxis(t,n){if(t<-n&&t>=n)throw new Error("unsupported axis for this operation.");return t<0?t+n:t}static normalizeAxes(t,n){return t.map(s=>this.normalizeAxis(s,n??t.length))}static sortBasedOnPerm(t,n){return n?n.map(s=>t[s]):t.slice().reverse()}static padShape(t,n){let s=t.length;return t.map((i,o)=>i+n[o]+n[o+s])}static areEqual(t,n){return t.length!==n.length?!1:t.every((s,i)=>s===n[i])}},t_=class sm{static adjustPoolAttributes(t,n,s,i,o,c){if(!t&&s.length!==n.length-2)throw new Error("length of specified kernel shapes should be 2 less than length of input dimensions");if(t)for(let d=0;d<n.length-2;d++)d>=s.length?s.push(n[d+2]):s[d]=n[d+2];for(let d=0;d<s.length;d++)if(d<i.length){if(i[d]<0)throw new Error("strides should be greater than or equal to 1")}else i.push(1);for(let d=0;d<s.length;d++)if(d<o.length){if(o[d]<0)throw new Error("dilations should be greater than or equal to 1")}else o.push(1);for(let d=0;d<s.length*2;d++)if(d<c.length){if(c[d]<0)throw new Error("pad should be greater than or equal to 1")}else c.push(0);for(let d=0;d<s.length;d++){if(s[d]<=0)throw new Error("kernel shapes need to be greater than 0");if(c[d]>=s[d]||c[d+s.length]>=s[d])throw new Error("pads should be smaller than kernel")}}static adjustPadsBasedOnAutoPad(t,n,s,i,o,c,d){if(d){if(o.length!==2*(t.length-2))throw new Error("length of pads should be twice the length of data dimensions");if(n.length!==t.length-2)throw new Error("length of strides should be the length of data dimensions");if(i.length!==t.length-2)throw new Error("length of kernel shapes should be the length of data dimensions");for(let u=0;u<t.length-2;u++)sm.adjustPadAndReturnShape(t[u+(c?1:2)],n[u],s[u],i[u],o,u,u+t.length-2,d)}}static computePoolOutputShape(t,n,s,i,o,c,d){if(n.length<=0)throw new Error("input shape must be of size greater than 0");let u=[n[0],n[1]];return sm.computeShapeHelper(t,n,u,s,i,o,c,d),u}static computeConvOutputShape(t,n,s,i,o,c,d){if(t.length<=0||n.length<=0)throw new Error("invalid input tensor dims or invalid filter tensor dims");let u=[t[0],n[0]];return sm.computeShapeHelper(!1,t,u,s,i,o,c,d),u}static computeShapeHelper(t,n,s,i,o,c,d,u){if(t)for(let h=0;h<n.length-2;h++)s.push(1);else for(let h=0;h<n.length-2;h++)s.push(sm.adjustPadAndReturnShape(n[h+2],i[h],o[h],c[h],d,h,h+n.length-2,u))}static adjustPadAndReturnShape(t,n,s,i,o,c,d,u){let h=s*(i-1)+1;if(u&&u!=="NOTSET")switch(u){case"VALID":return o[c]=0,o[d]=0,Math.floor((t-h)/n+1);case"SAME_LOWER":case"SAME_UPPER":if(s!==1)throw new Error("Dilation not supported for SAME_UPPER or SAME_LOWER");{let g=((t+n-1)/n-1)*n+i-t;return o[c]=Math.floor(u==="SAME_LOWER"?(g+1)/2:g/2),o[d]=g-o[c],Math.floor((t+g-i)/n+1)}default:throw new Error("Unsupported AutoPad type")}else return Math.floor((t+o[c]+o[d]-h)/n+1)}},tE=class{static getShapeOfGemmResult(e,t,n,s,i){if(e.length!==2||n.length!==2)throw new Error("shape need to be of size 2");let o,c,d;t?(o=e[1],c=e[0]):(o=e[0],c=e[1]);let u=-1;if(s?(d=n[0],u=1):(d=n[1],u=0),n[u]!==c)throw new Error("dimension mismatch");if(o<=0||d<=0||c<=0)throw new Error("invalid shape specified");if(i&&!wf.isValidBroadcast(i,[o,d]))throw new Error("gemm: invalid bias shape for broadcast");return[o,d,c]}},nE=-34028234663852886e22,rE=34028234663852886e22}),ry,aE=mt(()=>{Xt(),ry=(e,t)=>new(Jv(t))(e)}),mv,i0,sw,o0,iw,l0,c0,u0,ow,sE,Qk=mt(()=>{nl(),mv=(e,t=!0)=>{if(e.byteLength%8!==0)throw new Error("Invalid Uint8Array length - must be a multiple of 8 (BigInt).");let n=e.byteLength/8,s=new BigInt64Array(e.buffer,e.byteOffset,n),i=new Int32Array(n);for(let o=0;o<n;o++){let c=s[o];if(c>2147483647n||c<-2147483648n)throw new Error(`Overflow occurred when converting BigInt to Int32 at index ${o}: ${c}`);i[o]=Number(c)}return t?new Uint8Array(i.buffer):i},i0=(e,t=!0)=>{if(e.byteLength%4!==0)throw new Error("Invalid Uint8Array length - must be a multiple of 4 (Int32).");let n=e.byteLength/4,s=new Int32Array(e.buffer,e.byteOffset,n),i=BigInt64Array.from(s,BigInt);return t?new Uint8Array(i.buffer):i},sw=1,o0=()=>sw++,iw=new Map([["float32",32],["float16",16],["int32",32],["uint32",32],["int64",64],["uint64",64],["int8",8],["uint8",8],["int4",4],["uint4",4]]),l0=(e,t)=>{let n=iw.get(e);if(!n)throw new Error("Unsupported data type.");return t.length>0?Math.ceil(t.reduce((s,i)=>s*i)*n/8):0},c0=class{constructor(e){this.shouldConvertInt64toInt32=!1,this.isInt64ToInt32Converted=!1;let{sessionId:t,context:n,tensor:s,dataType:i,shape:o,shouldConvertInt64toInt32:c=!1}=e;this.sessionId=t,this.mlContext=n,this.mlTensor=s,this.dataType=i,this.tensorShape=o,this.shouldConvertInt64toInt32=c}get tensor(){return this.mlTensor}get type(){return this.dataType}get shape(){return this.tensorShape}get byteLength(){return l0(this.dataType,this.tensorShape)}destroy(){Pn("verbose",()=>"[WebNN] TensorWrapper.destroy"),this.mlTensor.destroy()}write(e){this.mlContext.writeTensor(this.mlTensor,e)}async read(e,t){if(e){let n=await this.mlContext.readTensor(this.mlTensor),s=i0(new Uint8Array(n));if(t){(t instanceof ArrayBuffer?new Uint8Array(t):new Uint8Array(t.buffer,t.byteOffset,t.byteLength)).set(s);return}else return s.buffer}else return t?this.mlContext.readTensor(this.mlTensor,t):this.mlContext.readTensor(this.mlTensor)}canReuseTensor(e,t,n){return this.mlContext===e&&this.dataType===t&&this.tensorShape.length===n.length&&this.tensorShape.every((s,i)=>s===n[i])}setIsInt64ToInt32Converted(e){this.isInt64ToInt32Converted=e}},u0=class{constructor(e,t){this.tensorManager=e,this.wrapper=t}get tensorWrapper(){return this.wrapper}releaseTensor(){this.tensorWrapper&&(this.tensorManager.releaseTensor(this.tensorWrapper),this.wrapper=void 0)}async ensureTensor(e,t,n,s){let i=t,o=this.tensorManager.getMLContext(e),c=i==="int64"&&!o.opSupportLimits().input.dataTypes.includes("int64");if(c&&(i="int32",Pn("verbose",()=>"[WebNN] TensorIdTracker.ensureTensor: convert dataType from int64 to int32")),this.wrapper){if(this.wrapper.canReuseTensor(o,i,n))return this.wrapper.tensor;if(s){if(this.wrapper.byteLength!==l0(i,n))throw new Error("Unable to copy data to tensor with different size.");this.activeUpload=new Uint8Array(await this.wrapper.read())}this.tensorManager.releaseTensor(this.wrapper)}let d=typeof MLTensorUsage>"u"?void 0:MLTensorUsage.READ|MLTensorUsage.WRITE;return this.wrapper=await this.tensorManager.getCachedTensor(e,i,n,d,!0,!0,c),s&&this.activeUpload&&(this.wrapper.write(this.activeUpload),this.activeUpload=void 0),this.wrapper.tensor}upload(e){let t=e;if(this.wrapper)if(this.wrapper.shouldConvertInt64toInt32&&(t=mv(e,!0),this.wrapper.setIsInt64ToInt32Converted(!0)),t.byteLength===this.wrapper.byteLength){this.wrapper.write(t);return}else Pn("verbose",()=>"Data size does not match tensor size. Releasing tensor."),this.releaseTensor();this.activeUpload?this.activeUpload.set(t):this.activeUpload=new Uint8Array(t)}async download(e){var t,n,s;if(this.activeUpload){let i=(t=this.wrapper)!=null&&t.isInt64ToInt32Converted?i0(this.activeUpload):this.activeUpload;if(e){e instanceof ArrayBuffer?new Uint8Array(e).set(i):new Uint8Array(e.buffer,e.byteOffset,e.byteLength).set(i);return}else return i.buffer}if(!this.wrapper)throw new Error("Tensor has not been created.");return e?this.wrapper.read((n=this.wrapper)==null?void 0:n.shouldConvertInt64toInt32,e):this.wrapper.read((s=this.wrapper)==null?void 0:s.shouldConvertInt64toInt32)}},ow=class{constructor(e){this.backend=e,this.tensorTrackersById=new Map,this.freeTensors=[],this.externalTensors=new Set}getMLContext(e){let t=this.backend.getMLContext(e);if(!t)throw new Error("MLContext not found for session.");return t}reserveTensorId(){let e=o0();return this.tensorTrackersById.set(e,new u0(this)),e}releaseTensorId(e){let t=this.tensorTrackersById.get(e);t&&(this.tensorTrackersById.delete(e),t.tensorWrapper&&this.releaseTensor(t.tensorWrapper))}async ensureTensor(e,t,n,s,i){Pn("verbose",()=>`[WebNN] TensorManager.ensureTensor {tensorId: ${t}, dataType: ${n}, shape: ${s}, copyOld: ${i}}`);let o=this.tensorTrackersById.get(t);if(!o)throw new Error("Tensor not found.");return o.ensureTensor(e,n,s,i)}upload(e,t){let n=this.tensorTrackersById.get(e);if(!n)throw new Error("Tensor not found.");n.upload(t)}async download(e,t){Pn("verbose",()=>`[WebNN] TensorManager.download {tensorId: ${e}, dstBuffer: ${t==null?void 0:t.byteLength}}`);let n=this.tensorTrackersById.get(e);if(!n)throw new Error("Tensor not found.");return n.download(t)}releaseTensorsForSession(e){for(let t of this.freeTensors)t.sessionId===e&&t.destroy();this.freeTensors=this.freeTensors.filter(t=>t.sessionId!==e)}registerTensor(e,t,n,s){let i=this.getMLContext(e),o=o0(),c=new c0({sessionId:e,context:i,tensor:t,dataType:n,shape:s});return this.tensorTrackersById.set(o,new u0(this,c)),this.externalTensors.add(c),o}async getCachedTensor(e,t,n,s,i,o,c=!1){let d=this.getMLContext(e);for(let[h,g]of this.freeTensors.entries())if(g.canReuseTensor(d,t,n)){Pn("verbose",()=>`[WebNN] Reusing tensor {dataType: ${t}, shape: ${n}}`);let p=this.freeTensors.splice(h,1)[0];return p.sessionId=e,p}Pn("verbose",()=>`[WebNN] MLContext.createTensor {dataType: ${t}, shape: ${n}}`);let u=await d.createTensor({dataType:t,shape:n,dimensions:n,usage:s,writable:i,readable:o});return new c0({sessionId:e,context:d,tensor:u,dataType:t,shape:n,shouldConvertInt64toInt32:c})}releaseTensor(e){this.externalTensors.has(e)&&this.externalTensors.delete(e),this.freeTensors.push(e)}},sE=(...e)=>new ow(...e)}),yg,lw,iE,qk=mt(()=>{Xt(),Au(),aE(),Qk(),nl(),yg=new Map([[1,"float32"],[10,"float16"],[6,"int32"],[12,"uint32"],[7,"int64"],[13,"uint64"],[22,"int4"],[21,"uint4"],[3,"int8"],[2,"uint8"],[9,"uint8"]]),lw=(e,t)=>{if(e===t)return!0;if(e===void 0||t===void 0)return!1;let n=Object.keys(e).sort(),s=Object.keys(t).sort();return n.length===s.length&&n.every((i,o)=>i===s[o]&&e[i]===t[i])},iE=class{constructor(e){this.tensorManager=sE(this),this.mlContextBySessionId=new Map,this.sessionIdsByMLContext=new Map,this.mlContextCache=[],this.sessionGraphInputs=new Map,this.temporaryGraphInputs=[],this.temporarySessionTensorIds=new Map,ny(e.logLevel,!!e.debug)}get currentSessionId(){if(this.activeSessionId===void 0)throw new Error("No active session");return this.activeSessionId}onRunStart(e){Pn("verbose",()=>`[WebNN] onRunStart {sessionId: ${e}}`),this.activeSessionId=e}onRunEnd(e){Pn("verbose",()=>`[WebNN] onRunEnd {sessionId: ${e}}`);let t=this.temporarySessionTensorIds.get(e);if(t){for(let n of t)Pn("verbose",()=>`[WebNN] releasing temporary tensor {tensorId: ${n}}`),this.tensorManager.releaseTensorId(n);this.temporarySessionTensorIds.delete(e),this.activeSessionId=void 0}}async createMLContext(e){if(e instanceof GPUDevice){let n=this.mlContextCache.findIndex(s=>s.gpuDevice===e);if(n!==-1)return this.mlContextCache[n].mlContext;{let s=await navigator.ml.createContext(e);return this.mlContextCache.push({gpuDevice:e,mlContext:s}),s}}else if(e===void 0){let n=this.mlContextCache.findIndex(s=>s.options===void 0&&s.gpuDevice===void 0);if(n!==-1)return this.mlContextCache[n].mlContext;{let s=await navigator.ml.createContext();return this.mlContextCache.push({mlContext:s}),s}}let t=this.mlContextCache.findIndex(n=>lw(n.options,e));if(t!==-1)return this.mlContextCache[t].mlContext;{let n=await navigator.ml.createContext(e);return this.mlContextCache.push({options:e,mlContext:n}),n}}registerMLContext(e,t){this.mlContextBySessionId.set(e,t);let n=this.sessionIdsByMLContext.get(t);n||(n=new Set,this.sessionIdsByMLContext.set(t,n)),n.add(e),this.temporaryGraphInputs.length>0&&(this.sessionGraphInputs.set(e,this.temporaryGraphInputs),this.temporaryGraphInputs=[])}onReleaseSession(e){this.sessionGraphInputs.delete(e);let t=this.mlContextBySessionId.get(e);if(!t)return;this.tensorManager.releaseTensorsForSession(e),this.mlContextBySessionId.delete(e);let n=this.sessionIdsByMLContext.get(t);if(n.delete(e),n.size===0){this.sessionIdsByMLContext.delete(t);let s=this.mlContextCache.findIndex(i=>i.mlContext===t);s!==-1&&this.mlContextCache.splice(s,1)}}getMLContext(e){return this.mlContextBySessionId.get(e)}reserveTensorId(){return this.tensorManager.reserveTensorId()}releaseTensorId(e){Pn("verbose",()=>`[WebNN] releaseTensorId {tensorId: ${e}}`),this.tensorManager.releaseTensorId(e)}async ensureTensor(e,t,n,s,i){let o=yg.get(n);if(!o)throw new Error(`Unsupported ONNX data type: ${n}`);return this.tensorManager.ensureTensor(e??this.currentSessionId,t,o,s,i)}async createTemporaryTensor(e,t,n){Pn("verbose",()=>`[WebNN] createTemporaryTensor {onnxDataType: ${t}, shape: ${n}}`);let s=yg.get(t);if(!s)throw new Error(`Unsupported ONNX data type: ${t}`);let i=this.tensorManager.reserveTensorId();await this.tensorManager.ensureTensor(e,i,s,n,!1);let o=this.temporarySessionTensorIds.get(e);return o?o.push(i):this.temporarySessionTensorIds.set(e,[i]),i}uploadTensor(e,t){if(!pr().shouldTransferToMLTensor)throw new Error("Trying to upload to a MLTensor while shouldTransferToMLTensor is false");Pn("verbose",()=>`[WebNN] uploadTensor {tensorId: ${e}, data: ${t.byteLength}}`),this.tensorManager.upload(e,t)}async downloadTensor(e,t){return this.tensorManager.download(e,t)}createMLTensorDownloader(e,t){return async()=>{let n=await this.tensorManager.download(e);return ry(n,t)}}registerMLTensor(e,t,n,s){let i=yg.get(n);if(!i)throw new Error(`Unsupported ONNX data type: ${n}`);let o=this.tensorManager.registerTensor(e,t,i,s);return Pn("verbose",()=>`[WebNN] registerMLTensor {tensor: ${t}, dataType: ${i}, dimensions: ${s}} -> {tensorId: ${o}}`),o}registerMLConstant(e,t,n,s,i,o,c=!1){if(!o)throw new Error("External mounted files are not available.");let d=e;e.startsWith("./")&&(d=e.substring(2));let u=o.get(d);if(!u)throw new Error(`File with name ${d} not found in preloaded files.`);if(t+n>u.byteLength)throw new Error("Out of bounds: data offset and length exceed the external file data size.");let h=u.slice(t,t+n).buffer,g;switch(i.dataType){case"float32":g=new Float32Array(h);break;case"float16":g=typeof Float16Array<"u"&&Float16Array.from?new Float16Array(h):new Uint16Array(h);break;case"int32":g=new Int32Array(h);break;case"uint32":g=new Uint32Array(h);break;case"int64":c?(g=mv(new Uint8Array(h),!1),i.dataType="int32"):g=new BigInt64Array(h);break;case"uint64":g=new BigUint64Array(h);break;case"int8":g=new Int8Array(h);break;case"int4":case"uint4":case"uint8":g=new Uint8Array(h);break;default:throw new Error(`Unsupported data type: ${i.dataType} in creating WebNN Constant from external data.`)}return Pn("verbose",()=>`[WebNN] registerMLConstant {dataType: ${i.dataType}, shape: ${i.shape}}} ${c?"(Note: it was int64 data type and registered to int32 as workaround)":""}`),s.constant(i,g)}registerGraphInput(e){this.temporaryGraphInputs.push(e)}isGraphInput(e,t){let n=this.sessionGraphInputs.get(e);return n?n.includes(t):!1}isInt64Supported(e){var t;return!!((t=this.mlContextBySessionId.get(e))!=null&&t.opSupportLimits().input.dataTypes.includes("int64"))}flush(){}}}),ay=mt(()=>{}),d0,bg,wg,cw,uw,f0,gv,dw,oE,Kk=mt(()=>{nl(),ay(),d0=new Map([[64,250],[128,200],[256,200],[512,200],[2048,230],[4096,200],[8192,50],[16384,50],[32768,50],[65536,50],[131072,50],[262144,50],[524288,50],[1048576,50],[2097152,30],[4194304,20],[8388608,10],[12582912,10],[16777216,10],[26214400,15],[33554432,22],[44236800,2],[58982400,6],[67108864,6],[134217728,6],[167772160,6]]),bg=[],wg=e=>Math.ceil(Number(e)/16)*16,cw=e=>{for(let t=0;t<bg.length;t++){let n=bg[t];if(e<=n)return n}return Math.ceil(e/16)*16},uw=1,f0=()=>uw++,gv=async(e,t,n,s)=>{let i=wg(n),o=e.device.createBuffer({size:i,usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.MAP_READ});try{let c=e.getCommandEncoder();e.endComputePass(),c.copyBufferToBuffer(t,0,o,0,i),e.flush(),await o.mapAsync(GPUMapMode.READ);let d=o.getMappedRange();if(s){let u=s();return u.set(new Uint8Array(d,0,n)),u}else return new Uint8Array(d.slice(0,n))}finally{o.destroy()}},dw=class{constructor(e){this.backend=e,this.storageCache=new Map,this.freeBuffers=new Map,this.freeUniformBuffers=new Map,this.buffersPending=[],this.capturedPendingBuffers=new Map;for(let[t]of d0)bg.push(t),this.freeBuffers.set(t,[]),this.freeUniformBuffers.set(t,[]);this.sessionCount=0}upload(e,t){let n=t.buffer,s=t.byteOffset,i=t.byteLength,o=wg(i),c=this.storageCache.get(e);if(!c)throw new Error("gpu data for uploading does not exist");if(Number(c.originalSize)!==i)throw new Error(`inconsistent data size. gpu data size=${c.originalSize}, data size=${i}`);let d=this.backend.device.createBuffer({mappedAtCreation:!0,size:o,usage:GPUBufferUsage.MAP_WRITE|GPUBufferUsage.COPY_SRC}),u=d.getMappedRange();new Uint8Array(u).set(new Uint8Array(n,s,i)),d.unmap();let h=this.backend.device.createCommandEncoder();h.copyBufferToBuffer(d,0,c.gpuData.buffer,0,o),this.backend.device.queue.submit([h.finish()]),d.destroy(),Pn("verbose",()=>`[WebGPU] GpuDataManager.upload(id=${e})`)}memcpy(e,t){let n=this.storageCache.get(e);if(!n)throw new Error("source gpu data for memcpy does not exist");let s=this.storageCache.get(t);if(!s)throw new Error("destination gpu data for memcpy does not exist");if(n.originalSize!==s.originalSize)throw new Error("inconsistent source and destination gpu data size");let i=wg(n.originalSize),o=this.backend.getCommandEncoder();this.backend.endComputePass(),o.copyBufferToBuffer(n.gpuData.buffer,0,s.gpuData.buffer,0,i)}registerExternalBuffer(e,t,n){let s;if(n){if(s=n[0],e===n[1])return Pn("verbose",()=>`[WebGPU] GpuDataManager.registerExternalBuffer(size=${t}) => id=${s}, buffer is the same, skip.`),s;if(this.backend.capturedCommandList.has(this.backend.currentSessionId))throw new Error(`Registering a different external buffer under graph capture mode is not supported yet.
             Please use the previous external buffer!`)}else s=f0();return this.storageCache.set(s,{gpuData:{id:s,type:0,buffer:e},originalSize:t}),Pn("verbose",()=>`[WebGPU] GpuDataManager.registerExternalBuffer(size=${t}) => id=${s}, registered.`),s}unregisterExternalBuffer(e){e!==void 0&&(this.storageCache.delete(e),Pn("verbose",()=>`[WebGPU] GpuDataManager.unregisterExternalBuffer() => id=${e}`))}create(e,t=GPUBufferUsage.STORAGE|GPUBufferUsage.COPY_SRC|GPUBufferUsage.COPY_DST){let n=cw(e),s,i=(t&GPUBufferUsage.STORAGE)===GPUBufferUsage.STORAGE,o=(t&GPUBufferUsage.UNIFORM)===GPUBufferUsage.UNIFORM;if(i||o){let d=(i?this.freeBuffers:this.freeUniformBuffers).get(n);d?d.length>0?s=d.pop():s=this.backend.device.createBuffer({size:n,usage:t}):s=this.backend.device.createBuffer({size:n,usage:t})}else s=this.backend.device.createBuffer({size:n,usage:t});let c={id:f0(),type:0,buffer:s};return this.storageCache.set(c.id,{gpuData:c,originalSize:Number(e)}),Pn("verbose",()=>`[WebGPU] GpuDataManager.create(size=${e}) => id=${c.id}`),c}get(e){var t;return(t=this.storageCache.get(e))==null?void 0:t.gpuData}release(e){let t=typeof e=="bigint"?Number(e):e,n=this.storageCache.get(t);if(!n){if(this.storageCache.size===0)return 0;throw new Error("releasing data does not exist")}return Pn("verbose",()=>`[WebGPU] GpuDataManager.release(id=${t}), gpuDataId=${n.gpuData.id}`),this.storageCache.delete(t),this.buffersPending.push(n.gpuData.buffer),n.originalSize}async download(e,t){let n=this.storageCache.get(Number(e));if(!n)throw new Error("data does not exist");await gv(this.backend,n.gpuData.buffer,n.originalSize,t)}refreshPendingBuffers(){if(this.buffersPending.length!==0)if(this.backend.sessionStatus==="default"){for(let e of this.buffersPending){let t=d0.get(e.size);if((e.usage&GPUBufferUsage.STORAGE)===GPUBufferUsage.STORAGE){let n=this.freeBuffers.get(e.size)||[];t===void 0||n.length>=t?e.destroy():n.push(e)}else if((e.usage&GPUBufferUsage.UNIFORM)===GPUBufferUsage.UNIFORM){let n=this.freeUniformBuffers.get(e.size)||[];t===void 0||n.length>=t?e.destroy():n.push(e)}else e.destroy()}this.buffersPending=[]}else{let e=this.capturedPendingBuffers.get(this.backend.currentSessionId);e||(e=[],this.capturedPendingBuffers.set(this.backend.currentSessionId,e));for(let t of this.buffersPending)e.push(t);this.buffersPending=[]}}dispose(){this.freeBuffers.forEach(e=>{e.forEach(t=>{t.destroy()})}),this.freeUniformBuffers.forEach(e=>{e.forEach(t=>{t.destroy()})}),this.storageCache.forEach(e=>{e.gpuData.buffer.destroy()}),this.capturedPendingBuffers.forEach(e=>{e.forEach(t=>{t.destroy()})}),this.storageCache=new Map,this.freeBuffers=new Map,this.freeUniformBuffers=new Map,this.capturedPendingBuffers=new Map}onCreateSession(){this.sessionCount+=1}onReleaseSession(e){let t=this.capturedPendingBuffers.get(e);t&&(t.forEach(n=>{n.destroy()}),this.capturedPendingBuffers.delete(e)),this.sessionCount-=1,this.sessionCount===0&&(Pn("warning",()=>"[WebGPU] Clearing webgpu buffer cache"),this.storageCache.forEach(n=>{n.gpuData.buffer.destroy()}),this.storageCache=new Map)}},oE=(...e)=>new dw(...e)}),fw,Nn,Hr=mt(()=>{fw=class{constructor(e){Object.assign(this,e)}get cacheKey(){return this.key||(this.key=Object.getOwnPropertyNames(this).sort().map(e=>`${this[e]}`).join(";")),this.key}},Nn=e=>new fw(e)}),Mf,Mg,ga,Ga,zt,Lr,_v,gf,oc,$t,Kp,et,Pt,lE,sy,hw,cE,cn=mt(()=>{Xt(),sn(),Mf=64,Mg=(e,t)=>{if(t===3)throw new Error("vec3 has same alignment as vec4, use vec4 instead");switch(Number(e)){case 10:return t>1?`vec${t}<f16>`:"f16";case 1:return t>1?`vec${t}<f32>`:"f32";case 6:return t>1?`vec${t}<i32>`:"i32";case 12:return t>1?`vec${t}<u32>`:"u32";case 7:if(t>1)throw new Error("currently not supported vecX of uint64 yet");return["vec2<u32>","i32"];case 13:if(t>1)throw new Error("currently not supported vecX of uint64 yet");return["vec2<u32>","u32"];case 9:if(t!==4)throw new Error("bool must be vec4");return["u32","vec4<bool>"];case 22:return"i32";case 21:return"u32";default:throw new Error(`Unknown data type: ${e}`)}},ga=(e,t=1)=>{let n=Mg(e,t);return typeof n=="string"?n:n[0]},Ga=(e,t=1)=>{let n=Mg(e,t);return typeof n=="string"?n:n[1]},zt=(...e)=>{let t=[];return e.forEach(n=>{n.length!==0&&t.push({type:12,data:n},{type:12,data:Ge.computeStrides(n)})}),t},Lr=e=>e%4===0?4:e%2===0?2:1,_v=(e="f32",t,n="0")=>!t||t===1?`${e}(${n})`:`vec${t}<${e}>(${n})`,gf=(e,t,n)=>e==="f32"?n:t===1?`f32(${n})`:`vec${t}<f32>(${n})`,oc=(e,t)=>t===4?`(${e}.x + ${e}.y + ${e}.z + ${e}.w)`:t===2?`(${e}.x + ${e}.y)`:t===3?`(${e}.x + ${e}.y + ${e}.z)`:e,$t=(e,t,n,s)=>e.startsWith("uniforms.")&&n>4?typeof t=="string"?s==="f16"?`${e}[(${t}) / 8][(${t}) % 8 / 4][(${t}) % 8 % 4]`:`${e}[(${t}) / 4][(${t}) % 4]`:s==="f16"?`${e}[${Math.floor(t/8)}][${Math.floor(t%8/4)}][${t%8%4}]`:`${e}[${Math.floor(t/4)}][${t%4}]`:n>1?`${e}[${t}]`:e,Kp=(e,t,n,s,i)=>{let o=typeof n=="number",c=o?n:n.length,d=[...new Array(c).keys()],u=c<2?"u32":c<=4?`vec${c}<u32>`:`array<u32, ${c}>`,h=Mg(t,i),g=typeof h=="string"?h:h[1],p=typeof h=="string"?h:h[0],m={indices:u,value:g,storage:p,tensor:t},y=j=>typeof j=="string"?j:`${j}u`,v={offsetToIndices:!1,indicesToOffset:!1,broadcastedIndicesToOffset:!1,set:!1,setByIndices:!1,get:!1,getByIndices:!1},T=o?"uniforms.":"",O=`${T}${e}_shape`,E=`${T}${e}_strides`,S="";for(let j=0;j<c-1;j++)S+=`
    let dim${j} = current / ${$t(E,j,c)};
    let rest${j} = current % ${$t(E,j,c)};
    indices[${j}] = dim${j};
    current = rest${j};
    `;S+=`indices[${c-1}] = current;`;let D=c<2?"":`
  fn o2i_${e}(offset: u32) -> ${m.indices} {
    var indices: ${m.indices};
    var current = offset;
    ${S}
    return indices;
  }`,I=j=>(v.offsetToIndices=!0,c<2?j:`o2i_${e}(${j})`),M=[];if(c>=2)for(let j=c-1;j>=0;j--)M.push(`${$t(E,j,c)} * (indices[${j}])`);let C=c<2?"":`
  fn i2o_${e}(indices: ${m.indices}) -> u32 {
    return ${M.join("+")};
  }`,A=j=>(v.indicesToOffset=!0,c<2?j:`i2o_${e}(${j})`),k=(...j)=>c===0?"0u":`${m.indices}(${j.map(y).join(",")})`,R=(j,U)=>c<2?`${j}`:`${$t(j,U,c)}`,G=(j,U,N)=>c<2?`${j}=${N};`:`${$t(j,U,c)}=${N};`,te={},ee=(j,U)=>{v.broadcastedIndicesToOffset=!0;let N=`${U.name}broadcastedIndicesTo${e}Offset`;if(N in te)return`${N}(${j})`;let q=[];for(let ce=c-1;ce>=0;ce--){let Z=U.indicesGet("outputIndices",ce+U.rank-c);q.push(`${R(E,ce)} * (${Z} % ${R(O,ce)})`)}return te[N]=`fn ${N}(outputIndices: ${U.type.indices}) -> u32 {
             return ${q.length>0?q.join("+"):"0u"};
           }`,`${N}(${j})`},X=(j,U)=>(()=>{if(m.storage===m.value)return`${e}[${j}]=${U};`;if(m.storage==="vec2<u32>"&&m.value==="i32")return`${e}[${j}]=vec2<u32>(u32(${U}), select(0u, 0xFFFFFFFFu, ${U} < 0));`;if(m.storage==="vec2<u32>"&&m.value==="u32")return`${e}[${j}]=vec2<u32>(u32(${U}), 0u);`;if(m.storage==="u32"&&m.value==="vec4<bool>")return`${e}[${j}]=dot(vec4<u32>(0x1, 0x100, 0x10000, 0x1000000), vec4<u32>(${U}));`;throw new Error(`not supported combination of storage type ${m.storage} and value type ${m.value} yet`)})(),le=j=>(()=>{if(m.storage===m.value)return`${e}[${j}]`;if(m.storage==="vec2<u32>"&&m.value==="i32")return`i32(${e}[${j}].x)`;if(m.storage==="vec2<u32>"&&m.value==="u32")return`u32(${e}[${j}].x)`;if(m.storage==="u32"&&m.value==="vec4<bool>")return`vec4<bool>(bool(${e}[${j}] & 0xFFu), bool(${e}[${j}] & 0xFF00u), bool(${e}[${j}] & 0xFF0000u), bool(${e}[${j}] & 0xFF000000u))`;throw new Error(`not supported combination of storage type ${m.storage} and value type ${m.value} yet`)})(),ae=c<2?"":`
  fn get_${e}ByIndices(indices: ${m.indices}) -> ${g} {
    return ${le(`i2o_${e}(indices)`)};
  }`,Q=c<2?"":(()=>{let j=d.map(N=>`d${N}: u32`).join(", "),U=d.map(N=>`d${N}`).join(", ");return`
  fn get_${e}(${j}) -> ${g} {
    return get_${e}ByIndices(${k(U)});
  }`})(),ne=(...j)=>{if(j.length!==c)throw new Error(`indices length must be ${c}`);let U=j.map(y).join(",");return c===0?le("0u"):c===1?le(U[0]):(v.get=!0,v.getByIndices=!0,v.indicesToOffset=!0,`get_${e}(${U})`)},de=j=>c<2?le(j):(v.getByIndices=!0,v.indicesToOffset=!0,`get_${e}ByIndices(${j})`),ve=c<2?"":`
  fn set_${e}ByIndices(indices: ${m.indices}, value: ${g}) {
    ${X(`i2o_${e}(indices)`,"value")}
  }`,fe=c<2?"":(()=>{let j=d.map(N=>`d${N}: u32`).join(", "),U=d.map(N=>`d${N}`).join(", ");return`
  fn set_${e}(${j}, value: ${g}) {
    set_${e}ByIndices(${k(U)}, value);
  }`})();return{impl:()=>{let j=[],U=!1;return v.offsetToIndices&&(j.push(D),U=!0),v.indicesToOffset&&(j.push(C),U=!0),v.broadcastedIndicesToOffset&&(Object.values(te).forEach(N=>j.push(N)),U=!0),v.set&&(j.push(fe),U=!0),v.setByIndices&&(j.push(ve),U=!0),v.get&&(j.push(Q),U=!0),v.getByIndices&&(j.push(ae),U=!0),!o&&U&&j.unshift(`const ${O} = ${m.indices}(${n.join(",")});`,`const ${E} = ${m.indices}(${Ge.computeStrides(n).join(",")});`),j.join(`
`)},type:m,offsetToIndices:I,indicesToOffset:A,broadcastedIndicesToOffset:ee,indices:k,indicesGet:R,indicesSet:G,set:(...j)=>{if(j.length!==c+1)throw new Error(`indices length must be ${c}`);let U=j[c];if(typeof U!="string")throw new Error("value must be string");let N=j.slice(0,c).map(y).join(",");return c===0?X("0u",U):c===1?X(N[0],U):(v.set=!0,v.setByIndices=!0,v.indicesToOffset=!0,`set_${e}(${N}, ${U})`)},setByOffset:X,setByIndices:(j,U)=>c<2?X(j,U):(v.setByIndices=!0,v.indicesToOffset=!0,`set_${e}ByIndices(${j}, ${U});`),get:ne,getByOffset:le,getByIndices:de,usage:s,name:e,strides:E,shape:O,rank:c}},et=(e,t,n,s=1)=>Kp(e,t,n,"input",s),Pt=(e,t,n,s=1)=>Kp(e,t,n,"output",s),lE=(e,t,n)=>Kp(e,t,n,"atomicOutput",1),sy=(e,t,n,s=1)=>Kp(e,t,n,"internal",s),hw=class{constructor(e,t){this.normalizedDispatchGroup=e,this.limits=t,this.internalVariables=[],this.variables=[],this.uniforms=[],this.variableIndex=0}guardAgainstOutOfBoundsWorkgroupSizes(e){return`if (global_idx >= ${typeof e=="number"?`${e}u`:e}) { return; }`}mainStart(e=Mf){let t=typeof e=="number"?e:e[0],n=typeof e=="number"?1:e[1],s=typeof e=="number"?1:e[2];if(t>this.limits.maxComputeWorkgroupSizeX||n>this.limits.maxComputeWorkgroupSizeY||s>this.limits.maxComputeWorkgroupSizeZ)throw new Error(`workgroup size [${t}, ${n}, ${s}] exceeds the maximum workgroup size [${this.limits.maxComputeWorkgroupSizeX}, ${this.limits.maxComputeWorkgroupSizeY}, ${this.limits.maxComputeWorkgroupSizeZ}].`);if(t*n*s>this.limits.maxComputeInvocationsPerWorkgroup)throw new Error(`workgroup size [${t}, ${n}, ${s}] exceeds the maximum workgroup invocations ${this.limits.maxComputeInvocationsPerWorkgroup}.`);let i=this.normalizedDispatchGroup[1]===1&&this.normalizedDispatchGroup[2]===1,o=i?`@builtin(global_invocation_id) global_id : vec3<u32>,
    @builtin(workgroup_id) workgroup_id : vec3<u32>,
    @builtin(local_invocation_index) local_idx : u32,
    @builtin(local_invocation_id) local_id : vec3<u32>`:`@builtin(global_invocation_id) global_id : vec3<u32>,
                                             @builtin(local_invocation_id) local_id : vec3<u32>,
    @builtin(local_invocation_index) local_idx : u32,
    @builtin(workgroup_id) workgroup_id : vec3<u32>,
    @builtin(num_workgroups) num_workgroups : vec3<u32>`,c=i?`let global_idx = global_id.x;
         let workgroup_index = workgroup_id.x;`:`let workgroup_index = workgroup_id.z * num_workgroups[0] * num_workgroups[1] +
             workgroup_id.y * num_workgroups[0] + workgroup_id.x;
         let global_idx = workgroup_index * ${t*n*s}u + local_idx;`;return`@compute @workgroup_size(${t}, ${n}, ${s})
  fn main(${o}) {
    ${c}
  `}appendVariableUniforms(e){e.rank!==0&&(e.shape.startsWith("uniforms.")&&this.uniforms.push({name:e.shape.replace("uniforms.",""),type:"u32",length:e.rank}),e.strides.startsWith("uniforms.")&&this.uniforms.push({name:e.strides.replace("uniforms.",""),type:"u32",length:e.rank}))}declareVariable(e,t){if(e.usage==="internal")throw new Error("cannot use internal variable with declareVariable(). use registerInternalVariables() instead.");this.variables.push(e),this.appendVariableUniforms(e);let n=e.usage==="input"?"read":"read_write",s=e.usage==="atomicOutput"?"atomic<i32>":e.type.storage;return`@group(0) @binding(${t}) var<storage, ${n}> ${e.name}: array<${s}>;`}declareVariables(...e){return e.map(t=>this.declareVariable(t,this.variableIndex++)).join(`
`)}registerInternalVariable(e){if(e.usage!=="internal")throw new Error("cannot use input or output variable with registerInternalVariable(). use declareVariables() instead.");this.internalVariables.push(e),this.appendVariableUniforms(e)}registerInternalVariables(...e){return e.forEach(t=>this.registerInternalVariable(t)),this}registerUniform(e,t,n=1){return this.uniforms.push({name:e,type:t,length:n}),this}registerUniforms(e){return this.uniforms=this.uniforms.concat(e),this}uniformDeclaration(){if(this.uniforms.length===0)return"";let e=[];for(let{name:t,type:n,length:s}of this.uniforms)if(s&&s>4)n==="f16"?e.push(`@align(16) ${t}:array<mat2x4<${n}>, ${Math.ceil(s/8)}>`):e.push(`${t}:array<vec4<${n}>, ${Math.ceil(s/4)}>`);else{let i=s==null||s===1?n:`vec${s}<${n}>`;e.push(`${t}:${i}`)}return`
      struct Uniforms { ${e.join(", ")} };
      @group(0) @binding(${this.variableIndex}) var<uniform> uniforms: Uniforms;`}get additionalImplementations(){return this.uniformDeclaration()+this.variables.map(e=>e.impl()).join(`
`)+this.internalVariables.map(e=>e.impl()).join(`
`)}get variablesInfo(){if(this.uniforms.length===0)return;let e=t=>[12,10,1,6][["u32","f16","f32","i32"].indexOf(t)];return this.uniforms.map(t=>[e(t.type),t.length??1])}},cE=(e,t)=>new hw(e,t)}),pw,h0,mw,gw,_w,vw,$s,uE,dE,lc=mt(()=>{Xt(),sn(),Hr(),cn(),pw=(e,t)=>{if(!e||e.length!==1)throw new Error("Transpose requires 1 input.");if(t.length!==0&&t.length!==e[0].dims.length)throw new Error(`perm size ${t.length} does not match input rank ${e[0].dims.length}`)},h0=(e,t)=>t.length!==0?t:[...new Array(e).keys()].reverse(),mw=(e,t)=>Ge.sortBasedOnPerm(e,h0(e.length,t)),gw=(e,t,n,s)=>{let i=`fn perm(i: ${s.type.indices}) -> ${n.type.indices} {
    var a: ${n.type.indices};`;for(let o=0;o<t;++o)i+=`a[${e[o]}]=i[${o}];`;return i+="return a;}"},_w=(e,t)=>{let n=[],s=[];for(let i=0;i<e.length;++i)e[i]!==1&&n.push(e[i]),e[t[i]]!==1&&s.push(t[i]);return{newShape:n,newPerm:s}},vw=(e,t)=>{let n=0;for(let s=0;s<e.length;++s)if(t[e[s]]!==1){if(e[s]<n)return!1;n=e[s]}return!0},$s=(e,t)=>{let n=e.dataType,s=e.dims.length,i=h0(s,t),o=mw(e.dims,i),c=e.dims,d=o,u=s<2||vw(i,e.dims),h;if(u)return h=v=>{let T=et("input",n,c,4),O=Pt("output",n,d,4);return`
  ${v.registerUniform("output_size","u32").declareVariables(T,O)}
  ${v.mainStart()}
    ${v.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
    output[global_idx] = input[global_idx];
  }`},{name:"TransposeCopy",shaderCache:{inputDependencies:["type"]},getRunData:()=>{let v=Ge.size(o);return{outputs:[{dims:o,dataType:e.dataType}],dispatchGroup:{x:Math.ceil(v/64/4)},programUniforms:[{type:12,data:Math.ceil(v/4)}]}},getShaderSource:h};let{newShape:g,newPerm:p}=_w(e.dims,i),m=Ge.areEqual(p,[2,3,1]),y=Ge.areEqual(p,[3,1,2]);if(g.length===2||m||y){c=m?[g[0],g[1]*g[2]]:y?[g[0]*g[1],g[2]]:g,d=[c[1],c[0]];let v=16;return h=T=>{let O=et("a",n,c.length),E=Pt("output",n,d.length);return`
  ${T.registerUniform("output_size","u32").declareVariables(O,E)}
  var<workgroup> tile : array<array<${E.type.value}, ${v+1}>, ${v}>;
  ${T.mainStart([v,v,1])}
    let stride = (uniforms.output_shape[1] - 1) / ${v} + 1;
    let workgroup_id_x = workgroup_index % stride;
    let workgroup_id_y = workgroup_index / stride;
    let input_col = workgroup_id_y * ${v}u + local_id.x;
    let input_row = workgroup_id_x * ${v}u + local_id.y;
    if (input_row < uniforms.a_shape[0] && input_col < uniforms.a_shape[1]) {
      tile[local_id.y][local_id.x] = ${O.getByIndices(`${O.type.indices}(input_row, input_col)`)};
    }
    workgroupBarrier();

    let output_col = workgroup_id_x * ${v}u + local_id.x;
    let output_row = workgroup_id_y * ${v}u + local_id.y;
    if (output_row < uniforms.output_shape[0] && output_col < uniforms.output_shape[1]) {
      ${E.setByIndices(`${E.type.indices}(output_row, output_col)`,"tile[local_id.x][local_id.y]")}
    }
  }`},{name:"TransposeShared",shaderCache:{inputDependencies:["type"]},getRunData:()=>{let T=Ge.size(o);return{outputs:[{dims:o,dataType:e.dataType}],dispatchGroup:{x:Math.ceil(d[1]/v),y:Math.ceil(d[0]/v)},programUniforms:[{type:12,data:T},...zt(c,d)]}},getShaderSource:h}}return h=v=>{let T=et("a",n,c.length),O=Pt("output",n,d.length);return`
  ${v.registerUniform("output_size","u32").declareVariables(T,O)}

  ${gw(i,s,T,O)}

  ${v.mainStart()}
    ${v.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}

    let indices = ${O.offsetToIndices("global_idx")};
    let aIndices = perm(indices);

    ${O.setByOffset("global_idx",T.getByIndices("aIndices"))}
  }`},{name:"Transpose",shaderCache:{hint:`${t}`,inputDependencies:["rank"]},getRunData:()=>{let v=Ge.size(o);return{outputs:[{dims:o,dataType:e.dataType}],dispatchGroup:{x:Math.ceil(v/64)},programUniforms:[{type:12,data:v},...zt(c,d)]}},getShaderSource:h}},uE=(e,t)=>{pw(e.inputs,t.perm),e.compute($s(e.inputs[0],t.perm))},dE=e=>Nn({perm:e.perm})}),yw,bw,ww,Mw,xw,Ew,Tw,Aw,Cw,Sw,wi,fE,hE,pE,mE,gE,_E,vE,yE,bE,wE,Xk=mt(()=>{Xt(),sn(),cn(),iy(),lc(),yw={max:"select(bestValue, candidate, candidate > bestValue)",min:"select(bestValue, candidate, candidate < bestValue)",mean:"bestValue + candidate",sum:"bestValue + candidate",prod:"bestValue * candidate",sumSquare:"bestValue + candidate * candidate",logSumExp:"bestValue + exp(candidate)",l1:"bestValue + abs(candidate)",l2:"bestValue + candidate * candidate",logSum:"bestValue + candidate"},bw={max:"select(bestValue, candidate, candidate > bestValue)",min:"select(bestValue, candidate, candidate < bestValue)",mean:"bestValue + candidate",sum:"bestValue + candidate",prod:"bestValue * candidate",sumSquare:"bestValue + candidate",logSumExp:"bestValue + candidate",l1:"bestValue + candidate",l2:"bestValue + candidate",logSum:"bestValue + candidate"},ww={max:"_A[offset]",min:"_A[offset]",mean:"0",sum:"0",prod:"1",sumSquare:"0",logSumExp:"0",l1:"0",l2:"0",logSum:"0"},Mw={max:"bestValue",min:"bestValue",sum:"bestValue",prod:"bestValue",sumSquare:"bestValue",logSumExp:"log(bestValue)",l1:"bestValue",l2:"sqrt(bestValue)",logSum:"log(bestValue)"},xw=(e,t)=>{let n=[];for(let s=t-e;s<t;++s)n.push(s);return n},Ew=(e,t)=>{let n=[],s=e.length;for(let o=0;o<s;o++)t.indexOf(o)===-1&&n.push(e[o]);let i=t.map(o=>e[o]);return[n,i]},Tw=(e,t)=>{let n=e.length+t.length,s=[],i=0;for(let o=0;o<n;o++)t.indexOf(o)===-1?s.push(e[i++]):s.push(1);return s},Aw=(e,t)=>{for(let n=0;n<e.length;++n)if(e[e.length-n-1]!==t-1-n)return!1;return!0},Cw=(e,t)=>{let n=[];if(!Aw(e,t)){for(let s=0;s<t;++s)e.indexOf(s)===-1&&n.push(s);e.forEach(s=>n.push(s))}return n},Sw=(e,t,n,s,i,o,c)=>{let d=n[0].dims,u=Ge.size(o),h=Ge.size(c),g=et("_A",n[0].dataType,d),p=Pt("output",i,o),m=64;u===1&&(m=256);let y=`
          var<workgroup> aBestValues : array<f32, ${m}>;
       `,v=T=>`
        ${T.registerUniform("reduceSize","u32").declareVariables(g,p)}
        ${y}
        fn DIV_CEIL(a : u32, b : u32) -> u32 {
          return ((a - 1u) / b + 1u);
         }
         ${T.mainStart(m)}

          let outputIndex = global_idx / ${m};
          let offset = outputIndex * uniforms.reduceSize;

          var bestValue = f32(${ww[s]});
          let Length = uniforms.reduceSize;
          for (var k = local_idx; k < Length; k = k + ${m}) {
           let candidate = f32(${g.getByOffset("offset + k")});
           bestValue = ${yw[s]};
          }
          aBestValues[local_idx] = bestValue;
          workgroupBarrier();

         var reduceSize = min(Length, ${m}u);
         for (var currentSize = reduceSize / 2u; reduceSize > 1u;
             currentSize = reduceSize / 2u) {
           let interval = DIV_CEIL(reduceSize, 2u);
           if (local_idx < currentSize) {
            let candidate = aBestValues[local_idx + interval];
            bestValue = ${bw[s]};
            aBestValues[local_idx] = bestValue;
           }
           reduceSize = interval;
           workgroupBarrier();
         }

         if (local_idx == 0u) {
          ${p.setByOffset("outputIndex",`${s==="mean"?`${p.type.storage}(bestValue / f32(uniforms.reduceSize))`:`${p.type.storage}(${Mw[s]})`}`)};
         }
        }`;return{name:e,shaderCache:{hint:`${t};${m}`,inputDependencies:["type"]},getShaderSource:v,getRunData:()=>({outputs:[{dims:o,dataType:i}],dispatchGroup:{x:u},programUniforms:[{type:12,data:h}]})}},wi=(e,t,n,s)=>{let i=e.inputs.length===1?n:vv(e.inputs,n),o=i.axes;o.length===0&&!i.noopWithEmptyAxes&&(o=e.inputs[0].dims.map((y,v)=>v));let c=Ge.normalizeAxes(o,e.inputs[0].dims.length),d=c,u=e.inputs[0],h=Cw(d,e.inputs[0].dims.length);h.length>0&&(u=e.compute($s(e.inputs[0],h),{inputs:[0],outputs:[-1]})[0],d=xw(d.length,u.dims.length));let[g,p]=Ew(u.dims,d),m=g;i.keepDims&&(m=Tw(g,c)),e.compute(Sw(t,i.cacheKey,[u],s,e.inputs[0].dataType,m,p),{inputs:[u]})},fE=(e,t)=>{wi(e,"ReduceMeanShared",t,"mean")},hE=(e,t)=>{wi(e,"ReduceL1Shared",t,"l1")},pE=(e,t)=>{wi(e,"ReduceL2Shared",t,"l2")},mE=(e,t)=>{wi(e,"ReduceLogSumExpShared",t,"logSumExp")},gE=(e,t)=>{wi(e,"ReduceMaxShared",t,"max")},_E=(e,t)=>{wi(e,"ReduceMinShared",t,"min")},vE=(e,t)=>{wi(e,"ReduceProdShared",t,"prod")},yE=(e,t)=>{wi(e,"ReduceSumShared",t,"sum")},bE=(e,t)=>{wi(e,"ReduceSumSquareShared",t,"sumSquare")},wE=(e,t)=>{wi(e,"ReduceLogSumShared",t,"logSum")}}),Mi,Iw,n_,vv,xi,Pw,kw,Dw,Ow,$w,Bw,Lw,Fw,zw,Nw,Ei,ME,xE,EE,TE,AE,CE,SE,IE,PE,kE,iy=mt(()=>{Xt(),sn(),Hr(),cn(),Xk(),Mi=e=>{if(!e||e.length===0||e.length>2)throw new Error("Reduce op requires 1 or 2 inputs.");if(e.length===2&&e[1].dims.length!==1)throw new Error("Invalid axes input dims.")},Iw=e=>["","",`var value = ${e.getByIndices("input_indices")};`,""],n_=(e,t,n,s,i,o,c=!1,d=!1)=>{let u=[],h=n[0].dims,g=h.length,p=Ge.normalizeAxes(i,g),m=!d&&p.length===0;h.forEach((T,O)=>{m||p.indexOf(O)>=0?c&&u.push(1):u.push(T)});let y=u.length,v=Ge.size(u);return{name:e,shaderCache:t,getShaderSource:T=>{let O=[],E=et("_A",n[0].dataType,g),S=Pt("output",o,y),D=s(E,S,p),I=D[2];for(let M=0,C=0;M<g;M++)m||p.indexOf(M)>=0?(c&&C++,I=`for(var j${M}: u32 = 0; j${M} < ${h[M]}; j${M}++) {
                  ${D[2].includes("last_index")?`let last_index = j${M};`:""}
                  ${E.indicesSet("input_indices",M,`j${M}`)}
                  ${I}
                }`):(O.push(`${E.indicesSet("input_indices",M,S.indicesGet("output_indices",C))};`),C++);return`

        ${T.registerUniform("output_size","u32").declareVariables(E,S)}

        ${T.mainStart()}
          ${T.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
          var input_indices: ${E.type.indices};
          let output_indices = ${S.offsetToIndices("global_idx")};

          ${O.join(`
`)}
          ${D[0]}       // init ops for reduce max/min
          ${D[1]}
          ${I}
          ${D[3]}
          ${D.length===4?S.setByOffset("global_idx","value"):D.slice(4).join(`
`)}
        }`},getRunData:()=>({outputs:[{dims:u,dataType:o}],dispatchGroup:{x:Math.ceil(v/64)},programUniforms:[{type:12,data:v},...zt(h,u)]})}},vv=(e,t)=>{let n=[];return e[1].dims[0]>0&&e[1].getBigInt64Array().forEach(s=>n.push(Number(s))),Nn({axes:n,keepDims:t.keepDims,noopWithEmptyAxes:t.noopWithEmptyAxes})},xi=(e,t,n,s)=>{let i=e.inputs,o=i.length===1?n:vv(i,n);e.compute(n_(t,{hint:o.cacheKey,inputDependencies:["rank"]},[i[0]],o.noopWithEmptyAxes&&o.axes.length===0?Iw:s,o.axes,i[0].dataType,o.keepDims,o.noopWithEmptyAxes),{inputs:[0]})},Pw=(e,t)=>{Mi(e.inputs),xi(e,"ReduceLogSum",t,(n,s)=>[`var value = ${s.type.storage}(0);`,"",`value += ${n.getByIndices("input_indices")};`,"value = log(value);"])},kw=(e,t)=>{Mi(e.inputs),xi(e,"ReduceL1",t,(n,s)=>[`var value = ${s.type.storage}(0);`,"",`value += abs(${n.getByIndices("input_indices")});`,""])},Dw=(e,t)=>{Mi(e.inputs),xi(e,"ReduceL2",t,(n,s)=>[`var t = ${s.type.value}(0); var value = ${s.type.value}(0);`,"",`t = ${n.getByIndices("input_indices")}; value += (t * t);`,"value = sqrt(value);"])},Ow=(e,t)=>{Mi(e.inputs),xi(e,"ReduceLogSumExp",t,(n,s)=>[`var value = ${s.type.storage}(0);`,"",`value += exp(${n.getByIndices("input_indices")});`,"value = log(value);"])},$w=(e,t)=>{Mi(e.inputs),xi(e,"ReduceMax",t,(n,s,i)=>{let o=[];for(let c=0;c<n.rank;c++)(i.indexOf(c)>=0||i.length===0)&&o.push(n.indicesSet("input_indices",c,0));return[`${o.join(`
`)}`,`var value = ${n.getByIndices("input_indices")};`,`value = max(value, ${n.getByIndices("input_indices")});`,""]})},Bw=(e,t)=>{Mi(e.inputs),xi(e,"ReduceMean",t,(n,s,i)=>{let o=1;for(let c=0;c<n.rank;c++)(i.indexOf(c)>=0||i.length===0)&&(o*=e.inputs[0].dims[c]);return["var sum = f32(0);","",`sum += f32(${n.getByIndices("input_indices")});`,`let value = ${s.type.value}(sum / ${o});`]})},Lw=(e,t)=>{Mi(e.inputs),xi(e,"ReduceMin",t,(n,s,i)=>{let o=[];for(let c=0;c<n.rank;c++)(i.indexOf(c)>=0||i.length===0)&&o.push(`input_indices[${c}] = 0;`);return[`${o.join(`
`)}`,`var value = ${n.getByIndices("input_indices")};`,`value = min(value, ${n.getByIndices("input_indices")});`,""]})},Fw=(e,t)=>{Mi(e.inputs),xi(e,"ReduceProd",t,(n,s)=>[`var value = ${s.type.storage}(1);`,"",`value *= ${n.getByIndices("input_indices")};`,""])},zw=(e,t)=>{Mi(e.inputs),xi(e,"ReduceSum",t,(n,s)=>[`var value = ${s.type.storage}(0);`,"",`value += ${n.getByIndices("input_indices")};`,""])},Nw=(e,t)=>{Mi(e.inputs),xi(e,"ReduceSumSquare",t,(n,s)=>[`var t = ${s.type.value}(0); var value = ${s.type.value}(0);`,"",`t = ${n.getByIndices("input_indices")}; value += t * t;`,""])},Ei=(e,t,n)=>{if(t.length===0)return n;let s=1,i=1;for(let o=0;o<t.length;o++)t.indexOf(o)===-1?s*=e[o]:i*=e[o];return i<32&&s>1024},ME=(e,t)=>{Ei(e.inputs[0].dims,t.axes,t.noopWithEmptyAxes)?Bw(e,t):fE(e,t)},xE=(e,t)=>{Ei(e.inputs[0].dims,t.axes,t.noopWithEmptyAxes)?kw(e,t):hE(e,t)},EE=(e,t)=>{Ei(e.inputs[0].dims,t.axes,t.noopWithEmptyAxes)?Dw(e,t):pE(e,t)},TE=(e,t)=>{Ei(e.inputs[0].dims,t.axes,t.noopWithEmptyAxes)?Ow(e,t):mE(e,t)},AE=(e,t)=>{Ei(e.inputs[0].dims,t.axes,t.noopWithEmptyAxes)?$w(e,t):gE(e,t)},CE=(e,t)=>{Ei(e.inputs[0].dims,t.axes,t.noopWithEmptyAxes)?Lw(e,t):_E(e,t)},SE=(e,t)=>{Ei(e.inputs[0].dims,t.axes,t.noopWithEmptyAxes)?Fw(e,t):vE(e,t)},IE=(e,t)=>{Ei(e.inputs[0].dims,t.axes,t.noopWithEmptyAxes)?zw(e,t):yE(e,t)},PE=(e,t)=>{Ei(e.inputs[0].dims,t.axes,t.noopWithEmptyAxes)?Nw(e,t):bE(e,t)},kE=(e,t)=>{Ei(e.inputs[0].dims,t.axes,t.noopWithEmptyAxes)?Pw(e,t):wE(e,t)}}),p0,DE,OE,yv,Yk=mt(()=>{Xt(),Hr(),iy(),p0=e=>{if(!e||e.length===0||e.length>2)throw new Error("ArgMinMaxOp op requires 1 or 2 inputs.");if(e[0].dataType!==1)throw new Error("Invalid input type.")},DE=(e,t)=>{p0(e.inputs);let n=(s,i,o)=>{let c=[];for(let d=0;d<s.rank;d++)(o.indexOf(d)>=0||o.length===0)&&c.push(`input_indices[${d}] = 0;`);return[`${c.join(`
`)}`,`var value = ${s.getByIndices("input_indices")};
var best_index : i32 = 0;`,`if (${s.getByIndices("input_indices")} ${t.selectLastIndex>0?"<=":"<"} value) {
         value = ${s.getByIndices("input_indices")};
         best_index = i32(last_index);
       }`,"",i.setByOffset("global_idx","best_index")]};e.compute(n_("ArgMin",{hint:t.cacheKey,inputDependencies:["rank"]},[e.inputs[0]],n,[t.axis],7,t.keepDims),{inputs:[0]})},OE=(e,t)=>{p0(e.inputs);let n=(s,i,o)=>{let c=[];for(let d=0;d<s.rank;d++)(o.indexOf(d)>=0||o.length===0)&&c.push(`input_indices[${d}] = 0;`);return[`${c.join(`
`)}`,`var value = ${s.getByIndices("input_indices")};
var best_index : i32 = 0;`,`if (${s.getByIndices("input_indices")} ${t.selectLastIndex>0?">=":">"} value) {
         value = ${s.getByIndices("input_indices")};
         best_index = i32(last_index);
       }`,"",i.setByOffset("global_idx","best_index")]};e.compute(n_("argMax",{hint:t.cacheKey,inputDependencies:["rank"]},[e.inputs[0]],n,[t.axis],7,t.keepDims),{inputs:[0]})},yv=e=>Nn(e)}),Rw,xg,jw,Uw,Vw,mm,Gw,$E,oy=mt(()=>{Xt(),sn(),ay(),cn(),Rw=(e,t)=>{let n=e[0],s=e[1],i=e[2],o=e[3],c=e[4],d=e[5];if(c&&d)throw new Error("Attention cannot have both past and attention_bias");if(n.dims.length!==3)throw new Error('Input "input" must have 3 dimensions');let u=n.dims[0],h=n.dims[1],g=n.dims[2];if(i.dims.length!==1)throw new Error('Input "bias" is expected to have 1 dimensions');if(s.dims.length!==2)throw new Error('Input "weights" is expected to have 2 dimensions');if(s.dims[0]!==g)throw new Error("Input 1 dimension 0 should have same length as dimension 2 of input 0");if(i.dims[0]!==s.dims[1])throw new Error('Input "bias" dimension 0 should have same length as dimension 1 of input "weights"');let p=i.dims[0]/3,m=p,y=m;if(t.qkvHiddenSizes.length>0){if(t.qkvHiddenSizes.length!==3)throw new Error("qkv_hidden_sizes attribute should have 3 elements");for(let D of t.qkvHiddenSizes)if(D%t.numHeads!==0)throw new Error("qkv_hidden_sizes should be divisible by num_heads");p=t.qkvHiddenSizes[0],m=t.qkvHiddenSizes[1],y=t.qkvHiddenSizes[2]}let v=h;if(p!==m)throw new Error("qkv_hidden_sizes first element should be same as the second");if(i.dims[0]!==p+m+y)throw new Error('Input "bias" dimension 0 should have same length as sum of Q/K/V hidden sizes');let T=0;if(c){if(m!==y)throw new Error('Input "past" expect k_hidden_size == v_hidden_size');if(c.dims.length!==5)throw new Error('Input "past" must have 5 dimensions');if(c.dims[0]!==2)throw new Error('Input "past" first dimension must be 2');if(c.dims[1]!==u)throw new Error('Input "past" second dimension must be batch_size');if(c.dims[2]!==t.numHeads)throw new Error('Input "past" third dimension must be num_heads');if(c.dims[4]!==m/t.numHeads)throw new Error('Input "past" fifth dimension must be k_hidden_size / num_heads');t.pastPresentShareBuffer||(T=c.dims[3])}let O=v+T,E=-1,S=0;if(o)throw new Error("Mask not supported");if(c)throw new Error("past is not supported");if(d){if(d.dims.length!==4)throw new Error('Input "attention_bias" must have 4 dimensions');if(d.dims[0]!==u||d.dims[1]!==t.numHeads||d.dims[2]!==h||d.dims[3]!==O)throw new Error('Expect "attention_bias" shape (batch_size, num_heads, sequence_length, total_sequence_length)')}return{batchSize:u,sequenceLength:h,pastSequenceLength:T,kvSequenceLength:v,totalSequenceLength:O,maxSequenceLength:E,inputHiddenSize:g,hiddenSize:p,vHiddenSize:y,headSize:Math.floor(p/t.numHeads),vHeadSize:Math.floor(y/t.numHeads),numHeads:t.numHeads,isUnidirectional:!1,pastPresentShareBuffer:!1,maskFilterValue:t.maskFilterValue,maskType:S,scale:t.scale,broadcastResPosBias:!1,passPastInKv:!1,qkvFormat:1}},xg=(e,t,n)=>t&&e?`
      let total_sequence_length_input = u32(${t.getByOffset("0")});
      let present_sequence_length = max(total_sequence_length_input, uniforms.past_sequence_length);
      let is_subsequent_prompt: bool = sequence_length > 1 && sequence_length != total_sequence_length_input;
      let is_first_prompt: bool = is_subsequent_prompt == false && sequence_length == total_sequence_length_input;
      total_sequence_length = u32(${e==null?void 0:e.getByOffset("batchIdx")}) + 1;
      var past_sequence_length: u32 = 0;
      if (is_first_prompt == false) {
        past_sequence_length = total_sequence_length - sequence_length;
      }
       `:`
    ${n?"let past_sequence_length = uniforms.past_sequence_length":""};
    let present_sequence_length = total_sequence_length;
    `,jw=(e,t,n,s,i,o,c,d)=>{let u=Lr(c?1:o),h=64,g=o/u;g<h&&(h=32);let p=Math.ceil(o/u/h),m=[{type:12,data:t},{type:12,data:n},{type:12,data:s},{type:12,data:i},{type:12,data:g},{type:12,data:p}],y=ga(e.dataType,u),v=Ga(1,u),T=["type"];c&&T.push("type"),d&&T.push("type");let O=E=>{let S=Pt("x",e.dataType,e.dims,u),D=[S],I=c?et("seq_lens",c.dataType,c.dims):void 0;I&&D.push(I);let M=d?et("total_sequence_length_input",d.dataType,d.dims):void 0;M&&D.push(M);let C=Ga(e.dataType),A=[{name:"batch_size",type:"u32"},{name:"num_heads",type:"u32"},{name:"past_sequence_length",type:"u32"},{name:"sequence_length",type:"u32"},{name:"total_sequence_length",type:"u32"},{name:"elements_per_thread",type:"u32"}];return`
  var<workgroup> thread_max: array<f32, ${h}>;
  var<workgroup> thread_sum: array<f32, ${h}>;
  ${E.registerUniforms(A).declareVariables(...D)}
  ${E.mainStart([h,1,1])}
    let batchIdx = workgroup_id.z / uniforms.num_heads;
    let headIdx = workgroup_id.z % uniforms.num_heads;
    let sequence_length = uniforms.sequence_length;
    var total_sequence_length = uniforms.total_sequence_length;
    ${xg(I,M,!1)}
    let local_offset = local_idx * uniforms.elements_per_thread;
    let offset = (global_idx / ${h}) * uniforms.total_sequence_length + local_offset;
    let seq_causal_length = ${c?"u32(past_sequence_length + workgroup_id.y + 1)":"total_sequence_length"};
    var thread_max_vector = ${v}(-3.402823e+38f);
    for (var i: u32 = 0; i < uniforms.elements_per_thread && i + local_offset < seq_causal_length; i++) {
      thread_max_vector = max(${v}(x[offset + i]), thread_max_vector);
    }
    thread_max[local_idx] = ${(()=>{switch(u){case 1:return"thread_max_vector";case 2:return"max(thread_max_vector.x, thread_max_vector.y)";case 4:return"max(max(thread_max_vector.x, thread_max_vector.y), max(thread_max_vector.z, thread_max_vector.w))";default:throw new Error(`Unsupported components: ${u}`)}})()};
    workgroupBarrier();

    var max_value =  f32(-3.402823e+38f);
    for (var i = 0u; i < ${h}; i++) {
      max_value = max(thread_max[i], max_value);
    }

    var sum_vector = ${v}(0);
    for (var i: u32 = 0; i < uniforms.elements_per_thread && i + local_offset < seq_causal_length; i++) {
      sum_vector += exp(${v}(x[offset + i]) - max_value);
    }
    thread_sum[local_idx] = ${(()=>{switch(u){case 1:return"sum_vector";case 2:return"sum_vector.x + sum_vector.y";case 4:return"sum_vector.x + sum_vector.y + sum_vector.z + sum_vector.w";default:throw new Error(`Unsupported components: ${u}`)}})()};
    workgroupBarrier();

    var sum: f32 = 0;
    for (var i = 0u; i < ${h}; i++) {
      sum += thread_sum[i];
    }

    if (sum == 0) {
      for (var i: u32 = 0; i < uniforms.elements_per_thread && i + local_offset < seq_causal_length; i++) {
        x[offset + i] = ${S.type.value}(${C}(1.0) / ${C}(seq_causal_length));
      }
    } else {
      for (var i: u32 = 0; i < uniforms.elements_per_thread && i + local_offset < seq_causal_length; i++) {
        var f32input = ${v}(x[offset + i]);
        x[offset + i] = ${S.type.value}(exp(f32input - max_value) / sum);
      }
    }
      ${c?`
        for (var total_seq_id: u32 = seq_causal_length; total_seq_id + local_offset < uniforms.total_sequence_length; total_seq_id++) {
          x[offset + total_seq_id] = ${S.type.value}(${C}(0));
        }`:""};
  }`};return{name:"AttentionProbsSoftmax",shaderCache:{hint:`${h};${y};${u}`,inputDependencies:T},getShaderSource:O,getRunData:()=>({outputs:[],dispatchGroup:{x:1,y:i,z:t*n},programUniforms:m})}},Uw=(e,t,n,s,i,o,c,d,u)=>{let h=c+o.kvSequenceLength,g=[o.batchSize,o.numHeads,o.sequenceLength,h],p=e>1&&s,m=o.kvNumHeads?o.kvNumHeads:o.numHeads,y=p?[o.batchSize,m,h,o.headSize]:void 0,v=o.nReps?o.nReps:1,T=o.scale===0?1/Math.sqrt(o.headSize):o.scale,O=Lr(o.headSize),E=o.headSize/O,S=12,D={x:Math.ceil(h/S),y:Math.ceil(o.sequenceLength/S),z:o.batchSize*o.numHeads},I=[{type:12,data:o.sequenceLength},{type:12,data:E},{type:12,data:h},{type:12,data:o.numHeads},{type:12,data:o.headSize},{type:1,data:T},{type:12,data:c},{type:12,data:o.kvSequenceLength},{type:12,data:v}],M=p&&s&&Ge.size(s.dims)>0,C=["type","type"];M&&C.push("type"),i&&C.push("type"),d&&C.push("type"),u&&C.push("type");let A=[{dims:g,dataType:t.dataType,gpuDataType:0}];p&&A.push({dims:y,dataType:t.dataType,gpuDataType:0});let k=R=>{let G=et("q",t.dataType,t.dims,O),te=et("key",n.dataType,n.dims,O),ee=[G,te];if(M){let ve=et("past_key",s.dataType,s.dims,O);ee.push(ve)}i&&ee.push(et("attention_bias",i.dataType,i.dims));let X=d?et("seq_lens",d.dataType,d.dims):void 0;X&&ee.push(X);let le=u?et("total_sequence_length_input",u.dataType,u.dims):void 0;le&&ee.push(le);let ae=Pt("output",t.dataType,g),Q=[ae];p&&Q.push(Pt("present_key",t.dataType,y,O));let ne=Ga(1,O),de=[{name:"M",type:"u32"},{name:"K",type:"u32"},{name:"N",type:"u32"},{name:"num_heads",type:"u32"},{name:"head_size",type:"u32"},{name:"alpha",type:"f32"},{name:"past_sequence_length",type:"u32"},{name:"kv_sequence_length",type:"u32"},{name:"n_reps",type:"u32"}];return`
  const TILE_SIZE = ${S}u;

  var<workgroup> tileQ: array<${G.type.storage}, ${S*S}>;
  var<workgroup> tileK: array<${G.type.storage}, ${S*S}>;
  ${R.registerUniforms(de).declareVariables(...ee,...Q)}
  ${R.mainStart([S,S,1])}
    // x holds the N and y holds the M
    let headIdx = workgroup_id.z % uniforms.num_heads;
    let kvHeadIdx = ${v===1?"headIdx":"headIdx / uniforms.n_reps"};
    let kv_num_heads = ${v===1?"uniforms.num_heads":"uniforms.num_heads / uniforms.n_reps"};
    let batchIdx = workgroup_id.z / uniforms.num_heads;
    let m = workgroup_id.y * TILE_SIZE;
    let n = workgroup_id.x * TILE_SIZE;
    let sequence_length = uniforms.M;
    var total_sequence_length = uniforms.N;
    ${xg(X,le,!0)}
    let absKvHeadIdx = batchIdx * kv_num_heads + kvHeadIdx;
    let qOffset = workgroup_id.z * uniforms.M * uniforms.K + m * uniforms.K;
    ${M&&p?"let pastKeyOffset = absKvHeadIdx * uniforms.past_sequence_length * uniforms.K;":""};
    let kOffset = absKvHeadIdx * uniforms.kv_sequence_length * uniforms.K;
    ${p?"let presentKeyOffset = absKvHeadIdx * uniforms.N * uniforms.K;":""}
    var value = ${ne}(0);
    for (var w: u32 = 0u; w < uniforms.K; w += TILE_SIZE) {
      if (global_id.y < uniforms.M && w + local_id.x < uniforms.K) {
        tileQ[TILE_SIZE * local_id.y + local_id.x] = q[qOffset + local_id.y * uniforms.K + w + local_id.x];
      }
      if (n + local_id.y < uniforms.N && w + local_id.x < uniforms.K) {
        var idx = TILE_SIZE * local_id.y + local_id.x;
      ${M&&p?`
              if (n + local_id.y < past_sequence_length) {
                tileK[idx] = past_key[pastKeyOffset + (n + local_id.y) * uniforms.K + w + local_id.x];
              } else if (n + local_id.y - past_sequence_length < uniforms.kv_sequence_length) {
                tileK[idx] = key[kOffset + (n + local_id.y - past_sequence_length) * uniforms.K + w + local_id.x];
              }`:`
          if (n + local_id.y < uniforms.kv_sequence_length) {
            tileK[idx] = key[kOffset + (n + local_id.y) * uniforms.K + w + local_id.x];
          }`}
      ${p?`if (n + local_id.y < present_sequence_length) {
        present_key[presentKeyOffset + (n + local_id.y) * uniforms.K + w + local_id.x] = tileK[idx];
      }`:""}
      }
      workgroupBarrier();

      for (var k: u32 = 0u; k < TILE_SIZE && w+k < uniforms.K; k++) {
          value += ${ne}(tileQ[TILE_SIZE * local_id.y + k] * tileK[TILE_SIZE * local_id.x + k]);
      }

      workgroupBarrier();
    }

    if (global_id.y < uniforms.M && global_id.x < total_sequence_length) {
      let headOffset = workgroup_id.z * uniforms.M * uniforms.N;
      let outputIdx = headOffset + global_id.y * uniforms.N + global_id.x;
      var sum: f32 = ${(()=>{switch(O){case 1:return"value";case 2:return"value.x + value.y";case 4:return"value.x + value.y + value.z + value.w";default:throw new Error(`Unsupported components: ${O}`)}})()};
        output[outputIdx] = ${ae.type.value} (sum * uniforms.alpha) + ${i?"attention_bias[outputIdx]":"0.0"};
    }
  }`};return{name:"AttentionProbs",shaderCache:{hint:`${O};${i!==void 0};${s!==void 0};${e}`,inputDependencies:C},getRunData:()=>({outputs:A,dispatchGroup:D,programUniforms:I}),getShaderSource:k}},Vw=(e,t,n,s,i,o,c=void 0,d=void 0)=>{let u=o+i.kvSequenceLength,h=i.nReps?i.nReps:1,g=i.vHiddenSize*h,p=e>1&&s,m=i.kvNumHeads?i.kvNumHeads:i.numHeads,y=p?[i.batchSize,m,u,i.headSize]:void 0,v=[i.batchSize,i.sequenceLength,g],T=12,O={x:Math.ceil(i.vHeadSize/T),y:Math.ceil(i.sequenceLength/T),z:i.batchSize*i.numHeads},E=[{type:12,data:i.sequenceLength},{type:12,data:u},{type:12,data:i.vHeadSize},{type:12,data:i.numHeads},{type:12,data:i.headSize},{type:12,data:g},{type:12,data:o},{type:12,data:i.kvSequenceLength},{type:12,data:h}],S=p&&s&&Ge.size(s.dims)>0,D=["type","type"];S&&D.push("type"),c&&D.push("type"),d&&D.push("type");let I=[{dims:v,dataType:t.dataType,gpuDataType:0}];p&&I.push({dims:y,dataType:t.dataType,gpuDataType:0});let M=C=>{let A=et("probs",t.dataType,t.dims),k=et("v",n.dataType,n.dims),R=[A,k];S&&R.push(et("past_value",s.dataType,s.dims));let G=c?et("seq_lens",c.dataType,c.dims):void 0;c&&R.push(G);let te=d?et("total_sequence_length_input",d.dataType,d.dims):void 0;d&&R.push(te);let ee=[Pt("output",t.dataType,v)];p&&ee.push(Pt("present_value",t.dataType,y));let X=[{name:"M",type:"u32"},{name:"K",type:"u32"},{name:"N",type:"u32"},{name:"num_heads",type:"u32"},{name:"head_size",type:"u32"},{name:"v_hidden_size",type:"u32"},{name:"past_sequence_length",type:"u32"},{name:"kv_sequence_length",type:"u32"},{name:"n_reps",type:"u32"}];return`
  const TILE_SIZE = ${T}u;
  var<workgroup> tileQ: array<${A.type.value}, ${T*T}>;
  var<workgroup> tileV: array<${A.type.value}, ${T*T}>;
  ${C.registerUniforms(X).declareVariables(...R,...ee)}
  ${C.mainStart([T,T,1])}
   let headIdx = workgroup_id.z % uniforms.num_heads;
   let batchIdx = workgroup_id.z / uniforms.num_heads;
   let kvHeadIdx = ${h===1?"headIdx":"headIdx / uniforms.n_reps"};
   let kv_num_heads = ${h===1?"uniforms.num_heads":"uniforms.num_heads / uniforms.n_reps"};
   let m = global_id.y;
   let n = global_id.x;
   let sequence_length = uniforms.M;
   var total_sequence_length = uniforms.K;
   ${xg(G,te,!0)}
   let offsetA = workgroup_id.z * uniforms.M * uniforms.K + m * uniforms.K;
   let absKvHeadIdx = batchIdx * kv_num_heads + kvHeadIdx; // kvHeadIdx is relative to the batch
   ${S&&p?"let pastValueOffset = absKvHeadIdx * uniforms.N * uniforms.past_sequence_length + n;":""};
   let vOffset = absKvHeadIdx * uniforms.N * uniforms.kv_sequence_length + n;
   ${p?"let presentValueOffset = absKvHeadIdx * uniforms.N * uniforms.K + n;":""}
   var value = ${A.type.storage}(0);
   for (var w: u32 = 0u; w < uniforms.K; w += TILE_SIZE) {
      if (m < uniforms.M && w + local_id.x < uniforms.K) {
        tileQ[TILE_SIZE * local_id.y + local_id.x] = probs[offsetA + w + local_id.x];
      }
      if (n < uniforms.N && w + local_id.y < uniforms.K) {
        var idx = TILE_SIZE * local_id.y + local_id.x;
        ${S&&p?`
        if (w + local_id.y < past_sequence_length) {
          tileV[idx] = past_value[pastValueOffset + (w + local_id.y) * uniforms.N];
        } else if (w + local_id.y - past_sequence_length < uniforms.kv_sequence_length) {
          tileV[idx] = v[vOffset + (w + local_id.y - past_sequence_length) * uniforms.N];
        }
      `:`
            if (w + local_id.y < uniforms.kv_sequence_length) {
              tileV[idx] = v[vOffset + (w + local_id.y) * uniforms.N];
            }`}
        ${p?`
            if (w + local_id.y < present_sequence_length) {
          present_value[presentValueOffset + (w + local_id.y) * uniforms.N] = tileV[idx];
        }`:""}
      }
     workgroupBarrier();
     for (var k: u32 = 0u; k < TILE_SIZE && w+k < total_sequence_length; k++) {
       value += tileQ[TILE_SIZE * local_id.y + k] * tileV[TILE_SIZE * k + local_id.x];
     }
     workgroupBarrier();
   }

   // we need to transpose output from BNSH_v to BSND_v
   if (m < uniforms.M && n < uniforms.N) {
     let outputIdx = batchIdx * uniforms.M * uniforms.v_hidden_size + m * uniforms.v_hidden_size
       + headIdx * uniforms.N + n;
     output[outputIdx] = value;
   }
  }`};return{name:"AttentionScore",shaderCache:{hint:`${s!==void 0};${e}`,inputDependencies:D},getRunData:()=>({outputs:I,dispatchGroup:O,programUniforms:E}),getShaderSource:M}},mm=(e,t,n,s,i,o,c,d,u,h,g=void 0,p=void 0)=>{let m=Math.min(e.outputCount,1+(c?1:0)+(d?1:0)),y=m>1?h.pastSequenceLength:0,v=y+h.kvSequenceLength,T=u&&Ge.size(u.dims)>0?u:void 0,O=[t,n];m>1&&c&&Ge.size(c.dims)>0&&O.push(c),T&&O.push(T),g&&O.push(g),p&&O.push(p);let E=e.compute(Uw(m,t,n,c,T,h,y,g,p),{inputs:O,outputs:m>1?[-1,1]:[-1]})[0];e.compute(jw(E,h.batchSize,h.numHeads,y,h.sequenceLength,v,g,p),{inputs:g&&p?[E,g,p]:[E],outputs:[]});let S=[E,s];m>1&&d&&Ge.size(d.dims)>0&&S.push(d),g&&S.push(g),p&&S.push(p),e.compute(Vw(m,E,s,d,h,y,g,p),{inputs:S,outputs:m>1?[0,2]:[0]})},Gw=(e,t)=>{let n=[t.batchSize,t.numHeads,t.sequenceLength,t.headSize],s=t.sequenceLength,i=t.inputHiddenSize,o=t.headSize,c=12,d={x:Math.ceil(t.headSize/c),y:Math.ceil(t.sequenceLength/c),z:t.batchSize*t.numHeads},u=[e.inputs[0],e.inputs[1],e.inputs[2]],h=[{type:12,data:s},{type:12,data:i},{type:12,data:o},{type:12,data:t.numHeads},{type:12,data:t.headSize},{type:12,data:t.hiddenSize},{type:12,data:t.hiddenSize+t.hiddenSize+t.vHiddenSize}],g=p=>{let m=Pt("output_q",u[0].dataType,n),y=Pt("output_k",u[0].dataType,n),v=Pt("output_v",u[0].dataType,n),T=et("input",u[0].dataType,u[0].dims),O=et("weight",u[1].dataType,u[1].dims),E=et("bias",u[2].dataType,u[2].dims),S=T.type.storage,D=[{name:"M",type:"u32"},{name:"K",type:"u32"},{name:"N",type:"u32"},{name:"num_heads",type:"u32"},{name:"head_size",type:"u32"},{name:"hidden_size",type:"u32"},{name:"ldb",type:"u32"}];return`
  const TILE_SIZE = ${c}u;
  var<workgroup> tileInput: array<${S}, ${c*c}>;
  var<workgroup> tileWeightQ: array<${S}, ${c*c}>;
  var<workgroup> tileWeightK: array<${S}, ${c*c}>;
  var<workgroup> tileWeightV: array<${S}, ${c*c}>;
  ${p.registerUniforms(D).declareVariables(T,O,E,m,y,v)}
  ${p.mainStart([c,c,1])}
    let batchIndex = workgroup_id.z / uniforms.num_heads;
    let headNumber = workgroup_id.z % uniforms.num_heads;
    let m = global_id.y;
    let n = global_id.x;

    let inputOffset = batchIndex * (uniforms.M * uniforms.K) + m * uniforms.K;
    let biasOffsetQ = headNumber * uniforms.head_size;
    let biasOffsetK = uniforms.hidden_size + biasOffsetQ;
    let biasOffsetV = uniforms.hidden_size + biasOffsetK;

    var valueQ = ${S}(0);
    var valueK = ${S}(0);
    var valueV = ${S}(0);
    for (var w: u32 = 0u; w < uniforms.K; w += TILE_SIZE) {
      if (m < uniforms.M && w + local_id.x < uniforms.K) {
        tileInput[TILE_SIZE * local_id.y + local_id.x] = input[inputOffset + w + local_id.x];
      }
      if (n < uniforms.N && w + local_id.y < uniforms.K) {
        let offset = n + (w + local_id.y) * uniforms.ldb;
        tileWeightQ[TILE_SIZE * local_id.y + local_id.x] = weight[biasOffsetQ + offset];
        tileWeightK[TILE_SIZE * local_id.y + local_id.x] = weight[biasOffsetK + offset];
        tileWeightV[TILE_SIZE * local_id.y + local_id.x] = weight[biasOffsetV + offset];
      }
      workgroupBarrier();
      for (var k: u32 = 0u; k<TILE_SIZE && w+k < uniforms.K; k++) {
        let inputTileOffset = TILE_SIZE * local_id.y + k;
        let weightTileOffset = TILE_SIZE * k + local_id.x;
        valueQ += tileInput[inputTileOffset] * tileWeightQ[weightTileOffset];
        valueK += tileInput[inputTileOffset] * tileWeightK[weightTileOffset];
        valueV += tileInput[inputTileOffset] * tileWeightV[weightTileOffset];
      }

      workgroupBarrier();
    }

    let headOffset = (m * uniforms.N + n) % uniforms.head_size;
    valueQ += bias[headOffset + biasOffsetQ];
    valueK += bias[headOffset + biasOffsetK];
    valueV += bias[headOffset + biasOffsetV];

    let offset = workgroup_id.z * uniforms.M * uniforms.N;
    if (m < uniforms.M && n < uniforms.N) {
      let outputIdx = offset + m * uniforms.N + n;
      output_q[outputIdx] = valueQ;
      output_k[outputIdx] = valueK;
      output_v[outputIdx] = valueV;
    }
  }`};return e.compute({name:"AttentionPrepare",shaderCache:{inputDependencies:["type","type","type"]},getRunData:()=>({outputs:[{dims:n,dataType:e.inputs[0].dataType,gpuDataType:0},{dims:n,dataType:e.inputs[0].dataType,gpuDataType:0},{dims:n,dataType:e.inputs[0].dataType,gpuDataType:0}],dispatchGroup:d,programUniforms:h}),getShaderSource:g},{inputs:u,outputs:[-1,-1,-1]})},$E=(e,t)=>{let n=Rw(e.inputs,t),[s,i,o]=Gw(e,n);return mm(e,s,i,o,e.inputs[4],void 0,void 0,void 0,e.inputs[5],n)}}),Ww,Hw,Qw,BE,Jk=mt(()=>{Ii(),Xt(),sn(),Hr(),cn(),Ww=(e,t)=>{if(!e||e.length!==5)throw new Error("BatchNormalization requires 5 inputs");let n=(s,i,o)=>{let c=i.length;if(c!==s.length)throw new Error(`${o}: num dimensions != ${c}`);i.forEach((d,u)=>{if(d!==s[u])throw new Error(`${o}: dim[${u}] do not match`)})};if(e[0].dims.length>1){let s=t.format==="NHWC"?t.spatial?e[0].dims.slice(-1):e[0].dims.slice(-1).concat(e[0].dims.slice(1,e[0].dims.length-1)):e[0].dims.slice(1,t.spatial?2:void 0);n(e[1].dims,s,"Invalid input scale"),n(e[2].dims,s,"Invalid input B"),n(e[3].dims,s,"Invalid input mean"),n(e[4].dims,s,"Invalid input var")}else n(e[1].dims,[1],"Invalid input scale"),n(e[2].dims,[1],"Invalid input B"),n(e[3].dims,[1],"Invalid input mean"),n(e[4].dims,[1],"Invalid input var")},Hw=(e,t)=>{let{epsilon:n,spatial:s,format:i}=t,o=e[0].dims,c=s?Lr(o[o.length-1]):1,d=i==="NHWC"&&o.length>1?c:1,u=Ge.size(o)/c,h=s,g=h?o.length:o,p=et("x",e[0].dataType,e[0].dims,c),m=et("scale",e[1].dataType,e[1].dims,d),y=et("bias",e[2].dataType,e[2].dims,d),v=et("inputMean",e[3].dataType,e[3].dims,d),T=et("inputVar",e[4].dataType,e[4].dims,d),O=Pt("y",e[0].dataType,g,c),E=()=>{let D="";if(s)D=`let cOffset = ${o.length===1?"0u":i==="NHWC"?`outputIndices[${o.length-1}] / ${c}`:"outputIndices[1]"};`;else if(i==="NCHW")D=`
            ${O.indicesSet("outputIndices","0","0")}
            let cOffset = ${O.indicesToOffset("outputIndices")};`;else{D=`var cIndices = ${m.type.indices}(0);
                       cIndices[0] = outputIndices[${o.length-1}];`;for(let I=1;I<m.rank;I++)D+=`cIndices[${I}] = outputIndices[${I}];`;D+=`let cOffset = ${m.indicesToOffset("cIndices")};`}return D},S=D=>`
  const epsilon = ${n};
  ${D.registerUniform("outputSize","u32").declareVariables(p,m,y,v,T,O)}
  ${D.mainStart()}
  ${D.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.outputSize")}
    var outputIndices = ${O.offsetToIndices(`global_idx * ${c}`)};
    ${E()}
    let scale = ${m.getByOffset("cOffset")};
    let bias = ${y.getByOffset("cOffset")};
    let inputMean = ${v.getByOffset("cOffset")};
    let inputVar = ${T.getByOffset("cOffset")};
    let x = ${p.getByOffset("global_idx")};
    let value = (x - inputMean) * inverseSqrt(inputVar + epsilon) * scale + bias;
    ${O.setByOffset("global_idx","value")}
  }`;return{name:"BatchNormalization",shaderCache:{hint:`${t.epsilon}_${t.format}_${s}_${c}`,inputDependencies:h?["rank","type","type","type","type"]:void 0},getShaderSource:S,getRunData:()=>({outputs:[{dims:e[0].dims,dataType:e[0].dataType}],dispatchGroup:{x:Math.ceil(u/64)},programUniforms:h?[{type:12,data:u},...zt(o)]:[{type:12,data:u}]})}},Qw=e=>Nn(e),BE=(e,t)=>{let{inputs:n,outputCount:s}=e,i=Qw({...t,outputCount:s});if(br.webgpu.validateInputContent&&Ww(n,i),t.trainingMode)throw new Error("BatchNormalization trainingMode is not supported yet.");e.compute(Hw(n,i))}}),qw,Kw,LE,Zk=mt(()=>{sn(),cn(),qw=e=>{if(e[0].dims.length!==3)throw new Error("input should have 3 dimensions");if(![320,640,1280].includes(e[0].dims[2]))throw new Error("number of channels should be 320, 640 or 1280");if(e[1].dims.length!==1)throw new Error("bias is expected to have 1 dimensions");if(e[0].dims[2]!==e[1].dims[0])throw new Error("last dimension of input and bias are not the same")},Kw=e=>{let t=e[0].dims,n=e[0].dims[2],s=Ge.size(t)/4,i=e[0].dataType,o=et("input",i,t,4),c=et("bias",i,[n],4),d=et("residual",i,t,4),u=Pt("output",i,t,4);return{name:"BiasAdd",getRunData:()=>({outputs:[{dims:t,dataType:e[0].dataType}],dispatchGroup:{x:Math.ceil(s/64)}}),getShaderSource:h=>`
  const channels = ${n}u / 4;
  ${h.declareVariables(o,c,d,u)}

  ${h.mainStart()}
    ${h.guardAgainstOutOfBoundsWorkgroupSizes(s)}
    let value = ${o.getByOffset("global_idx")}
      + ${c.getByOffset("global_idx % channels")} + ${d.getByOffset("global_idx")};
    ${u.setByOffset("global_idx","value")}
  }`}},LE=e=>{qw(e.inputs),e.compute(Kw(e.inputs))}}),Xw,Bn,FE,zE,NE,RE,jE,UE,VE,GE,WE,Yw,HE,QE,qE,KE,im,XE,Rg,YE,JE,ZE,eT,tT,nT,rT,aT,sT,iT,oT,lT,cT,uT,dT,fT,m0,hT,bv,wv,pT,mT,gT,Jw,Zw,_T,ly=mt(()=>{Xt(),sn(),Hr(),cn(),Xw=(e,t,n,s,i,o,c)=>{let d=Math.ceil(t/4),u="";typeof i=="string"?u=`${i}(a)`:u=i("a");let h=et("inputData",n,[d],4),g=Pt("outputData",s,[d],4),p=[{name:"vec_size",type:"u32"}];return c&&p.push(...c),`
      ${e.registerUniforms(p).declareVariables(h,g)}

  ${o??""}

  ${e.mainStart()}
    ${e.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.vec_size")}

    let a = ${h.getByOffset("global_idx")};
    ${g.setByOffset("global_idx",u)}
  }`},Bn=(e,t,n,s,i,o=e.dataType,c,d)=>{let u=[{type:12,data:Math.ceil(Ge.size(e.dims)/4)}];return c&&u.push(...c),{name:t,shaderCache:{hint:i,inputDependencies:["type"]},getShaderSource:h=>Xw(h,Ge.size(e.dims),e.dataType,o,n,s,d),getRunData:h=>({outputs:[{dims:e.dims,dataType:o}],dispatchGroup:{x:Math.ceil(Ge.size(h[0].dims)/64/4)},programUniforms:u})}},FE=e=>{e.compute(Bn(e.inputs[0],"Abs","abs"))},zE=e=>{e.compute(Bn(e.inputs[0],"Acos","acos"))},NE=e=>{e.compute(Bn(e.inputs[0],"Acosh","acosh"))},RE=e=>{e.compute(Bn(e.inputs[0],"Asin","asin"))},jE=e=>{e.compute(Bn(e.inputs[0],"Asinh","asinh"))},UE=e=>{e.compute(Bn(e.inputs[0],"Atan","atan"))},VE=e=>{e.compute(Bn(e.inputs[0],"Atanh","atanh"))},GE=e=>Nn(e),WE=(e,t)=>{let n;switch(t.to){case 10:n="vec4<f16>";break;case 1:n="vec4<f32>";break;case 12:n="vec4<u32>";break;case 6:n="vec4<i32>";break;case 9:n="vec4<bool>";break;default:throw new RangeError(`not supported type (specified in attribute 'to' from 'Cast' operator): ${t.to}`)}e.compute(Bn(e.inputs[0],"Cast",n,void 0,t.cacheKey,t.to))},Yw=e=>{let t,n,s=e.length>=2&&e[1].data!==0,i=e.length>=3&&e[2].data!==0;switch(e[0].dataType){case 1:t=s?e[1].getFloat32Array()[0]:-34028234663852886e22,n=i?e[2].getFloat32Array()[0]:34028234663852886e22;break;case 10:t=s?e[1].getUint16Array()[0]:64511,n=i?e[2].getUint16Array()[0]:31743;break;default:throw new Error("Unsupport data type")}return Nn({min:t,max:n})},HE=(e,t)=>{let n=t||Yw(e.inputs),s=Ga(e.inputs[0].dataType);e.compute(Bn(e.inputs[0],"Clip",i=>`clamp(${i}, vec4<${s}>(uniforms.min), vec4<${s}>(uniforms.max))`,void 0,n.cacheKey,void 0,[{type:e.inputs[0].dataType,data:n.min},{type:e.inputs[0].dataType,data:n.max}],[{name:"min",type:s},{name:"max",type:s}]),{inputs:[0]})},QE=e=>{e.compute(Bn(e.inputs[0],"Ceil","ceil"))},qE=e=>{e.compute(Bn(e.inputs[0],"Cos","cos"))},KE=e=>{e.compute(Bn(e.inputs[0],"Cosh","cosh"))},im=e=>Nn(e),XE=(e,t)=>{let n=Ga(e.inputs[0].dataType);e.compute(Bn(e.inputs[0],"Elu",s=>`elu_vf32(${s})`,`
  const elu_alpha_ = ${n}(${t.alpha});

  fn elu_f32(a: ${n}) -> ${n} {
  return select((exp(a) - 1.0) * elu_alpha_, a, a >= 0.0);
  }

  fn elu_vf32(v: vec4<${n}>) -> vec4<${n}> {
  return vec4(elu_f32(v.x), elu_f32(v.y), elu_f32(v.z), elu_f32(v.w));
  }`,t.cacheKey))},Rg=(e="f32")=>`
const r0: ${e} = 0.3275911;
const r1: ${e} = 0.254829592;
const r2: ${e} = -0.284496736;
const r3: ${e} = 1.421413741;
const r4: ${e} = -1.453152027;
const r5: ${e} = 1.061405429;

fn erf_vf32(v: vec4<${e}>) -> vec4<${e}> {
  let absv = abs(v);
  let x = 1.0 / (1.0 + r0 * absv);
  return sign(v) * (1.0 - ((((r5 * x + r4) * x + r3) * x + r2) * x + r1) * x * exp(-absv * absv));
}`,YE=e=>{let t=Ga(e.inputs[0].dataType);e.compute(Bn(e.inputs[0],"Erf",n=>`erf_vf32(${n})`,Rg(t)))},JE=e=>{e.compute(Bn(e.inputs[0],"Exp","exp"))},ZE=e=>{e.compute(Bn(e.inputs[0],"Floor","floor"))},eT=e=>{let t=Ga(e.inputs[0].dataType);e.compute(Bn(e.inputs[0],"Gelu",n=>`0.5 * ${n} * (1.0 + erf_vf32(${n} * 0.7071067811865475))`,Rg(t)))},tT=(e,t)=>{let n=Ga(e.inputs[0].dataType);e.compute(Bn(e.inputs[0],"LeakyRelu",s=>`select(leaky_relu_alpha_ * ${s}, ${s}, ${s} >= vec4<${n}>(0.0))`,`const leaky_relu_alpha_ = ${n}(${t.alpha});`,t.cacheKey))},nT=e=>{e.compute(Bn(e.inputs[0],"Not",t=>`!${t}`))},rT=e=>{e.compute(Bn(e.inputs[0],"Neg",t=>`-${t}`))},aT=e=>{e.compute(Bn(e.inputs[0],"Reciprocal",t=>`1.0/${t}`))},sT=e=>{let t=Ga(e.inputs[0].dataType);e.compute(Bn(e.inputs[0],"Relu",n=>`select(vec4<${t}>(0.0), ${n}, ${n} > vec4<${t}>(0.0))`))},iT=e=>{e.compute(Bn(e.inputs[0],"Sigmoid",t=>`(1.0 / (1.0 + exp(-${t})))`))},oT=e=>Nn(e),lT=(e,t)=>{let n=Ga(e.inputs[0].dataType);e.compute(Bn(e.inputs[0],"HardSigmoid",s=>`max(vec4<${n}>(0.0), min(vec4<${n}>(1.0), ${t.alpha} * ${s} + vec4<${n}>(${t.beta})))`,void 0,t.cacheKey))},cT=e=>{e.compute(Bn(e.inputs[0],"Sin","sin"))},uT=e=>{e.compute(Bn(e.inputs[0],"Sinh","sinh"))},dT=e=>{e.compute(Bn(e.inputs[0],"Sqrt","sqrt"))},fT=e=>{e.compute(Bn(e.inputs[0],"Tan","tan"))},m0=e=>`sign(${e}) * (1 - exp(-2 * abs(${e}))) / (1 + exp(-2 * abs(${e})))`,hT=e=>{e.compute(Bn(e.inputs[0],"Tanh",m0))},bv=(e="f32")=>`
const fast_gelu_a: ${e} = 0.5;
const fast_gelu_b: ${e} = 0.7978845608028654;
const fast_gelu_c: ${e} = 0.035677408136300125;

fn tanh_v(v: vec4<${e}>) -> vec4<${e}> {
  return ${m0("v")};
}
`,wv=e=>`(fast_gelu_a + fast_gelu_a * tanh_v(${e} * (fast_gelu_c * ${e} * ${e} + fast_gelu_b))) * ${e}`,pT=e=>{let t=Ga(e.inputs[0].dataType);e.compute(Bn(e.inputs[0],"FastGelu",wv,bv(t),void 0,e.inputs[0].dataType))},mT=(e,t)=>{let n=Ga(e.inputs[0].dataType);return e.compute(Bn(e.inputs[0],"ThresholdedRelu",s=>`select(vec4<${n}>(0.0), ${s}, ${s} > thresholded_relu_alpha_)`,`const thresholded_relu_alpha_ = vec4<${n}>(${t.alpha});`,t.cacheKey)),0},gT=e=>{e.compute(Bn(e.inputs[0],"Log","log"))},Jw=(e,t)=>`
const alpha = vec4<${e}>(${t});
const one = ${e}(1.0);
const zero = ${e}(0.0);

fn quick_gelu_impl(x: vec4<${e}>) -> vec4<${e}> {
  let v = x *alpha;
  var x1 : vec4<${e}>;
  for (var i = 0; i < 4; i = i + 1) {
    if (v[i] >= zero) {
      x1[i] = one / (one + exp(-v[i]));
    } else {
      x1[i] = one - one / (one + exp(v[i]));
    }
  }
  return x * x1;
}
`,Zw=e=>`quick_gelu_impl(${e})`,_T=(e,t)=>{let n=Ga(e.inputs[0].dataType);e.compute(Bn(e.inputs[0],"QuickGelu",Zw,Jw(n,t.alpha),t.cacheKey,e.inputs[0].dataType))}}),eM,tM,vT,eD=mt(()=>{sn(),cn(),ly(),eM=e=>{if(e[0].dims.length!==3)throw new Error("input should have 3 dimensions");if(![2560,5120,10240].includes(e[0].dims[2]))throw new Error("hidden state should be 2560, 5120 or 10240");if(e[1].dims.length!==1)throw new Error("bias is expected to have 1 dimensions");if(e[0].dims[2]!==e[1].dims[0])throw new Error("last dimension of input and bias are not the same")},tM=e=>{let t=e[0].dims.slice();t[2]=t[2]/2;let n=et("input",e[0].dataType,e[0].dims,4),s=et("bias",e[0].dataType,[e[0].dims[2]],4),i=Pt("output",e[0].dataType,t,4),o=Ge.size(t)/4,c=ga(e[0].dataType);return{name:"BiasSplitGelu",getRunData:()=>({outputs:[{dims:t,dataType:e[0].dataType}],dispatchGroup:{x:Math.ceil(o/64)}}),getShaderSource:d=>`
  const M_SQRT2 = sqrt(2.0);
  const halfChannels = ${e[0].dims[2]/4/2}u;

  ${d.declareVariables(n,s,i)}

  ${Rg(c)}

  ${d.mainStart()}
    ${d.guardAgainstOutOfBoundsWorkgroupSizes(o)}
    let biasIdx = global_idx % halfChannels;
    let batchIndex = global_idx / halfChannels;
    let inputOffset = biasIdx + batchIndex * halfChannels * 2;
    let valueLeft = input[inputOffset] + bias[biasIdx];
    let valueRight = input[inputOffset + halfChannels] + bias[biasIdx + halfChannels];
    let geluRight = valueRight * 0.5 * (erf_vf32(valueRight / M_SQRT2) + 1);

    ${i.setByOffset("global_idx","valueLeft * geluRight")}
  }`}},vT=e=>{eM(e.inputs),e.compute(tM(e.inputs))}}),nM,rM,Ti,yT,bT,wT,MT,xT,ET,TT,AT,CT,ST,tD=mt(()=>{Xt(),sn(),cn(),nM=(e,t,n,s,i,o,c,d,u,h,g,p)=>{let m,y;typeof d=="string"?m=y=(S,D)=>`${d}((${S}),(${D}))`:typeof d=="function"?m=y=d:(m=d.scalar,y=d.vector);let v=Pt("outputData",g,s.length,4),T=et("aData",u,t.length,4),O=et("bData",h,n.length,4),E;if(i)if(o){let S=Ge.size(t)===1,D=Ge.size(n)===1,I=t.length>0&&t[t.length-1]%4===0,M=n.length>0&&n[n.length-1]%4===0;S||D?E=v.setByOffset("global_idx",y(S?`${T.type.value}(${T.getByOffset("0")}.x)`:T.getByOffset("global_idx"),D?`${O.type.value}(${O.getByOffset("0")}.x)`:O.getByOffset("global_idx"))):E=`
            let outputIndices = ${v.offsetToIndices("global_idx * 4u")};
            let offsetA = ${T.broadcastedIndicesToOffset("outputIndices",v)};
            let offsetB = ${O.broadcastedIndicesToOffset("outputIndices",v)};
            ${v.setByOffset("global_idx",y(c||I?T.getByOffset("offsetA / 4u"):`${T.type.value}(${T.getByOffset("offsetA / 4u")}[offsetA % 4u])`,c||M?O.getByOffset("offsetB / 4u"):`${O.type.value}(${O.getByOffset("offsetB / 4u")}[offsetB % 4u])`))}
          `}else E=v.setByOffset("global_idx",y(T.getByOffset("global_idx"),O.getByOffset("global_idx")));else{if(!o)throw new Error("no necessary to use scalar implementation for element-wise binary op implementation.");let S=(D,I,M="")=>{let C=`aData[indexA${I}][componentA${I}]`,A=`bData[indexB${I}][componentB${I}]`;return`
            let outputIndices${I} = ${v.offsetToIndices(`global_idx * 4u + ${I}u`)};
            let offsetA${I} = ${T.broadcastedIndicesToOffset(`outputIndices${I}`,v)};
            let offsetB${I} = ${O.broadcastedIndicesToOffset(`outputIndices${I}`,v)};
            let indexA${I} = offsetA${I} / 4u;
            let indexB${I} = offsetB${I} / 4u;
            let componentA${I} = offsetA${I} % 4u;
            let componentB${I} = offsetB${I} % 4u;
            ${D}[${I}] = ${M}(${m(C,A)});
          `};g===9?E=`
            var data = vec4<u32>(0);
            ${S("data",0,"u32")}
            ${S("data",1,"u32")}
            ${S("data",2,"u32")}
            ${S("data",3,"u32")}
            outputData[global_idx] = dot(vec4<u32>(0x1, 0x100, 0x10000, 0x1000000), vec4<u32>(data));`:E=`
            ${S("outputData[global_idx]",0)}
            ${S("outputData[global_idx]",1)}
            ${S("outputData[global_idx]",2)}
            ${S("outputData[global_idx]",3)}
          `}return`
        ${e.registerUniform("vec_size","u32").declareVariables(T,O,v)}

        ${p??""}

        ${e.mainStart()}
        ${e.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.vec_size")}
        ${E}
      }`},rM=(e,t,n,s,i,o,c=n.dataType)=>{let d=n.dims.map(T=>Number(T)??1),u=s.dims.map(T=>Number(T)??1),h=!Ge.areEqual(d,u),g=d,p=Ge.size(d),m=!1,y=!1,v=[h];if(h){let T=wf.calcShape(d,u,!1);if(!T)throw new Error("Can't perform binary op on the given tensors");g=T.slice(),p=Ge.size(g);let O=Ge.size(d)===1,E=Ge.size(u)===1,S=d.length>0&&d[d.length-1]%4===0,D=u.length>0&&u[u.length-1]%4===0;v.push(O),v.push(E),v.push(S),v.push(D);let I=1;for(let M=1;M<g.length;M++){let C=d[d.length-M],A=u[u.length-M];if(C===A)I*=C;else break}I%4===0?(y=!0,m=!0):(O||E||S||D)&&(m=!0)}else m=!0;return v.push(m),{name:e,shaderCache:{hint:t+v.map(T=>T.toString()).join("_"),inputDependencies:["rank","rank"]},getShaderSource:T=>nM(T,d,u,g,m,h,y,i,n.dataType,s.dataType,c,o),getRunData:()=>({outputs:[{dims:g,dataType:c}],dispatchGroup:{x:Math.ceil(p/64/4)},programUniforms:[{type:12,data:Math.ceil(Ge.size(g)/4)},...zt(d,u,g)]})}},Ti=(e,t,n,s,i,o)=>{e.compute(rM(t,i??"",e.inputs[0],e.inputs[1],n,s,o))},yT=e=>{Ti(e,"Add",(t,n)=>`${t}+${n}`)},bT=e=>{Ti(e,"Div",(t,n)=>`${t}/${n}`)},wT=e=>{Ti(e,"Equal",{scalar:(t,n)=>`u32(${t}==${n})`,vector:(t,n)=>`vec4<u32>(${t}==${n})`},void 0,void 0,9)},MT=e=>{Ti(e,"Mul",(t,n)=>`${t}*${n}`)},xT=e=>{let t=et("input",e.inputs[0].dataType,e.inputs[0].dims).type.value;Ti(e,"Pow",{scalar:(n,s)=>`pow_custom(${n},${s})`,vector:(n,s)=>`pow_vector_custom(${n},${s})`},`
    fn pow_custom(a : ${t}, b : ${t}) -> ${t} {
      if (b == ${t}(0.0)) {
        return ${t}(1.0);
      } else if (a < ${t}(0.0) && f32(b) != floor(f32(b))) {
        return ${t}(pow(f32(a), f32(b))); // NaN
      }
      return select(sign(a), ${t}(1.0), round(f32(abs(b) % ${t}(2.0))) != 1.0) * ${t}(${t==="i32"?"round":""}(pow(f32(abs(a)), f32(b))));
    }
    fn pow_vector_custom(a : vec4<${t}>, b : vec4<${t}>) -> vec4<${t}> {
      // TODO: implement vectorized pow
      return vec4<${t}>(pow_custom(a.x, b.x), pow_custom(a.y, b.y), pow_custom(a.z, b.z), pow_custom(a.w, b.w));
    }
      `)},ET=e=>{Ti(e,"Sub",(t,n)=>`${t}-${n}`)},TT=e=>{Ti(e,"Greater",{scalar:(t,n)=>`u32(${t}>${n})`,vector:(t,n)=>`vec4<u32>(${t}>${n})`},void 0,void 0,9)},AT=e=>{Ti(e,"Less",{scalar:(t,n)=>`u32(${t}<${n})`,vector:(t,n)=>`vec4<u32>(${t}<${n})`},void 0,void 0,9)},CT=e=>{Ti(e,"GreaterOrEqual",{scalar:(t,n)=>`u32(${t}>=${n})`,vector:(t,n)=>`vec4<u32>(${t}>=${n})`},void 0,void 0,9)},ST=e=>{Ti(e,"LessOrEqual",{scalar:(t,n)=>`u32(${t}<=${n})`,vector:(t,n)=>`vec4<u32>(${t}<=${n})`},void 0,void 0,9)}}),aM,sM,iM,oM,IT,PT,nD=mt(()=>{Xt(),sn(),Hr(),cn(),aM=(e,t)=>{if(!e||e.length<1)throw new Error("too few inputs");let n=0,s=e[n],i=s.dataType,o=s.dims.length;e.forEach((c,d)=>{if(d!==n){if(c.dataType!==i)throw new Error("input tensors should be one type");if(c.dims.length!==o)throw new Error("input tensors should have the same shape");c.dims.forEach((u,h)=>{if(h!==t&&u!==s.dims[h])throw new Error("non concat dimensions must match")})}})},sM=(e,t)=>`
  fn calculateInputIndex(index: u32) -> u32 {
    let sizeInConcatAxis = array<u32, ${e}u>(${t});
    for (var i: u32 = 0u; i < ${e}; i += 1u ) {
      if (index < sizeInConcatAxis[i]) {
        return i;
      }
    }
    return ${e}u;
  }`,iM=(e,t)=>{let n=e.length,s=[];for(let i=0;i<n;++i){let o=t.setByOffset("global_idx",e[i].getByIndices("indices"));n===1?s.push(o):i===0?s.push(`if (inputIndex == ${i}u) { ${o} }`):i===n-1?s.push(`else { ${o} }`):s.push(`else if (inputIndex == ${i}) { ${o} }`)}return s.join(`
`)},oM=(e,t,n,s)=>{let i=Ge.size(n),o=new Array(e.length),c=new Array(e.length),d=0,u=[],h=[],g=[{type:12,data:i}];for(let T=0;T<e.length;++T)d+=e[T].dims[t],o[T]=d,h.push(e[T].dims.length),c[T]=et(`input${T}`,s,h[T]),u.push("rank"),g.push({type:12,data:o[T]});for(let T=0;T<e.length;++T)g.push(...zt(e[T].dims));g.push(...zt(n));let p=Pt("output",s,n.length),m=p.indicesGet("indices",t),y=Array.from(Array(o.length).keys()).map(T=>`uniforms.sizeInConcatAxis${T}`).join(","),v=T=>`

  ${(()=>{T.registerUniform("outputSize","u32");for(let O=0;O<e.length;O++)T.registerUniform(`sizeInConcatAxis${O}`,"u32");return T.declareVariables(...c,p)})()}

  ${sM(o.length,y)}

  ${T.mainStart()}
    ${T.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.outputSize")}

    var indices = ${p.offsetToIndices("global_idx")};

    let inputIndex = calculateInputIndex(${m});
    if (inputIndex != 0u) {
      let sizeInConcatAxis = array<u32, ${o.length}u>(${y});
      ${m} -= sizeInConcatAxis[inputIndex - 1u];
    }

    ${iM(c,p)}
  }`;return{name:"Concat",shaderCache:{hint:`${t}`,inputDependencies:u},getRunData:()=>({outputs:[{dims:n,dataType:s}],dispatchGroup:{x:Math.ceil(i/64)},programUniforms:g}),getShaderSource:v}},IT=(e,t)=>{let n=e.inputs,s=n[0].dims,i=Ge.normalizeAxis(t.axis,s.length);aM(n,i);let o=s.slice();o[i]=n.reduce((d,u)=>d+(u.dims.length>i?u.dims[i]:0),0);let c=n.filter(d=>Ge.size(d.dims)>0);e.compute(oM(c,i,o,n[0].dataType),{inputs:c})},PT=e=>Nn({axis:e.axis})}),xu,Eu,Tu,cy,Cu=mt(()=>{Xt(),sn(),xu=(e,t,n="f32")=>{switch(e.activation){case"Relu":return`value = max(value, ${t}(0.0));`;case"Sigmoid":return`value = (${t}(1.0) / (${t}(1.0) + exp(-value)));`;case"Clip":return`value = clamp(value, ${t}(${n}(uniforms.clip_min)), ${t}(${n}(uniforms.clip_max)));`;case"HardSigmoid":return`value = max(${t}(0.0), min(${t}(1.0), ${n}(uniforms.alpha) * value + ${n}(uniforms.beta)));`;case"LeakyRelu":return`value = select(${n}(uniforms.alpha) * value, value, value >= ${t}(0.0));`;case"Tanh":return`let e2x = exp(-2.0 * abs(value));
              value = sign(value) * (1.0 - e2x) / (1.0 + e2x);
        `;case"":return"";default:throw new Error(`Unsupported activation ${e.activation}`)}},Eu=(e,t)=>{e.activation==="Clip"?t.push({type:1,data:e.clipMax},{type:1,data:e.clipMin}):e.activation==="HardSigmoid"?t.push({type:1,data:e.alpha},{type:1,data:e.beta}):e.activation==="LeakyRelu"&&t.push({type:1,data:e.alpha})},Tu=(e,t)=>{e.activation==="Clip"?t.push({name:"clip_max",type:"f32"},{name:"clip_min",type:"f32"}):e.activation==="HardSigmoid"?t.push({name:"alpha",type:"f32"},{name:"beta",type:"f32"}):e.activation==="LeakyRelu"&&t.push({name:"alpha",type:"f32"})},cy=e=>{let t=(e==null?void 0:e.activation)||"";if(t==="HardSigmoid"){let[n,s]=(e==null?void 0:e.activation_params)||[.2,.5];return{activation:t,alpha:n,beta:s}}else if(t==="Clip"){let[n,s]=(e==null?void 0:e.activation_params)||[nE,rE];return{activation:t,clipMax:s,clipMin:n}}else if(t==="LeakyRelu"){let[n]=(e==null?void 0:e.activation_params)||[.01];return{activation:t,alpha:n}}return{activation:t}}}),Ma,kT,uy=mt(()=>{Ma=(e,t)=>{switch(e){case 1:return t;case 2:return`vec2<${t}>`;case 3:return`vec3<${t}>`;case 4:return`vec4<${t}>`;default:throw new Error(`${e}-component is not supported.`)}},kT=e=>`
      ${e?"value = value + getBiasByOutputCoords(coords);":""}
      `}),DT,rD=mt(()=>{DT=e=>`
fn getIndexFromCoords4D(coords : vec4<i32>, shape : vec4<i32>) -> i32 {
  return dot(coords, vec4<i32>(
      shape.y * shape.z * shape.w, shape.z * shape.w, shape.w, 1));
}
fn getOutputIndexFromCoords(coords : vec4<i32>) -> i32 {
  return dot(coords, vec4<i32>(
    i32(${e}.x), i32(${e}.y), i32(${e}.z), 1));
}
`}),cm,dy,fy=mt(()=>{Xt(),sn(),cn(),Cu(),cm=(e,t,n,s,i)=>{let o=s-n;return`
      ${Array.from({length:n}).map((c,d)=>`
      if (${$t(t.shape,d,t.rank)} != 1) {
        ${t.indicesSet(e,d,$t(i,d+o,s))}
      } else {
        ${t.indicesSet(e,d,0)}
      }`).join("")}
`},dy=(e,t,n,s,i=!1,o)=>{let c=e[0].dims,d=e[1].dims,u=c[c.length-2],h=d[d.length-1],g=c[c.length-1],p=Lr(h),m=Lr(g),y=Lr(u),v=Ge.size(n)/p/y,T=e.length>2,O=s?s.slice(0,-2):n.slice(0,-2),E=[Ge.size(O),u,h],S=[{type:12,data:v},{type:12,data:u},{type:12,data:h},{type:12,data:g}];Eu(t,S),S.push(...zt(O,c,d)),T&&S.push(...zt(e[2].dims)),S.push(...zt(E));let D=I=>{let M=sy("batch_dims",e[0].dataType,O.length),C=et("a",e[0].dataType,c.length,m),A=et("b",e[1].dataType,d.length,p),k=Pt("output",e[0].dataType,E.length,p),R=ga(k.type.tensor),G=xu(t,k.type.value,R),te=[C,A],ee="";if(T){let ae=i?p:1;te.push(et("bias",e[2].dataType,e[2].dims.length,ae)),ee=`${i?`value += bias[col / ${ae}];`:`value += ${k.type.value}(bias[row + i]);`}`}let X=[{name:"output_size",type:"u32"},{name:"M",type:"u32"},{name:"N",type:"u32"},{name:"K",type:"u32"}];Tu(t,X);let le=()=>{let ae=`var a_data: ${C.type.value};`;for(let Q=0;Q<m;Q++)ae+=`
              let b_data${Q} = b[(b_offset + (k + ${Q}) * uniforms.N + col) / ${p}];`;for(let Q=0;Q<y;Q++){ae+=`a_data = a[(a_offset + (row + ${Q}) * uniforms.K + k) / ${m}];`;for(let ne=0;ne<m;ne++)ae+=`
            values[${Q}] = fma(${A.type.value}(a_data${m===1?"":`[${ne}]`}), b_data${ne}, values[${Q}]);
`}return ae};return`
  ${I.registerUniforms(X).registerInternalVariables(M).declareVariables(...te,k)}
  ${I.mainStart()}
    ${I.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
    let col = (global_idx % (uniforms.N / ${p})) * ${p};
    var index1 = global_idx / (uniforms.N / ${p});
    let stride1 = uniforms.M / ${y};
    let row = (index1 % stride1) * ${y};
    let batch = index1 / stride1;

    ${n.length===2?"":`let batch_indices = ${M.offsetToIndices("batch")};`}

    var a_indices: ${C.type.indices};
    ${cm("a_indices",C,C.rank-2,M.rank,"batch_indices")}
    ${C.indicesSet("a_indices",C.rank-2,0)}
    ${C.indicesSet("a_indices",C.rank-1,0)}
    let a_offset = ${C.indicesToOffset("a_indices")};

    var b_indices: ${A.type.indices};
    ${cm("b_indices",A,A.rank-2,M.rank,"batch_indices")}
    ${A.indicesSet("b_indices",A.rank-2,0)}
    ${A.indicesSet("b_indices",A.rank-1,0)}
    let b_offset = ${A.indicesToOffset("b_indices")};
    var values: array<${k.type.value}, ${y}>;
    for (var k: u32 = 0u; k < uniforms.K; k = k + ${m}) {
      ${le()}
    }
    for (var i = 0u; i < ${y}u; i++) {
      var value = values[i];
      ${ee}
      ${G}
      let cur_indices = ${k.type.indices}(batch, row + i, col);
      let offset = ${k.indicesToOffset("cur_indices")};
      ${k.setByOffset(`offset / ${p}`,"value")};
    }
  }
  `};return{name:"MatMulNaive",shaderCache:{hint:`${t.activation};${p};${m};${y};${i}`,inputDependencies:T?["rank","rank","rank"]:["rank","rank"]},getRunData:()=>({outputs:[{dims:o?o(n):n,dataType:e[0].dataType}],dispatchGroup:{x:Math.ceil(v/64)},programUniforms:S}),getShaderSource:D}}}),lM,cM,Mv,g0,uM,xv,dM,r_,hy=mt(()=>{Xt(),sn(),cn(),Cu(),fy(),uy(),lM=(e,t)=>e?`
        mm_Asub[inputRow][inputCol] = mm_readA(batch,
          kStart + inputRow,
          globalRowStart / innerElementSize + inputCol${t?", batchIndices":""});
        `:`
        mm_Asub[inputRow][inputCol] = mm_readA(batch,
          globalRow + innerRow,
          kStart / innerElementSize + inputCol${t?", batchIndices":""});
        `,cM=(e,t)=>e?`
        let ACached0 = mm_Asub[k * innerElementSize][localRow];
        let ACached1 = mm_Asub[k * innerElementSize + 1][localRow];
        let ACached2 = mm_Asub[k * innerElementSize + 2][localRow];
        ${t===3?"":"let ACached3 = mm_Asub[k * innerElementSize + 3][localRow];"}
        for (var i = 0; i < rowPerThread; i = i + 1) {
          acc[i] = BCached0 * ACached0[i] + acc[i];
          acc[i] = BCached1 * ACached1[i] + acc[i];
          acc[i] = BCached2 * ACached2[i] + acc[i];
          ${t===3?"":"acc[i] = BCached3 * ACached3[i] + acc[i];"}
        }`:`
        for (var i = 0; i < rowPerThread; i = i + 1) {
          let ACached = mm_Asub[tileRow + i][k];
          acc[i] = BCached0 * ACached.x + acc[i];
          acc[i] = BCached1 * ACached.y + acc[i];
          acc[i] = BCached2 * ACached.z + acc[i];
          ${t===3?"":"acc[i] = BCached3 * ACached.w + acc[i];"}
        }`,Mv=(e,t,n="f32",s,i=!1,o=32,c=!1,d=32)=>{let u=t[1]*e[1],h=t[0]*e[0],g=i?u:o,p=i?o:u,m=g/t[0],y=o/t[1];if(!((i&&m===4&&e[1]===4||!i&&(m===3||m===4))&&g%t[0]===0&&o%t[1]===0&&e[0]===4))throw new Error(`If transposeA ${i} is true, innerElementSize ${m} and workPerThread[1] ${e[1]} must be 4.
      Otherwise, innerElementSize ${m} must be 3 or 4.
  tileAWidth ${g} must be divisible by workgroupSize[0]${t[0]}. tileInner ${o} must be divisible by workgroupSize[1] ${t[1]}. colPerThread ${e[0]} must be 4.`);return`
var<workgroup> mm_Asub: array<array<vec${m}<${n}>, ${g/m}>, ${p}>;
var<workgroup> mm_Bsub: array<array<vec4<${n}>, ${h/e[0]}>, ${o}>;

const rowPerThread = ${e[1]};
const colPerThread = ${e[0]};
const innerElementSize = ${m};
const tileInner = ${o};

@compute @workgroup_size(${t[0]}, ${t[1]}, ${t[2]})
fn main(@builtin(local_invocation_id) localId : vec3<u32>,
        @builtin(global_invocation_id) globalId : vec3<u32>,
        @builtin(workgroup_id) workgroupId : vec3<u32>) {
  let localRow = i32(localId.y);
  let tileRow = localRow * rowPerThread;
  let tileCol = i32(localId.x);

  let globalRow =i32(globalId.y) * rowPerThread;
  let globalCol = i32(globalId.x);
  let batch = ${c?"0":"i32(globalId.z)"};
  ${s?`let batchIndices = ${s.offsetToIndices("u32(batch)")};`:""}
  let globalRowStart = i32(workgroupId.y) * ${u};

  let num_tiles = ${c?`${Math.ceil(d/o)}`:"(uniforms.dim_inner - 1) / tileInner + 1"};
  var kStart = ${c?`i32(globalId.z) * ${d}`:"0"};

  var acc: array<vec4<${n}>, rowPerThread>;

  // Loop over shared dimension.
  let tileRowB = localRow * ${y};
  for (var t = 0; t < num_tiles; t = t + 1) {
      // Load one tile of A into local memory.
      for (var innerRow = 0; innerRow < rowPerThread; innerRow = innerRow + 1) {
          let inputRow = tileRow + innerRow;
          let inputCol = tileCol;
          ${lM(i,s)}
      }

      // Load one tile of B into local memory.
      for (var innerRow = 0; innerRow < ${y}; innerRow = innerRow + 1) {
          let inputRow = tileRowB + innerRow;
          let inputCol = tileCol;
          mm_Bsub[inputRow][inputCol] = mm_readB(batch, kStart + inputRow, globalCol${s?", batchIndices":""});
      }
      kStart = kStart + tileInner;
      workgroupBarrier();

      // Compute acc values for a single thread.
      for (var k = 0; k < tileInner / innerElementSize; k = k + 1) {
          let BCached0 = mm_Bsub[k * innerElementSize][tileCol];
          let BCached1 = mm_Bsub[k * innerElementSize + 1][tileCol];
          let BCached2 = mm_Bsub[k * innerElementSize + 2][tileCol];
          ${m===3?"":"let BCached3 = mm_Bsub[k * innerElementSize + 3][tileCol];"}

          ${cM(i,m)}
      }

      workgroupBarrier();
  }

  for (var innerRow = 0; innerRow < rowPerThread; innerRow = innerRow + 1) {
      mm_write(batch, globalRow + innerRow, globalCol, acc[innerRow]);
  }
}`},g0=(e,t)=>e?`
            mm_Asub[inputRow][inputCol] = mm_readA(batch,
              kStart + inputRow,
              globalRowStart + inputCol${t?", batchIndices":""});
            `:`
            mm_Asub[inputRow][inputCol] = mm_readA(batch,
              globalRowStart + inputRow,
              kStart + inputCol${t?", batchIndices":""});
            `,uM=e=>e?"let ACached = mm_Asub[k][tileRow + innerRow];":"let ACached = mm_Asub[tileRow + innerRow][k];",xv=(e,t,n="f32",s,i=!1,o=32,c=!1,d=32,u=!1)=>{let h=e[1]*t[1],g=e[0]*t[0],p=i?h:o,m=i?o:h;if(!(m%t[1]===0&&p%t[0]===0&&o%t[1]===0))throw new Error(`tileAHight ${m} must be divisible by workgroupSize[1]${t[1]}, tileAWidth ${p} must be divisible by workgroupSize[0]${t[0]}, tileInner ${o} must be divisible by workgroupSize[1]${t[1]}`);let y=m/t[1],v=p/t[0],T=o/t[1],O=u?`
    let localRow = i32(localId.y);
    let localCol = i32(localId.x);
    let globalRowStart = i32(workgroupId.y) * ${h};
    let globalColStart = i32(workgroupId.x) * ${g};

    // Loop over shared dimension.
    for (var t = 0; t < num_tiles; t = t + 1) {
      // Load one tile of A into local memory.
      for (var inputRow = localRow; inputRow < ${m}; inputRow = inputRow + ${t[1]}) {
        for (var inputCol = localCol; inputCol < ${p}; inputCol = inputCol + ${t[0]}) {
          ${g0(i,s)}
        }
      }
      // Load one tile of B into local memory.
      for (var inputRow = localRow; inputRow < ${o}; inputRow = inputRow + ${t[1]}) {
            for (var inputCol = localCol; inputCol < ${g}; inputCol = inputCol + ${t[0]}) {
          mm_Bsub[inputRow][inputCol] = mm_readB(batch,
            kStart + inputRow,
            globalColStart + inputCol${s?", batchIndices":""});
        }
      }
      kStart = kStart + tileInner;
      workgroupBarrier();

      // Compute acc values for a single thread.
      var BCached : array<${n}, colPerThread>;
      for (var k = 0; k < tileInner; k = k + 1) {
        for (var inner = 0; inner < colPerThread; inner = inner + 1) {
          BCached[inner] = mm_Bsub[k][localCol + inner * ${t[0]}];
        }
        for (var innerRow = 0; innerRow < rowPerThread; innerRow = innerRow + 1) {
          let ACached = ${i?`mm_Asub[k][localRow + innerRow * ${t[1]}];`:`mm_Asub[localRow + innerRow * ${t[1]}][k];`}
          for (var innerCol = 0; innerCol < colPerThread; innerCol = innerCol + 1) {
            acc[innerRow][innerCol] = acc[innerRow][innerCol] +
                ACached * BCached[innerCol];
          }
        }
      }
      workgroupBarrier();
    }
    for (var innerRow = 0; innerRow < rowPerThread; innerRow = innerRow + 1) {
      let gRow = globalRowStart + localRow + innerRow * ${t[1]};
      for (var innerCol = 0; innerCol < colPerThread; innerCol = innerCol + 1) {
        let gCol = globalColStart + localCol + innerCol * ${t[0]};
        mm_write(batch, gRow, gCol, acc[innerRow][innerCol]);
      }
    }
    `:`
let tileRow = i32(localId.y) * rowPerThread;
let tileCol = i32(localId.x) * colPerThread;

let globalRow = i32(globalId.y) * rowPerThread;
let globalCol = i32(globalId.x) * colPerThread;
let globalRowStart = i32(workgroupId.y) * ${h};

let tileRowA = i32(localId.y) * ${y};
let tileColA = i32(localId.x) * ${v};
let tileRowB = i32(localId.y) * ${T};
// Loop over shared dimension.
for (var t = 0; t < num_tiles; t = t + 1) {
  // Load one tile of A into local memory.
  for (var innerRow = 0; innerRow < ${y}; innerRow = innerRow + 1) {
    for (var innerCol = 0; innerCol < ${v}; innerCol = innerCol + 1) {
      let inputRow = tileRowA + innerRow;
      let inputCol = tileColA + innerCol;
      ${g0(i,s)}
    }
  }

  // Load one tile of B into local memory.
  for (var innerRow = 0; innerRow < ${T}; innerRow = innerRow + 1) {
    for (var innerCol = 0; innerCol < colPerThread; innerCol = innerCol + 1) {
      let inputRow = tileRowB + innerRow;
      let inputCol = tileCol + innerCol;
      mm_Bsub[inputRow][inputCol] = mm_readB(batch,
        kStart + inputRow,
        globalCol + innerCol${s?", batchIndices":""});
    }
  }
  kStart = kStart + tileInner;
  workgroupBarrier();

  // Compute acc values for a single thread.
  var BCached : array<${n}, colPerThread>;
  for (var k = 0; k < tileInner; k = k + 1) {
    for (var inner = 0; inner < colPerThread; inner = inner + 1) {
      BCached[inner] = mm_Bsub[k][tileCol + inner];
    }

    for (var innerRow = 0; innerRow < rowPerThread; innerRow = innerRow + 1) {
      ${uM(i)}
      for (var innerCol = 0; innerCol < colPerThread; innerCol = innerCol + 1) {
        acc[innerRow][innerCol] = acc[innerRow][innerCol] + ACached * BCached[innerCol];
      }
    }
  }

  workgroupBarrier();
}

for (var innerRow = 0; innerRow < rowPerThread; innerRow = innerRow + 1) {
  for (var innerCol = 0; innerCol < colPerThread; innerCol = innerCol + 1) {
    mm_write(batch, globalRow + innerRow, globalCol + innerCol,
        acc[innerRow][innerCol]);
  }
}
`;return`
  var<workgroup> mm_Asub : array<array<${n}, ${p}>, ${m}>;
  var<workgroup> mm_Bsub : array<array<${n}, ${g}>, ${o}>;
  const rowPerThread = ${e[1]};
  const colPerThread = ${e[0]};
  const tileInner = ${o};

@compute @workgroup_size(${t[0]}, ${t[1]}, ${t[2]})
fn main(@builtin(local_invocation_id) localId : vec3<u32>,
        @builtin(global_invocation_id) globalId : vec3<u32>,
        @builtin(workgroup_id) workgroupId : vec3<u32>) {
    let batch = ${c?"0":"i32(globalId.z)"};
    ${s?`let batchIndices = ${s.offsetToIndices("u32(batch)")};`:""}
    let num_tiles = ${c?`${Math.ceil(d/o)}`:"(uniforms.dim_inner - 1) / tileInner + 1"};
    var kStart = ${c?`i32(globalId.z) * ${d}`:"0"};

    var acc : array<array<${n}, colPerThread>, rowPerThread>;
    ${O}
  }
`},dM=(e,t,n,s,i=!1)=>{let[o,c,d,u]=s,h=ga(s[0].type.tensor);return`
    fn mm_readA(batch: i32, row: i32, colIn: i32, batchIndices: ${o.type.indices}) -> ${Ma(e,h)} {
      var value = ${Ma(e,h)}(0.0);
      let col = colIn * ${e};
      if(row < uniforms.dim_a_outer && col < uniforms.dim_inner)
      {
        var aIndices: ${c.type.indices};
        ${cm("aIndices",c,c.rank-2,o.rank,"batchIndices")}
        ${c.indicesSet("aIndices",c.rank-2,"u32(row)")}
        ${c.indicesSet("aIndices",c.rank-1,"u32(colIn)")}
        value = ${c.getByIndices("aIndices")};
      }
      return value;
    }

    fn mm_readB(batch: i32, row: i32, colIn: i32, batchIndices: ${o.type.indices}) -> ${Ma(e,h)} {
      var value = ${Ma(e,h)}(0.0);
      let col = colIn * ${e};
      if(row < uniforms.dim_inner && col < uniforms.dim_b_outer)
      {
        var bIndices: ${d.type.indices};
        ${cm("bIndices",d,d.rank-2,o.rank,"batchIndices")}
        ${d.indicesSet("bIndices",d.rank-2,"u32(row)")}
        ${d.indicesSet("bIndices",d.rank-1,"u32(colIn)")}
        value = ${d.getByIndices("bIndices")};
      }
      return value;
    }

    fn mm_write(batch: i32, row: i32, colIn: i32, valueIn: ${Ma(e,h)}) {
      let col = colIn * ${e};
      if (row < uniforms.dim_a_outer && col < uniforms.dim_b_outer) {
        var value = valueIn;
        let coords = vec3<i32>(batch, row, colIn);
        ${t?`value = value + ${i?"bias[colIn]":`${Ma(e,h)}(bias[row])`};`:""}
        ${n}
        ${u.setByIndices("vec3<u32>(coords)","value")}
      }
    }
    `},r_=(e,t,n,s,i=!1,o)=>{let c=e[0].dims,d=e[1].dims,u=c.slice(0,-2),h=d.slice(0,-2),g=s?s.slice(0,-2):n.slice(0,-2),p=Ge.size(g),m=c[c.length-2],y=c[c.length-1],v=d[d.length-1],T=y%4===0&&v%4===0,O=m<=8?[4,1,1]:[4,4,1],E=[8,8,1],S=[Math.ceil(v/E[0]/O[0]),Math.ceil(m/E[1]/O[1]),Math.ceil(p/E[2]/O[2])],D=T?4:1,I=[...u,m,y/D],M=I.length,C=[...h,y,v/D],A=C.length,k=[p,m,v/D],R=[{type:6,data:m},{type:6,data:v},{type:6,data:y}];Eu(t,R),R.push(...zt(g,I,C));let G=["rank","rank"],te=e.length>2;te&&(R.push(...zt(e[2].dims)),G.push("rank")),R.push(...zt(k));let ee=X=>{let le=g.length,ae=sy("batchDims",e[0].dataType,le,1),Q=ga(e[0].dataType),ne=et("a",e[0].dataType,M,D),de=et("b",e[1].dataType,A,D),ve=Pt("result",e[0].dataType,k.length,D),fe=[ne,de];if(te){let ce=i?D:1;fe.push(et("bias",e[2].dataType,e[2].dims.length,ce))}let j=[{name:"dim_a_outer",type:"i32"},{name:"dim_b_outer",type:"i32"},{name:"dim_inner",type:"i32"}];Tu(t,j);let U=ga(ve.type.tensor),N=xu(t,ve.type.value,U),q=dM(D,te,N,[ae,ne,de,ve],i);return`
  ${X.registerUniforms(j).registerInternalVariables(ae).declareVariables(...fe,ve)}
  ${q}
  ${T?Mv(O,E,Q,ae):xv(O,E,Q,ae)}
                   `};return{name:"MatMul",shaderCache:{hint:`${O};${t.activation};${T};${i}`,inputDependencies:G},getRunData:()=>({outputs:[{dims:o?o(n):n,dataType:e[0].dataType}],dispatchGroup:{x:S[0],y:S[1],z:S[2]},programUniforms:R}),getShaderSource:ee}}}),fM,OT,aD=mt(()=>{Xt(),nl(),cn(),Cu(),uy(),rD(),hy(),fM=(e,t,n,s,i=!1,o,c=4,d=4,u=4,h="f32")=>{let g=R=>{switch(R){case 1:return"resData = x[xIndex];";case 3:return`resData = vec3<${h}>(x[xIndex], x[xIndex + 1], x[xIndex + 2]);`;case 4:return"resData = x[xIndex / 4];";default:throw new Error(`innerElementSize ${R} is not supported.`)}},p=R=>{switch(R){case 1:return"return w[row * i32(uniforms.w_shape[3]) + colIn];";case 4:return"return w[row * i32(uniforms.w_shape[3]) / 4 + colIn];";default:throw new Error(`innerElementSize ${R} is not supported.`)}},m=e?`
    let coord = vec4<i32>(batch, xRow, xCol, xCh);
    `:`
    let coord = vec4<i32>(batch, xCh, xRow, xCol);
    `,y=e?`
    let coords = vec4<i32>(
      batch,
      row / outWidth,
      row % outWidth,
      col);
    `:`
    let coords = vec4<i32>(
      batch,
      row,
      col / outWidth,
      col % outWidth);
    `,v=e?"i32(uniforms.x_shape[1])":"i32(uniforms.x_shape[2])",T=e?"i32(uniforms.x_shape[2])":"i32(uniforms.x_shape[3])",O=e?"row":"col",E=e?"col":"row",S=`
    let inChannels = i32(uniforms.w_shape[2]);
    let outWidth = ${e?"i32(uniforms.result_shape[2])":"i32(uniforms.result_shape[3])"};
    let outRow = ${O} / outWidth;
    let outCol = ${O} % outWidth;

    let WRow = ${E} / (i32(uniforms.w_shape[1]) * inChannels);
    let WCol = ${E} / inChannels % i32(uniforms.w_shape[1]);
    let xRow = outRow * uniforms.stride[0] + uniforms.dilation[0] * WRow - uniforms.pad[0];
    let xCol = outCol * uniforms.stride[1] + uniforms.dilation[1] * WCol - uniforms.pad[1];
    let xCh = ${E} % inChannels;
    var resData = ${Ma(c,h)}(0.0);
    // The bounds checking is always needed since we use it to pad zero for
    // the 'same' padding type.
    if (xRow >= 0 && xRow < ${v} && xCol >= 0 && xCol < ${T}) {
      ${m}
      let xIndex = getIndexFromCoords4D(coord, vec4<i32>(uniforms.x_shape));
      ${g(c)}
    }
    return resData;`,D=e?t&&s?`
    let col = colIn * ${c};
    ${S}`:`
    let col = colIn * ${c};
    if (row < uniforms.dim_a_outer && col < uniforms.dim_inner) {
      ${S}
    }
    return ${Ma(c,h)}(0.0);`:s&&n?`
    let col = colIn * ${c};
    ${S}`:`
    let col = colIn * ${c};
    if (row < uniforms.dim_inner && col < uniforms.dim_b_outer) {
      ${S}
    }
    return ${Ma(c,h)}(0.0);`,I=e?s&&n?p(d):`
    let col = colIn * ${d};
    if (row < uniforms.dim_inner && col < uniforms.dim_b_outer) {
      ${p(d)}
    }
    return ${Ma(d,h)}(0.0);`:`
    let col = colIn * ${d};
    if (row < uniforms.dim_inner && col < uniforms.dim_a_outer) {
      ${p(d)}
    }
    return ${Ma(d,h)}(0.0);`,M=Ma(u,h),C=Ma(e?c:d,h),A=Ma(e?d:c,h),k=xu(o,M,h);return`
    fn mm_readA(batch: i32, row : i32, colIn : i32) -> ${C} {
      ${e?D:I}
    }

    fn mm_readB(batch: i32, row : i32, colIn : i32) -> ${A} {
      ${e?I:D}
    }

    fn mm_write(batch: i32, row : i32, colIn : i32, valueIn : ${M}) {
      let col = colIn * ${u};
      if (row < uniforms.dim_a_outer && col < uniforms.dim_b_outer)
      {
      var value = valueIn;
      let outWidth = ${e?"i32(uniforms.result_shape[2])":"i32(uniforms.result_shape[3])"};
      ${y}
      ${kT(i)}
      ${k}
      setOutputAtCoords(coords[0], coords[1], coords[2], coords[3], value);
      }
    }`},OT=(e,t,n,s,i,o,c,d,u)=>{let h=t.format==="NHWC",g=h?e[0].dims[3]:e[0].dims[1],p=n[0],m=h?n[2]:n[3],y=h?n[1]:n[2],v=h?n[3]:n[1],T=h&&(g%4===0||g%3===0)&&v%4===0,O=h?v:m*y,E=h?m*y:v,S=[8,8,1],D=s<=8?[4,1,1]:[4,4,1],I=[Math.ceil(O/S[0]/D[0]),Math.ceil(E/S[1]/D[1]),Math.ceil(p/S[2]/D[2])];Pn("verbose",()=>`[conv2d_mm_webgpu] dispatch = ${I}`);let M=T?h&&g%4!==0?3:4:1,C=S[1]*D[1],A=S[0]*D[0],k=Math.max(S[0]*M,S[1]),R=s%C===0,G=i%A===0,te=o%k===0,ee=T?[M,4,4]:[1,1,1],X=[{type:6,data:s},{type:6,data:i},{type:6,data:o},{type:6,data:[t.pads[0],t.pads[1]]},{type:6,data:t.strides},{type:6,data:t.dilations}];Eu(t,X),X.push(...zt(e[0].dims,e[1].dims));let le=["rank","rank"];c&&(X.push(...zt(e[2].dims)),le.push("rank")),X.push(...zt(n));let ae=Q=>{let ne=[{name:"dim_a_outer",type:"i32"},{name:"dim_b_outer",type:"i32"},{name:"dim_inner",type:"i32"},{name:"pad",type:"i32",length:2},{name:"stride",type:"i32",length:2},{name:"dilation",type:"i32",length:2}];Tu(t,ne);let de=T?4:1,ve=ga(e[0].dataType),fe=`
      fn setOutputAtIndex(flatIndex : i32, value : ${T?`vec4<${ve}>`:ve}) {
        result[flatIndex] = ${T?`vec4<${ve}>`:ve}(value);
      }
      fn setOutputAtCoords(d0 : i32, d1 : i32, d2 : i32, d3 : i32, value : ${T?`vec4<${ve}>`:ve}) {
        let flatIndex = getOutputIndexFromCoords(vec4<i32>(d0, d1, d2, d3));
        setOutputAtIndex(flatIndex ${T?"/ 4":""}, value);
      }`,j=et("x",e[0].dataType,e[0].dims.length,M===3?1:M),U=et("w",e[1].dataType,e[1].dims.length,de),N=[j,U],q=Pt("result",e[0].dataType,n.length,de);if(c){let ce=et("bias",e[2].dataType,e[2].dims.length,de);N.push(ce),fe+=`
        fn getBiasByOutputCoords(coords : vec4<i32>) -> ${T?`vec4<${ve}>`:ve} {
          return bias[coords.${h?"w":"y"}${T?"/ 4":""}];
        }`}return`
        ${DT("uniforms.result_strides")}
        //struct Uniforms { xShape : vec4<i32>, wShape : vec4<i32>, outShape : vec4<i32>,
        //  outShapeStrides: vec3<i32>, filterDims : vec2<i32>, pad : vec2<i32>, stride : vec2<i32>,
        //  dilation : vec2<i32>, dimAOuter : i32, dimBOuter : i32, dimInner : i32 };
        ${Q.registerUniforms(ne).declareVariables(...N,q)}
        ${fe}
        ${fM(h,R,G,te,c,t,ee[0],ee[1],ee[2],ve)}
        ${T?Mv(D,S,ve,void 0,!h,k):xv(D,S,ve,void 0,!h,k,!1,void 0,d)}`};return{name:"Conv2DMatMul",shaderCache:{hint:`${t.cacheKey};${M};${T};${R};${G};${te};${C};${A};${k}`,inputDependencies:le},getRunData:()=>({outputs:[{dims:u?u(n):n,dataType:e[0].dataType}],dispatchGroup:{x:I[0],y:I[1],z:I[2]},programUniforms:X}),getShaderSource:ae}}}),hM,_0,Xp,pM,v0,mM,$T,BT,sD=mt(()=>{Xt(),nl(),sn(),cn(),Cu(),uy(),hM=e=>{let t=1;for(let n=0;n<e.length;n++)t*=e[n];return t},_0=e=>typeof e=="number"?[e,e,e]:e,Xp=(e,t)=>t<=1?e:e+(e-1)*(t-1),pM=(e,t,n,s=1)=>{let i=Xp(t,s);return Math.floor((e[0]*(n-1)-n+i)/2)},v0=(e,t,n,s,i)=>{i==null&&(i=pM(e,t[0],s[0]));let o=[0,0,0,n];for(let c=0;c<3;c++)e[c]+2*i>=t[c]&&(o[c]=Math.trunc((e[c]-t[c]+2*i)/s[c]+1));return o},mM=(e,t,n,s,i,o,c,d,u,h)=>{let g,p,m,y;if(e==="VALID"&&(e=0),typeof e=="number"){g={top:e,bottom:e,left:e,right:e,front:e,back:e};let v=v0([t,n,s,1],[d,u,h],1,[i,o,c],e);p=v[0],m=v[1],y=v[2]}else if(Array.isArray(e)){if(!e.every((T,O,E)=>T===E[0]))throw Error(`Unsupported padding parameter: ${e}`);g={top:e[0],bottom:e[1],left:e[2],right:e[3],front:e[4],back:e[5]};let v=v0([t,n,s,1],[d,u,h],1,[i,o,c],e[0]);p=v[0],m=v[1],y=v[2]}else if(e==="SAME_UPPER"){p=Math.ceil(t/i),m=Math.ceil(n/o),y=Math.ceil(s/c);let v=(p-1)*i+d-t,T=(m-1)*o+u-n,O=(y-1)*c+h-s,E=Math.floor(v/2),S=v-E,D=Math.floor(T/2),I=T-D,M=Math.floor(O/2),C=O-M;g={top:D,bottom:I,left:M,right:C,front:E,back:S}}else throw Error(`Unknown padding parameter: ${e}`);return{padInfo:g,outDepth:p,outHeight:m,outWidth:y}},$T=(e,t,n,s,i,o=!1,c="channelsLast")=>{let d,u,h,g,p;if(c==="channelsLast")[d,u,h,g,p]=e;else if(c==="channelsFirst")[d,p,u,h,g]=e;else throw new Error(`Unknown dataFormat ${c}`);let[m,,y,v,T]=t,[O,E,S]=_0(n),[D,I,M]=_0(s),C=Xp(y,D),A=Xp(v,I),k=Xp(T,M),{padInfo:R,outDepth:G,outHeight:te,outWidth:ee}=mM(i,u,h,g,O,E,S,C,A,k),X=o?m*p:m,le=[0,0,0,0,0];return c==="channelsFirst"?le=[d,X,G,te,ee]:c==="channelsLast"&&(le=[d,G,te,ee,X]),{batchSize:d,dataFormat:c,inDepth:u,inHeight:h,inWidth:g,inChannels:p,outDepth:G,outHeight:te,outWidth:ee,outChannels:X,padInfo:R,strideDepth:O,strideHeight:E,strideWidth:S,filterDepth:y,filterHeight:v,filterWidth:T,effectiveFilterDepth:C,effectiveFilterHeight:A,effectiveFilterWidth:k,dilationDepth:D,dilationHeight:I,dilationWidth:M,inShape:e,outShape:le,filterShape:t}},BT=(e,t,n,s,i,o)=>{let c=o==="channelsLast";c?e[0].dims[3]:e[0].dims[1];let d=[64,1,1],u={x:n.map((O,E)=>E)},h=[Math.ceil(hM(u.x.map(O=>n[O]))/d[0]),1,1];Pn("verbose",()=>`[conv3d_naive_webgpu] dispatch = ${h}`);let g=1,p=Ge.size(n),m=[{type:12,data:p},{type:12,data:s},{type:12,data:i},{type:12,data:t.strides},{type:12,data:t.dilations}];Eu(t,m),m.push(...zt(e[0].dims,e[1].dims));let y=["rank","rank"],v=e.length===3;v&&(m.push(...zt(e[2].dims)),y.push("rank")),m.push(...zt(n));let T=O=>{let E=[{name:"output_size",type:"u32"},{name:"filter_dims",type:"u32",length:s.length},{name:"pads",type:"u32",length:i.length},{name:"strides",type:"u32",length:t.strides.length},{name:"dilations",type:"u32",length:t.dilations.length}];Tu(t,E);let S=1,D=ga(e[0].dataType),I=et("x",e[0].dataType,e[0].dims.length,g),M=et("W",e[1].dataType,e[1].dims.length,S),C=[I,M],A=Pt("result",e[0].dataType,n.length,S),k="";if(v){let te=et("bias",e[2].dataType,e[2].dims.length,S);C.push(te),k+=`
        fn getBiasByOutputCoords(coords : array<u32, 5>) -> ${D} {
          return bias[${c?$t("coords",4,5):$t("coords",1,5)}];
        }`}let R=Ma(g,D),G=xu(t,R,D);return`
            ${k}
            fn getX(d0 : u32, d1 : u32, d2 : u32, d3 : u32, d4 : u32) -> f32 {
              let aIndices = array<u32, 5>(d0, d1, d2, d3, d4);
              return ${I.getByIndices("aIndices")};
            }
            fn getW(d0 : u32, d1 : u32, d2 : u32, d3 : u32, d4 : u32) -> f32 {
              let aIndices = array<u32, 5>(d0, d1, d2, d3, d4);
              return ${M.getByIndices("aIndices")};
            }
          ${O.registerUniforms(E).declareVariables(...C,A)}
          ${O.mainStart()}
          ${O.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
              let coords = ${A.offsetToIndices("global_idx")};
              let batch = ${$t("coords",0,I.rank)};
              let d2 = ${c?$t("coords",I.rank-1,I.rank):$t("coords",1,I.rank)};
              let xFRCCorner = vec3<u32>(${c?$t("coords",1,I.rank):$t("coords",2,I.rank)},
              ${c?$t("coords",2,I.rank):$t("coords",3,I.rank)},
              ${c?$t("coords",3,I.rank):$t("coords",4,I.rank)}) * uniforms.strides - uniforms.pads;
              let xFCorner = xFRCCorner.x;
              let xRCorner = xFRCCorner.y;
              let xCCorner = xFRCCorner.z;
              let xShapeY = ${c?$t("uniforms.x_shape",1,I.rank):$t("uniforms.x_shape",2,I.rank)};
              let xShapeZ = ${c?$t("uniforms.x_shape",2,I.rank):$t("uniforms.x_shape",3,I.rank)};
              let xShapeW = ${c?$t("uniforms.x_shape",3,I.rank):$t("uniforms.x_shape",4,I.rank)};
              let xShapeU = ${c?$t("uniforms.x_shape",4,I.rank):$t("uniforms.x_shape",1,I.rank)};
              let inputDepthNearestVec4 = (xShapeU / 4) * 4;
              let inputDepthVec4Remainder = xShapeU % 4;

              var value = 0.0;
              for (var wF = 0u; wF < uniforms.filter_dims[0]; wF++) {
                let xF = xFCorner + wF * uniforms.dilations[0];
                if (xF < 0 || xF >= xShapeY) {
                  continue;
                }

                for (var wR = 0u; wR < uniforms.filter_dims[1]; wR++) {
                  let xR = xRCorner + wR * uniforms.dilations[1];
                  if (xR < 0 || xR >= xShapeZ) {
                    continue;
                  }

                  for (var wC = 0u; wC < uniforms.filter_dims[2]; wC++) {
                    let xC = xCCorner + wC * uniforms.dilations[2];
                    if (xC < 0 || xC >= xShapeW) {
                      continue;
                    }

                    for (var d1 = 0u; d1 < inputDepthNearestVec4; d1 += 4) {
                      ${c?`let xValues = vec4<f32>(
                               getX(batch, xF, xR, xC, d1),
                               getX(batch, xF, xR, xC, d1 + 1),
                               getX(batch, xF, xR, xC, d1 + 2),
                               getX(batch, xF, xR, xC, d1 + 3));
                            `:`let xValues = vec4<f32>(
                               getX(batch, d1, xF, xR, xC),
                               getX(batch, d1 + 1, xF, xR, xC),
                               getX(batch, d1 + 2, xF, xR, xC),
                               getX(batch, d1 + 3, xF, xR, xC));
                            `}
                            let wValues = vec4<f32>(
                              getW(d2, d1, wF, wR, wC),
                              getW(d2, d1 + 1, wF, wR, wC),
                              getW(d2, d1 + 2, wF, wR, wC),
                              getW(d2, d1 + 3, wF, wR, wC));
                      value += dot(xValues, wValues);
                    }
                    if (inputDepthVec4Remainder == 1) {
                        ${c?`value += getX(batch, xF, xR, xC, inputDepthNearestVec4)
                          * getW(d2, inputDepthNearestVec4, wF, wR, wC);`:`value += getX(batch, inputDepthNearestVec4, xF, xR, xC)
                          * getW(d2, inputDepthNearestVec4, wF, wR, wC);`}
                    } else if (inputDepthVec4Remainder == 2) {
                      ${c?`let xValues = vec2<f32>(
                        getX(batch, xF, xR, xC, inputDepthNearestVec4),
                        getX(batch, xF, xR, xC, inputDepthNearestVec4 + 1));
                      `:`let xValues = vec2<f32>(
                        getX(batch, inputDepthNearestVec4, xF, xR, xC),
                        getX(batch, inputDepthNearestVec4 + 1, xF, xR, xC));
                    `}
                    let wValues = vec2<f32>(
                      getW(d2, inputDepthNearestVec4, wF, wR, wC),
                      getW(d2, inputDepthNearestVec4 + 1, wF, wR, wC));
                      value += dot(xValues, wValues);
                    } else if (inputDepthVec4Remainder == 3) {
                      ${c?`let xValues = vec3<f32>(
                        getX(batch, xF, xR, xC, inputDepthNearestVec4),
                        getX(batch, xF, xR, xC, inputDepthNearestVec4 + 1),
                        getX(batch, xF, xR, xC, inputDepthNearestVec4 + 2));
                      `:`let xValues = vec3<f32>(
                        getX(batch, inputDepthNearestVec4, xF, xR, xC),
                        getX(batch, inputDepthNearestVec4 + 1, xF, xR, xC),
                        getX(batch, inputDepthNearestVec4 + 2, xF, xR, xC));
                    `}
                    let wValues = vec3<f32>(
                      getW(d2, inputDepthNearestVec4, wF, wR, wC),
                      getW(d2, inputDepthNearestVec4 + 1, wF, wR, wC),
                      getW(d2, inputDepthNearestVec4 + 2, wF, wR, wC));
                      value += dot(xValues, wValues);
                    }
                  }
                }
              }
              ${v?"value = value + getBiasByOutputCoords(coords)":""};
              ${G}
              result[global_idx] = f32(value);
          }`};return{name:"Conv3DNaive",shaderCache:{hint:`${t.cacheKey};${c};${g};${v}`,inputDependencies:y},getRunData:()=>({outputs:[{dims:n,dataType:e[0].dataType}],dispatchGroup:{x:h[0],y:h[1],z:h[2]},programUniforms:m}),getShaderSource:T}}}),LT,FT,iD=mt(()=>{Xt(),sn(),cn(),Cu(),LT=(e,t,n,s)=>{let i=e.length>2,o=i?"value += b[output_channel];":"",c=e[0].dims,d=e[1].dims,u=t.format==="NHWC",h=u?n[3]:n[1],g=h/t.group,p=u&&g>=4?Lr(h):1,m=Ge.size(n)/p,y=[{type:12,data:m},{type:12,data:t.dilations},{type:12,data:[t.strides[0],t.strides[1]]},{type:12,data:[t.pads[0],t.pads[1]]},{type:12,data:g}];Eu(t,y),y.push(...zt(c,[d[0],d[1],d[2],d[3]/p]));let v=i?["rank","rank","rank"]:["rank","rank"];y.push(...zt([n[0],n[1],n[2],n[3]/p]));let T=O=>{let E=Pt("output",e[0].dataType,n.length,p),S=ga(E.type.tensor),D=xu(t,E.type.value,S),I=et("x",e[0].dataType,c.length),M=et("w",e[1].dataType,d.length,p),C=[I,M];i&&C.push(et("b",e[2].dataType,e[2].dims,p));let A=[{name:"output_size",type:"u32"},{name:"dilations",type:"u32",length:t.dilations.length},{name:"strides",type:"u32",length:2},{name:"pads",type:"u32",length:2},{name:"output_channels_per_group",type:"u32"}];Tu(t,A);let k=u?`
      for (var wHeight: u32 = 0u; wHeight < uniforms.w_shape[0]; wHeight++) {
        let xHeight = xRCCorner.x + wHeight * uniforms.dilations[0];

        if (xHeight < 0u || xHeight >= uniforms.x_shape[1]) {
          continue;
        }

        for (var wWidth: u32 = 0u; wWidth < uniforms.w_shape[1]; wWidth++) {
          let xWidth = xRCCorner.y + wWidth * uniforms.dilations[1];
          if (xWidth < 0u || xWidth >= uniforms.x_shape[2]) {
            continue;
          }

          for (var wInChannel: u32 = 0u; wInChannel < uniforms.w_shape[2]; wInChannel++) {
            let input_channel = in_channel_offset + wInChannel;
            let xVal = ${I.get("batch","xHeight","xWidth","input_channel")};
            let wVal = ${M.get("wHeight","wWidth","wInChannel","output_channel")};
            value += xVal * wVal;
          }
        }
      }
      `:`
      for (var wInChannel: u32 = 0u; wInChannel < uniforms.w_shape[1]; wInChannel++) {
        let input_channel = in_channel_offset + wInChannel;
        for (var wHeight: u32 = 0u; wHeight < uniforms.w_shape[2]; wHeight++) {
          let xHeight = xRCCorner.x + wHeight * uniforms.dilations[0];

          if (xHeight < 0u || xHeight >= uniforms.x_shape[2]) {
            continue;
          }

          for (var wWidth: u32 = 0u; wWidth < uniforms.w_shape[3]; wWidth++) {
            let xWidth = xRCCorner.y + wWidth * uniforms.dilations[1];
            if (xWidth < 0u || xWidth >= uniforms.x_shape[3]) {
              continue;
            }

            let xVal = ${I.get("batch","input_channel","xHeight","xWidth")};
            let wVal = ${M.get("output_channel","wInChannel","wHeight","wWidth")};
            value += xVal * wVal;
          }
        }
      }
      `;return`
  ${O.registerUniforms(A).declareVariables(...C,E)}

  ${O.mainStart()}
    ${O.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}

    let outputIndices = ${E.offsetToIndices("global_idx")};
    let batch: u32 = outputIndices[0];
    let output_channel: u32 = outputIndices[${u?3:1}];
    let xRCCorner: vec2<u32> = vec2<u32>(outputIndices[${u?1:2}], outputIndices[${u?2:3}]) * uniforms.strides - uniforms.pads;
    let group_id: u32 = output_channel * ${p} / uniforms.output_channels_per_group;
    var in_channel_offset = group_id * uniforms.w_shape[${u?2:1}];

    var value: ${E.type.value} = ${E.type.value}(0);
    ${k}
    ${o}
    ${D}
    ${E.setByOffset("global_idx","value")}
  }`};return{name:"GroupedConv",shaderCache:{hint:`${t.cacheKey}_${p}`,inputDependencies:v},getRunData:()=>({outputs:[{dims:s?s(n):n,dataType:e[0].dataType}],dispatchGroup:{x:Math.ceil(m/64)},programUniforms:y}),getShaderSource:T}},FT=(e,t,n,s)=>{let i=e.length>2,o=Lr(n[3]),c=Lr(n[2]),d=Ge.size(n)/o/c,u=[e[0].dims[0],e[0].dims[1],e[0].dims[2],e[0].dims[3]/o],h=[e[1].dims[0],e[1].dims[1],e[1].dims[2],e[1].dims[3]/o],g=[n[0],n[1],n[2],n[3]/o],p=[{type:12,data:d},{type:6,data:[t.strides[0],t.strides[1]]},{type:6,data:[t.pads[0],t.pads[1]]}];Eu(t,p),p.push(...zt(u,h,g));let m=(c-1)*t.strides[1]+h[1],y=v=>{let T=Pt("output",e[0].dataType,g.length,o),O=ga(T.type.tensor),E=xu(t,T.type.value,O),S=et("x",e[0].dataType,u.length,o),D=et("w",e[1].dataType,h.length,o),I=[S,D];i&&I.push(et("b",e[2].dataType,e[2].dims,o));let M=i?"value += b[output_channel];":"",C=[{name:"output_size",type:"u32"},{name:"strides",type:"i32",length:2},{name:"pads",type:"i32",length:2}];return Tu(t,C),`
  ${v.registerUniforms(C).declareVariables(...I,T)}
  ${v.mainStart()}
    ${v.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
    let width0 = uniforms.output_shape[3];
    let output_channel = global_idx % width0;
    var index1 = global_idx / width0;
    let width1 = uniforms.output_shape[2] / ${c}u;
    let col = (index1 % width1) * ${c}u;
    index1 = index1 / width1;
    let row = index1 % uniforms.output_shape[1];
    let batch = index1 / uniforms.output_shape[1];

    let x_corner = vec2<i32>(i32(row), i32(col)) * uniforms.strides - uniforms.pads;

    var x_vals: array<${S.type.value}, ${m}>;
    var values: array<${T.type.value}, ${c}>;
    let input_channel = output_channel;
    // Use constant instead of uniform can give better performance for w's height/width.
    for (var w_height: u32 = 0u; w_height < ${h[0]}; w_height++) {
      let x_height = x_corner.x + i32(w_height);
      if (x_height >= 0 && u32(x_height) < uniforms.x_shape[1]) {
        for (var i = 0; i < ${m}; i++) {
          let x_width = x_corner.y + i;
          if (x_width >= 0 && u32(x_width) < uniforms.x_shape[2]) {
            x_vals[i] = ${S.get("batch","u32(x_height)","u32(x_width)","input_channel")};
          } else {
            x_vals[i] = ${S.type.value}(0);
          }
        }
        for (var w_width: u32 = 0u; w_width < ${h[1]}; w_width++) {
          let w_val = ${D.get("w_height","w_width","0","output_channel")};
          for (var i = 0u; i < ${c}u; i++) {
            values[i] = fma(x_vals[i * u32(uniforms.strides[1]) + w_width], w_val, values[i]);
          }
        }
      }
    }

    for (var i = 0u; i < ${c}u; i++) {
      var value = values[i];
      ${M}
      ${E}
      ${T.set("batch","row","col + i","output_channel","value")};
    }
  }`};return{name:"GroupedConv-Vectorize",shaderCache:{hint:`${t.cacheKey};${o};${c};${m};${h[0]};${h[1]}`,inputDependencies:i?["rank","rank","type"]:["rank","rank"]},getRunData:()=>({outputs:[{dims:s?s(n):n,dataType:e[0].dataType}],dispatchGroup:{x:Math.ceil(d/64)},programUniforms:p}),getShaderSource:y}}}),gM,Eg,_M,Tg,Ev,y0,vM,yM,Tv,oD=mt(()=>{sn(),aD(),sD(),hy(),iD(),Cu(),fy(),lc(),gM=(e,t,n,s,i,o)=>{let c=e[0],d=e.slice(o?1:2,o?3:4),u=d.length,h=t[0],g=t.slice(2).map((m,y)=>m+(m-1)*(n[y]-1)),p=d.map((m,y)=>m+s[y]+s[y+u]).map((m,y)=>Math.floor((m-g[y]+i[y])/i[y]));return p.splice(0,0,c),p.splice(o?3:1,0,h),p},Eg=[2,3,1,0],_M=(e,t)=>{if(!e||e.length!==2&&e.length!==3)throw new Error("Conv requires 2 or 3 inputs");if(e[0].dims.length>5)throw new Error("greater than 5D is not supported");if(e[0].dims.length!==e[1].dims.length)throw new Error("filter does not have same dimension as input");let n=e[0].dims[t.format==="NHWC"?e[0].dims.length-1:1],s=e[1].dims[1]*t.group;if(n!==s)throw new Error("FILTER_IN_CHANNEL should be equal to DATA_CHANNEL");if(e.length===3&&(e[2].dims.length!==1||e[1].dims[0]!==e[2].dims[0]))throw new Error("invalid bias");let i=e[0].dims.length-2;if(t.dilations.length!==i)throw new Error(`dilations should be ${i}D`);if(t.strides.length!==i)throw new Error(`strides should be ${i}D`);if(t.pads.length!==i*2)throw new Error(`pads should be ${i*2}D`);if(t.kernelShape.length!==0&&t.kernelShape.length!==e[1].dims.length-2)throw new Error("invalid kernel shape")},Tg=(e,t)=>{let n=e.kernelShape.slice();n.length<t[1].dims.length-2&&n.push(...Array(t[1].dims.length-2-n.length).fill(0));for(let o=2;o<t[1].dims.length;++o)n[o-2]===0&&(n[o-2]=t[1].dims[o]);let s=e.pads.slice();t_.adjustPadsBasedOnAutoPad(t[0].dims,e.strides,e.dilations,n,s,e.format==="NHWC",e.autoPad);let i=Object.assign({},e);return Object.assign(i,{kernelShape:n,pads:s}),i},Ev=e=>{let t=cy(e),n=e.format,s=["NOTSET","VALID","SAME_UPPER","SAME_LOWER"][e.auto_pad],i=e.dilations,o=e.group,c=e.kernel_shape,d=e.pads,u=e.strides,h=e.w_is_const();return{autoPad:s,format:n,dilations:i,group:o,kernelShape:c,pads:d,strides:u,wIsConst:h,...t,cacheKey:`${e.format};${t.activation};`}},y0=(e,t,n,s)=>{let i=n.format==="NHWC",o=gM(t[0].dims,t[1].dims,n.dilations,n.pads,n.strides,i);if(n.group!==1){let C=[t[0]];if(i){let A=e.kernelCustomData.wT??e.compute($s(t[1],Eg),{inputs:[1],outputs:[n.wIsConst?-2:-1]})[0];n.wIsConst&&!e.kernelCustomData.wT&&(e.kernelCustomData.wT=A),C.push(A)}else C.push(t[1]);t.length===3&&C.push(t[2]),!e.adapterInfo.isArchitecture("ampere")&&i&&t[1].dims[0]===n.group&&t[1].dims[1]===1&&n.dilations[0]===1&&n.dilations[1]===1?e.compute(FT(C,n,o,s),{inputs:C}):e.compute(LT(C,n,o,s),{inputs:C});return}let c=t.length===3,d=t[0].dims[i?1:2],u=t[0].dims[i?2:3],h=t[0].dims[i?3:1],g=t[1].dims[2],p=t[1].dims[3],m=o[i?1:2],y=o[i?2:3],v=o[i?3:1],T=i&&g===d&&p===u&&n.pads[0]===0&&n.pads[1]===0;if(T||g===1&&p===1&&n.dilations[0]===1&&n.dilations[1]===1&&n.strides[0]===1&&n.strides[1]===1&&n.pads[0]===0&&n.pads[1]===0){let C=o[0],A,k,R,G=[];if(i){let X=e.kernelCustomData.wT??e.compute($s(t[1],Eg),{inputs:[1],outputs:[n.wIsConst?-2:-1]})[0];if(n.wIsConst&&!e.kernelCustomData.wT&&(e.kernelCustomData.wT=X),T){let le=d*u*h;A=t[0].reshape([1,C,le]),k=X.reshape([1,le,v]),R=[1,C,v]}else A=t[0].reshape([C,d*u,h]),k=X.reshape([1,h,v]),R=[C,m*y,v];G.push(A),G.push(k)}else A=t[0].reshape([C,h,d*u]),k=t[1].reshape([1,v,h]),R=[C,v,m*y],G.push(k),G.push(A);c&&G.push(t[2]);let te=R[2],ee=G[0].dims[G[0].dims.length-1];te<8&&ee<8?e.compute(dy(G,n,o,R,i,s),{inputs:G}):e.compute(r_(G,n,o,R,i,s),{inputs:G});return}let O=!0,E=e.kernelCustomData.wT??e.compute($s(t[1],Eg),{inputs:[1],outputs:[n.wIsConst?-2:-1]})[0];n.wIsConst&&!e.kernelCustomData.wT&&(e.kernelCustomData.wT=E);let S=[t[0],E];c&&S.push(t[2]);let D=i?m*y:v,I=i?v:m*y,M=g*p*h;e.compute(OT(S,n,o,D,I,M,c,O,s),{inputs:S})},vM=(e,t)=>{let n=t.format==="NHWC",s=[e.inputs[0].reshape(n?[e.inputs[0].dims[0],1,e.inputs[0].dims[1],e.inputs[0].dims[2]]:[e.inputs[0].dims[0],e.inputs[0].dims[1],1,e.inputs[0].dims[2]]),e.inputs[1].reshape([e.inputs[1].dims[0],e.inputs[1].dims[1],1,e.inputs[1].dims[2]])];e.inputs.length===3&&s.push(e.inputs[2]);let i=[0,t.pads[0],0,t.pads[1]],o=[1].concat(t.strides),c=[1].concat(t.dilations),d=[1].concat(t.kernelShape),u=Tg({...t,pads:i,strides:o,dilations:c,kernelShape:d},s);y0(e,s,u,h=>n?[h[0],h[2],h[3]]:[h[0],h[1],h[3]])},yM=(e,t,n)=>{let s=n.format==="NHWC"?"channelsLast":"channelsFirst",i=Tg(n,t),o=n.autoPad==="NOTSET"?n.pads:n.autoPad,c=$T(t[0].dims,t[1].dims,n.strides,n.dilations,o,!1,s);e.compute(BT(t,i,c.outShape,[c.filterDepth,c.filterHeight,c.filterWidth],[c.padInfo.front,c.padInfo.top,c.padInfo.left],s))},Tv=(e,t)=>{if(_M(e.inputs,t),e.inputs[0].dims.length===3)vM(e,t);else if(e.inputs[0].dims.length===5)yM(e,e.inputs,t);else{let n=Tg(t,e.inputs);y0(e,e.inputs,n)}}}),zT,lD=mt(()=>{Xt(),nl(),sn(),cn(),zT=(e,t,n)=>{let s=e.length>2,i=t.outputShape,o=t.format==="NHWC",c=t.group,d=e[1].dims,u=d[2]/c,h=d[3],g=o?Lr(u):1,p=o&&h===1&&u>=4,m=p?Math.floor(u/4)*4:Math.floor(u/g)*g,y=u-m,v=o?Lr(h):1,T=o?h===1?g:v:1,O=Ge.size(i)/v,E=[Math.ceil(O/64),1,1];Pn("verbose",()=>`[conv2d_backprop_webgpu] dispatch = ${E}`);let S=["rank","rank"],D=[t.strides[0],t.strides[1]],I=[t.kernelShape[o?1:2],t.kernelShape[o?2:3]],M=[t.dilations[0],t.dilations[1]],C=[I[0]+(t.dilations[0]<=1?0:(t.kernelShape[o?1:2]-1)*(t.dilations[0]-1)),I[1]+(t.dilations[1]<=1?0:(t.kernelShape[o?2:3]-1)*(t.dilations[1]-1))],A=[C[0]-1-Math.floor((t.pads[0]+t.pads[2])/2),C[1]-1-Math.floor((t.pads[1]+t.pads[3])/2)],k=[{type:12,data:O},{type:12,data:D},{type:12,data:I},{type:12,data:M},{type:12,data:C},{type:6,data:A},{type:12,data:m},{type:12,data:u},{type:12,data:h},...zt(e[0].dims,e[1].dims)];s&&(k.push(...zt(e[2].dims)),S.push("rank")),k.push(...zt(i));let R=G=>{let te=[{name:"output_size",type:"u32"},{name:"strides",type:"u32",length:D.length},{name:"filter_dims",type:"u32",length:I.length},{name:"dilations",type:"u32",length:I.length},{name:"effective_filter_dims",type:"u32",length:C.length},{name:"pads",type:"i32",length:A.length},{name:"input_channels_per_group_int",type:"u32"},{name:"input_channels_per_group",type:"u32"},{name:"output_channels_per_group",type:"u32"}],ee=ga(e[0].dataType),X=o?1:2,le=o?2:3,ae=o?3:1,Q=et("W",e[1].dataType,e[1].dims.length,T),ne=et("Dy",e[0].dataType,e[0].dims.length,g),de=[ne,Q];s&&de.push(et("bias",e[2].dataType,[i[ae]].length,v));let ve=Pt("result",e[0].dataType,i.length,v),fe=()=>{let N="";if(p)g===4?N+=`
        let xValue = ${ne.getByOffset("x_offset")};
        let wValue = ${Q.getByOffset("w_offset")};
        dotProd = dotProd + dot(xValue, wValue);
        x_offset += 1u;
        w_offset += 1u;`:g===2?N+=`
          dotProd = dotProd + dot(vec4<${ee}>(${ne.getByOffset("x_offset")}, ${ne.getByOffset("x_offset + 1u")}), vec4<${ee}>(${Q.getByOffset("w_offset")}, ${Q.getByOffset("w_offset + 1u")}));
          x_offset += 2u;
          w_offset += 2u;`:g===1&&(N+=`
          dotProd = dotProd + dot(vec4<${ee}>(${ne.getByOffset("x_offset")}, ${ne.getByOffset("x_offset + 1u")}, ${ne.getByOffset("x_offset + 2u")}, ${ne.getByOffset("x_offset + 3u")}), vec4<${ee}>(${Q.getByOffset("w_offset")}, ${Q.getByOffset("w_offset + 1u")}, ${Q.getByOffset("w_offset + 2u")}, ${Q.getByOffset("w_offset + 3u")}));
          x_offset += 4u;
          w_offset += 4u;`);else if(N+=`
                  let xValue = ${o?ne.getByOffset(`${ne.indicesToOffset(`${ne.type.indices}(batch, idyR, idyC, inputChannel)`)} / ${g}`):ne.get("batch","inputChannel","idyR","idyC")};
        `,g===1)N+=`
          let w_offset = ${Q.indicesToOffset(`${Q.type.indices}(u32(wRPerm), u32(wCPerm), inputChannel, wOutChannel)`)};
          let wValue = ${Q.getByOffset(`w_offset / ${T}`)};
          dotProd = dotProd + xValue * wValue;`;else for(let q=0;q<g;q++)N+=`
            let wValue${q} = ${Q.getByOffset(`${Q.indicesToOffset(`${Q.type.indices}(u32(wRPerm), u32(wCPerm), inputChannel + ${q}, wOutChannel)`)} / ${T}`)};
            dotProd = dotProd + xValue[${q}] * wValue${q};`;return N},j=()=>{if(y===0)return"";if(!p)throw new Error(`packInputAs4 ${p} is not true.`);let N="";if(g===1){N+="dotProd = dotProd";for(let q=0;q<y;q++)N+=`
            + ${ne.getByOffset(`x_offset + ${q}`)} * ${Q.getByOffset(`w_offset + ${q}`)}`;N+=";"}else if(g===2){if(y!==2)throw new Error(`Invalid inputChannelsRemainder ${y}.`);N+=`
          let xValue = ${ne.getByOffset("x_offset")};
          let wValue = ${Q.getByOffset("w_offset")};
          dotProd = dotProd + dot(xValue, wValue);`}return N},U=`
            let outputIndices = ${ve.offsetToIndices(`global_idx * ${v}`)};
            let batch = ${ve.indicesGet("outputIndices",0)};
            let d1 = ${ve.indicesGet("outputIndices",ae)};
            let r = ${ve.indicesGet("outputIndices",X)};
            let c = ${ve.indicesGet("outputIndices",le)};
            let dyCorner = vec2<i32>(i32(r), i32(c)) - uniforms.pads;
            let dyRCorner = dyCorner.x;
            let dyCCorner = dyCorner.y;
            let groupId = d1 / uniforms.output_channels_per_group;
            let wOutChannel = d1 - groupId * uniforms.output_channels_per_group;
            // Convolve dy(?, ?, d2) with w(:, :, d1, d2) to compute dx(xR, xC, d1).
            // ? = to be determined. : = across all values in that axis.
            var dotProd = ${ve.type.value}(0.0);
            var wR: u32 = 0;
            if (uniforms.dilations.x == 1) {
              // Minimum wR >= 0 that satisfies (dyRCorner + wR) % (uniforms.strides.x) == 0
              wR = u32(((dyRCorner + i32(uniforms.strides.x) - 1) / i32(uniforms.strides.x)) * i32(uniforms.strides.x) - dyRCorner);
            }
            for (; wR < uniforms.effective_filter_dims.x; wR = wR + 1) {
              if (wR % uniforms.dilations.x != 0) {
                continue;
              }
              let dyR = (${ee}(dyRCorner) + ${ee}(wR)) / ${ee}(uniforms.strides[0]);
              let wRPerm = uniforms.filter_dims.x - 1 - wR / uniforms.dilations.x;
              if (dyR < 0.0 || dyR >= ${ee}(uniforms.Dy_shape[${X}]) || fract(dyR) > 0.0 ||
                  wRPerm < 0) {
                continue;
              }
              let idyR: u32 = u32(dyR);
              var wC: u32 = 0;
              if (uniforms.dilations.y == 1) {
                // Minimum wC >= 0 that satisfies (dyCCorner + wC) % (uniforms.strides.y) == 0
                wC = u32(((dyCCorner + i32(uniforms.strides.y) - 1) / i32(uniforms.strides.y)) * i32(uniforms.strides.y) - dyCCorner);
              }
              for (; wC < uniforms.effective_filter_dims.y; wC = wC + 1) {
                if (wC % uniforms.dilations.y != 0) {
                  continue;
                }
                let dyC = (${ee}(dyCCorner) + ${ee}(wC)) / ${ee}(uniforms.strides.y);
                let wCPerm = uniforms.filter_dims.y - 1 - wC / uniforms.dilations.y;
                if (dyC < 0.0 || dyC >= ${ee}(uniforms.Dy_shape[${le}]) ||
                    fract(dyC) > 0.0 || wCPerm < 0) {
                  continue;
                }
                let idyC: u32 = u32(dyC);
                var inputChannel = groupId * uniforms.input_channels_per_group;
                ${p?`
                var x_offset = ${ne.indicesToOffset(`${ne.type.indices}(batch, idyR, idyC, inputChannel)`)} / ${g};
                var w_offset = ${Q.indicesToOffset(`${Q.type.indices}(wRPerm, wCPerm, inputChannel, wOutChannel)`)} / ${T};
                  `:""}
                for (var d2: u32 = 0; d2 < uniforms.input_channels_per_group_int; d2 = d2 + ${p?4:g}) {
                  ${fe()}
                  inputChannel = inputChannel + ${p?4:g};
                }
                ${j()}
                wC = wC + uniforms.strides.y - 1;
              }
              wR = wR + uniforms.strides[0] - 1;
            }
            let value = dotProd${s?` + bias[d1 / ${v}]`:""};
            ${ve.setByOffset("global_idx","value")};
          `;return`
    ${G.registerUniforms(te).declareVariables(...de,ve)}
      ${G.mainStart()}
      ${G.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")};
    ${U}}`};return{name:"ConvTranspose2D",shaderCache:{hint:`${t.cacheKey};${g}${T}${v}${p}${y}`,inputDependencies:S},getRunData:()=>({dispatchGroup:{x:E[0],y:E[1],z:E[2]},outputs:[{dims:n?n(i):i,dataType:e[0].dataType}],programUniforms:k}),getShaderSource:R}}}),bM,wM,MM,b0,NT,xM,w0,EM,RT,cD=mt(()=>{lD(),Cu(),lc(),bM=(e,t,n,s,i,o)=>(e-1)*t+n+(s-1)*i+1-o,wM=(e,t,n,s,i)=>{let o=Math.floor(e/2);t==="SAME_UPPER"?(n[s]=o,n[i]=e-o):t==="SAME_LOWER"&&(n[s]=e-o,n[i]=o)},MM=(e,t,n,s,i,o,c,d,u,h)=>{let g=e.length-2,p=h.length===0;u.length<g&&u.push(...Array(g-u.length).fill(0));let m=e[0],y=t[d?3:1]*i;for(let v=0,T=e.length-g-(d?1:0);v<g;++v,++T){let O=e[T],E=p?O*c[v]:h[v],S=bM(O,c[v],o[v],t[T],n[v],E);wM(S,s,o,v,v+g),p&&h.push(c[v]*(O-1)+u[v]+(t[T]-1)*n[v]+1-o[v]-o[v+g])}h.splice(0,0,m),h.splice(d?3:1,0,y)},b0=(e,t)=>{let n=e.kernelShape.slice();if(e.kernelShape.length===0||e.kernelShape.reduce((p,m)=>p*m,1)===0){n.length=0;for(let p=2;p<t[1].dims.length;++p)n.push(t[1].dims[p])}let s=e.format==="NHWC";n.splice(0,0,t[1].dims[0]),n.splice(s?3:1,0,t[1].dims[1]);let i=e.pads.slice(),o=e.outputShape.slice(),c=e.outputPadding.slice(),d=t[0].dims,u=e.dilations.slice();if(u.reduce((p,m)=>p+m,0)===0){let p=t[0].dims.length-2;u=new Array(p).fill(1)}let h=e.strides.slice();if(h.reduce((p,m)=>p+m,0)===0){let p=t[0].dims.length-2;h=new Array(p).fill(1)}MM(d,n,u,e.autoPad,e.group,i,h,s,c,o);let g=Object.assign({},e);return Object.assign(g,{kernelShape:n,pads:i,outputPadding:c,outputShape:o,dilations:u,strides:h}),g},NT=e=>{let t=cy(e),n=e.format,s=["NOTSET","VALID","SAME_UPPER","SAME_LOWER"][typeof e.autoPad>"u"?0:e.autoPad],i=e.dilations,o=e.group,c=e.kernelShape,d=e.pads,u=e.strides,h=e.wIsConst(),g=e.outputPadding,p=e.outputShape;return{autoPad:s,format:n,dilations:i,group:o,kernelShape:c,outputPadding:g,outputShape:p,pads:d,strides:u,wIsConst:h,...t,cacheKey:`${e.format};${t.activation};`}},xM=(e,t)=>{if(!e||e.length!==2&&e.length!==3)throw new Error("Conv requires 2 or 3 inputs");if(e[0].dims.length!==4&&e[0].dims.length!==3)throw new Error("currently only support 2-dimensional conv");if(e[0].dims.length!==e[1].dims.length)throw new Error("filter does not have same dimension as input");let n=e[0].dims[t.format==="NHWC"?e[0].dims.length-1:1],s=e[1].dims[0];if(n!==s)throw new Error("FILTER_IN_CHANNEL should be equal to DATA_CHANNEL");let i=e[1].dims[1]*t.group;if(e.length===3&&(e[2].dims.length!==1||e[2].dims[0]!==i))throw new Error("invalid bias");let o=e[0].dims.length-2;if(t.dilations.reduce((c,d)=>c+d,0)>0&&t.dilations.length!==o)throw new Error(`dilations should be ${o}D`);if(t.strides.reduce((c,d)=>c+d,0)>0&&t.strides.length!==o)throw new Error(`strides should be ${o}D`);if(t.pads.reduce((c,d)=>c+d,0)>0&&t.pads.length!==o*2)throw new Error(`pads should be ${o*2}D`);if(t.outputPadding.length!==o&&t.outputPadding.length!==0)throw new Error(`output_padding should be ${o}D`);if(t.kernelShape.reduce((c,d)=>c+d,0)>0&&t.kernelShape.length!==0&&t.kernelShape.length!==e[1].dims.length-2)throw new Error("invalid kernel shape");if(t.outputShape.length!==0&&t.outputShape.length!==e[0].dims.length-2)throw new Error("invalid output shape")},w0=(e,t,n,s)=>{let i=e.kernelCustomData.wT??e.compute($s(t[1],[2,3,0,1]),{inputs:[1],outputs:[n.wIsConst?-2:-1]})[0];n.wIsConst&&!e.kernelCustomData.wT&&(e.kernelCustomData.wT=i);let o=[t[0],i];t.length===3&&o.push(t[2]),e.compute(zT(o,n,s),{inputs:o})},EM=(e,t)=>{let n=t.format==="NHWC",s=[e.inputs[0].reshape(n?[e.inputs[0].dims[0],1,e.inputs[0].dims[1],e.inputs[0].dims[2]]:[e.inputs[0].dims[0],e.inputs[0].dims[1],1,e.inputs[0].dims[2]]),e.inputs[1].reshape([e.inputs[1].dims[0],e.inputs[1].dims[1],1,e.inputs[1].dims[2]])];e.inputs.length===3&&s.push(e.inputs[2]);let i=t.kernelShape;(i.length===0||i[0]===0)&&(i=[e.inputs[1].dims[2]]);let o=t.dilations;(o.length===0||o[0]===0)&&(o=[1]);let c=t.strides;(c.length===0||c[0]===0)&&(c=[1]);let d=t.pads;d.length===0&&(d=[0,0]),d=[0,d[0],0,d[1]],c=[1].concat(c),o=[1].concat(o),i=[1].concat(i);let u=t.outputPadding;u=[0].concat(u);let h=b0({...t,pads:d,strides:c,dilations:o,kernelShape:i,outputPadding:u},s);w0(e,s,h,g=>n?[g[0],g[2],g[3]]:[g[0],g[1],g[3]])},RT=(e,t)=>{if(xM(e.inputs,t),e.inputs[0].dims.length===3)EM(e,t);else{let n=b0(t,e.inputs);w0(e,e.inputs,n)}}}),TM,jT,UT,uD=mt(()=>{Xt(),sn(),Hr(),cn(),TM=(e,t,n,s)=>{let i=Ge.size(t),o=t.length,c=et("input",e,o),d=Pt("output",e,o),u=n.dataType===6?n.getInt32Array()[0]:Number(n.getBigInt64Array()[0]),h=Ge.normalizeAxis(u,o),g=p=>{let m=` i32(${c.indicesGet("inputIndices","uniforms.axis")}) `,y=$t("uniforms.input_shape","uniforms.axis",o),v=s.reverse?m+(s.exclusive?" + 1":""):"0",T=s.reverse?y:m+(s.exclusive?"":" + 1");return`
                ${p.registerUniform("outputSize","u32").registerUniform("axis","u32").declareVariables(c,d)}
                ${p.mainStart()}
                  ${p.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.outputSize")}
                  var inputIndices = ${d.offsetToIndices("global_idx")};
                  var sum = ${d.type.value}(0);
                  let first : i32 = ${v};
                  let last : i32 = ${T};
                  for (var i : i32 = first; i < last; i++) {
                    ${c.indicesSet("inputIndices","uniforms.axis","u32(i)")};
                    sum = sum + ${c.getByIndices("inputIndices")};
                  }
                  ${d.setByOffset("global_idx","sum")};
                }`};return{name:"CumSum",shaderCache:{hint:s.cacheKey,inputDependencies:["rank"]},getRunData:()=>({outputs:[{dims:t,dataType:e}],dispatchGroup:{x:Math.ceil(i/64)},programUniforms:[{type:12,data:i},{type:12,data:h},...zt(t,t)]}),getShaderSource:g}},jT=(e,t)=>{let n=e.inputs[0].dims,s=e.inputs[0].dataType,i=e.inputs[1];e.compute(TM(s,n,i,t),{inputs:[0]})},UT=e=>{let t=e.exclusive===1,n=e.reverse===1;return Nn({exclusive:t,reverse:n})}}),AM,CM,SM,VT,GT,dD=mt(()=>{Xt(),sn(),Hr(),cn(),AM=e=>{if(!e||e.length!==1)throw new Error("DepthToSpace requires 1 input.");if(e[0].dims.length!==4)throw new Error("DepthToSpace requires 4D input.")},CM=(e,t,n,s)=>{let i=[];i.push(`fn perm(i: ${s.type.indices}) -> ${n.type.indices} {
    var a: ${n.type.indices};`);for(let o=0;o<t;++o)i.push(n.indicesSet("a",e[o],`i[${o}]`));return i.push("return a;}"),i.join(`
`)},SM=(e,t)=>{let n,s,i,o,c,d,u=t.format==="NHWC",h=t.blocksize,g=t.mode==="DCR";u?([n,s,i,o]=e.dims,c=g?[n,s,i,h,h,o/h**2]:[n,s,i,o/h**2,h,h],d=g?[0,1,3,2,4,5]:[0,1,4,2,5,3]):([n,s,i,o]=[e.dims[0],e.dims[2],e.dims[3],e.dims[1]],c=g?[n,h,h,o/h**2,s,i]:[n,o/h**2,h,h,s,i],d=g?[0,3,4,1,5,2]:[0,1,4,2,5,3]);let p=e.reshape(c),m=p.dims.length,y=e.dataType,v=et("a",y,m),T=Pt("output",y,m),O=E=>`
  ${E.registerUniform("output_size","u32").declareVariables(v,T)}

  ${CM(d,m,v,T)}

  ${E.mainStart()}
    ${E.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}

    let indices = ${T.offsetToIndices("global_idx")};
    let aIndices = perm(indices);

    ${T.setByOffset("global_idx",v.getByIndices("aIndices"))}
  }`;return{name:"DepthToSpace",shaderCache:{hint:`${e.dims};${t.blocksize};${t.mode}`,inputDependencies:["rank"]},getRunData:E=>{let S=u?[n,s*h,i*h,o/h**2]:[n,o/h**2,s*h,i*h],D=Ge.size(S),I=p.dims,M=Ge.sortBasedOnPerm(I,d);return{outputs:[{dims:S,dataType:E[0].dataType}],dispatchGroup:{x:Math.ceil(D/64)},programUniforms:[{type:12,data:D},...zt(I,M)]}},getShaderSource:O}},VT=(e,t)=>{AM(e.inputs),e.compute(SM(e.inputs[0],t))},GT=e=>Nn({blocksize:e.blocksize,mode:e.mode,format:e.format})}),Ag,Yp,M0,IM,PM,kM,DM,x0,OM,WT,HT,fD=mt(()=>{Xt(),sn(),Hr(),cn(),Ag="[a-zA-Z]|\\.\\.\\.",Yp="("+Ag+")+",M0="^"+Yp+"$",IM="("+Yp+",)*"+Yp,PM="^"+IM+"$",kM=class{constructor(e=-1){this.symbolToIndices=new Map,this.inputIndex=e}addSymbol(e,t){let n=this.symbolToIndices.get(e);n===void 0?n=[t]:n.push(t),this.symbolToIndices.set(e,n)}},DM=class{constructor(e,t){var i;this.equation=t,this.hasEllipsis=!1,this.symbolToInfo=new Map,this.lhs=new Array,this.outputDims=[];let[n,s]=t.includes("->")?t.split("->",2):[t,""];if(!n.match(RegExp(PM)))throw new Error("Invalid LHS term");if(n.split(",").forEach((o,c)=>{let d=e[c].dims.slice();if(!o.match(RegExp(M0)))throw new Error("Invalid LHS term");let u=this.processTerm(o,!0,d,c);this.lhs.push(u)}),s==="")s+=[...this.symbolToInfo.entries()].filter(([o,c])=>c.count===1||o==="...").map(([o])=>o).join("");else if(!s.match(RegExp(Yp)))throw new Error("Invalid RHS");(i=s.match(RegExp(Ag,"g")))==null||i.forEach(o=>{if(o==="...")this.outputDims=this.outputDims.concat(this.ellipsisDims);else{let c=this.symbolToInfo.get(o);if(c===void 0)throw new Error("Invalid RHS symbol");this.outputDims.push(c.dimValue)}}),this.rhs=this.processTerm(s,!1,this.outputDims)}addSymbol(e,t,n){let s=this.symbolToInfo.get(e);if(s!==void 0){if(s.dimValue!==t&&s.count!==1)throw new Error("Dimension mismatch");s.count++,s.inputIndices.push(n)}else s={count:1,dimValue:t,inputIndices:[n]};this.symbolToInfo.set(e,s)}processTerm(e,t,n,s=-1){let i=n.length,o=!1,c=[],d=0;if(!e.match(RegExp(M0))&&!t&&e!=="")throw new Error("Invalid LHS term");let u=e.match(RegExp(Ag,"g")),h=new kM(s);return u==null||u.forEach((g,p)=>{if(g==="..."){if(o)throw new Error("Only one ellipsis is allowed per input term");o=!0;let m=i-u.length+1;if(m<0)throw new Error("Ellipsis out of bounds");if(c=n.slice(d,d+m),this.hasEllipsis){if(this.ellipsisDims.length!==c.length||this.ellipsisDims.toString()!==c.toString())throw new Error("Ellipsis dimensions mismatch")}else if(t)this.hasEllipsis=!0,this.ellipsisDims=c;else throw new Error("Ellipsis must be specified in the LHS");for(let y=0;y<c.length;y++){let v=String.fromCharCode(48+y);h.addSymbol(v,p+y),this.addSymbol(v,n[d++],s)}}else h.addSymbol(g,p+(this.hasEllipsis?this.ellipsisDims.length-1:0)),this.addSymbol(g,n[d++],s)}),h}},x0=e=>e+"_max",OM=(e,t,n,s)=>{let i=e.map(h=>h.length).map((h,g)=>et(`input${g}`,t,h)),o=Ge.size(s),c=Pt("output",t,s.length),d=[...n.symbolToInfo.keys()].filter(h=>!n.rhs.symbolToIndices.has(h)),u=h=>{let g=[],p="var prod = 1.0;",m="var sum = 0.0;",y="sum += prod;",v=[],T=[],O=[],E=[],S=n.symbolToInfo.size===n.rhs.symbolToIndices.size;n.symbolToInfo.forEach((I,M)=>{var C;if(n.rhs.symbolToIndices.has(M)){let A=(C=n.rhs.symbolToIndices.get(M))==null?void 0:C[0];A!==void 0&&n.lhs.forEach((k,R)=>{if(I.inputIndices.includes(R)){let G=k.symbolToIndices.get(M);if(G===void 0)throw new Error("Invalid symbol error");G.forEach(te=>{g.push(`${i[R].indicesSet(`input${R}Indices`,te,c.indicesGet("outputIndices",A))}`)})}})}else n.lhs.forEach((A,k)=>{if(I.inputIndices.includes(k)){let R=A.symbolToIndices.get(M);if(R===void 0)throw new Error("Invalid symbol error");R.forEach(G=>{v.push(`${i[k].indicesSet(`input${k}Indices`,G,`${M}`)}`)}),E.push(`prod *= ${i[k].getByIndices(`input${k}Indices`)};`)}}),T.push(`for(var ${M}: u32 = 0; ${M} < uniforms.${x0(M)}; ${M}++) {`),O.push("}")});let D=S?[...g,`let sum = ${i.map((I,M)=>I.getByIndices(`input${M}Indices`)).join(" * ")};`]:[...g,m,...T,...v,p,...E,y,...O];return`
            ${h.registerUniforms(d.map(I=>({name:`${x0(I)}`,type:"u32"}))).registerUniform("outputSize","u32").declareVariables(...i,c)}

            ${h.mainStart()}
            ${h.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.outputSize")}
            var outputIndices = ${c.offsetToIndices("global_idx")};
            ${i.map((I,M)=>`var input${M}Indices: ${i[M].type.indices};`).join(`
`)}
            ${D.join(`
`)};
            ${c.setByOffset("global_idx","sum")};
          }`};return{name:"Einsum",shaderCache:{hint:n.equation,inputDependencies:e.map(()=>"rank")},getRunData:()=>{let h=d.filter(p=>n.symbolToInfo.has(p)).map(p=>{var m;return{type:12,data:((m=n.symbolToInfo.get(p))==null?void 0:m.dimValue)||0}});h.push({type:12,data:o});let g=e.map((p,m)=>[...zt(p)]).reduce((p,m)=>p.concat(m),h);return g.push(...zt(s)),{outputs:[{dims:s,dataType:t}],dispatchGroup:{x:Math.ceil(o/64)},programUniforms:g}},getShaderSource:u}},WT=(e,t)=>{let n=new DM(e.inputs,t.equation),s=n.outputDims,i=e.inputs.map((o,c)=>o.dims);e.compute(OM(i,e.inputs[0].dataType,n,s))},HT=e=>{let t=e.equation.replace(/\s+/g,"");return Nn({equation:t})}}),$M,E0,BM,LM,QT,hD=mt(()=>{Xt(),sn(),cn(),$M=e=>{if(!e||e.length!==2)throw new Error("Expand requires 2 input.");let t=e[0].dims,n=Array.from(e[1].getBigInt64Array(),Number),s=n.length<t.length?0:n.length-t.length,i=t.length<n.length?0:t.length-n.length;for(;s<n.length&&i<t.length;++s,++i)if(n[s]!==t[i]&&n[s]!==1&&t[i]!==1)throw new Error("Expand requires shape to be broadcastable to input")},E0=(e,t)=>{let n=e.length-t.length,s=[];for(let i=0;i<n;++i)s.push(e[i]);for(let i=0;i<t.length;++i)s.push(t[i]===1?e[i+n]:t[i]);return s},BM=(e,t)=>e.length>t.length?E0(e,t):E0(t,e),LM=e=>{let t=e[0].dims,n=Array.from(e[1].getBigInt64Array(),Number),s=BM(t,n),i=e[0].dataType,o=i===9||Ge.size(t)===1,c=i===9||t.length>0&&t[t.length-1]%4===0?4:1,d=o||s.length>0&&s[s.length-1]%4===0?4:1,u=Math.ceil(Ge.size(s)/d),h=p=>{let m=et("input",i,t.length,c),y=Pt("output",i,s.length,d),v;if(i===9){let T=(O,E,S="")=>`
          let outputIndices${E} = ${y.offsetToIndices(`outputOffset + ${E}u`)};
          let offset${E} = ${m.broadcastedIndicesToOffset(`outputIndices${E}`,y)};
          let index${E} = offset${E} / 4u;
          let component${E} = offset${E} % 4u;
          ${O}[${E}] = ${S}(${m.getByOffset(`index${E}`)}[component${E}]);
        `;v=`
        let outputOffset = global_idx * ${d};
        var data = vec4<u32>(0);
        ${T("data",0,"u32")}
        ${T("data",1,"u32")}
        ${T("data",2,"u32")}
        ${T("data",3,"u32")}
        ${y.setByOffset("global_idx","data")}
      }`}else v=`
        let outputIndices = ${y.offsetToIndices(`global_idx * ${d}`)};
        let inputOffset = ${m.broadcastedIndicesToOffset("outputIndices",y)};
        let data = ${y.type.value}(${m.getByOffset(`inputOffset / ${c}`)});
        ${y.setByOffset("global_idx","data")}
      }`;return`
    ${p.registerUniform("vec_size","u32").declareVariables(m,y)}
    ${p.mainStart()}
    ${p.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.vec_size")}
    ${v}`},g=[{type:12,data:u},...zt(t,s)];return{name:"Expand",shaderCache:{hint:`${s.length};${c}${d}`,inputDependencies:["rank"]},getShaderSource:h,getRunData:()=>({outputs:[{dims:s,dataType:e[0].dataType}],dispatchGroup:{x:Math.ceil(u/64)},programUniforms:g})}},QT=e=>{$M(e.inputs),e.compute(LM(e.inputs),{inputs:[0]})}}),FM,qT,pD=mt(()=>{Xt(),sn(),cn(),ly(),FM=e=>{let t=e[0].dataType,n=Ge.size(e[0].dims),s=Ge.size(e[1].dims),i=s%4===0,o=c=>{let d=et("x",t,[1],4),u=et("bias",t,[1],4),h=Pt("y",t,[1],4),g=[{name:"output_vec_size",type:"u32"},{name:"bias_size",type:"u32"}],p=y=>`
      let bias${y}_offset: u32 = (global_idx * 4 + ${y}) % uniforms.bias_size;
      let bias${y} = ${u.getByOffset(`bias${y}_offset / 4`)}[bias${y}_offset % 4];`,m=i?`
      let bias = ${u.getByOffset("global_idx % (uniforms.bias_size / 4)")};`:`${p(0)}${p(1)}${p(2)}${p(3)}
      let bias = ${d.type.value}(bias0, bias1, bias2, bias3);`;return`${c.registerUniforms(g).declareVariables(d,u,h)}

    ${bv(Ga(t))}

    ${c.mainStart(Mf)}
      ${c.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_vec_size")}

      let x = ${d.getByOffset("global_idx")};
      ${m}
      let x_in = x + bias;
      ${h.setByOffset("global_idx",wv("x_in"))}
    }`};return{name:"FastGeluWithBias",shaderCache:{hint:`${i}`,inputDependencies:["type","type"]},getShaderSource:o,getRunData:c=>({outputs:[{dims:c[0].dims,dataType:c[0].dataType}],programUniforms:[{type:12,data:Math.ceil(n/4)},{type:12,data:s}],dispatchGroup:{x:Math.ceil(n/Mf/4)}})}},qT=e=>{e.inputs.length<2||Ge.size(e.inputs[1].dims)===0?pT(e):e.compute(FM(e.inputs))}}),zM,NM,KT,XT,mD=mt(()=>{Xt(),sn(),Hr(),cn(),zM=e=>{if(!e||e.length!==2)throw new Error("Gather requires 2 inputs.")},NM=(e,t)=>{let n=e[0].dims,s=e[1].dims,i=n.length,o=Ge.normalizeAxis(t.axis,i),c=n.slice(0);c.splice(o,1,...s);let d=n[o],u=e[0].dataType===9?4:1,h=Math.ceil(Ge.size(c)/u),g=[{type:12,data:h},{type:6,data:d},{type:12,data:o},...zt(e[0].dims,e[1].dims,c)],p=m=>{let y=et("data",e[0].dataType,e[0].dims.length,u),v=et("inputIndices",e[1].dataType,e[1].dims.length),T=Pt("output",e[0].dataType,c.length,u),O=S=>{let D=s.length,I=`var indicesIndices${S}  = ${v.type.indices}(0);`;for(let M=0;M<D;M++)I+=`${D>1?`indicesIndices${S}[${M}]`:`indicesIndices${S}`} = ${c.length>1?`outputIndices${S}[uniforms.axis + ${M}]`:`outputIndices${S}`};`;I+=`
          var idx${S} = ${v.getByIndices(`indicesIndices${S}`)};
          if (idx${S} < 0) {
            idx${S} = idx${S} + uniforms.axisDimLimit;
          }
          var dataIndices${S} : ${y.type.indices};
        `;for(let M=0,C=0;M<i;M++)M===o?(I+=`${i>1?`dataIndices${S}[${M}]`:`dataIndices${S}`} = u32(idx${S});`,C+=D):(I+=`${i>1?`dataIndices${S}[${M}]`:`dataIndices${S}`} = ${c.length>1?`outputIndices${S}[${C}]`:`outputIndices${S}`};`,C++);return I},E;if(e[0].dataType===9){let S=(D,I,M="")=>`
          let outputIndices${I} = ${T.offsetToIndices(`outputOffset + ${I}u`)};
          ${O(I)};
          let offset${I} = ${y.indicesToOffset(`dataIndices${I}`)};
          let index${I} = offset${I} / 4u;
          let component${I} = offset${I} % 4u;
          ${D}[${I}] = ${M}(${y.getByOffset(`index${I}`)}[component${I}]);
        `;E=`
        let outputOffset = global_idx * ${u};
        var value = vec4<u32>(0);
        ${S("value",0,"u32")}
        ${S("value",1,"u32")}
        ${S("value",2,"u32")}
        ${S("value",3,"u32")}
        ${T.setByOffset("global_idx","value")}
      `}else E=`
      let outputIndices = ${T.offsetToIndices("global_idx")};
      ${O("")};
      let value = ${y.getByIndices("dataIndices")};
      ${T.setByOffset("global_idx","value")};
      `;return`
      ${m.registerUniform("outputSize","u32").registerUniform("axisDimLimit","i32").registerUniform("axis","u32").declareVariables(y,v,T)}
      ${m.mainStart()}
        ${m.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.outputSize")}
        ${E}
      }`};return{name:"Gather",shaderCache:{hint:t.cacheKey,inputDependencies:["rank","rank"]},getRunData:()=>({outputs:[{dims:c,dataType:e[0].dataType}],dispatchGroup:{x:Math.ceil(h/64)},programUniforms:g}),getShaderSource:p}},KT=e=>Nn({axis:e.axis}),XT=(e,t)=>{let n=e.inputs;zM(n),e.compute(NM(e.inputs,t))}}),RM,YT,JT,gD=mt(()=>{Xt(),sn(),cn(),RM=(e,t,n,s,i,o,c,d,u)=>{let h=[{type:12,data:o},{type:12,data:s},{type:12,data:i},{type:12,data:n},{type:12,data:c},{type:12,data:d},{type:12,data:u}],g=[o];h.push(...zt(t.dims,g));let p=m=>{let y=et("indices_data",t.dataType,t.dims.length),v=Pt("input_slice_offsets_data",12,1,1),T=[y,v],O=[{name:"output_size",type:"u32"},{name:"batch_dims",type:"u32"},{name:"input_dims",type:"u32",length:i.length},{name:"sizes_from_slice_dims_data",type:"u32",length:n.length},{name:"num_slices_per_batch",type:"u32"},{name:"input_batch_stride",type:"u32"},{name:"num_slice_dims",type:"u32"}];return`
  ${m.registerUniforms(O).declareVariables(...T)}
  ${m.mainStart()}
    ${m.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
    let batch_idx = global_idx / uniforms.num_slices_per_batch;
    let base_offset = batch_idx * uniforms.input_batch_stride;

    let slice_indices_base_offset = global_idx * uniforms.num_slice_dims;
    var relative_slice_offset = 0;
    for (var dim_idx = 0u; dim_idx < uniforms.num_slice_dims; dim_idx ++) {
      var index = i32(indices_data[dim_idx + slice_indices_base_offset].x);
      let input_dim_idx = uniforms.batch_dims + dim_idx;
      if (index < 0) {
        ${i.length===1?"index += i32(uniforms.input_dims);":"index += i32(uniforms.input_dims[input_dim_idx]);"}
      }
      ${n.length===1?"relative_slice_offset += index * i32(uniforms.sizes_from_slice_dims_data);":"relative_slice_offset += index * i32(uniforms.sizes_from_slice_dims_data[dim_idx]);"}
    }

    input_slice_offsets_data[global_idx] =  base_offset + u32(relative_slice_offset);
  }`};return e.compute({name:"computeSliceOffsets",shaderCache:{hint:`${i.length}_${n.length}`,inputDependencies:["rank"]},getRunData:()=>({outputs:[{dims:g,dataType:e.inputs[1].dataType}],dispatchGroup:{x:Math.ceil(o/64)},programUniforms:h}),getShaderSource:p},{inputs:[t],outputs:[-1]})[0]},YT=(e,t)=>{let n=e.inputs,s=n[0].dims,i=n[0].dataType,o=n[1].dims,c=o[o.length-1],d=Ge.sizeToDimension(o,o.length-1),u=Ge.sizeFromDimension(s,t.batchDims+c),h=Ge.sizeToDimension(s,t.batchDims),g=Ge.sizeFromDimension(s,t.batchDims),p=d/h,m=new Array(c),y=u;for(let I=0;I<c;++I)m[c-1-I]=y,y*=s[t.batchDims+c-1-I];let v=RM(e,n[1],m,t.batchDims,s,d,p,g,c),T=t.batchDims+c;if(T>s.length)throw new Error("last dimension of indices must not be larger than rank of input tensor");let O=o.slice(0,-1).concat(s.slice(T)),E=Ge.size(O),S=[{type:12,data:E},{type:12,data:u},...zt(n[0].dims,v.dims,O)],D=I=>{let M=et("data",n[0].dataType,n[0].dims.length),C=et("slice_offsets",12,v.dims.length),A=Pt("output",n[0].dataType,O.length);return`
          ${I.registerUniform("output_size","u32").registerUniform("slice_size","u32").declareVariables(M,C,A)}
            ${I.mainStart()}
            ${I.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
          let slice_offset = slice_offsets[global_idx / uniforms.slice_size];
          output[global_idx] = data[u32(slice_offset) + global_idx % uniforms.slice_size];
        }`};e.compute({name:"GatherND",shaderCache:{hint:t.cacheKey,inputDependencies:["rank","rank"]},getRunData:()=>({outputs:[{dims:O,dataType:i}],dispatchGroup:{x:Math.ceil(E/64)},programUniforms:S}),getShaderSource:D},{inputs:[n[0],v]})},JT=e=>({batchDims:e.batch_dims,cacheKey:""})}),jM,UM,ZT,eA,_D=mt(()=>{Xt(),sn(),Hr(),cn(),jM=(e,t)=>{if(e.length<3||e.length>4)throw new Error("GatherBlockQuantized requires 3 or 4 inputs.");let n=Ge.normalizeAxis(t.quantizeAxis,e[0].dims.length),s=t.blockSize,i=e[0],o=e[2],c=e.length===4?e[3]:void 0;if(o.dims.length!==i.dims.length||!i.dims.map((d,u)=>u===n?Math.ceil(d/s)===o.dims[u]:d===o.dims[u]).reduce((d,u)=>d&&u,!0))throw new Error("Scales must have the same rank as the input tensor and the dims should match except on gatherAxis.");if(c){if(c.dataType!==i.dataType)throw new Error("Zero point must have the same data type as the input tensor.");if(c.dims.length!==o.dims.length||!c.dims.map((d,u)=>d===o.dims[u]).reduce((d,u)=>d&&u,!0))throw new Error("Zero point must have the same rank as the input tensor and the dims should match except on quantizeAxis.")}},UM=(e,t)=>{let n=e[0].dims,s=e[1].dims,i=n.length,o=Ge.normalizeAxis(t.gatherAxis,i),c=Ge.normalizeAxis(t.quantizeAxis,i),d=n.slice(0);d.splice(o,1,...s);let u=Ge.size(d),h=e[2].dataType,g=e[0].dataType===22,p=[{type:12,data:u},{type:12,data:c},{type:12,data:o},{type:12,data:t.blockSize},...zt(...e.map((y,v)=>y.dims),d)],m=y=>{let v=et("data",e[0].dataType,e[0].dims.length),T=et("inputIndices",e[1].dataType,e[1].dims.length),O=et("scales",e[2].dataType,e[2].dims.length),E=e.length>3?et("zeroPoint",e[3].dataType,e[3].dims.length):void 0,S=Pt("output",h,d.length),D=[v,T,O];E&&D.push(E);let I=[{name:"output_size",type:"u32"},{name:"quantize_axis",type:"u32"},{name:"gather_axis",type:"u32"},{name:"block_size",type:"u32"}];return`
        ${y.registerUniforms(I).declareVariables(...D,S)}
        ${y.mainStart()}
        let output_indices = ${S.offsetToIndices("global_idx")};
        var indices_indices = ${T.type.indices}(0);
        ${s.length>1?`
          for (var i: u32 = 0; i < ${s.length}; i++) {
            let index = ${S.indicesGet("output_indices","uniforms.gather_axis + i")};
            ${T.indicesSet("indices_indices","i","index")};
          }`:`indices_indices = ${S.indicesGet("output_indices","uniforms.gather_axis")};`};
        var data_indices = ${v.type.indices}(0);
        for (var i: u32 = 0; i < uniforms.gather_axis; i++) {
          let index = ${S.indicesGet("output_indices","i")};
          ${v.indicesSet("data_indices","i","index")};
        }
        var index_from_indices = ${T.getByIndices("indices_indices")};
        if (index_from_indices < 0) {
          index_from_indices += ${n[o]};
        }
        ${v.indicesSet("data_indices","uniforms.gather_axis","u32(index_from_indices)")};
        for (var i = uniforms.gather_axis + 1; i < ${d.length}; i++) {
          let index = ${S.indicesGet("output_indices",`i + ${s.length} - 1`)};
          ${v.indicesSet("data_indices","i","index")};
        }
        let data_offset = ${v.indicesToOffset("data_indices")};
        let data_index = data_offset % 8;
        // Convert 4-bit packed data to 8-bit packed data.
        let packed_4bit_quantized_data = ${v.getByOffset("data_offset / 8")};
        let packed_8bit_quantized_data = (packed_4bit_quantized_data >> (4 * (data_index % 2))) & 0x0f0f0f0f;
        let quantized_data_vec = ${g?"unpack4xI8":"unpack4xU8"}(u32(packed_8bit_quantized_data));
        let quantized_data = quantized_data_vec[data_index / 2];
        var scale_indices = data_indices;
        let quantize_axis_index = ${O.indicesGet("data_indices","uniforms.quantize_axis")} / uniforms.block_size;
        ${O.indicesSet("scale_indices","uniforms.quantize_axis","quantize_axis_index")};
        var scale = ${O.getByIndices("scale_indices")};
        ${E?`
              let zero_point_indices = scale_indices;
              let zero_point_offset = ${E.indicesToOffset("zero_point_indices")};
              let zero_point_index = zero_point_offset % 8;
              let packed_4bit_zero_points = ${E.getByOffset("zero_point_offset / 8")};
              let packed_8bit_zero_points = (packed_4bit_zero_points >> (4 * (zero_point_index % 2))) & 0x0f0f0f0f;
              let zero_point_vec = ${g?"unpack4xI8":"unpack4xU8"}(u32(packed_8bit_zero_points));
              let zero_point = zero_point_vec[zero_point_index / 2];`:"var zero_point = 0"};
        let dequantized_data = ${Ga(h)}(quantized_data - zero_point) * scale;
        ${S.setByOffset("global_idx","dequantized_data")};
    }`};return{name:"GatherBlockQuantized",shaderCache:{hint:`${t.cacheKey};${e.filter((y,v)=>v!==1).map(y=>y.dims.join("_")).join(";")}`,inputDependencies:Array.from({length:e.length},(y,v)=>"rank")},getRunData:()=>({outputs:[{dims:d,dataType:h}],dispatchGroup:{x:Math.ceil(u/64)},programUniforms:p}),getShaderSource:m}},ZT=(e,t)=>{let n=e.inputs;jM(n,t),e.compute(UM(e.inputs,t))},eA=e=>Nn({blockSize:e.blockSize,gatherAxis:e.gatherAxis,quantizeAxis:e.quantizeAxis})}),VM,GM,tA,nA,vD=mt(()=>{Xt(),sn(),Hr(),cn(),VM=e=>{if(!e||e.length!==2)throw new Error("GatherElements requires 2 inputs.");if(e[0].dims.length<1)throw new Error("GatherElements requires that the data input be rank >= 1.");if(e[0].dims.length!==e[1].dims.length)throw new Error(`GatherElements requires that the data input and
                     indices input tensors be of same rank.`)},GM=(e,t)=>{let n=e[0].dims,s=e[0].dataType,i=n.length,o=e[1].dims,c=e[1].dataType,d=Ge.normalizeAxis(t.axis,i),u=n[d],h=o.slice(0),g=Ge.size(h),p=et("input",s,i),m=et("indicesInput",c,o.length),y=Pt("output",s,h.length),v=[{type:12,data:g},{type:6,data:u},{type:12,data:d}];return v.push(...zt(n,o,h)),{name:"GatherElements",shaderCache:{inputDependencies:["rank","rank"]},getRunData:()=>({outputs:[{dims:h,dataType:e[0].dataType}],dispatchGroup:{x:Math.ceil(g/64)},programUniforms:v}),getShaderSource:T=>`
      ${T.registerUniform("outputSize","u32").registerUniform("axisDimLimit","i32").registerUniform("axis","u32").declareVariables(p,m,y)}
      ${T.mainStart()}
      ${T.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.outputSize")}

      let outputIndices = ${y.offsetToIndices("global_idx")};

      var idx = ${m.getByOffset("global_idx")};
      if (idx < 0) {
        idx = idx + uniforms.axisDimLimit;
      }
      var inputIndices = ${p.type.indices}(outputIndices);
      ${p.indicesSet("inputIndices","uniforms.axis","u32(idx)")};
      let value = ${p.getByIndices("inputIndices")};

      ${y.setByOffset("global_idx","value")};
  }`}},tA=e=>Nn({axis:e.axis}),nA=(e,t)=>{let n=e.inputs;VM(n),e.compute(GM(e.inputs,t))}}),WM,HM,rA,aA,yD=mt(()=>{Xt(),sn(),cn(),WM=e=>{if(!e)throw new Error("Input is missing");if(e.length<2||e.length>3)throw new Error("Invaid input number.");if(e.length===3&&e[2].dims.length>2)throw new Error("Invalid input shape of C");if(e[0].dataType!==e[1].dataType||e.length===3&&e[0].dataType!==e[2].dataType)throw new Error("Input types are mismatched")},HM=(e,t)=>{let n=e[0].dims.slice(),s=e[1].dims.slice(),[i,o,c]=tE.getShapeOfGemmResult(n,t.transA,s,t.transB,e.length===3?e[2].dims:void 0),d=[i,o];if(!d)throw new Error("Can't use gemm on the given tensors");let u=16,h=Math.ceil(o/u),g=Math.ceil(i/u),p=!0,m=Ge.size(d),y=[{type:12,data:p?h:m},{type:12,data:i},{type:12,data:o},{type:12,data:c},{type:1,data:t.alpha},{type:1,data:t.beta}],v=["type","type"];e.length===3&&(y.push(...zt(e[2].dims)),v.push("rank")),y.push(...zt(d));let T=E=>{let S="";t.transA&&t.transB?S="value += a[k * uniforms.M + m] * b[n * uniforms.K + k];":t.transA&&!t.transB?S="value += a[k * uniforms.M + m] * b[k * uniforms.N + n];":!t.transA&&t.transB?S="value += a[m * uniforms.K + k] * b[n * uniforms.K + k];":!t.transA&&!t.transB&&(S="value += a[m * uniforms.K + k] * b[k * uniforms.N + n];");let D=t.alpha===1?"":"value *= uniforms.alpha;",I=et("a",e[0].dataType,e[0].dims),M=et("b",e[1].dataType,e[1].dims),C=I.type.value,A=null,k=[I,M];e.length===3&&(A=et("c",e[2].dataType,e[2].dims.length),k.push(A));let R=Pt("output",e[0].dataType,d.length);k.push(R);let G=[{name:"output_size",type:"u32"},{name:"M",type:"u32"},{name:"N",type:"u32"},{name:"K",type:"u32"},{name:"alpha",type:"f32"},{name:"beta",type:"f32"}];return`
  ${E.registerUniforms(G).declareVariables(...k)}

  ${E.mainStart()}
    ${E.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}

    let m = global_idx / uniforms.N;
    let n = global_idx % uniforms.N;

    var value = ${C}(0);
    for (var k: u32 = 0u; k < uniforms.K; k++) {
      ${S}
    }

    ${D}
    ${A!=null?`let cOffset = ${A.broadcastedIndicesToOffset("vec2(m, n)",R)}; value += ${C}(uniforms.beta) * ${A.getByOffset("cOffset")};`:""}
    output[global_idx] = value;
  }`},O=E=>{let S=et("a",e[0].dataType,e[0].dims),D=et("b",e[1].dataType,e[1].dims),I=null,M=[S,D];e.length===3&&(I=et("c",e[2].dataType,e[2].dims.length),M.push(I));let C=Pt("output",e[0].dataType,d.length);M.push(C);let A=[{name:"num_tile_n",type:"u32"},{name:"M",type:"u32"},{name:"N",type:"u32"},{name:"K",type:"u32"},{name:"alpha",type:"f32"},{name:"beta",type:"f32"}],k="",R="";t.transA&&t.transB?(R=`
      var col = tile_row_start + local_id.x;
      var row = k_start + local_id.y;
      if (col < uniforms.M && row < uniforms.K) {
        tile_a[local_id.y][local_id.x] = a[row * uniforms.M + col];
      } else {
        tile_a[local_id.y][local_id.x] = ${S.type.value}(0);
      }

      col = k_start + local_id.x;
      row = tile_col_start + local_id.y;
      if (col < uniforms.K && row < uniforms.N) {
        tile_b[local_id.y][local_id.x] = b[row * uniforms.K + col];
      } else {
        tile_b[local_id.y][local_id.x] = ${D.type.value}(0);
      }
      `,k="value += tile_a[k][local_id.y] * tile_b[local_id.x][k];"):t.transA&&!t.transB?(R=`
      var col = tile_row_start + local_id.x;
      var row = k_start + local_id.y;
      if (col < uniforms.M && row < uniforms.K) {
        tile_a[local_id.y][local_id.x] = a[row * uniforms.M + col];
      } else {
        tile_a[local_id.y][local_id.x] = ${S.type.value}(0);
      }

      col = tile_col_start + local_id.x;
      row = k_start + local_id.y;
      if (col < uniforms.N && row < uniforms.K) {
        tile_b[local_id.y][local_id.x] = b[row * uniforms.N + col];
      } else {
        tile_b[local_id.y][local_id.x] = ${D.type.value}(0);
      }
      `,k="value += tile_a[k][local_id.y] * tile_b[k][local_id.x];"):!t.transA&&t.transB?(R=`
      var col = k_start + local_id.x;
      var row = tile_row_start + local_id.y;
      if (col < uniforms.K && row < uniforms.M) {
        tile_a[local_id.y][local_id.x] = a[row * uniforms.K + col];
      } else {
        tile_a[local_id.y][local_id.x] = ${S.type.value}(0);
      }

      col = k_start + local_id.x;
      row = tile_col_start + local_id.y;
      if (col < uniforms.K && row < uniforms.N) {
        tile_b[local_id.y][local_id.x] = b[row * uniforms.K + col];
      } else {
        tile_b[local_id.y][local_id.x] = ${D.type.value}(0);
      }
      `,k="value += tile_a[local_id.y][k] * tile_b[local_id.x][k];"):!t.transA&&!t.transB&&(R=`
      var col = k_start + local_id.x;
      var row = tile_row_start + local_id.y;
      if (col < uniforms.K && row < uniforms.M) {
        tile_a[local_id.y][local_id.x] = a[row * uniforms.K + col];
      } else {
        tile_a[local_id.y][local_id.x] = ${S.type.value}(0);
      }

      col = tile_col_start + local_id.x;
      row = k_start + local_id.y;
      if (col < uniforms.N && row < uniforms.K) {
        tile_b[local_id.y][local_id.x] = b[row * uniforms.N + col];
      } else {
        tile_b[local_id.y][local_id.x] = ${D.type.value}(0);
      }
      `,k="value += tile_a[local_id.y][k] * tile_b[k][local_id.x];");let G=t.alpha===1?"":"value *= uniforms.alpha;";return`
  ${E.registerUniforms(A).declareVariables(...M)}
  var<workgroup> tile_a: array<array<${S.type.storage}, ${u}>, ${u}>;
  var<workgroup> tile_b: array<array<${D.type.storage}, ${u}>, ${u}>;
  ${E.mainStart([u,u,1])}
    let tile_col_start = (workgroup_index % uniforms.num_tile_n) * ${u};
    let tile_row_start = (workgroup_index / uniforms.num_tile_n) * ${u};
    let num_tiles = (uniforms.K - 1) / ${u} + 1;
    var k_start = 0u;
    var value = ${C.type.value}(0);
    for (var t: u32 = 0u; t < num_tiles; t++) {
      ${R}
      k_start = k_start + ${u};
      workgroupBarrier();

      for (var k: u32 = 0u; k < ${u}; k++) {
        ${k}
      }
      workgroupBarrier();
    }

    ${G}
    let m = tile_row_start + local_id.y;
    let n = tile_col_start + local_id.x;
    ${I!=null?`let cOffset = ${I.broadcastedIndicesToOffset("vec2(m, n)",C)}; value += ${C.type.value}(uniforms.beta) * ${I.getByOffset("cOffset")};`:""}
    if (m < uniforms.M && n < uniforms.N) {
      output[m * uniforms.N + n] = value;
    }
  }`};return p?{name:"GemmShared",shaderCache:{hint:`${t.cacheKey}`,inputDependencies:v},getRunData:()=>({outputs:[{dims:d,dataType:e[0].dataType}],dispatchGroup:{x:h*g},programUniforms:y}),getShaderSource:O}:{name:"Gemm",shaderCache:{hint:`${t.cacheKey}`,inputDependencies:v},getRunData:()=>({outputs:[{dims:d,dataType:e[0].dataType}],dispatchGroup:{x:Math.ceil(m/64)},programUniforms:y}),getShaderSource:T}},rA=e=>{let t=e.transA,n=e.transB,s=e.alpha,i=e.beta;return{transA:t,transB:n,alpha:s,beta:i,cacheKey:`${e.transA};${e.transB};${e.alpha===1}`}},aA=(e,t)=>{WM(e.inputs),e.compute(HM(e.inputs,t))}}),ao,Xo,du,fu,QM,qM,KM,XM,YM,JM,ZM,ex,sA,iA,bD=mt(()=>{Xt(),sn(),Hr(),cn(),[ao,Xo,du,fu]=[0,1,2,3],QM=e=>{if(e[0].dims.length!==4)throw new Error("only 4-D tensor is supported.");if(e[0].dims.length!==e[1].dims.length)throw new Error("input dimensions must be equal to grid dimensions");if(e[0].dims.length-2!==e[1].dims[e[1].dims.length-1])throw new Error(`last dimension of grid must be equal to ${e[0].dims.length-2}`);if(e[0].dims[0]!==e[1].dims[0])throw new Error("grid batch size must match input batch size")},qM=`
  fn gs_get_cubic_coeffs(x: f32) -> vec4<f32> {
    let cubic_alpha = -0.75f;
    let x_abs = abs(x);
    var coeffs: vec4<f32>;
    coeffs[0] = (((cubic_alpha * (x_abs + 1) - 5 * cubic_alpha) * (x_abs + 1) + 8 * cubic_alpha) * (x_abs + 1) - 4 * cubic_alpha);
    coeffs[1] = (((cubic_alpha + 2) * x_abs - (cubic_alpha + 3)) * x_abs * x_abs + 1);
    coeffs[2] = (((cubic_alpha + 2) * (1 - x_abs) - (cubic_alpha + 3)) * (1 - x_abs) * (1 - x_abs) + 1);
    coeffs[3] = (((cubic_alpha * (2 - x_abs) - 5 * cubic_alpha) * (2 - x_abs) + 8 * cubic_alpha) * (2 - x_abs) - 4 * cubic_alpha);
    return coeffs;
  }
`,KM=e=>`
  fn gs_bicubic_interpolate(p: mat4x4<${e}>, x: f32, y: f32) -> ${e} {
    var v: vec4<f32>;
    var coeffs = gs_get_cubic_coeffs(x);
    for (var i = 0; i < 4; i++) {
      v[i] = coeffs[0] * p[i][0] + coeffs[1] * p[i][1] + coeffs[2] * p[i][2] + coeffs[3] * p[i][3];
    }
    coeffs = gs_get_cubic_coeffs(y);
    let pixel = ${e}(coeffs[0] * v[0] + coeffs[1] * v[1] + coeffs[2] * v[2] + coeffs[3] * v[3]);
    return pixel;
  }
`,XM=e=>`
  fn gs_denormalize(n: f32, length: i32) -> f32 {
    ${e.alignCorners===0?`
    // alignCorners: false => [-1, 1] to [-0.5, length - 0.5]
    return ((n + 1.0) * f32(length) - 1.0) / 2.0;
    `:`
    // alignCorners: true => [-1, 1] to [0, length - 1]
    return (n + 1.0) / 2.0 * (f32(length - 1));
    `}
  }
`,YM=e=>`
  ${e.paddingMode==="reflection"?`
      fn gs_reflect(x: i32, x_min: f32, x_max: f32) -> u32 {
        var dx = 0.0;
        var fx = f32(x);
        let range = x_max - x_min;
        if (fx < x_min) {
          dx = x_min - fx;
          let n = u32(dx / range);
          let r = dx - f32(n) * range;
          if (n % 2 == 0) {
            fx = x_min + r;
          } else {
            fx = x_max - r;
          }
        } else if (fx > x_max) {
          dx = fx - x_max;
          let n = u32(dx / range);
          let r = dx - f32(n) * range;
          if (n % 2 == 0) {
            fx = x_max - r;
          } else {
            fx = x_min + r;
          }
        }
        return u32(fx);
      }`:""}
`,JM=(e,t,n)=>`
  fn pixel_at_grid(r: i32, c: i32, H: i32, W: i32, batch: u32, channel: u32, border: vec4<f32>) -> ${t} {
     var pixel = ${t}(0);
     var indices = vec4<u32>(0);
     indices[${ao}] = batch;
     indices[${Xo}] = channel;`+(()=>{switch(n.paddingMode){case"zeros":return`
          if (r >= 0 && r < H && c >=0 && c < W) {
            indices[${du}] = u32(r);
            indices[${fu}] = u32(c);
          } else {
            return ${t}(0);
          }
        `;case"border":return`
          indices[${du}] = u32(clamp(r, 0, H - 1));
          indices[${fu}] = u32(clamp(c, 0, W - 1));
        `;case"reflection":return`
          indices[${du}] = gs_reflect(r, border[1], border[3]);
          indices[${fu}] = gs_reflect(c, border[0], border[2]);
        `;default:throw new Error(`padding mode ${n.paddingMode} is not supported`)}})()+`
    return ${e.getByIndices("indices")};
  }
`,ZM=(e,t,n)=>(()=>{switch(n.mode){case"nearest":return`
          let result = pixel_at_grid(i32(round(y)), i32(round(x)), H_in, W_in, indices[${ao}], indices[${Xo}], border);
        `;case"bilinear":return`
          let x1 = i32(floor(x));
          let y1 = i32(floor(y));
          let x2 = x1 + 1;
          let y2 = y1 + 1;

          let p11 = pixel_at_grid(y1, x1, H_in, W_in, indices[${ao}], indices[${Xo}], border);
          let p12 = pixel_at_grid(y1, x2, H_in, W_in, indices[${ao}], indices[${Xo}], border);
          let p21 = pixel_at_grid(y2, x1, H_in, W_in, indices[${ao}], indices[${Xo}], border);
          let p22 = pixel_at_grid(y2, x2, H_in, W_in, indices[${ao}], indices[${Xo}], border);

          let dx2 = ${t}(f32(x2) - x);
          let dx1 = ${t}(x - f32(x1));
          let dy2 = ${t}(f32(y2) - y);
          let dy1 = ${t}(y - f32(y1));
          let result = dy2 * (dx2 * p11 + dx1 * p12) + dy1 * (dx2 * p21 + dx1 * p22);
        `;case"bicubic":return`
          let x0 = i32(floor(x)) - 1;
          let y0 = i32(floor(y)) - 1;
          var p: mat4x4<${t}>;
          for (var h = 0; h < 4; h++) {
            for (var w = 0; w < 4; w++) {
              p[h][w] = pixel_at_grid(h + y0, w + x0, H_in, W_in, indices[${ao}], indices[${Xo}], border);
            }
          }

          let dx = x - f32(x0 + 1);
          let dy = y - f32(y0 + 1);
          let result = gs_bicubic_interpolate(p, dx, dy);
        `;default:throw new Error(`mode ${n.mode} is not supported`)}})()+`${e.setByOffset("global_idx","result")}`,ex=(e,t)=>{let n=et("x",e[0].dataType,e[0].dims.length),s=[e[1].dims[0],e[1].dims[1],e[1].dims[2]],i=et("grid",e[1].dataType,s.length,2),o=[e[0].dims[0],e[0].dims[1],e[1].dims[1],e[1].dims[2]];t.format==="NHWC"&&(o=[e[0].dims[0],e[1].dims[1],e[1].dims[2],e[0].dims[3]],[ao,Xo,du,fu]=[0,3,1,2]);let c=Pt("output",e[0].dataType,o.length),d=n.type.value,u=Ge.size(o),h=[{type:12,data:u},...zt(e[0].dims,s,o)],g=p=>`
  ${p.registerUniform("output_size","u32").declareVariables(n,i,c)}
  ${qM}
  ${KM(d)}
  ${XM(t)}
  ${YM(t)}
  ${JM(n,d,t)}

  ${p.mainStart()}
    ${p.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
      let H_in = i32(uniforms.x_shape[${du}]);
      let W_in = i32(uniforms.x_shape[${fu}]);

      ${t.alignCorners===0?`
      let x_min = -0.5;
      let x_max = f32(W_in) - 0.5;
      let y_min = -0.5;
      let y_max = f32(H_in) - 0.5;
      `:`
      let x_min = 0.0;
      let x_max = f32(W_in) - 1.0;
      let y_min = 0.0;
      let y_max = f32(H_in) - 1.0;
      `};
      let border = vec4<f32>(x_min, y_min, x_max, y_max);

      let indices = ${c.offsetToIndices("global_idx")};
      var grid_indices = vec3<u32>(indices[${ao}], indices[${du}], indices[${fu}]);
      let nxy = ${i.getByIndices("grid_indices")};
      var x = gs_denormalize(f32(nxy[0]), W_in);
      var y = gs_denormalize(f32(nxy[1]), H_in);

      ${ZM(c,d,t)}
  }`;return{name:"GridSample",shaderCache:{hint:`${t.cacheKey}`,inputDependencies:["type","type"]},getRunData:p=>{let m=Ge.size(o);return{outputs:[{dims:o,dataType:p[0].dataType}],dispatchGroup:{x:Math.ceil(m/64)},programUniforms:h}},getShaderSource:g}},sA=(e,t)=>{QM(e.inputs),e.compute(ex(e.inputs,t))},iA=e=>Nn({alignCorners:e.align_corners,mode:e.mode,paddingMode:e.padding_mode,format:e.format})}),ts,tx,oA,T0,nx,om,lA,cA=mt(()=>{Xt(),sn(),Hr(),ay(),oy(),cn(),lc(),ts=(e,t)=>e.length>t&&e[t].dims.length>0?e[t]:void 0,tx=(e,t)=>{let n=e[0],s=ts(e,1),i=ts(e,2),o=ts(e,3),c=ts(e,4),d=ts(e,5),u=ts(e,6),h=ts(e,7);if(n.dims.length!==3&&n.dims.length!==5)throw new Error("Input query is expected to have 3 or 5 dimensions");let g=n.dims[0],p=n.dims[1],m=n.dims.length===3?n.dims[2]:t.numHeads*n.dims[4],y=p,v=0,T=0,O=Math.floor(m/t.numHeads);if(u&&h&&Ge.size(u.dims)&&Ge.size(h.dims)){if(u.dims.length!==4)throw new Error('Input "past_key" is expected to have 4 dimensions');if(u.dims[0]!==g||u.dims[1]!==t.numHeads||u.dims[3]!==O)throw new Error('Input "past_key" shape (batch_size, num_heads, past_sequence_length, head_size)');if(h.dims[0]!==g||h.dims[1]!==t.numHeads||h.dims[3]!==O)throw new Error('Input "past_value" shape (batch_size, num_heads, past_sequence_length, head_size)');if(u.dims[2]!==h.dims[2])throw new Error('Input "past_key" and "past_value" shall have same dim 2 (past_sequence_length)');if(h.dims.length!==4)throw new Error('Input "past_value" is expected to have 4 dimensions');v=u.dims[2],T=u.dims[2]}else if(u&&Ge.size(u.dims)||h&&Ge.size(h.dims))throw new Error('Input "past_key" and "past_value" shall be both present or both absent');let E;if(s&&Ge.size(s.dims)>0){if(n.dims.length!==3)throw new Error('Input "query" is expected to have 3 dimensions when key is given');if(s.dims.length<3||s.dims.length>5)throw new Error('Input "key" is expected to have 3, 4, or 5 dimensions');if(n.dims[0]!==s.dims[0])throw new Error('Input "query" and "key" shall have same dim 0 (batch size)');if(s.dims.length===3){if(s.dims[2]!==n.dims[2])throw new Error('Input "query" and "key" shall have same dim 2 (hidden_size)');E=2,y=s.dims[1]}else if(s.dims.length===5){if(s.dims[2]!==t.numHeads||s.dims[3]!==2||s.dims[4]!==O)throw new Error('Expect "key" shape (batch_size, kv_sequence_length, num_heads, 2, head_size) for packed kv');if(i)throw new Error('Expect "value" be none when "key" has packed kv format.');E=5,y=s.dims[1]}else{if(s.dims[1]!==t.numHeads||s.dims[3]!==O)throw new Error('Expect "key" shape (batch_size, num_heads, kv_sequence_length, head_size) for past_key');E=0,y=s.dims[2]}}else{if(n.dims.length!==5)throw new Error('Input "query" is expected to have 5 dimensions when key is empty');if(n.dims[2]!==t.numHeads||n.dims[3]!==3)throw new Error('Expect "query" shape (batch_size, kv_sequence_length, num_heads, 3, head_size) for packed kv');E=3}if(o&&Ge.size(o.dims)>0){if(o.dims.length!==1)throw new Error('Input "bias" is expected to have 1 dimension');if(s&&s.dims.length===5&&s.dims[3]===2)throw new Error("bias is not allowed for packed kv.")}let S=v+y,D=0;if(c&&Ge.size(c.dims)>0){D=8;let A=c.dims;throw A.length===1?A[0]===g?D=1:A[0]===3*g+2&&(D=3):A.length===2&&A[0]===g&&A[1]===S&&(D=5),D===8?new Error('Input "key_padding_mask" shape shall be (batch_size) or (batch_size, total_sequence_length)'):new Error("Mask not supported")}let I=!1,M=m;if(i&&Ge.size(i.dims)>0){if(i.dims.length!==3&&i.dims.length!==4)throw new Error('Input "value" is expected to have 3 or 4 dimensions');if(n.dims[0]!==i.dims[0])throw new Error('Input "query" and "value" shall have same dim 0 (batch_size)');if(i.dims.length===3){if(y!==i.dims[1])throw new Error('Input "key" and "value" shall have the same dim 1 (kv_sequence_length)');M=i.dims[2]}else{if(y!==i.dims[2])throw new Error('Input "key" and "value" shall have the same dim 2 (kv_sequence_length)');M=i.dims[1]*i.dims[3],I=!0}}let C=!1;if(c&&Ge.size(c.dims)>0)throw new Error("Key padding mask is not supported");if(d&&Ge.size(d.dims)>0){if(d.dims.length!==4)throw new Error('Input "attention_bias" is expected to have 4 dimensions');if(d.dims[0]!==g||d.dims[1]!==t.numHeads||d.dims[2]!==p||d.dims[3]!==S)throw new Error('Expect "attention_bias" shape (batch_size, num_heads, sequence_length, total_sequence_length)')}return{batchSize:g,sequenceLength:p,pastSequenceLength:v,kvSequenceLength:y,totalSequenceLength:S,maxSequenceLength:T,inputHiddenSize:0,hiddenSize:m,vHiddenSize:M,headSize:O,vHeadSize:Math.floor(M/t.numHeads),numHeads:t.numHeads,isUnidirectional:!1,pastPresentShareBuffer:!1,maskFilterValue:t.maskFilterValue,maskType:D,scale:t.scale,broadcastResPosBias:C,passPastInKv:I,qkvFormat:E}},oA=e=>Nn({...e}),T0=Nn({perm:[0,2,1,3]}),nx=(e,t,n,s,i,o,c)=>{let d=[s,i,o],u=Ge.size(d),h=[{type:12,data:u},{type:12,data:c},{type:12,data:o}],g=p=>{let m=Pt("qkv_with_bias",t.dataType,d),y=et("qkv",t.dataType,d),v=et("bias",n.dataType,d),T=[{name:"output_size",type:"u32"},{name:"bias_offset",type:"u32"},{name:"hidden_size",type:"u32"}];return`
  ${p.registerUniforms(T).declareVariables(y,v,m)}
  ${p.mainStart()}
    ${p.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
    let bias_offset_idx = (global_idx % uniforms.hidden_size) + uniforms.bias_offset;

    qkv_with_bias[global_idx] = qkv[global_idx] + bias[bias_offset_idx];
  }`};return e.compute({name:"MultiHeadAttentionAddBias",shaderCache:{inputDependencies:["type","type"]},getRunData:()=>({outputs:[{dims:d,dataType:t.dataType,gpuDataType:0}],dispatchGroup:{x:Math.ceil(u/64)},programUniforms:h}),getShaderSource:g},{inputs:[t,n],outputs:[-1]})[0]},om=(e,t,n,s,i,o,c,d)=>{let u=o;if(c&&Ge.size(c.dims)>0){if(s===1)throw new Error("AddBiasReshape is not implemented. Please export your model with packed QKV or KV");return u=nx(e,o,c,t,s,n*i,d),u=u.reshape([t,s,n,i]),n===1||s===1?u:e.compute($s(u,T0.perm),{inputs:[u],outputs:[-1]})[0]}else return o.dims.length===3&&(u=o.reshape([t,s,n,i])),n===1||s===1?u:e.compute($s(u,T0.perm),{inputs:[u],outputs:[-1]})[0]},lA=(e,t)=>{let n=tx(e.inputs,t),s=e.inputs[0],i=ts(e.inputs,1),o=ts(e.inputs,2),c=ts(e.inputs,3),d=ts(e.inputs,4),u=ts(e.inputs,5),h=ts(e.inputs,6),g=ts(e.inputs,7);if(s.dims.length===5)throw new Error("Packed QKV is not implemented");if((i==null?void 0:i.dims.length)===5)throw new Error("Packed KV is not implemented");let p=i&&o&&i.dims.length===4&&o.dims.length===4,m=om(e,n.batchSize,n.numHeads,n.sequenceLength,n.headSize,s,c,0);if(p)return mm(e,m,i,o,d,void 0,h,g,u,n);if(!i||!o)throw new Error("key and value must be provided");let y=om(e,n.batchSize,n.numHeads,n.kvSequenceLength,n.headSize,i,c,n.hiddenSize),v=om(e,n.batchSize,n.numHeads,n.kvSequenceLength,n.vHeadSize,o,c,2*n.hiddenSize);mm(e,m,y,v,d,void 0,h,g,u,n)}}),rx,ax,sx,ix,Av,uA,dA,fA=mt(()=>{Xt(),sn(),Hr(),cn(),rx=e=>{if(!e||e.length<1)throw new Error("too few inputs")},ax=(e,t)=>{let n=[],s=t.numOutputs;return e[1].dims[0]>0&&(e[1].getBigInt64Array().forEach(i=>n.push(Number(i))),s=n.length),Nn({numOutputs:s,axis:t.axis,splitSizes:n})},sx=e=>`
fn calculateOutputIndex(index: u32) -> u32 {
    for (var i: u32 = 0u; i < ${e}u; i += 1u ) {
    if (index < ${$t("uniforms.size_in_split_axis","i",e)}) {
        return i;
    }
    }
    return ${e}u;
}`,ix=e=>{let t=e.length,n=[];for(let s=0;s<t;++s){let i=e[s].setByIndices("indices","input[global_idx]");t===1?n.push(i):s===0?n.push(`if (output_number == ${s}u) { ${i} }`):s===t-1?n.push(`else { ${i} }`):n.push(`else if (output_number == ${s}) { ${i} }`)}return`
      fn writeBufferData(output_number: u32, indices: ${e[0].type.indices}, global_idx: u32) {
        ${n.join(`
`)}
      }`},Av=(e,t)=>{let n=e[0].dims,s=Ge.size(n),i=e[0].dataType,o=Ge.normalizeAxis(t.axis,n.length),c=new Array(t.numOutputs),d=et("input",i,n.length),u=new Array(t.numOutputs),h=[],g=[],p=0,m=[{type:12,data:s}];for(let v=0;v<t.numOutputs;v++){p+=t.splitSizes[v],u[v]=p;let T=n.slice();T[o]=t.splitSizes[v],g.push(T),c[v]=Pt(`output${v}`,i,T.length),h.push({dims:g[v],dataType:e[0].dataType})}m.push({type:12,data:u},...zt(n,...g));let y=v=>`
  ${v.registerUniform("input_size","u32").registerUniform("size_in_split_axis","u32",u.length).declareVariables(d,...c)}
  ${sx(u.length)}
  ${ix(c)}

  ${v.mainStart()}
    ${v.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.input_size")}

    var indices = ${d.offsetToIndices("global_idx")};
    var index = ${d.indicesGet("indices",o)};
    let output_number = calculateOutputIndex(index);
    if (output_number != 0) {
      index -= ${$t("uniforms.size_in_split_axis","output_number - 1u",u.length)};
      ${d.indicesSet("indices",o,"index")};
    }
    writeBufferData(output_number, indices, global_idx);
  }`;return{name:"Split",shaderCache:{hint:t.cacheKey,inputDependencies:["rank"]},getShaderSource:y,getRunData:()=>({outputs:h,dispatchGroup:{x:Math.ceil(s/64)},programUniforms:m})}},uA=(e,t)=>{rx(e.inputs);let n=e.inputs.length===1?t:ax(e.inputs,t);e.compute(Av(e.inputs,n),{inputs:[0]})},dA=e=>{let t=e.axis,n=e.splitSizes,s=e.numOutputs<0?n.length:e.numOutputs;if(s!==n.length)throw new Error("numOutputs and splitSizes lengh must be equal");return Nn({axis:t,numOutputs:s,splitSizes:n})}}),ox,a_,hA,pA=mt(()=>{Xt(),sn(),Hr(),cn(),ox=(e,t)=>{let[n,s,i,o]=e,{numHeads:c,rotaryEmbeddingDim:d}=t;if(n.dims.length!==3&&n.dims.length!==4)throw new Error(`Input 'x' is expected to have 3 or 4 dimensions, got ${n.dims.length}`);if(!Ge.areEqual(s.dims,[])&&!Ge.areEqual(s.dims,[1])&&s.dims.length!==2)throw new Error(`Input 'position_ids' is expected to have 0, 1, or 2 dimensions, got ${s.dims.length}`);if(i.dims.length!==2)throw new Error(`Input 'cos_cache' is expected to have 2 dimensions, got ${i.dims.length}`);if(o.dims.length!==2)throw new Error(`Input 'sin_cache' is expected to have 2 dimensions, got ${o.dims.length}`);if(!Ge.areEqual(i.dims,o.dims))throw new Error("Inputs 'cos_cache' and 'sin_cache' are expected to have the same shape");if(d>0&&c===0)throw new Error("num_heads must be provided if rotary_embedding_dim is specified");let u=n.dims[0],h=n.dims[n.dims.length-2],g=i.dims[0],p=Ge.sizeFromDimension(n.dims,1)/h,m=d===0?i.dims[1]*2:p/c;if(d>m)throw new Error("rotary_embedding_dim must be less than or equal to head_size");if(s.dims.length===2){if(u!==s.dims[0])throw new Error(`Input 'position_ids' dimension 0 should be of size batch_size, got ${s.dims[0]}`);if(h!==s.dims[1])throw new Error(`Input 'position_ids' dimension 1 should be of size sequence_length, got ${s.dims[1]}`)}if(m/2!==i.dims[1]&&d/2!==i.dims[1])throw new Error(`Input 'cos_cache' dimension 1 should be same as head_size / 2 or rotary_embedding_dim / 2, got ${i.dims[1]}`);if(h>g)throw new Error("Updating cos_cache and sin_cache in RotaryEmbedding is not currently supported")},a_=(e,t)=>{let{interleaved:n,numHeads:s,rotaryEmbeddingDim:i,scale:o}=t,c=e[0].dims[0],d=Ge.sizeFromDimension(e[0].dims,1),u=e[0].dims[e[0].dims.length-2],h=d/u,g=e[2].dims[1],p=i===0?g*2:h/s,m=new Array(c,u,h/p,p-g),y=Ge.computeStrides(m),v=[{type:1,data:o},{type:12,data:m},{type:12,data:y},...e[0].dims.length===3?new Array({type:12,data:[d,h,p,1]}):[],...e[0].dims.length===4?new Array({type:12,data:[d,p,u*p,1]}):[],...zt(e[0].dims,e[1].dims,e[2].dims,e[3].dims,e[0].dims)],T=O=>{let E=et("input",e[0].dataType,e[0].dims.length),S=et("position_ids",e[1].dataType,e[1].dims.length),D=et("cos_cache",e[2].dataType,e[2].dims.length),I=et("sin_cache",e[3].dataType,e[3].dims.length),M=Pt("output",e[0].dataType,e[0].dims.length);return O.registerUniforms([{name:"scale",type:"f32"},{name:"global_shape",type:"u32",length:m.length},{name:"global_strides",type:"u32",length:y.length},{name:"input_output_strides",type:"u32",length:y.length}]),`
        ${O.declareVariables(E,S,D,I,M)}

        ${O.mainStart(Mf)}
          let half_rotary_emb_dim = uniforms.${D.name}_shape[1];
          let bsnh = global_idx / uniforms.global_strides % uniforms.global_shape;
          let size = uniforms.global_shape[0] * uniforms.global_strides[0];
          ${O.guardAgainstOutOfBoundsWorkgroupSizes("size")}

          if (bsnh[3] < half_rotary_emb_dim) {
            let position_ids_idx =
                ${S.broadcastedIndicesToOffset("bsnh.xy",Pt("",S.type.tensor,2))};
            let position_id =
                u32(${S.getByOffset("position_ids_idx")}) + select(0, bsnh[1], position_ids_idx == 0);
            let i = dot(bsnh, uniforms.input_output_strides) + select(0, bsnh[3], ${n});
            let j = i + select(half_rotary_emb_dim, 1, ${n});
            let re = ${E.getByOffset("i")} * ${D.get("position_id","bsnh[3]")} -
                ${E.getByOffset("j")} * ${I.get("position_id","bsnh[3]")};
            ${M.setByOffset("i","re")}
            let im = ${E.getByOffset("i")} * ${I.get("position_id","bsnh[3]")} +
                ${E.getByOffset("j")} * ${D.get("position_id","bsnh[3]")};
            ${M.setByOffset("j","im")}
          } else {
            let k = dot(bsnh, uniforms.input_output_strides) + half_rotary_emb_dim;
            ${M.setByOffset("k",E.getByOffset("k"))}
          }
        }`};return{name:"RotaryEmbedding",shaderCache:{hint:Nn({interleaved:n}).cacheKey,inputDependencies:["rank","rank","rank","rank"]},getShaderSource:T,getRunData:()=>({outputs:[{dims:e[0].dims,dataType:e[0].dataType}],dispatchGroup:{x:Math.ceil(Ge.size(m)/Mf)},programUniforms:v})}},hA=(e,t)=>{ox(e.inputs,t),e.compute(a_(e.inputs,t))}}),lx,cx,A0,ux,mA,wD=mt(()=>{Hr(),Xt(),oy(),cA(),fA(),lc(),pA(),cn(),lx=(e,t)=>{if(t.doRotary&&e.length<=7)throw new Error("cos_cache and sin_cache inputs are required if do_rotary is specified");let n=e[0],s=e[1],i=e[2],o=e[3],c=e[4];if(t.doRotary!==0&&e.length<=7)throw new Error("cos_cast and sin_cache are expected if do_rotary attribute is non-zero");if(t.localWindowSize!==-1)throw new Error("Local attention is not supported");if(t.softcap!==0)throw new Error("Softcap is not supported");if(t.rotaryInterleaved!==0)throw new Error("Rotary interleaved is not supported");if(t.smoothSoftmax)throw new Error("Smooth softmax is not supported");if(n.dims.length!==3&&n.dims.length!==5)throw new Error("Input query is expected to have 3 or 5 dimensions");let d=!1,u=n.dims[0],h=n.dims[1],g=n.dims.length===3?d?n.dims[2]/3:n.dims[2]:t.numHeads*n.dims[4],p=h,m=0,y=!s||s.dims.length===0,v=Math.floor(y?g/(t.numHeads+2*t.kvNumHeads):g/t.numHeads);y&&(g=v*t.numHeads);let T=o&&o.dims.length!==0,O=c&&c.dims.length!==0;if(T&&o.dims.length===4&&o.dims[0]===u&&o.dims[1]!==t.kvNumHeads&&o.dims[2]===t.kvNumHeads&&o.dims[3]===v)throw new Error("BSNH pastKey/pastValue is not supported");if(T&&O){if(o.dims.length!==4)throw new Error('Input "past_key" is expected to have 4 dimensions');if(c.dims.length!==4)throw new Error('Input "past_value" is expected to have 4 dimensions');m=o.dims[2]}else if(T||O)throw new Error('Input "past_key" and "past_value" shall be both present or both absent');let E=1;if(s&&s.dims.length>0){if(n.dims.length!==3)throw new Error('Input "query" is expected to have 3 dimensions when key is given');if(s.dims.length<3||s.dims.length>5)throw new Error('Input "key" is expected to have 3, 4, or 5 dimensions');if(n.dims[0]!==s.dims[0])throw new Error('Input "query" and "key" shall have same dim 0 (batch size)');if(s.dims.length===3){if(n.dims[2]%s.dims[2]!==0)throw new Error('Dimension 2 of "query" should be a multiple of "key"');p=s.dims[1]}else if(s.dims.length===5){if(s.dims[2]!==t.numHeads||s.dims[3]!==2||s.dims[4]!==v)throw new Error('Expect "key" shape (batch_size, kv_sequence_length, num_heads, 2, head_size) for packed kv');if(i)throw new Error('Expect "value" be none when "key" has packed kv format.');p=s.dims[1]}else{if(s.dims[1]!==t.numHeads||s.dims[3]!==v)throw new Error('Expect "key" shape (batch_size, num_heads, kv_sequence_length, head_size) for past_key');p=s.dims[2]}}else{if(n.dims.length!==3&&n.dims.length!==5)throw new Error('Input "query" is expected to have 3 or 5 dimensions when key is empty');if(n.dims.length===5&&(n.dims[2]!==t.numHeads||n.dims[3]!==3))throw new Error('Expect "query" shape (batch_size, kv_sequence_length, num_heads, 3, head_size) for packed kv');E=3}let S=0,D=!1,I=t.kvNumHeads?v*t.kvNumHeads:g;if(i&&i.dims.length>0){if(i.dims.length!==3&&i.dims.length!==4)throw new Error('Input "value" is expected to have 3 or 4 dimensions');if(n.dims[0]!==i.dims[0])throw new Error('Input "query" and "value" shall have same dim 0 (batch_size)');if(i.dims.length===3){if(p!==i.dims[1])throw new Error('Input "key" and "value" shall have the same dim 1 (kv_sequence_length)');I=i.dims[2]}else{if(p!==i.dims[2])throw new Error('Input "past_key" and "past_value" shall have the same dim 2 (kv_sequence_length)');I=i.dims[1]*i.dims[3],D=!0}}let M=e.length>4?e[5]:void 0;if(M&&M.dims.length!==1&&M.dims[0]!==u)throw new Error('Input "seqlens" is expected to have 1 dimension and the same dim 0 as batch_size');return{batchSize:u,sequenceLength:h,pastSequenceLength:m,kvSequenceLength:p,totalSequenceLength:-1,maxSequenceLength:-1,inputHiddenSize:0,hiddenSize:g,vHiddenSize:I,headSize:v,vHeadSize:Math.floor(I/t.kvNumHeads),numHeads:t.numHeads,kvNumHeads:t.kvNumHeads,nReps:t.numHeads/t.kvNumHeads,pastPresentShareBuffer:!1,maskType:S,scale:t.scale,broadcastResPosBias:!1,passPastInKv:D,qkvFormat:E}},cx=Nn({perm:[0,2,1,3]}),A0=(e,t,n)=>{let s=t,i=n.kvNumHeads;return t.dims.length===3&&n.kvSequenceLength!==0&&(s=t.reshape([n.batchSize,n.kvSequenceLength,i,n.headSize]),s=e.compute($s(s,cx.perm),{inputs:[s],outputs:[-1]})[0]),s},ux=(e,t,n,s)=>{let i=7,o=["type","type"],c=[e*t],d=e*t,u=[{type:12,data:d},{type:12,data:t},{type:12,data:e}],h=g=>{let p=et("seq_lens",n.dataType,n.dims),m=et("total_seq_lens",s.dataType,s.dims),y=Pt("pos_ids",i,c),v=[{name:"output_size",type:"u32"},{name:"sequence_length",type:"u32"},{name:"batch_size",type:"u32"}];return`
  ${g.registerUniforms(v).declareVariables(p,m,y)}
  ${g.mainStart()}
    ${g.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
    let total_sequence_length = u32(${m.getByOffset("0")});
    let is_subsequent_prompt = uniforms.sequence_length > 1 && uniforms.sequence_length != total_sequence_length;
    let is_first_prompt = !is_subsequent_prompt && uniforms.sequence_length == total_sequence_length;
    let batch_idx = global_idx / uniforms.sequence_length;
    let sequence_idx = i32(global_idx % uniforms.sequence_length);
    var pos_id: i32 = 0;
    let seqlen = ${p.getByOffset("batch_idx")};
    let total_seqlen = seqlen + 1;
    if (is_first_prompt) {
      if (sequence_idx < total_seqlen) {
        pos_id = sequence_idx;
      } else {
        pos_id = 1;
      }
      ${y.setByOffset("global_idx","pos_id")}
    } else if (is_subsequent_prompt) {
      let past_seqlen = total_seqlen - i32(uniforms.sequence_length);
      if (past_seqlen + sequence_idx < total_seqlen) {
        pos_id = past_seqlen + sequence_idx;
      } else {
        pos_id = 1;
      }
      ${y.setByOffset("global_idx","pos_id")}
    } else if (global_idx < uniforms.batch_size) {
      ${y.setByOffset("global_idx","seqlen")}
    };
  }
  `};return{name:"GeneratePositionIds",shaderCache:{hint:`${e};${t}`,inputDependencies:o},getRunData:()=>({outputs:[{dims:c,dataType:i}],dispatchGroup:{x:Math.ceil(d/64)},programUniforms:u}),getShaderSource:h}},mA=(e,t)=>{var I;let n=lx(e.inputs,t);if(e.inputs[0].dims.length===5)throw new Error("Packed QKV is not implemented");if(((I=e.inputs[1])==null?void 0:I.dims.length)===5)throw new Error("Packed KV is not implemented");let s=e.inputs[0],i=e.inputs[1]&&e.inputs[1].dims.length>0?e.inputs[1]:void 0,o=e.inputs[2]&&e.inputs[2].dims.length>0?e.inputs[2]:void 0,c=e.inputs[3]&&e.inputs[3].dims.length!==0?e.inputs[3]:void 0,d=e.inputs[4]&&e.inputs[4].dims.length!==0?e.inputs[4]:void 0,u=e.inputs.length>4?e.inputs[5]:void 0,h=e.inputs.length>5?e.inputs[6]:void 0,g=n.kvNumHeads?n.kvNumHeads:n.numHeads,p=Nn({axis:2,numOutputs:3,splitSizes:[n.numHeads*n.headSize,g*n.headSize,g*n.headSize]}),[m,y,v]=!i&&!o?e.compute(Av([s],p),{inputs:[s],outputs:[-1,-1,-1]}):[s,i,o],T,O;if(t.doRotary){let M=e.compute(ux(n.batchSize,n.sequenceLength,u,h),{inputs:[u,h],outputs:[-1]})[0],C=e.inputs[7],A=e.inputs[8],k=Nn({interleaved:t.rotaryInterleaved!==0,numHeads:n.numHeads,rotaryEmbeddingDim:0,scale:t.scale}),R=[m,M,C,A],G=[-1];T=e.compute(a_(R,k),{inputs:R,outputs:G})[0],R.splice(0,1,y);let te=Nn({interleaved:t.rotaryInterleaved!==0,numHeads:n.kvNumHeads,rotaryEmbeddingDim:0,scale:t.scale});O=e.compute(a_(R,te),{inputs:R,outputs:G})[0]}let E=om(e,n.batchSize,n.numHeads,n.sequenceLength,n.headSize,t.doRotary?T:m,void 0,0),S=A0(e,t.doRotary?O:y,n),D=A0(e,v,n);mm(e,E,S,D,void 0,void 0,c,d,void 0,n,u,h)}}),C0,dx,fx,gA,MD=mt(()=>{Xt(),sn(),lc(),cn(),C0=(e,t,n,s,i,o,c,d)=>{let u=Lr(o),h=u===1?"f32":`vec${u}f`,g=u===1?"vec2f":`mat2x${u}f`,p=i*c,m=64;p===1&&(m=256);let y=[i,c,o/u],v=[i,c,2],T=["rank","type","type"],O=[];O.push(...zt(y,v));let E=S=>{let D=et("x",t.dataType,3,u),I=et("scale",n.dataType,n.dims),M=et("bias",s.dataType,s.dims),C=Pt("output",1,3,2),A=[D,I,M,C];return`
  var<workgroup> workgroup_shared : array<${g}, ${m}>;
  const workgroup_size = ${m}u;
  ${S.declareVariables(...A)}
  ${S.mainStart(m)}
    let batch = workgroup_index / uniforms.x_shape[1];
    let channel = workgroup_index % uniforms.x_shape[1];
    let hight = uniforms.x_shape[2];
    // initialize workgroup memory
    var sum = ${h}(0);
    var squared_sum = ${h}(0);
    for (var h = local_idx; h < hight; h += workgroup_size) {
      let value = ${h}(${D.get("batch","channel","h")});
      sum += value;
      squared_sum += value * value;
    }
    workgroup_shared[local_idx] = ${g}(sum, squared_sum);
    workgroupBarrier();

    for (var currSize = workgroup_size >> 1;  currSize > 0; currSize = currSize >> 1) {
      if (local_idx < currSize) {
        workgroup_shared[local_idx] = workgroup_shared[local_idx] + workgroup_shared[local_idx + currSize];
      }
      workgroupBarrier();
    }
    if (local_idx == 0) {
      let sum_final = ${oc("workgroup_shared[0][0]",u)} / f32(hight * ${u});
      let squared_sum_final = ${oc("workgroup_shared[0][1]",u)} / f32(hight * ${u});

      let inv_std_dev = inverseSqrt(squared_sum_final - sum_final * sum_final + f32(${d}));
      let channel_scale = inv_std_dev * f32(scale[channel]);
      let channel_shift = f32(bias[channel]) - sum_final * channel_scale;
      output[workgroup_index] = vec2f(channel_scale, channel_shift);
    }
  }`};return e.compute({name:"InstanceNormComputeChannelScaleShift",shaderCache:{hint:`${u};${d};${m}`,inputDependencies:T},getRunData:()=>({outputs:[{dims:v,dataType:1}],dispatchGroup:{x:p},programUniforms:O}),getShaderSource:E},{inputs:[t,n,s],outputs:[-1]})[0]},dx=(e,t,n)=>{let s=t[0].dims,i=s,o=2,c=s[0],d=s[1],u=Ge.sizeFromDimension(s,o),h=Lr(u),g=Ge.size(i)/h,p=C0(e,t[0],t[1],t[2],c,u,d,n.epsilon),m=[c,d,u/h],y=[c,d],v=["type","none"],T=O=>{let E=et("x",t[0].dataType,m.length,h),S=et("scale_shift",1,y.length,2),D=Pt("output",t[0].dataType,m.length,h),I=[E,S,D];return`
  ${O.registerUniform("output_size","u32").declareVariables(...I)}
  ${O.mainStart()}
  ${O.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
      let outputIndices = ${D.offsetToIndices("global_idx")};
      let batch = outputIndices[0];
      let channel = outputIndices[1];
      let scale_shift = ${S.getByIndices("vec2<u32>(batch, channel)")};
      let value = ${E.getByOffset("global_idx")} * ${D.type.value}(scale_shift.x) + ${D.type.value}(scale_shift.y);
      ${D.setByOffset("global_idx","value")};
  }`};e.compute({name:"InstanceNormalization",shaderCache:{hint:`${h}`,inputDependencies:v},getRunData:()=>({outputs:[{dims:i,dataType:t[0].dataType}],dispatchGroup:{x:Math.ceil(g/64)},programUniforms:[{type:12,data:g},...zt(m,y,m)]}),getShaderSource:T},{inputs:[t[0],p]})},fx=(e,t,n)=>{let s=t[0].dims,i=s,o=s[0],c=s[s.length-1],d=Ge.sizeFromDimension(s,1)/c,u=Lr(c),h=Ge.size(i)/u,g=[{type:12,data:d},{type:12,data:Math.floor(c/u)}],p=["type","type"],m=!1,y=[0,s.length-1];for(let E=0;E<s.length-2;E++)m=m||s[E+1]!==1,y.push(E+1);m=m&&s[s.length-1]!==1;let v=m?e.compute($s(e.inputs[0],y),{inputs:[e.inputs[0]],outputs:[-1]})[0]:e.inputs[0].reshape(Array.from({length:s.length},(E,S)=>s[y[S]])),T=C0(e,v,t[1],t[2],o,d,c,n.epsilon),O=E=>{let S=ga(t[0].dataType),D=u===1?"vec2f":`mat${u}x2f`,I=A=>{let k=A===0?"x":"y",R=u===1?"f32":`vec${u}f`;switch(u){case 1:return`${S}(${R}(scale.${k}))`;case 2:return`vec2<${S}>(${R}(scale[0].${k}, scale[1].${k}))`;case 4:return`vec4<${S}>(${R}(scale[0].${k}, scale[1].${k}, scale[2].${k}, scale[3].${k}))`;default:throw new Error(`Not supported compoents ${u}`)}},M=et("input",t[0].dataType,t[0].dims,u),C=Pt("output",t[0].dataType,i,u);return`
  @group(0) @binding(0) var<storage, read> input : array<${M.type.storage}>;
  @group(0) @binding(1) var<storage, read> scale_input : array<${D}>;
  @group(0) @binding(2) var<storage, read_write> output : array<${C.type.storage}>;
  struct Uniforms {H: u32, C : u32};
  @group(0) @binding(3) var<uniform> uniforms: Uniforms;

  ${E.mainStart()}
    let current_image_number = global_idx / (uniforms.C * uniforms.H);
    let current_channel_number = global_idx % uniforms.C;

    let scale_offset = current_image_number * uniforms.C + current_channel_number;
    let scale = scale_input[scale_offset];
    output[global_idx] = fma(input[global_idx], ${I(0)}, ${I(1)});
  }`};e.compute({name:"InstanceNormalizationNHWC",shaderCache:{hint:`${u}`,inputDependencies:p},getRunData:()=>({outputs:[{dims:i,dataType:t[0].dataType}],dispatchGroup:{x:Math.ceil(h/64)},programUniforms:g}),getShaderSource:O},{inputs:[t[0],T]})},gA=(e,t)=>{t.format==="NHWC"?fx(e,e.inputs,t):dx(e,e.inputs,t)}}),hx,px,_A,xD=mt(()=>{Xt(),sn(),cn(),hx=e=>{if(!e||e.length<2)throw new Error("layerNorm requires at least 2 inputs.")},px=(e,t,n)=>{let s=t.simplified,i=e[0].dims,o=e[1],c=!s&&e[2],d=i,u=Ge.normalizeAxis(t.axis,i.length),h=Ge.sizeToDimension(i,u),g=Ge.sizeFromDimension(i,u),p=Ge.size(o.dims),m=c?Ge.size(c.dims):0;if(p!==g||c&&m!==g)throw new Error(`Size of X.shape()[axis:] == ${g}.
       Size of scale and bias (if provided) must match this.
       Got scale size of ${p} and bias size of ${m}`);let y=[];for(let M=0;M<i.length;++M)M<u?y.push(i[M]):y.push(1);let v=Lr(g),T=["type","type"],O=[{type:12,data:h},{type:1,data:g},{type:12,data:Math.floor(g/v)},{type:1,data:t.epsilon}];c&&T.push("type");let E=n>1,S=n>2,D=M=>{let C=ga(e[0].dataType),A=[et("x",e[0].dataType,e[0].dims,v),et("scale",o.dataType,o.dims,v)];c&&A.push(et("bias",c.dataType,c.dims,v)),A.push(Pt("output",e[0].dataType,d,v)),E&&A.push(Pt("mean_data_output",1,y)),S&&A.push(Pt("inv_std_output",1,y));let k=[{name:"norm_count",type:"u32"},{name:"norm_size",type:"f32"},{name:"norm_size_vectorized",type:"u32"},{name:"epsilon",type:"f32"}];return`
  ${M.registerUniforms(k).declareVariables(...A)}
  ${M.mainStart()}
    ${M.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.norm_count")}
    let offset = global_idx * uniforms.norm_size_vectorized;
    var mean_vector = ${_v("f32",v)};
    var mean_square_vector = ${_v("f32",v)};

    for (var h: u32 = 0u; h < uniforms.norm_size_vectorized; h++) {
      let value = ${gf(C,v,"x[h + offset]")};
      mean_vector += value;
      mean_square_vector += value * value;
    }
    let mean = ${oc("mean_vector",v)} / uniforms.norm_size;
    let inv_std_dev = inverseSqrt(${oc("mean_square_vector",v)} / uniforms.norm_size ${s?"":"- mean * mean"} + uniforms.epsilon);

    for (var j: u32 = 0; j < uniforms.norm_size_vectorized; j++) {
      let f32input = ${gf(C,v,"x[j + offset]")};
      let f32scale = ${gf(C,v,"scale[j]")};
      output[j + offset] = ${A[0].type.value}((f32input ${s?"":"- mean"}) * inv_std_dev * f32scale
        ${c?`+ ${gf(C,v,"bias[j]")}`:""}
      );
    }

    ${E?"mean_data_output[global_idx] = mean":""};
    ${S?"inv_std_output[global_idx] = inv_std_dev":""};
  }`},I=[{dims:d,dataType:e[0].dataType}];return E&&I.push({dims:y,dataType:1}),S&&I.push({dims:y,dataType:1}),{name:"LayerNormalization",shaderCache:{hint:`${v};${n};${s}`,inputDependencies:T},getRunData:()=>({outputs:I,dispatchGroup:{x:Math.ceil(h/64)},programUniforms:O}),getShaderSource:D}},_A=(e,t)=>{hx(e.inputs),e.compute(px(e.inputs,t,e.outputCount))}}),mx,vA,ED=mt(()=>{sn(),fy(),hy(),mx=e=>{if(!e||e.length!==2)throw new Error("MatMul requires 2 inputs.");if(e[0].dims[e[0].dims.length-1]!==e[1].dims[e[1].dims.length-2])throw new Error("shared dimension does not match.")},vA=e=>{mx(e.inputs);let t=wf.calcShape(e.inputs[0].dims,e.inputs[1].dims,!0);if(!t)throw new Error("Can't use matmul on the given tensors");let n=t[t.length-1],s=e.inputs[0].dims[e.inputs[0].dims.length-1];if(n<8&&s<8)e.compute(dy(e.inputs,{activation:""},t));else{let i=t[t.length-2],o=Ge.size(e.inputs[0].dims.slice(0,-2)),c=Ge.size(e.inputs[1].dims.slice(0,-2));if(o!==1&&i===1&&c===1){let d=e.inputs[0].reshape([1,o,s]),u=e.inputs[1].reshape([1,s,n]),h=[1,o,n],g=[d,u];e.compute(r_(g,{activation:""},t,h),{inputs:g})}else e.compute(r_(e.inputs,{activation:""},t))}}}),gx,_x,vx,yA,bA,TD=mt(()=>{Xt(),sn(),Hr(),cn(),gx=(e,t)=>{if(e.length<3||e.length>4)throw new Error("MatMulNBits requires 3 or 4 inputs");let n=e[0],s=n.dims.length;if(n.dims[s-1]!==t.k)throw new Error("The last dim of input shape does not match the k value");let i=Math.floor((t.k+t.blockSize-1)/t.blockSize),o=t.blockSize/8*t.bits,c=e[1];if(!Ge.areEqual(c.dims,[t.n,i,o]))throw new Error("The second inputs must be 3D tensor with shape N X nBlocksPerCol X blobSize");let d=e[2].dims;if(Ge.size(d)!==t.n*i)throw new Error("scales input size error.");if(e.length===4){let u=e[3].dims,h=t.bits>4?t.n*i:t.n*Math.floor((i+1)/2);if(Ge.size(u)!==h)throw new Error("zeroPoints input size error.")}},_x=(e,t)=>{let n=e[0].dims,s=n.length,i=n[s-2],o=t.k,c=t.n,d=n.slice(0,s-2),u=Ge.size(d),h=e[1].dims[2]/4,g=e[0].dataType,p=Lr(t.k),m=Lr(h),y=Lr(c),v=d.concat([i,c]),T=i>1&&c/y%2===0?2:1,O=Ge.size(v)/y/T,E=64,S=[],D=[u,i,o/p],I=Ge.convertShape(e[1].dims).slice();I.splice(-1,1,h/m),S.push(...zt(D)),S.push(...zt(I)),S.push(...zt(e[2].dims)),e.length===4&&S.push(...zt(Ge.convertShape(e[3].dims)));let M=[u,i,c/y];S.push(...zt(M));let C=A=>{let k=D.length,R=et("a",e[0].dataType,k,p),G=et("b",12,I.length,m),te=et("scales",e[2].dataType,e[2].dims.length),ee=[R,G,te],X=e.length===4?et("zero_points",12,e[3].dims.length):void 0;X&&ee.push(X);let le=M.length,ae=Pt("output",e[0].dataType,le,y),Q=ga(e[0].dataType),ne=(()=>{switch(p){case 1:return`array<${Q}, 8>`;case 2:return`mat4x2<${Q}>`;case 4:return`mat2x4<${Q}>`;default:throw new Error(`${p}-component is not supported.`)}})(),de=()=>{let j=`
          // reuse a data
            var input_offset = ${R.indicesToOffset(`${R.type.indices}(batch, row, word_offset)`)};
            var a_data: ${ne};
            for (var j: u32 = 0; j < ${8/p}; j++) {
              a_data[j] = ${R.getByOffset("input_offset")};
              input_offset++;
            }
          `;for(let U=0;U<y*T;U++)j+=`
            b_value = ${m===1?`b${U}_data`:`b${U}_data[i]`};
            b_value_lower = unpack4xU8(b_value & b_mask);
            b_value_upper = unpack4xU8((b_value >> 4) & b_mask);
            b_quantized_values = ${ne}(${Array.from({length:4},(N,q)=>`${Q}(b_value_lower[${q}]), ${Q}(b_value_upper[${q}])`).join(", ")});
            b_dequantized_values = ${p===1?`${ne}(${Array.from({length:8},(N,q)=>`(b_quantized_values[${q}] - ${X?`zero_point${U}`:"zero_point"}) * scale${U}`).join(", ")});`:`(b_quantized_values - ${ne}(${Array(8).fill(`${X?`zero_point${U}`:"zero_point"}`).join(",")})) * scale${U};`};
            workgroup_shared[local_id.x * ${T} + ${Math.floor(U/y)}]${y>1?`[${U%y}]`:""} += ${Array.from({length:8/p},(N,q)=>`${p===1?`a_data[${q}] * b_dequantized_values[${q}]`:`dot(a_data[${q}], b_dequantized_values[${q}])`}`).join(" + ")};
          `;return j},ve=()=>{let j=`
            var col_index = col * ${y};
            ${X?`
            let zero_point_bytes_per_col = (nBlocksPerCol + 1) / 2;
            var zero_point_byte_count: u32;
            var zero_point_word_index: u32;
            var zero_point_byte_offset: u32;
            let zero_point_nibble_offset: u32 = block & 0x1u;
            var zero_point_bits_offset: u32;
            var zero_point_word: u32;`:`
            // The default zero point is 8 for unsigned 4-bit quantization.
            let zero_point = ${Q}(8);`}
            `;for(let U=0;U<y*T;U++)j+=`
            let scale${U} = ${te.getByOffset("col_index * nBlocksPerCol + block")};
            ${X?`
            zero_point_byte_count = col_index * zero_point_bytes_per_col + (block >> 0x1u);
            zero_point_word_index = zero_point_byte_count >> 0x2u;
            zero_point_byte_offset = zero_point_byte_count & 0x3u;
            zero_point_bits_offset = (zero_point_byte_offset << 3) + (zero_point_nibble_offset << 2);
            zero_point_word = ${X.getByOffset("zero_point_word_index")} >> zero_point_bits_offset;
            let zero_point${U} = ${Q}((zero_point_word) & 0xFu);`:""}
            col_index += 1;`;return j},fe=()=>{let j=`col_index = col * ${y};`;for(let U=0;U<y*T;U++)j+=`
            let b${U}_data = ${G.getByIndices(`${G.type.indices}(col_index, block, word)`)};
            col_index += 1;`;return j+=`
            var b_value: u32;
            let b_mask: u32 = 0x0F0F0F0Fu;
            var b_value_lower: vec4<u32>;
            var b_value_upper: vec4<u32>;
            var b_quantized_values: ${ne};
            var b_dequantized_values: ${ne};`,j};return`
        var<workgroup> workgroup_shared: array<${ae.type.value}, ${T*E}>;
        ${A.declareVariables(...ee,ae)}
        ${A.mainStart([E,1,1])}
          let output_indices = ${ae.offsetToIndices(`(global_idx / ${E}) * ${T}`)};
          let col = output_indices[2];
          let row = output_indices[1];
          let batch = output_indices[0];
          let nBlocksPerCol = uniforms.b_shape[1];

          for (var block = local_id.x; block < nBlocksPerCol; block += ${E}) {
            //process one block
            var word_offset: u32 = block * ${t.blockSize/p};
            ${ve()}
            for (var word: u32 = 0; word < ${h}; word += ${m}) {
              ${fe()}
              for (var i: u32 = 0; i < ${m}; i++) {
                ${de()}
                word_offset += ${8/p};
              }
            }
          }
          workgroupBarrier();

          if (local_id.x < ${T}) {
            var output_value: ${ae.type.value} = ${ae.type.value}(0);
            var workgroup_shared_offset: u32 = local_id.x;
            for (var b: u32 = 0u; b < ${E}u; b++) {
              output_value += workgroup_shared[workgroup_shared_offset];
              workgroup_shared_offset += ${T};
            }
            ${ae.setByIndices(`${ae.type.indices}(batch, row, col + local_id.x)`,"output_value")};
          }
        }`};return{name:"MatMulNBits",shaderCache:{hint:`${t.blockSize};${t.bits};${p};${m};${y};${T};${E}`,inputDependencies:Array(e.length).fill("rank")},getRunData:()=>({outputs:[{dims:v,dataType:g}],dispatchGroup:{x:O},programUniforms:S}),getShaderSource:C}},vx=(e,t)=>{let n=e[0].dims,s=n.length,i=n[s-2],o=t.k,c=t.n,d=n.slice(0,s-2),u=Ge.size(d),h=e[1].dims[2]/4,g=e[0].dataType,p=Lr(t.k),m=Lr(h),y=d.concat([i,c]),v=128,T=c%8===0?8:c%4===0?4:1,O=v/T,E=O*m*8,S=E/p,D=E/t.blockSize,I=Ge.size(y)/T,M=[],C=[u,i,o/p],A=Ge.convertShape(e[1].dims).slice();A.splice(-1,1,h/m),M.push(...zt(C)),M.push(...zt(A)),M.push(...zt(e[2].dims)),e.length===4&&M.push(...zt(Ge.convertShape(e[3].dims)));let k=[u,i,c];M.push(...zt(k));let R=G=>{let te=C.length,ee=et("a",e[0].dataType,te,p),X=et("b",12,A.length,m),le=et("scales",e[2].dataType,e[2].dims.length),ae=[ee,X,le],Q=e.length===4?et("zero_points",12,e[3].dims.length):void 0;Q&&ae.push(Q);let ne=k.length,de=Pt("output",e[0].dataType,ne),ve=ga(e[0].dataType),fe=()=>{switch(p){case 1:return`
          let a_data0 = vec4<${ve}>(sub_a[word_offset], sub_a[word_offset + 1], sub_a[word_offset + 2], sub_a[word_offset + 3]);
          let a_data1 = vec4<${ve}>(sub_a[word_offset + 4], sub_a[word_offset + 5], sub_a[word_offset + 6], sub_a[word_offset + 7]);`;case 2:return`
          let a_data0 = vec4<${ve}>(sub_a[word_offset], sub_a[word_offset + 1]);
          let a_data1 = vec4<${ve}>(sub_a[word_offset + 2], sub_a[word_offset + 3]);`;case 4:return`
          let a_data0 = sub_a[word_offset];
          let a_data1 = sub_a[word_offset + 1];`;default:throw new Error(`${p}-component is not supported.`)}};return`
        var<workgroup> sub_a: array<${ee.type.value}, ${S}>;
        var<workgroup> inter_results: array<array<${de.type.value}, ${O}>, ${T}>;
        ${G.declareVariables(...ae,de)}
        ${G.mainStart([O,T,1])}
          let output_indices = ${de.offsetToIndices(`workgroup_index * ${T}`)};
          let col = output_indices[2];
          let row = output_indices[1];
          let batch = output_indices[0];
          let n_blocks_per_col = uniforms.b_shape[1];
          let num_tiles =  (n_blocks_per_col - 1) / ${D} + 1;

          // Loop over shared dimension.
          for (var tile: u32 = 0; tile < num_tiles; tile += 1) {
            let a_col_start = tile * ${S};
            // load one tile A data into shared memory.
            for (var a_offset = local_idx; a_offset < ${S}; a_offset += ${v})
            {
              let a_col = a_col_start + a_offset;
              if (a_col < uniforms.a_shape[2])
              {
                sub_a[a_offset] = ${ee.getByIndices(`${ee.type.indices}(batch, row, a_col)`)};
              } else {
                sub_a[a_offset] = ${ee.type.value}(0);
              }
            }
            workgroupBarrier();

            // each thread process one block
            let b_row = col + local_id.y;
            let block = tile * ${D} + local_id.x;
            ${Q?`
            let zero_point_bytes_per_col = (n_blocks_per_col + 1) / 2;
            let zero_point_byte_count = b_row * zero_point_bytes_per_col + (block >> 0x1u);
            let zero_point_word_index = zero_point_byte_count >> 0x2u;
            let zero_point_byte_offset = zero_point_byte_count & 0x3u;
            let zero_point_nibble_offset: u32 = block & 0x1u;
            let zero_point_bits_offset = (zero_point_byte_offset << 3) + (zero_point_nibble_offset << 2);
            let zero_point_word = ${Q.getByOffset("zero_point_word_index")} >> zero_point_bits_offset;
            let zero_point = ${ve}((zero_point_word) & 0xFu);`:`
            // The default zero point is 8 for unsigned 4-bit quantization.
            let zero_point = ${ve}(8);`}
            let scale = ${le.getByOffset("b_row * n_blocks_per_col + block")};
            let b_data = ${X.getByIndices(`${X.type.indices}(b_row, block, 0)`)};
            var word_offset = local_id.x * ${t.blockSize/p};
            for (var i: u32 = 0; i < ${m}; i++) {
              ${fe()}
              let b_value = ${m===1?"b_data":"b_data[i]"};
              let b_value_lower = unpack4xU8(b_value & 0x0F0F0F0Fu);
              let b_value_upper = unpack4xU8((b_value >> 4) & 0x0F0F0F0Fu);
              let b_quantized_values = mat2x4<${ve}>(${Array.from({length:4},(j,U)=>`${ve}(b_value_lower[${U}]), ${ve}(b_value_upper[${U}])`).join(", ")});
              let b_dequantized_values = (b_quantized_values - mat2x4<${ve}>(${Array(8).fill("zero_point").join(",")})) * scale;
              inter_results[local_id.y][local_id.x] += ${Array.from({length:2},(j,U)=>`${`dot(a_data${U}, b_dequantized_values[${U}])`}`).join(" + ")};
              word_offset += ${8/p};
            }
            workgroupBarrier();
          }

          if (local_idx < ${T}) {
            var output_value: ${de.type.value} = ${de.type.value}(0);
            for (var b = 0u; b < ${O}; b++) {
              output_value += inter_results[local_idx][b];
            }
            if (col + local_idx < uniforms.output_shape[2])
            {
              ${de.setByIndices(`${de.type.indices}(batch, row, col + local_idx)`,"output_value")}
            }
          }
        }`};return{name:"BlockwiseMatMulNBits32",shaderCache:{hint:`${t.blockSize};${p};${m};${O};${T}`,inputDependencies:Array(e.length).fill("rank")},getRunData:()=>({outputs:[{dims:y,dataType:g}],dispatchGroup:{x:I},programUniforms:M}),getShaderSource:R}},yA=(e,t)=>{gx(e.inputs,t),t.blockSize===32&&e.adapterInfo.isVendor("intel")&&e.adapterInfo.isArchitecture("gen-12lp")?e.compute(vx(e.inputs,t)):e.compute(_x(e.inputs,t))},bA=e=>Nn(e)}),yx,bx,wx,Mx,xx,Ex,Tx,Ax,wA,AD=mt(()=>{Xt(),sn(),cn(),yx=e=>{if(!e||e.length<1)throw new Error("Too few inputs");if(e[0].dataType!==1&&e[0].dataType!==10)throw new Error("Input type must be float or float16.");if(e.length>=2){let t=e[0].dims.length*2===e[1].dims[0];if(e.length===4&&(t=e[3].dims[0]*2===e[1].dims[0]),!t)throw new Error("The pads should be a 1D tensor of shape [2 * input_rank] or [2 * num_axes].")}},bx=(e,t,n)=>{let s="";for(let i=t-1;i>=0;--i)s+=`
            k = i32(${e.indicesGet("indices",i)}) - ${$t("uniforms.pads",i,n)};
            if (k < 0) {
              break;
            }
            if (k >= i32(${$t("uniforms.x_shape",i,t)})) {
              break;
            }
            offset += k * i32(${$t("uniforms.x_strides",i,t)});
        `;return`
          value = ${e.type.value}(uniforms.constant_value);
          for (var i = 0; i < 1; i++) {
            var offset = 0;
            var k = 0;
            ${s}
            value = x[offset];
          }
      `},wx=(e,t,n)=>{let s="";for(let i=t-1;i>=0;--i)s+=`
                k = i32(${e.indicesGet("indices",i)}) - ${$t("uniforms.pads",i,n)};
                if (k < 0) {
                  k = -k;
                }
                {
                  let _2n_1 = 2 * (i32(${$t("uniforms.x_shape",i,t)}) - 1);
                  k = k % _2n_1;
                  if(k >= i32(${$t("uniforms.x_shape",i,t)})) {
                    k = _2n_1 - k;
                  }
                }
                offset += k * i32(${$t("uniforms.x_strides",i,t)});
            `;return`
              var offset = 0;
              var k = 0;
              ${s}
              value = x[offset];
          `},Mx=(e,t,n)=>{let s="";for(let i=t-1;i>=0;--i)s+=`
                k = i32(${e.indicesGet("indices",i)}) - ${$t("uniforms.pads",i,n)};
                if (k < 0) {
                  k = 0;
                }
                if (k >= i32(${$t("uniforms.x_shape",i,t)})) {
                  k = i32(${$t("uniforms.x_shape",i,t)}) - 1;
                }
                offset += k * i32(${$t("uniforms.x_strides",i,t)});
            `;return`
              var offset = 0;
              var k = 0;
              ${s}
              value = x[offset];
          `},xx=(e,t,n)=>{let s="";for(let i=t-1;i>=0;--i)s+=`
                k = i32(${e.indicesGet("indices",i)}) - ${$t("uniforms.pads",i,n)};
                if (k < 0)  {
                  k += i32(${$t("uniforms.x_shape",i,t)}]);
                }
                if (k >= i32(${$t("uniforms.x_shape",i,t)})) {
                  k -= i32(${$t("uniforms.x_shape",i,t)});
                }
                offset += k * i32(${$t("uniforms.x_strides",i,t)});
            `;return`
              var offset = 0;
              var k = 0;
              ${s}
              value = x[offset];
          `},Ex=(e,t,n)=>{switch(n.mode){case 0:return bx(e,t,n.pads.length);case 1:return wx(e,t,n.pads.length);case 2:return Mx(e,t,n.pads.length);case 3:return xx(e,t,n.pads.length);default:throw new Error("Invalid mode")}},Tx=(e,t)=>{let n=Ge.padShape(e[0].dims.slice(),t.pads),s=e[0].dims,i=Ge.size(n),o=[{type:12,data:i},{type:6,data:t.pads}],c=e.length>=3&&e[2].data;t.mode===0&&o.push({type:c?e[2].dataType:1,data:t.value}),o.push(...zt(e[0].dims,n));let d=["rank"],u=h=>{let g=Pt("output",e[0].dataType,n.length),p=et("x",e[0].dataType,s.length),m=p.type.value,y=Ex(g,s.length,t),v=[{name:"output_size",type:"u32"},{name:"pads",type:"i32",length:t.pads.length}];return t.mode===0&&v.push({name:"constant_value",type:c?m:"f32"}),`
            ${h.registerUniforms(v).declareVariables(p,g)}
            ${h.mainStart()}
            ${h.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}

            let indices = ${g.offsetToIndices("global_idx")};

            var value = ${m}(0);
            ${y}
            output[global_idx] = value;
        }`};return{name:"Pad",shaderCache:{hint:`${t.mode}${c}`,inputDependencies:d},getRunData:()=>({outputs:[{dims:n,dataType:e[0].dataType}],dispatchGroup:{x:Math.ceil(Ge.size(n)/64)},programUniforms:o}),getShaderSource:u}},Ax=(e,t)=>{if(e.length>1){let n=e[1].getBigInt64Array(),s=e.length>=3&&e[2].data?e[2].dataType===10?e[2].getUint16Array()[0]:e[2].getFloat32Array()[0]:0,i=e[0].dims.length,o=new Int32Array(2*i).fill(0);if(e.length>=4){let d=e[3].getBigInt64Array();for(let u=0;u<d.length;u++)o[Number(d[u])]=Number(n[u]),o[Number(d[u])+i]=Number(n[u+d.length])}else n.forEach((d,u)=>o[Number(u)]=Number(d));let c=[];return o.forEach(d=>c.push(d)),{mode:t.mode,value:s,pads:c}}else return t},wA=(e,t)=>{yx(e.inputs);let n=Ax(e.inputs,t);e.compute(Tx(e.inputs,n),{inputs:[0]})}}),Jp,S0,I0,P0,k0,Cx,Sx,D0,O0,MA,xA,$0,EA,TA,B0,AA,CA,SA,IA,CD=mt(()=>{Ii(),Xt(),sn(),cn(),Jp=e=>{if(br.webgpu.validateInputContent&&(!e||e.length!==1))throw new Error("Pool ops requires 1 input.")},S0=(e,t,n)=>{let s=t.format==="NHWC",i=e.dims.slice();s&&i.splice(1,0,i.pop());let o=Object.hasOwnProperty.call(t,"dilations"),c=t.kernelShape.slice(),d=t.strides.slice(),u=o?t.dilations.slice():[],h=t.pads.slice();t_.adjustPoolAttributes(n,i,c,d,u,h);let g=t_.computePoolOutputShape(n,i,d,u,c,h,t.autoPad),p=Object.assign({},t);o?Object.assign(p,{kernelShape:c,strides:d,pads:h,dilations:u,cacheKey:t.cacheKey}):Object.assign(p,{kernelShape:c,strides:d,pads:h,cacheKey:t.cacheKey});let m=g.slice();return m.push(m.splice(1,1)[0]),[p,s?m:g]},I0=(e,t)=>{let n=t.format==="NHWC",s=Ge.size(e),i=Ge.size(t.kernelShape),o=[{type:12,data:s},{type:12,data:i}],c=[{name:"outputSize",type:"u32"},{name:"kernelSize",type:"u32"}];if(t.kernelShape.length<=2){let d=t.kernelShape[t.kernelShape.length-1],u=t.strides[t.strides.length-1],h=t.pads[t.pads.length/2-1],g=t.pads[t.pads.length-1],p=!!(h+g);o.push({type:12,data:d},{type:12,data:u},{type:12,data:h},{type:12,data:g}),c.push({name:"kw",type:"u32"},{name:"sw",type:"u32"},{name:"pwStart",type:"u32"},{name:"pwEnd",type:"u32"});let m=!1;if(t.kernelShape.length===2){let y=t.kernelShape[t.kernelShape.length-2],v=t.strides[t.strides.length-2],T=t.pads[t.pads.length/2-2],O=t.pads[t.pads.length-2];m=!!(T+O),o.push({type:12,data:y},{type:12,data:v},{type:12,data:T},{type:12,data:O}),c.push({name:"kh",type:"u32"},{name:"sh",type:"u32"},{name:"phStart",type:"u32"},{name:"phEnd",type:"u32"})}return[o,c,!0,p,m]}else{if(n)throw new Error("Pooling with kernelShape.length > 2 is not supported for NHWC format.");let d=Ge.computeStrides(t.kernelShape);o.push({type:12,data:d},{type:12,data:t.pads},{type:12,data:t.strides}),c.push({name:"kernelStrides",type:"u32",length:d.length},{name:"pads",type:"u32",length:t.pads.length},{name:"strides",type:"u32",length:t.strides.length});let u=t.pads.reduce((h,g)=>h+g);return[o,c,!!u,!1,!1]}},P0=(e,t,n,s,i,o,c,d,u,h,g,p)=>{let m=i.format==="NHWC",y=t.type.value,v=Pt("output",t.type.tensor,s);if(i.kernelShape.length<=2){let T="",O="",E="",S=n-(m?2:1);if(g?T=`
                for (var i: u32 = 0u; i < uniforms.kw; i++) {
                  xIndices[${S}] = indices[${S}] * uniforms.sw - uniforms.pwStart + i;
                  if (xIndices[${S}] < 0 || xIndices[${S}]
                      >= uniforms.x_shape[${S}]) {
                    pad++;
                    continue;
                  }
                  let x_val = x[${t.indicesToOffset("xIndices")}];
                  ${o}
                }`:T=`
                for (var i: u32 = 0u; i < uniforms.kw; i++) {
                  xIndices[${S}] = indices[${S}] * uniforms.sw - uniforms.pwStart + i;
                  let x_val = x[${t.indicesToOffset("xIndices")}];
                  ${o}
                }`,i.kernelShape.length===2){let D=n-(m?3:2);p?O=`
                for (var j: u32 = 0u; j < uniforms.kh; j++) {
                  xIndices[${D}] = indices[${D}] * uniforms.sh - uniforms.phStart + j;
                  if (xIndices[${D}] < 0 || xIndices[${D}] >= uniforms.x_shape[${D}]) {
                    pad += i32(uniforms.kw);
                    continue;
                  }
              `:O=`
                for (var j: u32 = 0u; j < uniforms.kh; j++) {
                  xIndices[${D}] = indices[${D}] * uniforms.sh - uniforms.phStart + j;
                `,E=`
              }
            `}return`
            ${e.registerUniforms(u).declareVariables(t,v)}

            ${e.mainStart()}
              ${e.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.outputSize")}

              let indices = ${v.offsetToIndices("global_idx")};
              var xIndices = ${v.offsetToIndices("global_idx")};

              var value = ${y}(${d});
              var pad = 0;
              ${O}
              ${T}
              ${E}
              ${c}

              output[global_idx] = value;
            }`}else{if(m)throw new Error("Pooling with kernelShape.length > 2 is not supported for NHWC format.");let T=i.kernelShape.length,O=i.pads.length,E="";return h?E=`
                if (xIndices[j] >= uniforms.x_shape[j]) {
                  pad++;
                  isPad = true;
                  break;
                }
              }
              if (!isPad) {
                let x_val = x[${t.indicesToOffset("xIndices")}];
                ${o}
              }`:E=`
              }
              let x_val = x[${t.indicesToOffset("xIndices")}];
              ${o}
            `,`
            ${e.registerUniforms(u).declareVariables(t,v)}

            ${e.mainStart()}
              ${e.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.outputSize")}
              let indices = ${v.offsetToIndices("global_idx")};
              var xIndices = ${v.offsetToIndices("global_idx")};

              var offsets: array<u32, ${T}>;

              var value = ${y}(${d});
              var pad = 0;
              var isPad = false;

              for (var i: u32 = 0u; i < uniforms.kernelSize; i++) {
                var offset = i;
                for (var j = 0u; j < ${T-1}u; j++) {
                  offsets[j] = offset / ${$t("uniforms.kernelStrides","j",T)};
                  offset -= offsets[j] * ${$t("uniforms.kernelStrides","j",T)};
                }
                offsets[${T-1}] = offset;

                isPad = false;
                for (var j = ${n-T}u; j < ${n}u; j++) {
                  xIndices[j] = indices[j] * ${$t("uniforms.strides",`j - ${n-T}u`,T)}
                    + offsets[j - ${n-T}u] - ${$t("uniforms.pads","j - 2u",O)};
                  ${E}
              }
              ${c}

              output[global_idx] = value;
            }`}},k0=e=>`${e.format};${e.ceilMode};${e.autoPad};${e.kernelShape.length}`,Cx=e=>`${k0(e)};${e.countIncludePad}`,Sx=e=>`${k0(e)};${e.storageOrder};${e.dilations}`,D0=e=>({format:e.format,autoPad:["NOTSET","VALID","SAME_UPPER","SAME_LOWER"][e.auto_pad],ceilMode:e.ceil_mode,kernelShape:e.kernel_shape,strides:e.strides,pads:e.pads}),O0=(e,t,n,s)=>{let[i,o]=S0(t,s,n),c=et("x",t.dataType,t.dims.length),d=c.type.value,u="value += x_val;",h="";i.countIncludePad?h+=`value /= ${d}(uniforms.kernelSize);`:h+=`value /= ${d}(i32(uniforms.kernelSize) - pad);`;let[g,p,m,y,v]=I0(o,i);g.push(...zt(t.dims,o));let T=["rank"];return{name:e,shaderCache:{hint:`${s.cacheKey};${m};${y};${v}`,inputDependencies:T},getRunData:()=>({outputs:[{dims:o,dataType:t.dataType}],dispatchGroup:{x:Math.ceil(Ge.size(o)/64)},programUniforms:g}),getShaderSource:O=>P0(O,c,t.dims.length,o.length,i,u,h,0,p,m,y,v)}},MA=e=>{let t=e.count_include_pad!==0,n=D0(e);if(n.ceilMode!==0)throw new Error("using ceil() in shape computation is not yet supported for AveragePool");let s={countIncludePad:t,...n,cacheKey:""};return{...s,cacheKey:Cx(s)}},xA=(e,t)=>{Jp(e.inputs),e.compute(O0("AveragePool",e.inputs[0],!1,t))},$0={autoPad:"",ceilMode:0,countIncludePad:!1,kernelShape:[],strides:[],pads:[],storageOrder:0,dilations:[]},EA=e=>{let t=e.format;return{format:t,...$0,cacheKey:t}},TA=(e,t)=>{Jp(e.inputs),e.compute(O0("GlobalAveragePool",e.inputs[0],!0,t))},B0=(e,t,n,s)=>{let[i,o]=S0(t,s,n),c=`
      value = max(x_val, value);
    `,d="",u=et("x",t.dataType,t.dims.length),h=["rank"],[g,p,m,y,v]=I0(o,i);return g.push(...zt(t.dims,o)),{name:e,shaderCache:{hint:`${s.cacheKey};${m};${y};${v}`,inputDependencies:h},getRunData:()=>({outputs:[{dims:o,dataType:t.dataType}],dispatchGroup:{x:Math.ceil(Ge.size(o)/64)},programUniforms:g}),getShaderSource:T=>P0(T,u,t.dims.length,o.length,i,c,d,t.dataType===10?-65504:-1e5,p,m,y,v)}},AA=(e,t)=>{Jp(e.inputs),e.compute(B0("MaxPool",e.inputs[0],!1,t))},CA=e=>{let t=e.storage_order,n=e.dilations,s=D0(e);if(t!==0)throw new Error("column major storage order is not yet supported for MaxPool");if(s.ceilMode!==0)throw new Error("using ceil() in shape computation is not yet supported for MaxPool");let i={storageOrder:t,dilations:n,...s,cacheKey:""};return{...i,cacheKey:Sx(i)}},SA=e=>{let t=e.format;return{format:t,...$0,cacheKey:t}},IA=(e,t)=>{Jp(e.inputs),e.compute(B0("GlobalMaxPool",e.inputs[0],!0,t))}}),Ix,Px,PA,kA,SD=mt(()=>{Xt(),sn(),Hr(),cn(),Ix=(e,t)=>{if(e.length<2||e.length>3)throw new Error("DequantizeLinear requires 2 or 3 inputs.");if(e.length===3&&e[1].dims===e[2].dims)throw new Error("x-scale and x-zero-point must have the same shape.");if(e.length===3&&e[0].dataType!==e[2].dataType)throw new Error("x and x-zero-point must have the same data type.");if(e[0].dataType===6&&e.length>2)throw new Error("In the case of dequantizing int32 there is no zero point.");if(e[1].dims.length!==0&&e[1].dims.length!==1&&e[1].dims.length!==e[0].dims.length)throw new Error("scale input must be a scalar, a 1D tensor, or have the same rank as the input tensor.");if(e.length>2){if(e[0].dataType!==e[2].dataType)throw new Error("x and x-zero-point must have the same data type.");if(e[1].dims.length!==e[2].dims.length)throw new Error("scale and zero-point inputs must have the same rank.");if(!e[1].dims.map((n,s)=>n===e[2].dims[s]).reduce((n,s)=>n&&s,!0))throw new Error("scale and zero-point inputs must have the same shape.")}if(t.blockSize>0){if(e[1].dims.length===0||e[1].dims.length===1&&e[1].dims[0]===1)throw new Error("blockSize must be set only for block quantization.");if(!e[1].dims.map((i,o)=>o===t.axis||i===e[0].dims[o]).reduce((i,o)=>i&&o,!0))throw new Error("For block qunatization, scale input shape to match the input shape except for the axis");if(e[1].dims.length!==e[0].dims.length)throw new Error("For block qunatization the scale input rank must be the same as the x rank.");let n=e[0].dims[t.axis],s=e[1].dims[t.axis];if(t.blockSize<Math.ceil(n/s)||t.blockSize>Math.ceil(n/(s-1)-1))throw new Error("blockSize must be with in the range [ceil(dI / Si), ceil(dI / (Si - 1) - 1)].")}},Px=(e,t)=>{let n=Ge.normalizeAxis(t.axis,e[0].dims.length),s=e[0].dataType,i=s===3,o=e[0].dims,c=e[1].dataType,d=Ge.size(o),u=s===3||s===2,h=u?[Math.ceil(Ge.size(e[0].dims)/4)]:e[0].dims,g=e[1].dims,p=e.length>2?e[2]:void 0,m=p?u?[Math.ceil(Ge.size(p.dims)/4)]:p.dims:void 0,y=g.length===0||g.length===1&&g[0]===1,v=y===!1&&g.length===1,T=Lr(d),O=y&&(!u||T===4),E=O?T:1,S=O&&!u?T:1,D=et("input",u?12:s,h.length,S),I=et("scale",c,g.length),M=p?et("zero_point",u?12:s,m.length):void 0,C=Pt("output",c,o.length,E),A=[D,I];M&&A.push(M);let k=[h,g];p&&k.push(m);let R=[{type:12,data:d/E},{type:12,data:n},{type:12,data:t.blockSize},...zt(...k,o)],G=te=>{let ee=[{name:"output_size",type:"u32"},{name:"axis",type:"u32"},{name:"block_size",type:"u32"}];return`
      ${te.registerUniforms(ee).declareVariables(...A,C)}
      ${te.mainStart()}
          ${te.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
          let output_indices = ${C.offsetToIndices("global_idx")};

          // Set input x
          ${u?`
            let input = ${D.getByOffset("global_idx / 4")};
            let x_vec = ${i?"unpack4xI8(input)":"unpack4xU8(input)"};
            let x_value = ${E===1?"x_vec[global_idx % 4]":"x_vec"};`:`let x_value = ${D.getByOffset("global_idx")};`};

          // Set scale input
          ${y?`let scale_value= ${I.getByOffset("0")}`:v?`
            let scale_index = ${C.indicesGet("output_indices","uniforms.axis")};
            let scale_value= ${I.getByOffset("scale_index")};`:`
            var scale_indices: ${I.type.indices} = output_indices;
            let index = ${I.indicesGet("scale_indices","uniforms.axis")} / uniforms.block_size;
            ${I.indicesSet("scale_indices","uniforms.axis","index")};
            let scale_value= ${I.getByIndices("scale_indices")};`};

          // Set zero-point input
          ${M?y?u?`
                let zero_point_input = ${M.getByOffset("0")};
                let zero_point_vec =  ${i?"unpack4xI8(zero_point_input)":"unpack4xU8(zero_point_input)"};
                let zero_point_value= zero_point_vec[0]`:`let zero_point_value = ${M.getByOffset("0")}`:v?u?`
                let zero_point_index = ${C.indicesGet("output_indices","uniforms.axis")};
                let zero_point_input = ${M.getByOffset("zero_point_index / 4")};
                let zero_point_vec =  ${i?"unpack4xI8(zero_point_input)":"unpack4xU8(zero_point_input)"};
                let zero_point_value = zero_point_vec[zero_point_index % 4]`:`
                let zero_point_index = ${C.indicesGet("output_indices","uniforms.axis")};
                let zero_point_value = ${M.getByOffset("zero_point_index")};`:u?`
                let zero_point_offset = ${I.indicesToOffset("scale_indices")};
                let zero_point_input = ${M.getByOffset("zero_point_offset / 4")};
                let zero_point_vec = ${i?"unpack4xI8(zero_point_input)":"unpack4xU8(zero_point_input)"};
                let zero_point_value = zero_point_vec[zero_point_offset % 4];`:`let zero_point_value = ${M.getByIndices("scale_indices")};`:`let zero_point_value = ${u?i?"i32":"u32":D.type.value}(0);`};
      // Compute and write output
      ${C.setByOffset("global_idx",`${C.type.value}(x_value - zero_point_value) * scale_value`)};
      }`};return{name:"DequantizeLinear",shaderCache:{hint:t.cacheKey,inputDependencies:M?["rank","rank","rank"]:["rank","rank"]},getShaderSource:G,getRunData:()=>({outputs:[{dims:o,dataType:c}],dispatchGroup:{x:Math.ceil(d/E/64),y:1,z:1},programUniforms:R})}},PA=(e,t)=>{Ix(e.inputs,t),e.compute(Px(e.inputs,t))},kA=e=>Nn({axis:e.axis,blockSize:e.blockSize})}),kx,Dx,DA,ID=mt(()=>{Ii(),Xt(),cn(),kx=(e,t,n)=>{let s=e===t,i=e<t&&n<0,o=e>t&&n>0;if(s||i||o)throw new Error("Range these inputs' contents are invalid.")},Dx=(e,t,n,s)=>{let i=Math.abs(Math.ceil((t-e)/n)),o=[i],c=i,d=[{type:12,data:c},{type:s,data:e},{type:s,data:n},...zt(o)],u=h=>{let g=Pt("output",s,o.length),p=g.type.value,m=[{name:"outputSize",type:"u32"},{name:"start",type:p},{name:"delta",type:p}];return`
        ${h.registerUniforms(m).declareVariables(g)}
        ${h.mainStart()}
        ${h.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.outputSize")}
        output[global_idx] = uniforms.start + ${p}(global_idx) * uniforms.delta;
      }`};return{name:"Range",shaderCache:{hint:`${s}`},getShaderSource:u,getRunData:()=>({outputs:[{dims:o,dataType:s}],dispatchGroup:{x:Math.ceil(c/64)},programUniforms:d})}},DA=e=>{let t=0,n=0,s=0;e.inputs[0].dataType===6?(t=e.inputs[0].getInt32Array()[0],n=e.inputs[1].getInt32Array()[0],s=e.inputs[2].getInt32Array()[0]):e.inputs[0].dataType===1&&(t=e.inputs[0].getFloat32Array()[0],n=e.inputs[1].getFloat32Array()[0],s=e.inputs[2].getFloat32Array()[0]),br.webgpu.validateInputContent&&kx(t,n,s),e.compute(Dx(t,n,s,e.inputs[0].dataType),{inputs:[]})}}),Ox,L0,F0,$x,OA,$A,PD=mt(()=>{Xt(),sn(),Hr(),cn(),Ox=(e,t,n,s)=>{if(e!=="none"&&s!=="i32"&&s!=="u32"&&s!=="f32")throw new Error(`Input ${s} is not supported with reduction ${e}.`);let i=`{
                var oldValue = 0;
                loop {
                  let newValueF32 =`,o=`;
                  let newValue = bitcast<i32>(newValueF32);
                  let res = atomicCompareExchangeWeak(&${t}, oldValue, newValue);
                  if res.exchanged {
                    break;
                  }
                  oldValue = res.old_value;
                }
              }`;switch(e){case"none":return`${t}=${n};`;case"add":return s==="i32"||s==="u32"?`atomicAdd(&${t}, bitcast<${s}>(${n}));`:`
              ${i}bitcast<${s}>(oldValue) + (${n})${o}`;case"max":return s==="i32"||s==="u32"?`atomicMax(&${t}, bitcast<${s}>(${n}));`:`
                ${i}max(bitcast<f32>(oldValue), (${n}))${o}`;case"min":return s==="i32"||s==="u32"?`atomicMin(&${t}, bitcast<${s}>(${n}));`:`${i}min(bitcast<${s}>(oldValue), (${n}))${o}`;case"mul":return`${i}(bitcast<${s}>(oldValue) * (${n}))${o}`;default:throw new Error(`Reduction ${e} is not supported.`)}},L0=(e,t)=>`${e===1?`
    let element_count_dim = uniforms.output_strides;
    let dim_value = uniforms.output_shape;`:`
    let element_count_dim = uniforms.output_strides[${t?"i - indices_start":"i"}];
    let dim_value = uniforms.output_shape[${t?"i - indices_start":"i"} + uniforms.last_index_dimension];`}
    
    if (index >= 0) {
      if (index >= i32(dim_value)) {
        index = i32(dim_value - 1);
      }
    } else {
      if (index < -i32(dim_value)) {
        index = 0;
      } else {
        index += i32(dim_value);
      }
    }
    data_offset += u32((u32(index) * element_count_dim));`,F0=(e,t,n)=>`for (var i = 0u; i < uniforms.num_updates_elements; i++) {
        let value = updates[uniforms.num_updates_elements * ${n?"global_idx":"idx"} + i];
        ${Ox(e.reduction,"output[data_offset + i]","value",t)}
      }`,$x=(e,t)=>{let n=e[0].dims,s=e[1].dims,i=n,o=1,c=Math.ceil(Ge.size(s)/o),d=s[s.length-1],u=Ge.sizeFromDimension(n,d),h=Ge.sizeFromDimension(s,0)/d,g=[{type:12,data:c},{type:12,data:d},{type:12,data:u},...zt(e[1].dims,e[2].dims,i)],p=m=>{let y=et("indices",e[1].dataType,e[1].dims.length),v=et("updates",e[2].dataType,e[2].dims.length,o),T=t.reduction!=="none"&&t.reduction!==""?lE("output",e[0].dataType,i.length):Pt("output",e[0].dataType,i.length,o);return`
      ${m.registerUniform("output_size","u32").registerUniform("last_index_dimension","u32").registerUniform("num_updates_elements","u32").declareVariables(y,v,T)}
      ${m.mainStart()}
        ${m.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
  var hasDuplicates = false;
  if (${t.reduction==="none"}) {
    for (var i = 0; i < ${h}; i = i + 1) {
      for (var j = i + 1; j < ${h}; j = j + 1) {
        var index_i = i32(indices[i].x);
        var index_j = i32(indices[j].x);
        if (index_i == index_j) {
          hasDuplicates = true;
          break;
        }
      }
      if (hasDuplicates) {
        break;
      }
    }
  }

  if (${t.reduction==="none"} && hasDuplicates) {
    if (global_idx != 0u) {
      return;
    }
    // Process each index-update pair individually when duplicates exist
    for (var idx = 0u; idx < ${h}u; idx++) {
      var data_offset = 0u;
      for (var i = 0u; i < uniforms.last_index_dimension; i++) {
        var index = i32(indices[idx * uniforms.last_index_dimension + i].x);
        ${L0(n.length,!1)}
      }
      ${F0(t,T.type.value,!1)}
    }
    return;
  }

  var data_offset = 0u;
  var indices_start = uniforms.last_index_dimension * global_idx;
  var indices_end = indices_start + uniforms.last_index_dimension;
  for (var i = indices_start; i < indices_end; i++) {
    var index = i32(indices[i].x);
    ${L0(n.length,!0)}
  }
  ${F0(t,T.type.value,!0)}
  }`};return{name:"ScatterND",shaderCache:{hint:`${t.cacheKey}_${t.reduction}`,inputDependencies:["rank","rank"]},getRunData:()=>({outputs:[{dims:i,dataType:e[0].dataType}],dispatchGroup:{x:Math.ceil(c/64)},programUniforms:g}),getShaderSource:p}},OA=e=>Nn({reduction:e.reduction}),$A=(e,t)=>{e.compute($x(e.inputs,t),{inputs:[e.inputs[1],e.inputs[2]],outputs:[]})}}),Bx,Lx,Fx,z0,zx,Nx,Rx,jx,Ux,Vx,Gx,Wx,N0,Hx,Qx,qx,Kx,Xx,BA,LA,kD=mt(()=>{Xt(),sn(),Hr(),cn(),Bx=(e,t)=>{if(e.every(n=>n>0||(()=>{throw new Error("Resize requires scales input values to be positive")})),e.length>0){if(t.mode==="linear"){if(!(e.length===2||e.length===3||e.length===4&&e[0]===1&&e[1]===1||e.length===4&&e[0]===1&&e[3]===1||e.length===5&&e[0]===1&&e[1]===1))throw new Error(`For linear mode, Resize requires scales to be 2D, 3D, 4D with either two outermost or one innermost and
            one outermost scale values equal to 1, or 5D with two outermost scale values equal to 1`)}else if(t.mode==="cubic"&&!(e.length===2||e.length===4&&e[0]===1&&e[1]===1||e.length===4&&e[0]===1&&e[3]===1))throw new Error("Resize requires scales input size to be 2 or 4 for cubic mode")}},Lx=(e,t,n)=>{t.every(i=>i>=0&&i<n||(()=>{throw new Error("Resize requires axes input values to be positive and less than rank")}));let s=new Array(n).fill(1);return t.forEach((i,o)=>s[i]=e[o]),s},Fx=(e,t,n,s,i,o)=>{let[c,d,u]=n>10?[1,2,3]:[-1,e.length>1?1:-1,-1],h=e[0].dims.length;if(c>0&&e.length>c&&e[c].dims.length>0)e[c].getFloat32Array().forEach(g=>o.push(g));else if(t.coordinateTransformMode==="tf_crop_and_resize")throw new Error("Resize requires RoI input to be specified when coordinateTransformMode is tfCropAndResize");if(d>0&&e.length>d&&e[d].dims.length===1&&e[d].dims[0]>0){if(e[d].getFloat32Array().forEach(g=>s.push(g)),s.length!==0&&s.length!==h&&n>=18&&s.length!==t.axes.length)throw new Error("Resize requires scales input size to be same as input rank or axes size for opset 18 and up");Bx(s,t),t.axes.length>0&&Lx(s,t.axes,h).forEach((g,p)=>s[p]=g)}if(u>0&&e.length>u&&e[u].dims.length===1&&e[u].dims[0]>0&&(e[u].getBigInt64Array().forEach(g=>i.push(Number(g))),i.length!==0&&i.length!==h&&n>=18&&i.length!==t.axes.length))throw new Error("Resize requires sizes input size to be same as input rank or axes size for opset 18 and up");if(t.axes.length>0){if(s.length!==0&&s.length!==t.axes.length)throw new Error('Resize requires "scales" input size to be of axes rank when axes attributes is specified');if(i.length!==0&&i.length!==t.axes.length)throw new Error('Resize requires "sizes" input size to be of rank axes rank when axes attributes is specified')}if(typeof s<"u"&&typeof i<"u"&&s.length>0&&i.length>h)throw new Error("Resize requires only of scales or sizes to be specified")},z0=(e,t,n,s)=>`
  // The whole part and the fractional part are calculated separately due to inaccuracy of floating
  // point division. As an example, f32(21) / f32(7) may evaluate to 2.99... instead of 3, causing an
  // offset-by-one error later in floor().
  let big = (${e}) * (${t});
  let whole = ${s}(big / (${n}));
  let fract = ${s}(big % (${n})) / ${s}(${n});
  return whole + fract;
`,zx=(e,t)=>`fn getOriginalCoordinateFromResizedCoordinate(xResized: u32, xScale: f32, lengthResized: u32,
     lengthOriginal: u32, roiStart: f32, roiEnd: f32) -> ${t} { `+(()=>{switch(e){case"asymmetric":return`
          if (xScale < 1.0 || floor(xScale) != xScale) {
            return ${t}(xResized) / ${t}(xScale);
          } else {
            ${z0("xResized","lengthOriginal","lengthResized",t)}
          }
        `;case"pytorch_half_pixel":return`if (lengthResized > 1) {
                    return (${t}(xResized) + 0.5) / ${t}(xScale) - 0.5;
                  } else {
                    return 0.0;
                  }`;case"tf_half_pixel_for_nn":return`return (${t}(xResized) + 0.5) / ${t}(xScale);`;case"align_corners":return`if (lengthResized == 1) {
                    return 0.0;
                  } else {
                    ${z0("xResized","lengthOriginal - 1","lengthResized - 1",t)}
                  }`;case"tf_crop_and_resize":return`if (lengthResized > 1) {
                    return ${t}(roiStart) * ${t}(lengthOriginal - 1) +
                        (${t}(xResized) * ${t}(roiEnd - roiStart) * ${t}(lengthOriginal - 1)) /
                        ${t}(lengthResized - 1);
                  } else {
                    return 0.5 * ${t}(roiStart + roiEnd) * ${t}(lengthOriginal - 1);
                  }`;case"half_pixel_symmetric":return`const outputWidth = ${t}xScale * ${t}(lengthResized);
                  const adjustment = ${t}(lengthResized) / outputWidth;
                  const center = ${t}(lengthOriginal) / 2;
                  const offset = center * (1 - adjustment);
                  return offset + ((${t}(xResized) + 0.5) / ${t}(xScale)) - 0.5;`;case"half_pixel":return`return ((${t}(xResized) + 0.5) / ${t}(xScale)) - 0.5;`;default:throw new Error(`Coordinate transform mode ${e} is not supported`)}})()+"}",Nx=(e,t,n)=>`fn getNearestPixelFromOriginal(xOriginal: ${n}, isDownSample: bool) -> ${n} {`+(()=>{switch(e){case"round_prefer_ceil":return"if (fract(xOriginal) == 0.5) {             return ceil(xOriginal);           } else {             return round(xOriginal);           }";case"floor":return"return floor(xOriginal);";case"ceil":return"return ceil(xOriginal);";case"round_prefer_floor":return"if (fract(xOriginal) == 0.5) {                     return floor(xOriginal);                   } else {                     return round(xOriginal);                   }";case"simple":default:if(t<11)return"if (isDownSample)                     {                       return ceil(xOriginal);                     } else {                       return xOriginal;                     }";throw new Error(`Nearest mode ${e} is not supported`)}})()+"}",Rx=(e,t,n)=>{let s=new Array(n).fill(0).concat(new Array(n).fill(1)),i=e.length===0?s:e.slice();return t.length>0?(t.forEach((o,c)=>{s[o]=i[c],s[c+n]=i[t.length+c]}),s):i},jx=(e,t,n,s)=>{let i=[];if(n.length>0)if(s.length>0){if(e.forEach(o=>i.push(o)),Math.max(...s)>e.length)throw new Error("axes is out of bound");s.forEach((o,c)=>i[o]=n[c])}else n.forEach(o=>i.push(o));else{if(t.length===0)throw new Error("Resize requires either scales or sizes.");i=e.map((o,c)=>Math.round(o*t[c]))}return i},Ux=(e,t,n)=>{let s=(()=>{switch(n.keepAspectRatioPolicy){case"not_larger":return n.axes.length>0?Math.min(...n.axes.map(o=>t[o]),Number.MAX_VALUE):Math.min(...t,Number.MAX_VALUE);case"not_smaller":return n.axes.length>0?Math.max(...n.axes.map(o=>t[o]),Number.MIN_VALUE):Math.max(...t,Number.MIN_VALUE);default:throw new Error(`Keep aspect ratio policy ${n.keepAspectRatioPolicy} is not supported`)}})();t.fill(1,0,t.length);let i=e.slice();return n.axes.length>0?(n.axes.forEach(o=>t[o]=s),n.axes.forEach(o=>i[o]=Math.round(e[o]*t[o]))):(t.fill(s,0,t.length),i.forEach((o,c)=>i[c]=Math.round(o*t[c]))),i},Vx=(e,t,n,s,i)=>`
    fn calculateOriginalIndicesFromOutputIndices(output_indices: ${e.type.indices}) -> array<${e.type.value}, ${n.length}> {
      var original_indices: array<${e.type.value}, ${n.length}>;
      for (var i:u32 = 0; i < ${n.length}; i++) {
        var output_index = ${e.indicesGet("output_indices","i")};
        var scale = ${$t("uniforms.scales","i",s)};
        var roi_low = ${$t("uniforms.roi","i",i)};
        var roi_hi = ${$t("uniforms.roi",`i + ${t.length}`,i)};
        if (scale == 1.0) {
          original_indices[i] = ${e.type.value}(output_index);
        } else {
          var input_shape_i = ${$t("uniforms.input_shape","i",t.length)};
          var output_shape_i = ${$t("uniforms.output_shape","i",n.length)};
          original_indices[i] = getOriginalCoordinateFromResizedCoordinate(output_index, scale, output_shape_i,
                                                                           input_shape_i, roi_low, roi_hi);
        }
      }
      return original_indices;
    }`,Gx=(e,t,n,s,i,o,c)=>`
    fn calculateInputIndicesFromOutputIndices(output_indices: ${t.type.indices}) -> ${e.type.indices} {
      var input_indices: ${e.type.indices};
      for (var i:u32 = 0; i < ${s.length}; i++) {
        var output_index = ${t.indicesGet("output_indices","i")};
        var input_index: u32;
        var scale = ${$t("uniforms.scales","i",i)};
        if (scale == 1.0) {
          input_index = output_index;
        } else {
          var roi_low = ${$t("uniforms.roi","i",o)};
          var roi_hi = ${$t("uniforms.roi",`i + ${n.length}`,o)};
          var input_shape_i = ${$t("uniforms.input_shape","i",n.length)};
          var output_shape_i = ${$t("uniforms.output_shape","i",s.length)};
          var original_idx = getOriginalCoordinateFromResizedCoordinate(output_index, scale, output_shape_i,
                                                                        input_shape_i, roi_low, roi_hi);
          if (!${c} || (original_idx >= 0 && original_idx < ${t.type.value}(input_shape_i))) {
            if (original_idx < 0) {
              input_index = 0;
            } else if (original_idx > ${t.type.value}(input_shape_i - 1)) {
              input_index = input_shape_i - 1;
            } else {
              input_index = u32(getNearestPixelFromOriginal(original_idx, scale < 1));
            }
          } else {
            input_index = u32(original_idx);
          }
        }
        ${e.indicesSet("input_indices","i","input_index")}
      }
      return input_indices;
    }`,Wx=(e,t)=>`
    fn checkInputIndices(input_indices: ${e.type.indices}) -> bool {
      for (var i:u32 = 0; i < ${t.length}; i++) {
        var input_index = ${e.indicesGet("input_indices","i")};
        if (input_index < 0 || input_index >= ${$t("uniforms.input_shape","i",t.length)}) {
          return false;
        }
      }
      return true;
    }`,N0=(e,t,n,s)=>e.rank>s?`
    ${e.indicesSet("input_indices",t,"channel")};
    ${e.indicesSet("input_indices",n,"batch")};
`:"",Hx=(e,t,n,s,i)=>{let[o,c,d,u]=n.length===2?[-1,0,1,-1]:[0,2,3,1],h=e.type.value;return`
    fn getInputValue(batch: u32, channel: u32, row: u32, col: u32) -> ${h} {
      var input_indices: ${e.type.indices};
      ${e.indicesSet("input_indices",c,`max(0, min(row, ${n[c]} - 1))`)};
      ${e.indicesSet("input_indices",d,`max(0, min(col, ${n[d]} - 1))`)};
      ${N0(e,u,o,2)}
      return ${e.getByIndices("input_indices")};
    }

    fn bilinearInterpolation(output_indices: ${t.type.indices}) -> ${h} {
      var originalIndices = calculateOriginalIndicesFromOutputIndices(output_indices);
      var row:${h} = originalIndices[${c}];
      var col:${h} = originalIndices[${d}];
      ${s?`if (row < 0 || row > (${n[c]} - 1) || col < 0 || col > (${n[d]} - 1)) {
        return ${i};
      }`:""};
      row = max(0, min(row, ${n[c]} - 1));
      col = max(0, min(col, ${n[d]} - 1));
      var row1: u32 = u32(row);
      var col1: u32 = u32(col);
      var row2: u32 = u32(row + 1);
      var col2: u32 = u32(col + 1);
      var channel: u32 = ${n.length>2?`u32(originalIndices[${u}])`:"0"};
      var batch: u32 =  ${n.length>2?`u32(originalIndices[${o}])`:"0"};
      var x11: ${h} = getInputValue(batch, channel, row1, col1);
      var x12: ${h} = getInputValue(batch, channel, row1, col2);
      var x21: ${h} = getInputValue(batch, channel, row2, col1);
      var x22: ${h} = getInputValue(batch, channel, row2, col2);
      var dx1: ${h} = abs(row - ${h}(row1));
      var dx2: ${h} = abs(${h}(row2) - row);
      var dy1: ${h} = abs(col - ${h}(col1));
      var dy2: ${h} = abs(${h}(col2) - col);
      if (row1 == row2) {
        dx1 = 0.5;
        dx2 = 0.5;
      }
      if (col1 == col2) {
        dy1 = 0.5;
        dy2 = 0.5;
      }
      return (x11 * dx2 * dy2 + x12 * dx2 * dy1 + x21 * dx1 * dy2 + x22 * dx1 * dy1);
    }`},Qx=(e,t,n,s,i,o,c,d,u,h)=>{let g=n.length===2,[p,m]=g?[0,1]:[2,3],y=e.type.value,v=T=>{let O=T===p?"row":"col";return`
      fn ${O}CubicInterpolation(input_indices: ${e.type.indices}, output_indices: ${t.type.indices}) -> ${y} {
        var output_index = ${t.indicesGet("output_indices",T)};
        var originalIdx: ${y} = getOriginalCoordinateFromResizedCoordinate(output_index, ${i[T]},
        ${s[T]}, ${n[T]}, ${o[T]}, ${o[T]} + ${n.length});
        var fractOriginalIdx: ${y} = originalIdx - floor(originalIdx);
        var coefs = getCubicInterpolationCoefs(fractOriginalIdx);

        if (${d} && (originalIdx < 0 || originalIdx > (${n[T]} - 1))) {
          return ${u};
        }
        var data: array<${y}, 4> = array<${y}, 4>(0.0, 0.0, 0.0, 0.0);
        for (var i: i32 = -1; i < 3; i++) {
          var ${O}: ${y} = originalIdx + ${y}(i);
          if (${O} < 0 || ${O} >= ${n[T]}) {
            ${h?`coefs[i + 1] = 0.0;
                        continue;`:d?`return ${u};`:`${O} = max(0, min(${O}, ${n[T]} - 1));`};
          }
        var input_indices_copy: ${e.type.indices} = input_indices;
          ${e.indicesSet("input_indices_copy",T,`u32(${O})`)};
          data[i + 1] = ${T===p?e.getByIndices("input_indices_copy"):"rowCubicInterpolation(input_indices_copy, output_indices)"};
        }
        return cubicInterpolation1D(data, coefs);
      }`};return`
    ${v(p)};
    ${v(m)};
  fn getCubicInterpolationCoefs(s: ${y}) -> array<${y}, 4> {
    var absS = abs(s);
    var coeffs: array<${y}, 4> = array<${y}, 4>(0.0, 0.0, 0.0, 0.0);
    var oneMinusAbsS: ${y} = 1.0 - absS;
    var twoMinusAbsS: ${y} = 2.0 - absS;
    var onePlusAbsS: ${y} = 1.0 + absS;
    coeffs[0] = ((${c} * onePlusAbsS - 5 * ${c}) * onePlusAbsS + 8 * ${c}) * onePlusAbsS - 4 * ${c};
    coeffs[1] = ((${c} + 2) * absS - (${c} + 3)) * absS * absS + 1;
    coeffs[2] = ((${c} + 2) * oneMinusAbsS - (${c} + 3)) * oneMinusAbsS * oneMinusAbsS + 1;
    coeffs[3] = ((${c} * twoMinusAbsS - 5 * ${c}) * twoMinusAbsS + 8 * ${c}) * twoMinusAbsS - 4 * ${c};
    return coeffs;
  }

  fn cubicInterpolation1D(x: array<${y}, 4>, coefs: array<${y}, 4>) -> ${y} {
    var coefsSum: ${y} = coefs[0] + coefs[1] + coefs[2] + coefs[3];
    return (x[0] * coefs[0] + x[1] * coefs[1]+ x[2] * coefs[2]+ x[3] * coefs[3]) / coefsSum;
  }

  fn bicubicInterpolation(output_indices: ${t.type.indices}) -> ${y} {
    var input_indices: ${e.type.indices} = output_indices;
    return colCubicInterpolation(input_indices, output_indices);
  }
    `},qx=(e,t,n,s,i)=>{let[o,c,d,u,h]=n.length===3?[-1,0,1,2,-1]:[0,2,3,4,1],g=e.type.value;return`
    fn getInputValue(batch: u32, channel: u32, depth:u32, height: u32, width: u32) -> ${g} {
      var input_indices: ${e.type.indices};
      ${e.indicesSet("input_indices",c,`max(0, min(depth, ${n[c]} - 1))`)};
      ${e.indicesSet("input_indices",d,`max(0, min(height, ${n[d]} - 1))`)};
      ${e.indicesSet("input_indices",u,`max(0, min(width, ${n[u]} - 1))`)};
      ${N0(e,h,o,3)}
      return ${e.getByIndices("input_indices")};
    }

    fn trilinearInterpolation(output_indices: ${t.type.indices}) -> ${g} {
      var originalIndices = calculateOriginalIndicesFromOutputIndices(output_indices);
      var depth:${g} = originalIndices[${c}];
      var height:${g} = originalIndices[${d}];
      var width:${g} = originalIndices[${u}];
      ${s?`if (depth < 0 || depth > (${n[c]} - 1) || height < 0 || height > (${n[d]} - 1) || width < 0 || (width > ${n[u]} - 1)) {
      return ${i};
        }`:""};

    depth = max(0, min(depth, ${n[c]} - 1));
      height = max(0, min(height, ${n[d]} - 1));
      width = max(0, min(width, ${n[u]} - 1));
      var depth1: u32 = u32(depth);
      var height1: u32 = u32(height);
      var width1: u32 = u32(width);
      var depth2: u32 = u32(depth + 1);
      var height2: u32 = u32(height + 1);
      var width2: u32 = u32(width + 1);
      var channel: u32 = ${n.length>3?`u32(originalIndices[${h}])`:"0"};
      var batch: u32 =  ${n.length>3?`u32(originalIndices[${o}])`:"0"};

      var x111: ${g} = getInputValue(batch, channel, depth1, height1, width1);
      var x112: ${g} = getInputValue(batch, channel, depth1, height1, width2);
      var x121: ${g} = getInputValue(batch, channel, depth1, height2, width1);
      var x122: ${g} = getInputValue(batch, channel, depth1, height2, width2);
      var x211: ${g} = getInputValue(batch, channel, depth2, height1, width1);
      var x212: ${g} = getInputValue(batch, channel, depth2, height1, width2);
      var x221: ${g} = getInputValue(batch, channel, depth2, height2, width1);
      var x222: ${g} = getInputValue(batch, channel, depth2, height2, width2);
      var dx1: ${g} = abs(depth - ${g}(depth1));
      var dx2: ${g} = abs(${g}(depth2) - depth);
      var dy1: ${g} = abs(height - ${g}(height1));
      var dy2: ${g} = abs(${g}(height2) - height);
      var dz1: ${g} = abs(width - ${g}(width1));
      var dz2: ${g} = abs(${g}(width2) - width);
      if (depth1 == depth2) {
        dx1 = 0.5;
        dx2 = 0.5;
      }
      if (height1 == height2) {
        dy1 = 0.5;
        dy2 = 0.5;
      }
      if (width1 == width2) {
        dz1 = 0.5;
        dz2 = 0.5;
      }
      return (x111 * dx2 * dy2 * dz2 + x112 * dx2 * dy2 * dz1 + x121 * dx2 * dy1 *dz2 + x122 * dx2 * dy1 * dz1 +
              x211 * dx1 * dy2 * dz2 + x212 * dx1 * dy2 * dz1 + x221 * dx1 * dy1 *dz2 + x222 * dx1 * dy1 * dz1);
    }`},Kx=(e,t,n,s,i,o)=>{let c=e.dims,d=Rx(o,t.axes,c.length),u=jx(c,s,i,t.axes),h=s.slice();s.length===0&&(h=c.map((S,D)=>S===0?1:u[D]/S),t.keepAspectRatioPolicy!=="stretch"&&(u=Ux(c,h,t)));let g=Pt("output",e.dataType,u.length),p=et("input",e.dataType,c.length),m=Ge.size(u),y=c.length===u.length&&c.every((S,D)=>S===u[D]),v=t.coordinateTransformMode==="tf_crop_and_resize",T=t.extrapolationValue,O=p.type.value,E=S=>`
      ${y?"":`
      ${zx(t.coordinateTransformMode,O)};
      ${(()=>{switch(t.mode){case"nearest":return`
              ${Wx(p,c)};
              ${Nx(t.nearestMode,n,O)};
              ${Gx(p,g,c,u,h.length,d.length,v)};
              `;case"linear":return`
              ${Vx(g,c,u,h.length,d.length)};
              ${(()=>{if(c.length===2||c.length===4)return`${Hx(p,g,c,v,T)}`;if(c.length===3||c.length===5)return`${qx(p,g,c,v,T)}`;throw Error("Linear mode only supports input dims 2, 3, 4 and 5 are supported in linear mode.")})()};
            `;case"cubic":return`
            ${(()=>{if(c.length===2||c.length===4)return`${Qx(p,g,c,u,h,d,t.cubicCoeffA,v,t.extrapolationValue,t.excludeOutside)}`;throw Error("Cubic mode only supports input dims 2 and 4 are supported in linear mode.")})()};
            `;default:throw Error("Invalid resize mode")}})()};
      `}
      ${S.registerUniform("output_size","u32").registerUniform("scales","f32",h.length).registerUniform("roi","f32",d.length).declareVariables(p,g)}
      ${S.mainStart()}
        ${S.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
        ${y?"output[global_idx] = input[global_idx];":`
        let output_indices = ${g.offsetToIndices("global_idx")};
        var input_indices: ${p.type.indices};
        ${(()=>{switch(t.mode){case"nearest":return`input_indices = calculateInputIndicesFromOutputIndices(output_indices);
                if (checkInputIndices(input_indices)) {
                  output[global_idx] = ${p.getByIndices("input_indices")};
                } else {
                  output[global_idx] = ${t.extrapolationValue};
                }`;case"linear":return`output[global_idx] = ${c.length===2||c.length===4?"bilinearInterpolation":"trilinearInterpolation"}(output_indices);`;case"cubic":return"output[global_idx] = bicubicInterpolation(output_indices);";default:throw Error(`Unsupported resize mode: ${t.mode}`)}})()};
`}
      }`;return{name:"Resize",shaderCache:{hint:`${t.cacheKey}|${n}|${h.length>0?t.mode==="cubic"?h:h.length:""}|${i.length>0?i:""}|${d.length>0?d:""}|${y}|${t.mode==="nearest"?c.length:c}`,inputDependencies:["rank"]},getShaderSource:E,getRunData:()=>({outputs:[{dims:u,dataType:e.dataType}],dispatchGroup:{x:Math.ceil(m/64)},programUniforms:[{type:12,data:m},{type:1,data:h},{type:1,data:d},...zt(c,u)]})}},Xx=e=>{let t=e.customDataBuffer;return new Uint32Array(t,t.byteOffset,1)[0]},BA=(e,t)=>{let n=[],s=[],i=[],o=Xx(e);if(t.antialias!==0)throw Error("Only default value (0) for Antialias attribute is supported");Fx(e.inputs,t,o,n,s,i),e.compute(Kx(e.inputs[0],t,o,n,s,i),{inputs:[0]})},LA=e=>{let t=e.antialias,n=e.axes,s=e.coordinateTransformMode,i=e.cubicCoeffA,o=e.excludeOutside!==0,c=e.extrapolationValue,d=e.keepAspectRatioPolicy,u=e.mode,h=e.nearestMode===""?"simple":e.nearestMode;return Nn({antialias:t,axes:n,coordinateTransformMode:s,cubicCoeffA:i,excludeOutside:o,extrapolationValue:c,keepAspectRatioPolicy:d,mode:u,nearestMode:h})}}),Yx,Jx,FA,DD=mt(()=>{Xt(),sn(),cn(),Yx=e=>{if(!e||e.length<3)throw new Error("layerNorm requires at least 3 inputs.");let t=e[0],n=e[1],s=e[2];if(t.dataType!==n.dataType||t.dataType!==s.dataType)throw new Error("All inputs must have the same data type");if(t.dims.length!==3&&t.dims.length!==2)throw new Error("Input must be 2D or 3D");if(n.dims.length!==3&&n.dims.length!==2)throw new Error("Skip must be 2D or 3D");let i=t.dims[t.dims.length-1],o=t.dims[t.dims.length-2];if(n.dims[n.dims.length-1]!==i)throw new Error("Skip must have the same hidden size as input");if(n.dims[n.dims.length-2]!==o)throw new Error("Skip must have the same sequence length as input");if(s.dims.length!==1)throw new Error("Gamma must be 1D");if(s.dims[s.dims.length-1]!==i)throw new Error("Gamma must have the same hidden size as input");if(e.length>3){let c=e[3];if(c.dims.length!==1)throw new Error("Beta must be 1D");if(c.dims[c.dims.length-1]!==i)throw new Error("Beta must have the same hidden size as input")}if(e.length>4){let c=e[4];if(c.dims.length!==1)throw new Error("Bias must be 1D");if(c.dims[c.dims.length-1]!==i)throw new Error("Bias must have the same hidden size as input")}},Jx=(e,t,n,s)=>{let i=t.simplified,o=e[0].dims,c=Ge.size(o),d=o,u=c,h=o.slice(-1)[0],g=s?o.slice(0,-1).concat(1):[],p=!i&&e.length>3,m=e.length>4,y=s&&n>1,v=s&&n>2,T=n>3,O=64,E=Lr(h),S=[{type:12,data:u},{type:12,data:E},{type:12,data:h},{type:1,data:t.epsilon}],D=M=>{let C=[{name:"output_size",type:"u32"},{name:"components",type:"u32"},{name:"hidden_size",type:"u32"},{name:"epsilon",type:"f32"}],A=[et("x",e[0].dataType,e[0].dims,E),et("skip",e[1].dataType,e[1].dims,E),et("gamma",e[2].dataType,e[2].dims,E)];p&&A.push(et("beta",e[3].dataType,e[3].dims,E)),m&&A.push(et("bias",e[4].dataType,e[4].dims,E)),A.push(Pt("output",e[0].dataType,d,E)),y&&A.push(Pt("mean_output",1,g)),v&&A.push(Pt("inv_std_output",1,g)),T&&A.push(Pt("input_skip_bias_sum",e[0].dataType,d,E));let k=ga(e[0].dataType),R=ga(1,E);return`

      ${M.registerUniforms(C).declareVariables(...A)}
      var<workgroup> sum_shared : array<${R}, ${O}>;
      var<workgroup> sum_squared_shared : array<${R}, ${O}>;

      ${M.mainStart([O,1,1])}
        let ix = local_id.x;
        let iy = global_id.x / ${O};

        let hidden_size_vectorized: u32 = uniforms.hidden_size / uniforms.components;
        var stride = hidden_size_vectorized / ${O};
        let offset = ix * stride + iy * hidden_size_vectorized;
        let offset1d = stride * ix;
        if (ix == ${O-1}) {
          stride = hidden_size_vectorized - stride * ix;
        }
        for (var i: u32 = 0; i < stride; i++) {
          let skip_value = skip[offset + i];
          let bias_value = ${m?"bias[offset1d + i]":k+"(0.0)"};
          let input_value = x[offset + i];
          let value = input_value + skip_value + bias_value;
          ${T?"input_skip_bias_sum[offset + i] = value;":""}
          output[offset + i] = value;
          let f32_value = ${gf(k,E,"value")};
          sum_shared[ix] += f32_value;
          sum_squared_shared[ix] += f32_value * f32_value;
        }
        workgroupBarrier();

        var reduce_size : u32 = ${O};
        for (var curr_size = reduce_size >> 1;  curr_size > 0; curr_size = reduce_size >> 1) {
          reduce_size = curr_size + (reduce_size & 1);
          if (ix < curr_size) {
            sum_shared[ix] += sum_shared[ix + reduce_size];
            sum_squared_shared[ix] += sum_squared_shared[ix + reduce_size];
          }
          workgroupBarrier();
        }

        let sum = sum_shared[0];
        let square_sum = sum_squared_shared[0];
        let mean = ${oc("sum",E)} / f32(uniforms.hidden_size);
        let inv_std_dev = inverseSqrt(${oc("square_sum",E)} / f32(uniforms.hidden_size) ${i?"":"- mean * mean"} + uniforms.epsilon);
        ${y?"mean_output[global_idx] = mean;":""}
        ${v?"inv_std_output[global_idx] = inv_std_dev;":""}

        for (var i: u32 = 0; i < stride; i++) {
          output[offset + i] = (output[offset + i] ${i?"":`- ${k}(mean)`}) *
            ${k}(inv_std_dev) * gamma[offset1d + i]
            ${p?"+ beta[offset1d + i]":""};
        }
      }`},I=[{dims:d,dataType:e[0].dataType}];return n>1&&I.push({dims:g,dataType:1}),n>2&&I.push({dims:g,dataType:1}),n>3&&I.push({dims:o,dataType:e[0].dataType}),{name:"SkipLayerNormalization",shaderCache:{hint:`${E};${y};${v};${T}`,inputDependencies:e.map((M,C)=>"type")},getShaderSource:D,getRunData:()=>({outputs:I,dispatchGroup:{x:Math.ceil(u/h)},programUniforms:S})}},FA=(e,t)=>{Yx(e.inputs);let n=[0];e.outputCount>1&&n.push(-3),e.outputCount>2&&n.push(-3),e.outputCount>3&&n.push(3),e.compute(Jx(e.inputs,t,e.outputCount,!1),{outputs:n})}}),Zx,Zp,e1,R0,t1,n1,zA,NA,OD=mt(()=>{Xt(),sn(),Hr(),cn(),Zx=(e,t)=>{if(!e||e.length<1)throw new Error("too few inputs");if(t.axes.length!==0){if(t.axes.length!==t.starts.length||t.axes.length!==t.ends.length)throw new Error("axes, starts and ends must have the same length")}else if(t.starts.length!==t.ends.length)throw new Error("starts and ends must have the same length");e.slice(1).forEach((n,s)=>{if(e[s+1].dataType!==6&&e[s+1].dataType!==7)throw new Error(`Input ${s} must be an array of int32 or int64`)})},Zp=(e,t)=>{let n=[];if(e.length>t)if(e[t].dataType===7)e[t].getBigInt64Array().forEach(s=>n.push(Number(s)));else if(e[t].dataType===6)e[t].getInt32Array().forEach(s=>n.push(Number(s)));else throw new Error(`Input ${t} must be an array of int32 or int64`);return n},e1=(e,t)=>{if(e.length>1){let n=Zp(e,1),s=Zp(e,2),i=Zp(e,3);return i.length===0&&(i=[...Array(e[0].dims.length).keys()]),Nn({starts:n,ends:s,axes:i})}else return t},R0=(e,t,n,s,i)=>{let o=e;return e<0&&(o+=n[s[t]]),i[t]<0?Math.max(0,Math.min(o,n[s[t]]-1)):Math.max(0,Math.min(o,n[s[t]]))},t1=(e,t,n)=>`fn calculateInputIndices(output_indices: ${t.type.indices}) -> ${e.type.indices} {
          var input_indices: ${e.type.indices};
          var carry = 0u;
          for (var i = ${n.length}; i >= 0; i--) {
            let input_shape_i = ${$t("uniforms.input_shape","i",n.length)};
            let steps_i = ${$t("uniforms.steps","i",n.length)};
            let signs_i = ${$t("uniforms.signs","i",n.length)};
            let starts_i = ${$t("uniforms.starts","i",n.length)};
            var output_index = ${t.indicesGet("output_indices","i")};
            var input_index = output_index * steps_i + starts_i + carry;
            carry = input_index / input_shape_i;
            input_index = input_index % input_shape_i;
            if (signs_i < 0) {
              input_index = input_shape_i - input_index - 1u + starts_i;
            }
            ${e.indicesSet("input_indices","i","input_index")};
          }
          return input_indices;
      }`,n1=(e,t)=>{let n=e[0].dims,s=Ge.size(n),i=t.axes.length>0?Ge.normalizeAxes(t.axes,n.length):[...Array(n.length).keys()],o=Zp(e,4);o.forEach(E=>E!==0||(()=>{throw new Error("step cannot be 0")})),o.length===0&&(o=Array(i.length).fill(1));let c=t.starts.map((E,S)=>R0(E,S,n,i,o)),d=t.ends.map((E,S)=>R0(E,S,n,i,o));if(i.length!==c.length||i.length!==d.length)throw new Error("start, ends and axes should have the same number of elements");if(i.length!==n.length)for(let E=0;E<n.length;++E)i.includes(E)||(c.splice(E,0,0),d.splice(E,0,n[E]),o.splice(E,0,1));let u=o.map(E=>Math.sign(E));o.forEach((E,S,D)=>{if(E<0){let I=(d[S]-c[S])/E,M=c[S],C=M+I*o[S];c[S]=C,d[S]=M,D[S]=-E}});let h=n.slice(0);i.forEach((E,S)=>{h[E]=Math.ceil((d[E]-c[E])/o[E])});let g={dims:h,dataType:e[0].dataType},p=Pt("output",e[0].dataType,h.length),m=et("input",e[0].dataType,e[0].dims.length),y=Ge.size(h),v=[{name:"outputSize",type:"u32"},{name:"starts",type:"u32",length:c.length},{name:"signs",type:"i32",length:u.length},{name:"steps",type:"u32",length:o.length}],T=[{type:12,data:y},{type:12,data:c},{type:6,data:u},{type:12,data:o},...zt(e[0].dims,h)],O=E=>`
      ${E.registerUniforms(v).declareVariables(m,p)}
        ${t1(m,p,n)}
        ${E.mainStart()}
          ${E.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.outputSize")}
          let output_indices = ${p.offsetToIndices("global_idx")};
          let input_indices = calculateInputIndices(output_indices);
          ${p.setByOffset("global_idx",m.getByIndices("input_indices"))}
      }`;return{name:"Slice",shaderCache:{hint:`${u.length}_${c.length}_${o.length}`,inputDependencies:["rank"]},getShaderSource:O,getRunData:()=>({outputs:[g],dispatchGroup:{x:Math.ceil(s/64)},programUniforms:T})}},zA=(e,t)=>{Zx(e.inputs,t);let n=e1(e.inputs,t);e.compute(n1(e.inputs,n),{inputs:[0]})},NA=e=>{let t=e.starts,n=e.ends,s=e.axes;return Nn({starts:t,ends:n,axes:s})}}),r1,a1,RA,jA,$D=mt(()=>{Xt(),sn(),Hr(),lc(),cn(),r1=e=>{if(!e||e.length!==1)throw new Error("Softmax op requires 1 input.")},a1=(e,t)=>{let n=e.inputs[0],s=n.dims,i=Ge.size(s),o=s.length,c=Ge.normalizeAxis(t.axis,o),d=c<s.length-1,u,h=[];d?(h=Array.from({length:o},(A,k)=>k),h[c]=o-1,h[o-1]=c,u=e.compute($s(n,h),{inputs:[n],outputs:[-1]})[0]):u=n;let g=u.dims,p=g[o-1],m=i/p,y=Lr(p),v=p/y,T=64;m===1&&(T=256);let O=(A,k)=>k===4?`max(max(${A}.x, ${A}.y), max(${A}.z, ${A}.w))`:k===2?`max(${A}.x, ${A}.y)`:k===3?`max(max(${A}.x, ${A}.y), ${A}.z)`:A,E=et("x",u.dataType,u.dims,y),S=Pt("result",u.dataType,u.dims,y),D=E.type.value,I=ga(u.dataType)==="f32"?`var threadMax = ${D}(-3.402823e+38f);`:`var threadMax = ${D}(-65504.0h);`,M=A=>`
      var<workgroup> rowMaxShared : ${D};
      var<workgroup> rowSumShared : ${D};
      var<workgroup> threadShared : array<${D}, ${T}>;

      fn getValue(row: i32, col: i32, row_stride: i32) -> ${D} {
        let index = row * row_stride + col;
        return x[index];
      }

      fn setValue(row: i32, col: i32, row_stride: i32, value: ${D}) {
        let index = row * row_stride + col;
        result[index] = value;
      }
      ${A.registerUniform("packedCols","i32").declareVariables(E,S)}
      ${A.mainStart(T)}
        let gindex = i32(global_idx);
        let lindex = i32(local_idx);
        const wg = ${T};
        let row = gindex / wg;
        let cols = uniforms.packedCols;
        let row_stride : i32 = uniforms.packedCols;

        // find the rows max
        ${I}
        for (var col = lindex; col < cols; col += wg) {
          let value = getValue(row, col, row_stride);
          threadMax = max(threadMax, value);
        }
        if (lindex < cols) {
          threadShared[lindex] = threadMax;
        }
        workgroupBarrier();

        var reduceSize = min(cols, wg);
        for (var currSize = reduceSize >> 1;  currSize > 0; currSize = reduceSize >> 1) {
          reduceSize = currSize + (reduceSize & 1);
          if (lindex < currSize) {
            threadShared[lindex] = max(threadShared[lindex], threadShared[lindex + reduceSize]);
          }
          workgroupBarrier();
        }
        if (lindex == 0) {
          rowMaxShared = ${D}(${O("threadShared[0]",y)});
        }
        workgroupBarrier();

        // find the rows sum
        var threadSum = ${D}(0.0);
        for (var col = lindex; col < cols; col += wg) {
          let subExp = exp(getValue(row, col, row_stride) - rowMaxShared);
          threadSum += subExp;
        }
        threadShared[lindex] = threadSum;
        workgroupBarrier();

        for (var currSize = wg >> 1;  currSize > 0; currSize = currSize >> 1) {
          if (lindex < currSize) {
            threadShared[lindex] = threadShared[lindex] + threadShared[lindex + currSize];
          }
          workgroupBarrier();
        }
        if (lindex == 0) {
          rowSumShared = ${D}(${oc("threadShared[0]",y)});
        }
        workgroupBarrier();

        // calculate final value for each element in the row
        for (var col = lindex; col < cols; col += wg) {
          let value = exp(getValue(row, col, row_stride) - rowMaxShared) / rowSumShared;
          setValue(row, col, row_stride, value);
        }
      }`,C=e.compute({name:"Softmax",shaderCache:{hint:`${y};${T}`,inputDependencies:["type"]},getRunData:()=>({outputs:[{dims:g,dataType:u.dataType}],dispatchGroup:{x:m},programUniforms:[{type:6,data:v}]}),getShaderSource:M},{inputs:[u],outputs:[d?-1:0]})[0];d&&e.compute($s(C,h),{inputs:[C]})},RA=(e,t)=>{r1(e.inputs),a1(e,t)},jA=e=>Nn({axis:e.axis})}),j0,s1,i1,o1,UA,BD=mt(()=>{Xt(),sn(),cn(),j0=e=>Array.from(e.getBigInt64Array(),Number),s1=e=>{if(!e||e.length!==2)throw new Error("Tile requires 2 inputs.");if(e[0].dataType!==1&&e[0].dataType!==10&&e[0].dataType!==6&&e[0].dataType!==12)throw new Error("Tile only support float, float16, int32, and uint32 data types");if(e[1].dataType!==7)throw new Error("Tile `repeats` input should be of int64 data type");if(e[1].dims.length!==1)throw new Error("Tile `repeats` input should be 1-D");if(j0(e[1]).length!==e[0].dims.length)throw new Error("Tile `repeats` input should have same number of elements as rank of input data tensor")},i1=(e,t)=>{let n=[];for(let s=0;s<e.length;++s)n.push(e[s]*t[s]);return n},o1=(e,t)=>{let n=e[0].dims,s=t??j0(e[1]),i=i1(n,s),o=Ge.size(i),c=e[0].dataType,d=et("input",c,n.length),u=Pt("output",c,i.length),h=g=>`
      const inputShape = ${d.indices(...n)};
      ${g.registerUniform("output_size","u32").declareVariables(d,u)}
      ${g.mainStart()}
      ${g.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
      let output_indices = ${u.offsetToIndices("global_idx")};
      var input_indices: ${d.type.indices};
      for (var i = 0; i < ${n.length}; i++) {
        let input_dim_i = ${d.indicesGet("uniforms.input_shape","i")};
        let input_dim_value = ${u.indicesGet("output_indices","i")}  % input_dim_i;

        ${d.indicesSet("input_indices","i","input_dim_value")}
      }
      ${u.setByOffset("global_idx",d.getByIndices("input_indices"))}
    }`;return{name:"Tile",shaderCache:{hint:`${s}`,inputDependencies:["rank"]},getRunData:()=>({outputs:[{dims:i,dataType:e[0].dataType}],dispatchGroup:{x:Math.ceil(o/64)},programUniforms:[{type:12,data:o},...zt(e[0].dims,i)]}),getShaderSource:h}},UA=e=>{s1(e.inputs),e.compute(o1(e.inputs),{inputs:[0]})}}),l1,c1,VA,LD=mt(()=>{Xt(),sn(),cn(),l1=(e,t,n,s,i)=>{let o=Pt("output_data",i,n.length,4),c=et("a_data",t[1].dataType,t[1].dims.length,4),d=et("b_data",t[2].dataType,t[2].dims.length,4),u=et("c_data",t[0].dataType,t[0].dims.length,4),h,g=(p,m,y)=>`select(${m}, ${p}, ${y})`;if(!s)h=o.setByOffset("global_idx",g(c.getByOffset("global_idx"),d.getByOffset("global_idx"),u.getByOffset("global_idx")));else{let p=(m,y,v="")=>{let T=`a_data[index_a${y}][component_a${y}]`,O=`b_data[index_b${y}][component_b${y}]`,E=`bool(c_data[index_c${y}] & (0xffu << (component_c${y} * 8)))`;return`
            let output_indices${y} = ${o.offsetToIndices(`global_idx * 4u + ${y}u`)};
            let offset_a${y} = ${c.broadcastedIndicesToOffset(`output_indices${y}`,o)};
            let offset_b${y} = ${d.broadcastedIndicesToOffset(`output_indices${y}`,o)};
            let offset_c${y} = ${u.broadcastedIndicesToOffset(`output_indices${y}`,o)};
            let index_a${y} = offset_a${y} / 4u;
            let index_b${y} = offset_b${y} / 4u;
            let index_c${y} = offset_c${y} / 4u;
            let component_a${y} = offset_a${y} % 4u;
            let component_b${y} = offset_b${y} % 4u;
            let component_c${y} = offset_c${y} % 4u;
            ${m}[${y}] = ${v}(${g(T,O,E)});
          `};i===9?h=`
            var data = vec4<u32>(0);
            ${p("data",0,"u32")}
            ${p("data",1,"u32")}
            ${p("data",2,"u32")}
            ${p("data",3,"u32")}
            output_data[global_idx] = dot(vec4<u32>(0x1, 0x100, 0x10000, 0x1000000), vec4<u32>(data));`:h=`
            ${p("output_data[global_idx]",0)}
            ${p("output_data[global_idx]",1)}
            ${p("output_data[global_idx]",2)}
            ${p("output_data[global_idx]",3)}
          `}return`
        ${e.registerUniform("vec_size","u32").declareVariables(u,c,d,o)}
        ${e.mainStart()}
        ${e.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.vec_size")}
        ${h}
      }`},c1=e=>{let t=e[1].dims,n=e[2].dims,s=e[0].dims,i=e[1].dataType,o=!(Ge.areEqual(t,n)&&Ge.areEqual(n,s)),c=t,d=Ge.size(t);if(o){let h=wf.calcShape(wf.calcShape(t,n,!1),s,!1);if(!h)throw new Error("Can't perform where op on the given tensors");c=h,d=Ge.size(c)}let u=Math.ceil(d/4);return{name:"Where",shaderCache:{inputDependencies:["rank","rank","rank"]},getShaderSource:h=>l1(h,e,c,o,i),getRunData:()=>({outputs:[{dims:c,dataType:i}],dispatchGroup:{x:Math.ceil(d/64/4)},programUniforms:[{type:12,data:u},...zt(s,t,n,c)]})}},VA=e=>{e.compute(c1(e.inputs))}}),GA,FD=mt(()=>{Yk(),oy(),Jk(),Zk(),eD(),tD(),nD(),oD(),cD(),uD(),dD(),fD(),hD(),pD(),mD(),gD(),_D(),vD(),yD(),bD(),wD(),MD(),xD(),ED(),TD(),cA(),AD(),CD(),SD(),ID(),PD(),iy(),kD(),pA(),DD(),OD(),$D(),fA(),BD(),lc(),ly(),LD(),GA=new Map([["Abs",[FE]],["Acos",[zE]],["Acosh",[NE]],["Add",[yT]],["ArgMax",[OE,yv]],["ArgMin",[DE,yv]],["Asin",[RE]],["Asinh",[jE]],["Atan",[UE]],["Atanh",[VE]],["Attention",[$E]],["AveragePool",[xA,MA]],["BatchNormalization",[BE]],["BiasAdd",[LE]],["BiasSplitGelu",[vT]],["Cast",[WE,GE]],["Ceil",[QE]],["Clip",[HE]],["Concat",[IT,PT]],["Conv",[Tv,Ev]],["ConvTranspose",[RT,NT]],["Cos",[qE]],["Cosh",[KE]],["CumSum",[jT,UT]],["DepthToSpace",[VT,GT]],["DequantizeLinear",[PA,kA]],["Div",[bT]],["Einsum",[WT,HT]],["Elu",[XE,im]],["Equal",[wT]],["Erf",[YE]],["Exp",[JE]],["Expand",[QT]],["FastGelu",[qT]],["Floor",[ZE]],["FusedConv",[Tv,Ev]],["Gather",[XT,KT]],["GatherElements",[nA,tA]],["GatherBlockQuantized",[ZT,eA]],["GatherND",[YT,JT]],["Gelu",[eT]],["Gemm",[aA,rA]],["GlobalAveragePool",[TA,EA]],["GlobalMaxPool",[IA,SA]],["Greater",[TT]],["GreaterOrEqual",[CT]],["GridSample",[sA,iA]],["GroupQueryAttention",[mA]],["HardSigmoid",[lT,oT]],["InstanceNormalization",[gA]],["LayerNormalization",[_A]],["LeakyRelu",[tT,im]],["Less",[AT]],["LessOrEqual",[ST]],["Log",[gT]],["MatMul",[vA]],["MatMulNBits",[yA,bA]],["MaxPool",[AA,CA]],["Mul",[MT]],["MultiHeadAttention",[lA,oA]],["Neg",[rT]],["Not",[nT]],["Pad",[wA]],["Pow",[xT]],["QuickGelu",[_T,im]],["Range",[DA]],["Reciprocal",[aT]],["ReduceMin",[CE]],["ReduceMean",[ME]],["ReduceMax",[AE]],["ReduceSum",[IE]],["ReduceProd",[SE]],["ReduceL1",[xE]],["ReduceL2",[EE]],["ReduceLogSum",[kE]],["ReduceLogSumExp",[TE]],["ReduceSumSquare",[PE]],["Relu",[sT]],["Resize",[BA,LA]],["RotaryEmbedding",[hA]],["ScatterND",[$A,OA]],["Sigmoid",[iT]],["Sin",[cT]],["Sinh",[uT]],["Slice",[zA,NA]],["SkipLayerNormalization",[FA]],["Split",[uA,dA]],["Sqrt",[dT]],["Softmax",[RA,jA]],["Sub",[ET]],["Tan",[fT]],["Tanh",[hT]],["ThresholdedRelu",[mT,im]],["Tile",[UA]],["Transpose",[uE,dE]],["Where",[VA]]])}),WA,zD=mt(()=>{Ii(),nl(),cn(),WA=class{constructor(e){this.backend=e,this.repo=new Map,this.attributesBound=!1}getArtifact(e){return this.repo.get(e)}setArtifact(e,t){this.repo.set(e,t)}run(e,t,n,s,i){Si(e.programInfo.name);let o=this.backend.device,c=this.backend.getComputePassEncoder();this.backend.writeTimestamp(this.backend.pendingDispatchNumber*2);let d=[];for(let h of t)d.push({binding:d.length,resource:{buffer:h.buffer}});for(let h of n)d.push({binding:d.length,resource:{buffer:h.buffer}});i&&d.push({binding:d.length,resource:i});let u=o.createBindGroup({layout:e.computePipeline.getBindGroupLayout(0),entries:d,label:e.programInfo.name});if(this.backend.sessionStatus==="capturing"){let h={kernelId:this.backend.currentKernelId,computePipeline:e.computePipeline,bindGroup:u,dispatchGroup:s};this.backend.capturedCommandList.get(this.backend.currentSessionId).push(h)}c.setPipeline(e.computePipeline),c.setBindGroup(0,u),c.dispatchWorkgroups(...s),this.backend.writeTimestamp(this.backend.pendingDispatchNumber*2+1),this.backend.pendingDispatchNumber++,(this.backend.pendingDispatchNumber>=this.backend.maxDispatchNumber||this.backend.queryType==="at-passes")&&this.backend.endComputePass(),this.backend.pendingDispatchNumber>=this.backend.maxDispatchNumber&&this.backend.flush(),ei(e.programInfo.name)}dispose(){}build(e,t){Si(e.name);let n=this.backend.device,s=[];[{feature:"shader-f16",extension:"f16"},{feature:"subgroups",extension:"subgroups"}].forEach(h=>{n.features.has(h.feature)&&s.push(`enable ${h.extension};`)});let i=cE(t,this.backend.device.limits),o=e.getShaderSource(i),c=`${s.join(`
`)}
${i.additionalImplementations}
${o}`,d=n.createShaderModule({code:c,label:e.name});Pn("verbose",()=>`[WebGPU] ${e.name} shader code: ${c}`);let u=n.createComputePipeline({compute:{module:d,entryPoint:"main"},layout:"auto",label:e.name});return ei(e.name),{programInfo:e,computePipeline:u,uniformVariablesInfo:i.variablesInfo}}normalizeDispatchGroupSize(e){let t=typeof e=="number"?e:e.x,n=typeof e=="number"?1:e.y||1,s=typeof e=="number"?1:e.z||1,i=this.backend.device.limits.maxComputeWorkgroupsPerDimension;if(t<=i&&n<=i&&s<=i)return[t,n,s];let o=t*n*s,c=Math.ceil(Math.sqrt(o));if(c>i){if(c=Math.ceil(Math.cbrt(o)),c>i)throw new Error("Total dispatch size exceeds WebGPU maximum.");return[c,c,c]}else return[c,c,1]}}}),HA={};Ef(HA,{WebGpuBackend:()=>QA});var u1,d1,f1,QA,ND=mt(()=>{Ii(),Xt(),nl(),aE(),Kk(),FD(),zD(),u1=(e,t)=>{if(t.length!==e.length)throw new Error(`inputDependencies length ${t.length} is not equal to inputTensors length ${e.length}.`);let n=[];for(let s=0;s<e.length;++s){let i=e[s].dataType;switch(t[s]){case"none":{n.push("");break}case"type":{n.push(`${i}`);break}case"rank":{let o=e[s].dims.length;n.push(`${i};${o}`);break}case"dims":{let o=e[s].dims.join(",");n.push(`${i};${o}`);break}default:throw new Error(`unsupported input dependency: ${t[s]}`)}}return n.join("|")},d1=(e,t,n)=>{var i,o;let s=e.name;return(i=e.shaderCache)!=null&&i.hint&&(s+="["+e.shaderCache.hint+"]"),s+=":"+n+`:${u1(t,((o=e.shaderCache)==null?void 0:o.inputDependencies)??new Array(t.length).fill("dims"))}`,s},f1=class{constructor(e){e&&(this.architecture=e.architecture,this.vendor=e.vendor)}isArchitecture(e){return this.architecture===e}isVendor(e){return this.vendor===e}},QA=class{constructor(){this.currentSessionId=null,this.currentKernelId=null,this.commandEncoder=null,this.computePassEncoder=null,this.maxDispatchNumber=16,this.pendingDispatchNumber=0,this.pendingKernels=[],this.pendingQueries=new Map,this.sessionStatus="default",this.capturedCommandList=new Map,this.capturedPendingKernels=new Map,this.sessionExternalDataMapping=new Map}get currentKernelCustomData(){if(this.currentKernelId===null)throw new Error("currentKernelCustomData(): currentKernelId is null. (should not happen)");let e=this.kernelCustomData.get(this.currentKernelId);return e||(e={},this.kernelCustomData.set(this.currentKernelId,e)),e}async initialize(e,t){this.env=e;let n=[],s={requiredLimits:{maxComputeWorkgroupStorageSize:t.limits.maxComputeWorkgroupStorageSize,maxComputeWorkgroupsPerDimension:t.limits.maxComputeWorkgroupsPerDimension,maxStorageBufferBindingSize:t.limits.maxStorageBufferBindingSize,maxBufferSize:t.limits.maxBufferSize,maxComputeInvocationsPerWorkgroup:t.limits.maxComputeInvocationsPerWorkgroup,maxComputeWorkgroupSizeX:t.limits.maxComputeWorkgroupSizeX,maxComputeWorkgroupSizeY:t.limits.maxComputeWorkgroupSizeY,maxComputeWorkgroupSizeZ:t.limits.maxComputeWorkgroupSizeZ},requiredFeatures:n},i=o=>t.features.has(o)&&n.push(o)&&!0;i("chromium-experimental-timestamp-query-inside-passes")||i("timestamp-query"),i("shader-f16"),i("subgroups"),this.device=await t.requestDevice(s),this.adapterInfo=new f1(t.info||await t.requestAdapterInfo()),this.gpuDataManager=oE(this),this.programManager=new WA(this),this.kernels=new Map,this.kernelPersistentData=new Map,this.kernelCustomData=new Map,ny(e.logLevel,!!e.debug),this.device.onuncapturederror=o=>{o.error instanceof GPUValidationError&&console.error(`An uncaught WebGPU validation error was raised: ${o.error.message}`)},Object.defineProperty(this.env.webgpu,"device",{value:this.device,writable:!1,enumerable:!0,configurable:!1}),Object.defineProperty(this.env.webgpu,"adapter",{value:t,writable:!1,enumerable:!0,configurable:!1}),this.setQueryType()}dispose(){typeof this.querySet<"u"&&this.querySet.destroy(),this.gpuDataManager.dispose()}getCommandEncoder(){return this.commandEncoder||(this.commandEncoder=this.device.createCommandEncoder()),this.commandEncoder}getComputePassEncoder(){if(!this.computePassEncoder){let e=this.getCommandEncoder(),t={};this.queryType==="at-passes"&&(t.timestampWrites={querySet:this.querySet,beginningOfPassWriteIndex:this.pendingDispatchNumber*2,endOfPassWriteIndex:this.pendingDispatchNumber*2+1}),this.computePassEncoder=e.beginComputePass(t)}return this.computePassEncoder}endComputePass(){this.computePassEncoder&&(this.computePassEncoder.end(),this.computePassEncoder=null)}flush(){if(!this.commandEncoder)return;Si(),this.endComputePass();let e;this.queryType!=="none"&&(this.commandEncoder.resolveQuerySet(this.querySet,0,this.pendingDispatchNumber*2,this.queryResolveBuffer,0),e=this.device.createBuffer({size:this.pendingDispatchNumber*2*8,usage:GPUBufferUsage.MAP_READ|GPUBufferUsage.COPY_DST}),this.pendingQueries.set(e,this.pendingKernels),this.pendingKernels=[],this.commandEncoder.copyBufferToBuffer(this.queryResolveBuffer,0,e,0,this.pendingDispatchNumber*2*8)),this.device.queue.submit([this.commandEncoder.finish()]),this.gpuDataManager.refreshPendingBuffers(),this.commandEncoder=null,this.pendingDispatchNumber=0,this.queryType!=="none"&&e.mapAsync(GPUMapMode.READ).then(()=>{var s;let t=new BigUint64Array(e.getMappedRange()),n=this.pendingQueries.get(e);for(let i=0;i<t.length/2;i++){let o=n[i],c=o.kernelId,d=this.kernels.get(c),u=d.kernelType,h=d.kernelName,g=o.programName,p=o.inputTensorViews,m=o.outputTensorViews,y=t[i*2],v=t[i*2+1];typeof this.queryTimeBase>"u"&&(this.queryTimeBase=y);let T=Number(y-this.queryTimeBase),O=Number(v-this.queryTimeBase);if(!Number.isSafeInteger(T)||!Number.isSafeInteger(O))throw new RangeError("incorrect timestamp range");if((s=this.env.webgpu.profiling)!=null&&s.ondata)this.env.webgpu.profiling.ondata({version:1,inputsMetadata:p.map(E=>({dims:E.dims,dataType:Jo(E.dataType)})),outputsMetadata:m.map(E=>({dims:E.dims,dataType:Jo(E.dataType)})),kernelId:c,kernelType:u,kernelName:h,programName:g,startTime:T,endTime:O});else{let E="";p.forEach((D,I)=>{E+=`input[${I}]: [${D.dims}] | ${Jo(D.dataType)}, `});let S="";m.forEach((D,I)=>{S+=`output[${I}]: [${D.dims}] | ${Jo(D.dataType)}, `}),console.log(`[profiling] kernel "${c}|${u}|${h}|${g}" ${E}${S}execution time: ${O-T} ns`)}pm("GPU",`${g}::${y}::${v}`)}e.unmap(),this.pendingQueries.delete(e)}),ei()}run(e,t,n,s,i,o){Si(e.name);let c=[];for(let S=0;S<t.length;++S){let D=t[S].data;if(D===0)continue;let I=this.gpuDataManager.get(D);if(!I)throw new Error(`no GPU data for input: ${D}`);c.push(I)}let{outputs:d,dispatchGroup:u,programUniforms:h}=e.getRunData(t),g=n.length===0?d.map((S,D)=>D):n;if(g.length!==d.length)throw new Error(`Output size ${g.length} must be equal to ${d.length}.`);let p=[],m=[];for(let S=0;S<d.length;++S){if(!Number.isInteger(g[S])||g[S]<-3||g[S]>=o)throw new Error(`Invalid output index: ${g[S]}`);if(g[S]===-3)continue;let D=g[S]===-1,I=g[S]===-2,M=D||I?i(d[S].dataType,d[S].dims):s(g[S],d[S].dataType,d[S].dims);if(p.push(M),M.data===0)continue;let C=this.gpuDataManager.get(M.data);if(!C)throw new Error(`no GPU data for output: ${M.data}`);if(D&&this.temporaryData.push(C),I){let A=this.kernelPersistentData.get(this.currentKernelId);A||(A=[],this.kernelPersistentData.set(this.currentKernelId,A)),A.push(C)}m.push(C)}if(c.length!==t.length||m.length!==p.length){if(m.length===0)return ei(e.name),p;throw new Error(`Program ${e.name} has zero-sized tensor(s) in inputs or outputs. This is not supported now.`)}let y;if(h){let S=0,D=[];h.forEach(A=>{let k=typeof A.data=="number"?[A.data]:A.data;if(k.length===0)return;let R=A.type===10?2:4,G,te;A.type===10?(te=k.length>4?16:k.length>2?8:k.length*R,G=k.length>4?16:R*k.length):(te=k.length<=2?k.length*R:16,G=16),S=Math.ceil(S/te)*te,D.push(S);let ee=A.type===10?8:4;S+=k.length>4?Math.ceil(k.length/ee)*G:k.length*R});let I=16;S=Math.ceil(S/I)*I;let M=new ArrayBuffer(S);h.forEach((A,k)=>{let R=D[k],G=typeof A.data=="number"?[A.data]:A.data;if(A.type===6)new Int32Array(M,R,G.length).set(G);else if(A.type===12)new Uint32Array(M,R,G.length).set(G);else if(A.type===10)new Uint16Array(M,R,G.length).set(G);else if(A.type===1)new Float32Array(M,R,G.length).set(G);else throw new Error(`Unsupported uniform type: ${Jo(A.type)}`)});let C=this.gpuDataManager.create(S,GPUBufferUsage.COPY_DST|GPUBufferUsage.UNIFORM);this.device.queue.writeBuffer(C.buffer,0,M,0,S),this.gpuDataManager.release(C.id),y={offset:0,size:S,buffer:C.buffer}}let v=this.programManager.normalizeDispatchGroupSize(u),T=v[1]===1&&v[2]===1,O=d1(e,t,T),E=this.programManager.getArtifact(O);if(E||(E=this.programManager.build(e,v),this.programManager.setArtifact(O,E),Pn("info",()=>`[artifact] key: ${O}, programName: ${e.name}`)),h&&E.uniformVariablesInfo){if(h.length!==E.uniformVariablesInfo.length)throw new Error(`Uniform variables count mismatch: expect ${E.uniformVariablesInfo.length}, got ${h.length} in program "${E.programInfo.name}".`);for(let S=0;S<h.length;S++){let D=h[S],I=D.type,M=typeof D.data=="number"?1:D.data.length,[C,A]=E.uniformVariablesInfo[S];if(I!==C||M!==A)throw new Error(`Uniform variable ${S} mismatch: expect type ${C} with size ${A}, got type ${I} with size ${M} in program "${E.programInfo.name}".`)}}if(Pn("info",()=>`[ProgramManager] run "${e.name}" (key=${O}) with ${v[0]}x${v[1]}x${v[2]}`),this.queryType!=="none"||this.sessionStatus==="capturing"){let S={kernelId:this.currentKernelId,programName:E.programInfo.name,inputTensorViews:t,outputTensorViews:p};this.pendingKernels.push(S),this.sessionStatus==="capturing"&&this.capturedPendingKernels.get(this.currentSessionId).push(S)}return this.programManager.run(E,c,m,v,y),ei(e.name),p}upload(e,t){this.gpuDataManager.upload(e,t)}memcpy(e,t){this.gpuDataManager.memcpy(e,t)}async download(e,t){await this.gpuDataManager.download(e,t)}alloc(e){return this.gpuDataManager.create(e).id}free(e){return this.gpuDataManager.release(e)}createKernel(e,t,n,s){let i=GA.get(e);if(!i)throw new Error(`kernel not implemented: ${e}`);let o={kernelType:e,kernelName:s,kernelEntry:i[0],attributes:[i[1],n]};this.kernels.set(t,o)}releaseKernel(e){let t=this.kernelPersistentData.get(e);if(t){for(let n of t)this.gpuDataManager.release(n.id);this.kernelPersistentData.delete(e)}this.kernelCustomData.delete(e),this.kernels.delete(e)}computeKernel(e,t,n){let s=this.kernels.get(e);if(!s)throw new Error(`kernel not created: ${e}`);let i=s.kernelType,o=s.kernelName,c=s.kernelEntry,d=s.attributes;if(this.currentKernelId!==null)throw new Error(`kernel "[${i}] ${o}" is not allowed to be called recursively`);this.currentKernelId=e,d[0]&&(d[1]=d[0](d[1]),d[0]=void 0),Pn("info",()=>`[WebGPU] Start to run kernel "[${i}] ${o}"...`);let u=this.env.debug;this.temporaryData=[];try{return u&&this.device.pushErrorScope("validation"),c(t,d[1]),0}catch(h){return n.push(Promise.resolve(`[WebGPU] Kernel "[${i}] ${o}" failed. ${h}`)),1}finally{u&&n.push(this.device.popErrorScope().then(h=>h?`GPU validation error for kernel "[${i}] ${o}": ${h.message}`:null));for(let h of this.temporaryData)this.gpuDataManager.release(h.id);this.temporaryData=[],this.currentKernelId=null}}registerBuffer(e,t,n,s){let i=this.sessionExternalDataMapping.get(e);i||(i=new Map,this.sessionExternalDataMapping.set(e,i));let o=i.get(t),c=this.gpuDataManager.registerExternalBuffer(n,s,o);return i.set(t,[c,n]),c}unregisterBuffers(e){let t=this.sessionExternalDataMapping.get(e);t&&(t.forEach(n=>this.gpuDataManager.unregisterExternalBuffer(n[0])),this.sessionExternalDataMapping.delete(e))}getBuffer(e){let t=this.gpuDataManager.get(e);if(!t)throw new Error(`no GPU data for buffer: ${e}`);return t.buffer}createDownloader(e,t,n){return async()=>{let s=await gv(this,e,t);return ry(s.buffer,n)}}writeTimestamp(e){this.queryType==="inside-passes"&&this.computePassEncoder.writeTimestamp(this.querySet,e)}setQueryType(){var e;this.queryType="none",(((e=this.env.webgpu.profiling)==null?void 0:e.mode)==="default"||(typeof this.env.trace>"u"?this.env.wasm.trace:this.env.trace))&&(this.device.features.has("chromium-experimental-timestamp-query-inside-passes")?this.queryType="inside-passes":this.device.features.has("timestamp-query")&&(this.queryType="at-passes"),this.queryType!=="none"&&typeof this.querySet>"u"&&(this.querySet=this.device.createQuerySet({type:"timestamp",count:this.maxDispatchNumber*2}),this.queryResolveBuffer=this.device.createBuffer({size:this.maxDispatchNumber*2*8,usage:GPUBufferUsage.COPY_SRC|GPUBufferUsage.QUERY_RESOLVE})))}captureBegin(){Pn("info","captureBegin"),this.capturedCommandList.get(this.currentSessionId)||this.capturedCommandList.set(this.currentSessionId,[]),this.capturedPendingKernels.get(this.currentSessionId)||this.capturedPendingKernels.set(this.currentSessionId,[]),this.flush(),this.sessionStatus="capturing"}captureEnd(){Pn("info","captureEnd"),this.flush(),this.sessionStatus="default"}replay(){Pn("info","replay"),this.sessionStatus="replaying";let e=this.capturedCommandList.get(this.currentSessionId),t=this.capturedPendingKernels.get(this.currentSessionId),n=e.length;this.pendingKernels=[];for(let s=0;s<n;s++){let i=this.getComputePassEncoder(),o=e[s];this.writeTimestamp(this.pendingDispatchNumber*2),i.setPipeline(o.computePipeline),i.setBindGroup(0,o.bindGroup),i.dispatchWorkgroups(...o.dispatchGroup),this.writeTimestamp(this.pendingDispatchNumber*2+1),this.pendingDispatchNumber++,this.queryType!=="none"&&this.pendingKernels.push(t[s]),(this.pendingDispatchNumber>=this.maxDispatchNumber||this.queryType==="at-passes")&&this.endComputePass(),this.pendingDispatchNumber>=this.maxDispatchNumber&&this.flush()}this.flush(),this.sessionStatus="default"}onCreateSession(){this.gpuDataManager.onCreateSession()}onReleaseSession(e){this.unregisterBuffers(e),this.capturedCommandList.has(e)&&this.capturedCommandList.delete(e),this.capturedPendingKernels.has(e)&&this.capturedPendingKernels.delete(e),this.gpuDataManager.onReleaseSession(e)}onRunStart(e){this.currentSessionId=e,this.setQueryType()}}}),qA={};Ef(qA,{init:()=>KA});var Cg,h1,KA,RD=mt(()=>{Xt(),nl(),sn(),qk(),Cg=class XA{constructor(t,n,s,i){this.module=t,this.dataType=n,this.data=s,this.dims=i}getFloat32Array(){if(this.dataType!==1)throw new Error("Invalid data type");let t=Ge.size(this.dims);return t===0?new Float32Array:new Float32Array(this.module.HEAP8.buffer,this.data,t)}getBigInt64Array(){if(this.dataType!==7)throw new Error("Invalid data type");let t=Ge.size(this.dims);return t===0?new BigInt64Array:new BigInt64Array(this.module.HEAP8.buffer,this.data,t)}getInt32Array(){if(this.dataType!==6)throw new Error("Invalid data type");let t=Ge.size(this.dims);return t===0?new Int32Array:new Int32Array(this.module.HEAP8.buffer,this.data,t)}getUint16Array(){if(this.dataType!==10&&this.dataType!==4)throw new Error("Invalid data type");let t=Ge.size(this.dims);return t===0?new Uint16Array:new Uint16Array(this.module.HEAP8.buffer,this.data,t)}reshape(t){if(Ge.size(t)!==Ge.size(this.dims))throw new Error("Invalid new shape");return new XA(this.module,this.dataType,this.data,t)}},h1=class{constructor(e,t,n){this.module=e,this.backend=t,this.customDataOffset=0,this.customDataSize=0,this.adapterInfo=t.adapterInfo;let s=e.PTR_SIZE,i=n/e.PTR_SIZE,o=s===4?"i32":"i64";this.opKernelContext=Number(e.getValue(s*i++,o));let c=Number(e.getValue(s*i++,o));this.outputCount=Number(e.getValue(s*i++,o)),this.customDataOffset=Number(e.getValue(s*i++,"*")),this.customDataSize=Number(e.getValue(s*i++,o));let d=[];for(let u=0;u<c;u++){let h=Number(e.getValue(s*i++,o)),g=Number(e.getValue(s*i++,"*")),p=Number(e.getValue(s*i++,o)),m=[];for(let y=0;y<p;y++)m.push(Number(e.getValue(s*i++,o)));d.push(new Cg(e,h,g,m))}this.inputs=d}get kernelCustomData(){return this.backend.currentKernelCustomData}get customDataBuffer(){return this.module.HEAPU8.subarray(this.customDataOffset,this.customDataOffset+this.customDataSize)}compute(e,t){var c;let n=((c=t==null?void 0:t.inputs)==null?void 0:c.map(d=>typeof d=="number"?this.inputs[d]:d))??this.inputs,s=(t==null?void 0:t.outputs)??[],i=(d,u,h)=>new Cg(this.module,u,this.output(d,h),h),o=(d,u)=>{let h=_u(d,u);if(!h)throw new Error(`Unsupported data type: ${d}`);let g=h>0?this.backend.gpuDataManager.create(h).id:0;return new Cg(this.module,d,g,u)};return this.backend.run(e,n,s,i,o,this.outputCount)}output(e,t){let n=this.module.stackSave();try{let s=this.module.PTR_SIZE,i=s===4?"i32":"i64",o=this.module.stackAlloc((1+t.length)*s);this.module.setValue(o,t.length,i);for(let c=0;c<t.length;c++)this.module.setValue(o+s*(c+1),t[c],i);return this.module._JsepOutput(this.opKernelContext,e,o)}catch(s){throw new Error(`Failed to generate kernel's output[${e}] with dims [${t}]. If you are running with pre-allocated output, please make sure the output type/dims are correct. Error: ${s}`)}finally{this.module.stackRestore(n)}}},KA=async(e,t,n,s)=>{let i=t.jsepInit;if(!i)throw new Error("Failed to initialize JSEP. The WebAssembly module is not built with JSEP support.");if(e==="webgpu"){let o=(ND(),hm(HA)).WebGpuBackend,c=new o;await c.initialize(n,s),i("webgpu",[c,d=>c.alloc(Number(d)),d=>c.free(d),(d,u,h,g=!1)=>{if(g)Pn("verbose",()=>`[WebGPU] jsepCopyGpuToGpu: src=${Number(d)}, dst=${Number(u)}, size=${Number(h)}`),c.memcpy(Number(d),Number(u));else{Pn("verbose",()=>`[WebGPU] jsepCopyCpuToGpu: dataOffset=${Number(d)}, gpuDataId=${Number(u)}, size=${Number(h)}`);let p=t.HEAPU8.subarray(Number(d>>>0),Number(d>>>0)+Number(h));c.upload(Number(u),p)}},async(d,u,h)=>{Pn("verbose",()=>`[WebGPU] jsepCopyGpuToCpu: gpuDataId=${d}, dataOffset=${u}, size=${h}`),await c.download(Number(d),()=>t.HEAPU8.subarray(Number(u)>>>0,Number(u+h)>>>0))},(d,u,h)=>c.createKernel(d,Number(u),h,t.UTF8ToString(t._JsepGetNodeName(Number(u)))),d=>c.releaseKernel(d),(d,u,h,g)=>{Pn("verbose",()=>`[WebGPU] jsepRun: sessionHandle=${h}, kernel=${d}, contextDataOffset=${u}`);let p=new h1(t,c,Number(u));return c.computeKernel(Number(d),p,g)},()=>c.captureBegin(),()=>c.captureEnd(),()=>c.replay()])}else{let o=new iE(n);i("webnn",[o,()=>o.reserveTensorId(),c=>o.releaseTensorId(c),async(c,d,u,h,g)=>o.ensureTensor(c,d,u,h,g),(c,d)=>{o.uploadTensor(c,d)},async(c,d)=>o.downloadTensor(c,d)])}}}),p1,py,my,sc,m1,U0,s_,gy,_y,V0,vy,yy,by,YA=mt(()=>{Wk(),Hk(),Xt(),Au(),Yv(),eE(),p1=(e,t)=>{pr()._OrtInit(e,t)!==0&&Xn("Can't initialize onnxruntime.")},py=async e=>{p1(e.wasm.numThreads,e_(e.logLevel))},my=async(e,t)=>{var n,s;(s=(n=pr()).asyncInit)==null||s.call(n);{let i=(RD(),hm(qA)).init;if(t==="webgpu"){if(typeof navigator>"u"||!navigator.gpu)throw new Error("WebGPU is not supported in current environment");let o=e.webgpu.adapter;if(o){if(typeof o.limits!="object"||typeof o.features!="object"||typeof o.requestDevice!="function")throw new Error("Invalid GPU adapter set in `env.webgpu.adapter`. It must be a GPUAdapter object.")}else{let c=e.webgpu.powerPreference;if(c!==void 0&&c!=="low-power"&&c!=="high-performance")throw new Error(`Invalid powerPreference setting: "${c}"`);let d=e.webgpu.forceFallbackAdapter;if(d!==void 0&&typeof d!="boolean")throw new Error(`Invalid forceFallbackAdapter setting: "${d}"`);if(o=await navigator.gpu.requestAdapter({powerPreference:c,forceFallbackAdapter:d}),!o)throw new Error('Failed to get GPU adapter. You may need to enable flag "--enable-unsafe-webgpu" if you are using Chrome.')}await i("webgpu",pr(),e,o)}if(t==="webnn"){if(typeof navigator>"u"||!navigator.ml)throw new Error("WebNN is not supported in current environment");await i("webnn",pr(),e)}}},sc=new Map,m1=e=>{let t=pr(),n=t.stackSave();try{let s=t.PTR_SIZE,i=t.stackAlloc(2*s);t._OrtGetInputOutputCount(e,i,i+s)!==0&&Xn("Can't get session input/output count.");let o=s===4?"i32":"i64";return[Number(t.getValue(i,o)),Number(t.getValue(i+s,o))]}finally{t.stackRestore(n)}},U0=(e,t)=>{let n=pr(),s=n.stackSave(),i=0;try{let o=n.PTR_SIZE,c=n.stackAlloc(2*o);n._OrtGetInputOutputMetadata(e,t,c,c+o)!==0&&Xn("Can't get session input/output metadata.");let d=Number(n.getValue(c,"*"));i=Number(n.getValue(c+o,"*"));let u=n.HEAP32[i/4];if(u===0)return[d,0];let h=n.HEAPU32[i/4+1],g=[];for(let p=0;p<h;p++){let m=Number(n.getValue(i+8+p*o,"*"));g.push(m!==0?n.UTF8ToString(m):Number(n.getValue(i+8+(p+h)*o,"*")))}return[d,u,g]}finally{n.stackRestore(s),i!==0&&n._OrtFree(i)}},s_=e=>{let t=pr(),n=t._malloc(e.byteLength);if(n===0)throw new Error(`Can't create a session. failed to allocate a buffer of size ${e.byteLength}.`);return t.HEAPU8.set(e,n),[n,e.byteLength]},gy=async(e,t)=>{var p,m,y,v;let n,s,i=pr();Array.isArray(e)?[n,s]=e:e.buffer===i.HEAPU8.buffer?[n,s]=[e.byteOffset,e.byteLength]:[n,s]=s_(e);let o=0,c=0,d=0,u=[],h=[],g=[];try{if([c,u]=await Z2(t),(t==null?void 0:t.externalData)&&i.mountExternalData){let k=[];for(let R of t.externalData){let G=typeof R=="string"?R:R.path;k.push(ty(typeof R=="string"?R:R.data).then(te=>{i.mountExternalData(G,te)}))}await Promise.all(k)}for(let k of(t==null?void 0:t.executionProviders)??[])if((typeof k=="string"?k:k.name)==="webnn"){if(i.shouldTransferToMLTensor=!1,typeof k!="string"){let R=k,G=R==null?void 0:R.context,te=R==null?void 0:R.gpuDevice,ee=R==null?void 0:R.deviceType,X=R==null?void 0:R.powerPreference;G?i.currentContext=G:te?i.currentContext=await i.webnnCreateMLContext(te):i.currentContext=await i.webnnCreateMLContext({deviceType:ee,powerPreference:X})}else i.currentContext=await i.webnnCreateMLContext();break}o=await i._OrtCreateSession(n,s,c),(p=i.webgpuOnCreateSession)==null||p.call(i,o),o===0&&Xn("Can't create a session."),(m=i.jsepOnCreateSession)==null||m.call(i),i.currentContext&&(i.webnnRegisterMLContext(o,i.currentContext),i.currentContext=void 0,i.shouldTransferToMLTensor=!0);let[T,O]=m1(o),E=!!(t!=null&&t.enableGraphCapture),S=[],D=[],I=[],M=[],C=[];for(let k=0;k<T;k++){let[R,G,te]=U0(o,k);R===0&&Xn("Can't get an input name."),h.push(R);let ee=i.UTF8ToString(R);S.push(ee),I.push(G===0?{name:ee,isTensor:!1}:{name:ee,isTensor:!0,type:Jo(G),shape:te})}for(let k=0;k<O;k++){let[R,G,te]=U0(o,k+T);R===0&&Xn("Can't get an output name."),g.push(R);let ee=i.UTF8ToString(R);D.push(ee),M.push(G===0?{name:ee,isTensor:!1}:{name:ee,isTensor:!0,type:Jo(G),shape:te});{if(E&&(t==null?void 0:t.preferredOutputLocation)===void 0){C.push("gpu-buffer");continue}let X=typeof(t==null?void 0:t.preferredOutputLocation)=="string"?t.preferredOutputLocation:((y=t==null?void 0:t.preferredOutputLocation)==null?void 0:y[ee])??"cpu";if(X!=="cpu"&&X!=="cpu-pinned"&&X!=="gpu-buffer"&&X!=="ml-tensor")throw new Error(`Not supported preferred output location: ${X}.`);if(E&&X!=="gpu-buffer")throw new Error(`Not supported preferred output location: ${X}. Only 'gpu-buffer' location is supported when enableGraphCapture is true.`);C.push(X)}}let A=null;return C.some(k=>k==="gpu-buffer"||k==="ml-tensor")&&(d=i._OrtCreateBinding(o),d===0&&Xn("Can't create IO binding."),A={handle:d,outputPreferredLocations:C,outputPreferredLocationsEncoded:C.map(k=>pv(k))}),sc.set(o,[o,h,g,A,E,!1]),[o,S,D,I,M]}catch(T){throw h.forEach(O=>i._OrtFree(O)),g.forEach(O=>i._OrtFree(O)),d!==0&&i._OrtReleaseBinding(d)!==0&&Xn("Can't release IO binding."),o!==0&&i._OrtReleaseSession(o)!==0&&Xn("Can't release session."),T}finally{i._free(n),c!==0&&i._OrtReleaseSessionOptions(c)!==0&&Xn("Can't release session options."),u.forEach(T=>i._free(T)),(v=i.unmountExternalData)==null||v.call(i)}},_y=e=>{var u,h,g;let t=pr(),n=sc.get(e);if(!n)throw new Error(`cannot release session. invalid session id: ${e}`);let[s,i,o,c,d]=n;c&&(d&&t._OrtClearBoundOutputs(c.handle)!==0&&Xn("Can't clear bound outputs."),t._OrtReleaseBinding(c.handle)!==0&&Xn("Can't release IO binding.")),(u=t.jsepOnReleaseSession)==null||u.call(t,e),(h=t.webnnOnReleaseSession)==null||h.call(t,e),(g=t.webgpuOnReleaseSession)==null||g.call(t,e),i.forEach(p=>t._OrtFree(p)),o.forEach(p=>t._OrtFree(p)),t._OrtReleaseSession(s)!==0&&Xn("Can't release session."),sc.delete(e)},V0=async(e,t,n,s,i,o,c=!1)=>{if(!e){t.push(0);return}let d=pr(),u=d.PTR_SIZE,h=e[0],g=e[1],p=e[3],m=p,y,v;if(h==="string"&&(p==="gpu-buffer"||p==="ml-tensor"))throw new Error("String tensor is not supported on GPU.");if(c&&p!=="gpu-buffer")throw new Error(`External buffer must be provided for input/output index ${o} when enableGraphCapture is true.`);if(p==="gpu-buffer"){let E=e[2].gpuBuffer;v=_u(pf(h),g);{let S=d.jsepRegisterBuffer;if(!S)throw new Error('Tensor location "gpu-buffer" is not supported without using WebGPU.');y=S(s,o,E,v)}}else if(p==="ml-tensor"){let E=e[2].mlTensor;v=_u(pf(h),g);let S=d.webnnRegisterMLTensor;if(!S)throw new Error('Tensor location "ml-tensor" is not supported without using WebNN.');y=S(s,E,pf(h),g)}else{let E=e[2];if(Array.isArray(E)){v=u*E.length,y=d._malloc(v),n.push(y);for(let S=0;S<E.length;S++){if(typeof E[S]!="string")throw new TypeError(`tensor data at index ${S} is not a string`);d.setValue(y+S*u,Ai(E[S],n),"*")}}else{let S=d.webnnIsGraphInput;if(h!=="string"&&S){let D=d.UTF8ToString(i);if(S(s,D)){let I=pf(h);v=_u(I,g),m="ml-tensor";let M=d.webnnCreateTemporaryTensor,C=d.webnnUploadTensor;if(!M||!C)throw new Error('Tensor location "ml-tensor" is not supported without using WebNN.');let A=await M(s,I,g);C(A,new Uint8Array(E.buffer,E.byteOffset,E.byteLength)),y=A}else v=E.byteLength,y=d._malloc(v),n.push(y),d.HEAPU8.set(new Uint8Array(E.buffer,E.byteOffset,v),y)}else v=E.byteLength,y=d._malloc(v),n.push(y),d.HEAPU8.set(new Uint8Array(E.buffer,E.byteOffset,v),y)}}let T=d.stackSave(),O=d.stackAlloc(4*g.length);try{g.forEach((S,D)=>d.setValue(O+D*u,S,u===4?"i32":"i64"));let E=d._OrtCreateTensor(pf(h),y,v,O,g.length,pv(m));E===0&&Xn(`Can't create tensor for input/output. session=${s}, index=${o}.`),t.push(E)}finally{d.stackRestore(T)}},vy=async(e,t,n,s,i,o)=>{var te,ee,X,le;let c=pr(),d=c.PTR_SIZE,u=sc.get(e);if(!u)throw new Error(`cannot run inference. invalid session id: ${e}`);let h=u[0],g=u[1],p=u[2],m=u[3],y=u[4],v=u[5],T=t.length,O=s.length,E=0,S=[],D=[],I=[],M=[],C=c.stackSave(),A=c.stackAlloc(T*d),k=c.stackAlloc(T*d),R=c.stackAlloc(O*d),G=c.stackAlloc(O*d);try{[E,S]=J2(o);for(let ne=0;ne<T;ne++)await V0(n[ne],D,M,e,g[t[ne]],t[ne],y);for(let ne=0;ne<O;ne++)await V0(i[ne],I,M,e,p[s[ne]],T+s[ne],y);for(let ne=0;ne<T;ne++)c.setValue(A+ne*d,D[ne],"*"),c.setValue(k+ne*d,g[t[ne]],"*");for(let ne=0;ne<O;ne++)c.setValue(R+ne*d,I[ne],"*"),c.setValue(G+ne*d,p[s[ne]],"*");if(m&&!v){let{handle:ne,outputPreferredLocations:de,outputPreferredLocationsEncoded:ve}=m;if(g.length!==T)throw new Error(`input count from feeds (${T}) is expected to be always equal to model's input count (${g.length}).`);for(let fe=0;fe<T;fe++){let j=t[fe];await c._OrtBindInput(ne,g[j],D[fe])!==0&&Xn(`Can't bind input[${fe}] for session=${e}.`)}for(let fe=0;fe<O;fe++){let j=s[fe];(te=i[fe])!=null&&te[3]?c._OrtBindOutput(ne,p[j],I[fe],0)!==0&&Xn(`Can't bind pre-allocated output[${fe}] for session=${e}.`):c._OrtBindOutput(ne,p[j],0,ve[j])!==0&&Xn(`Can't bind output[${fe}] to ${de[fe]} for session=${e}.`)}sc.set(e,[h,g,p,m,y,!0])}(ee=c.jsepOnRunStart)==null||ee.call(c,h),(X=c.webnnOnRunStart)==null||X.call(c,h);let ae;m?ae=await c._OrtRunWithBinding(h,m.handle,O,R,E):ae=await c._OrtRun(h,k,A,T,G,O,R,E),ae!==0&&Xn("failed to call OrtRun().");let Q=[];for(let ne=0;ne<O;ne++){let de=Number(c.getValue(R+ne*d,"*"));if(de===I[ne]){Q.push(i[ne]);continue}let ve=c.stackSave(),fe=c.stackAlloc(4*d),j=!1,U,N=0;try{c._OrtGetTensorData(de,fe,fe+d,fe+2*d,fe+3*d)!==0&&Xn(`Can't access output tensor data on index ${ne}.`);let q=d===4?"i32":"i64",ce=Number(c.getValue(fe,q));N=c.getValue(fe+d,"*");let Z=c.getValue(fe+d*2,"*"),Me=Number(c.getValue(fe+d*3,q)),Pe=[];for(let he=0;he<Me;he++)Pe.push(Number(c.getValue(Z+he*d,q)));c._OrtFree(Z)!==0&&Xn("Can't free memory for tensor dims.");let Ne=Pe.reduce((he,H)=>he*H,1);U=Jo(ce);let Oe=m==null?void 0:m.outputPreferredLocations[s[ne]];if(U==="string"){if(Oe==="gpu-buffer"||Oe==="ml-tensor")throw new Error("String tensor is not supported on GPU.");let he=[];for(let H=0;H<Ne;H++){let Te=c.getValue(N+H*d,"*"),ze=c.getValue(N+(H+1)*d,"*"),Re=H===Ne-1?void 0:ze-Te;he.push(c.UTF8ToString(Te,Re))}Q.push([U,Pe,he,"cpu"])}else if(Oe==="gpu-buffer"&&Ne>0){let he=c.jsepGetBuffer;if(!he)throw new Error('preferredLocation "gpu-buffer" is not supported without using WebGPU.');let H=he(N),Te=_u(ce,Ne);if(Te===void 0||!Zv(U))throw new Error(`Unsupported data type: ${U}`);j=!0,Q.push([U,Pe,{gpuBuffer:H,download:c.jsepCreateDownloader(H,Te,U),dispose:()=>{c._OrtReleaseTensor(de)!==0&&Xn("Can't release tensor.")}},"gpu-buffer"])}else if(Oe==="ml-tensor"&&Ne>0){let he=c.webnnEnsureTensor,H=c.webnnIsInt64Supported;if(!he||!H)throw new Error('preferredLocation "ml-tensor" is not supported without using WebNN.');if(_u(ce,Ne)===void 0||!ey(U))throw new Error(`Unsupported data type: ${U}`);if(U==="int64"&&!H(e))throw new Error('preferredLocation "ml-tensor" for int64 output is not supported by current WebNN Context.');let Te=await he(e,N,ce,Pe,!1);j=!0,Q.push([U,Pe,{mlTensor:Te,download:c.webnnCreateMLTensorDownloader(N,U),dispose:()=>{c.webnnReleaseTensorId(N),c._OrtReleaseTensor(de)}},"ml-tensor"])}else{let he=Jv(U),H=new he(Ne);new Uint8Array(H.buffer,H.byteOffset,H.byteLength).set(c.HEAPU8.subarray(N,N+H.byteLength)),Q.push([U,Pe,H,"cpu"])}}finally{c.stackRestore(ve),U==="string"&&N&&c._free(N),j||c._OrtReleaseTensor(de),(le=c.webnnOnRunEnd)==null||le.call(c,h)}}return m&&!y&&(c._OrtClearBoundOutputs(m.handle)!==0&&Xn("Can't clear bound outputs."),sc.set(e,[h,g,p,m,y,!1])),Q}finally{c.stackRestore(C),D.forEach(ae=>c._OrtReleaseTensor(ae)),I.forEach(ae=>c._OrtReleaseTensor(ae)),M.forEach(ae=>c._free(ae)),E!==0&&c._OrtReleaseRunOptions(E),S.forEach(ae=>c._free(ae))}},yy=e=>{let t=pr(),n=sc.get(e);if(!n)throw new Error("invalid session id");let s=n[0],i=t._OrtEndProfiling(s);i===0&&Xn("Can't get an profile file name."),t._OrtFree(i)},by=e=>{let t=[];for(let n of e){let s=n[2];!Array.isArray(s)&&"buffer"in s&&t.push(s.buffer)}return t}}),ic,cs,ff,em,tm,Sg,G0,Ig,hu,pu,g1,JA,ZA,eC,tC,nC,rC,aC,sC=mt(()=>{Ii(),YA(),Au(),Kv(),ic=()=>!!br.wasm.proxy&&typeof document<"u",ff=!1,em=!1,tm=!1,Ig=new Map,hu=(e,t)=>{let n=Ig.get(e);n?n.push(t):Ig.set(e,[t])},pu=()=>{if(ff||!em||tm||!cs)throw new Error("worker not ready")},g1=e=>{switch(e.data.type){case"init-wasm":ff=!1,e.data.err?(tm=!0,G0[1](e.data.err)):(em=!0,G0[0]()),Sg&&(URL.revokeObjectURL(Sg),Sg=void 0);break;case"init-ep":case"copy-from":case"create":case"release":case"run":case"end-profiling":{let t=Ig.get(e.data.type);e.data.err?t.shift()[1](e.data.err):t.shift()[0](e.data.out);break}}},JA=async()=>{if(!em){if(ff)throw new Error("multiple calls to 'initWasm()' detected.");if(tm)throw new Error("previous call to 'initWasm()' failed.");if(ff=!0,ic())return new Promise((e,t)=>{cs==null||cs.terminate(),X2().then(([n,s])=>{try{cs=s,cs.onerror=o=>t(o),cs.onmessage=g1,G0=[e,t];let i={type:"init-wasm",in:br};!i.in.wasm.wasmPaths&&(n||hv)&&(i.in.wasm.wasmPaths={wasm:new URL(""+new URL("ort-wasm-simd-threaded.jsep-B0T3yYHD.wasm",import.meta.url).href,import.meta.url).href}),cs.postMessage(i),Sg=n}catch(i){t(i)}},t)});try{await Xv(br.wasm),await py(br),em=!0}catch(e){throw tm=!0,e}finally{ff=!1}}},ZA=async e=>{if(ic())return pu(),new Promise((t,n)=>{hu("init-ep",[t,n]);let s={type:"init-ep",in:{epName:e,env:br}};cs.postMessage(s)});await my(br,e)},eC=async e=>ic()?(pu(),new Promise((t,n)=>{hu("copy-from",[t,n]);let s={type:"copy-from",in:{buffer:e}};cs.postMessage(s,[e.buffer])})):s_(e),tC=async(e,t)=>{if(ic()){if(t!=null&&t.preferredOutputLocation)throw new Error('session option "preferredOutputLocation" is not supported for proxy.');return pu(),new Promise((n,s)=>{hu("create",[n,s]);let i={type:"create",in:{model:e,options:{...t}}},o=[];e instanceof Uint8Array&&o.push(e.buffer),cs.postMessage(i,o)})}else return gy(e,t)},nC=async e=>{if(ic())return pu(),new Promise((t,n)=>{hu("release",[t,n]);let s={type:"release",in:e};cs.postMessage(s)});_y(e)},rC=async(e,t,n,s,i,o)=>{if(ic()){if(n.some(c=>c[3]!=="cpu"))throw new Error("input tensor on GPU is not supported for proxy.");if(i.some(c=>c))throw new Error("pre-allocated output tensor is not supported for proxy.");return pu(),new Promise((c,d)=>{hu("run",[c,d]);let u=n,h={type:"run",in:{sessionId:e,inputIndices:t,inputs:u,outputIndices:s,options:o}};cs.postMessage(h,by(u))})}else return vy(e,t,n,s,i,o)},aC=async e=>{if(ic())return pu(),new Promise((t,n)=>{hu("end-profiling",[t,n]);let s={type:"end-profiling",in:e};cs.postMessage(s)});yy(e)}}),W0,_1,iC,jD=mt(()=>{Ii(),sC(),Xt(),qv(),eE(),W0=(e,t)=>{switch(e.location){case"cpu":return[e.type,e.dims,e.data,"cpu"];case"gpu-buffer":return[e.type,e.dims,{gpuBuffer:e.gpuBuffer},"gpu-buffer"];case"ml-tensor":return[e.type,e.dims,{mlTensor:e.mlTensor},"ml-tensor"];default:throw new Error(`invalid data location: ${e.location} for ${t()}`)}},_1=e=>{switch(e[3]){case"cpu":return new Ci(e[0],e[2],e[1]);case"gpu-buffer":{let t=e[0];if(!Zv(t))throw new Error(`not supported data type: ${t} for deserializing GPU tensor`);let{gpuBuffer:n,download:s,dispose:i}=e[2];return Ci.fromGpuBuffer(n,{dataType:t,dims:e[1],download:s,dispose:i})}case"ml-tensor":{let t=e[0];if(!ey(t))throw new Error(`not supported data type: ${t} for deserializing MLTensor tensor`);let{mlTensor:n,download:s,dispose:i}=e[2];return Ci.fromMLTensor(n,{dataType:t,dims:e[1],download:s,dispose:i})}default:throw new Error(`invalid data location: ${e[3]}`)}},iC=class{async fetchModelAndCopyToWasmMemory(e){return eC(await ty(e))}async loadModel(e,t){Si();let n;typeof e=="string"?n=await this.fetchModelAndCopyToWasmMemory(e):n=e,[this.sessionId,this.inputNames,this.outputNames,this.inputMetadata,this.outputMetadata]=await tC(n,t),ei()}async dispose(){return nC(this.sessionId)}async run(e,t,n){Si();let s=[],i=[];Object.entries(e).forEach(p=>{let m=p[0],y=p[1],v=this.inputNames.indexOf(m);if(v===-1)throw new Error(`invalid input '${m}'`);s.push(y),i.push(v)});let o=[],c=[];Object.entries(t).forEach(p=>{let m=p[0],y=p[1],v=this.outputNames.indexOf(m);if(v===-1)throw new Error(`invalid output '${m}'`);o.push(y),c.push(v)});let d=s.map((p,m)=>W0(p,()=>`input "${this.inputNames[i[m]]}"`)),u=o.map((p,m)=>p?W0(p,()=>`output "${this.outputNames[c[m]]}"`):null),h=await rC(this.sessionId,i,d,c,u,n),g={};for(let p=0;p<h.length;p++)g[this.outputNames[c[p]]]=o[p]??_1(h[p]);return ei(),g}startProfiling(){}endProfiling(){aC(this.sessionId)}}}),oC={};Ef(oC,{OnnxruntimeWebAssemblyBackend:()=>Sv,initializeFlags:()=>Cv,wasmBackend:()=>lC});var Cv,Sv,lC,UD=mt(()=>{Ii(),sC(),jD(),Cv=()=>{(typeof br.wasm.initTimeout!="number"||br.wasm.initTimeout<0)&&(br.wasm.initTimeout=0);let e=br.wasm.simd;if(typeof e!="boolean"&&e!==void 0&&e!=="fixed"&&e!=="relaxed"&&(console.warn(`Property "env.wasm.simd" is set to unknown value "${e}". Reset it to \`false\` and ignore SIMD feature checking.`),br.wasm.simd=!1),typeof br.wasm.proxy!="boolean"&&(br.wasm.proxy=!1),typeof br.wasm.trace!="boolean"&&(br.wasm.trace=!1),typeof br.wasm.numThreads!="number"||!Number.isInteger(br.wasm.numThreads)||br.wasm.numThreads<=0)if(typeof self<"u"&&!self.crossOriginIsolated)br.wasm.numThreads=1;else{let t=typeof navigator>"u"?Sk("node:os").cpus().length:navigator.hardwareConcurrency;br.wasm.numThreads=Math.min(4,Math.ceil((t||1)/2))}},Sv=class{async init(e){Cv(),await JA(),await ZA(e)}async createInferenceSessionHandler(e,t){let n=new iC;return await n.loadModel(e,t),n}},lC=new Sv});Ii();Ii();Ii();var VD="1.22.0-dev.20250409-89f8206ba4",GD=G2;{let e=(UD(),hm(oC)).wasmBackend;yu("webgpu",e,5),yu("webnn",e,5),yu("cpu",e,10),yu("wasm",e,10)}Object.defineProperty(br.versions,"web",{value:VD,enumerable:!0});/**
* @license
* Copyright 2021 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*//**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 *//**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const WD=Object.freeze(Object.defineProperty({__proto__:null,get InferenceSession(){return Qv},get TRACE(){return pm},get TRACE_FUNC_BEGIN(){return Si},get TRACE_FUNC_END(){return ei},get Tensor(){return Ci},default:GD,get env(){return br},get registerBackend(){return yu}},Symbol.toStringTag,{value:"Module"}));var Yo={},HD={"onnxruntime-common":(e=>{e.exports=Ek}),"onnxruntime-web":(e=>{e.exports=WD}),"?2ce3":(()=>{}),"?7992":(()=>{}),"?5af5":(()=>{}),"?2b25":(()=>{}),"?db59":(()=>{}),"?383f":(()=>{}),"?fa4b":(()=>{}),"./node_modules/@huggingface/jinja/dist/index.js":((e,t,n)=>{n.r(t),n.d(t,{Environment:()=>kt,Interpreter:()=>Cn,Template:()=>Qa,parse:()=>Me,tokenize:()=>p});var s=Object.freeze({Text:"Text",NumericLiteral:"NumericLiteral",StringLiteral:"StringLiteral",Identifier:"Identifier",Equals:"Equals",OpenParen:"OpenParen",CloseParen:"CloseParen",OpenStatement:"OpenStatement",CloseStatement:"CloseStatement",OpenExpression:"OpenExpression",CloseExpression:"CloseExpression",OpenSquareBracket:"OpenSquareBracket",CloseSquareBracket:"CloseSquareBracket",OpenCurlyBracket:"OpenCurlyBracket",CloseCurlyBracket:"CloseCurlyBracket",Comma:"Comma",Dot:"Dot",Colon:"Colon",Pipe:"Pipe",CallOperator:"CallOperator",AdditiveBinaryOperator:"AdditiveBinaryOperator",MultiplicativeBinaryOperator:"MultiplicativeBinaryOperator",ComparisonBinaryOperator:"ComparisonBinaryOperator",UnaryOperator:"UnaryOperator",Comment:"Comment"}),i=class{constructor(L,ue){this.value=L,this.type=ue}};function o(L){return/\w/.test(L)}function c(L){return/[0-9]/.test(L)}function d(L){return/\s/.test(L)}var u=[["{%",s.OpenStatement],["%}",s.CloseStatement],["{{",s.OpenExpression],["}}",s.CloseExpression],["(",s.OpenParen],[")",s.CloseParen],["{",s.OpenCurlyBracket],["}",s.CloseCurlyBracket],["[",s.OpenSquareBracket],["]",s.CloseSquareBracket],[",",s.Comma],[".",s.Dot],[":",s.Colon],["|",s.Pipe],["<=",s.ComparisonBinaryOperator],[">=",s.ComparisonBinaryOperator],["==",s.ComparisonBinaryOperator],["!=",s.ComparisonBinaryOperator],["<",s.ComparisonBinaryOperator],[">",s.ComparisonBinaryOperator],["+",s.AdditiveBinaryOperator],["-",s.AdditiveBinaryOperator],["~",s.AdditiveBinaryOperator],["*",s.MultiplicativeBinaryOperator],["/",s.MultiplicativeBinaryOperator],["%",s.MultiplicativeBinaryOperator],["=",s.Equals]],h=new Map([["n",`
`],["t","	"],["r","\r"],["b","\b"],["f","\f"],["v","\v"],["'","'"],['"','"'],["\\","\\"]]);function g(L,ue={}){return L.endsWith(`
`)&&(L=L.slice(0,-1)),ue.lstrip_blocks&&(L=L.replace(/^[ \t]*({[#%-])/gm,"$1")),ue.trim_blocks&&(L=L.replace(/([#%-]})\n/g,"$1")),L.replace(/{%\s*(end)?generation\s*%}/gs,"")}function p(L,ue={}){var ft,Tt;const Y=[],oe=g(L,ue);let pe=0,Ce=0;const Ue=Et=>{let nn="";for(;Et(oe[pe]);){if(oe[pe]==="\\"){if(++pe,pe>=oe.length)throw new SyntaxError("Unexpected end of input");const xt=oe[pe++],Zt=h.get(xt);if(Zt===void 0)throw new SyntaxError(`Unexpected escaped character: ${xt}`);nn+=Zt;continue}if(nn+=oe[pe++],pe>=oe.length)throw new SyntaxError("Unexpected end of input")}return nn},Ye=()=>{const Et=Y.at(-1);Et&&Et.type===s.Text&&(Et.value=Et.value.trimEnd(),Et.value===""&&Y.pop())},ct=()=>{for(;pe<oe.length&&d(oe[pe]);)++pe};e:for(;pe<oe.length;){const Et=(ft=Y.at(-1))==null?void 0:ft.type;if(Et===void 0||Et===s.CloseStatement||Et===s.CloseExpression||Et===s.Comment){let xt="";for(;pe<oe.length&&!(oe[pe]==="{"&&(oe[pe+1]==="%"||oe[pe+1]==="{"||oe[pe+1]==="#"));)xt+=oe[pe++];if(xt.length>0){Y.push(new i(xt,s.Text));continue}}if(oe[pe]==="{"&&oe[pe+1]==="#"){pe+=2;const xt=oe[pe]==="-";xt&&++pe;let Zt="";for(;oe[pe]!=="#"||oe[pe+1]!=="}";){if(pe+2>=oe.length)throw new SyntaxError("Missing end of comment tag");Zt+=oe[pe++]}const wn=Zt.endsWith("-");wn&&(Zt=Zt.slice(0,-1)),xt&&Ye(),Y.push(new i(Zt,s.Comment)),pe+=2,wn&&ct();continue}if(oe.slice(pe,pe+3)==="{%-"){Ye(),Y.push(new i("{%",s.OpenStatement)),pe+=3;continue}if(oe.slice(pe,pe+3)==="{{-"){Ye(),Y.push(new i("{{",s.OpenExpression)),Ce=0,pe+=3;continue}if(Ue(d),oe.slice(pe,pe+3)==="-%}"){Y.push(new i("%}",s.CloseStatement)),pe+=3,ct();continue}if(oe.slice(pe,pe+3)==="-}}"){Y.push(new i("}}",s.CloseExpression)),pe+=3,ct();continue}const nn=oe[pe];if(nn==="-"||nn==="+"){const xt=(Tt=Y.at(-1))==null?void 0:Tt.type;if(xt===s.Text||xt===void 0)throw new SyntaxError(`Unexpected character: ${nn}`);switch(xt){case s.Identifier:case s.NumericLiteral:case s.StringLiteral:case s.CloseParen:case s.CloseSquareBracket:break;default:{++pe;const Zt=Ue(c);Y.push(new i(`${nn}${Zt}`,Zt.length>0?s.NumericLiteral:s.UnaryOperator));continue}}}for(const[xt,Zt]of u){if(xt==="}}"&&Ce>0)continue;if(oe.slice(pe,pe+xt.length)===xt){Y.push(new i(xt,Zt)),Zt===s.OpenExpression?Ce=0:Zt===s.OpenCurlyBracket?++Ce:Zt===s.CloseCurlyBracket&&--Ce,pe+=xt.length;continue e}}if(nn==="'"||nn==='"'){++pe;const xt=Ue(Zt=>Zt!==nn);Y.push(new i(xt,s.StringLiteral)),++pe;continue}if(c(nn)){let xt=Ue(c);if(oe[pe]==="."&&c(oe[pe+1])){++pe;const Zt=Ue(c);xt=`${xt}.${Zt}`}Y.push(new i(xt,s.NumericLiteral));continue}if(o(nn)){const xt=Ue(o);Y.push(new i(xt,s.Identifier));continue}throw new SyntaxError(`Unexpected character: ${nn}`)}return Y}var m=class{constructor(){ge(this,"type","Statement")}},y=class extends m{constructor(ue){super();ge(this,"type","Program");this.body=ue}},v=class extends m{constructor(ue,Y,oe){super();ge(this,"type","If");this.test=ue,this.body=Y,this.alternate=oe}},T=class extends m{constructor(ue,Y,oe,pe){super();ge(this,"type","For");this.loopvar=ue,this.iterable=Y,this.body=oe,this.defaultBlock=pe}},O=class extends m{constructor(){super(...arguments);ge(this,"type","Break")}},E=class extends m{constructor(){super(...arguments);ge(this,"type","Continue")}},S=class extends m{constructor(ue,Y,oe){super();ge(this,"type","Set");this.assignee=ue,this.value=Y,this.body=oe}},D=class extends m{constructor(ue,Y,oe){super();ge(this,"type","Macro");this.name=ue,this.args=Y,this.body=oe}},I=class extends m{constructor(ue){super();ge(this,"type","Comment");this.value=ue}},M=class extends m{constructor(){super(...arguments);ge(this,"type","Expression")}},C=class extends M{constructor(ue,Y,oe){super();ge(this,"type","MemberExpression");this.object=ue,this.property=Y,this.computed=oe}},A=class extends M{constructor(ue,Y){super();ge(this,"type","CallExpression");this.callee=ue,this.args=Y}},k=class extends M{constructor(ue){super();ge(this,"type","Identifier");this.value=ue}},R=class extends M{constructor(ue){super();ge(this,"type","Literal");this.value=ue}},G=class extends R{constructor(){super(...arguments);ge(this,"type","IntegerLiteral")}},te=class extends R{constructor(){super(...arguments);ge(this,"type","FloatLiteral")}},ee=class extends R{constructor(){super(...arguments);ge(this,"type","StringLiteral")}},X=class extends R{constructor(){super(...arguments);ge(this,"type","ArrayLiteral")}},le=class extends R{constructor(){super(...arguments);ge(this,"type","TupleLiteral")}},ae=class extends R{constructor(){super(...arguments);ge(this,"type","ObjectLiteral")}},Q=class extends M{constructor(ue,Y,oe){super();ge(this,"type","BinaryExpression");this.operator=ue,this.left=Y,this.right=oe}},ne=class extends M{constructor(ue,Y){super();ge(this,"type","FilterExpression");this.operand=ue,this.filter=Y}},de=class extends m{constructor(ue,Y){super();ge(this,"type","FilterStatement");this.filter=ue,this.body=Y}},ve=class extends M{constructor(ue,Y){super();ge(this,"type","SelectExpression");this.lhs=ue,this.test=Y}},fe=class extends M{constructor(ue,Y,oe){super();ge(this,"type","TestExpression");this.operand=ue,this.negate=Y,this.test=oe}},j=class extends M{constructor(ue,Y){super();ge(this,"type","UnaryExpression");this.operator=ue,this.argument=Y}},U=class extends M{constructor(ue=void 0,Y=void 0,oe=void 0){super();ge(this,"type","SliceExpression");this.start=ue,this.stop=Y,this.step=oe}},N=class extends M{constructor(ue,Y){super();ge(this,"type","KeywordArgumentExpression");this.key=ue,this.value=Y}},q=class extends M{constructor(ue){super();ge(this,"type","SpreadExpression");this.argument=ue}},ce=class extends m{constructor(ue,Y,oe){super();ge(this,"type","CallStatement");this.call=ue,this.callerArgs=Y,this.body=oe}},Z=class extends M{constructor(ue,Y,oe){super();ge(this,"type","Ternary");this.condition=ue,this.trueExpr=Y,this.falseExpr=oe}};function Me(L){const ue=new y([]);let Y=0;function oe(lt,ut){const At=L[Y++];if(!At||At.type!==lt)throw new Error(`Parser Error: ${ut}. ${At.type} !== ${lt}.`);return At}function pe(lt){if(!ct(lt))throw new SyntaxError(`Expected ${lt}`);++Y}function Ce(){switch(L[Y].type){case s.Comment:return new I(L[Y++].value);case s.Text:return ft();case s.OpenStatement:return Tt();case s.OpenExpression:return Et();default:throw new SyntaxError(`Unexpected token type: ${L[Y].type}`)}}function Ue(...lt){return Y+lt.length<=L.length&&lt.every((ut,At)=>ut===L[Y+At].type)}function Ye(...lt){var ut,At,En;return((ut=L[Y])==null?void 0:ut.type)===s.OpenStatement&&((At=L[Y+1])==null?void 0:At.type)===s.Identifier&&lt.includes((En=L[Y+1])==null?void 0:En.value)}function ct(...lt){return Y+lt.length<=L.length&&lt.every((ut,At)=>L[Y+At].type==="Identifier"&&ut===L[Y+At].value)}function ft(){return new ee(oe(s.Text,"Expected text token").value)}function Tt(){if(oe(s.OpenStatement,"Expected opening statement token"),L[Y].type!==s.Identifier)throw new SyntaxError(`Unknown statement, got ${L[Y].type}`);const lt=L[Y].value;let ut;switch(lt){case"set":++Y,ut=nn();break;case"if":++Y,ut=xt(),oe(s.OpenStatement,"Expected {% token"),pe("endif"),oe(s.CloseStatement,"Expected %} token");break;case"macro":++Y,ut=Zt(),oe(s.OpenStatement,"Expected {% token"),pe("endmacro"),oe(s.CloseStatement,"Expected %} token");break;case"for":++Y,ut=Gn(),oe(s.OpenStatement,"Expected {% token"),pe("endfor"),oe(s.CloseStatement,"Expected %} token");break;case"call":{++Y;let At=null;Ue(s.OpenParen)&&(At=mr());const En=ua();if(En.type!=="Identifier")throw new SyntaxError("Expected identifier following call statement");const ni=mr();oe(s.CloseStatement,"Expected closing statement token");const Fr=[];for(;!Ye("endcall");)Fr.push(Ce());oe(s.OpenStatement,"Expected '{%'"),pe("endcall"),oe(s.CloseStatement,"Expected closing statement token");const ps=new A(En,ni);ut=new ce(ps,At,Fr);break}case"break":++Y,oe(s.CloseStatement,"Expected closing statement token"),ut=new O;break;case"continue":++Y,oe(s.CloseStatement,"Expected closing statement token"),ut=new E;break;case"filter":{++Y;let At=ua();At instanceof k&&Ue(s.OpenParen)&&(At=xa(At)),oe(s.CloseStatement,"Expected closing statement token");const En=[];for(;!Ye("endfilter");)En.push(Ce());oe(s.OpenStatement,"Expected '{%'"),pe("endfilter"),oe(s.CloseStatement,"Expected '%}'"),ut=new de(At,En);break}default:throw new SyntaxError(`Unknown statement type: ${lt}`)}return ut}function Et(){oe(s.OpenExpression,"Expected opening expression token");const lt=or();return oe(s.CloseExpression,"Expected closing expression token"),lt}function nn(){const lt=wn();let ut=null;const At=[];if(Ue(s.Equals))++Y,ut=wn();else{for(oe(s.CloseStatement,"Expected %} token");!Ye("endset");)At.push(Ce());oe(s.OpenStatement,"Expected {% token"),pe("endset")}return oe(s.CloseStatement,"Expected closing statement token"),new S(lt,ut,At)}function xt(){const lt=or();oe(s.CloseStatement,"Expected closing statement token");const ut=[],At=[];for(;!Ye("elif","else","endif");)ut.push(Ce());if(Ye("elif")){++Y,++Y;const En=xt();At.push(En)}else if(Ye("else"))for(++Y,++Y,oe(s.CloseStatement,"Expected closing statement token");!Ye("endif");)At.push(Ce());return new v(lt,ut,At)}function Zt(){const lt=ua();if(lt.type!=="Identifier")throw new SyntaxError("Expected identifier following macro statement");const ut=mr();oe(s.CloseStatement,"Expected closing statement token");const At=[];for(;!Ye("endmacro");)At.push(Ce());return new D(lt,ut,At)}function wn(lt=!1){const ut=lt?ua:or,At=[ut()],En=Ue(s.Comma);for(;En&&(++Y,At.push(ut()),!!Ue(s.Comma)););return En?new le(At):At[0]}function Gn(){const lt=wn(!0);if(!(lt instanceof k||lt instanceof le))throw new SyntaxError(`Expected identifier/tuple for the loop variable, got ${lt.type} instead`);if(!ct("in"))throw new SyntaxError("Expected `in` keyword following loop variable");++Y;const ut=or();oe(s.CloseStatement,"Expected closing statement token");const At=[];for(;!Ye("endfor","else");)At.push(Ce());const En=[];if(Ye("else"))for(++Y,++Y,oe(s.CloseStatement,"Expected closing statement token");!Ye("endfor");)En.push(Ce());return new T(lt,ut,At,En)}function or(){return Ir()}function Ir(){const lt=_a();if(ct("if")){++Y;const ut=_a();if(ct("else")){++Y;const At=Ir();return new Z(ut,lt,At)}else return new ve(lt,ut)}return lt}function _a(){let lt=nr();for(;ct("or");){const ut=L[Y];++Y;const At=nr();lt=new Q(ut,lt,At)}return lt}function nr(){let lt=Tr();for(;ct("and");){const ut=L[Y];++Y;const At=Tr();lt=new Q(ut,lt,At)}return lt}function Tr(){let lt;for(;ct("not");){const ut=L[Y];++Y;const At=Tr();lt=new j(ut,At)}return lt??Bs()}function Bs(){let lt=na();for(;;){let ut;if(ct("not","in"))ut=new i("not in",s.Identifier),Y+=2;else if(ct("in"))ut=L[Y++];else if(Ue(s.ComparisonBinaryOperator))ut=L[Y++];else break;const At=na();lt=new Q(ut,lt,At)}return lt}function na(){let lt=Ka();for(;Ue(s.AdditiveBinaryOperator);){const ut=L[Y];++Y;const At=Ka();lt=new Q(ut,lt,At)}return lt}function Pr(){const lt=qa(ua());return Ue(s.OpenParen)?xa(lt):lt}function xa(lt){let ut=new A(lt,mr());return ut=qa(ut),Ue(s.OpenParen)&&(ut=xa(ut)),ut}function mr(){oe(s.OpenParen,"Expected opening parenthesis for arguments list");const lt=wr();return oe(s.CloseParen,"Expected closing parenthesis for arguments list"),lt}function wr(){const lt=[];for(;!Ue(s.CloseParen);){let ut;if(L[Y].type===s.MultiplicativeBinaryOperator&&L[Y].value==="*"){++Y;const At=or();ut=new q(At)}else if(ut=or(),Ue(s.Equals)){if(++Y,!(ut instanceof k))throw new SyntaxError("Expected identifier for keyword argument");const At=or();ut=new N(ut,At)}lt.push(ut),Ue(s.Comma)&&++Y}return lt}function hs(){const lt=[];let ut=!1;for(;!Ue(s.CloseSquareBracket);)Ue(s.Colon)?(lt.push(void 0),++Y,ut=!0):(lt.push(or()),Ue(s.Colon)&&(++Y,ut=!0));if(lt.length===0)throw new SyntaxError("Expected at least one argument for member/slice expression");if(ut){if(lt.length>3)throw new SyntaxError("Expected 0-3 arguments for slice expression");return new U(...lt)}return lt[0]}function qa(lt){for(;Ue(s.Dot)||Ue(s.OpenSquareBracket);){const ut=L[Y];++Y;let At;const En=ut.type===s.OpenSquareBracket;if(En)At=hs(),oe(s.CloseSquareBracket,"Expected closing square bracket");else if(At=ua(),At.type!=="Identifier")throw new SyntaxError("Expected identifier following dot operator");lt=new C(lt,At,En)}return lt}function Ka(){let lt=ra();for(;Ue(s.MultiplicativeBinaryOperator);){const ut=L[Y++],At=ra();lt=new Q(ut,lt,At)}return lt}function ra(){let lt=Ar();for(;ct("is");){++Y;const ut=ct("not");ut&&++Y;const At=ua();if(!(At instanceof k))throw new SyntaxError("Expected identifier for the test");lt=new fe(lt,ut,At)}return lt}function Ar(){let lt=Pr();for(;Ue(s.Pipe);){++Y;let ut=ua();if(!(ut instanceof k))throw new SyntaxError("Expected identifier for the filter");Ue(s.OpenParen)&&(ut=xa(ut)),lt=new ne(lt,ut)}return lt}function ua(){const lt=L[Y++];switch(lt.type){case s.NumericLiteral:{const ut=lt.value;return ut.includes(".")?new te(Number(ut)):new G(Number(ut))}case s.StringLiteral:{let ut=lt.value;for(;Ue(s.StringLiteral);)ut+=L[Y++].value;return new ee(ut)}case s.Identifier:return new k(lt.value);case s.OpenParen:{const ut=wn();return oe(s.CloseParen,"Expected closing parenthesis, got ${tokens[current].type} instead."),ut}case s.OpenSquareBracket:{const ut=[];for(;!Ue(s.CloseSquareBracket);)ut.push(or()),Ue(s.Comma)&&++Y;return++Y,new X(ut)}case s.OpenCurlyBracket:{const ut=new Map;for(;!Ue(s.CloseCurlyBracket);){const At=or();oe(s.Colon,"Expected colon between key and value in object literal");const En=or();ut.set(At,En),Ue(s.Comma)&&++Y}return++Y,new ae(ut)}default:throw new SyntaxError(`Unexpected token: ${lt.type}`)}}for(;Y<L.length;)ue.body.push(Ce());return ue}function Pe(L,ue,Y=1){ue===void 0&&(ue=L,L=0);const oe=[];for(let pe=L;pe<ue;pe+=Y)oe.push(pe);return oe}function Ne(L,ue,Y,oe=1){const pe=Math.sign(oe);pe>=0?(ue=(ue??(ue=0))<0?Math.max(L.length+ue,0):Math.min(ue,L.length),Y=(Y??(Y=L.length))<0?Math.max(L.length+Y,0):Math.min(Y,L.length)):(ue=(ue??(ue=L.length-1))<0?Math.max(L.length+ue,-1):Math.min(ue,L.length-1),Y=(Y??(Y=-1))<-1?Math.max(L.length+Y,-1):Math.min(Y,L.length-1));const Ce=[];for(let Ue=ue;pe*Ue<pe*Y;Ue+=oe)Ce.push(L[Ue]);return Ce}function Oe(L){return L.replace(/\b\w/g,ue=>ue.toUpperCase())}function he(L){return H(new Date,L)}function H(L,ue){const Y=new Intl.DateTimeFormat(void 0,{month:"long"}),oe=new Intl.DateTimeFormat(void 0,{month:"short"}),pe=Ce=>Ce<10?"0"+Ce:Ce.toString();return ue.replace(/%[YmdbBHM%]/g,Ce=>{switch(Ce){case"%Y":return L.getFullYear().toString();case"%m":return pe(L.getMonth()+1);case"%d":return pe(L.getDate());case"%b":return oe.format(L);case"%B":return Y.format(L);case"%H":return pe(L.getHours());case"%M":return pe(L.getMinutes());case"%%":return"%";default:return Ce}})}function Te(L){return L.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function ze(L,ue,Y,oe){if(oe===0)return L;let pe=oe==null||oe<0?1/0:oe;const Ce=ue.length===0?new RegExp("(?=)","gu"):new RegExp(Te(ue),"gu");return L.replaceAll(Ce,Ue=>pe>0?(--pe,Y):Ue)}var Re=class extends Error{},He=class extends Error{},Ke=class{constructor(L=void 0){ge(this,"type","RuntimeValue");ge(this,"value");ge(this,"builtins",new Map);this.value=L}__bool__(){return new qe(!!this.value)}toString(){return String(this.value)}},Be=class extends Ke{constructor(){super(...arguments);ge(this,"type","IntegerValue")}},nt=class extends Ke{constructor(){super(...arguments);ge(this,"type","FloatValue")}toString(){return this.value%1===0?this.value.toFixed(1):this.value.toString()}},$e=class extends Ke{constructor(){super(...arguments);ge(this,"type","StringValue");ge(this,"builtins",new Map([["upper",new vt(()=>new $e(this.value.toUpperCase()))],["lower",new vt(()=>new $e(this.value.toLowerCase()))],["strip",new vt(()=>new $e(this.value.trim()))],["title",new vt(()=>new $e(Oe(this.value)))],["capitalize",new vt(()=>new $e(this.value.charAt(0).toUpperCase()+this.value.slice(1)))],["length",new Be(this.value.length)],["rstrip",new vt(()=>new $e(this.value.trimEnd()))],["lstrip",new vt(()=>new $e(this.value.trimStart()))],["startswith",new vt(ue=>{if(ue.length===0)throw new Error("startswith() requires at least one argument");const Y=ue[0];if(Y instanceof $e)return new qe(this.value.startsWith(Y.value));if(Y instanceof dt){for(const oe of Y.value){if(!(oe instanceof $e))throw new Error("startswith() tuple elements must be strings");if(this.value.startsWith(oe.value))return new qe(!0)}return new qe(!1)}throw new Error("startswith() argument must be a string or tuple of strings")})],["endswith",new vt(ue=>{if(ue.length===0)throw new Error("endswith() requires at least one argument");const Y=ue[0];if(Y instanceof $e)return new qe(this.value.endsWith(Y.value));if(Y instanceof dt){for(const oe of Y.value){if(!(oe instanceof $e))throw new Error("endswith() tuple elements must be strings");if(this.value.endsWith(oe.value))return new qe(!0)}return new qe(!1)}throw new Error("endswith() argument must be a string or tuple of strings")})],["split",new vt(ue=>{const Y=ue[0]??new Ze;if(!(Y instanceof $e||Y instanceof Ze))throw new Error("sep argument must be a string or null");const oe=ue[1]??new Be(-1);if(!(oe instanceof Be))throw new Error("maxsplit argument must be a number");let pe=[];if(Y instanceof Ze){const Ce=this.value.trimStart();for(const{0:Ue,index:Ye}of Ce.matchAll(/\S+/g)){if(oe.value!==-1&&pe.length>=oe.value&&Ye!==void 0){pe.push(Ue+Ce.slice(Ye+Ue.length));break}pe.push(Ue)}}else{if(Y.value==="")throw new Error("empty separator");pe=this.value.split(Y.value),oe.value!==-1&&pe.length>oe.value&&pe.push(pe.splice(oe.value).join(Y.value))}return new dt(pe.map(Ce=>new $e(Ce)))})],["replace",new vt(ue=>{if(ue.length<2)throw new Error("replace() requires at least two arguments");const Y=ue[0],oe=ue[1];if(!(Y instanceof $e&&oe instanceof $e))throw new Error("replace() arguments must be strings");let pe;if(ue.length>2?ue[2].type==="KeywordArgumentsValue"?pe=ue[2].value.get("count")??new Ze:pe=ue[2]:pe=new Ze,!(pe instanceof Be||pe instanceof Ze))throw new Error("replace() count argument must be a number or null");return new $e(ze(this.value,Y.value,oe.value,pe.value))})]]))}},qe=class extends Ke{constructor(){super(...arguments);ge(this,"type","BooleanValue")}};function _t(L,ue,Y,oe=!0){const pe=Y??0;switch(L.type){case"NullValue":return"null";case"UndefinedValue":return oe?"null":"undefined";case"IntegerValue":case"FloatValue":case"StringValue":case"BooleanValue":return JSON.stringify(L.value);case"ArrayValue":case"ObjectValue":{const Ce=ue?" ".repeat(ue):"",Ue=`
`+Ce.repeat(pe),Ye=Ue+Ce;if(L.type==="ArrayValue"){const ct=L.value.map(ft=>_t(ft,ue,pe+1,oe));return ue?`[${Ye}${ct.join(`,${Ye}`)}${Ue}]`:`[${ct.join(", ")}]`}else{const ct=Array.from(L.value.entries()).map(([ft,Tt])=>{const Et=`"${ft}": ${_t(Tt,ue,pe+1,oe)}`;return ue?`${Ye}${Et}`:Et});return ue?`{${ct.join(",")}${Ue}}`:`{${ct.join(", ")}}`}}default:throw new Error(`Cannot convert to JSON: ${L.type}`)}}var Je=class extends Ke{constructor(){super(...arguments);ge(this,"type","ObjectValue");ge(this,"builtins",new Map([["get",new vt(([ue,Y])=>{if(!(ue instanceof $e))throw new Error(`Object key must be a string: got ${ue.type}`);return this.value.get(ue.value)??Y??new Ze})],["items",new vt(()=>this.items())],["keys",new vt(()=>this.keys())],["values",new vt(()=>this.values())],["dictsort",new vt(ue=>{let Y=new Map;const oe=ue.filter(ct=>ct instanceof pt?(Y=ct.value,!1):!0),pe=oe.at(0)??Y.get("case_sensitive")??new qe(!1);if(!(pe instanceof qe))throw new Error("case_sensitive must be a boolean");const Ce=oe.at(1)??Y.get("by")??new $e("key");if(!(Ce instanceof $e))throw new Error("by must be a string");if(!["key","value"].includes(Ce.value))throw new Error("by must be either 'key' or 'value'");const Ue=oe.at(2)??Y.get("reverse")??new qe(!1);if(!(Ue instanceof qe))throw new Error("reverse must be a boolean");const Ye=Array.from(this.value.entries()).map(([ct,ft])=>new dt([new $e(ct),ft])).sort((ct,ft)=>{const Tt=Ce.value==="key"?0:1,Et=ct.value[Tt],nn=ft.value[Tt],xt=Jt(Et,nn,pe.value);return Ue.value?-xt:xt});return new dt(Ye)})]]))}__bool__(){return new qe(this.value.size>0)}items(){return new dt(Array.from(this.value.entries()).map(([ue,Y])=>new dt([new $e(ue),Y])))}keys(){return new dt(Array.from(this.value.keys()).map(ue=>new $e(ue)))}values(){return new dt(Array.from(this.value.values()))}toString(){return _t(this,null,0,!1)}},pt=class extends Je{constructor(){super(...arguments);ge(this,"type","KeywordArgumentsValue")}},dt=class extends Ke{constructor(){super(...arguments);ge(this,"type","ArrayValue");ge(this,"builtins",new Map([["length",new Be(this.value.length)]]))}__bool__(){return new qe(this.value.length>0)}toString(){return _t(this,null,0,!1)}},Gt=class extends dt{constructor(){super(...arguments);ge(this,"type","TupleValue")}},vt=class extends Ke{constructor(){super(...arguments);ge(this,"type","FunctionValue")}},Ze=class extends Ke{constructor(){super(...arguments);ge(this,"type","NullValue")}},rt=class extends Ke{constructor(){super(...arguments);ge(this,"type","UndefinedValue")}},kt=class{constructor(L){ge(this,"variables",new Map([["namespace",new vt(L=>{if(L.length===0)return new Je(new Map);if(L.length!==1||!(L[0]instanceof Je))throw new Error("`namespace` expects either zero arguments or a single object argument");return L[0]})]]));ge(this,"tests",new Map([["boolean",L=>L.type==="BooleanValue"],["callable",L=>L instanceof vt],["odd",L=>{if(!(L instanceof Be))throw new Error(`cannot odd on ${L.type}`);return L.value%2!==0}],["even",L=>{if(!(L instanceof Be))throw new Error(`cannot even on ${L.type}`);return L.value%2===0}],["false",L=>L.type==="BooleanValue"&&!L.value],["true",L=>L.type==="BooleanValue"&&L.value],["none",L=>L.type==="NullValue"],["string",L=>L.type==="StringValue"],["number",L=>L instanceof Be||L instanceof nt],["integer",L=>L instanceof Be],["iterable",L=>L.type==="ArrayValue"||L.type==="StringValue"],["mapping",L=>L.type==="ObjectValue"],["lower",L=>{const ue=L.value;return L.type==="StringValue"&&ue===ue.toLowerCase()}],["upper",L=>{const ue=L.value;return L.type==="StringValue"&&ue===ue.toUpperCase()}],["none",L=>L.type==="NullValue"],["defined",L=>L.type!=="UndefinedValue"],["undefined",L=>L.type==="UndefinedValue"],["equalto",(L,ue)=>L.value===ue.value],["eq",(L,ue)=>L.value===ue.value]]));this.parent=L}set(L,ue){return this.declareVariable(L,Fn(ue))}declareVariable(L,ue){if(this.variables.has(L))throw new SyntaxError(`Variable already declared: ${L}`);return this.variables.set(L,ue),ue}setVariable(L,ue){return this.variables.set(L,ue),ue}resolve(L){if(this.variables.has(L))return this;if(this.parent)return this.parent.resolve(L);throw new Error(`Unknown variable: ${L}`)}lookupVariable(L){try{return this.resolve(L).variables.get(L)??new rt}catch{return new rt}}};function Nt(L){L.set("false",!1),L.set("true",!0),L.set("none",null),L.set("raise_exception",ue=>{throw new Error(ue)}),L.set("range",Pe),L.set("strftime_now",he),L.set("True",!0),L.set("False",!1),L.set("None",null)}function gn(L,ue){const Y=ue.split(".");let oe=L;for(const pe of Y)if(oe instanceof Je)oe=oe.value.get(pe)??new rt;else if(oe instanceof dt){const Ce=parseInt(pe,10);if(!isNaN(Ce)&&Ce>=0&&Ce<oe.value.length)oe=oe.value[Ce];else return new rt}else return new rt;return oe}function Jt(L,ue,Y=!1){if(L instanceof Ze&&ue instanceof Ze)return 0;if(L instanceof Ze||ue instanceof Ze)throw new Error(`Cannot compare ${L.type} with ${ue.type}`);if(L instanceof rt&&ue instanceof rt)return 0;if(L instanceof rt||ue instanceof rt)throw new Error(`Cannot compare ${L.type} with ${ue.type}`);const oe=Ce=>Ce instanceof Be||Ce instanceof nt||Ce instanceof qe,pe=Ce=>Ce instanceof qe?Ce.value?1:0:Ce.value;if(oe(L)&&oe(ue)){const Ce=pe(L),Ue=pe(ue);return Ce<Ue?-1:Ce>Ue?1:0}if(L.type!==ue.type)throw new Error(`Cannot compare different types: ${L.type} and ${ue.type}`);switch(L.type){case"StringValue":{let Ce=L.value,Ue=ue.value;return Y||(Ce=Ce.toLowerCase(),Ue=Ue.toLowerCase()),Ce<Ue?-1:Ce>Ue?1:0}default:throw new Error(`Cannot compare type: ${L.type}`)}}var Cn=class{constructor(L){ge(this,"global");this.global=L??new kt}run(L){return this.evaluate(L,this.global)}evaluateBinaryExpression(L,ue){const Y=this.evaluate(L.left,ue);switch(L.operator.value){case"and":return Y.__bool__().value?this.evaluate(L.right,ue):Y;case"or":return Y.__bool__().value?Y:this.evaluate(L.right,ue)}const oe=this.evaluate(L.right,ue);switch(L.operator.value){case"==":return new qe(Y.value==oe.value);case"!=":return new qe(Y.value!=oe.value)}if(Y instanceof rt||oe instanceof rt){if(oe instanceof rt&&["in","not in"].includes(L.operator.value))return new qe(L.operator.value==="not in");throw new Error(`Cannot perform operation ${L.operator.value} on undefined values`)}else{if(Y instanceof Ze||oe instanceof Ze)throw new Error("Cannot perform operation on null values");if(L.operator.value==="~")return new $e(Y.value.toString()+oe.value.toString());if((Y instanceof Be||Y instanceof nt)&&(oe instanceof Be||oe instanceof nt)){const pe=Y.value,Ce=oe.value;switch(L.operator.value){case"+":case"-":case"*":{const Ue=L.operator.value==="+"?pe+Ce:L.operator.value==="-"?pe-Ce:pe*Ce;return Y instanceof nt||oe instanceof nt?new nt(Ue):new Be(Ue)}case"/":return new nt(pe/Ce);case"%":{const Ue=pe%Ce;return Y instanceof nt||oe instanceof nt?new nt(Ue):new Be(Ue)}case"<":return new qe(pe<Ce);case">":return new qe(pe>Ce);case">=":return new qe(pe>=Ce);case"<=":return new qe(pe<=Ce)}}else if(Y instanceof dt&&oe instanceof dt)switch(L.operator.value){case"+":return new dt(Y.value.concat(oe.value))}else if(oe instanceof dt){const pe=oe.value.find(Ce=>Ce.value===Y.value)!==void 0;switch(L.operator.value){case"in":return new qe(pe);case"not in":return new qe(!pe)}}}if(Y instanceof $e||oe instanceof $e)switch(L.operator.value){case"+":return new $e(Y.value.toString()+oe.value.toString())}if(Y instanceof $e&&oe instanceof $e)switch(L.operator.value){case"in":return new qe(oe.value.includes(Y.value));case"not in":return new qe(!oe.value.includes(Y.value))}if(Y instanceof $e&&oe instanceof Je)switch(L.operator.value){case"in":return new qe(oe.value.has(Y.value));case"not in":return new qe(!oe.value.has(Y.value))}throw new SyntaxError(`Unknown operator "${L.operator.value}" between ${Y.type} and ${oe.type}`)}evaluateArguments(L,ue){const Y=[],oe=new Map;for(const pe of L)if(pe.type==="SpreadExpression"){const Ce=pe,Ue=this.evaluate(Ce.argument,ue);if(!(Ue instanceof dt))throw new Error(`Cannot unpack non-iterable type: ${Ue.type}`);for(const Ye of Ue.value)Y.push(Ye)}else if(pe.type==="KeywordArgumentExpression"){const Ce=pe;oe.set(Ce.key.value,this.evaluate(Ce.value,ue))}else{if(oe.size>0)throw new Error("Positional arguments must come before keyword arguments");Y.push(this.evaluate(pe,ue))}return[Y,oe]}applyFilter(L,ue,Y){if(ue.type==="Identifier"){const oe=ue;if(oe.value==="tojson")return new $e(_t(L));if(L instanceof dt)switch(oe.value){case"list":return L;case"first":return L.value[0];case"last":return L.value[L.value.length-1];case"length":return new Be(L.value.length);case"reverse":return new dt(L.value.slice().reverse());case"sort":return new dt(L.value.slice().sort((pe,Ce)=>Jt(pe,Ce,!1)));case"join":return new $e(L.value.map(pe=>pe.value).join(""));case"string":return new $e(_t(L,null,0,!1));case"unique":{const pe=new Set,Ce=[];for(const Ue of L.value)pe.has(Ue.value)||(pe.add(Ue.value),Ce.push(Ue));return new dt(Ce)}default:throw new Error(`Unknown ArrayValue filter: ${oe.value}`)}else if(L instanceof $e)switch(oe.value){case"length":case"upper":case"lower":case"title":case"capitalize":{const pe=L.builtins.get(oe.value);if(pe instanceof vt)return pe.value([],Y);if(pe instanceof Be)return pe;throw new Error(`Unknown StringValue filter: ${oe.value}`)}case"trim":return new $e(L.value.trim());case"indent":return new $e(L.value.split(`
`).map((pe,Ce)=>Ce===0||pe.length===0?pe:"    "+pe).join(`
`));case"join":case"string":return L;case"int":{const pe=parseInt(L.value,10);return new Be(isNaN(pe)?0:pe)}case"float":{const pe=parseFloat(L.value);return new nt(isNaN(pe)?0:pe)}default:throw new Error(`Unknown StringValue filter: ${oe.value}`)}else if(L instanceof Be||L instanceof nt)switch(oe.value){case"abs":return L instanceof Be?new Be(Math.abs(L.value)):new nt(Math.abs(L.value));case"int":return new Be(Math.floor(L.value));case"float":return new nt(L.value);default:throw new Error(`Unknown NumericValue filter: ${oe.value}`)}else if(L instanceof Je)switch(oe.value){case"items":return new dt(Array.from(L.value.entries()).map(([pe,Ce])=>new dt([new $e(pe),Ce])));case"length":return new Be(L.value.size);default:{const pe=L.builtins.get(oe.value);if(pe)return pe instanceof vt?pe.value([],Y):pe;throw new Error(`Unknown ObjectValue filter: ${oe.value}`)}}else if(L instanceof qe)switch(oe.value){case"bool":return new qe(L.value);case"int":return new Be(L.value?1:0);case"float":return new nt(L.value?1:0);case"string":return new $e(L.value?"true":"false");default:throw new Error(`Unknown BooleanValue filter: ${oe.value}`)}throw new Error(`Cannot apply filter "${oe.value}" to type: ${L.type}`)}else if(ue.type==="CallExpression"){const oe=ue;if(oe.callee.type!=="Identifier")throw new Error(`Unknown filter: ${oe.callee.type}`);const pe=oe.callee.value;if(pe==="tojson"){const[,Ce]=this.evaluateArguments(oe.args,Y),Ue=Ce.get("indent")??new Ze;if(!(Ue instanceof Be||Ue instanceof Ze))throw new Error("If set, indent must be a number");return new $e(_t(L,Ue.value))}else if(pe==="join"){let Ce;if(L instanceof $e)Ce=Array.from(L.value);else if(L instanceof dt)Ce=L.value.map(ft=>ft.value);else throw new Error(`Cannot apply filter "${pe}" to type: ${L.type}`);const[Ue,Ye]=this.evaluateArguments(oe.args,Y),ct=Ue.at(0)??Ye.get("separator")??new $e("");if(!(ct instanceof $e))throw new Error("separator must be a string");return new $e(Ce.join(ct.value))}else if(pe==="int"||pe==="float"){const[Ce,Ue]=this.evaluateArguments(oe.args,Y),Ye=Ce.at(0)??Ue.get("default")??(pe==="int"?new Be(0):new nt(0));if(L instanceof $e){const ct=pe==="int"?parseInt(L.value,10):parseFloat(L.value);return isNaN(ct)?Ye:pe==="int"?new Be(ct):new nt(ct)}else{if(L instanceof Be||L instanceof nt)return L;if(L instanceof qe)return pe==="int"?new Be(L.value?1:0):new nt(L.value?1:0);throw new Error(`Cannot apply filter "${pe}" to type: ${L.type}`)}}else if(pe==="default"){const[Ce,Ue]=this.evaluateArguments(oe.args,Y),Ye=Ce[0]??new $e(""),ct=Ce[1]??Ue.get("boolean")??new qe(!1);if(!(ct instanceof qe))throw new Error("`default` filter flag must be a boolean");return L instanceof rt||ct.value&&!L.__bool__().value?Ye:L}if(L instanceof dt){switch(pe){case"sort":{const[Ce,Ue]=this.evaluateArguments(oe.args,Y),Ye=Ce.at(0)??Ue.get("reverse")??new qe(!1);if(!(Ye instanceof qe))throw new Error("reverse must be a boolean");const ct=Ce.at(1)??Ue.get("case_sensitive")??new qe(!1);if(!(ct instanceof qe))throw new Error("case_sensitive must be a boolean");const ft=Ce.at(2)??Ue.get("attribute")??new Ze;if(!(ft instanceof $e||ft instanceof Be||ft instanceof Ze))throw new Error("attribute must be a string, integer, or null");const Tt=Et=>{if(ft instanceof Ze)return Et;const nn=ft instanceof Be?String(ft.value):ft.value;return gn(Et,nn)};return new dt(L.value.slice().sort((Et,nn)=>{const xt=Tt(Et),Zt=Tt(nn),wn=Jt(xt,Zt,ct.value);return Ye.value?-wn:wn}))}case"selectattr":case"rejectattr":{const Ce=pe==="selectattr";if(L.value.some(Et=>!(Et instanceof Je)))throw new Error(`\`${pe}\` can only be applied to array of objects`);if(oe.args.some(Et=>Et.type!=="StringLiteral"))throw new Error(`arguments of \`${pe}\` must be strings`);const[Ue,Ye,ct]=oe.args.map(Et=>this.evaluate(Et,Y));let ft;if(Ye){const Et=Y.tests.get(Ye.value);if(!Et)throw new Error(`Unknown test: ${Ye.value}`);ft=Et}else ft=(...Et)=>Et[0].__bool__().value;const Tt=L.value.filter(Et=>{const nn=Et.value.get(Ue.value),xt=nn?ft(nn,ct):!1;return Ce?xt:!xt});return new dt(Tt)}case"map":{const[,Ce]=this.evaluateArguments(oe.args,Y);if(Ce.has("attribute")){const Ue=Ce.get("attribute");if(!(Ue instanceof $e))throw new Error("attribute must be a string");const Ye=Ce.get("default"),ct=L.value.map(ft=>{if(!(ft instanceof Je))throw new Error("items in map must be an object");const Tt=gn(ft,Ue.value);return Tt instanceof rt?Ye??new rt:Tt});return new dt(ct)}else throw new Error("`map` expressions without `attribute` set are not currently supported.")}}throw new Error(`Unknown ArrayValue filter: ${pe}`)}else if(L instanceof $e){switch(pe){case"indent":{const[Ce,Ue]=this.evaluateArguments(oe.args,Y),Ye=Ce.at(0)??Ue.get("width")??new Be(4);if(!(Ye instanceof Be))throw new Error("width must be a number");const ct=Ce.at(1)??Ue.get("first")??new qe(!1),ft=Ce.at(2)??Ue.get("blank")??new qe(!1),Tt=L.value.split(`
`),Et=" ".repeat(Ye.value),nn=Tt.map((xt,Zt)=>!ct.value&&Zt===0||!ft.value&&xt.length===0?xt:Et+xt);return new $e(nn.join(`
`))}case"replace":{const Ce=L.builtins.get("replace");if(!(Ce instanceof vt))throw new Error("replace filter not available");const[Ue,Ye]=this.evaluateArguments(oe.args,Y);return Ce.value([...Ue,new pt(Ye)],Y)}}throw new Error(`Unknown StringValue filter: ${pe}`)}else if(L instanceof Je){const Ce=L.builtins.get(pe);if(Ce&&Ce instanceof vt){const[Ue,Ye]=this.evaluateArguments(oe.args,Y);return Ye.size>0&&Ue.push(new pt(Ye)),Ce.value(Ue,Y)}throw new Error(`Unknown ObjectValue filter: ${pe}`)}else throw new Error(`Cannot apply filter "${pe}" to type: ${L.type}`)}throw new Error(`Unknown filter: ${ue.type}`)}evaluateFilterExpression(L,ue){const Y=this.evaluate(L.operand,ue);return this.applyFilter(Y,L.filter,ue)}evaluateTestExpression(L,ue){const Y=this.evaluate(L.operand,ue),oe=ue.tests.get(L.test.value);if(!oe)throw new Error(`Unknown test: ${L.test.value}`);const pe=oe(Y);return new qe(L.negate?!pe:pe)}evaluateSelectExpression(L,ue){return this.evaluate(L.test,ue).__bool__().value?this.evaluate(L.lhs,ue):new rt}evaluateUnaryExpression(L,ue){const Y=this.evaluate(L.argument,ue);switch(L.operator.value){case"not":return new qe(!Y.value);default:throw new SyntaxError(`Unknown operator: ${L.operator.value}`)}}evaluateTernaryExpression(L,ue){return this.evaluate(L.condition,ue).__bool__().value?this.evaluate(L.trueExpr,ue):this.evaluate(L.falseExpr,ue)}evalProgram(L,ue){return this.evaluateBlock(L.body,ue)}evaluateBlock(L,ue){let Y="";for(const oe of L){const pe=this.evaluate(oe,ue);pe.type!=="NullValue"&&pe.type!=="UndefinedValue"&&(Y+=pe.toString())}return new $e(Y)}evaluateIdentifier(L,ue){return ue.lookupVariable(L.value)}evaluateCallExpression(L,ue){const[Y,oe]=this.evaluateArguments(L.args,ue);oe.size>0&&Y.push(new pt(oe));const pe=this.evaluate(L.callee,ue);if(pe.type!=="FunctionValue")throw new Error(`Cannot call something that is not a function: got ${pe.type}`);return pe.value(Y,ue)}evaluateSliceExpression(L,ue,Y){if(!(L instanceof dt||L instanceof $e))throw new Error("Slice object must be an array or string");const oe=this.evaluate(ue.start,Y),pe=this.evaluate(ue.stop,Y),Ce=this.evaluate(ue.step,Y);if(!(oe instanceof Be||oe instanceof rt))throw new Error("Slice start must be numeric or undefined");if(!(pe instanceof Be||pe instanceof rt))throw new Error("Slice stop must be numeric or undefined");if(!(Ce instanceof Be||Ce instanceof rt))throw new Error("Slice step must be numeric or undefined");return L instanceof dt?new dt(Ne(L.value,oe.value,pe.value,Ce.value)):new $e(Ne(Array.from(L.value),oe.value,pe.value,Ce.value).join(""))}evaluateMemberExpression(L,ue){const Y=this.evaluate(L.object,ue);let oe;if(L.computed){if(L.property.type==="SliceExpression")return this.evaluateSliceExpression(Y,L.property,ue);oe=this.evaluate(L.property,ue)}else oe=new $e(L.property.value);let pe;if(Y instanceof Je){if(!(oe instanceof $e))throw new Error(`Cannot access property with non-string: got ${oe.type}`);pe=Y.value.get(oe.value)??Y.builtins.get(oe.value)}else if(Y instanceof dt||Y instanceof $e)if(oe instanceof Be)pe=Y.value.at(oe.value),Y instanceof $e&&(pe=new $e(Y.value.at(oe.value)));else if(oe instanceof $e)pe=Y.builtins.get(oe.value);else throw new Error(`Cannot access property with non-string/non-number: got ${oe.type}`);else{if(!(oe instanceof $e))throw new Error(`Cannot access property with non-string: got ${oe.type}`);pe=Y.builtins.get(oe.value)}return pe instanceof Ke?pe:new rt}evaluateSet(L,ue){const Y=L.value?this.evaluate(L.value,ue):this.evaluateBlock(L.body,ue);if(L.assignee.type==="Identifier"){const oe=L.assignee.value;ue.setVariable(oe,Y)}else if(L.assignee.type==="TupleLiteral"){const oe=L.assignee;if(!(Y instanceof dt))throw new Error(`Cannot unpack non-iterable type in set: ${Y.type}`);const pe=Y.value;if(pe.length!==oe.value.length)throw new Error(`Too ${oe.value.length>pe.length?"few":"many"} items to unpack in set`);for(let Ce=0;Ce<oe.value.length;++Ce){const Ue=oe.value[Ce];if(Ue.type!=="Identifier")throw new Error(`Cannot unpack to non-identifier in set: ${Ue.type}`);ue.setVariable(Ue.value,pe[Ce])}}else if(L.assignee.type==="MemberExpression"){const oe=L.assignee,pe=this.evaluate(oe.object,ue);if(!(pe instanceof Je))throw new Error("Cannot assign to member of non-object");if(oe.property.type!=="Identifier")throw new Error("Cannot assign to member with non-identifier property");pe.value.set(oe.property.value,Y)}else throw new Error(`Invalid LHS inside assignment expression: ${JSON.stringify(L.assignee)}`);return new Ze}evaluateIf(L,ue){const Y=this.evaluate(L.test,ue);return this.evaluateBlock(Y.__bool__().value?L.body:L.alternate,ue)}evaluateFor(L,ue){const Y=new kt(ue);let oe,pe;if(L.iterable.type==="SelectExpression"){const ft=L.iterable;pe=this.evaluate(ft.lhs,Y),oe=ft.test}else pe=this.evaluate(L.iterable,Y);if(!(pe instanceof dt||pe instanceof Je))throw new Error(`Expected iterable or object type in for loop: got ${pe.type}`);pe instanceof Je&&(pe=pe.keys());const Ce=[],Ue=[];for(let ft=0;ft<pe.value.length;++ft){const Tt=new kt(Y),Et=pe.value[ft];let nn;if(L.loopvar.type==="Identifier")nn=xt=>xt.setVariable(L.loopvar.value,Et);else if(L.loopvar.type==="TupleLiteral"){const xt=L.loopvar;if(Et.type!=="ArrayValue")throw new Error(`Cannot unpack non-iterable type: ${Et.type}`);const Zt=Et;if(xt.value.length!==Zt.value.length)throw new Error(`Too ${xt.value.length>Zt.value.length?"few":"many"} items to unpack`);nn=wn=>{for(let Gn=0;Gn<xt.value.length;++Gn){if(xt.value[Gn].type!=="Identifier")throw new Error(`Cannot unpack non-identifier type: ${xt.value[Gn].type}`);wn.setVariable(xt.value[Gn].value,Zt.value[Gn])}}}else throw new Error(`Invalid loop variable(s): ${L.loopvar.type}`);oe&&(nn(Tt),!this.evaluate(oe,Tt).__bool__().value)||(Ce.push(Et),Ue.push(nn))}let Ye="",ct=!0;for(let ft=0;ft<Ce.length;++ft){const Tt=new Map([["index",new Be(ft+1)],["index0",new Be(ft)],["revindex",new Be(Ce.length-ft)],["revindex0",new Be(Ce.length-ft-1)],["first",new qe(ft===0)],["last",new qe(ft===Ce.length-1)],["length",new Be(Ce.length)],["previtem",ft>0?Ce[ft-1]:new rt],["nextitem",ft<Ce.length-1?Ce[ft+1]:new rt]]);Y.setVariable("loop",new Je(Tt)),Ue[ft](Y);try{const Et=this.evaluateBlock(L.body,Y);Ye+=Et.value}catch(Et){if(Et instanceof He)continue;if(Et instanceof Re)break;throw Et}ct=!1}if(ct){const ft=this.evaluateBlock(L.defaultBlock,Y);Ye+=ft.value}return new $e(Ye)}evaluateMacro(L,ue){return ue.setVariable(L.name.value,new vt((Y,oe)=>{var Ue;const pe=new kt(oe);Y=Y.slice();let Ce;((Ue=Y.at(-1))==null?void 0:Ue.type)==="KeywordArgumentsValue"&&(Ce=Y.pop());for(let Ye=0;Ye<L.args.length;++Ye){const ct=L.args[Ye],ft=Y[Ye];if(ct.type==="Identifier"){const Tt=ct;if(!ft)throw new Error(`Missing positional argument: ${Tt.value}`);pe.setVariable(Tt.value,ft)}else if(ct.type==="KeywordArgumentExpression"){const Tt=ct,Et=ft??(Ce==null?void 0:Ce.value.get(Tt.key.value))??this.evaluate(Tt.value,pe);pe.setVariable(Tt.key.value,Et)}else throw new Error(`Unknown argument type: ${ct.type}`)}return this.evaluateBlock(L.body,pe)})),new Ze}evaluateCallStatement(L,ue){const Y=new vt((Ye,ct)=>{const ft=new kt(ct);if(L.callerArgs)for(let Tt=0;Tt<L.callerArgs.length;++Tt){const Et=L.callerArgs[Tt];if(Et.type!=="Identifier")throw new Error(`Caller parameter must be an identifier, got ${Et.type}`);ft.setVariable(Et.value,Ye[Tt]??new rt)}return this.evaluateBlock(L.body,ft)}),[oe,pe]=this.evaluateArguments(L.call.args,ue);oe.push(new pt(pe));const Ce=this.evaluate(L.call.callee,ue);if(Ce.type!=="FunctionValue")throw new Error(`Cannot call something that is not a function: got ${Ce.type}`);const Ue=new kt(ue);return Ue.setVariable("caller",Y),Ce.value(oe,Ue)}evaluateFilterStatement(L,ue){const Y=this.evaluateBlock(L.body,ue);return this.applyFilter(Y,L.filter,ue)}evaluate(L,ue){if(!L)return new rt;switch(L.type){case"Program":return this.evalProgram(L,ue);case"Set":return this.evaluateSet(L,ue);case"If":return this.evaluateIf(L,ue);case"For":return this.evaluateFor(L,ue);case"Macro":return this.evaluateMacro(L,ue);case"CallStatement":return this.evaluateCallStatement(L,ue);case"Break":throw new Re;case"Continue":throw new He;case"IntegerLiteral":return new Be(L.value);case"FloatLiteral":return new nt(L.value);case"StringLiteral":return new $e(L.value);case"ArrayLiteral":return new dt(L.value.map(Y=>this.evaluate(Y,ue)));case"TupleLiteral":return new Gt(L.value.map(Y=>this.evaluate(Y,ue)));case"ObjectLiteral":{const Y=new Map;for(const[oe,pe]of L.value){const Ce=this.evaluate(oe,ue);if(!(Ce instanceof $e))throw new Error(`Object keys must be strings: got ${Ce.type}`);Y.set(Ce.value,this.evaluate(pe,ue))}return new Je(Y)}case"Identifier":return this.evaluateIdentifier(L,ue);case"CallExpression":return this.evaluateCallExpression(L,ue);case"MemberExpression":return this.evaluateMemberExpression(L,ue);case"UnaryExpression":return this.evaluateUnaryExpression(L,ue);case"BinaryExpression":return this.evaluateBinaryExpression(L,ue);case"FilterExpression":return this.evaluateFilterExpression(L,ue);case"FilterStatement":return this.evaluateFilterStatement(L,ue);case"TestExpression":return this.evaluateTestExpression(L,ue);case"SelectExpression":return this.evaluateSelectExpression(L,ue);case"Ternary":return this.evaluateTernaryExpression(L,ue);case"Comment":return new Ze;default:throw new SyntaxError(`Unknown node type: ${L.type}`)}}};function Fn(L){switch(typeof L){case"number":return Number.isInteger(L)?new Be(L):new nt(L);case"string":return new $e(L);case"boolean":return new qe(L);case"undefined":return new rt;case"object":return L===null?new Ze:Array.isArray(L)?new dt(L.map(Fn)):new Je(new Map(Object.entries(L).map(([ue,Y])=>[ue,Fn(Y)])));case"function":return new vt((ue,Y)=>{const oe=L(...ue.map(pe=>pe.value))??null;return Fn(oe)});default:throw new Error(`Cannot convert to runtime value: ${L}`)}}var tn=`
`,ta="{%- ",ds=" -%}";function fs(L){switch(L.operator.type){case"MultiplicativeBinaryOperator":return 4;case"AdditiveBinaryOperator":return 3;case"ComparisonBinaryOperator":return 2;case"Identifier":return L.operator.value==="and"?1:L.operator.value==="in"||L.operator.value==="not in"?2:0}return 0}function Wa(L,ue="	"){const Y=typeof ue=="number"?" ".repeat(ue):ue;return Er(L.body,0,Y).replace(/\n$/,"")}function Vn(...L){return ta+L.join(" ")+ds}function Er(L,ue,Y){return L.map(oe=>qr(oe,ue,Y)).join(tn)}function qr(L,ue,Y){const oe=Y.repeat(ue);switch(L.type){case"Program":return Er(L.body,ue,Y);case"If":return Pa(L,ue,Y);case"For":return Ft(L,ue,Y);case"Set":return ns(L,ue,Y);case"Macro":return Ha(L,ue,Y);case"Break":return oe+Vn("break");case"Continue":return oe+Vn("continue");case"CallStatement":return Dn(L,ue,Y);case"FilterStatement":return Kr(L,ue,Y);case"Comment":return oe+"{# "+L.value+" #}";default:return oe+"{{- "+an(L)+" -}}"}}function Pa(L,ue,Y){const oe=Y.repeat(ue),pe=[];let Ce=L;for(;Ce&&(pe.push({test:Ce.test,body:Ce.body}),Ce.alternate.length===1&&Ce.alternate[0].type==="If");)Ce=Ce.alternate[0];let Ue=oe+Vn("if",an(pe[0].test))+tn+Er(pe[0].body,ue+1,Y);for(let Ye=1;Ye<pe.length;++Ye)Ue+=tn+oe+Vn("elif",an(pe[Ye].test))+tn+Er(pe[Ye].body,ue+1,Y);return Ce&&Ce.alternate.length>0&&(Ue+=tn+oe+Vn("else")+tn+Er(Ce.alternate,ue+1,Y)),Ue+=tn+oe+Vn("endif"),Ue}function Ft(L,ue,Y){const oe=Y.repeat(ue);let pe="";if(L.iterable.type==="SelectExpression"){const Ue=L.iterable;pe=`${an(Ue.lhs)} if ${an(Ue.test)}`}else pe=an(L.iterable);let Ce=oe+Vn("for",an(L.loopvar),"in",pe)+tn+Er(L.body,ue+1,Y);return L.defaultBlock.length>0&&(Ce+=tn+oe+Vn("else")+tn+Er(L.defaultBlock,ue+1,Y)),Ce+=tn+oe+Vn("endfor"),Ce}function ns(L,ue,Y){const oe=Y.repeat(ue),pe=an(L.assignee),Ce=L.value?an(L.value):"",Ue=oe+Vn("set",`${pe}${L.value?" = "+Ce:""}`);return L.body.length===0?Ue:Ue+tn+Er(L.body,ue+1,Y)+tn+oe+Vn("endset")}function Ha(L,ue,Y){const oe=Y.repeat(ue),pe=L.args.map(an).join(", ");return oe+Vn("macro",`${L.name.value}(${pe})`)+tn+Er(L.body,ue+1,Y)+tn+oe+Vn("endmacro")}function Dn(L,ue,Y){const oe=Y.repeat(ue),pe=L.callerArgs&&L.callerArgs.length>0?`(${L.callerArgs.map(an).join(", ")})`:"",Ce=an(L.call);let Ue=oe+Vn(`call${pe}`,Ce)+tn;return Ue+=Er(L.body,ue+1,Y)+tn,Ue+=oe+Vn("endcall"),Ue}function Kr(L,ue,Y){const oe=Y.repeat(ue),pe=L.filter.type==="Identifier"?L.filter.value:an(L.filter);let Ce=oe+Vn("filter",pe)+tn;return Ce+=Er(L.body,ue+1,Y)+tn,Ce+=oe+Vn("endfilter"),Ce}function an(L,ue=-1){switch(L.type){case"SpreadExpression":return`*${an(L.argument)}`;case"Identifier":return L.value;case"IntegerLiteral":return`${L.value}`;case"FloatLiteral":return`${L.value}`;case"StringLiteral":return JSON.stringify(L.value);case"BinaryExpression":{const Y=L,oe=fs(Y),pe=an(Y.left,oe),Ce=an(Y.right,oe+1),Ue=`${pe} ${Y.operator.value} ${Ce}`;return oe<ue?`(${Ue})`:Ue}case"UnaryExpression":{const Y=L;return Y.operator.value+(Y.operator.value==="not"?" ":"")+an(Y.argument,1/0)}case"CallExpression":{const Y=L,oe=Y.args.map(an).join(", ");return`${an(Y.callee)}(${oe})`}case"MemberExpression":{const Y=L;let oe=an(Y.object);["Identifier","MemberExpression","CallExpression","StringLiteral","IntegerLiteral","FloatLiteral","ArrayLiteral","TupleLiteral","ObjectLiteral"].includes(Y.object.type)||(oe=`(${oe})`);let pe=an(Y.property);return!Y.computed&&Y.property.type!=="Identifier"&&(pe=`(${pe})`),Y.computed?`${oe}[${pe}]`:`${oe}.${pe}`}case"FilterExpression":{const Y=L,oe=an(Y.operand,1/0);return Y.filter.type==="CallExpression"?`${oe} | ${an(Y.filter)}`:`${oe} | ${Y.filter.value}`}case"SelectExpression":{const Y=L;return`${an(Y.lhs)} if ${an(Y.test)}`}case"TestExpression":{const Y=L;return`${an(Y.operand)} is${Y.negate?" not":""} ${Y.test.value}`}case"ArrayLiteral":case"TupleLiteral":{const Y=L.value.map(an),oe=L.type==="ArrayLiteral"?"[]":"()";return`${oe[0]}${Y.join(", ")}${oe[1]}`}case"ObjectLiteral":return`{${Array.from(L.value.entries()).map(([oe,pe])=>`${an(oe)}: ${an(pe)}`).join(", ")}}`;case"SliceExpression":{const Y=L,oe=Y.start?an(Y.start):"",pe=Y.stop?an(Y.stop):"",Ce=Y.step?`:${an(Y.step)}`:"";return`${oe}:${pe}${Ce}`}case"KeywordArgumentExpression":{const Y=L;return`${Y.key.value}=${an(Y.value)}`}case"Ternary":{const Y=L,oe=`${an(Y.trueExpr)} if ${an(Y.condition,0)} else ${an(Y.falseExpr)}`;return ue>-1?`(${oe})`:oe}default:throw new Error(`Unknown expression type: ${L.type}`)}}var Qa=class{constructor(L){ge(this,"parsed");const ue=p(L,{lstrip_blocks:!0,trim_blocks:!0});this.parsed=Me(ue)}render(L){const ue=new kt;if(Nt(ue),L)for(const[pe,Ce]of Object.entries(L))ue.set(pe,Ce);return new Cn(ue).run(this.parsed).value}format(L){return Wa(this.parsed,(L==null?void 0:L.indent)||"	")}}}),"./src/backends/onnx.js":((e,t,n)=>{var s;n.r(t),n.d(t,{Tensor:()=>d.Tensor,createInferenceSession:()=>O,deviceToExecutionProviders:()=>v,isONNXProxy:()=>C,isONNXTensor:()=>I,runInferenceSession:()=>D});var i=n("./src/env.js"),o=n("?2ce3"),c=n("onnxruntime-web"),d=n("onnxruntime-common");const u=Object.freeze({auto:null,gpu:null,cpu:"cpu",wasm:"wasm",webgpu:"webgpu",cuda:"cuda",dml:"dml",webnn:{name:"webnn",deviceType:"cpu"},"webnn-npu":{name:"webnn",deviceType:"npu"},"webnn-gpu":{name:"webnn",deviceType:"gpu"},"webnn-cpu":{name:"webnn",deviceType:"cpu"}}),h=[];let g,p;const m=Symbol.for("onnxruntime");if(m in globalThis)p=globalThis[m];else if(i.apis.IS_NODE_ENV){switch(p=o??(s||(s=n.t(o,2))),process.platform){case"win32":h.push("dml");break;case"linux":process.arch==="x64"&&h.push("cuda");break}h.push("cpu"),g=["cpu"]}else p=c,i.apis.IS_WEBNN_AVAILABLE&&h.push("webnn-npu","webnn-gpu","webnn-cpu","webnn"),i.apis.IS_WEBGPU_AVAILABLE&&h.push("webgpu"),h.push("wasm"),g=["wasm"];const y=p.InferenceSession;function v(A=null){if(!A)return g;switch(A){case"auto":return h;case"gpu":return h.filter(k=>["webgpu","cuda","dml","webnn-gpu"].includes(k))}if(h.includes(A))return[u[A]??A];throw new Error(`Unsupported device: "${A}". Should be one of: ${h.join(", ")}.`)}let T=null;async function O(A,k,R){T&&await T;const G=y.create(A,k);T??(T=G);const te=await G;return te.config=R,te}let E=Promise.resolve();const S=i.apis.IS_BROWSER_ENV||i.apis.IS_WEBWORKER_ENV;async function D(A,k){const R=()=>A.run(k);return await(S?E=E.then(R):R())}function I(A){return A instanceof p.Tensor}const M=p==null?void 0:p.env;M!=null&&M.wasm&&(!(typeof ServiceWorkerGlobalScope<"u"&&self instanceof ServiceWorkerGlobalScope)&&!M.wasm.wasmPaths&&(M.wasm.wasmPaths=`https://cdn.jsdelivr.net/npm/@huggingface/transformers@${i.env.version}/dist/`),M.wasm.proxy=!1),M!=null&&M.webgpu&&(M.webgpu.powerPreference="high-performance");function C(){var A;return(A=M==null?void 0:M.wasm)==null?void 0:A.proxy}i.env.backends.onnx=M}),"./src/base/feature_extraction_utils.js":((e,t,n)=>{n.r(t),n.d(t,{FeatureExtractor:()=>c,validate_audio_inputs:()=>d});var s=n("./src/utils/constants.js"),i=n("./src/utils/generic.js"),o=n("./src/utils/hub.js");class c extends i.Callable{constructor(h){super(),this.config=h}static async from_pretrained(h,g={}){const p=await(0,o.getModelJSON)(h,s.FEATURE_EXTRACTOR_NAME,!0,g);return new this(p)}}function d(u,h){var g;if(!(u instanceof Float32Array||u instanceof Float64Array))throw new Error(`${h} expects input to be a Float32Array or a Float64Array, but got ${((g=u==null?void 0:u.constructor)==null?void 0:g.name)??typeof u} instead. If using the feature extractor directly, remember to use \`read_audio(url, sampling_rate)\` to obtain the raw audio data of the file/url.`)}}),"./src/base/image_processors_utils.js":((e,t,n)=>{n.r(t),n.d(t,{ImageProcessor:()=>I,center_to_corners_format:()=>p,post_process_instance_segmentation:()=>D,post_process_object_detection:()=>m,post_process_panoptic_segmentation:()=>S,post_process_semantic_segmentation:()=>y});var s=n("./src/utils/generic.js"),i=n("./src/utils/tensor.js"),o=n("./src/utils/maths.js");n("./src/utils/image.js");var c=n("./src/utils/core.js"),d=n("./src/utils/hub.js"),u=n("./src/utils/constants.js");function h(M,C,A=0,k=null){const R=M/C;let G=(0,o.bankers_round)(R)*C;return k!==null&&G>k&&(G=Math.floor(R)*C),G<A&&(G=Math.ceil(R)*C),G}function g([M,C],A){return[Math.max(Math.floor(M/A),1)*A,Math.max(Math.floor(C/A),1)*A]}function p([M,C,A,k]){return[M-A/2,C-k/2,M+A/2,C+k/2]}function m(M,C=.5,A=null,k=!1){const R=M.logits,G=M.pred_boxes,[te,ee,X]=R.dims;if(A!==null&&A.length!==te)throw Error("Make sure that you pass in as many target sizes as the batch dimension of the logits");let le=[];for(let ae=0;ae<te;++ae){let Q=A!==null?A[ae]:null,ne={boxes:[],classes:[],scores:[]},de=R[ae],ve=G[ae];for(let fe=0;fe<ee;++fe){let j=de[fe],U=[],N;if(k){N=j.sigmoid().data;for(let q=0;q<N.length;++q)N[q]>C&&U.push(q)}else{let q=(0,o.max)(j.data)[1];if(q===X-1||(N=(0,o.softmax)(j.data),N[q]<C))continue;U.push(q)}for(const q of U){let ce=ve[fe].data;ce=p(ce),Q!==null&&(ce=ce.map((Z,Me)=>Z*Q[(Me+1)%2])),ne.boxes.push(ce),ne.classes.push(q),ne.scores.push(N[q])}}le.push(ne)}return le}function y(M,C=null){const A=M.logits,k=A.dims[0];if(C!==null&&C.length!==k)throw Error("Make sure that you pass in as many target sizes as the batch dimension of the logits");const R=[];for(let G=0;G<k;++G){const te=C!==null?C[G]:null;let ee=A[G];te!==null&&(ee=(0,i.interpolate)(ee,te,"bilinear",!1));const[X,le]=te??ee.dims.slice(-2),ae=new i.Tensor("int32",new Int32Array(X*le),[X,le]),Q=ee[0].data,ne=ae.data;for(let fe=1;fe<ee.dims[0];++fe){const j=ee[fe].data;for(let U=0;U<j.length;++U)j[U]>Q[U]&&(Q[U]=j[U],ne[U]=fe)}const de=new Array(ee.dims[0]);for(let fe=0;fe<ne.length;++fe){const j=ne[fe];de[j]=j}const ve=de.filter(fe=>fe!==void 0);R.push({segmentation:ae,labels:ve})}return R}function v(M,C,A,k){const R=[],G=[],te=[];for(let ee=0;ee<M.dims[0];++ee){const X=M[ee],le=C[ee],ae=(0,o.max)(X.data)[1];if(ae===k)continue;const ne=(0,o.softmax)(X.data)[ae];ne>A&&(R.push(le),G.push(ne),te.push(ae))}return[R,G,te]}function T(M,C,A,k=.5,R=.8){const G=[];let te=0,ee=0;const X=C[A].data;for(let ae=0;ae<M.length;++ae)M[ae]===A&&(G.push(ae),++te),X[ae]>=k&&++ee;let le=te>0&&ee>0;return le&&(le=te/ee>R),[le,G]}function O(M,C,A,k,R,G=null,te=null){const[ee,X]=te??M[0].dims,le=new i.Tensor("int32",new Int32Array(ee*X),[ee,X]),ae=[];if(te!==null)for(let fe=0;fe<M.length;++fe)M[fe]=(0,i.interpolate)(M[fe],te,"bilinear",!1);const Q=new Int32Array(M[0].data.length),ne=new Float32Array(M[0].data.length);for(let fe=0;fe<M.length;++fe){let j=C[fe];const U=M[fe].data;for(let N=0;N<U.length;++N)U[N]*=j,U[N]>ne[N]&&(Q[N]=fe,ne[N]=U[N])}let de=0;const ve=le.data;for(let fe=0;fe<A.length;++fe){const j=A[fe],[U,N]=T(Q,M,fe,k,R);if(U){++de;for(const q of N)ve[q]=de;ae.push({id:de,label_id:j,score:C[fe]})}}return[le,ae]}function E(M,C,A=28,k=3136,R=784*1280){if(M<A||C<A)throw new Error(`height:${M} or width:${C} must be larger than factor:${A}`);if(Math.max(M,C)/Math.min(M,C)>200)throw new Error(`absolute aspect ratio must be smaller than 200, got ${Math.max(M,C)/Math.min(M,C)}`);let G=Math.round(M/A)*A,te=Math.round(C/A)*A;if(G*te>R){const ee=Math.sqrt(M*C/R);G=Math.floor(M/ee/A)*A,te=Math.floor(C/ee/A)*A}else if(G*te<k){const ee=Math.sqrt(k/(M*C));G=Math.ceil(M*ee/A)*A,te=Math.ceil(C*ee/A)*A}return[G,te]}function S(M,C=.5,A=.5,k=.8,R=null,G=null){R===null&&(console.warn("`label_ids_to_fuse` unset. No instance will be fused."),R=new Set);const te=M.class_queries_logits??M.logits,X=(M.masks_queries_logits??M.pred_masks).sigmoid();let[le,ae,Q]=te.dims;if(Q-=1,G!==null&&G.length!==le)throw Error("Make sure that you pass in as many target sizes as the batch dimension of the logits");let ne=[];for(let de=0;de<le;++de){let ve=G!==null?G[de]:null,fe=te[de],j=X[de],[U,N,q]=v(fe,j,C,Q);if(q.length===0){let[Me,Pe]=ve??j.dims.slice(-2),Ne=new i.Tensor("int32",new Int32Array(Me*Pe).fill(-1),[Me,Pe]);ne.push({segmentation:Ne,segments_info:[]});continue}let[ce,Z]=O(U,N,q,A,k,R,ve);ne.push({segmentation:ce,segments_info:Z})}return ne}function D(M,C=.5,A=null){throw new Error("`post_process_instance_segmentation` is not yet implemented.")}class I extends s.Callable{constructor(C){super(),this.image_mean=C.image_mean??C.mean,this.image_std=C.image_std??C.std,this.resample=C.resample??2,this.do_rescale=C.do_rescale??!0,this.rescale_factor=C.rescale_factor??1/255,this.do_normalize=C.do_normalize,this.do_thumbnail=C.do_thumbnail,this.size=C.size??C.image_size,this.do_resize=C.do_resize??this.size!==void 0,this.size_divisibility=C.size_divisibility??C.size_divisor,this.do_center_crop=C.do_center_crop,this.crop_size=C.crop_size,this.do_convert_rgb=C.do_convert_rgb??!0,this.do_crop_margin=C.do_crop_margin,this.pad_size=C.pad_size,this.do_pad=C.do_pad,this.min_pixels=C.min_pixels,this.max_pixels=C.max_pixels,this.do_pad&&!this.pad_size&&this.size&&this.size.width!==void 0&&this.size.height!==void 0&&(this.pad_size=this.size),this.do_flip_channel_order=C.do_flip_channel_order??!1,this.config=C}async thumbnail(C,A,k=2){const R=C.height,G=C.width,te=A.height,ee=A.width;let X=Math.min(R,te),le=Math.min(G,ee);return X===R&&le===G?C:(R>G?le=Math.floor(G*X/R):G>R&&(X=Math.floor(R*le/G)),await C.resize(le,X,{resample:k}))}async crop_margin(C,A=200){const k=C.clone().grayscale(),R=(0,o.min)(k.data)[0],te=(0,o.max)(k.data)[0]-R;if(te===0)return C;const ee=A/255;let X=k.width,le=k.height,ae=0,Q=0;const ne=k.data;for(let de=0;de<k.height;++de){const ve=de*k.width;for(let fe=0;fe<k.width;++fe)(ne[ve+fe]-R)/te<ee&&(X=Math.min(X,fe),le=Math.min(le,de),ae=Math.max(ae,fe),Q=Math.max(Q,de))}return C=await C.crop([X,le,ae,Q]),C}pad_image(C,A,k,{mode:R="constant",center:G=!1,constant_values:te=0}={}){const[ee,X,le]=A;let ae,Q;if(typeof k=="number"?(ae=k,Q=k):k==="square"?ae=Q=Math.max(ee,X):(ae=k.width,Q=k.height),ae!==X||Q!==ee){const ne=new Float32Array(ae*Q*le);if(Array.isArray(te))for(let fe=0;fe<ne.length;++fe)ne[fe]=te[fe%le];else te!==0&&ne.fill(te);const[de,ve]=G?[Math.floor((ae-X)/2),Math.floor((Q-ee)/2)]:[0,0];for(let fe=0;fe<ee;++fe){const j=(fe+ve)*ae,U=fe*X;for(let N=0;N<X;++N){const q=(j+N+de)*le,ce=(U+N)*le;for(let Z=0;Z<le;++Z)ne[q+Z]=C[ce+Z]}}if(R==="symmetric"){if(G)throw new Error("`center` padding is not supported when `mode` is set to `symmetric`.");const fe=ee-1,j=X-1;for(let U=0;U<Q;++U){const N=U*ae,q=(0,c.calculateReflectOffset)(U,fe)*X;for(let ce=0;ce<ae;++ce){if(U<ee&&ce<X)continue;const Z=(N+ce)*le,Me=(q+(0,c.calculateReflectOffset)(ce,j))*le;for(let Pe=0;Pe<le;++Pe)ne[Z+Pe]=C[Me+Pe]}}}C=ne,A=[Q,ae,le]}return[C,A]}rescale(C){for(let A=0;A<C.length;++A)C[A]=this.rescale_factor*C[A]}get_resize_output_image_size(C,A){const[k,R]=C.size;let G,te;if(this.do_thumbnail){const{height:ee,width:X}=A;G=Math.min(ee,X)}else Number.isInteger(A)?(G=A,te=this.config.max_size??G):A!==void 0&&(G=A.shortest_edge,te=A.longest_edge);if(G!==void 0||te!==void 0){const ee=G===void 0?1:Math.max(G/k,G/R),X=k*ee,le=R*ee,ae=te===void 0?1:Math.min(te/X,te/le);let Q=Math.floor(Number((X*ae).toFixed(2))),ne=Math.floor(Number((le*ae).toFixed(2)));return this.size_divisibility!==void 0&&([Q,ne]=g([Q,ne],this.size_divisibility)),[Q,ne]}else if(A!==void 0&&A.width!==void 0&&A.height!==void 0){let ee=A.width,X=A.height;if(this.config.keep_aspect_ratio&&this.config.ensure_multiple_of){let le=X/R,ae=ee/k;Math.abs(1-ae)<Math.abs(1-le)?le=ae:ae=le,X=h(le*R,this.config.ensure_multiple_of),ee=h(ae*k,this.config.ensure_multiple_of)}return[ee,X]}else{if(this.size_divisibility!==void 0)return g([k,R],this.size_divisibility);if(this.min_pixels!==void 0&&this.max_pixels!==void 0){const ee=this.config.patch_size*this.config.merge_size;return E(R,k,ee,this.min_pixels,this.max_pixels)}else throw new Error(`Could not resize image due to unsupported \`this.size\` option in config: ${JSON.stringify(A)}`)}}async resize(C){const[A,k]=this.get_resize_output_image_size(C,this.size);return await C.resize(A,k,{resample:this.resample})}async preprocess(C,{do_normalize:A=null,do_pad:k=null,do_convert_rgb:R=null,do_convert_grayscale:G=null,do_flip_channel_order:te=null}={}){this.do_crop_margin&&(C=await this.crop_margin(C));const[ee,X]=C.size;if(R??this.do_convert_rgb?C=C.rgb():G&&(C=C.grayscale()),this.do_resize&&(C=await this.resize(C)),this.do_thumbnail&&(C=await this.thumbnail(C,this.size,this.resample)),this.do_center_crop){let de,ve;Number.isInteger(this.crop_size)?(de=this.crop_size,ve=this.crop_size):(de=this.crop_size.width,ve=this.crop_size.height),C=await C.center_crop(de,ve)}const le=[C.height,C.width];let ae=Float32Array.from(C.data),Q=[C.height,C.width,C.channels];if(this.do_rescale&&this.rescale(ae),A??this.do_normalize){let de=this.image_mean;Array.isArray(this.image_mean)||(de=new Array(C.channels).fill(de));let ve=this.image_std;if(Array.isArray(this.image_std)||(ve=new Array(C.channels).fill(ve)),de.length!==C.channels||ve.length!==C.channels)throw new Error(`When set to arrays, the length of \`image_mean\` (${de.length}) and \`image_std\` (${ve.length}) must match the number of channels in the image (${C.channels}).`);for(let fe=0;fe<ae.length;fe+=C.channels)for(let j=0;j<C.channels;++j)ae[fe+j]=(ae[fe+j]-de[j])/ve[j]}if(k??this.do_pad){if(this.pad_size)[ae,Q]=this.pad_image(ae,[C.height,C.width,C.channels],this.pad_size);else if(this.size_divisibility){const[de,ve]=g([Q[1],Q[0]],this.size_divisibility);[ae,Q]=this.pad_image(ae,Q,{width:de,height:ve})}}if(te??this.do_flip_channel_order){if(Q[2]!==3)throw new Error("Flipping channel order is only supported for RGB images.");for(let de=0;de<ae.length;de+=3){const ve=ae[de];ae[de]=ae[de+2],ae[de+2]=ve}}const ne=new i.Tensor("float32",ae,Q).permute(2,0,1);return{original_size:[X,ee],reshaped_input_size:le,pixel_values:ne}}async _call(C,...A){Array.isArray(C)||(C=[C]);const k=await Promise.all(C.map(G=>this.preprocess(G)));return{pixel_values:(0,i.stack)(k.map(G=>G.pixel_values),0),original_sizes:k.map(G=>G.original_size),reshaped_input_sizes:k.map(G=>G.reshaped_input_size)}}static async from_pretrained(C,A={}){const k=await(0,d.getModelJSON)(C,u.IMAGE_PROCESSOR_NAME,!0,A);return new this(k)}}}),"./src/base/processing_utils.js":((e,t,n)=>{n.r(t),n.d(t,{Processor:()=>c});var s=n("./src/utils/constants.js"),i=n("./src/utils/generic.js"),o=n("./src/utils/hub.js");class c extends i.Callable{constructor(u,h,g){super(),this.config=u,this.components=h,this.chat_template=g}get image_processor(){return this.components.image_processor}get tokenizer(){return this.components.tokenizer}get feature_extractor(){return this.components.feature_extractor}apply_chat_template(u,h={}){if(!this.tokenizer)throw new Error("Unable to apply chat template without a tokenizer.");return this.tokenizer.apply_chat_template(u,{tokenize:!1,chat_template:this.chat_template??void 0,...h})}batch_decode(...u){if(!this.tokenizer)throw new Error("Unable to decode without a tokenizer.");return this.tokenizer.batch_decode(...u)}decode(...u){if(!this.tokenizer)throw new Error("Unable to decode without a tokenizer.");return this.tokenizer.decode(...u)}async _call(u,...h){for(const g of[this.image_processor,this.feature_extractor,this.tokenizer])if(g)return g(u,...h);throw new Error("No image processor, feature extractor, or tokenizer found.")}static async from_pretrained(u,h={}){const[g,p,m]=await Promise.all([this.uses_processor_config?(0,o.getModelJSON)(u,s.PROCESSOR_NAME,!0,h):{},Promise.all(this.classes.filter(y=>y in this).map(async y=>{const v=await this[y].from_pretrained(u,h);return[y.replace(/_class$/,""),v]})).then(Object.fromEntries),this.uses_chat_template_file?(0,o.getModelText)(u,s.CHAT_TEMPLATE_NAME,!0,h):null]);return new this(g,p,m)}}ge(c,"classes",["image_processor_class","tokenizer_class","feature_extractor_class"]),ge(c,"uses_processor_config",!1),ge(c,"uses_chat_template_file",!1)}),"./src/configs.js":((e,t,n)=>{n.r(t),n.d(t,{AutoConfig:()=>g,PretrainedConfig:()=>h,getCacheShapes:()=>d});var s=n("./src/utils/core.js"),i=n("./src/utils/hub.js");async function o(p,m){return await(0,i.getModelJSON)(p,"config.json",!0,m)}function c(p){const m={};let y={};switch(p.model_type){case"llava":case"paligemma":case"gemma3":case"florence2":case"llava_onevision":case"idefics3":case"ultravox":case"voxtral":case"smolvlm":case"gemma3n":case"mistral3":y=c(p.text_config);break;case"moondream1":y=c(p.phi_config);break;case"musicgen":y=c(p.decoder);break;case"multi_modality":y=c(p.language_config);break;case"gpt2":case"gptj":case"jais":case"codegen":case"gpt_bigcode":m.num_heads="n_head",m.num_layers="n_layer",m.hidden_size="n_embd";break;case"gpt_neox":case"stablelm":case"opt":case"falcon":case"modernbert-decoder":m.num_heads="num_attention_heads",m.num_layers="num_hidden_layers",m.hidden_size="hidden_size";break;case"llama":case"llama4_text":case"nanochat":case"arcee":case"lfm2":case"smollm3":case"olmo":case"olmo2":case"mobilellm":case"granite":case"granitemoehybrid":case"cohere":case"mistral":case"starcoder2":case"qwen2":case"qwen2_vl":case"phi":case"phi3":case"phi3_v":case"llava_qwen2":m.num_heads="num_key_value_heads",m.num_layers="num_hidden_layers",m.hidden_size="hidden_size",m.num_attention_heads="num_attention_heads",m.dim_kv="head_dim";break;case"qwen3":case"gemma":case"gemma2":case"vaultgemma":case"gemma3_text":case"gemma3n_text":case"glm":case"helium":case"ernie4_5":case"ministral":case"ministral3":m.num_heads="num_key_value_heads",m.num_layers="num_hidden_layers",m.dim_kv="head_dim";break;case"openelm":m.num_heads="num_kv_heads",m.num_layers="num_transformer_layers",m.dim_kv="head_dim";break;case"gpt_neo":case"donut-swin":m.num_heads="num_heads",m.num_layers="num_layers",m.hidden_size="hidden_size";break;case"bloom":m.num_heads="n_head",m.num_layers="n_layer",m.hidden_size="hidden_size";break;case"mpt":m.num_heads="n_heads",m.num_layers="n_layers",m.hidden_size="d_model";break;case"exaone":m.num_heads="num_key_value_heads",m.num_layers="num_layers",m.dim_kv="head_dim",m.num_attention_heads="num_attention_heads";break;case"t5":case"mt5":case"longt5":m.num_decoder_layers="num_decoder_layers",m.num_decoder_heads="num_heads",m.decoder_dim_kv="d_kv",m.num_encoder_layers="num_layers",m.num_encoder_heads="num_heads",m.encoder_dim_kv="d_kv";break;case"bart":case"mbart":case"marian":case"whisper":case"lite-whisper":case"m2m_100":case"blenderbot":case"blenderbot-small":case"florence2_language":m.num_decoder_layers="decoder_layers",m.num_decoder_heads="decoder_attention_heads",m.decoder_hidden_size="d_model",m.num_encoder_layers="encoder_layers",m.num_encoder_heads="encoder_attention_heads",m.encoder_hidden_size="d_model";break;case"speecht5":m.num_decoder_layers="decoder_layers",m.num_decoder_heads="decoder_attention_heads",m.decoder_hidden_size="hidden_size",m.num_encoder_layers="encoder_layers",m.num_encoder_heads="encoder_attention_heads",m.encoder_hidden_size="hidden_size";break;case"trocr":m.num_encoder_layers=m.num_decoder_layers="decoder_layers",m.num_encoder_heads=m.num_decoder_heads="decoder_attention_heads",m.encoder_hidden_size=m.decoder_hidden_size="d_model";break;case"musicgen_decoder":m.num_encoder_layers=m.num_decoder_layers="num_hidden_layers",m.num_encoder_heads=m.num_decoder_heads="num_attention_heads",m.encoder_hidden_size=m.decoder_hidden_size="hidden_size";break;case"moonshine":m.num_decoder_layers="decoder_num_hidden_layers",m.num_decoder_heads="decoder_num_key_value_heads",m.num_encoder_layers="encoder_num_hidden_layers",m.num_encoder_heads="encoder_num_key_value_heads",m.encoder_hidden_size=m.decoder_hidden_size="hidden_size";break;case"vision-encoder-decoder":const T=c(p.decoder),O="num_decoder_layers"in T,E=(0,s.pick)(p,["model_type","is_encoder_decoder"]);return O?(E.num_decoder_layers=T.num_decoder_layers,E.num_decoder_heads=T.num_decoder_heads,E.decoder_hidden_size=T.decoder_hidden_size,E.num_encoder_layers=T.num_encoder_layers,E.num_encoder_heads=T.num_encoder_heads,E.encoder_hidden_size=T.encoder_hidden_size):(E.num_layers=T.num_layers,E.num_heads=T.num_heads,E.hidden_size=T.hidden_size),E}const v={...y,...(0,s.pick)(p,["model_type","multi_query","is_encoder_decoder"])};for(const T in m)v[T]=p[m[T]];return v}function d(p,m){if(p.model_type==="lfm2"){const y=(m==null?void 0:m.prefix)??"past_key_values",v=y==="present"?"present":"past",T={},{layer_types:O,num_attention_heads:E,num_key_value_heads:S,hidden_size:D,conv_L_cache:I}=p,M=D/E,C=(m==null?void 0:m.batch_size)??1;for(let A=0;A<O.length;++A)if(O[A]==="full_attention")for(const k of["key","value"])T[`${y}.${A}.${k}`]=[C,S,0,M];else if(O[A]==="conv")T[`${v}_conv.${A}`]=[C,D,I];else throw new Error(`Unsupported layer type: ${O[A]}`);return T}return u(p,m)}function u(p,{prefix:m="past_key_values",batch_size:y=1}={}){const v={},T=p.normalized_config;if(T.is_encoder_decoder&&"num_encoder_heads"in T&&"num_decoder_heads"in T){const O=T.encoder_dim_kv??T.encoder_hidden_size/T.num_encoder_heads,E=T.decoder_dim_kv??T.decoder_hidden_size/T.num_decoder_heads,S=[y,T.num_encoder_heads,0,O],D=[y,T.num_decoder_heads,0,E];for(let I=0;I<T.num_decoder_layers;++I)v[`${m}.${I}.encoder.key`]=S,v[`${m}.${I}.encoder.value`]=S,v[`${m}.${I}.decoder.key`]=D,v[`${m}.${I}.decoder.value`]=D}else{const O=T.num_heads,E=T.num_layers,S=T.dim_kv??T.hidden_size/(T.num_attention_heads??O);if(T.model_type==="falcon"){const D=[y*O,0,S];for(let I=0;I<E;++I)v[`${m}.${I}.key`]=D,v[`${m}.${I}.value`]=D}else if(T.multi_query){const D=[y*O,0,2*S];for(let I=0;I<E;++I)v[`${m}.${I}.key_value`]=D}else if(T.model_type==="bloom"){const D=[y*O,S,0],I=[y*O,0,S];for(let M=0;M<E;++M)v[`${m}.${M}.key`]=D,v[`${m}.${M}.value`]=I}else if(T.model_type==="openelm")for(let D=0;D<E;++D){const I=[y,O[D],0,S];v[`${m}.${D}.key`]=I,v[`${m}.${D}.value`]=I}else{const D=[y,O,0,S];for(let I=0;I<E;++I)v[`${m}.${I}.key`]=D,v[`${m}.${I}.value`]=D}}return v}class h{constructor(m){ge(this,"model_type",null);ge(this,"is_encoder_decoder",!1);ge(this,"max_position_embeddings");ge(this,"transformers.js_config");Object.assign(this,m),this.normalized_config=c(this)}static async from_pretrained(m,{progress_callback:y=null,config:v=null,cache_dir:T=null,local_files_only:O=!1,revision:E="main"}={}){v&&!(v instanceof h)&&(v=new h(v));const S=v??await o(m,{progress_callback:y,config:v,cache_dir:T,local_files_only:O,revision:E});return new this(S)}}class g{static async from_pretrained(...m){return h.from_pretrained(...m)}}}),"./src/env.js":((e,t,n)=>{var R,G;n.r(t),n.d(t,{apis:()=>E,env:()=>A});var s=n("?db59"),i=n("?383f"),o=n("?fa4b");const c="3.8.1",d=typeof window<"u"&&typeof window.document<"u",u=typeof self<"u"&&["DedicatedWorkerGlobalScope","ServiceWorkerGlobalScope","SharedWorkerGlobalScope"].includes((R=self.constructor)==null?void 0:R.name),h=typeof self<"u"&&"caches"in self,g=typeof navigator<"u"&&"gpu"in navigator,p=typeof navigator<"u"&&"ml"in navigator,m=typeof process<"u",y=m&&((G=process==null?void 0:process.release)==null?void 0:G.name)==="node",v=!k(s),T=!k(i),O=typeof globalThis.Deno<"u",E=Object.freeze({IS_BROWSER_ENV:d,IS_WEBWORKER_ENV:u,IS_WEB_CACHE_AVAILABLE:h,IS_WEBGPU_AVAILABLE:g,IS_WEBNN_AVAILABLE:p,IS_PROCESS_AVAILABLE:m,IS_NODE_ENV:y,IS_FS_AVAILABLE:v,IS_PATH_AVAILABLE:T}),S=v&&T;let D="./";if(S){const te=Object(import.meta).url;te?D=i.dirname(i.dirname(o.fileURLToPath(te))):typeof __dirname<"u"&&(D=i.dirname(__dirname))}const I=S?i.join(D,"/.cache/"):null,M="/models/",C=S?i.join(D,M):M,A={version:c,backends:{onnx:{}},allowRemoteModels:!0,remoteHost:"https://huggingface.co/",remotePathTemplate:"{model}/resolve/{revision}/",allowLocalModels:!(d||u),localModelPath:C,useFS:v,useBrowserCache:h&&!O,useFSCache:v,cacheDir:I,useCustomCache:!1,customCache:null};function k(te){return Object.keys(te).length===0}}),"./src/generation/configuration_utils.js":((e,t,n)=>{n.r(t),n.d(t,{GenerationConfig:()=>i});var s=n("./src/utils/core.js");class i{constructor(c){ge(this,"max_length",20);ge(this,"max_new_tokens",null);ge(this,"min_length",0);ge(this,"min_new_tokens",null);ge(this,"early_stopping",!1);ge(this,"max_time",null);ge(this,"do_sample",!1);ge(this,"num_beams",1);ge(this,"num_beam_groups",1);ge(this,"penalty_alpha",null);ge(this,"use_cache",!0);ge(this,"temperature",1);ge(this,"top_k",50);ge(this,"top_p",1);ge(this,"typical_p",1);ge(this,"epsilon_cutoff",0);ge(this,"eta_cutoff",0);ge(this,"diversity_penalty",0);ge(this,"repetition_penalty",1);ge(this,"encoder_repetition_penalty",1);ge(this,"length_penalty",1);ge(this,"no_repeat_ngram_size",0);ge(this,"bad_words_ids",null);ge(this,"force_words_ids",null);ge(this,"renormalize_logits",!1);ge(this,"constraints",null);ge(this,"forced_bos_token_id",null);ge(this,"forced_eos_token_id",null);ge(this,"remove_invalid_values",!1);ge(this,"exponential_decay_length_penalty",null);ge(this,"suppress_tokens",null);ge(this,"streamer",null);ge(this,"begin_suppress_tokens",null);ge(this,"forced_decoder_ids",null);ge(this,"guidance_scale",null);ge(this,"num_return_sequences",1);ge(this,"output_attentions",!1);ge(this,"output_hidden_states",!1);ge(this,"output_scores",!1);ge(this,"return_dict_in_generate",!1);ge(this,"pad_token_id",null);ge(this,"bos_token_id",null);ge(this,"eos_token_id",null);ge(this,"encoder_no_repeat_ngram_size",0);ge(this,"decoder_start_token_id",null);ge(this,"generation_kwargs",{});Object.assign(this,(0,s.pick)(c,Object.getOwnPropertyNames(this)))}}}),"./src/generation/logits_process.js":((e,t,n)=>{n.r(t),n.d(t,{ClassifierFreeGuidanceLogitsProcessor:()=>E,ForcedBOSTokenLogitsProcessor:()=>u,ForcedEOSTokenLogitsProcessor:()=>h,LogitsProcessor:()=>o,LogitsProcessorList:()=>d,LogitsWarper:()=>c,MinLengthLogitsProcessor:()=>v,MinNewTokensLengthLogitsProcessor:()=>T,NoBadWordsLogitsProcessor:()=>O,NoRepeatNGramLogitsProcessor:()=>m,RepetitionPenaltyLogitsProcessor:()=>y,SuppressTokensAtBeginLogitsProcessor:()=>g,TemperatureLogitsWarper:()=>S,TopKLogitsWarper:()=>I,TopPLogitsWarper:()=>D,WhisperTimeStampLogitsProcessor:()=>p});var s=n("./src/utils/generic.js");n("./src/utils/tensor.js");var i=n("./src/utils/maths.js");class o extends s.Callable{_call(C,A){throw Error("`_call` should be implemented in a subclass")}}class c extends s.Callable{_call(C,A){throw Error("`_call` should be implemented in a subclass")}}class d extends s.Callable{constructor(){super(),this.processors=[]}push(C){this.processors.push(C)}extend(C){this.processors.push(...C)}_call(C,A){let k=A;for(const R of this.processors)k=R(C,k);return k}[Symbol.iterator](){return this.processors.values()}}class u extends o{constructor(C){super(),this.bos_token_id=C}_call(C,A){for(let k=0;k<C.length;++k)if(C[k].length===1){const R=A[k].data;R.fill(-1/0),R[this.bos_token_id]=0}return A}}class h extends o{constructor(C,A){super(),this.max_length=C,this.eos_token_id=Array.isArray(A)?A:[A]}_call(C,A){for(let k=0;k<C.length;++k)if(C[k].length===this.max_length-1){const R=A[k].data;R.fill(-1/0);for(const G of this.eos_token_id)R[G]=0}return A}}class g extends o{constructor(C,A){super(),this.begin_suppress_tokens=C,this.begin_index=A}_call(C,A){for(let k=0;k<C.length;++k)if(C[k].length===this.begin_index){const R=A[k].data;for(const G of this.begin_suppress_tokens)R[G]=-1/0}return A}}class p extends o{constructor(C,A){super(),this.eos_token_id=Array.isArray(C.eos_token_id)?C.eos_token_id[0]:C.eos_token_id,this.no_timestamps_token_id=C.no_timestamps_token_id,this.timestamp_begin=this.no_timestamps_token_id+1,this.begin_index=A.length,A.at(-1)===this.no_timestamps_token_id&&(this.begin_index-=1),this.max_initial_timestamp_index=C.max_initial_timestamp_index}_call(C,A){for(let k=0;k<C.length;++k){const R=A[k].data;if(R[this.no_timestamps_token_id]=-1/0,C[k].length===this.begin_index-1){R.fill(-1/0),R[this.timestamp_begin]=0;continue}const G=C[k].slice(this.begin_index),te=G.length>=1&&G[G.length-1]>=this.timestamp_begin,ee=G.length<2||G[G.length-2]>=this.timestamp_begin;if(te&&(ee?R.subarray(this.timestamp_begin).fill(-1/0):R.subarray(0,this.eos_token_id).fill(-1/0)),C[k].length===this.begin_index&&this.max_initial_timestamp_index!==null){const Q=this.timestamp_begin+this.max_initial_timestamp_index;R.subarray(Q+1).fill(-1/0)}const X=(0,i.log_softmax)(R),le=Math.log(X.subarray(this.timestamp_begin).map(Math.exp).reduce((Q,ne)=>Q+ne)),ae=(0,i.max)(X.subarray(0,this.timestamp_begin))[0];le>ae&&R.subarray(0,this.timestamp_begin).fill(-1/0)}return A}}class m extends o{constructor(C){super(),this.no_repeat_ngram_size=C}getNgrams(C){const A=C.length,k=[];for(let G=0;G<A+1-this.no_repeat_ngram_size;++G){const te=[];for(let ee=0;ee<this.no_repeat_ngram_size;++ee)te.push(C[G+ee]);k.push(te.map(Number))}const R=new Map;for(const G of k){const te=G.slice(0,G.length-1),ee=JSON.stringify(te),X=R.get(ee)??[];X.push(G[G.length-1]),R.set(ee,X)}return R}getGeneratedNgrams(C,A){const k=A.slice(A.length+1-this.no_repeat_ngram_size,A.length);return C.get(JSON.stringify(k.map(Number)))??[]}calcBannedNgramTokens(C){const A=[];if(C.length+1<this.no_repeat_ngram_size)return A;{const k=this.getNgrams(C);return this.getGeneratedNgrams(k,C)}}_call(C,A){for(let k=0;k<C.length;++k){const R=A[k].data,G=this.calcBannedNgramTokens(C[k]);for(const te of G)R[te]=-1/0}return A}}class y extends o{constructor(C){super(),this.penalty=C}_call(C,A){for(let k=0;k<C.length;++k){const R=A[k].data;for(const G of new Set(C[k])){const te=Number(G);R[te]<0?R[te]*=this.penalty:R[te]/=this.penalty}}return A}}class v extends o{constructor(C,A){super(),this.min_length=C,this.eos_token_id=Array.isArray(A)?A:[A]}_call(C,A){for(let k=0;k<C.length;++k)if(C[k].length<this.min_length){const R=A[k].data;for(const G of this.eos_token_id)R[G]=-1/0}return A}}class T extends o{constructor(C,A,k){super(),this.prompt_length_to_skip=C,this.min_new_tokens=A,this.eos_token_id=Array.isArray(k)?k:[k]}_call(C,A){for(let k=0;k<C.length;++k)if(C[k].length-this.prompt_length_to_skip<this.min_new_tokens){const G=A[k].data;for(const te of this.eos_token_id)G[te]=-1/0}return A}}class O extends o{constructor(C,A){super(),this.bad_words_ids=C,this.eos_token_id=Array.isArray(A)?A:[A]}_call(C,A){for(let k=0;k<C.length;++k){const R=A[k].data,G=C[k];for(const te of this.bad_words_ids){if(G.length<te.length-1)continue;let ee=!0;for(let X=1;X<=te.length-1;++X)if(te.at(-X-1)!=G.at(-X)){ee=!1;break}ee&&(R[te.at(-1)]=-1/0)}}return A}}class E extends o{constructor(C){if(super(),C<=1)throw new Error(`Require guidance scale >1 to use the classifier free guidance processor, got guidance scale ${C}.`);this.guidance_scale=C}_call(C,A){if(A.dims[0]!==2*C.length)throw new Error(`Logits should have twice the batch size of the input ids, the first half of batches corresponding to the conditional inputs, and the second half of batches corresponding to the unconditional inputs. Got batch size ${A.dims[0]} for the logits and ${C.length} for the input ids.`);const k=C.length,R=A.slice([0,k],null),G=A.slice([k,A.dims[0]],null);for(let te=0;te<G.data.length;++te)G.data[te]+=(R.data[te]-G.data[te])*this.guidance_scale;return G}}class S extends c{constructor(C){super(),this.temperature=C}_call(C,A){const k=A.data;for(let R=0;R<k.length;++R)k[R]/=this.temperature;return A}}class D extends c{constructor(C,{filter_value:A=-1/0,min_tokens_to_keep:k=1}={}){if(super(),C<0||C>1)throw new Error(`\`top_p\` must be a float > 0 and < 1, but is ${C}`);if(!Number.isInteger(k)||k<1)throw new Error(`\`min_tokens_to_keep\` must be a positive integer, but is ${k}`);this.top_p=C,this.filter_value=A,this.min_tokens_to_keep=k}}class I extends c{constructor(C,{filter_value:A=-1/0,min_tokens_to_keep:k=1}={}){if(super(),!Number.isInteger(C)||C<0)throw new Error(`\`top_k\` must be a positive integer, but is ${C}`);this.top_k=Math.max(C,k),this.filter_value=A}}}),"./src/generation/logits_sampler.js":((e,t,n)=>{n.r(t),n.d(t,{LogitsSampler:()=>c});var s=n("./src/utils/generic.js"),i=n("./src/utils/tensor.js"),o=n("./src/utils/maths.js");n("./src/generation/configuration_utils.js");class c extends s.Callable{constructor(p){super(),this.generation_config=p}async _call(p){return this.sample(p)}async sample(p){throw Error("sample should be implemented in subclasses.")}getLogits(p,m){let y=p.dims.at(-1),v=p.data;if(m===-1)v=v.slice(-y);else{let T=m*y;v=v.slice(T,T+y)}return v}randomSelect(p){let m=0;for(let v=0;v<p.length;++v)m+=p[v];let y=Math.random()*m;for(let v=0;v<p.length;++v)if(y-=p[v],y<=0)return v;return 0}static getSampler(p){if(p.do_sample)return new u(p);if(p.num_beams>1)return new h(p);if(p.num_return_sequences>1)throw Error(`num_return_sequences has to be 1 when doing greedy search, but is ${p.num_return_sequences}.`);return new d(p)}}class d extends c{async sample(p){const m=(0,o.max)(p.data)[1];return[[BigInt(m),0]]}}class u extends c{async sample(p){let m=p.dims.at(-1);this.generation_config.top_k>0&&(m=Math.min(this.generation_config.top_k,m));const[y,v]=await(0,i.topk)(p,m),T=(0,o.softmax)(y.data);return Array.from({length:this.generation_config.num_beams},()=>{const O=this.randomSelect(T);return[v.data[O],Math.log(T[O])]})}}class h extends c{async sample(p){let m=p.dims.at(-1);this.generation_config.top_k>0&&(m=Math.min(this.generation_config.top_k,m));const[y,v]=await(0,i.topk)(p,m),T=(0,o.softmax)(y.data);return Array.from({length:this.generation_config.num_beams},(O,E)=>[v.data[E],Math.log(T[E])])}}}),"./src/generation/stopping_criteria.js":((e,t,n)=>{n.r(t),n.d(t,{EosTokenCriteria:()=>d,InterruptableStoppingCriteria:()=>u,MaxLengthCriteria:()=>c,StoppingCriteria:()=>i,StoppingCriteriaList:()=>o});var s=n("./src/utils/generic.js");class i extends s.Callable{_call(g,p){throw Error("StoppingCriteria needs to be subclassed")}}class o extends s.Callable{constructor(){super(),this.criteria=[]}push(g){this.criteria.push(g)}extend(g){g instanceof o?g=g.criteria:g instanceof i&&(g=[g]),this.criteria.push(...g)}_call(g,p){const m=new Array(g.length).fill(!1);for(const y of this.criteria){const v=y(g,p);for(let T=0;T<m.length;++T)m[T]||(m[T]=v[T])}return m}[Symbol.iterator](){return this.criteria.values()}}class c extends i{constructor(g,p=null){super(),this.max_length=g,this.max_position_embeddings=p}_call(g){return g.map(p=>p.length>=this.max_length)}}class d extends i{constructor(g){super(),Array.isArray(g)||(g=[g]),this.eos_token_id=g}_call(g,p){return g.map(m=>{const y=m.at(-1);return this.eos_token_id.some(v=>y==v)})}}class u extends i{constructor(){super(),this.interrupted=!1}interrupt(){this.interrupted=!0}reset(){this.interrupted=!1}_call(g,p){return new Array(g.length).fill(this.interrupted)}}}),"./src/generation/streamers.js":((e,t,n)=>{n.r(t),n.d(t,{BaseStreamer:()=>c,TextStreamer:()=>u,WhisperTextStreamer:()=>h});var s=n("./src/utils/core.js"),i=n("./src/tokenizers.js"),o=n("./src/env.js");class c{put(p){throw Error("Not implemented")}end(){throw Error("Not implemented")}}const d=o.apis.IS_PROCESS_AVAILABLE?g=>process.stdout.write(g):g=>console.log(g);class u extends c{constructor(p,{skip_prompt:m=!1,callback_function:y=null,token_callback_function:v=null,skip_special_tokens:T=!0,decode_kwargs:O={},...E}={}){super(),this.tokenizer=p,this.skip_prompt=m,this.callback_function=y??d,this.token_callback_function=v,this.decode_kwargs={skip_special_tokens:T,...O,...E},this.token_cache=[],this.print_len=0,this.next_tokens_are_prompt=!0}put(p){var O;if(p.length>1)throw Error("TextStreamer only supports batch size of 1");const m=this.next_tokens_are_prompt;if(m&&(this.next_tokens_are_prompt=!1,this.skip_prompt))return;const y=p[0];(O=this.token_callback_function)==null||O.call(this,y),this.token_cache=(0,s.mergeArrays)(this.token_cache,y);const v=this.tokenizer.decode(this.token_cache,this.decode_kwargs);let T;m||v.endsWith(`
`)?(T=v.slice(this.print_len),this.token_cache=[],this.print_len=0):v.length>0&&(0,i.is_chinese_char)(v.charCodeAt(v.length-1))?(T=v.slice(this.print_len),this.print_len+=T.length):(T=v.slice(this.print_len,v.lastIndexOf(" ")+1),this.print_len+=T.length),this.on_finalized_text(T,!1)}end(){let p;this.token_cache.length>0?(p=this.tokenizer.decode(this.token_cache,this.decode_kwargs).slice(this.print_len),this.token_cache=[],this.print_len=0):p="",this.next_tokens_are_prompt=!0,this.on_finalized_text(p,!0)}on_finalized_text(p,m){var y,v;p.length>0&&((y=this.callback_function)==null||y.call(this,p)),m&&this.callback_function===d&&o.apis.IS_PROCESS_AVAILABLE&&((v=this.callback_function)==null||v.call(this,`
`))}}class h extends u{constructor(p,{skip_prompt:m=!1,callback_function:y=null,token_callback_function:v=null,on_chunk_start:T=null,on_chunk_end:O=null,on_finalize:E=null,time_precision:S=.02,skip_special_tokens:D=!0,decode_kwargs:I={}}={}){super(p,{skip_prompt:m,skip_special_tokens:D,callback_function:y,token_callback_function:v,decode_kwargs:I}),this.timestamp_begin=p.timestamp_begin,this.on_chunk_start=T,this.on_chunk_end=O,this.on_finalize=E,this.time_precision=S,this.waiting_for_timestamp=!1}put(p){var y,v,T;if(p.length>1)throw Error("WhisperTextStreamer only supports batch size of 1");const m=p[0];if(m.length===1){const O=Number(m[0])-this.timestamp_begin;if(O>=0){const E=O*this.time_precision;this.waiting_for_timestamp?(y=this.on_chunk_end)==null||y.call(this,E):(v=this.on_chunk_start)==null||v.call(this,E),this.waiting_for_timestamp=!this.waiting_for_timestamp,(T=this.token_callback_function)==null||T.call(this,m);return}}return super.put(p)}end(){var p;super.end(),(p=this.on_finalize)==null||p.call(this)}}}),"./src/models.js":((e,t,n)=>{n.r(t),n.d(t,{ASTForAudioClassification:()=>ol,ASTModel:()=>$u,ASTPreTrainedModel:()=>il,AlbertForMaskedLM:()=>Ct,AlbertForQuestionAnswering:()=>yt,AlbertForSequenceClassification:()=>bt,AlbertModel:()=>ht,AlbertPreTrainedModel:()=>We,ArceeForCausalLM:()=>xo,ArceeModel:()=>gs,ArceePreTrainedModel:()=>ur,AutoModel:()=>Mp,AutoModelForAudioClassification:()=>rf,AutoModelForAudioFrameClassification:()=>Ip,AutoModelForAudioTextToText:()=>Mn,AutoModelForCTC:()=>Gm,AutoModelForCausalLM:()=>tf,AutoModelForDepthEstimation:()=>Hm,AutoModelForDocumentQuestionAnswering:()=>Wm,AutoModelForImageClassification:()=>Cs,AutoModelForImageFeatureExtraction:()=>qm,AutoModelForImageMatting:()=>af,AutoModelForImageSegmentation:()=>ql,AutoModelForImageTextToText:()=>Pp,AutoModelForImageToImage:()=>sf,AutoModelForMaskGeneration:()=>Cp,AutoModelForMaskedLM:()=>lu,AutoModelForNormalEstimation:()=>Qm,AutoModelForObjectDetection:()=>Tp,AutoModelForPoseEstimation:()=>Kl,AutoModelForQuestionAnswering:()=>nf,AutoModelForSemanticSegmentation:()=>Vm,AutoModelForSeq2SeqLM:()=>jm,AutoModelForSequenceClassification:()=>xp,AutoModelForSpeechSeq2Seq:()=>Um,AutoModelForTextToSpectrogram:()=>ou,AutoModelForTextToWaveform:()=>Qo,AutoModelForTokenClassification:()=>Rm,AutoModelForUniversalSegmentation:()=>Ep,AutoModelForVision2Seq:()=>yi,AutoModelForXVector:()=>Sp,AutoModelForZeroShotObjectDetection:()=>Ap,BartForConditionalGeneration:()=>Wn,BartForSequenceClassification:()=>_r,BartModel:()=>zr,BartPretrainedModel:()=>Mr,BaseModelOutput:()=>ze,BeitForImageClassification:()=>Wf,BeitModel:()=>Lc,BeitPreTrainedModel:()=>Qi,BertForMaskedLM:()=>Ke,BertForQuestionAnswering:()=>$e,BertForSequenceClassification:()=>Be,BertForTokenClassification:()=>nt,BertModel:()=>He,BertPreTrainedModel:()=>Re,BlenderbotForConditionalGeneration:()=>Sn,BlenderbotModel:()=>xr,BlenderbotPreTrainedModel:()=>rr,BlenderbotSmallForConditionalGeneration:()=>Xa,BlenderbotSmallModel:()=>aa,BlenderbotSmallPreTrainedModel:()=>On,BloomForCausalLM:()=>Ml,BloomModel:()=>wl,BloomPreTrainedModel:()=>Pc,CLIPModel:()=>fl,CLIPPreTrainedModel:()=>as,CLIPSegForImageSegmentation:()=>sa,CLIPSegModel:()=>vo,CLIPSegPreTrainedModel:()=>Da,CLIPTextModel:()=>$i,CLIPTextModelWithProjection:()=>oi,CLIPVisionModel:()=>ju,CLIPVisionModelWithProjection:()=>Bi,CamembertForMaskedLM:()=>Ce,CamembertForQuestionAnswering:()=>ct,CamembertForSequenceClassification:()=>Ue,CamembertForTokenClassification:()=>Ye,CamembertModel:()=>pe,CamembertPreTrainedModel:()=>oe,CausalLMOutput:()=>Ss,CausalLMOutputWithPast:()=>h_,ChineseCLIPModel:()=>Bt,ChineseCLIPPreTrainedModel:()=>Li,ClapAudioModelWithProjection:()=>Ud,ClapModel:()=>Ks,ClapPreTrainedModel:()=>Kc,ClapTextModelWithProjection:()=>jr,CodeGenForCausalLM:()=>ie,CodeGenModel:()=>J,CodeGenPreTrainedModel:()=>W,CohereForCausalLM:()=>ia,CohereModel:()=>kf,CoherePreTrainedModel:()=>Ac,ConvBertForMaskedLM:()=>Ft,ConvBertForQuestionAnswering:()=>Dn,ConvBertForSequenceClassification:()=>ns,ConvBertForTokenClassification:()=>Ha,ConvBertModel:()=>Pa,ConvBertPreTrainedModel:()=>qr,ConvNextForImageClassification:()=>yd,ConvNextModel:()=>ch,ConvNextPreTrainedModel:()=>Ol,ConvNextV2ForImageClassification:()=>fh,ConvNextV2Model:()=>dh,ConvNextV2PreTrainedModel:()=>uh,DFineForObjectDetection:()=>Lo,DFineModel:()=>kl,DFinePreTrainedModel:()=>Pl,DINOv3ConvNextModel:()=>xm,DINOv3ConvNextPreTrainedModel:()=>vh,DINOv3ViTModel:()=>_h,DINOv3ViTPreTrainedModel:()=>wd,DPTForDepthEstimation:()=>Kf,DPTModel:()=>qf,DPTPreTrainedModel:()=>md,DacDecoderModel:()=>eu,DacDecoderOutput:()=>Jc,DacEncoderModel:()=>Zc,DacEncoderOutput:()=>Xd,DacModel:()=>ap,DacPreTrainedModel:()=>ha,DebertaForMaskedLM:()=>Et,DebertaForQuestionAnswering:()=>Zt,DebertaForSequenceClassification:()=>nn,DebertaForTokenClassification:()=>xt,DebertaModel:()=>Tt,DebertaPreTrainedModel:()=>ft,DebertaV2ForMaskedLM:()=>or,DebertaV2ForQuestionAnswering:()=>nr,DebertaV2ForSequenceClassification:()=>Ir,DebertaV2ForTokenClassification:()=>_a,DebertaV2Model:()=>Gn,DebertaV2PreTrainedModel:()=>wn,DecisionTransformerModel:()=>Yc,DecisionTransformerPreTrainedModel:()=>np,DeiTForImageClassification:()=>wm,DeiTModel:()=>Qf,DeiTPreTrainedModel:()=>cd,DepthAnythingForDepthEstimation:()=>Yf,DepthAnythingPreTrainedModel:()=>Xf,DepthProForDepthEstimation:()=>eh,DepthProPreTrainedModel:()=>Zf,DetrForObjectDetection:()=>Ba,DetrForSegmentation:()=>La,DetrModel:()=>ad,DetrObjectDetectionOutput:()=>Ws,DetrPreTrainedModel:()=>Sl,DetrSegmentationOutput:()=>sd,Dinov2ForImageClassification:()=>ph,Dinov2Model:()=>hh,Dinov2PreTrainedModel:()=>bd,Dinov2WithRegistersForImageClassification:()=>gh,Dinov2WithRegistersModel:()=>mh,Dinov2WithRegistersPreTrainedModel:()=>Vc,DistilBertForMaskedLM:()=>mr,DistilBertForQuestionAnswering:()=>xa,DistilBertForSequenceClassification:()=>na,DistilBertForTokenClassification:()=>Pr,DistilBertModel:()=>Bs,DistilBertPreTrainedModel:()=>Tr,DonutSwinModel:()=>Uc,DonutSwinPreTrainedModel:()=>lh,EdgeTamModel:()=>xh,EfficientNetForImageClassification:()=>Dm,EfficientNetModel:()=>Jh,EfficientNetPreTrainedModel:()=>Gd,ElectraForMaskedLM:()=>Qa,ElectraForQuestionAnswering:()=>Y,ElectraForSequenceClassification:()=>L,ElectraForTokenClassification:()=>ue,ElectraModel:()=>an,ElectraPreTrainedModel:()=>Kr,Ernie4_5ForCausalLM:()=>Ms,Ernie4_5Model:()=>jl,Ernie4_5PreTrainedModel:()=>zd,EsmForMaskedLM:()=>qa,EsmForSequenceClassification:()=>Ka,EsmForTokenClassification:()=>ra,EsmModel:()=>hs,EsmPreTrainedModel:()=>wr,ExaoneForCausalLM:()=>Sf,ExaoneModel:()=>Wu,ExaonePreTrainedModel:()=>li,FalconForCausalLM:()=>qc,FalconModel:()=>jd,FalconPreTrainedModel:()=>Qc,FastViTForImageClassification:()=>jf,FastViTModel:()=>$c,FastViTPreTrainedModel:()=>Oo,Florence2ForConditionalGeneration:()=>ul,Florence2PreTrainedModel:()=>zu,GLPNForDepthEstimation:()=>Fo,GLPNModel:()=>oh,GLPNPreTrainedModel:()=>ih,GPT2LMHeadModel:()=>pl,GPT2Model:()=>hl,GPT2PreTrainedModel:()=>Fs,GPTBigCodeForCausalLM:()=>$,GPTBigCodeModel:()=>b,GPTBigCodePreTrainedModel:()=>Mo,GPTJForCausalLM:()=>wo,GPTJModel:()=>zs,GPTJPreTrainedModel:()=>is,GPTNeoForCausalLM:()=>zi,GPTNeoModel:()=>ss,GPTNeoPreTrainedModel:()=>gl,GPTNeoXForCausalLM:()=>_l,GPTNeoXModel:()=>bo,GPTNeoXPreTrainedModel:()=>ms,Gemma2ForCausalLM:()=>ui,Gemma2Model:()=>Qu,Gemma2PreTrainedModel:()=>$a,Gemma3ForCausalLM:()=>yl,Gemma3Model:()=>Ku,Gemma3PreTrainedModel:()=>di,Gemma3nForConditionalGeneration:()=>si,Gemma3nPreTrainedModel:()=>_c,GemmaForCausalLM:()=>ci,GemmaModel:()=>An,GemmaPreTrainedModel:()=>ar,GlmForCausalLM:()=>xc,GlmModel:()=>Cf,GlmPreTrainedModel:()=>_s,GraniteForCausalLM:()=>ys,GraniteModel:()=>vs,GraniteMoeHybridForCausalLM:()=>Hu,GraniteMoeHybridModel:()=>Pf,GraniteMoeHybridPreTrainedModel:()=>bs,GranitePreTrainedModel:()=>Ns,GroundingDinoForObjectDetection:()=>yh,GroundingDinoPreTrainedModel:()=>Md,GroupViTModel:()=>Oc,GroupViTPreTrainedModel:()=>Tl,HeliumForCausalLM:()=>Gu,HeliumModel:()=>Oa,HeliumPreTrainedModel:()=>Af,HieraForImageClassification:()=>dd,HieraModel:()=>ud,HieraPreTrainedModel:()=>zc,HubertForCTC:()=>Nh,HubertForSequenceClassification:()=>Rh,HubertModel:()=>zh,HubertPreTrainedModel:()=>Fh,IJepaForImageClassification:()=>ko,IJepaModel:()=>Ff,IJepaPreTrainedModel:()=>xl,Idefics3ForConditionalGeneration:()=>rs,Idefics3PreTrainedModel:()=>ii,ImageMattingOutput:()=>Dp,JAISLMHeadModel:()=>yo,JAISModel:()=>ml,JAISPreTrainedModel:()=>Fi,JinaCLIPModel:()=>bc,JinaCLIPPreTrainedModel:()=>go,JinaCLIPTextModel:()=>wc,JinaCLIPVisionModel:()=>_o,Lfm2ForCausalLM:()=>Ni,Lfm2Model:()=>Uu,Lfm2PreTrainedModel:()=>vl,LiteWhisperForConditionalGeneration:()=>pc,Llama4ForCausalLM:()=>St,Llama4PreTrainedModel:()=>Mt,LlamaForCausalLM:()=>ot,LlamaModel:()=>Xe,LlamaPreTrainedModel:()=>Ee,LlavaForConditionalGeneration:()=>uo,LlavaOnevisionForConditionalGeneration:()=>Lu,LlavaPreTrainedModel:()=>co,LlavaQwen2ForCausalLM:()=>dl,LongT5ForConditionalGeneration:()=>lr,LongT5Model:()=>Tn,LongT5PreTrainedModel:()=>Jn,M2M100ForConditionalGeneration:()=>Id,M2M100Model:()=>Sd,M2M100PreTrainedModel:()=>Cd,MBartForCausalLM:()=>Ea,MBartForConditionalGeneration:()=>ka,MBartForSequenceClassification:()=>Xr,MBartModel:()=>va,MBartPreTrainedModel:()=>cr,MPNetForMaskedLM:()=>Fr,MPNetForQuestionAnswering:()=>Ie,MPNetForSequenceClassification:()=>ps,MPNetForTokenClassification:()=>Pi,MPNetModel:()=>ni,MPNetPreTrainedModel:()=>En,MT5ForConditionalGeneration:()=>Dr,MT5Model:()=>gr,MT5PreTrainedModel:()=>kr,MarianMTModel:()=>Ad,MarianModel:()=>Th,MarianPreTrainedModel:()=>No,MaskFormerForInstanceSegmentation:()=>sh,MaskFormerModel:()=>ah,MaskFormerPreTrainedModel:()=>vd,MaskedLMOutput:()=>Vr,Metric3DForDepthEstimation:()=>_d,Metric3DPreTrainedModel:()=>th,Metric3Dv2ForDepthEstimation:()=>rh,Metric3Dv2PreTrainedModel:()=>nh,MgpstrForSceneTextRecognition:()=>Zn,MgpstrModelOutput:()=>$m,MgpstrPreTrainedModel:()=>$n,MimiDecoderModel:()=>Hl,MimiDecoderOutput:()=>Kd,MimiEncoderModel:()=>Go,MimiEncoderOutput:()=>Zi,MimiModel:()=>Na,MimiPreTrainedModel:()=>Ts,Ministral3ForCausalLM:()=>Qh,Ministral3Model:()=>mi,Ministral3PreTrainedModel:()=>jo,MinistralForCausalLM:()=>Hh,MinistralModel:()=>Pm,MinistralPreTrainedModel:()=>Wh,Mistral3ForConditionalGeneration:()=>gc,MistralForCausalLM:()=>dr,MistralModel:()=>Rl,MistralPreTrainedModel:()=>Nl,MobileBertForMaskedLM:()=>lt,MobileBertForQuestionAnswering:()=>At,MobileBertForSequenceClassification:()=>ut,MobileBertModel:()=>ua,MobileBertPreTrainedModel:()=>Ar,MobileLLMForCausalLM:()=>Ya,MobileLLMModel:()=>If,MobileLLMPreTrainedModel:()=>Ec,MobileNetV1ForImageClassification:()=>Ys,MobileNetV1ForSemanticSegmentation:()=>Ji,MobileNetV1Model:()=>Zh,MobileNetV1PreTrainedModel:()=>fa,MobileNetV2ForImageClassification:()=>Qd,MobileNetV2ForSemanticSegmentation:()=>ls,MobileNetV2Model:()=>Hd,MobileNetV2PreTrainedModel:()=>os,MobileNetV3ForImageClassification:()=>Vl,MobileNetV3ForSemanticSegmentation:()=>Gl,MobileNetV3Model:()=>Uo,MobileNetV3PreTrainedModel:()=>Xc,MobileNetV4ForImageClassification:()=>tp,MobileNetV4ForSemanticSegmentation:()=>Wl,MobileNetV4Model:()=>ep,MobileNetV4PreTrainedModel:()=>gi,MobileViTForImageClassification:()=>nd,MobileViTModel:()=>td,MobileViTPreTrainedModel:()=>Vs,MobileViTV2ForImageClassification:()=>Al,MobileViTV2Model:()=>fi,MobileViTV2PreTrainedModel:()=>Gs,ModelOutput:()=>Te,ModernBertDecoderForCausalLM:()=>Cn,ModernBertDecoderModel:()=>Jt,ModernBertDecoderPreTrainedModel:()=>gn,ModernBertForMaskedLM:()=>rt,ModernBertForSequenceClassification:()=>kt,ModernBertForTokenClassification:()=>Nt,ModernBertModel:()=>Ze,ModernBertPreTrainedModel:()=>vt,Moondream1ForConditionalGeneration:()=>Fu,MoonshineForConditionalGeneration:()=>Bu,MoonshineModel:()=>Tf,MoonshinePreTrainedModel:()=>cl,MptForCausalLM:()=>Po,MptModel:()=>Io,MptPreTrainedModel:()=>kc,MultiModalityCausalLM:()=>Om,MultiModalityPreTrainedModel:()=>rp,MusicgenForCausalLM:()=>xs,MusicgenForConditionalGeneration:()=>Wd,MusicgenModel:()=>za,MusicgenPreTrainedModel:()=>Ul,NanoChatForCausalLM:()=>dn,NanoChatModel:()=>_n,NanoChatPreTrainedModel:()=>Rt,NeoBertForMaskedLM:()=>Je,NeoBertForQuestionAnswering:()=>Gt,NeoBertForSequenceClassification:()=>pt,NeoBertForTokenClassification:()=>dt,NeoBertModel:()=>_t,NeoBertPreTrainedModel:()=>qe,NomicBertModel:()=>tn,NomicBertPreTrainedModel:()=>Fn,OPTForCausalLM:()=>bm,OPTModel:()=>Lf,OPTPreTrainedModel:()=>Bf,Olmo2ForCausalLM:()=>Za,Olmo2Model:()=>Ja,Olmo2PreTrainedModel:()=>Ao,OlmoForCausalLM:()=>Tc,OlmoModel:()=>To,OlmoPreTrainedModel:()=>Ri,OpenELMForCausalLM:()=>Rs,OpenELMModel:()=>ji,OpenELMPreTrainedModel:()=>Cc,OwlViTForObjectDetection:()=>Cl,OwlViTModel:()=>rd,OwlViTPreTrainedModel:()=>Bc,Owlv2ForObjectDetection:()=>Gf,Owlv2Model:()=>Vf,Owlv2PreTrainedModel:()=>$o,PaliGemmaForConditionalGeneration:()=>Nu,PaliGemmaPreTrainedModel:()=>Oi,ParakeetForCTC:()=>Gc,ParakeetPreTrainedModel:()=>Ih,PatchTSMixerForPrediction:()=>Vo,PatchTSMixerModel:()=>_i,PatchTSMixerPreTrainedModel:()=>Ta,PatchTSTForPrediction:()=>Rn,PatchTSTModel:()=>xn,PatchTSTPreTrainedModel:()=>yn,Phi3ForCausalLM:()=>Nr,Phi3Model:()=>ym,Phi3PreTrainedModel:()=>$f,Phi3VForCausalLM:()=>fo,Phi3VPreTrainedModel:()=>Ru,PhiForCausalLM:()=>vm,PhiModel:()=>Of,PhiPreTrainedModel:()=>bl,PreTrainedModel:()=>H,PretrainedMixin:()=>pn,PvtForImageClassification:()=>Nf,PvtModel:()=>zf,PvtPreTrainedModel:()=>El,PyAnnoteForAudioFrameClassification:()=>Ph,PyAnnoteModel:()=>kd,PyAnnotePreTrainedModel:()=>Pd,QuestionAnsweringModelOutput:()=>Gr,Qwen2ForCausalLM:()=>Xu,Qwen2Model:()=>Us,Qwen2PreTrainedModel:()=>js,Qwen2VLForConditionalGeneration:()=>oa,Qwen2VLPreTrainedModel:()=>Ui,Qwen3ForCausalLM:()=>Ic,Qwen3Model:()=>So,Qwen3PreTrainedModel:()=>Sc,RFDetrForObjectDetection:()=>Bo,RFDetrModel:()=>Fc,RFDetrObjectDetectionOutput:()=>qi,RFDetrPreTrainedModel:()=>Or,RTDetrForObjectDetection:()=>Fa,RTDetrModel:()=>hi,RTDetrObjectDetectionOutput:()=>vr,RTDetrPreTrainedModel:()=>id,RTDetrV2ForObjectDetection:()=>fn,RTDetrV2Model:()=>Hs,RTDetrV2ObjectDetectionOutput:()=>Hn,RTDetrV2PreTrainedModel:()=>Il,ResNetForImageClassification:()=>Nc,ResNetModel:()=>$r,ResNetPreTrainedModel:()=>da,RoFormerForMaskedLM:()=>fs,RoFormerForQuestionAnswering:()=>Er,RoFormerForSequenceClassification:()=>Wa,RoFormerForTokenClassification:()=>Vn,RoFormerModel:()=>ds,RoFormerPreTrainedModel:()=>ta,RobertaForMaskedLM:()=>al,RobertaForQuestionAnswering:()=>cc,RobertaForSequenceClassification:()=>ri,RobertaForTokenClassification:()=>lo,RobertaModel:()=>rl,RobertaPreTrainedModel:()=>Ls,Sam2ImageSegmentationOutput:()=>$l,Sam2Model:()=>zo,Sam2PreTrainedModel:()=>Td,Sam3TrackerModel:()=>Eh,SamImageSegmentationOutput:()=>Mh,SamModel:()=>Tm,SamPreTrainedModel:()=>Em,SapiensForDepthEstimation:()=>Jf,SapiensForNormalEstimation:()=>Mm,SapiensForSemanticSegmentation:()=>gd,SapiensPreTrainedModel:()=>jc,SegformerForImageClassification:()=>Xh,SegformerForSemanticSegmentation:()=>yr,SegformerModel:()=>km,SegformerPreTrainedModel:()=>Vd,Seq2SeqLMOutput:()=>kp,SequenceClassifierOutput:()=>qt,SiglipModel:()=>yc,SiglipPreTrainedModel:()=>ho,SiglipTextModel:()=>po,SiglipVisionModel:()=>mo,SmolLM3ForCausalLM:()=>Eo,SmolLM3Model:()=>Mc,SmolLM3PreTrainedModel:()=>Vu,SmolVLMForConditionalGeneration:()=>vc,SnacDecoderModel:()=>Wo,SnacEncoderModel:()=>vi,SnacModel:()=>Jr,SnacPreTrainedModel:()=>As,SpeechT5ForSpeechToText:()=>qs,SpeechT5ForTextToSpeech:()=>Ld,SpeechT5HifiGan:()=>Im,SpeechT5Model:()=>Sm,SpeechT5PreTrainedModel:()=>zl,SqueezeBertForMaskedLM:()=>me,SqueezeBertForQuestionAnswering:()=>Se,SqueezeBertForSequenceClassification:()=>be,SqueezeBertModel:()=>se,SqueezeBertPreTrainedModel:()=>V,StableLmForCausalLM:()=>Yh,StableLmModel:()=>Xs,StableLmPreTrainedModel:()=>ya,Starcoder2ForCausalLM:()=>qh,Starcoder2Model:()=>Rd,Starcoder2PreTrainedModel:()=>Nd,StyleTextToSpeech2Model:()=>Uh,StyleTextToSpeech2PreTrainedModel:()=>Bd,SupertonicForConditionalGeneration:()=>ws,SupertonicPreTrainedModel:()=>Vh,Swin2SRForImageSuperResolution:()=>pd,Swin2SRModel:()=>hd,Swin2SRPreTrainedModel:()=>Dl,SwinForImageClassification:()=>fd,SwinForSemanticSegmentation:()=>Qs,SwinModel:()=>Rc,SwinPreTrainedModel:()=>Ki,T5ForConditionalGeneration:()=>vn,T5Model:()=>un,T5PreTrainedModel:()=>Vt,TableTransformerForObjectDetection:()=>od,TableTransformerModel:()=>Cr,TableTransformerObjectDetectionOutput:()=>ld,TableTransformerPreTrainedModel:()=>Hf,TokenClassifierOutput:()=>Ur,TrOCRForCausalLM:()=>Gh,TrOCRPreTrainedModel:()=>Fd,UltravoxModel:()=>Es,UltravoxPreTrainedModel:()=>qd,UniSpeechForCTC:()=>la,UniSpeechForSequenceClassification:()=>Dh,UniSpeechModel:()=>Rr,UniSpeechPreTrainedModel:()=>Bl,UniSpeechSatForAudioFrameClassification:()=>Bh,UniSpeechSatForCTC:()=>$h,UniSpeechSatForSequenceClassification:()=>Fl,UniSpeechSatModel:()=>Oh,UniSpeechSatPreTrainedModel:()=>Ll,VaultGemmaForCausalLM:()=>Co,VaultGemmaModel:()=>Df,VaultGemmaPreTrainedModel:()=>qu,ViTForImageClassification:()=>Ju,ViTMAEModel:()=>Wi,ViTMAEPreTrainedModel:()=>Gi,ViTMSNForImageClassification:()=>Do,ViTMSNModel:()=>Rf,ViTMSNPreTrainedModel:()=>ed,ViTModel:()=>Vi,ViTPreTrainedModel:()=>Yu,VisionEncoderDecoderModel:()=>mc,VitMatteForImageMatting:()=>Uf,VitMattePreTrainedModel:()=>Hi,VitPoseForPoseEstimation:()=>Dc,VitPosePreTrainedModel:()=>Zu,VitsModel:()=>Yr,VitsModelOutput:()=>Km,VitsPreTrainedModel:()=>Kh,VoxtralForConditionalGeneration:()=>Sr,Wav2Vec2BertForCTC:()=>Cm,Wav2Vec2BertForSequenceClassification:()=>Wc,Wav2Vec2BertModel:()=>Lh,Wav2Vec2BertPreTrainedModel:()=>Ro,Wav2Vec2ForAudioFrameClassification:()=>Sh,Wav2Vec2ForCTC:()=>Xi,Wav2Vec2ForSequenceClassification:()=>Ch,Wav2Vec2Model:()=>Ah,Wav2Vec2PreTrainedModel:()=>pi,WavLMForAudioFrameClassification:()=>Hc,WavLMForCTC:()=>Od,WavLMForSequenceClassification:()=>jh,WavLMForXVector:()=>$d,WavLMModel:()=>Dd,WavLMPreTrainedModel:()=>Yi,WeSpeakerResNetModel:()=>Am,WeSpeakerResNetPreTrainedModel:()=>kh,WhisperForConditionalGeneration:()=>ai,WhisperModel:()=>hc,WhisperPreTrainedModel:()=>ll,XLMForQuestionAnswering:()=>ku,XLMForSequenceClassification:()=>sl,XLMForTokenClassification:()=>Pu,XLMModel:()=>Su,XLMPreTrainedModel:()=>ki,XLMRobertaForMaskedLM:()=>Ou,XLMRobertaForQuestionAnswering:()=>fc,XLMRobertaForSequenceClassification:()=>uc,XLMRobertaForTokenClassification:()=>dc,XLMRobertaModel:()=>Du,XLMRobertaPreTrainedModel:()=>Di,XLMWithLMHeadModel:()=>Iu,XVectorOutput:()=>of,YolosForObjectDetection:()=>bh,YolosModel:()=>Ed,YolosObjectDetectionOutput:()=>wh,YolosPreTrainedModel:()=>xd});var s=n("./src/configs.js"),i=n("./src/backends/onnx.js"),o=n("./src/utils/dtypes.js"),c=n("./src/utils/generic.js"),d=n("./src/utils/core.js"),u=n("./src/utils/hub.js"),h=n("./src/utils/constants.js"),g=n("./src/generation/logits_process.js"),p=n("./src/generation/configuration_utils.js"),m=n("./src/utils/tensor.js"),y=n("./src/utils/image.js"),v=n("./src/utils/maths.js"),T=n("./src/generation/stopping_criteria.js"),O=n("./src/generation/logits_sampler.js"),E=n("./src/env.js"),S=n("./src/models/whisper/generation_whisper.js"),D=n("./src/models/whisper/common_whisper.js");const I={EncoderOnly:0,EncoderDecoder:1,Seq2Seq:2,Vision2Seq:3,DecoderOnly:4,MaskGeneration:5,ImageTextToText:6,Musicgen:7,MultiModality:8,Phi3V:9,AudioTextToText:10,AutoEncoder:11,ImageAudioTextToText:12,Supertonic:13},M=new Map,C=new Map,A=new Map;async function k(P,B,K){var Zr;let _e=((Zr=K.config)==null?void 0:Zr["transformers.js_config"])??{},De=K.device??_e.device;De&&typeof De!="string"&&(De.hasOwnProperty(B)?De=De[B]:(console.warn(`device not specified for "${B}". Using the default device.`),De=null));const Ae=De??(E.apis.IS_NODE_ENV?"cpu":"wasm"),Ve=(0,i.deviceToExecutionProviders)(Ae),it=_e.device_config??{};it.hasOwnProperty(Ae)&&(_e={..._e,...it[Ae]});let gt=K.dtype??_e.dtype;if(typeof gt!="string"&&(gt&&gt.hasOwnProperty(B)?gt=gt[B]:(gt=o.DEFAULT_DEVICE_DTYPE_MAPPING[Ae]??o.DATA_TYPES.fp32,console.warn(`dtype not specified for "${B}". Using the default dtype (${gt}) for this device (${Ae}).`))),gt===o.DATA_TYPES.auto){let ln=_e.dtype;typeof ln!="string"&&(ln=ln==null?void 0:ln[B]),ln&&ln!==o.DATA_TYPES.auto&&o.DATA_TYPES.hasOwnProperty(ln)?gt=ln:gt=o.DEFAULT_DEVICE_DTYPE_MAPPING[Ae]??o.DATA_TYPES.fp32}const wt=gt;if(o.DEFAULT_DTYPE_SUFFIX_MAPPING.hasOwnProperty(wt)){if(wt===o.DATA_TYPES.fp16&&Ae==="webgpu"&&!await(0,o.isWebGpuFp16Supported)())throw new Error(`The device (${Ae}) does not support fp16.`)}else throw new Error(`Invalid dtype: ${wt}. Should be one of: ${Object.keys(o.DATA_TYPES).join(", ")}`);const Dt=_e.kv_cache_dtype,Ut=Dt?typeof Dt=="string"?Dt:Dt[wt]??"float32":void 0;if(Ut&&!["float32","float16"].includes(Ut))throw new Error(`Invalid kv_cache_dtype: ${Ut}. Should be one of: float32, float16`);const Wt={dtype:wt,kv_cache_dtype:Ut,device:Ae},hn=o.DEFAULT_DTYPE_SUFFIX_MAPPING[wt],Lt=`${B}${hn}.onnx`,Kt=`${K.subfolder??""}/${Lt}`,It={...K.session_options};It.executionProviders??(It.executionProviders=Ve);const on=_e.free_dimension_overrides;on?It.freeDimensionOverrides??(It.freeDimensionOverrides=on):Ae.startsWith("webnn")&&!It.freeDimensionOverrides&&console.warn(`WebNN does not currently support dynamic shapes and requires 'free_dimension_overrides' to be set in config.json, preferably as a field within config["transformers.js_config"]["device_config"]["${Ae}"]. When 'free_dimension_overrides' is not set, you may experience significant performance degradation.`);const In=E.apis.IS_NODE_ENV&&E.env.useFSCache,qn=(0,u.getModelFile)(P,Kt,!0,K,In),sr=K.use_external_data_format??_e.use_external_data_format;let fr=[];if(sr){let ln;typeof sr=="object"?sr.hasOwnProperty(Lt)?ln=sr[Lt]:sr.hasOwnProperty(B)?ln=sr[B]:ln=!1:ln=sr;const Br=+ln;if(Br>u.MAX_EXTERNAL_DATA_CHUNKS)throw new Error(`The number of external data chunks (${Br}) exceeds the maximum allowed value (${u.MAX_EXTERNAL_DATA_CHUNKS}).`);for(let es=0;es<Br;++es){const qo=`${Lt}_data${es===0?"":"_"+es}`,ba=`${K.subfolder??""}/${qo}`;fr.push(new Promise(async(ja,Xl)=>{const Ko=await(0,u.getModelFile)(P,ba,!0,K,In);ja(Ko instanceof Uint8Array?{path:qo,data:Ko}:qo)}))}}else It.externalData!==void 0&&(fr=It.externalData.map(async ln=>{if(typeof ln.data=="string"){const Br=await(0,u.getModelFile)(P,ln.data,!0,K);return{...ln,data:Br}}return ln}));if(fr.length>0){const ln=await Promise.all(fr);E.apis.IS_NODE_ENV||(It.externalData=ln)}if(Ae==="webgpu"){const ln=(0,s.getCacheShapes)(K.config,{prefix:"present"});if(Object.keys(ln).length>0&&!(0,i.isONNXProxy)()){const Br={};for(const es in ln)Br[es]="gpu-buffer";It.preferredOutputLocation=Br}}return{buffer_or_path:await qn,session_options:It,session_config:Wt}}async function R(P,B,K){return Object.fromEntries(await Promise.all(Object.keys(B).map(async _e=>{const{buffer_or_path:De,session_options:Ae,session_config:Ve}=await k(P,B[_e],K),it=await(0,i.createInferenceSession)(De,Ae,Ve);return[_e,it]})))}async function G(P,B,K){return Object.fromEntries(await Promise.all(Object.keys(B).map(async _e=>{const De=await(0,u.getModelJSON)(P,B[_e],!1,K);return[_e,De]})))}function te(P,B){const K=Object.create(null),_e=[];for(const Ve of P.inputNames){const it=B[Ve];if(!(it instanceof m.Tensor)){_e.push(Ve);continue}K[Ve]=(0,i.isONNXProxy)()?it.clone():it}if(_e.length>0)throw new Error(`An error occurred during model execution: "Missing the following inputs: ${_e.join(", ")}.`);const De=Object.keys(B).length,Ae=P.inputNames.length;if(De>Ae){let Ve=Object.keys(B).filter(it=>!P.inputNames.includes(it));console.warn(`WARNING: Too many inputs were provided (${De} > ${Ae}). The following inputs will be ignored: "${Ve.join(", ")}".`)}return K}async function ee(P,B){const K=te(P,B);try{const _e=Object.fromEntries(Object.entries(K).map(([Ae,Ve])=>[Ae,Ve.ort_tensor])),De=await(0,i.runInferenceSession)(P,_e);return X(De)}catch(_e){const De=Object.fromEntries(Object.entries(K).map(([Ae,Ve])=>{const it={type:Ve.type,dims:Ve.dims,location:Ve.location};return it.location!=="gpu-buffer"&&(it.data=Ve.data),[Ae,it]}));throw console.error(`An error occurred during model execution: "${_e}".`),console.error("Inputs given to model:",De),_e}}function X(P){for(let B in P)(0,i.isONNXTensor)(P[B])?P[B]=new m.Tensor(P[B]):typeof P[B]=="object"&&X(P[B]);return P}function le(P){if(P instanceof m.Tensor)return P;if(P.length===0)throw Error("items must be non-empty");if(Array.isArray(P[0])){if(P.some(B=>B.length!==P[0].length))throw Error("Unable to create tensor, you should probably activate truncation and/or padding with 'padding=True' and/or 'truncation=True' to have batched tensors with the same length.");return new m.Tensor("int64",BigInt64Array.from(P.flat().map(B=>BigInt(B))),[P.length,P[0].length])}else return new m.Tensor("int64",BigInt64Array.from(P.map(B=>BigInt(B))),[1,P.length])}function ae(P){return new m.Tensor("bool",[P],[1])}async function Q(P,B){let{encoder_outputs:K,input_ids:_e,decoder_input_ids:De,...Ae}=B;if(!K){const it=(0,d.pick)(B,P.sessions.model.inputNames);K=(await ne(P,it)).last_hidden_state}return Ae.input_ids=De,Ae.encoder_hidden_states=K,P.sessions.decoder_model_merged.inputNames.includes("encoder_attention_mask")&&(Ae.encoder_attention_mask=B.attention_mask),await ve(P,Ae,!0)}async function ne(P,B){const K=P.sessions.model,_e=(0,d.pick)(B,K.inputNames);if(K.inputNames.includes("inputs_embeds")&&!_e.inputs_embeds){if(!B.input_ids)throw new Error("Both `input_ids` and `inputs_embeds` are missing in the model inputs.");_e.inputs_embeds=await P.encode_text({input_ids:B.input_ids})}if(K.inputNames.includes("token_type_ids")&&!_e.token_type_ids){if(!_e.input_ids)throw new Error("Both `input_ids` and `token_type_ids` are missing in the model inputs.");_e.token_type_ids=(0,m.zeros_like)(_e.input_ids)}if(K.inputNames.includes("pixel_mask")&&!_e.pixel_mask){if(!_e.pixel_values)throw new Error("Both `pixel_values` and `pixel_mask` are missing in the model inputs.");const De=_e.pixel_values.dims;_e.pixel_mask=(0,m.ones)([De[0],De[2],De[3]])}return await ee(K,_e)}async function de(P,B){const K=await P.encode(B);return await P.decode(K)}async function ve(P,B,K=!1){const _e=P.sessions[K?"decoder_model_merged":"model"],{past_key_values:De,...Ae}=B;if(_e.inputNames.includes("use_cache_branch")&&(Ae.use_cache_branch=ae(!!De)),_e.inputNames.includes("position_ids")&&Ae.attention_mask&&!Ae.position_ids){const it=["paligemma","gemma3_text","gemma3"].includes(P.config.model_type)?1:0;Ae.position_ids=Me(Ae,De,it)}P.addPastKeyValues(Ae,De);const Ve=(0,d.pick)(Ae,_e.inputNames);return await ee(_e,Ve)}function fe({modality_token_id:P,inputs_embeds:B,modality_features:K,input_ids:_e,attention_mask:De}){const Ae=_e.tolist().map(wt=>wt.reduce((Dt,Ut,Wt)=>(Ut==P&&Dt.push(Wt),Dt),[])),Ve=Ae.reduce((wt,Dt)=>wt+Dt.length,0),it=K.dims[0];if(Ve!==it)throw new Error(`Number of tokens and features do not match: tokens: ${Ve}, features ${it}`);let gt=0;for(let wt=0;wt<Ae.length;++wt){const Dt=Ae[wt],Ut=B[wt];for(let Wt=0;Wt<Dt.length;++Wt)Ut[Dt[Wt]].data.set(K[gt++].data)}return{inputs_embeds:B,attention_mask:De}}function j({image_token_id:P,inputs_embeds:B,image_features:K,input_ids:_e,attention_mask:De}){return fe({modality_token_id:P,inputs_embeds:B,modality_features:K,input_ids:_e,attention_mask:De})}function U({audio_token_id:P,inputs_embeds:B,audio_features:K,input_ids:_e,attention_mask:De}){return fe({modality_token_id:P,inputs_embeds:B,modality_features:K,input_ids:_e,attention_mask:De})}async function N(P,{encode_function:B,merge_function:K,modality_input_name:_e,modality_output_name:De,input_ids:Ae=null,attention_mask:Ve=null,position_ids:it=null,inputs_embeds:gt=null,past_key_values:wt=null,generation_config:Dt=null,logits_processor:Ut=null,...Wt}){const hn=Wt[_e];if(!gt){if(gt=await P.encode_text({input_ids:Ae,...Wt}),hn&&Ae.dims[1]!==1){const Kt=await B({[_e]:hn,...Wt});({inputs_embeds:gt,attention_mask:Ve}=K({[De]:Kt,inputs_embeds:gt,input_ids:Ae,attention_mask:Ve}))}else if(wt&&hn&&Ae.dims[1]===1){const Kt=Ae.dims[1],It=Object.values(wt)[0].dims.at(-2);Ve=(0,m.cat)([(0,m.ones)([Ae.dims[0],It]),Ve.slice(null,[Ve.dims[1]-Kt,Ve.dims[1]])],1)}}if(!it&&P.config.model_type==="qwen2_vl"){const{image_grid_thw:Kt,video_grid_thw:It}=Wt;[it]=P.get_rope_index(Ae,Kt,It,Ve)}return await ve(P,{inputs_embeds:gt,past_key_values:wt,attention_mask:Ve,position_ids:it,generation_config:Dt,logits_processor:Ut},!0)}async function q(P,B){return await N(P,{...B,modality_input_name:"audio_values",modality_output_name:"audio_features",encode_function:P.encode_audio.bind(P),merge_function:P._merge_input_ids_with_audio_features.bind(P)})}async function ce(P,B){return await N(P,{...B,modality_input_name:"pixel_values",modality_output_name:"image_features",encode_function:P.encode_image.bind(P),merge_function:P._merge_input_ids_with_image_features.bind(P)})}function Z(P,B=0){const[K,_e]=P.dims,De=P.data,Ae=new BigInt64Array(De.length);for(let Ve=0;Ve<K;++Ve){const it=Ve*_e;let gt=BigInt(B);for(let wt=0;wt<_e;++wt){const Dt=it+wt;De[Dt]===0n?Ae[Dt]=BigInt(1):(Ae[Dt]=gt,gt+=De[Dt])}}return{data:Ae,dims:P.dims}}function Me(P,B=null,K=0){const{input_ids:_e,inputs_embeds:De,attention_mask:Ae}=P,{data:Ve,dims:it}=Z(Ae,K);let gt=new m.Tensor("int64",Ve,it);if(B){const wt=-(_e??De).dims.at(1);gt=gt.slice(null,[wt,null])}return gt}function Pe(P,B,K,_e){const De=K.past_key_values?Object.values(K.past_key_values)[0].dims.at(-2):0;if(!K.attention_mask){let Ae;for(const Ve of["input_ids","inputs_embeds","position_ids"])if(K[Ve]){Ae=K[Ve].dims;break}if(!Ae)throw new Error("attention_mask is not provided, and unable to infer its shape from model inputs.");K.attention_mask=(0,m.ones)([Ae[0],De+Ae[1]])}if(K.past_key_values){const{input_ids:Ae,attention_mask:Ve}=K;Ve&&Ve.dims[1]>Ae.dims[1]||De<Ae.dims[1]&&(K.input_ids=Ae.slice(null,[De,null]))}return K}function Ne(P,B,K,_e){return K.past_key_values&&(B=B.map(De=>[De.at(-1)])),{...K,decoder_input_ids:le(B)}}function Oe(P,...B){return P.config.is_encoder_decoder?Ne(P,...B):Pe(P,...B)}function he(P,B,K,_e){const De=!!K.past_key_values;return _e.guidance_scale!==null&&_e.guidance_scale>1&&(De?K.input_ids=(0,m.cat)([K.input_ids,K.input_ids],0):(K.input_ids=(0,m.cat)([K.input_ids,(0,m.full_like)(K.input_ids,BigInt(_e.pad_token_id))],0),K.attention_mask=(0,m.cat)([K.attention_mask,(0,m.full_like)(K.attention_mask,0n)],0))),(De||!K.pixel_values)&&(K.pixel_values=(0,m.full)([0,0,3,384,384],1)),De&&(K.images_seq_mask=new m.Tensor("bool",new Array(1).fill(!0).fill(!1,0,1),[1,1]),K.images_emb_mask=new m.Tensor("bool",new Array(0).fill(!1),[1,1,0])),K}class H extends c.Callable{constructor(K,_e,De){super();ge(this,"main_input_name","input_ids");ge(this,"forward_params",["input_ids","attention_mask"]);this.config=K,this.sessions=_e,this.configs=De;const Ae=A.get(this.constructor),Ve=M.get(Ae);switch(this.can_generate=!1,this._forward=null,this._prepare_inputs_for_generation=null,Ve){case I.DecoderOnly:this.can_generate=!0,this._forward=ve,this._prepare_inputs_for_generation=Pe;break;case I.Seq2Seq:case I.Vision2Seq:case I.Musicgen:this.can_generate=!0,this._forward=Q,this._prepare_inputs_for_generation=Ne;break;case I.EncoderDecoder:this._forward=Q;break;case I.ImageTextToText:this.can_generate=!0,this._forward=ce,this._prepare_inputs_for_generation=Oe;break;case I.AudioTextToText:this.can_generate=!0,this._forward=q,this._prepare_inputs_for_generation=Oe;break;case I.Phi3V:case I.ImageAudioTextToText:this.can_generate=!0,this._prepare_inputs_for_generation=Oe;break;case I.MultiModality:this.can_generate=!0,this._prepare_inputs_for_generation=he;break;case I.AutoEncoder:this._forward=de;break;default:this._forward=ne;break}this.can_generate&&this.forward_params.push("past_key_values"),this.custom_config=this.config["transformers.js_config"]??{}}async dispose(){var _e;const K=[];for(const De of Object.values(this.sessions))(_e=De==null?void 0:De.handler)!=null&&_e.dispose&&K.push(De.handler.dispose());return await Promise.all(K)}static async from_pretrained(K,{progress_callback:_e=null,config:De=null,cache_dir:Ae=null,local_files_only:Ve=!1,revision:it="main",model_file_name:gt=null,subfolder:wt="onnx",device:Dt=null,dtype:Ut=null,use_external_data_format:Wt=null,session_options:hn={}}={}){let Lt={progress_callback:_e,config:De,cache_dir:Ae,local_files_only:Ve,revision:it,model_file_name:gt,subfolder:wt,device:Dt,dtype:Ut,use_external_data_format:Wt,session_options:hn};const Kt=A.get(this),It=M.get(Kt);De=Lt.config=await s.AutoConfig.from_pretrained(K,Lt);let on;if(It===I.DecoderOnly)on=await Promise.all([R(K,{model:Lt.model_file_name??"model"},Lt),G(K,{generation_config:"generation_config.json"},Lt)]);else if(It===I.Seq2Seq||It===I.Vision2Seq)on=await Promise.all([R(K,{model:"encoder_model",decoder_model_merged:"decoder_model_merged"},Lt),G(K,{generation_config:"generation_config.json"},Lt)]);else if(It===I.MaskGeneration)on=await Promise.all([R(K,{model:"vision_encoder",prompt_encoder_mask_decoder:"prompt_encoder_mask_decoder"},Lt)]);else if(It===I.EncoderDecoder)on=await Promise.all([R(K,{model:"encoder_model",decoder_model_merged:"decoder_model_merged"},Lt)]);else if(It===I.ImageTextToText){const In={embed_tokens:"embed_tokens",vision_encoder:"vision_encoder",decoder_model_merged:"decoder_model_merged"};De.is_encoder_decoder&&(In.model="encoder_model"),on=await Promise.all([R(K,In,Lt),G(K,{generation_config:"generation_config.json"},Lt)])}else if(It===I.AudioTextToText){const In={embed_tokens:"embed_tokens",audio_encoder:"audio_encoder",decoder_model_merged:"decoder_model_merged"};on=await Promise.all([R(K,In,Lt),G(K,{generation_config:"generation_config.json"},Lt)])}else if(It===I.ImageAudioTextToText){const In={embed_tokens:"embed_tokens",audio_encoder:"audio_encoder",vision_encoder:"vision_encoder",decoder_model_merged:"decoder_model_merged"};on=await Promise.all([R(K,In,Lt),G(K,{generation_config:"generation_config.json"},Lt)])}else if(It===I.Musicgen)on=await Promise.all([R(K,{model:"text_encoder",decoder_model_merged:"decoder_model_merged",encodec_decode:"encodec_decode"},Lt),G(K,{generation_config:"generation_config.json"},Lt)]);else if(It===I.MultiModality)on=await Promise.all([R(K,{prepare_inputs_embeds:"prepare_inputs_embeds",model:"language_model",lm_head:"lm_head",gen_head:"gen_head",gen_img_embeds:"gen_img_embeds",image_decode:"image_decode"},Lt),G(K,{generation_config:"generation_config.json"},Lt)]);else if(It===I.Phi3V)on=await Promise.all([R(K,{prepare_inputs_embeds:"prepare_inputs_embeds",model:"model",vision_encoder:"vision_encoder"},Lt),G(K,{generation_config:"generation_config.json"},Lt)]);else if(It===I.AutoEncoder)on=await Promise.all([R(K,{encoder_model:"encoder_model",decoder_model:"decoder_model"},Lt)]);else if(It===I.Supertonic)on=await Promise.all([R(K,{text_encoder:"text_encoder",latent_denoiser:"latent_denoiser",voice_decoder:"voice_decoder"},Lt)]);else{if(It!==I.EncoderOnly){const In=Kt??(De==null?void 0:De.model_type);In!=="custom"&&console.warn(`Model type for '${In}' not found, assuming encoder-only architecture. Please report this at ${h.GITHUB_ISSUE_URL}.`)}on=await Promise.all([R(K,{model:Lt.model_file_name??"model"},Lt)])}return new this(De,...on)}async _call(K){return await this.forward(K)}async forward(K){return await this._forward(this,K)}get generation_config(){var K;return((K=this.configs)==null?void 0:K.generation_config)??null}_get_logits_processor(K,_e,De=null){const Ae=new g.LogitsProcessorList;if(K.repetition_penalty!==null&&K.repetition_penalty!==1&&Ae.push(new g.RepetitionPenaltyLogitsProcessor(K.repetition_penalty)),K.no_repeat_ngram_size!==null&&K.no_repeat_ngram_size>0&&Ae.push(new g.NoRepeatNGramLogitsProcessor(K.no_repeat_ngram_size)),K.bad_words_ids!==null&&Ae.push(new g.NoBadWordsLogitsProcessor(K.bad_words_ids,K.eos_token_id)),K.min_length!==null&&K.eos_token_id!==null&&K.min_length>0&&Ae.push(new g.MinLengthLogitsProcessor(K.min_length,K.eos_token_id)),K.min_new_tokens!==null&&K.eos_token_id!==null&&K.min_new_tokens>0&&Ae.push(new g.MinNewTokensLengthLogitsProcessor(_e,K.min_new_tokens,K.eos_token_id)),K.forced_bos_token_id!==null&&Ae.push(new g.ForcedBOSTokenLogitsProcessor(K.forced_bos_token_id)),K.forced_eos_token_id!==null&&Ae.push(new g.ForcedEOSTokenLogitsProcessor(K.max_length,K.forced_eos_token_id)),K.begin_suppress_tokens!==null){const Ve=_e>1||K.forced_bos_token_id===null?_e:_e+1;Ae.push(new g.SuppressTokensAtBeginLogitsProcessor(K.begin_suppress_tokens,Ve))}return K.guidance_scale!==null&&K.guidance_scale>1&&Ae.push(new g.ClassifierFreeGuidanceLogitsProcessor(K.guidance_scale)),K.temperature===0&&K.do_sample&&(console.warn("`do_sample` changed to false because `temperature: 0` implies greedy sampling (always selecting the most likely token), which is incompatible with `do_sample: true`."),K.do_sample=!1),K.do_sample&&K.temperature!==null&&K.temperature!==1&&Ae.push(new g.TemperatureLogitsWarper(K.temperature)),De!==null&&Ae.extend(De),Ae}_prepare_generation_config(K,_e,De=p.GenerationConfig){const Ae={...this.config};for(const it of["decoder","generator","text_config"])it in Ae&&Object.assign(Ae,Ae[it]);const Ve=new De(Ae);return Object.assign(Ve,this.generation_config??{}),K&&Object.assign(Ve,K),_e&&Object.assign(Ve,(0,d.pick)(_e,Object.getOwnPropertyNames(Ve))),Ve}_get_stopping_criteria(K,_e=null){const De=new T.StoppingCriteriaList;return K.max_length!==null&&De.push(new T.MaxLengthCriteria(K.max_length,this.config.max_position_embeddings??null)),K.eos_token_id!==null&&De.push(new T.EosTokenCriteria(K.eos_token_id)),_e&&De.extend(_e),De}_validate_model_class(){if(!this.can_generate){const K=[cp,to,Yd,nu],_e=A.get(this.constructor),De=new Set,Ae=this.config.model_type;for(const it of K){const gt=it.get(Ae);gt&&De.add(gt[0])}let Ve=`The current model class (${_e}) is not compatible with \`.generate()\`, as it doesn't have a language model head.`;throw De.size>0&&(Ve+=` Please use the following class instead: ${[...De].join(", ")}`),Error(Ve)}}prepare_inputs_for_generation(...K){return this._prepare_inputs_for_generation(this,...K)}_update_model_kwargs_for_generation({generated_input_ids:K,outputs:_e,model_inputs:De,is_encoder_decoder:Ae}){return De.past_key_values=this.getPastKeyValues(_e,De.past_key_values),De.input_ids=new m.Tensor("int64",K.flat(),[K.length,1]),Ae||(De.attention_mask=(0,m.cat)([De.attention_mask,(0,m.ones)([De.attention_mask.dims[0],1])],1)),De.position_ids=null,De}_prepare_model_inputs({inputs:K,bos_token_id:_e,model_kwargs:De}){const Ae=(0,d.pick)(De,this.forward_params),Ve=this.main_input_name;if(Ve in Ae){if(K)throw new Error("`inputs`: {inputs}` were passed alongside {input_name} which is not allowed. Make sure to either pass {inputs} or {input_name}=...")}else Ae[Ve]=K;return{inputs_tensor:Ae[Ve],model_inputs:Ae,model_input_name:Ve}}async _prepare_encoder_decoder_kwargs_for_generation({inputs_tensor:K,model_inputs:_e,model_input_name:De,generation_config:Ae}){if(this.sessions.model.inputNames.includes("inputs_embeds")&&!_e.inputs_embeds&&"_prepare_inputs_embeds"in this){const{input_ids:it,pixel_values:gt,attention_mask:wt,...Dt}=_e,Ut=await this._prepare_inputs_embeds(_e);_e={...Dt,...(0,d.pick)(Ut,["inputs_embeds","attention_mask"])}}let{last_hidden_state:Ve}=await ne(this,_e);if(Ae.guidance_scale!==null&&Ae.guidance_scale>1)Ve=(0,m.cat)([Ve,(0,m.full_like)(Ve,0)],0),"attention_mask"in _e&&(_e.attention_mask=(0,m.cat)([_e.attention_mask,(0,m.zeros_like)(_e.attention_mask)],0));else if(_e.decoder_input_ids){const it=le(_e.decoder_input_ids).dims[0];if(it!==Ve.dims[0]){if(Ve.dims[0]!==1)throw new Error(`The encoder outputs have a different batch size (${Ve.dims[0]}) than the decoder inputs (${it}).`);Ve=(0,m.cat)(Array.from({length:it},()=>Ve),0)}}return _e.encoder_outputs=Ve,_e}_prepare_decoder_input_ids_for_generation({batch_size:K,model_input_name:_e,model_kwargs:De,decoder_start_token_id:Ae,bos_token_id:Ve,generation_config:it}){let{decoder_input_ids:gt,...wt}=De;if(!(gt instanceof m.Tensor)){if(gt)Array.isArray(gt[0])||(gt=Array.from({length:K},()=>gt));else if(Ae??(Ae=Ve),this.config.model_type==="musicgen")gt=Array.from({length:K*this.config.decoder.num_codebooks},()=>[Ae]);else if(Array.isArray(Ae)){if(Ae.length!==K)throw new Error(`\`decoder_start_token_id\` expcted to have length ${K} but got ${Ae.length}`);gt=Ae}else gt=Array.from({length:K},()=>[Ae]);gt=le(gt)}return De.decoder_attention_mask=(0,m.ones_like)(gt),{input_ids:gt,model_inputs:wt}}async generate({inputs:K=null,generation_config:_e=null,logits_processor:De=null,stopping_criteria:Ae=null,streamer:Ve=null,...it}){this._validate_model_class(),_e=this._prepare_generation_config(_e,it);let{inputs_tensor:gt,model_inputs:wt,model_input_name:Dt}=this._prepare_model_inputs({inputs:K,model_kwargs:it});const Ut=this.config.is_encoder_decoder;Ut&&("encoder_outputs"in wt||(wt=await this._prepare_encoder_decoder_kwargs_for_generation({inputs_tensor:gt,model_inputs:wt,model_input_name:Dt,generation_config:_e})));let Wt;Ut?{input_ids:Wt,model_inputs:wt}=this._prepare_decoder_input_ids_for_generation({batch_size:wt[Dt].dims.at(0),model_input_name:Dt,model_kwargs:wt,decoder_start_token_id:_e.decoder_start_token_id,bos_token_id:_e.bos_token_id,generation_config:_e}):Wt=wt[Dt];let hn=Wt.dims.at(-1);_e.max_new_tokens!==null&&(_e.max_length=hn+_e.max_new_tokens);const Lt=this._get_logits_processor(_e,hn,De),Kt=this._get_stopping_criteria(_e,Ae),It=wt[Dt].dims.at(0),on=O.LogitsSampler.getSampler(_e),In=new Array(It).fill(0),qn=Wt.tolist();Ve&&Ve.put(qn);let sr,fr={};for(;;){if(wt=this.prepare_inputs_for_generation(qn,wt,_e),sr=await this.forward(wt),_e.output_attentions&&_e.return_dict_in_generate){const ba=this.getAttentions(sr);for(const ja in ba)ja in fr||(fr[ja]=[]),fr[ja].push(ba[ja])}const ln=sr.logits.slice(null,-1,null),Br=Lt(qn,ln),es=[];for(let ba=0;ba<Br.dims.at(0);++ba){const ja=Br[ba],Xl=await on(ja);for(const[Ko,Ca]of Xl){const Yl=BigInt(Ko);In[ba]+=Ca,qn[ba].push(Yl),es.push([Yl]);break}}if(Ve&&Ve.put(es),Kt(qn).every(ba=>ba))break;wt=this._update_model_kwargs_for_generation({generated_input_ids:es,outputs:sr,model_inputs:wt,is_encoder_decoder:Ut})}Ve&&Ve.end();const er=this.getPastKeyValues(sr,wt.past_key_values,!0),Zr=new m.Tensor("int64",qn.flat(),[qn.length,qn[0].length]);if(_e.return_dict_in_generate)return{sequences:Zr,past_key_values:er,...fr};for(const ln of Object.values(sr))ln.location==="gpu-buffer"&&ln.dispose();return Zr}getPastKeyValues(K,_e,De=!1){const Ae=Object.create(null);for(const Ve in K)if(Ve.startsWith("present")){const it=Ve.replace("present_conv","past_conv").replace("present","past_key_values"),gt=Ve.includes("encoder");if(gt&&_e?Ae[it]=_e[it]:Ae[it]=K[Ve],_e&&(!gt||De)){const wt=_e[it];wt.location==="gpu-buffer"&&wt.dispose()}}return Ae}getAttentions(K){const _e={};for(const De of["cross_attentions","encoder_attentions","decoder_attentions"])for(const Ae in K)Ae.startsWith(De)&&(De in _e||(_e[De]=[]),_e[De].push(K[Ae]));return _e}addPastKeyValues(K,_e){var De,Ae,Ve;if(_e)Object.assign(K,_e);else{const it=this.sessions.decoder_model_merged??this.sessions.model,gt=((Ae=(De=K[this.main_input_name]??K.attention_mask)==null?void 0:De.dims)==null?void 0:Ae[0])??1,wt=((Ve=it==null?void 0:it.config)==null?void 0:Ve.kv_cache_dtype)??"float32",Dt=wt==="float16"?m.DataTypeMap.float16:m.DataTypeMap.float32,Ut=(0,s.getCacheShapes)(this.config,{batch_size:gt});for(const Wt in Ut){const hn=Ut[Wt].reduce((Lt,Kt)=>Lt*Kt,1);K[Wt]=new m.Tensor(wt,new Dt(hn),Ut[Wt])}}}async encode_image({pixel_values:K}){return(await ee(this.sessions.vision_encoder,{pixel_values:K})).image_features}async encode_text({input_ids:K}){return(await ee(this.sessions.embed_tokens,{input_ids:K})).inputs_embeds}async encode_audio({audio_values:K}){return(await ee(this.sessions.audio_encoder,{audio_values:K})).audio_features}}class Te{}class ze extends Te{constructor({last_hidden_state:B,hidden_states:K=null,attentions:_e=null}){super(),this.last_hidden_state=B,this.hidden_states=K,this.attentions=_e}}class Re extends H{}class He extends Re{}class Ke extends Re{async _call(B){return new Vr(await super._call(B))}}class Be extends Re{async _call(B){return new qt(await super._call(B))}}class nt extends Re{async _call(B){return new Ur(await super._call(B))}}class $e extends Re{async _call(B){return new Gr(await super._call(B))}}class qe extends H{}class _t extends qe{}class Je extends qe{async _call(B){return new Vr(await super._call(B))}}class pt extends qe{async _call(B){return new qt(await super._call(B))}}class dt extends qe{async _call(B){return new Ur(await super._call(B))}}class Gt extends qe{async _call(B){return new Gr(await super._call(B))}}class vt extends H{}class Ze extends vt{}class rt extends vt{async _call(B){return new Vr(await super._call(B))}}class kt extends vt{async _call(B){return new qt(await super._call(B))}}class Nt extends vt{async _call(B){return new Ur(await super._call(B))}}class gn extends H{}class Jt extends gn{}class Cn extends gn{}class Fn extends H{}class tn extends Fn{}class ta extends H{}class ds extends ta{}class fs extends ta{async _call(B){return new Vr(await super._call(B))}}class Wa extends ta{async _call(B){return new qt(await super._call(B))}}class Vn extends ta{async _call(B){return new Ur(await super._call(B))}}class Er extends ta{async _call(B){return new Gr(await super._call(B))}}class qr extends H{}class Pa extends qr{}class Ft extends qr{async _call(B){return new Vr(await super._call(B))}}class ns extends qr{async _call(B){return new qt(await super._call(B))}}class Ha extends qr{async _call(B){return new Ur(await super._call(B))}}class Dn extends qr{async _call(B){return new Gr(await super._call(B))}}class Kr extends H{}class an extends Kr{}class Qa extends Kr{async _call(B){return new Vr(await super._call(B))}}class L extends Kr{async _call(B){return new qt(await super._call(B))}}class ue extends Kr{async _call(B){return new Ur(await super._call(B))}}class Y extends Kr{async _call(B){return new Gr(await super._call(B))}}class oe extends H{}class pe extends oe{}class Ce extends oe{async _call(B){return new Vr(await super._call(B))}}class Ue extends oe{async _call(B){return new qt(await super._call(B))}}class Ye extends oe{async _call(B){return new Ur(await super._call(B))}}class ct extends oe{async _call(B){return new Gr(await super._call(B))}}class ft extends H{}class Tt extends ft{}class Et extends ft{async _call(B){return new Vr(await super._call(B))}}class nn extends ft{async _call(B){return new qt(await super._call(B))}}class xt extends ft{async _call(B){return new Ur(await super._call(B))}}class Zt extends ft{async _call(B){return new Gr(await super._call(B))}}class wn extends H{}class Gn extends wn{}class or extends wn{async _call(B){return new Vr(await super._call(B))}}class Ir extends wn{async _call(B){return new qt(await super._call(B))}}class _a extends wn{async _call(B){return new Ur(await super._call(B))}}class nr extends wn{async _call(B){return new Gr(await super._call(B))}}class Tr extends H{}class Bs extends Tr{}class na extends Tr{async _call(B){return new qt(await super._call(B))}}class Pr extends Tr{async _call(B){return new Ur(await super._call(B))}}class xa extends Tr{async _call(B){return new Gr(await super._call(B))}}class mr extends Tr{async _call(B){return new Vr(await super._call(B))}}class wr extends H{}class hs extends wr{}class qa extends wr{async _call(B){return new Vr(await super._call(B))}}class Ka extends wr{async _call(B){return new qt(await super._call(B))}}class ra extends wr{async _call(B){return new Ur(await super._call(B))}}class Ar extends H{}class ua extends Ar{}class lt extends Ar{async _call(B){return new Vr(await super._call(B))}}class ut extends Ar{async _call(B){return new qt(await super._call(B))}}class At extends Ar{async _call(B){return new Gr(await super._call(B))}}class En extends H{}class ni extends En{}class Fr extends En{async _call(B){return new Vr(await super._call(B))}}class ps extends En{async _call(B){return new qt(await super._call(B))}}class Pi extends En{async _call(B){return new Ur(await super._call(B))}}class Ie extends En{async _call(B){return new Gr(await super._call(B))}}class V extends H{}class se extends V{}class me extends V{async _call(B){return new Vr(await super._call(B))}}class be extends V{async _call(B){return new qt(await super._call(B))}}class Se extends V{async _call(B){return new Gr(await super._call(B))}}class We extends H{}class ht extends We{}class bt extends We{async _call(B){return new qt(await super._call(B))}}class yt extends We{async _call(B){return new Gr(await super._call(B))}}class Ct extends We{async _call(B){return new Vr(await super._call(B))}}class Vt extends H{constructor(){super(...arguments);ge(this,"forward_params",["input_ids","attention_mask","encoder_outputs","decoder_input_ids","decoder_attention_mask","past_key_values"])}}class un extends Vt{}class vn extends Vt{}class Jn extends H{}class Tn extends Jn{}class lr extends Jn{}class kr extends H{}class gr extends kr{}class Dr extends kr{}class Mr extends H{}class zr extends Mr{}class Wn extends Mr{}class _r extends Mr{async _call(B){return new qt(await super._call(B))}}class cr extends H{}class va extends cr{}class ka extends cr{}class Xr extends cr{async _call(B){return new qt(await super._call(B))}}class Ea extends cr{}class rr extends H{}class xr extends rr{}class Sn extends rr{}class On extends H{}class aa extends On{}class Xa extends On{}class Ls extends H{}class rl extends Ls{}class al extends Ls{async _call(B){return new Vr(await super._call(B))}}class ri extends Ls{async _call(B){return new qt(await super._call(B))}}class lo extends Ls{async _call(B){return new Ur(await super._call(B))}}class cc extends Ls{async _call(B){return new Gr(await super._call(B))}}class ki extends H{}class Su extends ki{}class Iu extends ki{async _call(B){return new Vr(await super._call(B))}}class sl extends ki{async _call(B){return new qt(await super._call(B))}}class Pu extends ki{async _call(B){return new Ur(await super._call(B))}}class ku extends ki{async _call(B){return new Gr(await super._call(B))}}class Di extends H{}class Du extends Di{}class Ou extends Di{async _call(B){return new Vr(await super._call(B))}}class uc extends Di{async _call(B){return new qt(await super._call(B))}}class dc extends Di{async _call(B){return new Ur(await super._call(B))}}class fc extends Di{async _call(B){return new Gr(await super._call(B))}}class il extends H{}class $u extends il{}class ol extends il{}class ll extends H{constructor(){super(...arguments);ge(this,"requires_attention_mask",!1);ge(this,"main_input_name","input_features");ge(this,"forward_params",["input_features","attention_mask","decoder_input_ids","decoder_attention_mask","past_key_values"])}}class hc extends ll{}class ai extends ll{_prepare_generation_config(B,K){return super._prepare_generation_config(B,K,S.WhisperGenerationConfig)}_retrieve_init_tokens(B){const K=[B.decoder_start_token_id];let _e=B.language;const De=B.task;if(B.is_multilingual){_e||(console.warn("No language specified - defaulting to English (en)."),_e="en");const Ve=`<|${(0,D.whisper_language_to_code)(_e)}|>`;K.push(B.lang_to_id[Ve]),K.push(B.task_to_id[De??"transcribe"])}else if(_e||De)throw new Error("Cannot specify `task` or `language` for an English-only model. If the model is intended to be multilingual, pass `is_multilingual=true` to generate, or update the generation config.");return!B.return_timestamps&&B.no_timestamps_token_id&&K.at(-1)!==B.no_timestamps_token_id?K.push(B.no_timestamps_token_id):B.return_timestamps&&K.at(-1)===B.no_timestamps_token_id&&(console.warn("<|notimestamps|> prompt token is removed from generation_config since `return_timestamps` is set to `true`."),K.pop()),K.filter(Ae=>Ae!=null)}async generate({inputs:B=null,generation_config:K=null,logits_processor:_e=null,stopping_criteria:De=null,...Ae}){K=this._prepare_generation_config(K,Ae);const Ve=Ae.decoder_input_ids??this._retrieve_init_tokens(K);if(K.return_timestamps&&(_e??(_e=new g.LogitsProcessorList),_e.push(new g.WhisperTimeStampLogitsProcessor(K,Ve))),K.begin_suppress_tokens&&(_e??(_e=new g.LogitsProcessorList),_e.push(new g.SuppressTokensAtBeginLogitsProcessor(K.begin_suppress_tokens,Ve.length))),K.return_token_timestamps){if(!K.alignment_heads)throw new Error("Model generation config has no `alignment_heads`, token-level timestamps not available. See https://gist.github.com/hollance/42e32852f24243b748ae6bc1f985b13a on how to add this property to the generation config.");K.task==="translate"&&console.warn("Token-level timestamps may not be reliable for task 'translate'."),K.output_attentions=!0,K.return_dict_in_generate=!0}const it=await super.generate({inputs:B,generation_config:K,logits_processor:_e,decoder_input_ids:Ve,...Ae});return K.return_token_timestamps&&(it.token_timestamps=this._extract_token_timestamps(it,K.alignment_heads,K.num_frames)),it}_extract_token_timestamps(B,K,_e=null,De=.02){if(!B.cross_attentions)throw new Error("Model outputs must contain cross attentions to extract timestamps. This is most likely because the model was not exported with `output_attentions=True`.");_e==null&&console.warn("`num_frames` has not been set, meaning the entire audio will be analyzed. This may lead to inaccurate token-level timestamps for short audios (< 30 seconds).");let Ae=this.config.median_filter_width;Ae===void 0&&(console.warn("Model config has no `median_filter_width`, using default value of 7."),Ae=7);const Ve=B.cross_attentions,it=Array.from({length:this.config.decoder_layers},(Kt,It)=>(0,m.cat)(Ve.map(on=>on[It]),2)),gt=(0,m.stack)(K.map(([Kt,It])=>{if(Kt>=it.length)throw new Error(`Layer index ${Kt} is out of bounds for cross attentions (length ${it.length}).`);return _e?it[Kt].slice(null,It,null,[0,_e]):it[Kt].slice(null,It)})).transpose(1,0,2,3),[wt,Dt]=(0,m.std_mean)(gt,-2,0,!0),Ut=gt.clone();for(let Kt=0;Kt<Ut.dims[0];++Kt){const It=Ut[Kt];for(let on=0;on<It.dims[0];++on){const In=It[on],qn=wt[Kt][on][0].data,sr=Dt[Kt][on][0].data;for(let fr=0;fr<In.dims[0];++fr){let er=In[fr].data;for(let Zr=0;Zr<er.length;++Zr)er[Zr]=(er[Zr]-sr[Zr])/qn[Zr];er.set((0,v.medianFilter)(er,Ae))}}}const Wt=[(0,m.mean)(Ut,1)],hn=B.sequences.dims,Lt=new m.Tensor("float32",new Float32Array(hn[0]*hn[1]),hn);for(let Kt=0;Kt<hn[0];++Kt){const It=Wt[Kt].neg().squeeze_(0),[on,In]=(0,v.dynamic_time_warping)(It.tolist()),qn=Array.from({length:on.length-1},(er,Zr)=>on[Zr+1]-on[Zr]),sr=(0,d.mergeArrays)([1],qn).map(er=>!!er),fr=[];for(let er=0;er<sr.length;++er)sr[er]&&fr.push(In[er]*De);Lt[Kt].data.set(fr,1)}return Lt}}class pc extends ai{}class cl extends H{constructor(){super(...arguments);ge(this,"requires_attention_mask",!1);ge(this,"main_input_name","input_values");ge(this,"forward_params",["input_values","decoder_input_ids","past_key_values"])}}class Tf extends cl{}class Bu extends cl{}class mc extends H{constructor(){super(...arguments);ge(this,"main_input_name","pixel_values");ge(this,"forward_params",["pixel_values","decoder_input_ids","encoder_hidden_states","past_key_values"])}}class co extends H{constructor(){super(...arguments);ge(this,"forward_params",["input_ids","attention_mask","pixel_values","position_ids","past_key_values"])}}class uo extends co{_merge_input_ids_with_image_features(B){const K=B.image_features.dims.at(-1),_e=B.image_features.view(-1,K);return j({image_token_id:this.config.image_token_index,...B,image_features:_e})}}class Lu extends uo{}class Fu extends uo{}class zu extends H{constructor(){super(...arguments);ge(this,"forward_params",["input_ids","inputs_embeds","attention_mask","pixel_values","encoder_outputs","decoder_input_ids","decoder_inputs_embeds","decoder_attention_mask","past_key_values"]);ge(this,"main_input_name","inputs_embeds")}}class ul extends zu{_merge_input_ids_with_image_features({inputs_embeds:B,image_features:K,input_ids:_e,attention_mask:De}){return{inputs_embeds:(0,m.cat)([K,B],1),attention_mask:(0,m.cat)([(0,m.ones)(K.dims.slice(0,2)),De],1)}}async _prepare_inputs_embeds({input_ids:B,pixel_values:K,inputs_embeds:_e,attention_mask:De}){if(!B&&!K)throw new Error("Either `input_ids` or `pixel_values` should be provided.");let Ae,Ve;return B&&(Ae=await this.encode_text({input_ids:B})),K&&(Ve=await this.encode_image({pixel_values:K})),Ae&&Ve?{inputs_embeds:_e,attention_mask:De}=this._merge_input_ids_with_image_features({inputs_embeds:Ae,image_features:Ve,input_ids:B,attention_mask:De}):_e=Ae||Ve,{inputs_embeds:_e,attention_mask:De}}async forward({input_ids:B,pixel_values:K,attention_mask:_e,decoder_input_ids:De,decoder_attention_mask:Ae,encoder_outputs:Ve,past_key_values:it,inputs_embeds:gt,decoder_inputs_embeds:wt}){if(gt||({inputs_embeds:gt,attention_mask:_e}=await this._prepare_inputs_embeds({input_ids:B,pixel_values:K,inputs_embeds:gt,attention_mask:_e})),!Ve){let{last_hidden_state:Wt}=await ne(this,{inputs_embeds:gt,attention_mask:_e});Ve=Wt}if(!wt){if(!De)throw new Error("Either `decoder_input_ids` or `decoder_inputs_embeds` should be provided.");wt=await this.encode_text({input_ids:De})}return await ve(this,{inputs_embeds:wt,attention_mask:Ae,encoder_attention_mask:_e,encoder_hidden_states:Ve,past_key_values:it},!0)}}class Oi extends H{constructor(){super(...arguments);ge(this,"forward_params",["input_ids","attention_mask","pixel_values","position_ids","past_key_values"])}}class Nu extends Oi{_merge_input_ids_with_image_features(B){const K=B.image_features.dims.at(-1),_e=B.image_features.view(-1,K);return j({image_token_id:this.config.image_token_index,...B,image_features:_e})}}class dl extends co{_merge_input_ids_with_image_features(B){const K=B.image_features.dims.at(-1),_e=B.image_features.view(-1,K);return j({image_token_id:this.config.image_token_index,...B,image_features:_e})}}class gc extends dl{}class _c extends H{constructor(){super(...arguments);ge(this,"forward_params",["input_ids","attention_mask","inputs_embeds","per_layer_inputs","position_ids","pixel_values","input_features","input_features_mask","past_key_values"])}}class si extends _c{async forward({input_ids:B=null,attention_mask:K=null,pixel_values:_e=null,input_features:De=null,input_features_mask:Ae=null,position_ids:Ve=null,inputs_embeds:it=null,per_layer_inputs:gt=null,past_key_values:wt=null,generation_config:Dt=null,logits_processor:Ut=null,...Wt}){if((!it||!gt)&&({inputs_embeds:it,per_layer_inputs:gt}=await ee(this.sessions.embed_tokens,{input_ids:B}),B.dims[1]!==1)){if(_e){const{image_features:Lt}=await ee(this.sessions.vision_encoder,{pixel_values:_e});({inputs_embeds:it,attention_mask:K}=this._merge_input_ids_with_image_features({image_features:Lt,inputs_embeds:it,input_ids:B,attention_mask:K}))}if(De){const{audio_features:Lt}=await ee(this.sessions.audio_encoder,{input_features:De,input_features_mask:Ae});({inputs_embeds:it,attention_mask:K}=this._merge_input_ids_with_audio_features({audio_features:Lt,inputs_embeds:it,input_ids:B,attention_mask:K}))}}return await ve(this,{inputs_embeds:it,per_layer_inputs:gt,past_key_values:wt,attention_mask:K,position_ids:Ve,generation_config:Dt,logits_processor:Ut},!0)}_merge_input_ids_with_image_features(B){const K=B.image_features.dims.at(-1),_e=B.image_features.view(-1,K);return j({image_token_id:this.config.image_token_id,...B,image_features:_e})}_merge_input_ids_with_audio_features(B){const K=B.audio_features.dims.at(-1),_e=B.audio_features.view(-1,K);return U({audio_token_id:this.config.audio_token_id,...B,audio_features:_e})}}class ii extends H{constructor(){super(...arguments);ge(this,"forward_params",["input_ids","attention_mask","pixel_values","pixel_attention_mask","position_ids","past_key_values"])}}class rs extends ii{async encode_image({pixel_values:B,pixel_attention_mask:K}){return(await ee(this.sessions.vision_encoder,{pixel_values:B,pixel_attention_mask:K})).image_features}_merge_input_ids_with_image_features(B){const K=B.image_features.dims.at(-1),_e=B.image_features.view(-1,K);return j({image_token_id:this.config.image_token_id,...B,image_features:_e})}}class vc extends rs{}class Ru extends H{constructor(){super(...arguments);ge(this,"forward_params",["input_ids","inputs_embeds","attention_mask","position_ids","pixel_values","image_sizes","past_key_values"])}}class fo extends Ru{async forward({input_ids:B=null,attention_mask:K=null,pixel_values:_e=null,image_sizes:De=null,position_ids:Ae=null,inputs_embeds:Ve=null,past_key_values:it=null,generation_config:gt=null,logits_processor:wt=null,...Dt}){if(!Ve){let Wt;if(_e&&B.dims[1]!==1){if(!De)throw new Error("`image_sizes` must be provided when `pixel_values` is provided.");({image_features:Wt}=await ee(this.sessions.vision_encoder,{pixel_values:_e,image_sizes:De}))}else{const hn=this.config.normalized_config.hidden_size;Wt=new m.Tensor("float32",[],[0,hn])}({inputs_embeds:Ve}=await ee(this.sessions.prepare_inputs_embeds,{input_ids:B,image_features:Wt}))}return await ve(this,{inputs_embeds:Ve,past_key_values:it,attention_mask:K,position_ids:Ae,generation_config:gt,logits_processor:wt},!1)}}class as extends H{}class fl extends as{}class $i extends as{static async from_pretrained(B,K={}){return super.from_pretrained(B,{...K,model_file_name:K.model_file_name??"text_model"})}}class oi extends as{static async from_pretrained(B,K={}){return super.from_pretrained(B,{...K,model_file_name:K.model_file_name??"text_model"})}}class ju extends as{static async from_pretrained(B,K={}){return super.from_pretrained(B,{...K,model_file_name:K.model_file_name??"vision_model"})}}class Bi extends as{static async from_pretrained(B,K={}){return super.from_pretrained(B,{...K,model_file_name:K.model_file_name??"vision_model"})}}class ho extends H{}class yc extends ho{}class po extends ho{static async from_pretrained(B,K={}){return super.from_pretrained(B,{...K,model_file_name:K.model_file_name??"text_model"})}}class mo extends as{static async from_pretrained(B,K={}){return super.from_pretrained(B,{...K,model_file_name:K.model_file_name??"vision_model"})}}class Li extends H{}class Bt extends Li{}class go extends H{}class bc extends go{async forward(B){const K=!B.input_ids,_e=!B.pixel_values;if(K&&_e)throw new Error("Either `input_ids` or `pixel_values` should be provided.");if(K&&(B.input_ids=(0,m.ones)([B.pixel_values.dims[0],1])),_e){const{image_size:wt}=this.config.vision_config;B.pixel_values=(0,m.full)([0,3,wt,wt],0)}const{text_embeddings:De,image_embeddings:Ae,l2norm_text_embeddings:Ve,l2norm_image_embeddings:it}=await super.forward(B),gt={};return K||(gt.text_embeddings=De,gt.l2norm_text_embeddings=Ve),_e||(gt.image_embeddings=Ae,gt.l2norm_image_embeddings=it),gt}}class wc extends go{static async from_pretrained(B,K={}){return super.from_pretrained(B,{...K,model_file_name:K.model_file_name??"text_model"})}}class _o extends go{static async from_pretrained(B,K={}){return super.from_pretrained(B,{...K,model_file_name:K.model_file_name??"vision_model"})}}class Da extends H{}class vo extends Da{}class sa extends Da{}class Fs extends H{}class hl extends Fs{}class pl extends Fs{}class Fi extends H{}class ml extends Fi{}class yo extends Fi{}class gl extends H{}class ss extends gl{}class zi extends gl{}class ms extends H{}class bo extends ms{}class _l extends ms{}class is extends H{}class zs extends is{}class wo extends is{}class Mo extends H{}class b extends Mo{}class $ extends Mo{}class W extends H{}class J extends W{}class ie extends W{}class Ee extends H{}class Xe extends Ee{}class ot extends Ee{}class Mt extends H{}class St extends Mt{}class Rt extends H{}class _n extends Rt{}class dn extends Rt{}class ur extends H{}class gs extends ur{}class xo extends ur{}class vl extends H{}class Uu extends vl{}class Ni extends vl{}class Vu extends H{}class Mc extends Vu{}class Eo extends Vu{}class Af extends H{}class Oa extends Af{}class Gu extends Af{}class _s extends H{}class Cf extends _s{}class xc extends _s{}class li extends H{}class Wu extends li{}class Sf extends li{}class Ec extends H{}class If extends Ec{}class Ya extends Ec{}class Ri extends H{}class To extends Ri{}class Tc extends Ri{}class Ao extends H{}class Ja extends Ao{}class Za extends Ao{}class Ns extends H{}class vs extends Ns{}class ys extends Ns{}class bs extends H{}class Pf extends bs{}class Hu extends bs{}class Ac extends H{}class kf extends Ac{}class ia extends Ac{}class ar extends H{}class An extends ar{}class ci extends ar{}class $a extends H{}class Qu extends $a{}class ui extends $a{}class qu extends H{}class Df extends qu{}class Co extends qu{}class di extends H{}class Ku extends di{}class yl extends di{}class Cc extends H{}class ji extends Cc{}class Rs extends Cc{}class js extends H{}class Us extends js{}class Xu extends js{}class Sc extends H{}class So extends Sc{}class Ic extends Sc{}class Ui extends H{constructor(){super(...arguments);ge(this,"forward_params",["input_ids","attention_mask","position_ids","past_key_values","pixel_values","image_grid_thw"])}}class oa extends Ui{get_rope_index(B,K,_e,De){const{vision_config:Ae,image_token_id:Ve,video_token_id:it,vision_start_token_id:gt}=this.config,wt=Ae.spatial_merge_size??2,Dt=[];if(K||_e){let Ut=B.tolist();De||(De=(0,m.ones_like)(B));const Wt=De.tolist(),hn=Array.from({length:3},In=>Array.from({length:B.dims[0]},qn=>Array.from({length:B.dims[1]},sr=>1))),Lt=K?K.tolist():[],Kt=_e?_e.tolist():[];let It=0,on=0;for(let In=0;In<Ut.length;++In){const qn=Ut[In].filter((ir,Wr)=>Wt[In][Wr]==1),fr=qn.reduce((ir,Wr,bi)=>(Wr==gt&&ir.push(bi),ir),[]).map(ir=>qn[ir+1]),er=fr.filter(ir=>ir==Ve).length,Zr=fr.filter(ir=>ir==it).length;let ln=[],Br=0,es=er,qo=Zr;for(let ir=0;ir<fr.length;++ir){const Wr=qn.findIndex((ro,wa)=>wa>Br&&ro==Ve),bi=qn.findIndex((ro,wa)=>wa>Br&&ro==it),Is=es>0&&Wr!==-1?Wr:qn.length+1,pa=qo>0&&bi!==-1?bi:qn.length+1;let cu,Jl,Ps,Op;Is<pa?([Jl,Ps,Op]=Lt[It],++It,--es,cu=Is):([Jl,Ps,Op]=Kt[on],++on,--qo,cu=pa);const[p_,no,uu]=[Number(Jl),Math.floor(Number(Ps)/wt),Math.floor(Number(Op)/wt)],$p=cu-Br,Xm=ln.length>0?(0,v.max)(ln.at(-1))[0]+1:0;ln.push(Array.from({length:3*$p},(ro,wa)=>Xm+wa%$p));const Bp=$p+Xm,lf=p_*no*uu,m_=Array.from({length:lf},(ro,wa)=>Bp+Math.floor(wa/(no*uu))),g_=Array.from({length:lf},(ro,wa)=>Bp+Math.floor(wa/uu)%no),__=Array.from({length:lf},(ro,wa)=>Bp+wa%uu);ln.push([m_,g_,__].flat()),Br=cu+lf}if(Br<qn.length){const ir=ln.length>0?(0,v.max)(ln.at(-1))[0]+1:0,Wr=qn.length-Br;ln.push(Array.from({length:3*Wr},(bi,Is)=>ir+Is%Wr))}const ba=ln.reduce((ir,Wr)=>ir+Wr.length,0),ja=new Array(ba);let Xl=0;for(let ir=0;ir<3;++ir)for(let Wr=0;Wr<ln.length;++Wr){const bi=ln[Wr],Is=bi.length/3;for(let pa=ir*Is;pa<(ir+1)*Is;++pa)ja[Xl++]=bi[pa]}let Ko=0;const Ca=Wt[In];for(let ir=0;ir<Ca.length;++ir)if(Ca[ir]==1){for(let Wr=0;Wr<3;++Wr)hn[Wr][In][ir]=ja[Wr*ba/3+Ko];++Ko}const Yl=(0,v.max)(ja)[0];Dt.push(Yl+1-Ut[In].length)}return[new m.Tensor("int64",hn.flat(1/0),[3,B.dims[0],B.dims[1]]),new m.Tensor("int64",Dt,[Dt.length,1])]}else if(De){const{data:Ut,dims:Wt}=Z(De),hn=BigInt64Array.from({length:3*Ut.length},(Kt,It)=>Ut[It%Ut.length]),Lt=Array.from({length:Wt[0]},(Kt,It)=>(0,v.max)(Ut.subarray(Wt[1]*It,Wt[1]*(It+1)))[0]+1n+BigInt(Wt[1]));return[new m.Tensor("int64",hn,[3,...Wt]),new m.Tensor("int64",Lt,[Lt.length,1])]}else{const[Ut,Wt]=B.dims,hn=BigInt64Array.from({length:3*Ut*Wt},(Lt,Kt)=>BigInt(Math.floor(Kt%Wt/Ut)));return[new m.Tensor("int64",hn,[3,...B.dims]),(0,m.zeros)([Ut,1])]}}async encode_image({pixel_values:B,image_grid_thw:K}){return(await ee(this.sessions.vision_encoder,{pixel_values:B,grid_thw:K})).image_features}_merge_input_ids_with_image_features(B){return j({image_token_id:this.config.image_token_id,...B})}prepare_inputs_for_generation(B,K,_e){if(K.attention_mask&&!K.position_ids)if(!K.past_key_values)[K.position_ids,K.rope_deltas]=this.get_rope_index(K.input_ids,K.image_grid_thw,K.video_grid_thw,K.attention_mask);else{K.pixel_values=null;const De=BigInt(Object.values(K.past_key_values)[0].dims.at(-2)),Ae=K.rope_deltas.map(Ve=>De+Ve);K.position_ids=(0,m.stack)([Ae,Ae,Ae],0)}return K}}class bl extends H{}class Of extends bl{}class vm extends bl{}class $f extends H{}class ym extends $f{}class Nr extends $f{}class Pc extends H{}class wl extends Pc{}class Ml extends Pc{}class kc extends H{}class Io extends kc{}class Po extends kc{}class Bf extends H{}class Lf extends Bf{}class bm extends Bf{}class Yu extends H{}class Vi extends Yu{}class Ju extends Yu{async _call(B){return new qt(await super._call(B))}}class xl extends H{}class Ff extends xl{}class ko extends xl{async _call(B){return new qt(await super._call(B))}}class Zu extends H{}class Dc extends Zu{}class El extends H{}class zf extends El{}class Nf extends El{async _call(B){return new qt(await super._call(B))}}class Gi extends H{}class Wi extends Gi{}class ed extends H{}class Rf extends ed{}class Do extends ed{async _call(B){return new qt(await super._call(B))}}class Tl extends H{}class Oc extends Tl{}class Oo extends H{}class $c extends Oo{}class jf extends Oo{async _call(B){return new qt(await super._call(B))}}class Hi extends H{}class Uf extends Hi{async _call(B){return new Dp(await super._call(B))}}class Vs extends H{}class td extends Vs{}class nd extends Vs{async _call(B){return new qt(await super._call(B))}}class Gs extends H{}class fi extends Gs{}class Al extends Gs{async _call(B){return new qt(await super._call(B))}}class Bc extends H{}class rd extends Bc{}class Cl extends Bc{}class $o extends H{}class Vf extends $o{}class Gf extends $o{}class Qi extends H{}class Lc extends Qi{}class Wf extends Qi{async _call(B){return new qt(await super._call(B))}}class Sl extends H{}class ad extends Sl{}class Ba extends Sl{async _call(B){return new Ws(await super._call(B))}}class La extends Sl{async _call(B){return new sd(await super._call(B))}}class Ws extends Te{constructor({logits:B,pred_boxes:K}){super(),this.logits=B,this.pred_boxes=K}}class sd extends Te{constructor({logits:B,pred_boxes:K,pred_masks:_e}){super(),this.logits=B,this.pred_boxes=K,this.pred_masks=_e}}class id extends H{}class hi extends id{}class Fa extends id{async _call(B){return new vr(await super._call(B))}}class vr extends Te{constructor({logits:B,pred_boxes:K}){super(),this.logits=B,this.pred_boxes=K}}class Il extends H{}class Hs extends Il{}class fn extends Il{async _call(B){return new Hn(await super._call(B))}}class Hn extends vr{}class Or extends H{}class Fc extends Or{}class Bo extends Or{async _call(B){return new qi(await super._call(B))}}class qi extends vr{}class Pl extends H{}class kl extends Pl{}class Lo extends Pl{async _call(B){return new vr(await super._call(B))}}class Hf extends H{}class Cr extends Hf{}class od extends Hf{async _call(B){return new ld(await super._call(B))}}class ld extends Ws{}class cd extends H{}class Qf extends cd{}class wm extends cd{async _call(B){return new qt(await super._call(B))}}class zc extends H{}class ud extends zc{}class dd extends zc{async _call(B){return new qt(await super._call(B))}}class da extends H{}class $r extends da{}class Nc extends da{async _call(B){return new qt(await super._call(B))}}class Ki extends H{}class Rc extends Ki{}class fd extends Ki{async _call(B){return new qt(await super._call(B))}}class Qs extends Ki{}class Dl extends H{}class hd extends Dl{}class pd extends Dl{}class md extends H{}class qf extends md{}class Kf extends md{}class Xf extends H{}class Yf extends Xf{}class jc extends H{}class gd extends jc{}class Jf extends jc{}class Mm extends jc{}class Zf extends H{}class eh extends Zf{}class th extends H{}class _d extends th{}class nh extends H{}class rh extends nh{}class vd extends H{}class ah extends vd{}class sh extends vd{}class ih extends H{}class oh extends ih{}class Fo extends ih{}class lh extends H{}class Uc extends lh{}class Ol extends H{}class ch extends Ol{}class yd extends Ol{async _call(B){return new qt(await super._call(B))}}class uh extends H{}class dh extends uh{}class fh extends uh{async _call(B){return new qt(await super._call(B))}}class bd extends H{}class hh extends bd{}class ph extends bd{async _call(B){return new qt(await super._call(B))}}class Vc extends H{}class mh extends Vc{}class gh extends Vc{async _call(B){return new qt(await super._call(B))}}class wd extends H{}class _h extends wd{}class vh extends H{}class xm extends vh{}class Md extends H{}class yh extends Md{}class xd extends H{}class Ed extends xd{}class bh extends xd{async _call(B){return new wh(await super._call(B))}}class wh extends Te{constructor({logits:B,pred_boxes:K}){super(),this.logits=B,this.pred_boxes=K}}class Em extends H{}class Tm extends Em{async get_image_embeddings({pixel_values:B}){return await ne(this,{pixel_values:B})}async forward(B){!B.image_embeddings||!B.image_positional_embeddings?B={...B,...await this.get_image_embeddings(B)}:B={...B},B.input_labels??(B.input_labels=(0,m.ones)(B.input_points.dims.slice(0,-1)));const K={image_embeddings:B.image_embeddings,image_positional_embeddings:B.image_positional_embeddings};return B.input_points&&(K.input_points=B.input_points),B.input_labels&&(K.input_labels=B.input_labels),B.input_boxes&&(K.input_boxes=B.input_boxes),await ee(this.sessions.prompt_encoder_mask_decoder,K)}async _call(B){return new Mh(await super._call(B))}}class Mh extends Te{constructor({iou_scores:B,pred_masks:K}){super(),this.iou_scores=B,this.pred_masks=K}}class $l extends Te{constructor({iou_scores:B,pred_masks:K,object_score_logits:_e}){super(),this.iou_scores=B,this.pred_masks=K,this.object_score_logits=_e}}class Td extends H{}class zo extends Td{async get_image_embeddings({pixel_values:B}){return await ne(this,{pixel_values:B})}async forward(B){const{num_feature_levels:K}=this.config.vision_config;if(Array.from({length:K},(Ve,it)=>`image_embeddings.${it}`).some(Ve=>!B[Ve])?B={...B,...await this.get_image_embeddings(B)}:B={...B},B.input_points){if(B.input_boxes&&B.input_boxes.dims[1]!==1)throw new Error("When both `input_points` and `input_boxes` are provided, the number of boxes per image must be 1.");const Ve=B.input_points.dims;B.input_labels??(B.input_labels=(0,m.ones)(Ve.slice(0,-1))),B.input_boxes??(B.input_boxes=(0,m.full)([Ve[0],0,4],0))}else if(B.input_boxes){const Ve=B.input_boxes.dims;B.input_labels=(0,m.full)([Ve[0],Ve[1],0],-1n),B.input_points=(0,m.full)([Ve[0],1,0,2],0)}else throw new Error("At least one of `input_points` or `input_boxes` must be provided.");const De=this.sessions.prompt_encoder_mask_decoder,Ae=(0,d.pick)(B,De.inputNames);return await ee(De,Ae)}async _call(B){return new $l(await super._call(B))}}class xh extends zo{}class Eh extends zo{}class No extends H{}class Th extends No{}class Ad extends No{}class Cd extends H{}class Sd extends Cd{}class Id extends Cd{}class pi extends H{}class Ah extends pi{}class Xi extends pi{async _call(B){return new Ss(await super._call(B))}}class Ch extends pi{async _call(B){return new qt(await super._call(B))}}class Sh extends pi{async _call(B){return new Ur(await super._call(B))}}class Ih extends H{}class Gc extends Ih{async _call(B){return new Ss(await super._call(B))}}class Pd extends H{}class kd extends Pd{}class Ph extends Pd{async _call(B){return new Ur(await super._call(B))}}class kh extends H{}class Am extends kh{}class Bl extends H{}class Rr extends Bl{}class la extends Bl{async _call(B){return new Ss(await super._call(B))}}class Dh extends Bl{async _call(B){return new qt(await super._call(B))}}class Ll extends H{}class Oh extends Ll{}class $h extends Ll{async _call(B){return new Ss(await super._call(B))}}class Fl extends Ll{async _call(B){return new qt(await super._call(B))}}class Bh extends Ll{async _call(B){return new Ur(await super._call(B))}}class Ro extends H{}class Lh extends Ro{}class Cm extends Ro{async _call(B){return new Ss(await super._call(B))}}class Wc extends Ro{async _call(B){return new qt(await super._call(B))}}class Fh extends H{}class zh extends pi{}class Nh extends pi{async _call(B){return new Ss(await super._call(B))}}class Rh extends pi{async _call(B){return new qt(await super._call(B))}}class Yi extends H{}class Dd extends Yi{}class Od extends Yi{async _call(B){return new Ss(await super._call(B))}}class jh extends Yi{async _call(B){return new qt(await super._call(B))}}class $d extends Yi{async _call(B){return new of(await super._call(B))}}class Hc extends Yi{async _call(B){return new Ur(await super._call(B))}}class Bd extends H{}class Uh extends Bd{}class zl extends H{}class Sm extends zl{}class qs extends zl{}class Ld extends zl{async generate_speech(B,K,{threshold:_e=.5,minlenratio:De=0,maxlenratio:Ae=20,vocoder:Ve=null}={}){const it={input_ids:B},{encoder_outputs:gt,encoder_attention_mask:wt}=await ne(this,it),Dt=gt.dims[1]/this.config.reduction_factor,Ut=Math.floor(Dt*Ae),Wt=Math.floor(Dt*De),hn=this.config.num_mel_bins;let Lt=[],Kt=null,It=null,on=0;for(;;){++on;const sr=ae(!!It);let fr;It?fr=It.output_sequence_out:fr=new m.Tensor("float32",new Float32Array(hn),[1,1,hn]);let er={use_cache_branch:sr,output_sequence:fr,encoder_attention_mask:wt,speaker_embeddings:K,encoder_hidden_states:gt};this.addPastKeyValues(er,Kt),It=await ee(this.sessions.decoder_model_merged,er),Kt=this.getPastKeyValues(It,Kt);const{prob:Zr,spectrum:ln}=It;if(Lt.push(ln),on>=Wt&&(Array.from(Zr.data).filter(Br=>Br>=_e).length>0||on>=Ut))break}const In=(0,m.cat)(Lt),{waveform:qn}=await ee(Ve.sessions.model,{spectrogram:In});return{spectrogram:In,waveform:qn}}}class Im extends H{constructor(){super(...arguments);ge(this,"main_input_name","spectrogram")}}class Vh extends H{}class ws extends Vh{async generate_speech({input_ids:B,attention_mask:K,style:_e,num_inference_steps:De=5,speed:Ae=1.05}){const{sampling_rate:Ve,chunk_compress_factor:it,base_chunk_size:gt,latent_dim:wt}=this.config,{last_hidden_state:Dt,durations:Ut}=await ee(this.sessions.text_encoder,{input_ids:B,attention_mask:K,style:_e});Ut.div_(Ae);const Wt=Ut.max().item()*Ve,hn=gt*it,Lt=Math.floor((Wt+hn-1)/hn),Kt=B.dims[0],It=(0,m.ones)([Kt,Lt]),on=(0,m.full)([Kt],De);let In=(0,m.randn)([Kt,wt*it,Lt]);for(let sr=0;sr<De;++sr){const fr=(0,m.full)([Kt],sr);({denoised_latents:In}=await ee(this.sessions.latent_denoiser,{style:_e,noisy_latents:In,latent_mask:It,encoder_outputs:Dt,attention_mask:K,timestep:fr,num_inference_steps:on}))}const{waveform:qn}=await ee(this.sessions.voice_decoder,{latents:In});return{waveform:qn,durations:Ut}}}class Fd extends H{}class Gh extends Fd{}class Nl extends H{}class Rl extends Nl{}class dr extends Nl{}class Wh extends H{}class Pm extends Wh{}class Hh extends Wh{}class jo extends H{}class mi extends jo{}class Qh extends jo{}class zd extends H{}class jl extends zd{}class Ms extends zd{}class Nd extends H{}class Rd extends Nd{}class qh extends Nd{}class Qc extends H{}class jd extends Qc{}class qc extends Qc{}class Kc extends H{}class Ks extends Kc{}class jr extends Kc{static async from_pretrained(B,K={}){return super.from_pretrained(B,{...K,model_file_name:K.model_file_name??"text_model"})}}class Ud extends Kc{static async from_pretrained(B,K={}){return super.from_pretrained(B,{...K,model_file_name:K.model_file_name??"audio_model"})}}class Kh extends H{}class Yr extends Kh{async _call(B){return new Km(await super._call(B))}}class Vd extends H{}class km extends Vd{}class Xh extends Vd{}class yr extends Vd{}class ya extends H{}class Xs extends ya{}class Yh extends ya{}class Gd extends H{}class Jh extends Gd{}class Dm extends Gd{async _call(B){return new qt(await super._call(B))}}class Ul extends H{}class za extends Ul{}class xs extends Ul{}class Wd extends H{constructor(){super(...arguments);ge(this,"forward_params",["input_ids","attention_mask","encoder_outputs","decoder_input_ids","decoder_attention_mask","past_key_values"])}_apply_and_filter_by_delay_pattern_mask(K){const[_e,De]=K.dims,Ae=this.config.decoder.num_codebooks,Ve=De-Ae;let it=0;for(let Dt=0;Dt<K.size;++Dt){if(K.data[Dt]===this.config.decoder.pad_token_id)continue;const Ut=Dt%De,Wt=Math.floor(Dt/De)%Ae,hn=Ut-Wt;hn>0&&hn<=Ve&&(K.data[it++]=K.data[Dt])}const gt=Math.floor(_e/Ae),wt=it/(gt*Ae);return new m.Tensor(K.type,K.data.slice(0,it),[gt,Ae,wt])}prepare_inputs_for_generation(K,_e,De){let Ae=structuredClone(K);for(let it=0;it<Ae.length;++it)for(let gt=0;gt<Ae[it].length;++gt)it%this.config.decoder.num_codebooks>=gt&&(Ae[it][gt]=BigInt(this.config.decoder.pad_token_id));return De.guidance_scale!==null&&De.guidance_scale>1&&(Ae=Ae.concat(Ae)),super.prepare_inputs_for_generation(Ae,_e,De)}async generate(K){const _e=await super.generate(K),De=this._apply_and_filter_by_delay_pattern_mask(_e).unsqueeze_(0),{audio_values:Ae}=await ee(this.sessions.encodec_decode,{audio_codes:De});return Ae}}class fa extends H{}class Zh extends fa{}class Ys extends fa{async _call(B){return new qt(await super._call(B))}}class Ji extends fa{}class os extends H{}class Hd extends os{}class Qd extends os{async _call(B){return new qt(await super._call(B))}}class ls extends os{}class Xc extends H{}class Uo extends Xc{}class Vl extends Xc{async _call(B){return new qt(await super._call(B))}}class Gl extends Xc{}class gi extends H{}class ep extends gi{}class tp extends gi{async _call(B){return new qt(await super._call(B))}}class Wl extends gi{}class np extends H{}class Yc extends np{}class rp extends H{}class Om extends rp{constructor(...K){super(...K);ge(this,"forward_params",["input_ids","pixel_values","images_seq_mask","images_emb_mask","attention_mask","position_ids","past_key_values"]);this._generation_mode="text"}async forward(K){const _e=this._generation_mode??"text";let De;if(_e==="text"||!K.past_key_values){const wt=this.sessions.prepare_inputs_embeds,Dt=(0,d.pick)(K,wt.inputNames);De=await ee(wt,Dt)}else{const wt=this.sessions.gen_img_embeds,Dt=(0,d.pick)({image_ids:K.input_ids},wt.inputNames);De=await ee(wt,Dt)}const Ae={...K,...De},Ve=await ve(this,Ae),it=this.sessions[_e==="text"?"lm_head":"gen_head"];if(!it)throw new Error(`Unable to find "${it}" generation head`);const gt=await ee(it,(0,d.pick)(Ve,it.inputNames));return{...De,...Ve,...gt}}async generate(K){return this._generation_mode="text",super.generate(K)}async generate_images(K){this._generation_mode="image";const _e=(K.inputs??K[this.main_input_name]).dims[1],Ae=(await super.generate(K)).slice(null,[_e,null]),Ve=this.sessions.image_decode,{decoded_image:it}=await ee(Ve,{generated_tokens:Ae}),gt=it.add_(1).mul_(255/2).clamp_(0,255).to("uint8"),wt=[];for(const Dt of gt){const Ut=y.RawImage.fromTensor(Dt);wt.push(Ut)}return wt}}class $m extends Te{constructor({char_logits:B,bpe_logits:K,wp_logits:_e}){super(),this.char_logits=B,this.bpe_logits=K,this.wp_logits=_e}get logits(){return[this.char_logits,this.bpe_logits,this.wp_logits]}}class $n extends H{}class Zn extends $n{async _call(B){return new $m(await super._call(B))}}class yn extends H{}class xn extends yn{}class Rn extends yn{}class Ta extends H{}class _i extends Ta{}class Vo extends Ta{}class qd extends H{constructor(){super(...arguments);ge(this,"forward_params",["input_ids","attention_mask","position_ids","audio_values","past_key_values"])}}class Es extends qd{_merge_input_ids_with_audio_features(B){const K=B.audio_features.dims.at(-1),_e=B.audio_features.view(-1,K);return U({audio_token_id:this.config.ignore_index??this.config.audio_token_id,...B,audio_features:_e})}}class Sr extends Es{}class Ts extends H{constructor(){super(...arguments);ge(this,"main_input_name","input_values");ge(this,"forward_params",["input_values"])}}class Zi extends Te{constructor({audio_codes:B}){super(),this.audio_codes=B}}class Kd extends Te{constructor({audio_values:B}){super(),this.audio_values=B}}class Na extends Ts{async encode(B){return new Zi(await ee(this.sessions.encoder_model,B))}async decode(B){return new Kd(await ee(this.sessions.decoder_model,B))}}class Go extends Ts{static async from_pretrained(B,K={}){return super.from_pretrained(B,{...K,model_file_name:K.model_file_name??"encoder_model"})}}class Hl extends Ts{static async from_pretrained(B,K={}){return super.from_pretrained(B,{...K,model_file_name:K.model_file_name??"decoder_model"})}}class ha extends H{constructor(){super(...arguments);ge(this,"main_input_name","input_values");ge(this,"forward_params",["input_values"])}}class Xd extends Te{constructor({audio_codes:B}){super(),this.audio_codes=B}}class Jc extends Te{constructor({audio_values:B}){super(),this.audio_values=B}}class ap extends ha{async encode(B){return new Xd(await ee(this.sessions.encoder_model,B))}async decode(B){return new Jc(await ee(this.sessions.decoder_model,B))}}class Zc extends ha{static async from_pretrained(B,K={}){return super.from_pretrained(B,{...K,model_file_name:K.model_file_name??"encoder_model"})}}class eu extends ha{static async from_pretrained(B,K={}){return super.from_pretrained(B,{...K,model_file_name:K.model_file_name??"decoder_model"})}}class As extends H{constructor(){super(...arguments);ge(this,"main_input_name","input_values");ge(this,"forward_params",["input_values"])}}class Jr extends As{async encode(B){return await ee(this.sessions.encoder_model,B)}async decode(B){return await ee(this.sessions.decoder_model,B)}}class vi extends As{static async from_pretrained(B,K={}){return super.from_pretrained(B,{...K,model_file_name:K.model_file_name??"encoder_model"})}}class Wo extends As{static async from_pretrained(B,K={}){return super.from_pretrained(B,{...K,model_file_name:K.model_file_name??"decoder_model"})}}class pn{static async from_pretrained(B,{progress_callback:K=null,config:_e=null,cache_dir:De=null,local_files_only:Ae=!1,revision:Ve="main",model_file_name:it=null,subfolder:gt="onnx",device:wt=null,dtype:Dt=null,use_external_data_format:Ut=null,session_options:Wt={}}={}){const hn={progress_callback:K,config:_e,cache_dir:De,local_files_only:Ae,revision:Ve,model_file_name:it,subfolder:gt,device:wt,dtype:Dt,use_external_data_format:Ut,session_options:Wt};if(hn.config=await s.AutoConfig.from_pretrained(B,hn),!this.MODEL_CLASS_MAPPINGS)throw new Error("`MODEL_CLASS_MAPPINGS` not implemented for this type of `AutoClass`: "+this.name);const Lt=hn.config.model_type;for(const Kt of this.MODEL_CLASS_MAPPINGS){let It=Kt.get(Lt);if(!It){for(const on of Kt.values())if(on[0]===Lt){It=on;break}if(!It)continue}return await It[1].from_pretrained(B,hn)}if(this.BASE_IF_FAIL)return ef.has(Lt)||console.warn(`Unknown model class "${Lt}", attempting to construct from base class.`),await H.from_pretrained(B,hn);throw Error(`Unsupported model type: ${Lt}`)}}ge(pn,"MODEL_CLASS_MAPPINGS",null),ge(pn,"BASE_IF_FAIL",!1);const sp=new Map([["bert",["BertModel",He]],["neobert",["NeoBertModel",_t]],["modernbert",["ModernBertModel",Ze]],["nomic_bert",["NomicBertModel",tn]],["roformer",["RoFormerModel",ds]],["electra",["ElectraModel",an]],["esm",["EsmModel",hs]],["convbert",["ConvBertModel",Pa]],["camembert",["CamembertModel",pe]],["deberta",["DebertaModel",Tt]],["deberta-v2",["DebertaV2Model",Gn]],["mpnet",["MPNetModel",ni]],["albert",["AlbertModel",ht]],["distilbert",["DistilBertModel",Bs]],["roberta",["RobertaModel",rl]],["xlm",["XLMModel",Su]],["xlm-roberta",["XLMRobertaModel",Du]],["clap",["ClapModel",Ks]],["clip",["CLIPModel",fl]],["clipseg",["CLIPSegModel",vo]],["chinese_clip",["ChineseCLIPModel",Bt]],["siglip",["SiglipModel",yc]],["jina_clip",["JinaCLIPModel",bc]],["mobilebert",["MobileBertModel",ua]],["squeezebert",["SqueezeBertModel",se]],["wav2vec2",["Wav2Vec2Model",Ah]],["wav2vec2-bert",["Wav2Vec2BertModel",Lh]],["unispeech",["UniSpeechModel",Rr]],["unispeech-sat",["UniSpeechSatModel",Oh]],["hubert",["HubertModel",zh]],["wavlm",["WavLMModel",Dd]],["audio-spectrogram-transformer",["ASTModel",$u]],["vits",["VitsModel",Yr]],["pyannote",["PyAnnoteModel",kd]],["wespeaker-resnet",["WeSpeakerResNetModel",Am]],["detr",["DetrModel",ad]],["rt_detr",["RTDetrModel",hi]],["rt_detr_v2",["RTDetrV2Model",Hs]],["rf_detr",["RFDetrModel",Fc]],["d_fine",["DFineModel",kl]],["table-transformer",["TableTransformerModel",Cr]],["vit",["ViTModel",Vi]],["ijepa",["IJepaModel",Ff]],["pvt",["PvtModel",zf]],["vit_msn",["ViTMSNModel",Rf]],["vit_mae",["ViTMAEModel",Wi]],["groupvit",["GroupViTModel",Oc]],["fastvit",["FastViTModel",$c]],["mobilevit",["MobileViTModel",td]],["mobilevitv2",["MobileViTV2Model",fi]],["owlvit",["OwlViTModel",rd]],["owlv2",["Owlv2Model",Vf]],["beit",["BeitModel",Lc]],["deit",["DeiTModel",Qf]],["hiera",["HieraModel",ud]],["convnext",["ConvNextModel",ch]],["convnextv2",["ConvNextV2Model",dh]],["dinov2",["Dinov2Model",hh]],["dinov2_with_registers",["Dinov2WithRegistersModel",mh]],["dinov3_vit",["DINOv3ViTModel",_h]],["dinov3_convnext",["DINOv3ConvNextModel",xm]],["resnet",["ResNetModel",$r]],["swin",["SwinModel",Rc]],["swin2sr",["Swin2SRModel",hd]],["donut-swin",["DonutSwinModel",Uc]],["yolos",["YolosModel",Ed]],["dpt",["DPTModel",qf]],["glpn",["GLPNModel",oh]],["hifigan",["SpeechT5HifiGan",Im]],["efficientnet",["EfficientNetModel",Jh]],["decision_transformer",["DecisionTransformerModel",Yc]],["patchtst",["PatchTSTForPrediction",xn]],["patchtsmixer",["PatchTSMixerForPrediction",_i]],["mobilenet_v1",["MobileNetV1Model",Zh]],["mobilenet_v2",["MobileNetV2Model",Hd]],["mobilenet_v3",["MobileNetV3Model",Uo]],["mobilenet_v4",["MobileNetV4Model",ep]],["maskformer",["MaskFormerModel",ah]],["mgp-str",["MgpstrForSceneTextRecognition",Zn]],["style_text_to_speech_2",["StyleTextToSpeech2Model",Uh]]]),ip=new Map([["t5",["T5Model",un]],["longt5",["LongT5Model",Tn]],["mt5",["MT5Model",gr]],["bart",["BartModel",zr]],["mbart",["MBartModel",va]],["marian",["MarianModel",Th]],["whisper",["WhisperModel",hc]],["m2m_100",["M2M100Model",Sd]],["blenderbot",["BlenderbotModel",xr]],["blenderbot-small",["BlenderbotSmallModel",aa]]]),Bm=new Map([["mimi",["MimiModel",Na]],["dac",["DacModel",ap]],["snac",["SnacModel",Jr]]]),tu=new Map([["bloom",["BloomModel",wl]],["jais",["JAISModel",ml]],["gpt2",["GPT2Model",hl]],["gptj",["GPTJModel",zs]],["gpt_bigcode",["GPTBigCodeModel",b]],["gpt_neo",["GPTNeoModel",ss]],["gpt_neox",["GPTNeoXModel",bo]],["codegen",["CodeGenModel",J]],["llama",["LlamaModel",Xe]],["nanochat",["NanoChatModel",_n]],["arcee",["ArceeModel",gs]],["lfm2",["Lfm2Model",Uu]],["smollm3",["SmolLM3Model",Mc]],["exaone",["ExaoneModel",Wu]],["olmo",["OlmoModel",To]],["olmo2",["Olmo2Model",Ja]],["mobilellm",["MobileLLMModel",If]],["granite",["GraniteModel",vs]],["granitemoehybrid",["GraniteMoeHybridModel",Pf]],["cohere",["CohereModel",kf]],["gemma",["GemmaModel",An]],["gemma2",["Gemma2Model",Qu]],["vaultgemma",["VaultGemmaModel",Df]],["gemma3_text",["Gemma3Model",Ku]],["helium",["HeliumModel",Oa]],["glm",["GlmModel",Cf]],["openelm",["OpenELMModel",ji]],["qwen2",["Qwen2Model",Us]],["qwen3",["Qwen3Model",So]],["phi",["PhiModel",Of]],["phi3",["Phi3Model",ym]],["mpt",["MptModel",Io]],["opt",["OPTModel",Lf]],["mistral",["MistralModel",Rl]],["ministral",["MinistralModel",Pm]],["ministral3",["Ministral3Model",mi]],["ernie4_5",["Ernie4_5Model",jl]],["starcoder2",["Starcoder2Model",Rd]],["falcon",["FalconModel",jd]],["stablelm",["StableLmModel",Xs]],["modernbert-decoder",["ModernBertDecoderModel",Jt]]]),nu=new Map([["speecht5",["SpeechT5ForSpeechToText",qs]],["whisper",["WhisperForConditionalGeneration",ai]],["lite-whisper",["LiteWhisperForConditionalGeneration",pc]],["moonshine",["MoonshineForConditionalGeneration",Bu]]]),Ra=new Map([["speecht5",["SpeechT5ForTextToSpeech",Ld]]]),op=new Map([["vits",["VitsModel",Yr]],["musicgen",["MusicgenForConditionalGeneration",Wd]],["supertonic",["SupertonicForConditionalGeneration",ws]]]),Aa=new Map([["bert",["BertForSequenceClassification",Be]],["neobert",["NeoBertForSequenceClassification",pt]],["modernbert",["ModernBertForSequenceClassification",kt]],["roformer",["RoFormerForSequenceClassification",Wa]],["electra",["ElectraForSequenceClassification",L]],["esm",["EsmForSequenceClassification",Ka]],["convbert",["ConvBertForSequenceClassification",ns]],["camembert",["CamembertForSequenceClassification",Ue]],["deberta",["DebertaForSequenceClassification",nn]],["deberta-v2",["DebertaV2ForSequenceClassification",Ir]],["mpnet",["MPNetForSequenceClassification",ps]],["albert",["AlbertForSequenceClassification",bt]],["distilbert",["DistilBertForSequenceClassification",na]],["roberta",["RobertaForSequenceClassification",ri]],["xlm",["XLMForSequenceClassification",sl]],["xlm-roberta",["XLMRobertaForSequenceClassification",uc]],["bart",["BartForSequenceClassification",_r]],["mbart",["MBartForSequenceClassification",Xr]],["mobilebert",["MobileBertForSequenceClassification",ut]],["squeezebert",["SqueezeBertForSequenceClassification",be]]]),lp=new Map([["bert",["BertForTokenClassification",nt]],["neobert",["NeoBertForTokenClassification",dt]],["modernbert",["ModernBertForTokenClassification",Nt]],["roformer",["RoFormerForTokenClassification",Vn]],["electra",["ElectraForTokenClassification",ue]],["esm",["EsmForTokenClassification",ra]],["convbert",["ConvBertForTokenClassification",Ha]],["camembert",["CamembertForTokenClassification",Ye]],["deberta",["DebertaForTokenClassification",xt]],["deberta-v2",["DebertaV2ForTokenClassification",_a]],["mpnet",["MPNetForTokenClassification",Pi]],["distilbert",["DistilBertForTokenClassification",Pr]],["roberta",["RobertaForTokenClassification",lo]],["xlm",["XLMForTokenClassification",Pu]],["xlm-roberta",["XLMRobertaForTokenClassification",dc]]]),Yd=new Map([["t5",["T5ForConditionalGeneration",vn]],["longt5",["LongT5ForConditionalGeneration",lr]],["mt5",["MT5ForConditionalGeneration",Dr]],["bart",["BartForConditionalGeneration",Wn]],["mbart",["MBartForConditionalGeneration",ka]],["marian",["MarianMTModel",Ad]],["m2m_100",["M2M100ForConditionalGeneration",Id]],["blenderbot",["BlenderbotForConditionalGeneration",Sn]],["blenderbot-small",["BlenderbotSmallForConditionalGeneration",Xa]]]),cp=new Map([["bloom",["BloomForCausalLM",Ml]],["gpt2",["GPT2LMHeadModel",pl]],["jais",["JAISLMHeadModel",yo]],["gptj",["GPTJForCausalLM",wo]],["gpt_bigcode",["GPTBigCodeForCausalLM",$]],["gpt_neo",["GPTNeoForCausalLM",zi]],["gpt_neox",["GPTNeoXForCausalLM",_l]],["codegen",["CodeGenForCausalLM",ie]],["llama",["LlamaForCausalLM",ot]],["nanochat",["NanoChatForCausalLM",dn]],["llama4_text",["Llama4ForCausalLM",St]],["arcee",["ArceeForCausalLM",xo]],["lfm2",["Lfm2ForCausalLM",Ni]],["smollm3",["SmolLM3ForCausalLM",Eo]],["exaone",["ExaoneForCausalLM",Sf]],["olmo",["OlmoForCausalLM",Tc]],["olmo2",["Olmo2ForCausalLM",Za]],["mobilellm",["MobileLLMForCausalLM",Ya]],["granite",["GraniteForCausalLM",ys]],["granitemoehybrid",["GraniteMoeHybridForCausalLM",Hu]],["cohere",["CohereForCausalLM",ia]],["gemma",["GemmaForCausalLM",ci]],["gemma2",["Gemma2ForCausalLM",ui]],["vaultgemma",["VaultGemmaForCausalLM",Co]],["gemma3_text",["Gemma3ForCausalLM",yl]],["helium",["HeliumForCausalLM",Gu]],["glm",["GlmForCausalLM",xc]],["openelm",["OpenELMForCausalLM",Rs]],["qwen2",["Qwen2ForCausalLM",Xu]],["qwen3",["Qwen3ForCausalLM",Ic]],["phi",["PhiForCausalLM",vm]],["phi3",["Phi3ForCausalLM",Nr]],["mpt",["MptForCausalLM",Po]],["opt",["OPTForCausalLM",bm]],["mbart",["MBartForCausalLM",Ea]],["mistral",["MistralForCausalLM",dr]],["ministral",["MinistralForCausalLM",Hh]],["ministral3",["Ministral3ForCausalLM",Qh]],["ernie4_5",["Ernie4_5ForCausalLM",Ms]],["starcoder2",["Starcoder2ForCausalLM",qh]],["falcon",["FalconForCausalLM",qc]],["trocr",["TrOCRForCausalLM",Gh]],["stablelm",["StableLmForCausalLM",Yh]],["modernbert-decoder",["ModernBertDecoderForCausalLM",Cn]],["phi3_v",["Phi3VForCausalLM",fo]]]),eo=new Map([["multi_modality",["MultiModalityCausalLM",Om]]]),ru=new Map([["bert",["BertForMaskedLM",Ke]],["neobert",["NeoBertForMaskedLM",Je]],["modernbert",["ModernBertForMaskedLM",rt]],["roformer",["RoFormerForMaskedLM",fs]],["electra",["ElectraForMaskedLM",Qa]],["esm",["EsmForMaskedLM",qa]],["convbert",["ConvBertForMaskedLM",Ft]],["camembert",["CamembertForMaskedLM",Ce]],["deberta",["DebertaForMaskedLM",Et]],["deberta-v2",["DebertaV2ForMaskedLM",or]],["mpnet",["MPNetForMaskedLM",Fr]],["albert",["AlbertForMaskedLM",Ct]],["distilbert",["DistilBertForMaskedLM",mr]],["roberta",["RobertaForMaskedLM",al]],["xlm",["XLMWithLMHeadModel",Iu]],["xlm-roberta",["XLMRobertaForMaskedLM",Ou]],["mobilebert",["MobileBertForMaskedLM",lt]],["squeezebert",["SqueezeBertForMaskedLM",me]]]),Jd=new Map([["bert",["BertForQuestionAnswering",$e]],["neobert",["NeoBertForQuestionAnswering",Gt]],["roformer",["RoFormerForQuestionAnswering",Er]],["electra",["ElectraForQuestionAnswering",Y]],["convbert",["ConvBertForQuestionAnswering",Dn]],["camembert",["CamembertForQuestionAnswering",ct]],["deberta",["DebertaForQuestionAnswering",Zt]],["deberta-v2",["DebertaV2ForQuestionAnswering",nr]],["mpnet",["MPNetForQuestionAnswering",Ie]],["albert",["AlbertForQuestionAnswering",yt]],["distilbert",["DistilBertForQuestionAnswering",xa]],["roberta",["RobertaForQuestionAnswering",cc]],["xlm",["XLMForQuestionAnswering",ku]],["xlm-roberta",["XLMRobertaForQuestionAnswering",fc]],["mobilebert",["MobileBertForQuestionAnswering",At]],["squeezebert",["SqueezeBertForQuestionAnswering",Se]]]),to=new Map([["vision-encoder-decoder",["VisionEncoderDecoderModel",mc]],["idefics3",["Idefics3ForConditionalGeneration",rs]],["smolvlm",["SmolVLMForConditionalGeneration",vc]]]),up=new Map([["llava",["LlavaForConditionalGeneration",uo]],["llava_onevision",["LlavaOnevisionForConditionalGeneration",Lu]],["moondream1",["Moondream1ForConditionalGeneration",Fu]],["florence2",["Florence2ForConditionalGeneration",ul]],["qwen2-vl",["Qwen2VLForConditionalGeneration",oa]],["idefics3",["Idefics3ForConditionalGeneration",rs]],["smolvlm",["SmolVLMForConditionalGeneration",vc]],["paligemma",["PaliGemmaForConditionalGeneration",Nu]],["llava_qwen2",["LlavaQwen2ForCausalLM",dl]],["gemma3n",["Gemma3nForConditionalGeneration",si]],["mistral3",["Mistral3ForConditionalGeneration",gc]]]),dp=new Map([["ultravox",["UltravoxModel",Es]],["voxtral",["VoxtralForConditionalGeneration",Sr]]]),Lm=new Map([["vision-encoder-decoder",["VisionEncoderDecoderModel",mc]]]),fp=new Map([["vit",["ViTForImageClassification",Ju]],["ijepa",["IJepaForImageClassification",ko]],["pvt",["PvtForImageClassification",Nf]],["vit_msn",["ViTMSNForImageClassification",Do]],["fastvit",["FastViTForImageClassification",jf]],["mobilevit",["MobileViTForImageClassification",nd]],["mobilevitv2",["MobileViTV2ForImageClassification",Al]],["beit",["BeitForImageClassification",Wf]],["deit",["DeiTForImageClassification",wm]],["hiera",["HieraForImageClassification",dd]],["convnext",["ConvNextForImageClassification",yd]],["convnextv2",["ConvNextV2ForImageClassification",fh]],["dinov2",["Dinov2ForImageClassification",ph]],["dinov2_with_registers",["Dinov2WithRegistersForImageClassification",gh]],["resnet",["ResNetForImageClassification",Nc]],["swin",["SwinForImageClassification",fd]],["segformer",["SegformerForImageClassification",Xh]],["efficientnet",["EfficientNetForImageClassification",Dm]],["mobilenet_v1",["MobileNetV1ForImageClassification",Ys]],["mobilenet_v2",["MobileNetV2ForImageClassification",Qd]],["mobilenet_v3",["MobileNetV3ForImageClassification",Vl]],["mobilenet_v4",["MobileNetV4ForImageClassification",tp]]]),au=new Map([["detr",["DetrForObjectDetection",Ba]],["rt_detr",["RTDetrForObjectDetection",Fa]],["rt_detr_v2",["RTDetrV2ForObjectDetection",fn]],["rf_detr",["RFDetrForObjectDetection",Bo]],["d_fine",["DFineForObjectDetection",Lo]],["table-transformer",["TableTransformerForObjectDetection",od]],["yolos",["YolosForObjectDetection",bh]]]),Zd=new Map([["owlvit",["OwlViTForObjectDetection",Cl]],["owlv2",["Owlv2ForObjectDetection",Gf]],["grounding-dino",["GroundingDinoForObjectDetection",yh]]]),Ql=new Map([["detr",["DetrForSegmentation",La]],["clipseg",["CLIPSegForImageSegmentation",sa]]]),Fm=new Map([["segformer",["SegformerForSemanticSegmentation",yr]],["sapiens",["SapiensForSemanticSegmentation",gd]],["swin",["SwinForSemanticSegmentation",Qs]],["mobilenet_v1",["MobileNetV1ForSemanticSegmentation",Ji]],["mobilenet_v2",["MobileNetV2ForSemanticSegmentation",ls]],["mobilenet_v3",["MobileNetV3ForSemanticSegmentation",Gl]],["mobilenet_v4",["MobileNetV4ForSemanticSegmentation",Wl]]]),zm=new Map([["detr",["DetrForSegmentation",La]],["maskformer",["MaskFormerForInstanceSegmentation",sh]]]),hp=new Map([["sam",["SamModel",Tm]],["sam2",["Sam2Model",zo]],["edgetam",["EdgeTamModel",xh]],["sam3_tracker",["Sam3TrackerModel",Eh]]]),pp=new Map([["wav2vec2",["Wav2Vec2ForCTC",Xi]],["wav2vec2-bert",["Wav2Vec2BertForCTC",Cm]],["unispeech",["UniSpeechForCTC",la]],["unispeech-sat",["UniSpeechSatForCTC",$h]],["wavlm",["WavLMForCTC",Od]],["hubert",["HubertForCTC",Nh]],["parakeet_ctc",["ParakeetForCTC",Gc]]]),Ho=new Map([["wav2vec2",["Wav2Vec2ForSequenceClassification",Ch]],["wav2vec2-bert",["Wav2Vec2BertForSequenceClassification",Wc]],["unispeech",["UniSpeechForSequenceClassification",Dh]],["unispeech-sat",["UniSpeechSatForSequenceClassification",Fl]],["wavlm",["WavLMForSequenceClassification",jh]],["hubert",["HubertForSequenceClassification",Rh]],["audio-spectrogram-transformer",["ASTForAudioClassification",ol]]]),su=new Map([["wavlm",["WavLMForXVector",$d]]]),mp=new Map([["unispeech-sat",["UniSpeechSatForAudioFrameClassification",Bh]],["wavlm",["WavLMForAudioFrameClassification",Hc]],["wav2vec2",["Wav2Vec2ForAudioFrameClassification",Sh]],["pyannote",["PyAnnoteForAudioFrameClassification",Ph]]]),gp=new Map([["vitmatte",["VitMatteForImageMatting",Uf]]]),Nm=new Map([["patchtst",["PatchTSTForPrediction",Rn]],["patchtsmixer",["PatchTSMixerForPrediction",Vo]]]),_p=new Map([["swin2sr",["Swin2SRForImageSuperResolution",pd]]]),vp=new Map([["dpt",["DPTForDepthEstimation",Kf]],["depth_anything",["DepthAnythingForDepthEstimation",Yf]],["glpn",["GLPNForDepthEstimation",Fo]],["sapiens",["SapiensForDepthEstimation",Jf]],["depth_pro",["DepthProForDepthEstimation",eh]],["metric3d",["Metric3DForDepthEstimation",_d]],["metric3dv2",["Metric3Dv2ForDepthEstimation",rh]]]),yp=new Map([["sapiens",["SapiensForNormalEstimation",Mm]]]),iu=new Map([["vitpose",["VitPoseForPoseEstimation",Dc]]]),bp=new Map([["clip",["CLIPVisionModelWithProjection",Bi]],["siglip",["SiglipVisionModel",mo]],["jina_clip",["JinaCLIPVisionModel",_o]]]),wp=[[sp,I.EncoderOnly],[ip,I.EncoderDecoder],[tu,I.DecoderOnly],[Bm,I.AutoEncoder],[Aa,I.EncoderOnly],[lp,I.EncoderOnly],[Yd,I.Seq2Seq],[nu,I.Seq2Seq],[cp,I.DecoderOnly],[eo,I.MultiModality],[ru,I.EncoderOnly],[Jd,I.EncoderOnly],[to,I.Vision2Seq],[up,I.ImageTextToText],[dp,I.AudioTextToText],[fp,I.EncoderOnly],[Ql,I.EncoderOnly],[zm,I.EncoderOnly],[Fm,I.EncoderOnly],[gp,I.EncoderOnly],[Nm,I.EncoderOnly],[_p,I.EncoderOnly],[vp,I.EncoderOnly],[yp,I.EncoderOnly],[iu,I.EncoderOnly],[au,I.EncoderOnly],[Zd,I.EncoderOnly],[hp,I.MaskGeneration],[pp,I.EncoderOnly],[Ho,I.EncoderOnly],[Ra,I.Seq2Seq],[op,I.EncoderOnly],[su,I.EncoderOnly],[mp,I.EncoderOnly],[bp,I.EncoderOnly]];for(const[P,B]of wp)for(const[K,_e]of P.values())M.set(K,B),A.set(_e,K),C.set(K,_e);const Qn=[["MusicgenForConditionalGeneration",Wd,I.Musicgen],["Phi3VForCausalLM",fo,I.Phi3V],["CLIPTextModelWithProjection",oi,I.EncoderOnly],["SiglipTextModel",po,I.EncoderOnly],["JinaCLIPTextModel",wc,I.EncoderOnly],["ClapTextModelWithProjection",jr,I.EncoderOnly],["ClapAudioModelWithProjection",Ud,I.EncoderOnly],["DacEncoderModel",Zc,I.EncoderOnly],["DacDecoderModel",eu,I.EncoderOnly],["MimiEncoderModel",Go,I.EncoderOnly],["MimiDecoderModel",Hl,I.EncoderOnly],["SnacEncoderModel",vi,I.EncoderOnly],["SnacDecoderModel",Wo,I.EncoderOnly],["Gemma3nForConditionalGeneration",si,I.ImageAudioTextToText],["SupertonicForConditionalGeneration",ws,I.Supertonic]];for(const[P,B,K]of Qn)M.set(P,K),A.set(B,P),C.set(P,B);const ef=new Map([["modnet",Ql],["birefnet",Ql],["isnet",Ql],["ben",Ql]]);for(const[P,B]of ef.entries())B.set(P,["PreTrainedModel",H]),M.set(P,I.EncoderOnly),A.set(H,P),C.set(P,H);class Mp extends pn{}ge(Mp,"MODEL_CLASS_MAPPINGS",wp.map(B=>B[0])),ge(Mp,"BASE_IF_FAIL",!0);class xp extends pn{}ge(xp,"MODEL_CLASS_MAPPINGS",[Aa]);class Rm extends pn{}ge(Rm,"MODEL_CLASS_MAPPINGS",[lp]);class jm extends pn{}ge(jm,"MODEL_CLASS_MAPPINGS",[Yd]);class Um extends pn{}ge(Um,"MODEL_CLASS_MAPPINGS",[nu]);class ou extends pn{}ge(ou,"MODEL_CLASS_MAPPINGS",[Ra]);class Qo extends pn{}ge(Qo,"MODEL_CLASS_MAPPINGS",[op]);class tf extends pn{}ge(tf,"MODEL_CLASS_MAPPINGS",[cp]);class lu extends pn{}ge(lu,"MODEL_CLASS_MAPPINGS",[ru]);class nf extends pn{}ge(nf,"MODEL_CLASS_MAPPINGS",[Jd]);class yi extends pn{}ge(yi,"MODEL_CLASS_MAPPINGS",[to]);class Cs extends pn{}ge(Cs,"MODEL_CLASS_MAPPINGS",[fp]);class ql extends pn{}ge(ql,"MODEL_CLASS_MAPPINGS",[Ql]);class Vm extends pn{}ge(Vm,"MODEL_CLASS_MAPPINGS",[Fm]);class Ep extends pn{}ge(Ep,"MODEL_CLASS_MAPPINGS",[zm]);class Tp extends pn{}ge(Tp,"MODEL_CLASS_MAPPINGS",[au]);class Ap extends pn{}ge(Ap,"MODEL_CLASS_MAPPINGS",[Zd]);class Cp extends pn{}ge(Cp,"MODEL_CLASS_MAPPINGS",[hp]);class Gm extends pn{}ge(Gm,"MODEL_CLASS_MAPPINGS",[pp]);class rf extends pn{}ge(rf,"MODEL_CLASS_MAPPINGS",[Ho]);class Sp extends pn{}ge(Sp,"MODEL_CLASS_MAPPINGS",[su]);class Ip extends pn{}ge(Ip,"MODEL_CLASS_MAPPINGS",[mp]);class Wm extends pn{}ge(Wm,"MODEL_CLASS_MAPPINGS",[Lm]);class af extends pn{}ge(af,"MODEL_CLASS_MAPPINGS",[gp]);class sf extends pn{}ge(sf,"MODEL_CLASS_MAPPINGS",[_p]);class Hm extends pn{}ge(Hm,"MODEL_CLASS_MAPPINGS",[vp]);class Qm extends pn{}ge(Qm,"MODEL_CLASS_MAPPINGS",[yp]);class Kl extends pn{}ge(Kl,"MODEL_CLASS_MAPPINGS",[iu]);class qm extends pn{}ge(qm,"MODEL_CLASS_MAPPINGS",[bp]);class Pp extends pn{}ge(Pp,"MODEL_CLASS_MAPPINGS",[up]);class Mn extends pn{}ge(Mn,"MODEL_CLASS_MAPPINGS",[dp]);class kp extends Te{constructor({logits:B,past_key_values:K,encoder_outputs:_e,decoder_attentions:De=null,cross_attentions:Ae=null}){super(),this.logits=B,this.past_key_values=K,this.encoder_outputs=_e,this.decoder_attentions=De,this.cross_attentions=Ae}}class qt extends Te{constructor({logits:B,...K}){super(),this.logits=B;const _e=Object.values(K);_e.length>0&&(this.attentions=_e)}}class of extends Te{constructor({logits:B,embeddings:K}){super(),this.logits=B,this.embeddings=K}}class Ur extends Te{constructor({logits:B}){super(),this.logits=B}}class Vr extends Te{constructor({logits:B}){super(),this.logits=B}}class Gr extends Te{constructor({start_logits:B,end_logits:K}){super(),this.start_logits=B,this.end_logits=K}}class Ss extends Te{constructor({logits:B}){super(),this.logits=B}}class h_ extends Te{constructor({logits:B,past_key_values:K}){super(),this.logits=B,this.past_key_values=K}}class Dp extends Te{constructor({alphas:B}){super(),this.alphas=B}}class Km extends Te{constructor({waveform:B,spectrogram:K}){super(),this.waveform=B,this.spectrogram=K}}}),"./src/models/audio_spectrogram_transformer/feature_extraction_audio_spectrogram_transformer.js":((e,t,n)=>{n.r(t),n.d(t,{ASTFeatureExtractor:()=>o});var s=n("./src/base/feature_extraction_utils.js");n("./src/utils/tensor.js");var i=n("./src/utils/audio.js");class o extends s.FeatureExtractor{constructor(d){super(d);const u=this.config.sampling_rate,h=(0,i.mel_filter_bank)(257,this.config.num_mel_bins,20,Math.floor(u/2),u,null,"kaldi",!0);this.mel_filters=h,this.window=(0,i.window_function)(400,"hann",{periodic:!1}),this.mean=this.config.mean,this.std=this.config.std}async _extract_fbank_features(d,u){return(0,i.spectrogram)(d,this.window,400,160,{fft_length:512,power:2,center:!1,preemphasis:.97,mel_filters:this.mel_filters,log_mel:"log",mel_floor:1192092955078125e-22,remove_dc_offset:!0,max_num_frames:u,transpose:!0})}async _call(d){(0,s.validate_audio_inputs)(d,"ASTFeatureExtractor");const u=await this._extract_fbank_features(d,this.config.max_length);if(this.config.do_normalize){const h=this.std*2,g=u.data;for(let p=0;p<g.length;++p)g[p]=(g[p]-this.mean)/h}return{input_values:u.unsqueeze_(0)}}}}),"./src/models/auto/feature_extraction_auto.js":((e,t,n)=>{n.r(t),n.d(t,{AutoFeatureExtractor:()=>c});var s=n("./src/utils/constants.js"),i=n("./src/utils/hub.js");n("./src/base/feature_extraction_utils.js");var o=n("./src/models/feature_extractors.js");class c{static async from_pretrained(u,h={}){const g=await(0,i.getModelJSON)(u,s.FEATURE_EXTRACTOR_NAME,!0,h),p=g.feature_extractor_type,m=o[p];if(!m)throw new Error(`Unknown feature_extractor_type: '${p}'. Please report this at ${s.GITHUB_ISSUE_URL}.`);return new m(g)}}}),"./src/models/auto/image_processing_auto.js":((e,t,n)=>{n.r(t),n.d(t,{AutoImageProcessor:()=>d});var s=n("./src/utils/constants.js"),i=n("./src/utils/hub.js"),o=n("./src/base/image_processors_utils.js"),c=n("./src/models/image_processors.js");class d{static async from_pretrained(h,g={}){const p=await(0,i.getModelJSON)(h,s.IMAGE_PROCESSOR_NAME,!0,g),m=p.image_processor_type??p.feature_extractor_type;let y=c[m==null?void 0:m.replace(/Fast$/,"")];return y||(m!==void 0&&console.warn(`Image processor type '${m}' not found, assuming base ImageProcessor. Please report this at ${s.GITHUB_ISSUE_URL}.`),y=o.ImageProcessor),new y(p)}}}),"./src/models/auto/processing_auto.js":((e,t,n)=>{n.r(t),n.d(t,{AutoProcessor:()=>h});var s=n("./src/utils/constants.js"),i=n("./src/utils/hub.js"),o=n("./src/base/processing_utils.js"),c=n("./src/models/processors.js"),d=n("./src/models/image_processors.js"),u=n("./src/models/feature_extractors.js");class h{static async from_pretrained(p,m={}){const y=await(0,i.getModelJSON)(p,s.IMAGE_PROCESSOR_NAME,!0,m),{image_processor_type:v,feature_extractor_type:T,processor_class:O}=y;if(O&&c[O])return c[O].from_pretrained(p,m);if(!v&&!T)throw new Error("No `image_processor_type` or `feature_extractor_type` found in the config.");const E={};if(v){const D=d[v.replace(/Fast$/,"")];if(!D)throw new Error(`Unknown image_processor_type: '${v}'.`);E.image_processor=new D(y)}if(T){const D=d[T];if(D)E.image_processor=new D(y);else{const I=u[T];if(!I)throw new Error(`Unknown feature_extractor_type: '${T}'.`);E.feature_extractor=new I(y)}}const S={};return new o.Processor(S,E,null)}}}),"./src/models/beit/image_processing_beit.js":((e,t,n)=>{n.r(t),n.d(t,{BeitFeatureExtractor:()=>i});var s=n("./src/base/image_processors_utils.js");class i extends s.ImageProcessor{}}),"./src/models/bit/image_processing_bit.js":((e,t,n)=>{n.r(t),n.d(t,{BitImageProcessor:()=>i});var s=n("./src/base/image_processors_utils.js");class i extends s.ImageProcessor{}}),"./src/models/chinese_clip/image_processing_chinese_clip.js":((e,t,n)=>{n.r(t),n.d(t,{ChineseCLIPFeatureExtractor:()=>i});var s=n("./src/base/image_processors_utils.js");class i extends s.ImageProcessor{}}),"./src/models/clap/feature_extraction_clap.js":((e,t,n)=>{n.r(t),n.d(t,{ClapFeatureExtractor:()=>o});var s=n("./src/base/feature_extraction_utils.js");n("./src/utils/tensor.js");var i=n("./src/utils/audio.js");class o extends s.FeatureExtractor{constructor(d){super(d),this.mel_filters=(0,i.mel_filter_bank)(this.config.nb_frequency_bins,this.config.feature_size,this.config.frequency_min,this.config.frequency_max,this.config.sampling_rate,null,"htk"),this.mel_filters_slaney=(0,i.mel_filter_bank)(this.config.nb_frequency_bins,this.config.feature_size,this.config.frequency_min,this.config.frequency_max,this.config.sampling_rate,"slaney","slaney"),this.window=(0,i.window_function)(this.config.fft_window_size,"hann")}async _get_input_mel(d,u,h,g){let p;const m=d.length-u;if(m>0)if(h==="rand_trunc"){const y=Math.floor(Math.random()*(m+1));d=d.subarray(y,y+u),p=await this._extract_fbank_features(d,this.mel_filters_slaney,this.config.nb_max_samples)}else throw new Error(`Truncation strategy "${h}" not implemented`);else{if(m<0){let y=new Float64Array(u);if(y.set(d),g==="repeat")for(let v=d.length;v<u;v+=d.length)y.set(d.subarray(0,Math.min(d.length,u-v)),v);else if(g==="repeatpad")for(let v=d.length;v<-m;v+=d.length)y.set(d,v);d=y}if(h==="fusion")throw new Error(`Truncation strategy "${h}" not implemented`);p=await this._extract_fbank_features(d,this.mel_filters_slaney,this.config.nb_max_samples)}return p.unsqueeze_(0)}async _extract_fbank_features(d,u,h=null){return(0,i.spectrogram)(d,this.window,this.config.fft_window_size,this.config.hop_length,{power:2,mel_filters:u,log_mel:"dB",max_num_frames:h,do_pad:!1,transpose:!0})}async _call(d,{max_length:u=null}={}){return(0,s.validate_audio_inputs)(d,"ClapFeatureExtractor"),{input_features:(await this._get_input_mel(d,u??this.config.nb_max_samples,this.config.truncation,this.config.padding)).unsqueeze_(0)}}}}),"./src/models/clip/image_processing_clip.js":((e,t,n)=>{n.r(t),n.d(t,{CLIPFeatureExtractor:()=>o,CLIPImageProcessor:()=>i});var s=n("./src/base/image_processors_utils.js");class i extends s.ImageProcessor{}class o extends i{}}),"./src/models/convnext/image_processing_convnext.js":((e,t,n)=>{n.r(t),n.d(t,{ConvNextFeatureExtractor:()=>o,ConvNextImageProcessor:()=>i});var s=n("./src/base/image_processors_utils.js");class i extends s.ImageProcessor{constructor(d){super(d),this.crop_pct=this.config.crop_pct??224/256}async resize(d){var h;const u=(h=this.size)==null?void 0:h.shortest_edge;if(u===void 0)throw new Error("Size dictionary must contain 'shortest_edge' key.");if(u<384){const g=Math.floor(u/this.crop_pct),[p,m]=this.get_resize_output_image_size(d,{shortest_edge:g});d=await d.resize(p,m,{resample:this.resample}),d=await d.center_crop(u,u)}else d=await d.resize(u,u,{resample:this.resample});return d}}class o extends i{}}),"./src/models/dac/feature_extraction_dac.js":((e,t,n)=>{n.r(t),n.d(t,{DacFeatureExtractor:()=>i});var s=n("./src/models/encodec/feature_extraction_encodec.js");class i extends s.EncodecFeatureExtractor{}}),"./src/models/deit/image_processing_deit.js":((e,t,n)=>{n.r(t),n.d(t,{DeiTFeatureExtractor:()=>o,DeiTImageProcessor:()=>i});var s=n("./src/base/image_processors_utils.js");class i extends s.ImageProcessor{}class o extends i{}}),"./src/models/detr/image_processing_detr.js":((e,t,n)=>{n.r(t),n.d(t,{DetrFeatureExtractor:()=>c,DetrImageProcessor:()=>o});var s=n("./src/base/image_processors_utils.js"),i=n("./src/utils/tensor.js");class o extends s.ImageProcessor{async _call(u){const h=await super._call(u),g=[h.pixel_values.dims[0],64,64],p=(0,i.full)(g,1n);return{...h,pixel_mask:p}}post_process_object_detection(...u){return(0,s.post_process_object_detection)(...u)}post_process_panoptic_segmentation(...u){return(0,s.post_process_panoptic_segmentation)(...u)}post_process_instance_segmentation(...u){return(0,s.post_process_instance_segmentation)(...u)}}class c extends o{}}),"./src/models/dinov3_vit/image_processing_dinov3_vit.js":((e,t,n)=>{n.r(t),n.d(t,{DINOv3ViTImageProcessor:()=>i});var s=n("./src/base/image_processors_utils.js");class i extends s.ImageProcessor{}}),"./src/models/donut/image_processing_donut.js":((e,t,n)=>{n.r(t),n.d(t,{DonutFeatureExtractor:()=>o,DonutImageProcessor:()=>i});var s=n("./src/base/image_processors_utils.js");class i extends s.ImageProcessor{pad_image(d,u,h,g={}){const[p,m,y]=u;let v=this.image_mean;Array.isArray(this.image_mean)||(v=new Array(y).fill(v));let T=this.image_std;Array.isArray(T)||(T=new Array(y).fill(v));const O=v.map((E,S)=>-E/T[S]);return super.pad_image(d,u,h,{center:!0,constant_values:O,...g})}}class o extends i{}}),"./src/models/dpt/image_processing_dpt.js":((e,t,n)=>{n.r(t),n.d(t,{DPTFeatureExtractor:()=>o,DPTImageProcessor:()=>i});var s=n("./src/base/image_processors_utils.js");class i extends s.ImageProcessor{}class o extends i{}}),"./src/models/efficientnet/image_processing_efficientnet.js":((e,t,n)=>{n.r(t),n.d(t,{EfficientNetImageProcessor:()=>i});var s=n("./src/base/image_processors_utils.js");class i extends s.ImageProcessor{constructor(c){super(c),this.include_top=this.config.include_top??!0,this.include_top&&(this.image_std=this.image_std.map(d=>d*d))}}}),"./src/models/encodec/feature_extraction_encodec.js":((e,t,n)=>{n.r(t),n.d(t,{EncodecFeatureExtractor:()=>o});var s=n("./src/base/feature_extraction_utils.js"),i=n("./src/utils/tensor.js");class o extends s.FeatureExtractor{async _call(d){(0,s.validate_audio_inputs)(d,"EncodecFeatureExtractor"),d instanceof Float64Array&&(d=new Float32Array(d));const u=this.config.feature_size;if(d.length%u!==0)throw new Error(`The length of the audio data must be a multiple of the number of channels (${u}).`);const h=[1,u,d.length/u];return{input_values:new i.Tensor("float32",d,h)}}}}),"./src/models/feature_extractors.js":((e,t,n)=>{n.r(t),n.d(t,{ASTFeatureExtractor:()=>s.ASTFeatureExtractor,ClapFeatureExtractor:()=>o.ClapFeatureExtractor,DacFeatureExtractor:()=>c.DacFeatureExtractor,EncodecFeatureExtractor:()=>i.EncodecFeatureExtractor,Gemma3nAudioFeatureExtractor:()=>d.Gemma3nAudioFeatureExtractor,ImageFeatureExtractor:()=>E.ImageProcessor,MoonshineFeatureExtractor:()=>u.MoonshineFeatureExtractor,ParakeetFeatureExtractor:()=>h.ParakeetFeatureExtractor,PyAnnoteFeatureExtractor:()=>g.PyAnnoteFeatureExtractor,SeamlessM4TFeatureExtractor:()=>p.SeamlessM4TFeatureExtractor,SnacFeatureExtractor:()=>m.SnacFeatureExtractor,SpeechT5FeatureExtractor:()=>y.SpeechT5FeatureExtractor,Wav2Vec2FeatureExtractor:()=>v.Wav2Vec2FeatureExtractor,WeSpeakerFeatureExtractor:()=>T.WeSpeakerFeatureExtractor,WhisperFeatureExtractor:()=>O.WhisperFeatureExtractor});var s=n("./src/models/audio_spectrogram_transformer/feature_extraction_audio_spectrogram_transformer.js"),i=n("./src/models/encodec/feature_extraction_encodec.js"),o=n("./src/models/clap/feature_extraction_clap.js"),c=n("./src/models/dac/feature_extraction_dac.js"),d=n("./src/models/gemma3n/feature_extraction_gemma3n.js"),u=n("./src/models/moonshine/feature_extraction_moonshine.js"),h=n("./src/models/parakeet/feature_extraction_parakeet.js"),g=n("./src/models/pyannote/feature_extraction_pyannote.js"),p=n("./src/models/seamless_m4t/feature_extraction_seamless_m4t.js"),m=n("./src/models/snac/feature_extraction_snac.js"),y=n("./src/models/speecht5/feature_extraction_speecht5.js"),v=n("./src/models/wav2vec2/feature_extraction_wav2vec2.js"),T=n("./src/models/wespeaker/feature_extraction_wespeaker.js"),O=n("./src/models/whisper/feature_extraction_whisper.js"),E=n("./src/base/image_processors_utils.js")}),"./src/models/florence2/processing_florence2.js":((e,t,n)=>{n.r(t),n.d(t,{Florence2Processor:()=>c});var s=n("./src/base/processing_utils.js"),i=n("./src/models/auto/image_processing_auto.js"),o=n("./src/tokenizers.js");class c extends s.Processor{constructor(u,h,g){super(u,h,g);const{tasks_answer_post_processing_type:p,task_prompts_without_inputs:m,task_prompts_with_input:y}=this.image_processor.config;this.tasks_answer_post_processing_type=new Map(Object.entries(p??{})),this.task_prompts_without_inputs=new Map(Object.entries(m??{})),this.task_prompts_with_input=new Map(Object.entries(y??{})),this.regexes={quad_boxes:/(.+?)<loc_(\d+)><loc_(\d+)><loc_(\d+)><loc_(\d+)><loc_(\d+)><loc_(\d+)><loc_(\d+)><loc_(\d+)>/gm,bboxes:/([^<]+)?<loc_(\d+)><loc_(\d+)><loc_(\d+)><loc_(\d+)>/gm},this.size_per_bin=1e3}construct_prompts(u){typeof u=="string"&&(u=[u]);const h=[];for(const g of u)if(this.task_prompts_without_inputs.has(g))h.push(this.task_prompts_without_inputs.get(g));else{for(const[p,m]of this.task_prompts_with_input)if(g.includes(p)){h.push(m.replaceAll("{input}",g).replaceAll(p,""));break}h.length!==u.length&&h.push(g)}return h}post_process_generation(u,h,g){const p=this.tasks_answer_post_processing_type.get(h)??"pure_text";u=u.replaceAll("<s>","").replaceAll("</s>","");let m;switch(p){case"pure_text":m=u;break;case"description_with_bboxes":case"bboxes":case"phrase_grounding":case"ocr":const y=p==="ocr"?"quad_boxes":"bboxes",v=u.matchAll(this.regexes[y]),T=[],O=[];for(const[E,S,...D]of v)T.push(S?S.trim():T.at(-1)??""),O.push(D.map((I,M)=>(Number(I)+.5)/this.size_per_bin*g[M%2]));m={labels:T,[y]:O};break;default:throw new Error(`Task "${h}" (of type "${p}") not yet implemented.`)}return{[h]:m}}async _call(u,h=null,g={}){if(!u&&!h)throw new Error("Either text or images must be provided");const p=await this.image_processor(u,g),m=h?this.tokenizer(this.construct_prompts(h),g):{};return{...p,...m}}}ge(c,"tokenizer_class",o.AutoTokenizer),ge(c,"image_processor_class",i.AutoImageProcessor)}),"./src/models/gemma3n/feature_extraction_gemma3n.js":((e,t,n)=>{n.r(t),n.d(t,{Gemma3nAudioFeatureExtractor:()=>c});var s=n("./src/base/feature_extraction_utils.js"),i=n("./src/utils/tensor.js"),o=n("./src/utils/audio.js");class c extends s.FeatureExtractor{constructor(u){super(u);const{fft_length:h,feature_size:g,min_frequency:p,max_frequency:m,sampling_rate:y,frame_length:v}=this.config,T=(0,o.mel_filter_bank)(Math.floor(1+h/2),g,p,m,y,null,"htk",!1);this.mel_filters=T,this.window=(0,o.window_function)(v,"hann")}async _extract_fbank_features(u,h){return(0,o.spectrogram)(u,this.window,this.config.frame_length,this.config.hop_length,{fft_length:this.config.fft_length,center:!1,onesided:!0,preemphasis:this.config.preemphasis,preemphasis_htk_flavor:this.config.preemphasis_htk_flavor,mel_filters:this.mel_filters,log_mel:"log",mel_floor:this.config.mel_floor,remove_dc_offset:!1,transpose:!0})}async _call(u,{max_length:h=48e4,truncation:g=!0,padding:p=!0,pad_to_multiple_of:m=128}={}){if((0,s.validate_audio_inputs)(u,"Gemma3nAudioFeatureExtractor"),g&&u.length>h&&(u=u.slice(0,h)),p&&u.length%m!==0){const T=m-u.length%m,O=new Float64Array(u.length+T);O.set(u),this.config.padding_value!==0&&O.fill(this.config.padding_value,u.length),u=O}const y=await this._extract_fbank_features(u,this.config.max_length),v=(0,i.full)([1,y.dims[0]],!0);return{input_features:y.unsqueeze_(0),input_features_mask:v}}}}),"./src/models/gemma3n/processing_gemma3n.js":((e,t,n)=>{n.r(t),n.d(t,{Gemma3nProcessor:()=>d});var s=n("./src/base/processing_utils.js"),i=n("./src/models/auto/image_processing_auto.js"),o=n("./src/models/auto/feature_extraction_auto.js"),c=n("./src/tokenizers.js");n("./src/utils/image.js"),n("./src/utils/audio.js");class d extends s.Processor{constructor(h,g,p){super(h,g,p),this.audio_seq_length=this.config.audio_seq_length,this.image_seq_length=this.config.image_seq_length;const{audio_token_id:m,boa_token:y,audio_token:v,eoa_token:T,image_token_id:O,boi_token:E,image_token:S,eoi_token:D}=this.tokenizer.config;this.audio_token_id=m,this.boa_token=y,this.audio_token=v;const I=v.repeat(this.audio_seq_length);this.full_audio_sequence=`

${y}${I}${T}

`,this.image_token_id=O,this.boi_token=E,this.image_token=S;const M=S.repeat(this.image_seq_length);this.full_image_sequence=`

${E}${M}${D}

`}async _call(h,g=null,p=null,m={}){typeof h=="string"&&(h=[h]);let y;p&&(y=await this.feature_extractor(p,m),h=h.map(O=>O.replaceAll(this.audio_token,this.full_audio_sequence)));let v;return g&&(v=await this.image_processor(g,m),h=h.map(O=>O.replaceAll(this.image_token,this.full_image_sequence))),{...this.tokenizer(h,m),...v,...y}}}ge(d,"image_processor_class",i.AutoImageProcessor),ge(d,"feature_extractor_class",o.AutoFeatureExtractor),ge(d,"tokenizer_class",c.AutoTokenizer),ge(d,"uses_processor_config",!0),ge(d,"uses_chat_template_file",!0)}),"./src/models/glpn/image_processing_glpn.js":((e,t,n)=>{n.r(t),n.d(t,{GLPNFeatureExtractor:()=>i});var s=n("./src/base/image_processors_utils.js");class i extends s.ImageProcessor{}}),"./src/models/grounding_dino/image_processing_grounding_dino.js":((e,t,n)=>{n.r(t),n.d(t,{GroundingDinoImageProcessor:()=>o});var s=n("./src/base/image_processors_utils.js"),i=n("./src/utils/tensor.js");class o extends s.ImageProcessor{async _call(d){const u=await super._call(d),h=u.pixel_values.dims,g=(0,i.ones)([h[0],h[2],h[3]]);return{...u,pixel_mask:g}}}}),"./src/models/grounding_dino/processing_grounding_dino.js":((e,t,n)=>{n.r(t),n.d(t,{GroundingDinoProcessor:()=>u});var s=n("./src/base/processing_utils.js"),i=n("./src/models/auto/image_processing_auto.js"),o=n("./src/tokenizers.js"),c=n("./src/base/image_processors_utils.js");function d(h,g){const m=h.dims.at(-1)-1,y=h.tolist();y.fill(!1,0,1),y.fill(!1,m);const v=g.tolist();return y.map((T,O)=>T?O:null).filter(T=>T!==null).map(T=>v[T])}class u extends s.Processor{async _call(g,p,m={}){const y=g?await this.image_processor(g,m):{};return{...p?this.tokenizer(p,m):{},...y}}post_process_grounded_object_detection(g,p,{box_threshold:m=.25,text_threshold:y=.25,target_sizes:v=null}={}){const{logits:T,pred_boxes:O}=g,E=T.dims[0];if(v!==null&&v.length!==E)throw Error("Make sure that you pass in as many target sizes as the batch dimension of the logits");const S=T.dims.at(1),D=T.sigmoid(),I=D.max(-1).tolist(),M=O.tolist().map(A=>A.map(k=>(0,c.center_to_corners_format)(k))),C=[];for(let A=0;A<E;++A){const k=v!==null?v[A]:null;k!==null&&(M[A]=M[A].map(X=>X.map((le,ae)=>le*k[(ae+1)%2])));const R=I[A],G=[],te=[],ee=[];for(let X=0;X<S;++X){const le=R[X];if(le<=m)continue;const ae=M[A][X],Q=D[A][X];G.push(le),ee.push(ae);const ne=d(Q.gt(y),p[A]);te.push(ne)}C.push({scores:G,boxes:ee,labels:this.batch_decode(te)})}return C}}ge(u,"tokenizer_class",o.AutoTokenizer),ge(u,"image_processor_class",i.AutoImageProcessor)}),"./src/models/idefics3/image_processing_idefics3.js":((e,t,n)=>{n.r(t),n.d(t,{Idefics3ImageProcessor:()=>o});var s=n("./src/base/image_processors_utils.js"),i=n("./src/utils/tensor.js");class o extends s.ImageProcessor{constructor(d){super(d),this.do_image_splitting=d.do_image_splitting??!0,this.max_image_size=d.max_image_size}get_resize_for_vision_encoder(d,u){let[h,g]=d.dims.slice(-2);const p=g/h;return g>=h?(g=Math.ceil(g/u)*u,h=Math.floor(g/p),h=Math.ceil(h/u)*u):(h=Math.ceil(h/u)*u,g=Math.floor(h*p),g=Math.ceil(g/u)*u),{height:h,width:g}}async _call(d,{do_image_splitting:u=null,return_row_col_info:h=!1}={}){let g;if(!Array.isArray(d))g=[[d]];else{if(d.length===0||!d[0])throw new Error("No images provided.");Array.isArray(d[0])?g=d:g=[d]}let p=[],m=[],y=[];const v=[],T=[];for(const A of g){let k=await Promise.all(A.map(te=>this.preprocess(te)));v.push(...k.map(te=>te.original_size)),T.push(...k.map(te=>te.reshaped_input_size)),k.forEach(te=>te.pixel_values.unsqueeze_(0));const{longest_edge:R}=this.max_image_size;let G;if(u??this.do_image_splitting){let te=new Array(k.length),ee=new Array(k.length);G=await Promise.all(k.map(async(X,le)=>{const ae=this.get_resize_for_vision_encoder(X.pixel_values,R),Q=await(0,i.interpolate_4d)(X.pixel_values,{size:[ae.height,ae.width]}),{frames:ne,num_splits_h:de,num_splits_w:ve}=await this.split_image(Q,this.max_image_size);return te[le]=de,ee[le]=ve,(0,i.cat)(ne,0)})),m.push(te),y.push(ee)}else{const te=[R,R];G=await Promise.all(k.map(ee=>(0,i.interpolate_4d)(ee.pixel_values,{size:te}))),m.push(new Array(k.length).fill(0)),y.push(new Array(k.length).fill(0))}p.push((0,i.cat)(G,0))}const O=p.length,[E,S,D,I]=p[0].dims;let M,C;if(O===1)M=p[0].unsqueeze_(0),C=(0,i.full)([O,E,D,I],!0);else{const A=Math.max(...p.map(G=>G.dims.at(0)));C=(0,i.full)([O,A,D,I],!0);const k=C.data,R=A*D*I;for(let G=0;G<O;++G){const te=p[G].dims[0];if(te<A){p[G]=(0,i.cat)([p[G],(0,i.full)([A-te,S,D,I],0)],0);const ee=G*R+te*D*I,X=(G+1)*R;k.fill(!1,ee,X)}}M=(0,i.stack)(p,0)}return{pixel_values:M,pixel_attention_mask:C,original_sizes:v,reshaped_input_sizes:T,...h?{rows:m,cols:y}:{}}}async split_image(d,{longest_edge:u}){const h=u,g=u,p=[],[m,y]=d.dims.slice(-2);let v=0,T=0;if(m>h||y>g){v=Math.ceil(m/h),T=Math.ceil(y/g);const O=Math.ceil(m/v),E=Math.ceil(y/T);for(let I=0;I<v;++I)for(let M=0;M<T;++M){let C,A,k,R;I===v-1?(A=m-O,R=m):(A=I*O,R=(I+1)*O),M===T-1?(C=y-E,k=y):(C=M*E,k=(M+1)*E);const G=[A,C],te=[R,k],ee=await(0,i.slice)(d,G,te,[2,3]);p.push(ee)}const S=h,D=g;(m!==S||y!==D)&&(d=await(0,i.interpolate_4d)(d,{size:[S,D]}))}return p.push(d),{frames:p,num_splits_h:v,num_splits_w:T}}}}),"./src/models/idefics3/processing_idefics3.js":((e,t,n)=>{n.r(t),n.d(t,{Idefics3Processor:()=>g});var s=n("./src/base/processing_utils.js"),i=n("./src/models/auto/image_processing_auto.js"),o=n("./src/tokenizers.js");n("./src/utils/image.js");var c=n("./src/utils/core.js");function d(p,m,y,v,T,O){let E="";for(let S=0;S<m;++S){for(let D=0;D<y;++D)E+=v+`<row_${S+1}_col_${D+1}>`+T.repeat(p);E+=`
`}return E+=`
${v}${O}`+T.repeat(p)+`${v}`,E}function u(p,m,y,v){return`${m}${v}`+y.repeat(p)+`${m}`}function h(p,m,y,v,T,O){return p===0&&m===0?u(y,v,T,O):d(y,p,m,v,T,O)}class g extends s.Processor{constructor(){super(...arguments);ge(this,"fake_image_token","<fake_token_around_image>");ge(this,"image_token","<image>");ge(this,"global_img_token","<global-img>")}async _call(y,v=null,T={}){T.return_row_col_info??(T.return_row_col_info=!0);let O;v&&(O=await this.image_processor(v,T)),Array.isArray(y)||(y=[y]);const E=O.rows??[new Array(y.length).fill(0)],S=O.cols??[new Array(y.length).fill(0)],D=this.config.image_seq_len,I=[],M=[];for(let A=0;A<y.length;++A){const k=y[A],R=E[A],G=S[A];I.push((0,c.count)(k,this.image_token));const te=R.map((le,ae)=>h(le,G[ae],D,this.fake_image_token,this.image_token,this.global_img_token)),ee=k.split(this.image_token);if(ee.length===0)throw new Error("The image token should be present in the text.");let X=ee[0];for(let le=0;le<te.length;++le)X+=te[le]+ee[le+1];M.push(X)}return{...this.tokenizer(M),...O}}}ge(g,"image_processor_class",i.AutoImageProcessor),ge(g,"tokenizer_class",o.AutoTokenizer),ge(g,"uses_processor_config",!0)}),"./src/models/image_processors.js":((e,t,n)=>{n.r(t),n.d(t,{BeitFeatureExtractor:()=>s.BeitFeatureExtractor,BitImageProcessor:()=>i.BitImageProcessor,CLIPFeatureExtractor:()=>c.CLIPFeatureExtractor,CLIPImageProcessor:()=>c.CLIPImageProcessor,ChineseCLIPFeatureExtractor:()=>o.ChineseCLIPFeatureExtractor,ConvNextFeatureExtractor:()=>d.ConvNextFeatureExtractor,ConvNextImageProcessor:()=>d.ConvNextImageProcessor,DINOv3ViTImageProcessor:()=>g.DINOv3ViTImageProcessor,DPTFeatureExtractor:()=>m.DPTFeatureExtractor,DPTImageProcessor:()=>m.DPTImageProcessor,DeiTFeatureExtractor:()=>u.DeiTFeatureExtractor,DeiTImageProcessor:()=>u.DeiTImageProcessor,DetrFeatureExtractor:()=>h.DetrFeatureExtractor,DetrImageProcessor:()=>h.DetrImageProcessor,DonutFeatureExtractor:()=>p.DonutFeatureExtractor,DonutImageProcessor:()=>p.DonutImageProcessor,EfficientNetImageProcessor:()=>y.EfficientNetImageProcessor,GLPNFeatureExtractor:()=>v.GLPNFeatureExtractor,GroundingDinoImageProcessor:()=>T.GroundingDinoImageProcessor,Idefics3ImageProcessor:()=>O.Idefics3ImageProcessor,JinaCLIPImageProcessor:()=>S.JinaCLIPImageProcessor,LlavaOnevisionImageProcessor:()=>D.LlavaOnevisionImageProcessor,Mask2FormerImageProcessor:()=>I.Mask2FormerImageProcessor,MaskFormerFeatureExtractor:()=>M.MaskFormerFeatureExtractor,MaskFormerImageProcessor:()=>M.MaskFormerImageProcessor,MobileNetV1FeatureExtractor:()=>C.MobileNetV1FeatureExtractor,MobileNetV1ImageProcessor:()=>C.MobileNetV1ImageProcessor,MobileNetV2FeatureExtractor:()=>A.MobileNetV2FeatureExtractor,MobileNetV2ImageProcessor:()=>A.MobileNetV2ImageProcessor,MobileNetV3FeatureExtractor:()=>k.MobileNetV3FeatureExtractor,MobileNetV3ImageProcessor:()=>k.MobileNetV3ImageProcessor,MobileNetV4FeatureExtractor:()=>R.MobileNetV4FeatureExtractor,MobileNetV4ImageProcessor:()=>R.MobileNetV4ImageProcessor,MobileViTFeatureExtractor:()=>G.MobileViTFeatureExtractor,MobileViTImageProcessor:()=>G.MobileViTImageProcessor,NougatImageProcessor:()=>te.NougatImageProcessor,OwlViTFeatureExtractor:()=>X.OwlViTFeatureExtractor,OwlViTImageProcessor:()=>X.OwlViTImageProcessor,Owlv2ImageProcessor:()=>ee.Owlv2ImageProcessor,Phi3VImageProcessor:()=>le.Phi3VImageProcessor,PixtralImageProcessor:()=>ae.PixtralImageProcessor,PvtImageProcessor:()=>Q.PvtImageProcessor,Qwen2VLImageProcessor:()=>ne.Qwen2VLImageProcessor,RTDetrImageProcessor:()=>de.RTDetrImageProcessor,Sam2ImageProcessor:()=>fe.Sam2ImageProcessor,Sam3ImageProcessor:()=>j.Sam3ImageProcessor,SamImageProcessor:()=>ve.SamImageProcessor,SegformerFeatureExtractor:()=>U.SegformerFeatureExtractor,SegformerImageProcessor:()=>U.SegformerImageProcessor,SiglipImageProcessor:()=>N.SiglipImageProcessor,SmolVLMImageProcessor:()=>q.SmolVLMImageProcessor,Swin2SRImageProcessor:()=>ce.Swin2SRImageProcessor,VLMImageProcessor:()=>E.VLMImageProcessor,ViTFeatureExtractor:()=>Z.ViTFeatureExtractor,ViTImageProcessor:()=>Z.ViTImageProcessor,VitMatteImageProcessor:()=>Me.VitMatteImageProcessor,VitPoseImageProcessor:()=>Pe.VitPoseImageProcessor,YolosFeatureExtractor:()=>Ne.YolosFeatureExtractor,YolosImageProcessor:()=>Ne.YolosImageProcessor});var s=n("./src/models/beit/image_processing_beit.js"),i=n("./src/models/bit/image_processing_bit.js"),o=n("./src/models/chinese_clip/image_processing_chinese_clip.js"),c=n("./src/models/clip/image_processing_clip.js"),d=n("./src/models/convnext/image_processing_convnext.js"),u=n("./src/models/deit/image_processing_deit.js"),h=n("./src/models/detr/image_processing_detr.js"),g=n("./src/models/dinov3_vit/image_processing_dinov3_vit.js"),p=n("./src/models/donut/image_processing_donut.js"),m=n("./src/models/dpt/image_processing_dpt.js"),y=n("./src/models/efficientnet/image_processing_efficientnet.js"),v=n("./src/models/glpn/image_processing_glpn.js"),T=n("./src/models/grounding_dino/image_processing_grounding_dino.js"),O=n("./src/models/idefics3/image_processing_idefics3.js"),E=n("./src/models/janus/image_processing_janus.js"),S=n("./src/models/jina_clip/image_processing_jina_clip.js"),D=n("./src/models/llava_onevision/image_processing_llava_onevision.js"),I=n("./src/models/mask2former/image_processing_mask2former.js"),M=n("./src/models/maskformer/image_processing_maskformer.js"),C=n("./src/models/mobilenet_v1/image_processing_mobilenet_v1.js"),A=n("./src/models/mobilenet_v2/image_processing_mobilenet_v2.js"),k=n("./src/models/mobilenet_v3/image_processing_mobilenet_v3.js"),R=n("./src/models/mobilenet_v4/image_processing_mobilenet_v4.js"),G=n("./src/models/mobilevit/image_processing_mobilevit.js"),te=n("./src/models/nougat/image_processing_nougat.js"),ee=n("./src/models/owlv2/image_processing_owlv2.js"),X=n("./src/models/owlvit/image_processing_owlvit.js"),le=n("./src/models/phi3_v/image_processing_phi3_v.js"),ae=n("./src/models/pixtral/image_processing_pixtral.js"),Q=n("./src/models/pvt/image_processing_pvt.js"),ne=n("./src/models/qwen2_vl/image_processing_qwen2_vl.js"),de=n("./src/models/rt_detr/image_processing_rt_detr.js"),ve=n("./src/models/sam/image_processing_sam.js"),fe=n("./src/models/sam2/image_processing_sam2.js"),j=n("./src/models/sam3/image_processing_sam3.js"),U=n("./src/models/segformer/image_processing_segformer.js"),N=n("./src/models/siglip/image_processing_siglip.js"),q=n("./src/models/smolvlm/image_processing_smolvlm.js"),ce=n("./src/models/swin2sr/image_processing_swin2sr.js"),Z=n("./src/models/vit/image_processing_vit.js"),Me=n("./src/models/vitmatte/image_processing_vitmatte.js"),Pe=n("./src/models/vitpose/image_processing_vitpose.js"),Ne=n("./src/models/yolos/image_processing_yolos.js")}),"./src/models/janus/image_processing_janus.js":((e,t,n)=>{n.r(t),n.d(t,{VLMImageProcessor:()=>i});var s=n("./src/base/image_processors_utils.js");class i extends s.ImageProcessor{constructor(c){super({do_pad:!0,pad_size:{width:c.image_size,height:c.image_size},...c}),this.constant_values=this.config.background_color.map(d=>d*this.rescale_factor)}pad_image(c,d,u,h){return super.pad_image(c,d,u,{constant_values:this.constant_values,center:!0,...h})}}}),"./src/models/janus/processing_janus.js":((e,t,n)=>{n.r(t),n.d(t,{VLChatProcessor:()=>h});var s=n("./src/base/processing_utils.js"),i=n("./src/models/auto/image_processing_auto.js"),o=n("./src/tokenizers.js"),c=n("./src/utils/core.js"),d=n("./src/utils/tensor.js"),u=n("./src/utils/image.js");class h extends s.Processor{constructor(p,m,y){super(p,m,y),this.image_tag=this.config.image_tag,this.image_start_tag=this.config.image_start_tag,this.image_end_tag=this.config.image_end_tag,this.num_image_tokens=this.config.num_image_tokens}async _call(p,{images:m=null,chat_template:y="default"}={}){m?Array.isArray(m)||(m=[m]):m=await Promise.all(p.filter(G=>G.images).flatMap(G=>G.images).map(G=>u.RawImage.read(G)));const v=this.tokenizer,T=v.apply_chat_template(p,{tokenize:!1,add_generation_prompt:!0,chat_template:y}),O=G=>v.encode(G,{add_special_tokens:!1}),E=T.split(this.image_tag),S=E.length-1;if(m.length!==S)throw new Error(`Number of images provided (${m.length}) does not match number of "${this.image_tag}" image tags (${S})`);const[D,I,M]=v.model.convert_tokens_to_ids([this.image_tag,this.image_start_tag,this.image_end_tag]);let C=O(E[0]),A=new Array(C.length).fill(!1);for(let G=1;G<E.length;++G){const te=new Array(this.num_image_tokens).fill(D),ee=O(E[G]);C=(0,c.mergeArrays)(C,[I],te,[M],ee);const X=new Array(this.num_image_tokens).fill(!0);A=(0,c.mergeArrays)(A,[!1],X,[!1],new Array(ee.length).fill(!1))}const k=[1,C.length],R={input_ids:new d.Tensor("int64",C,k),attention_mask:new d.Tensor("int64",new Array(C.length).fill(1),k),images_seq_mask:new d.Tensor("bool",A,k),images_emb_mask:new d.Tensor("bool",new Array(S*this.num_image_tokens).fill(!0),[1,S,this.num_image_tokens])};if(m&&m.length>0){const G=await this.image_processor(m);return G.pixel_values.unsqueeze_(0),{...R,...G}}return R}}ge(h,"image_processor_class",i.AutoImageProcessor),ge(h,"tokenizer_class",o.AutoTokenizer),ge(h,"uses_processor_config",!0)}),"./src/models/jina_clip/image_processing_jina_clip.js":((e,t,n)=>{n.r(t),n.d(t,{JinaCLIPImageProcessor:()=>i});var s=n("./src/base/image_processors_utils.js");class i extends s.ImageProcessor{constructor(c){const{resize_mode:d,fill_color:u,interpolation:h,size:g,...p}=c,m=d==="squash"?{width:g,height:g}:d==="shortest"?{shortest_edge:g}:{longest_edge:g},y=h==="bicubic"?3:2;super({...p,size:m,resample:y,do_center_crop:!0,crop_size:g,do_normalize:!0})}}}),"./src/models/jina_clip/processing_jina_clip.js":((e,t,n)=>{n.r(t),n.d(t,{JinaCLIPProcessor:()=>c});var s=n("./src/base/processing_utils.js"),i=n("./src/models/auto/image_processing_auto.js"),o=n("./src/tokenizers.js");class c extends s.Processor{async _call(u=null,h=null,g={}){if(!u&&!h)throw new Error("Either text or images must be provided");const p=u?this.tokenizer(u,g):{},m=h?await this.image_processor(h,g):{};return{...p,...m}}}ge(c,"tokenizer_class",o.AutoTokenizer),ge(c,"image_processor_class",i.AutoImageProcessor)}),"./src/models/llava/processing_llava.js":((e,t,n)=>{n.r(t),n.d(t,{LlavaProcessor:()=>c});var s=n("./src/base/processing_utils.js"),i=n("./src/models/auto/image_processing_auto.js"),o=n("./src/tokenizers.js");class c extends s.Processor{async _call(u,h=null,g={}){const p=await this.image_processor(u,g);if(h){const[y,v]=p.pixel_values.dims.slice(-2),{image_token:T,patch_size:O,num_additional_image_tokens:E}=this.config,S=Math.floor(y/O)*Math.floor(v/O)+E;h=structuredClone(h),Array.isArray(h)||(h=[h]);for(let D=0;D<h.length;++D)h[D]=h[D].replace(T,T.repeat(S))}const m=h?this.tokenizer(h,g):{};return{...p,...m}}}ge(c,"tokenizer_class",o.AutoTokenizer),ge(c,"image_processor_class",i.AutoImageProcessor),ge(c,"uses_processor_config",!0)}),"./src/models/llava_onevision/image_processing_llava_onevision.js":((e,t,n)=>{n.r(t),n.d(t,{LlavaOnevisionImageProcessor:()=>i});var s=n("./src/base/image_processors_utils.js");class i extends s.ImageProcessor{}}),"./src/models/mask2former/image_processing_mask2former.js":((e,t,n)=>{n.r(t),n.d(t,{Mask2FormerImageProcessor:()=>i});var s=n("./src/models/maskformer/image_processing_maskformer.js");class i extends s.MaskFormerImageProcessor{}}),"./src/models/maskformer/image_processing_maskformer.js":((e,t,n)=>{n.r(t),n.d(t,{MaskFormerFeatureExtractor:()=>o,MaskFormerImageProcessor:()=>i});var s=n("./src/base/image_processors_utils.js");class i extends s.ImageProcessor{post_process_panoptic_segmentation(...d){return(0,s.post_process_panoptic_segmentation)(...d)}post_process_instance_segmentation(...d){return(0,s.post_process_instance_segmentation)(...d)}}class o extends i{}}),"./src/models/mgp_str/processing_mgp_str.js":((e,t,n)=>{n.r(t),n.d(t,{MgpstrProcessor:()=>u});var s=n("./src/base/processing_utils.js"),i=n("./src/models/auto/image_processing_auto.js"),o=n("./src/tokenizers.js"),c=n("./src/utils/maths.js");const d={char:["char_decode",1],bpe:["bpe_decode",2],wp:["wp_decode",102]};class u extends s.Processor{get char_tokenizer(){return this.components.char_tokenizer}get bpe_tokenizer(){return this.components.bpe_tokenizer}get wp_tokenizer(){return this.components.wp_tokenizer}_decode_helper(g,p){if(!d.hasOwnProperty(p))throw new Error(`Format ${p} is not supported.`);const[m,y]=d[p],v=this[m].bind(this),[T,O]=g.dims,E=[],S=[],D=g.tolist();for(let M=0;M<T;++M){const C=D[M],A=[],k=[];for(let G=1;G<O;++G){const[te,ee]=(0,c.max)((0,c.softmax)(C[G]));if(k.push(te),ee==y)break;A.push(ee)}const R=k.length>0?k.reduce((G,te)=>G*te,1):0;S.push(A),E.push(R)}return[v(S),E]}char_decode(g){return this.char_tokenizer.batch_decode(g).map(p=>p.replaceAll(" ",""))}bpe_decode(g){return this.bpe_tokenizer.batch_decode(g)}wp_decode(g){return this.wp_tokenizer.batch_decode(g).map(p=>p.replaceAll(" ",""))}batch_decode([g,p,m]){const[y,v]=this._decode_helper(g,"char"),[T,O]=this._decode_helper(p,"bpe"),[E,S]=this._decode_helper(m,"wp"),D=[],I=[];for(let M=0;M<y.length;++M){const[C,A]=(0,c.max)([v[M],O[M],S[M]]);D.push([y[M],T[M],E[M]][A]),I.push(C)}return{generated_text:D,scores:I,char_preds:y,bpe_preds:T,wp_preds:E}}static async from_pretrained(...g){const p=await super.from_pretrained(...g),m=await o.AutoTokenizer.from_pretrained("Xenova/gpt2"),y=await o.AutoTokenizer.from_pretrained("Xenova/bert-base-uncased");return p.components={image_processor:p.image_processor,char_tokenizer:p.tokenizer,bpe_tokenizer:m,wp_tokenizer:y},p}async _call(g,p=null){const m=await this.image_processor(g);return p&&(m.labels=this.tokenizer(p).input_ids),m}}ge(u,"tokenizer_class",o.AutoTokenizer),ge(u,"image_processor_class",i.AutoImageProcessor)}),"./src/models/mobilenet_v1/image_processing_mobilenet_v1.js":((e,t,n)=>{n.r(t),n.d(t,{MobileNetV1FeatureExtractor:()=>o,MobileNetV1ImageProcessor:()=>i});var s=n("./src/base/image_processors_utils.js");class i extends s.ImageProcessor{}class o extends i{}}),"./src/models/mobilenet_v2/image_processing_mobilenet_v2.js":((e,t,n)=>{n.r(t),n.d(t,{MobileNetV2FeatureExtractor:()=>o,MobileNetV2ImageProcessor:()=>i});var s=n("./src/base/image_processors_utils.js");class i extends s.ImageProcessor{}class o extends i{}}),"./src/models/mobilenet_v3/image_processing_mobilenet_v3.js":((e,t,n)=>{n.r(t),n.d(t,{MobileNetV3FeatureExtractor:()=>o,MobileNetV3ImageProcessor:()=>i});var s=n("./src/base/image_processors_utils.js");class i extends s.ImageProcessor{}class o extends i{}}),"./src/models/mobilenet_v4/image_processing_mobilenet_v4.js":((e,t,n)=>{n.r(t),n.d(t,{MobileNetV4FeatureExtractor:()=>o,MobileNetV4ImageProcessor:()=>i});var s=n("./src/base/image_processors_utils.js");class i extends s.ImageProcessor{}class o extends i{}}),"./src/models/mobilevit/image_processing_mobilevit.js":((e,t,n)=>{n.r(t),n.d(t,{MobileViTFeatureExtractor:()=>o,MobileViTImageProcessor:()=>i});var s=n("./src/base/image_processors_utils.js");class i extends s.ImageProcessor{}class o extends i{}}),"./src/models/moonshine/feature_extraction_moonshine.js":((e,t,n)=>{n.r(t),n.d(t,{MoonshineFeatureExtractor:()=>o});var s=n("./src/base/feature_extraction_utils.js"),i=n("./src/utils/tensor.js");class o extends s.FeatureExtractor{async _call(d){(0,s.validate_audio_inputs)(d,"MoonshineFeatureExtractor"),d instanceof Float64Array&&(d=new Float32Array(d));const u=[1,d.length];return{input_values:new i.Tensor("float32",d,u)}}}}),"./src/models/moonshine/processing_moonshine.js":((e,t,n)=>{n.r(t),n.d(t,{MoonshineProcessor:()=>c});var s=n("./src/models/auto/feature_extraction_auto.js"),i=n("./src/tokenizers.js"),o=n("./src/base/processing_utils.js");class c extends o.Processor{async _call(u){return await this.feature_extractor(u)}}ge(c,"tokenizer_class",i.AutoTokenizer),ge(c,"feature_extractor_class",s.AutoFeatureExtractor)}),"./src/models/nougat/image_processing_nougat.js":((e,t,n)=>{n.r(t),n.d(t,{NougatImageProcessor:()=>i});var s=n("./src/models/donut/image_processing_donut.js");class i extends s.DonutImageProcessor{}}),"./src/models/owlv2/image_processing_owlv2.js":((e,t,n)=>{n.r(t),n.d(t,{Owlv2ImageProcessor:()=>i});var s=n("./src/models/owlvit/image_processing_owlvit.js");class i extends s.OwlViTImageProcessor{}}),"./src/models/owlvit/image_processing_owlvit.js":((e,t,n)=>{n.r(t),n.d(t,{OwlViTFeatureExtractor:()=>o,OwlViTImageProcessor:()=>i});var s=n("./src/base/image_processors_utils.js");class i extends s.ImageProcessor{post_process_object_detection(...d){return(0,s.post_process_object_detection)(...d)}}class o extends i{}}),"./src/models/owlvit/processing_owlvit.js":((e,t,n)=>{n.r(t),n.d(t,{OwlViTProcessor:()=>c});var s=n("./src/base/processing_utils.js"),i=n("./src/models/auto/image_processing_auto.js"),o=n("./src/tokenizers.js");class c extends s.Processor{}ge(c,"tokenizer_class",o.AutoTokenizer),ge(c,"image_processor_class",i.AutoImageProcessor)}),"./src/models/paligemma/processing_paligemma.js":((e,t,n)=>{n.r(t),n.d(t,{PaliGemmaProcessor:()=>u});var s=n("./src/base/processing_utils.js"),i=n("./src/models/auto/image_processing_auto.js"),o=n("./src/tokenizers.js");const c="<image>";function d(h,g,p,m,y){return`${m.repeat(p*y)}${g}${h}
`}class u extends s.Processor{async _call(g,p=null,m={}){p||(console.warn("You are using PaliGemma without a text prefix. It will perform as a picture-captioning model."),p=""),Array.isArray(g)||(g=[g]),Array.isArray(p)||(p=[p]);const y=this.tokenizer.bos_token,v=this.image_processor.config.image_seq_length;let T;p.some(S=>S.includes(c))?T=p.map(S=>{const D=S.replaceAll(c,c.repeat(v)),I=D.lastIndexOf(c),M=I===-1?0:I+c.length;return D.slice(0,M)+y+D.slice(M)+`
`}):(console.warn("You are passing both `text` and `images` to `PaliGemmaProcessor`. The processor expects special image tokens in the text, as many tokens as there are images per each text. It is recommended to add `<image>` tokens in the very beginning of your text. For this call, we will infer how many images each text has and add special tokens."),T=p.map(S=>d(S,y,v,c,g.length)));const O=this.tokenizer(T,m);return{...await this.image_processor(g,m),...O}}}ge(u,"tokenizer_class",o.AutoTokenizer),ge(u,"image_processor_class",i.AutoImageProcessor),ge(u,"uses_processor_config",!1)}),"./src/models/parakeet/feature_extraction_parakeet.js":((e,t,n)=>{n.r(t),n.d(t,{ParakeetFeatureExtractor:()=>d});var s=n("./src/base/feature_extraction_utils.js"),i=n("./src/utils/tensor.js"),o=n("./src/utils/audio.js");const c=1e-5;class d extends s.FeatureExtractor{constructor(h){var m;super(h),(m=this.config).mel_filters??(m.mel_filters=(0,o.mel_filter_bank)(Math.floor(1+this.config.n_fft/2),this.config.feature_size,0,this.config.sampling_rate/2,this.config.sampling_rate,"slaney","slaney"));const g=(0,o.window_function)(this.config.win_length,"hann",{periodic:!1});this.window=new Float64Array(this.config.n_fft);const p=Math.floor((this.config.n_fft-this.config.win_length)/2);this.window.set(g,p)}async _extract_fbank_features(h){const g=this.config.preemphasis;h=new Float64Array(h);for(let m=h.length-1;m>=1;--m)h[m]-=g*h[m-1];return await(0,o.spectrogram)(h,this.window,this.window.length,this.config.hop_length,{fft_length:this.config.n_fft,power:2,mel_filters:this.config.mel_filters,log_mel:"log",mel_floor:-1/0,pad_mode:"constant",center:!0,transpose:!0,mel_offset:2**-24})}async _call(h){(0,s.validate_audio_inputs)(h,"ParakeetFeatureExtractor");const g=await this._extract_fbank_features(h),p=Math.floor((h.length+Math.floor(this.config.n_fft/2)*2-this.config.n_fft)/this.config.hop_length),m=g.data;m.fill(0,p*g.dims[1]);const[y,v]=g.dims,T=new Float64Array(v),O=new Float64Array(v);for(let D=0;D<p;++D){const I=D*v;for(let M=0;M<v;++M){const C=m[I+M];T[M]+=C,O[M]+=C*C}}const E=p>1?p-1:1;for(let D=0;D<v;++D){const I=T[D]/p,M=(O[D]-p*I*I)/E,A=1/(Math.sqrt(M)+c);for(let k=0;k<p;++k){const R=k*v+D;m[R]=(m[R]-I)*A}}const S=new BigInt64Array(y);return S.fill(1n,0,p),{input_features:g.unsqueeze_(0),attention_mask:new i.Tensor("int64",S,[1,y])}}}}),"./src/models/phi3_v/image_processing_phi3_v.js":((e,t,n)=>{n.r(t),n.d(t,{Phi3VImageProcessor:()=>g});var s=n("./src/base/image_processors_utils.js"),i=n("./src/utils/tensor.js");const o=336,c=[2,3],{ceil:d,floor:u,sqrt:h}=Math;class g extends s.ImageProcessor{constructor(m){super({...m,do_normalize:!0,do_pad:!0,pad_size:"custom",do_convert_rgb:!0,do_resize:!0}),this._num_crops=m.num_crops}calc_num_image_tokens_from_image_size(m,y){const{num_img_tokens:v}=this.config;return u((u(y/o)*u(m/o)+1)*v+1+(u(y/o)+1)*h(v))}get_resize_output_image_size(m,y){const v=this._num_crops,[T,O]=m.size;let E=T/O,S=1;for(;S*Math.ceil(S/E)<=v;)S+=1;S-=1;const D=Math.floor(S*336),I=Math.floor(D/E);return[D,I]}pad_image(m,y,v,T={}){const[O,E]=y,S=o*d(O/o),D=o*d(E/o),I=[1,1,1].map((M,C)=>(M-this.image_mean[C])/this.image_std[C]);return super.pad_image(m,y,{width:D,height:S},{center:!0,constant_values:I,...T})}async _call(m,{num_crops:y=null}={}){if(this._num_crops=y??(y=this.config.num_crops),y<4||h(y)%1!==0)throw new Error("num_crops must be a square number >= 4");Array.isArray(m)||(m=[m]);const v=m.length,T=await Promise.all(m.map(A=>this.preprocess(A))),O=T.map(A=>A.original_size),E=T.map(A=>A.reshaped_input_size),S=[];for(const{pixel_values:A}of T){A.unsqueeze_(0);const[k,R]=A.dims.slice(-2),G=await(0,i.interpolate_4d)(A,{size:[o,o],mode:"bicubic"});if(y>0){const te=[],ee=h(y),X=u(R/ee),le=u(k/ee);for(let Q=0;Q<ee;++Q)for(let ne=0;ne<ee;++ne){let de,ve,fe,j;Q===ee-1?(ve=k-le,j=k):(ve=Q*le,j=(Q+1)*le),ne===ee-1?(de=R-X,fe=R):(de=ne*X,fe=(ne+1)*X);const U=[ve,de],N=[j,fe],q=await(0,i.slice)(A,U,N,c);te.push(q)}const ae=await(0,i.interpolate_4d)((0,i.cat)(te,0),{size:[o,o],mode:"bicubic"});S.push((0,i.cat)([G,ae],0))}else S.push(G)}const D=(0,i.stack)(S,0),I=E.map(A=>A.map(k=>o*d(k/o))),M=new i.Tensor("int64",I.flat(),[v,2]),C=I.map(([A,k])=>this.calc_num_image_tokens_from_image_size(k,A));return{pixel_values:D,original_sizes:O,reshaped_input_sizes:E,image_sizes:M,num_img_tokens:C}}}}),"./src/models/phi3_v/processing_phi3_v.js":((e,t,n)=>{n.r(t),n.d(t,{Phi3VProcessor:()=>u});var s=n("./src/base/processing_utils.js"),i=n("./src/models/auto/image_processing_auto.js"),o=n("./src/tokenizers.js");n("./src/utils/image.js");const c="<|image|>",d=/<\|image_\d+\|>/g;class u extends s.Processor{async _call(g,p=null,{padding:m=!0,truncation:y=!0,num_crops:v=null}={}){Array.isArray(g)||(g=[g]);let T,O;if(p){O=await this.image_processor(p,{num_crops:v});const{num_img_tokens:E}=O,S=g.map((I,M)=>I.split(d).join(c.repeat(E[M])));T=this.tokenizer(S,{padding:m,truncation:y});const D=this.tokenizer.model.convert_tokens_to_ids([c])[0];T.input_ids.map_(I=>I==D?-I:I)}else T=this.tokenizer(g);return{...T,...O}}}ge(u,"image_processor_class",i.AutoImageProcessor),ge(u,"tokenizer_class",o.AutoTokenizer)}),"./src/models/pixtral/image_processing_pixtral.js":((e,t,n)=>{n.r(t),n.d(t,{PixtralImageProcessor:()=>i});var s=n("./src/base/image_processors_utils.js");class i extends s.ImageProcessor{get_resize_output_image_size(c,d){const{longest_edge:u}=d;if(u===void 0)throw new Error("size must contain 'longest_edge'");const[h,g]=c.size,p=Math.max(h,g)/u;let m=h,y=g;p>1&&(m=Math.floor(h/p),y=Math.floor(g/p));const{patch_size:v,spatial_merge_size:T}=this.config;if(!T)throw new Error("config must contain 'spatial_merge_size'");const O=v*T,E=Math.floor((m-1)/O)+1,S=Math.floor((y-1)/O)+1;return[E*O,S*O]}}}),"./src/models/pixtral/processing_pixtral.js":((e,t,n)=>{n.r(t),n.d(t,{PixtralProcessor:()=>c});var s=n("./src/base/processing_utils.js"),i=n("./src/models/auto/image_processing_auto.js"),o=n("./src/tokenizers.js");class c extends s.Processor{async _call(u,h=null,g={}){const p=await this.image_processor(u,g);if(h){const[y,v]=p.pixel_values.dims.slice(-2),{image_token:T,image_break_token:O,image_end_token:E,patch_size:S,spatial_merge_size:D}=this.config,I=S*D,M=Math.floor(y/I),C=Math.floor(v/I);h=structuredClone(h),Array.isArray(h)||(h=[h]);for(let A=0;A<h.length;++A){const k=T.repeat(C),R=k+O,G=k+E,te=R.repeat(M-1)+G;h[A]=h[A].replace(T,te)}}const m=h?this.tokenizer(h,g):{};return{...p,...m}}}ge(c,"tokenizer_class",o.AutoTokenizer),ge(c,"image_processor_class",i.AutoImageProcessor),ge(c,"uses_processor_config",!0)}),"./src/models/processors.js":((e,t,n)=>{n.r(t),n.d(t,{Florence2Processor:()=>s.Florence2Processor,Gemma3nProcessor:()=>i.Gemma3nProcessor,GroundingDinoProcessor:()=>o.GroundingDinoProcessor,Idefics3Processor:()=>c.Idefics3Processor,JinaCLIPProcessor:()=>u.JinaCLIPProcessor,LlavaProcessor:()=>h.LlavaProcessor,MgpstrProcessor:()=>g.MgpstrProcessor,MoonshineProcessor:()=>p.MoonshineProcessor,OwlViTProcessor:()=>m.OwlViTProcessor,PaliGemmaProcessor:()=>y.PaliGemmaProcessor,Phi3VProcessor:()=>v.Phi3VProcessor,PixtralProcessor:()=>T.PixtralProcessor,PyAnnoteProcessor:()=>O.PyAnnoteProcessor,Qwen2VLProcessor:()=>E.Qwen2VLProcessor,Sam2Processor:()=>D.Sam2Processor,Sam2VideoProcessor:()=>D.Sam2VideoProcessor,SamProcessor:()=>S.SamProcessor,SmolVLMProcessor:()=>I.SmolVLMProcessor,SpeechT5Processor:()=>M.SpeechT5Processor,UltravoxProcessor:()=>C.UltravoxProcessor,VLChatProcessor:()=>d.VLChatProcessor,VoxtralProcessor:()=>A.VoxtralProcessor,Wav2Vec2Processor:()=>k.Wav2Vec2Processor,Wav2Vec2ProcessorWithLM:()=>R.Wav2Vec2ProcessorWithLM,WhisperProcessor:()=>G.WhisperProcessor});var s=n("./src/models/florence2/processing_florence2.js"),i=n("./src/models/gemma3n/processing_gemma3n.js"),o=n("./src/models/grounding_dino/processing_grounding_dino.js"),c=n("./src/models/idefics3/processing_idefics3.js"),d=n("./src/models/janus/processing_janus.js"),u=n("./src/models/jina_clip/processing_jina_clip.js"),h=n("./src/models/llava/processing_llava.js"),g=n("./src/models/mgp_str/processing_mgp_str.js"),p=n("./src/models/moonshine/processing_moonshine.js"),m=n("./src/models/owlvit/processing_owlvit.js"),y=n("./src/models/paligemma/processing_paligemma.js"),v=n("./src/models/phi3_v/processing_phi3_v.js"),T=n("./src/models/pixtral/processing_pixtral.js"),O=n("./src/models/pyannote/processing_pyannote.js"),E=n("./src/models/qwen2_vl/processing_qwen2_vl.js"),S=n("./src/models/sam/processing_sam.js"),D=n("./src/models/sam2/processing_sam2.js"),I=n("./src/models/smolvlm/processing_smolvlm.js"),M=n("./src/models/speecht5/processing_speecht5.js"),C=n("./src/models/ultravox/processing_ultravox.js"),A=n("./src/models/voxtral/processing_voxtral.js"),k=n("./src/models/wav2vec2/processing_wav2vec2.js"),R=n("./src/models/wav2vec2_with_lm/processing_wav2vec2_with_lm.js"),G=n("./src/models/whisper/processing_whisper.js")}),"./src/models/pvt/image_processing_pvt.js":((e,t,n)=>{n.r(t),n.d(t,{PvtImageProcessor:()=>i});var s=n("./src/base/image_processors_utils.js");class i extends s.ImageProcessor{}}),"./src/models/pyannote/feature_extraction_pyannote.js":((e,t,n)=>{n.r(t),n.d(t,{PyAnnoteFeatureExtractor:()=>c});var s=n("./src/base/feature_extraction_utils.js"),i=n("./src/utils/tensor.js"),o=n("./src/utils/maths.js");class c extends s.FeatureExtractor{async _call(u){(0,s.validate_audio_inputs)(u,"PyAnnoteFeatureExtractor"),u instanceof Float64Array&&(u=new Float32Array(u));const h=[1,1,u.length];return{input_values:new i.Tensor("float32",u,h)}}samples_to_frames(u){return(u-this.config.offset)/this.config.step}post_process_speaker_diarization(u,h){const g=h/this.samples_to_frames(h)/this.config.sampling_rate,p=[];for(const m of u.tolist()){const y=[];let v=-1;for(let T=0;T<m.length;++T){const O=(0,o.softmax)(m[T]),[E,S]=(0,o.max)(O),[D,I]=[T,T+1];S!==v?(v=S,y.push({id:S,start:D,end:I,score:E})):(y.at(-1).end=I,y.at(-1).score+=E)}p.push(y.map(({id:T,start:O,end:E,score:S})=>({id:T,start:O*g,end:E*g,confidence:S/(E-O)})))}return p}}}),"./src/models/pyannote/processing_pyannote.js":((e,t,n)=>{n.r(t),n.d(t,{PyAnnoteProcessor:()=>o});var s=n("./src/base/processing_utils.js"),i=n("./src/models/pyannote/feature_extraction_pyannote.js");class o extends s.Processor{async _call(d){return await this.feature_extractor(d)}post_process_speaker_diarization(...d){return this.feature_extractor.post_process_speaker_diarization(...d)}get sampling_rate(){return this.feature_extractor.config.sampling_rate}}ge(o,"feature_extractor_class",i.PyAnnoteFeatureExtractor)}),"./src/models/qwen2_vl/image_processing_qwen2_vl.js":((e,t,n)=>{n.r(t),n.d(t,{Qwen2VLImageProcessor:()=>o});var s=n("./src/base/image_processors_utils.js"),i=n("./src/utils/tensor.js");class o extends s.ImageProcessor{async _call(d,...u){const{pixel_values:h,original_sizes:g,reshaped_input_sizes:p}=await super._call(d,...u);let m=h;const{temporal_patch_size:y,merge_size:v,patch_size:T}=this.config;m.dims[0]===1&&(m=(0,i.cat)(Array.from({length:y},()=>m),0));const O=m.dims[0]/y,E=m.dims[1],S=Math.floor(m.dims[2]/T),D=Math.floor(m.dims[3]/T),I=m.view(O,y,E,Math.floor(S/v),v,T,Math.floor(D/v),v,T).permute(0,3,6,4,7,2,1,5,8).view(O*S*D,E*y*T*T),M=new i.Tensor("int64",[O,S,D],[1,3]);return{pixel_values:I,image_grid_thw:M,original_sizes:g,reshaped_input_sizes:p}}}}),"./src/models/qwen2_vl/processing_qwen2_vl.js":((e,t,n)=>{n.r(t),n.d(t,{Qwen2VLProcessor:()=>c});var s=n("./src/base/processing_utils.js"),i=n("./src/models/auto/image_processing_auto.js"),o=n("./src/tokenizers.js");n("./src/utils/image.js");class c extends s.Processor{async _call(u,h=null,...g){Array.isArray(u)||(u=[u]);let p,m;if(h&&(p=await this.image_processor(h),m=p.image_grid_thw),m){let v=this.image_processor.config.merge_size**2,T=0;const O=m.tolist();u=u.map(E=>{for(;E.includes("<|image_pad|>");){const S=Number(O[T++].reduce((D,I)=>D*I,1n));E=E.replace("<|image_pad|>","<|placeholder|>".repeat(Math.floor(S/v)))}return E.replaceAll("<|placeholder|>","<|image_pad|>")})}return{...this.tokenizer(u),...p}}}ge(c,"image_processor_class",i.AutoImageProcessor),ge(c,"tokenizer_class",o.AutoTokenizer)}),"./src/models/rt_detr/image_processing_rt_detr.js":((e,t,n)=>{n.r(t),n.d(t,{RTDetrImageProcessor:()=>i});var s=n("./src/base/image_processors_utils.js");class i extends s.ImageProcessor{post_process_object_detection(...c){return(0,s.post_process_object_detection)(...c)}}}),"./src/models/sam/image_processing_sam.js":((e,t,n)=>{n.r(t),n.d(t,{SamImageProcessor:()=>c});var s=n("./src/base/image_processors_utils.js"),i=n("./src/utils/core.js"),o=n("./src/utils/tensor.js");class c extends s.ImageProcessor{reshape_input_points(u,h,g,p=!1){u=structuredClone(u);let m=(0,i.calculateDimensions)(u);if(m.length===3)p||(m=[1,...m]),u=[u];else if(m.length!==4)throw Error("The input_points must be a 4D tensor of shape `batch_size`, `point_batch_size`, `nb_points_per_image`, `2`.");for(let y=0;y<u.length;++y){const[v,T]=h[y],[O,E]=g[y],S=[E/T,O/v];for(let D=0;D<u[y].length;++D)for(let I=0;I<u[y][D].length;++I)for(let M=0;M<u[y][D][I].length;++M)u[y][D][I][M]*=S[M%2]}return new o.Tensor("float32",Float32Array.from(u.flat(1/0)),m)}add_input_labels(u,h){let g=(0,i.calculateDimensions)(u);if(g.length===2)g=[1,...g],u=[u];else if(g.length!==3)throw Error("The input_points must be a 4D tensor of shape `batch_size`, `point_batch_size`, `nb_points_per_image`, `2`.");if(g.some((p,m)=>p!==h.dims[m]))throw Error(`The first ${g.length} dimensions of 'input_points' and 'input_labels' must be the same.`);return new o.Tensor("int64",u.flat(1/0).map(BigInt),g)}async _call(u,{input_points:h=null,input_labels:g=null,input_boxes:p=null}={}){const m=await super._call(u);if(h&&(m.input_points=this.reshape_input_points(h,m.original_sizes,m.reshaped_input_sizes)),g){if(!m.input_points)throw Error("`input_points` must be provided if `input_labels` are provided.");m.input_labels=this.add_input_labels(g,m.input_points)}return p&&(m.input_boxes=this.reshape_input_points(p,m.original_sizes,m.reshaped_input_sizes,!0)),m}async post_process_masks(u,h,g,{mask_threshold:p=0,binarize:m=!0,pad_size:y=null}={}){const v=[];y=y??this.pad_size??this.size;const T=[y.height,y.width];for(let O=0;O<h.length;++O){const E=h[O],S=g[O];let D=await(0,o.interpolate_4d)(u[O],{mode:"bilinear",size:T});if(D=D.slice(null,null,[0,S[0]],[0,S[1]]),D=await(0,o.interpolate_4d)(D,{mode:"bilinear",size:E}),m){const I=D.data,M=new Uint8Array(I.length);for(let C=0;C<I.length;++C)I[C]>p&&(M[C]=1);D=new o.Tensor("bool",M,D.dims)}v.push(D)}return v}generate_crop_boxes(u,h,{crop_n_layers:g=0,overlap_ratio:p=512/1500,points_per_crop:m=32,crop_n_points_downscale_factor:y=1}={}){}}}),"./src/models/sam/processing_sam.js":((e,t,n)=>{n.r(t),n.d(t,{SamProcessor:()=>o});var s=n("./src/base/processing_utils.js"),i=n("./src/models/auto/image_processing_auto.js");class o extends s.Processor{async _call(...d){return await this.image_processor(...d)}post_process_masks(...d){return this.image_processor.post_process_masks(...d)}reshape_input_points(...d){return this.image_processor.reshape_input_points(...d)}}ge(o,"image_processor_class",i.AutoImageProcessor)}),"./src/models/sam2/image_processing_sam2.js":((e,t,n)=>{n.r(t),n.d(t,{Sam2ImageProcessor:()=>s.SamImageProcessor});var s=n("./src/models/sam/image_processing_sam.js")}),"./src/models/sam2/processing_sam2.js":((e,t,n)=>{n.r(t),n.d(t,{Sam2Processor:()=>i,Sam2VideoProcessor:()=>o});var s=n("./src/models/sam/processing_sam.js");class i extends s.SamProcessor{}class o extends i{}}),"./src/models/sam3/image_processing_sam3.js":((e,t,n)=>{n.r(t),n.d(t,{Sam3ImageProcessor:()=>s.Sam2ImageProcessor});var s=n("./src/models/sam2/image_processing_sam2.js")}),"./src/models/seamless_m4t/feature_extraction_seamless_m4t.js":((e,t,n)=>{n.r(t),n.d(t,{SeamlessM4TFeatureExtractor:()=>c});var s=n("./src/base/feature_extraction_utils.js"),i=n("./src/utils/tensor.js"),o=n("./src/utils/audio.js");class c extends s.FeatureExtractor{constructor(u){super(u);const h=this.config.sampling_rate,g=(0,o.mel_filter_bank)(257,this.config.num_mel_bins,20,Math.floor(h/2),h,null,"kaldi",!0);this.mel_filters=g,this.window=(0,o.window_function)(400,"povey",{periodic:!1})}async _extract_fbank_features(u,h){return u=u.map(g=>g*32768),(0,o.spectrogram)(u,this.window,400,160,{fft_length:512,power:2,center:!1,preemphasis:.97,mel_filters:this.mel_filters,log_mel:"log",mel_floor:1192092955078125e-22,remove_dc_offset:!0,max_num_frames:h,transpose:!0})}async _call(u,{padding:h=!0,pad_to_multiple_of:g=2,do_normalize_per_mel_bins:p=!0,return_attention_mask:m=!0}={}){(0,s.validate_audio_inputs)(u,"SeamlessM4TFeatureExtractor");let y=await this._extract_fbank_features(u,this.config.max_length);if(p){const[M,C]=y.dims,A=y.data;for(let k=0;k<C;++k){let R=0;for(let X=0;X<M;++X)R+=A[X*C+k];const G=R/M;let te=0;for(let X=0;X<M;++X)te+=(A[X*C+k]-G)**2;te/=M-1;const ee=Math.sqrt(te+1e-7);for(let X=0;X<M;++X){const le=X*C+k;A[le]=(A[le]-G)/ee}}}let v;if(h){const[M,C]=y.dims,A=y.data,k=M%g;if(k>0){const R=new Float32Array(C*(M+k));R.set(A),R.fill(this.config.padding_value,A.length);const G=M+k;y=new i.Tensor(y.type,R,[G,C]),m&&(v=new i.Tensor("int64",new BigInt64Array(G),[1,G]),v.data.fill(1n,0,M))}}const[T,O]=y.dims,E=this.config.stride;if(T%E!==0)throw new Error(`The number of frames (${T}) must be a multiple of the stride (${E}).`);const D=y.view(1,Math.floor(T/E),O*E),I={input_features:D};if(m){const M=D.dims[1],C=new BigInt64Array(M);if(v){const A=v.data;for(let k=1,R=0;k<T;k+=E,++R)C[R]=A[k]}else C.fill(1n);I.attention_mask=new i.Tensor("int64",C,[1,M])}return I}}}),"./src/models/segformer/image_processing_segformer.js":((e,t,n)=>{n.r(t),n.d(t,{SegformerFeatureExtractor:()=>o,SegformerImageProcessor:()=>i});var s=n("./src/base/image_processors_utils.js");class i extends s.ImageProcessor{post_process_semantic_segmentation(...d){return(0,s.post_process_semantic_segmentation)(...d)}}class o extends i{}}),"./src/models/siglip/image_processing_siglip.js":((e,t,n)=>{n.r(t),n.d(t,{SiglipImageProcessor:()=>i});var s=n("./src/base/image_processors_utils.js");class i extends s.ImageProcessor{}}),"./src/models/smolvlm/image_processing_smolvlm.js":((e,t,n)=>{n.r(t),n.d(t,{SmolVLMImageProcessor:()=>s.Idefics3ImageProcessor});var s=n("./src/models/idefics3/image_processing_idefics3.js")}),"./src/models/smolvlm/processing_smolvlm.js":((e,t,n)=>{n.r(t),n.d(t,{SmolVLMProcessor:()=>s.Idefics3Processor});var s=n("./src/models/idefics3/processing_idefics3.js")}),"./src/models/snac/feature_extraction_snac.js":((e,t,n)=>{n.r(t),n.d(t,{SnacFeatureExtractor:()=>i});var s=n("./src/models/dac/feature_extraction_dac.js");class i extends s.DacFeatureExtractor{}}),"./src/models/speecht5/feature_extraction_speecht5.js":((e,t,n)=>{n.r(t),n.d(t,{SpeechT5FeatureExtractor:()=>i});var s=n("./src/base/feature_extraction_utils.js");class i extends s.FeatureExtractor{}}),"./src/models/speecht5/processing_speecht5.js":((e,t,n)=>{n.r(t),n.d(t,{SpeechT5Processor:()=>c});var s=n("./src/base/processing_utils.js"),i=n("./src/tokenizers.js"),o=n("./src/models/auto/feature_extraction_auto.js");class c extends s.Processor{async _call(u){return await this.feature_extractor(u)}}ge(c,"tokenizer_class",i.AutoTokenizer),ge(c,"feature_extractor_class",o.AutoFeatureExtractor)}),"./src/models/swin2sr/image_processing_swin2sr.js":((e,t,n)=>{n.r(t),n.d(t,{Swin2SRImageProcessor:()=>i});var s=n("./src/base/image_processors_utils.js");class i extends s.ImageProcessor{pad_image(c,d,u,h={}){const[g,p,m]=d;return super.pad_image(c,d,{width:p+(u-p%u)%u,height:g+(u-g%u)%u},{mode:"symmetric",center:!1,constant_values:-1,...h})}}}),"./src/models/ultravox/processing_ultravox.js":((e,t,n)=>{n.r(t),n.d(t,{UltravoxProcessor:()=>c});var s=n("./src/models/auto/feature_extraction_auto.js"),i=n("./src/tokenizers.js"),o=n("./src/base/processing_utils.js");class c extends o.Processor{async _call(u,h=null,g={}){if(Array.isArray(u))throw new Error("Batched inputs are not supported yet.");let p={};if(h){const y=h.length,{input_features:v}=await this.feature_extractor(h,{...g,max_length:y}),T=Math.round(y/this.config.encoder_ds_factor+1e-4),O=1+Math.ceil(T/this.config.stack_factor);p.audio_token_len=[O],p.audio_values=v;const E=this.config.audio_placeholder;if(!u.includes(E))throw new Error(`The input text does not contain the image token ${E}.`);u=u.replaceAll(E,E.repeat(O))}return{...this.tokenizer(u,{add_special_tokens:!1,...g}),...p}}}ge(c,"tokenizer_class",i.AutoTokenizer),ge(c,"feature_extractor_class",s.AutoFeatureExtractor),ge(c,"uses_processor_config",!0)}),"./src/models/vit/image_processing_vit.js":((e,t,n)=>{n.r(t),n.d(t,{ViTFeatureExtractor:()=>o,ViTImageProcessor:()=>i});var s=n("./src/base/image_processors_utils.js");class i extends s.ImageProcessor{}class o extends i{}}),"./src/models/vitmatte/image_processing_vitmatte.js":((e,t,n)=>{n.r(t),n.d(t,{VitMatteImageProcessor:()=>o});var s=n("./src/base/image_processors_utils.js"),i=n("./src/utils/tensor.js");class o extends s.ImageProcessor{async _call(d,u){Array.isArray(d)||(d=[d]),Array.isArray(u)||(u=[u]);const h=await Promise.all(d.map(m=>this.preprocess(m))),g=await Promise.all(u.map(m=>this.preprocess(m,{do_normalize:!1,do_convert_rgb:!1,do_convert_grayscale:!0})));return{pixel_values:(0,i.stack)(h.map((m,y)=>(0,i.cat)([m.pixel_values,g[y].pixel_values],0)),0),original_sizes:h.map(m=>m.original_size),reshaped_input_sizes:h.map(m=>m.reshaped_input_size)}}}}),"./src/models/vitpose/image_processing_vitpose.js":((e,t,n)=>{n.r(t),n.d(t,{VitPoseImageProcessor:()=>i});var s=n("./src/base/image_processors_utils.js");class i extends s.ImageProcessor{post_process_pose_estimation(c,d,{threshold:u=null}={}){const h=c.tolist(),[g,p,m,y]=c.dims,v=[];for(let T=0;T<g;++T){const O=h[T],E=d[T],S=[];for(let D=0;D<E.length;++D){const I=E[D],M=[],C=[],A=[],k=I.at(-2)/y,R=I.at(-1)/m;for(let G=0;G<O.length;++G){let[te,ee]=[0,0],X=0,le=-1/0;const ae=O[G];for(let ne=0;ne<ae.length;++ne){const de=ae[ne];for(let ve=0;ve<de.length;++ve){const fe=de[ve];X+=fe,le=Math.max(le,fe),te+=(ve+.5)*fe,ee+=ne*fe}}if(u!=null&&le<u)continue;const Q=[k*te/X,R*ee/X];M.push(Q),A.push(G),C.push(le)}S.push({bbox:I,scores:C,labels:A,keypoints:M})}v.push(S)}return v}}}),"./src/models/voxtral/processing_voxtral.js":((e,t,n)=>{n.r(t),n.d(t,{VoxtralProcessor:()=>p});var s=n("./src/models/auto/feature_extraction_auto.js"),i=n("./src/tokenizers.js"),o=n("./src/base/processing_utils.js"),c=n("./src/utils/tensor.js");const d="[AUDIO]",u="[BEGIN_AUDIO]",h=375;function g(m,y){const v=[];for(let T=0;T<m.length;T+=y)v.push(m.subarray(T,Math.min(T+y,m.length)));return v}class p extends o.Processor{async _call(y,v=null,T={}){if(Array.isArray(y))throw new Error("Batched inputs are not supported yet.");const O={};if(v){if(!y.includes(d))throw new Error(`The input text does not contain the audio token ${d}.`);Array.isArray(v)||(v=[v]);const S=y.split(d),D=S.length-1;if(D!==v.length)throw new Error(`The number of audio inputs (${v.length}) does not match the number of audio tokens in the text (${D}).`);const I=this.feature_extractor.config.n_samples,M=v.map(G=>g(G,I)),C=M.map(G=>G.length),A=M.flat(),k=(await Promise.all(A.map(G=>this.feature_extractor(G,T)))).map(G=>G.input_features);O.audio_values=k.length>1?(0,c.cat)(k,0):k[0];let R=S[0];for(let G=0;G<C.length;++G){R+=u;for(let te=0;te<C[G];++te)R+=d.repeat(h);R+=S[G+1]}y=R}return{...this.tokenizer(y,{add_special_tokens:!1,...T}),...O}}}ge(p,"tokenizer_class",i.AutoTokenizer),ge(p,"feature_extractor_class",s.AutoFeatureExtractor),ge(p,"uses_processor_config",!1)}),"./src/models/wav2vec2/feature_extraction_wav2vec2.js":((e,t,n)=>{n.r(t),n.d(t,{Wav2Vec2FeatureExtractor:()=>o});var s=n("./src/base/feature_extraction_utils.js"),i=n("./src/utils/tensor.js");class o extends s.FeatureExtractor{_zero_mean_unit_var_norm(d){const h=d.reduce((p,m)=>p+m,0)/d.length,g=d.reduce((p,m)=>p+(m-h)**2,0)/d.length;return d.map(p=>(p-h)/Math.sqrt(g+1e-7))}async _call(d){(0,s.validate_audio_inputs)(d,"Wav2Vec2FeatureExtractor"),d instanceof Float64Array&&(d=new Float32Array(d));let u=d;this.config.do_normalize&&(u=this._zero_mean_unit_var_norm(u));const h=[1,u.length];return{input_values:new i.Tensor("float32",u,h),attention_mask:new i.Tensor("int64",new BigInt64Array(u.length).fill(1n),h)}}}}),"./src/models/wav2vec2/processing_wav2vec2.js":((e,t,n)=>{n.r(t),n.d(t,{Wav2Vec2Processor:()=>c});var s=n("./src/tokenizers.js"),i=n("./src/models/auto/feature_extraction_auto.js"),o=n("./src/base/processing_utils.js");class c extends o.Processor{async _call(u){return await this.feature_extractor(u)}}ge(c,"tokenizer_class",s.AutoTokenizer),ge(c,"feature_extractor_class",i.AutoFeatureExtractor)}),"./src/models/wav2vec2_with_lm/processing_wav2vec2_with_lm.js":((e,t,n)=>{n.r(t),n.d(t,{Wav2Vec2ProcessorWithLM:()=>c});var s=n("./src/tokenizers.js"),i=n("./src/models/auto/feature_extraction_auto.js"),o=n("./src/base/processing_utils.js");class c extends o.Processor{async _call(u){return await this.feature_extractor(u)}}ge(c,"tokenizer_class",s.AutoTokenizer),ge(c,"feature_extractor_class",i.AutoFeatureExtractor)}),"./src/models/wespeaker/feature_extraction_wespeaker.js":((e,t,n)=>{n.r(t),n.d(t,{WeSpeakerFeatureExtractor:()=>o});var s=n("./src/base/feature_extraction_utils.js");n("./src/utils/tensor.js");var i=n("./src/utils/audio.js");class o extends s.FeatureExtractor{constructor(d){super(d);const u=this.config.sampling_rate,h=(0,i.mel_filter_bank)(257,this.config.num_mel_bins,20,Math.floor(u/2),u,null,"kaldi",!0);this.mel_filters=h,this.window=(0,i.window_function)(400,"hamming",{periodic:!1}),this.min_num_frames=this.config.min_num_frames}async _extract_fbank_features(d){return d=d.map(u=>u*32768),(0,i.spectrogram)(d,this.window,400,160,{fft_length:512,power:2,center:!1,preemphasis:.97,mel_filters:this.mel_filters,log_mel:"log",mel_floor:1192092955078125e-22,remove_dc_offset:!0,transpose:!0,min_num_frames:this.min_num_frames})}async _call(d){(0,s.validate_audio_inputs)(d,"WeSpeakerFeatureExtractor");const u=(await this._extract_fbank_features(d)).unsqueeze_(0);if(this.config.fbank_centering_span===null){const h=u.mean(1).data,g=u.data,[p,m,y]=u.dims;for(let v=0;v<p;++v){const T=v*m*y,O=v*y;for(let E=0;E<m;++E){const S=T+E*y;for(let D=0;D<y;++D)g[S+D]-=h[O+D]}}}return{input_features:u}}}}),"./src/models/whisper/common_whisper.js":((e,t,n)=>{n.r(t),n.d(t,{WHISPER_LANGUAGE_MAPPING:()=>i,WHISPER_TO_LANGUAGE_CODE_MAPPING:()=>o,whisper_language_to_code:()=>c});const s=[["en","english"],["zh","chinese"],["de","german"],["es","spanish"],["ru","russian"],["ko","korean"],["fr","french"],["ja","japanese"],["pt","portuguese"],["tr","turkish"],["pl","polish"],["ca","catalan"],["nl","dutch"],["ar","arabic"],["sv","swedish"],["it","italian"],["id","indonesian"],["hi","hindi"],["fi","finnish"],["vi","vietnamese"],["he","hebrew"],["uk","ukrainian"],["el","greek"],["ms","malay"],["cs","czech"],["ro","romanian"],["da","danish"],["hu","hungarian"],["ta","tamil"],["no","norwegian"],["th","thai"],["ur","urdu"],["hr","croatian"],["bg","bulgarian"],["lt","lithuanian"],["la","latin"],["mi","maori"],["ml","malayalam"],["cy","welsh"],["sk","slovak"],["te","telugu"],["fa","persian"],["lv","latvian"],["bn","bengali"],["sr","serbian"],["az","azerbaijani"],["sl","slovenian"],["kn","kannada"],["et","estonian"],["mk","macedonian"],["br","breton"],["eu","basque"],["is","icelandic"],["hy","armenian"],["ne","nepali"],["mn","mongolian"],["bs","bosnian"],["kk","kazakh"],["sq","albanian"],["sw","swahili"],["gl","galician"],["mr","marathi"],["pa","punjabi"],["si","sinhala"],["km","khmer"],["sn","shona"],["yo","yoruba"],["so","somali"],["af","afrikaans"],["oc","occitan"],["ka","georgian"],["be","belarusian"],["tg","tajik"],["sd","sindhi"],["gu","gujarati"],["am","amharic"],["yi","yiddish"],["lo","lao"],["uz","uzbek"],["fo","faroese"],["ht","haitian creole"],["ps","pashto"],["tk","turkmen"],["nn","nynorsk"],["mt","maltese"],["sa","sanskrit"],["lb","luxembourgish"],["my","myanmar"],["bo","tibetan"],["tl","tagalog"],["mg","malagasy"],["as","assamese"],["tt","tatar"],["haw","hawaiian"],["ln","lingala"],["ha","hausa"],["ba","bashkir"],["jw","javanese"],["su","sundanese"]],i=new Map(s),o=new Map([...s.map(([d,u])=>[u,d]),["burmese","my"],["valencian","ca"],["flemish","nl"],["haitian","ht"],["letzeburgesch","lb"],["pushto","ps"],["panjabi","pa"],["moldavian","ro"],["moldovan","ro"],["sinhalese","si"],["castilian","es"]]);function c(d){d=d.toLowerCase();let u=o.get(d);if(u===void 0){const h=d.match(/^<\|([a-z]{2})\|>$/);if(h&&(d=h[1]),i.has(d))u=d;else{const p=d.length===2?i.keys():i.values();throw new Error(`Language "${d}" is not supported. Must be one of: ${JSON.stringify(Array.from(p))}`)}}return u}}),"./src/models/whisper/feature_extraction_whisper.js":((e,t,n)=>{n.r(t),n.d(t,{WhisperFeatureExtractor:()=>c});var s=n("./src/base/feature_extraction_utils.js");n("./src/utils/tensor.js");var i=n("./src/utils/audio.js"),o=n("./src/utils/maths.js");class c extends s.FeatureExtractor{constructor(u){var h;super(u),(h=this.config).mel_filters??(h.mel_filters=(0,i.mel_filter_bank)(Math.floor(1+this.config.n_fft/2),this.config.feature_size,0,8e3,this.config.sampling_rate,"slaney","slaney")),this.window=(0,i.window_function)(this.config.n_fft,"hann")}async _extract_fbank_features(u){const h=await(0,i.spectrogram)(u,this.window,this.config.n_fft,this.config.hop_length,{power:2,mel_filters:this.config.mel_filters,log_mel:"log10",max_num_frames:Math.min(Math.floor(u.length/this.config.hop_length),this.config.nb_max_frames)}),g=h.data,p=(0,o.max)(g)[0];for(let m=0;m<g.length;++m)g[m]=(Math.max(g[m],p-8)+4)/4;return h}async _call(u,{max_length:h=null}={}){(0,s.validate_audio_inputs)(u,"WhisperFeatureExtractor");let g;const p=h??this.config.n_samples;return u.length>p?(u.length>this.config.n_samples&&console.warn("Attempting to extract features for audio longer than 30 seconds. If using a pipeline to extract transcript from a long audio clip, remember to specify `chunk_length_s` and/or `stride_length_s`."),g=u.slice(0,p)):(g=new Float32Array(p),g.set(u)),{input_features:(await this._extract_fbank_features(g)).unsqueeze_(0)}}}}),"./src/models/whisper/generation_whisper.js":((e,t,n)=>{n.r(t),n.d(t,{WhisperGenerationConfig:()=>i});var s=n("./src/generation/configuration_utils.js");class i extends s.GenerationConfig{constructor(){super(...arguments);ge(this,"return_timestamps",null);ge(this,"return_token_timestamps",null);ge(this,"num_frames",null);ge(this,"alignment_heads",null);ge(this,"task",null);ge(this,"language",null);ge(this,"no_timestamps_token_id",null);ge(this,"prompt_ids",null);ge(this,"is_multilingual",null);ge(this,"lang_to_id",null);ge(this,"task_to_id",null);ge(this,"max_initial_timestamp_index",1)}}}),"./src/models/whisper/processing_whisper.js":((e,t,n)=>{n.r(t),n.d(t,{WhisperProcessor:()=>c});var s=n("./src/models/auto/feature_extraction_auto.js"),i=n("./src/tokenizers.js"),o=n("./src/base/processing_utils.js");class c extends o.Processor{async _call(u){return await this.feature_extractor(u)}}ge(c,"tokenizer_class",i.AutoTokenizer),ge(c,"feature_extractor_class",s.AutoFeatureExtractor)}),"./src/models/yolos/image_processing_yolos.js":((e,t,n)=>{n.r(t),n.d(t,{YolosFeatureExtractor:()=>o,YolosImageProcessor:()=>i});var s=n("./src/base/image_processors_utils.js");class i extends s.ImageProcessor{post_process_object_detection(...d){return(0,s.post_process_object_detection)(...d)}}class o extends i{}}),"./src/ops/registry.js":((e,t,n)=>{n.r(t),n.d(t,{TensorOpRegistry:()=>c});var s=n("./src/backends/onnx.js"),i=n("./src/utils/tensor.js");const o=async(d,u,h)=>{const g=await(0,s.createInferenceSession)(new Uint8Array(d),u);return(async p=>{const m=(0,s.isONNXProxy)(),y=Object.fromEntries(Object.entries(p).map(([T,O])=>[T,(m?O.clone():O).ort_tensor])),v=await(0,s.runInferenceSession)(g,y);return Array.isArray(h)?h.map(T=>new i.Tensor(v[T])):new i.Tensor(v[h])})};class c{static get nearest_interpolate_4d(){return this._nearest_interpolate_4d||(this._nearest_interpolate_4d=o([8,10,18,0,58,129,1,10,41,10,1,120,10,0,10,0,10,1,115,18,1,121,34,6,82,101,115,105,122,101,42,18,10,4,109,111,100,101,34,7,110,101,97,114,101,115,116,160,1,3,18,1,114,90,31,10,1,120,18,26,10,24,8,1,18,20,10,3,18,1,98,10,3,18,1,99,10,3,18,1,104,10,3,18,1,119,90,15,10,1,115,18,10,10,8,8,7,18,4,10,2,8,4,98,31,10,1,121,18,26,10,24,8,1,18,20,10,3,18,1,98,10,3,18,1,99,10,3,18,1,104,10,3,18,1,119,66,2,16,21],this.session_options,"y")),this._nearest_interpolate_4d}static get bilinear_interpolate_4d(){return this._bilinear_interpolate_4d||(this._bilinear_interpolate_4d=o([8,9,18,0,58,128,1,10,40,10,1,120,10,0,10,0,10,1,115,18,1,121,34,6,82,101,115,105,122,101,42,17,10,4,109,111,100,101,34,6,108,105,110,101,97,114,160,1,3,18,1,114,90,31,10,1,120,18,26,10,24,8,1,18,20,10,3,18,1,98,10,3,18,1,99,10,3,18,1,104,10,3,18,1,119,90,15,10,1,115,18,10,10,8,8,7,18,4,10,2,8,4,98,31,10,1,121,18,26,10,24,8,1,18,20,10,3,18,1,98,10,3,18,1,99,10,3,18,1,104,10,3,18,1,119,66,2,16,20],this.session_options,"y")),this._bilinear_interpolate_4d}static get bicubic_interpolate_4d(){return this._bicubic_interpolate_4d||(this._bicubic_interpolate_4d=o([8,9,18,0,58,127,10,39,10,1,120,10,0,10,0,10,1,115,18,1,121,34,6,82,101,115,105,122,101,42,16,10,4,109,111,100,101,34,5,99,117,98,105,99,160,1,3,18,1,114,90,31,10,1,120,18,26,10,24,8,1,18,20,10,3,18,1,98,10,3,18,1,99,10,3,18,1,104,10,3,18,1,119,90,15,10,1,115,18,10,10,8,8,7,18,4,10,2,8,4,98,31,10,1,121,18,26,10,24,8,1,18,20,10,3,18,1,98,10,3,18,1,99,10,3,18,1,104,10,3,18,1,119,66,2,16,20],this.session_options,"y")),this._bicubic_interpolate_4d}static get matmul(){return this._matmul||(this._matmul=o([8,9,18,0,58,55,10,17,10,1,97,10,1,98,18,1,99,34,6,77,97,116,77,117,108,18,1,114,90,9,10,1,97,18,4,10,2,8,1,90,9,10,1,98,18,4,10,2,8,1,98,9,10,1,99,18,4,10,2,8,1,66,2,16,20],this.session_options,"c")),this._matmul}static get stft(){return this._stft||(this._stft=o([8,7,18,0,58,148,1,10,38,10,1,115,10,1,106,10,1,119,10,1,108,18,1,111,34,4,83,84,70,84,42,15,10,8,111,110,101,115,105,100,101,100,24,1,160,1,2,18,1,115,90,26,10,1,115,18,21,10,19,8,1,18,15,10,3,18,1,98,10,3,18,1,115,10,3,18,1,99,90,11,10,1,106,18,6,10,4,8,7,18,0,90,16,10,1,119,18,11,10,9,8,1,18,5,10,3,18,1,119,90,11,10,1,108,18,6,10,4,8,7,18,0,98,31,10,1,111,18,26,10,24,8,1,18,20,10,3,18,1,98,10,3,18,1,102,10,3,18,1,100,10,3,18,1,99,66,2,16,17],this.session_options,"o")),this._stft}static get rfft(){return this._rfft||(this._rfft=o([8,9,18,0,58,97,10,33,10,1,120,10,0,10,1,97,18,1,121,34,3,68,70,84,42,15,10,8,111,110,101,115,105,100,101,100,24,1,160,1,2,18,1,100,90,21,10,1,120,18,16,10,14,8,1,18,10,10,3,18,1,115,10,3,18,1,99,90,11,10,1,97,18,6,10,4,8,7,18,0,98,21,10,1,121,18,16,10,14,8,1,18,10,10,3,18,1,115,10,3,18,1,99,66,2,16,20],this.session_options,"y")),this._rfft}static get top_k(){return this._top_k||(this._top_k=o([8,10,18,0,58,73,10,18,10,1,120,10,1,107,18,1,118,18,1,105,34,4,84,111,112,75,18,1,116,90,9,10,1,120,18,4,10,2,8,1,90,15,10,1,107,18,10,10,8,8,7,18,4,10,2,8,1,98,9,10,1,118,18,4,10,2,8,1,98,9,10,1,105,18,4,10,2,8,7,66,2,16,21],this.session_options,["v","i"])),this._top_k}static get slice(){return this._slice||(this._slice=o([8,7,18,0,58,96,10,25,10,1,120,10,1,115,10,1,101,10,1,97,10,1,116,18,1,121,34,5,83,108,105,99,101,18,1,114,90,9,10,1,120,18,4,10,2,8,1,90,9,10,1,115,18,4,10,2,8,7,90,9,10,1,101,18,4,10,2,8,7,90,9,10,1,97,18,4,10,2,8,7,90,9,10,1,116,18,4,10,2,8,7,98,9,10,1,121,18,4,10,2,8,1,66,2,16,13],this.session_options,"y")),this._slice}}ge(c,"session_options",{})}),"./src/pipelines.js":((e,t,n)=>{n.r(t),n.d(t,{AudioClassificationPipeline:()=>ee,AutomaticSpeechRecognitionPipeline:()=>le,BackgroundRemovalPipeline:()=>de,DepthEstimationPipeline:()=>ce,DocumentQuestionAnsweringPipeline:()=>U,FeatureExtractionPipeline:()=>G,FillMaskPipeline:()=>D,ImageClassificationPipeline:()=>Q,ImageFeatureExtractionPipeline:()=>te,ImageSegmentationPipeline:()=>ne,ImageToImagePipeline:()=>q,ImageToTextPipeline:()=>ae,ObjectDetectionPipeline:()=>fe,Pipeline:()=>T,QuestionAnsweringPipeline:()=>S,SummarizationPipeline:()=>M,Text2TextGenerationPipeline:()=>I,TextClassificationPipeline:()=>O,TextGenerationPipeline:()=>k,TextToAudioPipeline:()=>N,TokenClassificationPipeline:()=>E,TranslationPipeline:()=>C,ZeroShotAudioClassificationPipeline:()=>X,ZeroShotClassificationPipeline:()=>R,ZeroShotImageClassificationPipeline:()=>ve,ZeroShotObjectDetectionPipeline:()=>j,pipeline:()=>Pe});var s=n("./src/tokenizers.js"),i=n("./src/models.js"),o=n("./src/models/auto/processing_auto.js");n("./src/base/processing_utils.js");var c=n("./src/utils/generic.js"),d=n("./src/utils/core.js"),u=n("./src/utils/maths.js"),h=n("./src/utils/audio.js"),g=n("./src/utils/tensor.js"),p=n("./src/utils/image.js");async function m(Oe){return Array.isArray(Oe)||(Oe=[Oe]),await Promise.all(Oe.map(he=>p.RawImage.read(he)))}async function y(Oe,he){return Array.isArray(Oe)||(Oe=[Oe]),await Promise.all(Oe.map(H=>typeof H=="string"||H instanceof URL?(0,h.read_audio)(H,he):H instanceof Float64Array?new Float32Array(H):H))}function v(Oe,he){he&&(Oe=Oe.map(He=>He|0));const[H,Te,ze,Re]=Oe;return{xmin:H,ymin:Te,xmax:ze,ymax:Re}}class T extends c.Callable{constructor({task:he,model:H,tokenizer:Te=null,processor:ze=null}){super(),this.task=he,this.model=H,this.tokenizer=Te,this.processor=ze}async dispose(){await this.model.dispose()}}class O extends T{constructor(he){super(he)}async _call(he,{top_k:H=1}={}){const Te=this.tokenizer(he,{padding:!0,truncation:!0}),ze=await this.model(Te),Re=this.model.config.problem_type==="multi_label_classification"?Be=>Be.sigmoid():Be=>new g.Tensor("float32",(0,u.softmax)(Be.data),Be.dims),He=this.model.config.id2label,Ke=[];for(const Be of ze.logits){const nt=Re(Be),$e=await(0,g.topk)(nt,H),qe=$e[0].tolist(),Je=$e[1].tolist().map((pt,dt)=>({label:He?He[pt]:`LABEL_${pt}`,score:qe[dt]}));H===1?Ke.push(...Je):Ke.push(Je)}return Array.isArray(he)||H===1?Ke:Ke[0]}}class E extends T{constructor(he){super(he)}async _call(he,{ignore_labels:H=["O"]}={}){const Te=Array.isArray(he),ze=this.tokenizer(Te?he:[he],{padding:!0,truncation:!0}),He=(await this.model(ze)).logits,Ke=this.model.config.id2label,Be=[];for(let nt=0;nt<He.dims[0];++nt){const $e=ze.input_ids[nt],qe=He[nt],_t=[];for(let Je=0;Je<qe.dims[0];++Je){const pt=qe[Je],dt=(0,u.max)(pt.data)[1],Gt=Ke?Ke[dt]:`LABEL_${dt}`;if(H.includes(Gt))continue;const vt=this.tokenizer.decode([$e[Je].item()],{skip_special_tokens:!0});if(vt==="")continue;const Ze=(0,u.softmax)(pt.data);_t.push({entity:Gt,score:Ze[dt],index:Je,word:vt})}Be.push(_t)}return Te?Be:Be[0]}}class S extends T{constructor(he){super(he)}async _call(he,H,{top_k:Te=1}={}){const ze=this.tokenizer(he,{text_pair:H,padding:!0,truncation:!0}),{start_logits:Re,end_logits:He}=await this.model(ze),Ke=ze.input_ids.tolist(),Be=ze.attention_mask.tolist(),nt=this.tokenizer.all_special_ids,$e=[];for(let qe=0;qe<Re.dims[0];++qe){const _t=Ke[qe],Je=_t.findIndex(rt=>rt==this.tokenizer.sep_token_id);Be[qe].map((rt,kt)=>rt==1&&(kt===0||kt>Je&&nt.findIndex(Nt=>Nt==_t[kt])===-1));const pt=Re[qe].tolist(),dt=He[qe].tolist();for(let rt=1;rt<pt.length;++rt)(Be[qe]==0||rt<=Je||nt.findIndex(kt=>kt==_t[rt])!==-1)&&(pt[rt]=-1/0,dt[rt]=-1/0);const Gt=(0,u.softmax)(pt).map((rt,kt)=>[rt,kt]),vt=(0,u.softmax)(dt).map((rt,kt)=>[rt,kt]);Gt[0][0]=0,vt[0][0]=0;const Ze=(0,d.product)(Gt,vt).filter(rt=>rt[0][1]<=rt[1][1]).map(rt=>[rt[0][1],rt[1][1],rt[0][0]*rt[1][0]]).sort((rt,kt)=>kt[2]-rt[2]);for(let rt=0;rt<Math.min(Ze.length,Te);++rt){const[kt,Nt,gn]=Ze[rt],Jt=_t.slice(kt,Nt+1),Cn=this.tokenizer.decode(Jt,{skip_special_tokens:!0});$e.push({answer:Cn,score:gn})}}return Te===1?$e[0]:$e}}class D extends T{constructor(he){super(he)}async _call(he,{top_k:H=5}={}){const Te=this.tokenizer(he,{padding:!0,truncation:!0}),{logits:ze}=await this.model(Te),Re=[],He=Te.input_ids.tolist();for(let Ke=0;Ke<He.length;++Ke){const Be=He[Ke],nt=Be.findIndex(pt=>pt==this.tokenizer.mask_token_id);if(nt===-1)throw Error(`Mask token (${this.tokenizer.mask_token}) not found in text.`);const $e=ze[Ke][nt],qe=await(0,g.topk)(new g.Tensor("float32",(0,u.softmax)($e.data),$e.dims),H),_t=qe[0].tolist(),Je=qe[1].tolist();Re.push(Je.map((pt,dt)=>{const Gt=Be.slice();return Gt[nt]=pt,{score:_t[dt],token:Number(pt),token_str:this.tokenizer.decode([pt]),sequence:this.tokenizer.decode(Gt,{skip_special_tokens:!0})}}))}return Array.isArray(he)?Re:Re[0]}}class I extends T{constructor(H){super(H);ge(this,"_key","generated_text")}async _call(H,Te={}){Array.isArray(H)||(H=[H]),this.model.config.prefix&&(H=H.map(nt=>this.model.config.prefix+nt));const ze=this.model.config.task_specific_params;ze&&ze[this.task]&&ze[this.task].prefix&&(H=H.map(nt=>ze[this.task].prefix+nt));const Re=this.tokenizer,He={padding:!0,truncation:!0};let Ke;this instanceof C&&"_build_translation_inputs"in Re?Ke=Re._build_translation_inputs(H,He,Te):Ke=Re(H,He);const Be=await this.model.generate({...Ke,...Te});return Re.batch_decode(Be,{skip_special_tokens:!0}).map(nt=>({[this._key]:nt}))}}class M extends I{constructor(H){super(H);ge(this,"_key","summary_text")}}class C extends I{constructor(H){super(H);ge(this,"_key","translation_text")}}function A(Oe){return Array.isArray(Oe)&&Oe.every(he=>"role"in he&&"content"in he)}class k extends T{constructor(he){super(he)}async _call(he,H={}){let Te=!1,ze=!1,Re=H.add_special_tokens??(this.tokenizer.add_bos_token||this.tokenizer.add_eos_token)??!1,He;if(typeof he=="string")He=he=[he];else if(Array.isArray(he)&&he.every(Je=>typeof Je=="string"))Te=!0,He=he;else{if(A(he))he=[he];else if(Array.isArray(he)&&he.every(A))Te=!0;else throw new Error("Input must be a string, an array of strings, a Chat, or an array of Chats");ze=!0,He=he.map(Je=>this.tokenizer.apply_chat_template(Je,{tokenize:!1,add_generation_prompt:!0})),Re=!1}const Ke=ze?!1:H.return_full_text??!0;this.tokenizer.padding_side="left";const Be=this.tokenizer(He,{add_special_tokens:Re,padding:!0,truncation:!0}),nt=await this.model.generate({...Be,...H}),$e=this.tokenizer.batch_decode(nt,{skip_special_tokens:!0});let qe;!Ke&&Be.input_ids.dims.at(-1)>0&&(qe=this.tokenizer.batch_decode(Be.input_ids,{skip_special_tokens:!0}).map(Je=>Je.length));const _t=Array.from({length:he.length},Je=>[]);for(let Je=0;Je<$e.length;++Je){const pt=Math.floor(Je/nt.dims[0]*he.length);qe&&($e[Je]=$e[Je].slice(qe[pt])),_t[pt].push({generated_text:ze?[...he[pt],{role:"assistant",content:$e[Je]}]:$e[Je]})}return!Te&&_t.length===1?_t[0]:_t}}class R extends T{constructor(he){super(he),this.label2id=Object.fromEntries(Object.entries(this.model.config.label2id).map(([H,Te])=>[H.toLowerCase(),Te])),this.entailment_id=this.label2id.entailment,this.entailment_id===void 0&&(console.warn("Could not find 'entailment' in label2id mapping. Using 2 as entailment_id."),this.entailment_id=2),this.contradiction_id=this.label2id.contradiction??this.label2id.not_entailment,this.contradiction_id===void 0&&(console.warn("Could not find 'contradiction' in label2id mapping. Using 0 as contradiction_id."),this.contradiction_id=0)}async _call(he,H,{hypothesis_template:Te="This example is {}.",multi_label:ze=!1}={}){const Re=Array.isArray(he);Re||(he=[he]),Array.isArray(H)||(H=[H]);const He=H.map(nt=>Te.replace("{}",nt)),Ke=ze||H.length===1,Be=[];for(const nt of he){const $e=[];for(const Je of He){const pt=this.tokenizer(nt,{text_pair:Je,padding:!0,truncation:!0}),dt=await this.model(pt);Ke?$e.push([dt.logits.data[this.contradiction_id],dt.logits.data[this.entailment_id]]):$e.push(dt.logits.data[this.entailment_id])}const _t=(Ke?$e.map(Je=>(0,u.softmax)(Je)[1]):(0,u.softmax)($e)).map((Je,pt)=>[Je,pt]).sort((Je,pt)=>pt[0]-Je[0]);Be.push({sequence:nt,labels:_t.map(Je=>H[Je[1]]),scores:_t.map(Je=>Je[0])})}return Re?Be:Be[0]}}class G extends T{constructor(he){super(he)}async _call(he,{pooling:H="none",normalize:Te=!1,quantize:ze=!1,precision:Re="binary"}={}){const He=this.tokenizer(he,{padding:!0,truncation:!0}),Ke=await this.model(He);let Be=Ke.last_hidden_state??Ke.logits??Ke.token_embeddings;switch(H){case"none":break;case"mean":Be=(0,g.mean_pooling)(Be,He.attention_mask);break;case"first_token":case"cls":Be=Be.slice(null,0);break;case"last_token":case"eos":Be=Be.slice(null,-1);break;default:throw Error(`Pooling method '${H}' not supported.`)}return Te&&(Be=Be.normalize(2,-1)),ze&&(Be=(0,g.quantize_embeddings)(Be,Re)),Be}}class te extends T{constructor(he){super(he)}async _call(he,{pool:H=null}={}){const Te=await m(he),{pixel_values:ze}=await this.processor(Te),Re=await this.model({pixel_values:ze});let He;if(H){if(!("pooler_output"in Re))throw Error("No pooled output was returned. Make sure the model has a 'pooler' layer when using the 'pool' option.");He=Re.pooler_output}else He=Re.last_hidden_state??Re.logits??Re.image_embeds;return He}}class ee extends T{constructor(he){super(he)}async _call(he,{top_k:H=5}={}){const Te=this.processor.feature_extractor.config.sampling_rate,ze=await y(he,Te),Re=this.model.config.id2label,He=[];for(const Ke of ze){const Be=await this.processor(Ke),$e=(await this.model(Be)).logits[0],qe=await(0,g.topk)(new g.Tensor("float32",(0,u.softmax)($e.data),$e.dims),H),_t=qe[0].tolist(),pt=qe[1].tolist().map((dt,Gt)=>({label:Re?Re[dt]:`LABEL_${dt}`,score:_t[Gt]}));He.push(pt)}return Array.isArray(he)?He:He[0]}}class X extends T{constructor(he){super(he)}async _call(he,H,{hypothesis_template:Te="This is a sound of {}."}={}){const ze=!Array.isArray(he);ze&&(he=[he]);const Re=H.map($e=>Te.replace("{}",$e)),He=this.tokenizer(Re,{padding:!0,truncation:!0}),Ke=this.processor.feature_extractor.config.sampling_rate,Be=await y(he,Ke),nt=[];for(const $e of Be){const qe=await this.processor($e),_t=await this.model({...He,...qe}),Je=(0,u.softmax)(_t.logits_per_audio.data);nt.push([...Je].map((pt,dt)=>({score:pt,label:H[dt]})))}return ze?nt[0]:nt}}class le extends T{constructor(he){super(he)}async _call(he,H={}){switch(this.model.config.model_type){case"whisper":case"lite-whisper":return this._call_whisper(he,H);case"wav2vec2":case"wav2vec2-bert":case"unispeech":case"unispeech-sat":case"hubert":case"parakeet_ctc":return this._call_wav2vec2(he,H);case"moonshine":return this._call_moonshine(he,H);default:throw new Error(`AutomaticSpeechRecognitionPipeline does not support model type '${this.model.config.model_type}'.`)}}async _call_wav2vec2(he,H){H.language&&console.warn('`language` parameter is not yet supported for `wav2vec2` models, defaulting to "English".'),H.task&&console.warn('`task` parameter is not yet supported for `wav2vec2` models, defaulting to "transcribe".');const Te=!Array.isArray(he);Te&&(he=[he]);const ze=this.processor.feature_extractor.config.sampling_rate,Re=await y(he,ze),He=[];for(const Ke of Re){const Be=await this.processor(Ke),$e=(await this.model(Be)).logits[0],qe=[];for(const Je of $e)qe.push((0,u.max)(Je.data)[1]);const _t=this.tokenizer.decode(qe,{skip_special_tokens:!0}).trim();He.push({text:_t})}return Te?He[0]:He}async _call_whisper(he,H){const Te=H.return_timestamps??!1,ze=H.chunk_length_s??0,Re=H.force_full_sequences??!1;let He=H.stride_length_s??null;const Ke={...H};Te==="word"&&(Ke.return_token_timestamps=!0,Ke.return_timestamps=!1);const Be=!Array.isArray(he);Be&&(he=[he]);const nt=this.processor.feature_extractor.config.chunk_length/this.model.config.max_source_positions,$e=this.processor.feature_extractor.config.hop_length,qe=this.processor.feature_extractor.config.sampling_rate,_t=await y(he,qe),Je=[];for(const pt of _t){let dt=[];if(ze>0){if(He===null)He=ze/6;else if(ze<=He)throw Error("`chunk_length_s` must be larger than `stride_length_s`.");const Ze=qe*ze,rt=qe*He,kt=Ze-2*rt;let Nt=0;for(;;){const gn=Nt+Ze,Jt=pt.subarray(Nt,gn),Cn=await this.processor(Jt),Fn=Nt===0,tn=gn>=pt.length;if(dt.push({stride:[Jt.length,Fn?0:rt,tn?0:rt],input_features:Cn.input_features,is_last:tn}),tn)break;Nt+=kt}}else dt=[{stride:[pt.length,0,0],input_features:(await this.processor(pt)).input_features,is_last:!0}];for(const Ze of dt){Ke.num_frames=Math.floor(Ze.stride[0]/$e);const rt=await this.model.generate({inputs:Ze.input_features,...Ke});Te==="word"?(Ze.tokens=rt.sequences.tolist()[0],Ze.token_timestamps=rt.token_timestamps.tolist()[0].map(kt=>(0,u.round)(kt,2))):Ze.tokens=rt[0].tolist(),Ze.stride=Ze.stride.map(kt=>kt/qe)}const[Gt,vt]=this.tokenizer._decode_asr(dt,{time_precision:nt,return_timestamps:Te,force_full_sequences:Re});Je.push({text:Gt,...vt})}return Be?Je[0]:Je}async _call_moonshine(he,H){const Te=!Array.isArray(he);Te&&(he=[he]);const ze=this.processor.feature_extractor.config.sampling_rate,Re=await y(he,ze),He=[];for(const Ke of Re){const Be=await this.processor(Ke),nt=Math.floor(Ke.length/ze)*6,$e=await this.model.generate({max_new_tokens:nt,...H,...Be}),qe=this.processor.batch_decode($e,{skip_special_tokens:!0})[0];He.push({text:qe})}return Te?He[0]:He}}class ae extends T{constructor(he){super(he)}async _call(he,H={}){const Te=Array.isArray(he),ze=await m(he),{pixel_values:Re}=await this.processor(ze),He=[];for(const Ke of Re){Ke.dims=[1,...Ke.dims];const Be=await this.model.generate({inputs:Ke,...H}),nt=this.tokenizer.batch_decode(Be,{skip_special_tokens:!0}).map($e=>({generated_text:$e.trim()}));He.push(nt)}return Te?He:He[0]}}class Q extends T{constructor(he){super(he)}async _call(he,{top_k:H=5}={}){const Te=await m(he),{pixel_values:ze}=await this.processor(Te),Re=await this.model({pixel_values:ze}),He=this.model.config.id2label,Ke=[];for(const Be of Re.logits){const nt=await(0,g.topk)(new g.Tensor("float32",(0,u.softmax)(Be.data),Be.dims),H),$e=nt[0].tolist(),_t=nt[1].tolist().map((Je,pt)=>({label:He?He[Je]:`LABEL_${Je}`,score:$e[pt]}));Ke.push(_t)}return Array.isArray(he)?Ke:Ke[0]}}class ne extends T{constructor(he){super(he),this.subtasks_mapping={panoptic:"post_process_panoptic_segmentation",instance:"post_process_instance_segmentation",semantic:"post_process_semantic_segmentation"}}async _call(he,{threshold:H=.5,mask_threshold:Te=.5,overlap_mask_area_threshold:ze=.8,label_ids_to_fuse:Re=null,target_sizes:He=null,subtask:Ke=null}={}){if(Array.isArray(he)&&he.length!==1)throw Error("Image segmentation pipeline currently only supports a batch size of 1.");const nt=await m(he),$e=nt.map(Ze=>[Ze.height,Ze.width]),qe=await this.processor(nt),{inputNames:_t,outputNames:Je}=this.model.sessions.model;if(!_t.includes("pixel_values")){if(_t.length!==1)throw Error(`Expected a single input name, but got ${_t.length} inputs: ${_t}.`);const Ze=_t[0];if(Ze in qe)throw Error(`Input name ${Ze} already exists in the inputs.`);qe[Ze]=qe.pixel_values}const pt=await this.model(qe);let dt=null;if(Ke!==null)dt=this.subtasks_mapping[Ke];else if(this.processor.image_processor){for(const[Ze,rt]of Object.entries(this.subtasks_mapping))if(rt in this.processor.image_processor){dt=this.processor.image_processor[rt].bind(this.processor.image_processor),Ke=Ze;break}}const Gt=this.model.config.id2label,vt=[];if(Ke)if(Ke==="panoptic"||Ke==="instance"){const Ze=dt(pt,H,Te,ze,Re,He??$e)[0],rt=Ze.segmentation;for(const kt of Ze.segments_info){const Nt=new Uint8ClampedArray(rt.data.length);for(let Jt=0;Jt<rt.data.length;++Jt)rt.data[Jt]===kt.id&&(Nt[Jt]=255);const gn=new p.RawImage(Nt,rt.dims[1],rt.dims[0],1);vt.push({score:kt.score,label:Gt[kt.label_id],mask:gn})}}else if(Ke==="semantic"){const{segmentation:Ze,labels:rt}=dt(pt,He??$e)[0];for(const kt of rt){const Nt=new Uint8ClampedArray(Ze.data.length);for(let Jt=0;Jt<Ze.data.length;++Jt)Ze.data[Jt]===kt&&(Nt[Jt]=255);const gn=new p.RawImage(Nt,Ze.dims[1],Ze.dims[0],1);vt.push({score:null,label:Gt[kt],mask:gn})}}else throw Error(`Subtask ${Ke} not supported.`);else{const rt=pt[Je[0]];for(let kt=0;kt<$e.length;++kt){const Nt=$e[kt],gn=rt[kt];gn.data.some(Cn=>Cn<-1e-5||Cn>1+1e-5)&&gn.sigmoid_();const Jt=await p.RawImage.fromTensor(gn.mul_(255).to("uint8")).resize(Nt[1],Nt[0]);vt.push({label:null,score:null,mask:Jt})}}return vt}}class de extends ne{constructor(he){super(he)}async _call(he,H={}){if(Array.isArray(he)&&he.length!==1)throw Error("Background removal pipeline currently only supports a batch size of 1.");const ze=await m(he),Re=await super._call(he,H);return ze.map((Ke,Be)=>{const nt=Ke.clone();return nt.putAlpha(Re[Be].mask),nt})}}class ve extends T{constructor(he){super(he)}async _call(he,H,{hypothesis_template:Te="This is a photo of {}"}={}){const ze=Array.isArray(he),Re=await m(he),He=H.map(_t=>Te.replace("{}",_t)),Ke=this.tokenizer(He,{padding:this.model.config.model_type==="siglip"?"max_length":!0,truncation:!0}),{pixel_values:Be}=await this.processor(Re),nt=await this.model({...Ke,pixel_values:Be}),$e=this.model.config.model_type==="siglip"?_t=>_t.sigmoid().data:_t=>(0,u.softmax)(_t.data),qe=[];for(const _t of nt.logits_per_image){const pt=[...$e(_t)].map((dt,Gt)=>({score:dt,label:H[Gt]}));pt.sort((dt,Gt)=>Gt.score-dt.score),qe.push(pt)}return ze?qe:qe[0]}}class fe extends T{constructor(he){super(he)}async _call(he,{threshold:H=.9,percentage:Te=!1}={}){const ze=Array.isArray(he);if(ze&&he.length!==1)throw Error("Object detection pipeline currently only supports a batch size of 1.");const Re=await m(he),He=Te?null:Re.map(Je=>[Je.height,Je.width]),{pixel_values:Ke,pixel_mask:Be}=await this.processor(Re),nt=await this.model({pixel_values:Ke,pixel_mask:Be}),$e=this.processor.image_processor.post_process_object_detection(nt,H,He),qe=this.model.config.id2label,_t=$e.map(Je=>Je.boxes.map((pt,dt)=>({score:Je.scores[dt],label:qe[Je.classes[dt]],box:v(pt,!Te)})));return ze?_t:_t[0]}}class j extends T{constructor(he){super(he)}async _call(he,H,{threshold:Te=.1,top_k:ze=null,percentage:Re=!1}={}){const He=Array.isArray(he),Ke=await m(he),Be=this.tokenizer(H,{padding:!0,truncation:!0}),nt=await this.processor(Ke),$e=[];for(let qe=0;qe<Ke.length;++qe){const _t=Ke[qe],Je=Re?null:[[_t.height,_t.width]],pt=nt.pixel_values[qe].unsqueeze_(0),dt=await this.model({...Be,pixel_values:pt});let Gt;if("post_process_grounded_object_detection"in this.processor){const vt=this.processor.post_process_grounded_object_detection(dt,Be.input_ids,{box_threshold:Te,text_threshold:Te,target_sizes:Je})[0];Gt=vt.boxes.map((Ze,rt)=>({score:vt.scores[rt],label:vt.labels[rt],box:v(Ze,!Re)}))}else{const vt=this.processor.image_processor.post_process_object_detection(dt,Te,Je,!0)[0];Gt=vt.boxes.map((Ze,rt)=>({score:vt.scores[rt],label:H[vt.classes[rt]],box:v(Ze,!Re)}))}Gt.sort((vt,Ze)=>Ze.score-vt.score),ze!==null&&(Gt=Gt.slice(0,ze)),$e.push(Gt)}return He?$e:$e[0]}}class U extends T{constructor(he){super(he)}async _call(he,H,Te={}){const ze=(await m(he))[0],{pixel_values:Re}=await this.processor(ze),He=`<s_docvqa><s_question>${H}</s_question><s_answer>`,Ke=this.tokenizer(He,{add_special_tokens:!1,padding:!0,truncation:!0}).input_ids,Be=await this.model.generate({inputs:Re,max_length:this.model.config.decoder.max_position_embeddings,decoder_input_ids:Ke,...Te}),$e=this.tokenizer.batch_decode(Be)[0].match(/<s_answer>(.*?)<\/s_answer>/);let qe=null;return $e&&$e.length>=2&&(qe=$e[1].trim()),[{answer:qe}]}}class N extends T{constructor(H){super(H);ge(this,"DEFAULT_VOCODER_ID","Xenova/speecht5_hifigan");this.vocoder=H.vocoder??null}async _prepare_speaker_embeddings(H){if((typeof H=="string"||H instanceof URL)&&(H=new Float32Array(await(await fetch(H)).arrayBuffer())),H instanceof Float32Array)H=new g.Tensor("float32",H,[H.length]);else if(!(H instanceof g.Tensor))throw new Error("Speaker embeddings must be a `Tensor`, `Float32Array`, `string`, or `URL`.");return H}async _call(H,{speaker_embeddings:Te=null,num_inference_steps:ze,speed:Re}={}){return this.processor?this._call_text_to_spectrogram(H,{speaker_embeddings:Te}):this.model.config.model_type==="supertonic"?this._call_supertonic(H,{speaker_embeddings:Te,num_inference_steps:ze,speed:Re}):this._call_text_to_waveform(H)}async _call_supertonic(H,{speaker_embeddings:Te,num_inference_steps:ze,speed:Re}){if(!Te)throw new Error("Speaker embeddings must be provided for Supertonic models.");Te=await this._prepare_speaker_embeddings(Te);const{sampling_rate:He,style_dim:Ke}=this.model.config;Te=Te.view(1,-1,Ke);const Be=this.tokenizer(H,{padding:!0,truncation:!0}),{waveform:nt}=await this.model.generate_speech({...Be,style:Te,num_inference_steps:ze,speed:Re});return new h.RawAudio(nt.data,He)}async _call_text_to_waveform(H){const Te=this.tokenizer(H,{padding:!0,truncation:!0}),{waveform:ze}=await this.model(Te),Re=this.model.config.sampling_rate;return new h.RawAudio(ze.data,Re)}async _call_text_to_spectrogram(H,{speaker_embeddings:Te}){this.vocoder||(console.log("No vocoder specified, using default HifiGan vocoder."),this.vocoder=await i.AutoModel.from_pretrained(this.DEFAULT_VOCODER_ID,{dtype:"fp32"}));const{input_ids:ze}=this.tokenizer(H,{padding:!0,truncation:!0});Te=await this._prepare_speaker_embeddings(Te),Te=Te.view(1,-1);const{waveform:Re}=await this.model.generate_speech(ze,Te,{vocoder:this.vocoder}),He=this.processor.feature_extractor.config.sampling_rate;return new h.RawAudio(Re.data,He)}}class q extends T{constructor(he){super(he)}async _call(he){const H=await m(he),Te=await this.processor(H),ze=await this.model(Te),Re=[];for(const He of ze.reconstruction){const Ke=He.squeeze().clamp_(0,1).mul_(255).round_().to("uint8");Re.push(p.RawImage.fromTensor(Ke))}return Re.length>1?Re:Re[0]}}class ce extends T{constructor(he){super(he)}async _call(he){const H=await m(he),Te=await this.processor(H),{predicted_depth:ze}=await this.model(Te),Re=[];for(let He=0;He<H.length;++He){const Ke=ze[He],[Be,nt]=Ke.dims.slice(-2),[$e,qe]=H[He].size,_t=(await(0,g.interpolate_4d)(Ke.view(1,1,Be,nt),{size:[qe,$e],mode:"bilinear"})).view(qe,$e),Je=_t.min().item(),pt=_t.max().item(),dt=_t.sub(Je).div_(pt-Je).mul_(255).to("uint8").unsqueeze(0),Gt=p.RawImage.fromTensor(dt);Re.push({predicted_depth:_t,depth:Gt})}return Re.length>1?Re:Re[0]}}const Z=Object.freeze({"text-classification":{tokenizer:s.AutoTokenizer,pipeline:O,model:i.AutoModelForSequenceClassification,default:{model:"Xenova/distilbert-base-uncased-finetuned-sst-2-english"},type:"text"},"token-classification":{tokenizer:s.AutoTokenizer,pipeline:E,model:i.AutoModelForTokenClassification,default:{model:"Xenova/bert-base-multilingual-cased-ner-hrl"},type:"text"},"question-answering":{tokenizer:s.AutoTokenizer,pipeline:S,model:i.AutoModelForQuestionAnswering,default:{model:"Xenova/distilbert-base-cased-distilled-squad"},type:"text"},"fill-mask":{tokenizer:s.AutoTokenizer,pipeline:D,model:i.AutoModelForMaskedLM,default:{model:"Xenova/bert-base-uncased"},type:"text"},summarization:{tokenizer:s.AutoTokenizer,pipeline:M,model:i.AutoModelForSeq2SeqLM,default:{model:"Xenova/distilbart-cnn-6-6"},type:"text"},translation:{tokenizer:s.AutoTokenizer,pipeline:C,model:i.AutoModelForSeq2SeqLM,default:{model:"Xenova/t5-small"},type:"text"},"text2text-generation":{tokenizer:s.AutoTokenizer,pipeline:I,model:i.AutoModelForSeq2SeqLM,default:{model:"Xenova/flan-t5-small"},type:"text"},"text-generation":{tokenizer:s.AutoTokenizer,pipeline:k,model:i.AutoModelForCausalLM,default:{model:"Xenova/gpt2"},type:"text"},"zero-shot-classification":{tokenizer:s.AutoTokenizer,pipeline:R,model:i.AutoModelForSequenceClassification,default:{model:"Xenova/distilbert-base-uncased-mnli"},type:"text"},"audio-classification":{pipeline:ee,model:i.AutoModelForAudioClassification,processor:o.AutoProcessor,default:{model:"Xenova/wav2vec2-base-superb-ks"},type:"audio"},"zero-shot-audio-classification":{tokenizer:s.AutoTokenizer,pipeline:X,model:i.AutoModel,processor:o.AutoProcessor,default:{model:"Xenova/clap-htsat-unfused"},type:"multimodal"},"automatic-speech-recognition":{tokenizer:s.AutoTokenizer,pipeline:le,model:[i.AutoModelForSpeechSeq2Seq,i.AutoModelForCTC],processor:o.AutoProcessor,default:{model:"Xenova/whisper-tiny.en"},type:"multimodal"},"text-to-audio":{tokenizer:s.AutoTokenizer,pipeline:N,model:[i.AutoModelForTextToWaveform,i.AutoModelForTextToSpectrogram],processor:[o.AutoProcessor,null],default:{model:"Xenova/speecht5_tts"},type:"text"},"image-to-text":{tokenizer:s.AutoTokenizer,pipeline:ae,model:i.AutoModelForVision2Seq,processor:o.AutoProcessor,default:{model:"Xenova/vit-gpt2-image-captioning"},type:"multimodal"},"image-classification":{pipeline:Q,model:i.AutoModelForImageClassification,processor:o.AutoProcessor,default:{model:"Xenova/vit-base-patch16-224"},type:"multimodal"},"image-segmentation":{pipeline:ne,model:[i.AutoModelForImageSegmentation,i.AutoModelForSemanticSegmentation,i.AutoModelForUniversalSegmentation],processor:o.AutoProcessor,default:{model:"Xenova/detr-resnet-50-panoptic"},type:"multimodal"},"background-removal":{pipeline:de,model:[i.AutoModelForImageSegmentation,i.AutoModelForSemanticSegmentation,i.AutoModelForUniversalSegmentation],processor:o.AutoProcessor,default:{model:"Xenova/modnet"},type:"image"},"zero-shot-image-classification":{tokenizer:s.AutoTokenizer,pipeline:ve,model:i.AutoModel,processor:o.AutoProcessor,default:{model:"Xenova/clip-vit-base-patch32"},type:"multimodal"},"object-detection":{pipeline:fe,model:i.AutoModelForObjectDetection,processor:o.AutoProcessor,default:{model:"Xenova/detr-resnet-50"},type:"multimodal"},"zero-shot-object-detection":{tokenizer:s.AutoTokenizer,pipeline:j,model:i.AutoModelForZeroShotObjectDetection,processor:o.AutoProcessor,default:{model:"Xenova/owlvit-base-patch32"},type:"multimodal"},"document-question-answering":{tokenizer:s.AutoTokenizer,pipeline:U,model:i.AutoModelForDocumentQuestionAnswering,processor:o.AutoProcessor,default:{model:"Xenova/donut-base-finetuned-docvqa"},type:"multimodal"},"image-to-image":{pipeline:q,model:i.AutoModelForImageToImage,processor:o.AutoProcessor,default:{model:"Xenova/swin2SR-classical-sr-x2-64"},type:"image"},"depth-estimation":{pipeline:ce,model:i.AutoModelForDepthEstimation,processor:o.AutoProcessor,default:{model:"Xenova/dpt-large"},type:"image"},"feature-extraction":{tokenizer:s.AutoTokenizer,pipeline:G,model:i.AutoModel,default:{model:"Xenova/all-MiniLM-L6-v2"},type:"text"},"image-feature-extraction":{processor:o.AutoProcessor,pipeline:te,model:[i.AutoModelForImageFeatureExtraction,i.AutoModel],default:{model:"Xenova/vit-base-patch16-224-in21k"},type:"image"}}),Me=Object.freeze({"sentiment-analysis":"text-classification",ner:"token-classification",asr:"automatic-speech-recognition","text-to-speech":"text-to-audio",embeddings:"feature-extraction"});async function Pe(Oe,he=null,{progress_callback:H=null,config:Te=null,cache_dir:ze=null,local_files_only:Re=!1,revision:He="main",device:Ke=null,dtype:Be=null,subfolder:nt="onnx",use_external_data_format:$e=null,model_file_name:qe=null,session_options:_t={}}={}){Oe=Me[Oe]??Oe;const Je=Z[Oe.split("_",1)[0]];if(!Je)throw Error(`Unsupported pipeline: ${Oe}. Must be one of [${Object.keys(Z)}]`);he||(he=Je.default.model,console.log(`No model specified. Using default model: "${he}".`));const pt={progress_callback:H,config:Te,cache_dir:ze,local_files_only:Re,revision:He,device:Ke,dtype:Be,subfolder:nt,use_external_data_format:$e,model_file_name:qe,session_options:_t},dt=new Map([["tokenizer",Je.tokenizer],["model",Je.model],["processor",Je.processor]]),Gt=await Ne(dt,he,pt);Gt.task=Oe,(0,d.dispatchCallback)(H,{status:"ready",task:Oe,model:he});const vt=Je.pipeline;return new vt(Gt)}async function Ne(Oe,he,H){const Te=Object.create(null),ze=[];for(const[Re,He]of Oe.entries()){if(!He)continue;let Ke;Array.isArray(He)?Ke=new Promise(async(Be,nt)=>{var qe,_t;let $e;for(const Je of He){if(Je===null){Be(null);return}try{Be(await Je.from_pretrained(he,H));return}catch(pt){if((qe=pt.message)!=null&&qe.includes("Unsupported model type"))$e=pt;else if((_t=pt.message)!=null&&_t.includes("Could not locate file"))$e=pt;else{nt(pt);return}}}nt($e)}):Ke=He.from_pretrained(he,H),Te[Re]=Ke,ze.push(Ke)}await Promise.all(ze);for(const[Re,He]of Object.entries(Te))Te[Re]=await He;return Te}}),"./src/tokenizers.js":((e,t,n)=>{n.r(t),n.d(t,{AlbertTokenizer:()=>Ha,AutoTokenizer:()=>Pi,BartTokenizer:()=>ft,BertTokenizer:()=>ns,BlenderbotSmallTokenizer:()=>ut,BlenderbotTokenizer:()=>lt,BloomTokenizer:()=>xt,CLIPTokenizer:()=>Ka,CamembertTokenizer:()=>pe,CodeGenTokenizer:()=>qa,CodeLlamaTokenizer:()=>Gn,CohereTokenizer:()=>Fr,ConvBertTokenizer:()=>ue,DebertaTokenizer:()=>an,DebertaV2Tokenizer:()=>Qa,DistilBertTokenizer:()=>oe,ElectraTokenizer:()=>Ue,EsmTokenizer:()=>Tr,FalconTokenizer:()=>_a,GPT2Tokenizer:()=>ct,GPTNeoXTokenizer:()=>nr,GemmaTokenizer:()=>na,Grok1Tokenizer:()=>Pr,HerbertTokenizer:()=>L,LlamaTokenizer:()=>wn,M2M100Tokenizer:()=>wr,MBart50Tokenizer:()=>Et,MBartTokenizer:()=>Tt,MPNetTokenizer:()=>Ir,MarianTokenizer:()=>Ar,MgpstrTokenizer:()=>ps,MobileBertTokenizer:()=>Dn,NllbTokenizer:()=>mr,NougatTokenizer:()=>En,PreTrainedTokenizer:()=>Ft,Qwen2Tokenizer:()=>Bs,RoFormerTokenizer:()=>Y,RobertaTokenizer:()=>nn,SiglipTokenizer:()=>ra,SpeechT5Tokenizer:()=>At,SqueezeBertTokenizer:()=>Kr,T5Tokenizer:()=>Ye,TokenizerModel:()=>te,VitsTokenizer:()=>ni,Wav2Vec2CTCTokenizer:()=>ua,WhisperTokenizer:()=>hs,XLMRobertaTokenizer:()=>or,XLMTokenizer:()=>Ce,is_chinese_char:()=>D});var s=n("./src/utils/generic.js"),i=n("./src/utils/core.js"),o=n("./src/utils/hub.js"),c=n("./src/utils/maths.js"),d=n("./src/utils/tensor.js"),u=n("./src/utils/data-structures.js"),h=n("./node_modules/@huggingface/jinja/dist/index.js"),g=n("./src/models/whisper/common_whisper.js");async function p(Ie,V){const se=await Promise.all([(0,o.getModelJSON)(Ie,"tokenizer.json",!0,V),(0,o.getModelJSON)(Ie,"tokenizer_config.json",!0,V)]);return V.legacy!==null&&(se[1].legacy=V.legacy),se}function m(Ie,V){const se=[];let me=0;for(const be of Ie.matchAll(V)){const Se=be[0];me<be.index&&se.push(Ie.slice(me,be.index)),Se.length>0&&se.push(Se),me=be.index+Se.length}return me<Ie.length&&se.push(Ie.slice(me)),se}function y(Ie,V=!0){if(Ie.Regex!==void 0){let se=Ie.Regex.replace(/\\([#&~])/g,"$1");for(const[me,be]of R)se=se.replaceAll(me,be);return new RegExp(se,"gu")}else if(Ie.String!==void 0){const se=(0,i.escapeRegExp)(Ie.String);return new RegExp(V?se:`(${se})`,"gu")}else return console.warn("Unknown pattern type:",Ie),null}function v(Ie){return new Map(Object.entries(Ie))}function T(Ie){const V=Ie.dims;switch(V.length){case 1:return Ie.tolist();case 2:if(V[0]!==1)throw new Error("Unable to decode tensor with `batch size !== 1`. Use `tokenizer.batch_decode(...)` for batched inputs.");return Ie.tolist()[0];default:throw new Error(`Expected tensor to have 1-2 dimensions, got ${V.length}.`)}}function O(Ie){return Ie.replace(/ \./g,".").replace(/ \?/g,"?").replace(/ \!/g,"!").replace(/ ,/g,",").replace(/ \' /g,"'").replace(/ n\'t/g,"n't").replace(/ \'m/g,"'m").replace(/ \'s/g,"'s").replace(/ \'ve/g,"'ve").replace(/ \'re/g,"'re")}function E(Ie){return Ie.replace(new RegExp("\\p{M}","gu"),"")}function S(Ie){return E(Ie.toLowerCase())}function D(Ie){return Ie>=19968&&Ie<=40959||Ie>=13312&&Ie<=19903||Ie>=131072&&Ie<=173791||Ie>=173824&&Ie<=177983||Ie>=177984&&Ie<=178207||Ie>=178208&&Ie<=183983||Ie>=63744&&Ie<=64255||Ie>=194560&&Ie<=195103}function I(Ie,V,se){const me=[];let be=0;for(;be<Ie.length;){if(me.push(Ie[be]),(V.get(Ie[be])??se)!==se){++be;continue}for(;++be<Ie.length&&(V.get(Ie[be])??se)===se;)V.get(me.at(-1))!==se&&(me[me.length-1]+=Ie[be])}return me}function M(Ie){return Ie.match(/\S+/g)||[]}const C="\\p{P}\\u0021-\\u002F\\u003A-\\u0040\\u005B-\\u0060\\u007B-\\u007E",A=new RegExp(`^[${C}]+$`,"gu"),k=".,!?",R=new Map([["(?i:'s|'t|'re|'ve|'m|'ll|'d)","(?:'([sS]|[tT]|[rR][eE]|[vV][eE]|[mM]|[lL][lL]|[dD]))"],["(?i:[sdmt]|ll|ve|re)","(?:[sS]|[dD]|[mM]|[tT]|[lL][lL]|[vV][eE]|[rR][eE])"],["[^\\r\\n\\p{L}\\p{N}]?+","[^\\r\\n\\p{L}\\p{N}]?"],["[^\\s\\p{L}\\p{N}]++","[^\\s\\p{L}\\p{N}]+"],[` ?[^(\\s|[${k}])]+`,` ?[^\\s${k}]+`]]);class G{constructor(V){this.content=V.content,this.id=V.id,this.single_word=V.single_word??!1,this.lstrip=V.lstrip??!1,this.rstrip=V.rstrip??!1,this.special=V.special??!1,this.normalized=V.normalized??null}}class te extends s.Callable{constructor(V){super(),this.config=V,this.vocab=[],this.tokens_to_ids=new Map,this.unk_token_id=void 0,this.unk_token=void 0,this.end_of_word_suffix=void 0,this.fuse_unk=this.config.fuse_unk??!1}static fromConfig(V,...se){switch(V.type){case"WordPiece":return new ee(V);case"Unigram":return new X(V,...se);case"BPE":return new Q(V);default:if(V.vocab)return Array.isArray(V.vocab)?new X(V,...se):Object.hasOwn(V,"continuing_subword_prefix")&&Object.hasOwn(V,"unk_token")?Object.hasOwn(V,"merges")?new Q(V):new ee(V):new ne(V,...se);throw new Error(`Unknown TokenizerModel type: ${V.type}`)}}_call(V){return V=this.encode(V),this.fuse_unk&&(V=I(V,this.tokens_to_ids,this.unk_token_id)),V}encode(V){throw Error("encode should be implemented in subclass.")}convert_tokens_to_ids(V){return V.map(se=>this.tokens_to_ids.get(se)??this.unk_token_id)}convert_ids_to_tokens(V){return V.map(se=>this.vocab[se]??this.unk_token)}}class ee extends te{constructor(V){super(V),this.tokens_to_ids=v(V.vocab),this.unk_token_id=this.tokens_to_ids.get(V.unk_token),this.unk_token=V.unk_token,this.max_input_chars_per_word=V.max_input_chars_per_word??100,this.vocab=new Array(this.tokens_to_ids.size);for(const[se,me]of this.tokens_to_ids)this.vocab[me]=se}encode(V){const se=[];for(const me of V){const be=[...me];if(be.length>this.max_input_chars_per_word){se.push(this.unk_token);continue}let Se=!1,We=0;const ht=[];for(;We<be.length;){let bt=be.length,yt=null;for(;We<bt;){let Ct=be.slice(We,bt).join("");if(We>0&&(Ct=this.config.continuing_subword_prefix+Ct),this.tokens_to_ids.has(Ct)){yt=Ct;break}--bt}if(yt===null){Se=!0;break}ht.push(yt),We=bt}Se?se.push(this.unk_token):se.push(...ht)}return se}}class X extends te{constructor(V,se){super(V);const me=V.vocab.length;this.vocab=new Array(me),this.scores=new Array(me);for(let be=0;be<me;++be)[this.vocab[be],this.scores[be]]=V.vocab[be];this.unk_token_id=V.unk_id,this.unk_token=this.vocab[V.unk_id],this.tokens_to_ids=new Map(this.vocab.map((be,Se)=>[be,Se])),this.bos_token=" ",this.bos_token_id=this.tokens_to_ids.get(this.bos_token),this.eos_token=se.eos_token,this.eos_token_id=this.tokens_to_ids.get(this.eos_token),this.unk_token=this.vocab[this.unk_token_id],this.minScore=(0,c.min)(this.scores)[0],this.unk_score=this.minScore-10,this.scores[this.unk_token_id]=this.unk_score,this.trie=new u.CharTrie,this.trie.extend(this.vocab),this.fuse_unk=!0}populateNodes(V){const se=V.chars,me=1;let be=0;for(;be<se.length;){let Se=!1;const We=se.slice(be).join(""),ht=this.trie.commonPrefixSearch(We);for(const bt of ht){const yt=this.tokens_to_ids.get(bt),Ct=this.scores[yt],Vt=(0,i.len)(bt);V.insert(be,Vt,Ct,yt),!Se&&Vt===me&&(Se=!0)}Se||V.insert(be,me,this.unk_score,this.unk_token_id),be+=me}}tokenize(V){const se=new u.TokenLattice(V,this.bos_token_id,this.eos_token_id);return this.populateNodes(se),se.tokens()}encode(V){const se=[];for(const me of V){const be=this.tokenize(me);se.push(...be)}return se}}const le=(()=>{const Ie=[...Array.from({length:94},(be,Se)=>Se+33),...Array.from({length:12},(be,Se)=>Se+161),...Array.from({length:82},(be,Se)=>Se+174)],V=Ie.slice();let se=0;for(let be=0;be<256;++be)Ie.includes(be)||(Ie.push(be),V.push(256+se),se+=1);const me=V.map(be=>String.fromCharCode(be));return Object.fromEntries(Ie.map((be,Se)=>[be,me[Se]]))})(),ae=(0,i.reverseDictionary)(le);class Q extends te{constructor(V){super(V),this.tokens_to_ids=v(V.vocab),this.unk_token_id=this.tokens_to_ids.get(V.unk_token),this.unk_token=V.unk_token,this.vocab=new Array(this.tokens_to_ids.size);for(const[me,be]of this.tokens_to_ids)this.vocab[be]=me;const se=Array.isArray(V.merges[0]);this.merges=se?V.merges:V.merges.map(me=>me.split(" ",2)),this.bpe_ranks=new Map(this.merges.map((me,be)=>[JSON.stringify(me),be])),this.end_of_word_suffix=V.end_of_word_suffix,this.continuing_subword_suffix=V.continuing_subword_suffix??null,this.byte_fallback=this.config.byte_fallback??!1,this.byte_fallback&&(this.text_encoder=new TextEncoder),this.ignore_merges=this.config.ignore_merges??!1,this.max_length_to_cache=256,this.cache_capacity=1e4,this.cache=new u.LRUCache(this.cache_capacity)}clear_cache(){this.cache.clear()}bpe(V){if(V.length===0)return[];const se=this.cache.get(V);if(se!==void 0)return se;const me=Array.from(V);this.end_of_word_suffix&&(me[me.length-1]+=this.end_of_word_suffix);let be=[];if(me.length>1){const Se=new u.PriorityQueue((bt,yt)=>bt.score<yt.score);let We={token:me[0],bias:0,prev:null,next:null},ht=We;for(let bt=1;bt<me.length;++bt){const yt={bias:bt/me.length,token:me[bt],prev:ht,next:null};ht.next=yt,this._add_node(Se,ht),ht=yt}for(;!Se.isEmpty();){const bt=Se.pop();if(bt.deleted||!bt.next||bt.next.deleted)continue;if(bt.deleted=!0,bt.next.deleted=!0,bt.prev){const Ct={...bt.prev};bt.prev.deleted=!0,bt.prev=Ct,Ct.prev?Ct.prev.next=Ct:We=Ct}const yt={token:bt.token+bt.next.token,bias:bt.bias,prev:bt.prev,next:bt.next.next};yt.prev?(yt.prev.next=yt,this._add_node(Se,yt.prev)):We=yt,yt.next&&(yt.next.prev=yt,this._add_node(Se,yt))}for(let bt=We;bt!==null;bt=bt.next)be.push(bt.token)}else be=me;if(this.continuing_subword_suffix)for(let Se=0;Se<be.length-1;++Se)be[Se]+=this.continuing_subword_suffix;return V.length<this.max_length_to_cache&&this.cache.put(V,be),be}_add_node(V,se){const me=this.bpe_ranks.get(JSON.stringify([se.token,se.next.token]));me!==void 0&&(se.score=me+se.bias,V.push(se))}encode(V){const se=[];for(const me of V){if(this.ignore_merges&&this.tokens_to_ids.has(me)){se.push(me);continue}const be=this.bpe(me);for(const Se of be)if(this.tokens_to_ids.has(Se))se.push(Se);else if(this.byte_fallback){const We=Array.from(this.text_encoder.encode(Se)).map(ht=>`<0x${ht.toString(16).toUpperCase().padStart(2,"0")}>`);We.every(ht=>this.tokens_to_ids.has(ht))?se.push(...We):se.push(this.unk_token)}else se.push(this.unk_token)}return se}}class ne extends te{constructor(V,se){super(V),this.tokens_to_ids=v(se.target_lang?V.vocab[se.target_lang]:V.vocab),this.bos_token=se.bos_token,this.bos_token_id=this.tokens_to_ids.get(this.bos_token),this.eos_token=se.eos_token,this.eos_token_id=this.tokens_to_ids.get(this.eos_token),this.pad_token=se.pad_token,this.pad_token_id=this.tokens_to_ids.get(this.pad_token),this.unk_token=se.unk_token,this.unk_token_id=this.tokens_to_ids.get(this.unk_token),this.vocab=new Array(this.tokens_to_ids.size);for(const[me,be]of this.tokens_to_ids)this.vocab[be]=me}encode(V){return V}}class de extends s.Callable{constructor(V){super(),this.config=V}static fromConfig(V){if(V===null)return null;switch(V.type){case"BertNormalizer":return new Oe(V);case"Precompiled":return new tn(V);case"Sequence":return new Ne(V);case"Replace":return new ve(V);case"NFC":return new j(V);case"NFD":return new U(V);case"NFKC":return new N(V);case"NFKD":return new q(V);case"Strip":return new ce(V);case"StripAccents":return new Z(V);case"Lowercase":return new Me(V);case"Prepend":return new Pe(V);default:throw new Error(`Unknown Normalizer type: ${V.type}`)}}normalize(V){throw Error("normalize should be implemented in subclass.")}_call(V){return this.normalize(V)}}class ve extends de{normalize(V){const se=y(this.config.pattern);return se===null?V:V.replaceAll(se,this.config.content)}}class fe extends de{constructor(){super(...arguments);ge(this,"form")}normalize(se){return se=se.normalize(this.form),se}}class j extends fe{constructor(){super(...arguments);ge(this,"form","NFC")}}class U extends fe{constructor(){super(...arguments);ge(this,"form","NFD")}}class N extends fe{constructor(){super(...arguments);ge(this,"form","NFKC")}}class q extends fe{constructor(){super(...arguments);ge(this,"form","NFKD")}}class ce extends de{normalize(V){return this.config.strip_left&&this.config.strip_right?V=V.trim():(this.config.strip_left&&(V=V.trimStart()),this.config.strip_right&&(V=V.trimEnd())),V}}class Z extends de{normalize(V){return V=E(V),V}}class Me extends de{normalize(V){return V=V.toLowerCase(),V}}class Pe extends de{normalize(V){return V=this.config.prepend+V,V}}class Ne extends de{constructor(V){super(V),this.normalizers=V.normalizers.map(se=>de.fromConfig(se))}normalize(V){return this.normalizers.reduce((se,me)=>me.normalize(se),V)}}class Oe extends de{_tokenize_chinese_chars(V){const se=[];for(let me=0;me<V.length;++me){const be=V[me],Se=be.charCodeAt(0);D(Se)?(se.push(" "),se.push(be),se.push(" ")):se.push(be)}return se.join("")}stripAccents(V){return V.normalize("NFD").replace(new RegExp("\\p{Mn}","gu"),"")}_is_control(V){switch(V){case"	":case`
`:case"\r":return!1;default:return new RegExp("^\\p{Cc}|\\p{Cf}|\\p{Co}|\\p{Cs}$","u").test(V)}}_clean_text(V){const se=[];for(const me of V){const be=me.charCodeAt(0);be===0||be===65533||this._is_control(me)||(/^\s$/.test(me)?se.push(" "):se.push(me))}return se.join("")}normalize(V){return this.config.clean_text&&(V=this._clean_text(V)),this.config.handle_chinese_chars&&(V=this._tokenize_chinese_chars(V)),this.config.lowercase?(V=V.toLowerCase(),this.config.strip_accents!==!1&&(V=this.stripAccents(V))):this.config.strip_accents&&(V=this.stripAccents(V)),V}}class he extends s.Callable{static fromConfig(V){if(V===null)return null;switch(V.type){case"BertPreTokenizer":return new H(V);case"Sequence":return new ta(V);case"Whitespace":return new ds(V);case"WhitespaceSplit":return new fs(V);case"Metaspace":return new Cn(V);case"ByteLevel":return new Te(V);case"Split":return new ze(V);case"Punctuation":return new Re(V);case"Digits":return new He(V);case"Replace":return new Wa(V);case"FixedLength":return new Vn(V);default:throw new Error(`Unknown PreTokenizer type: ${V.type}`)}}pre_tokenize_text(V,se){throw Error("pre_tokenize_text should be implemented in subclass.")}pre_tokenize(V,se){return(Array.isArray(V)?V.map(me=>this.pre_tokenize_text(me,se)):this.pre_tokenize_text(V,se)).flat()}_call(V,se){return this.pre_tokenize(V,se)}}class H extends he{constructor(V){super(),this.pattern=new RegExp(`[^\\s${C}]+|[${C}]`,"gu")}pre_tokenize_text(V,se){return V.trim().match(this.pattern)||[]}}class Te extends he{constructor(V){super(),this.config=V,this.add_prefix_space=this.config.add_prefix_space,this.trim_offsets=this.config.trim_offsets,this.use_regex=this.config.use_regex??!0,this.pattern=new RegExp("'s|'t|'re|'ve|'m|'ll|'d| ?\\p{L}+| ?\\p{N}+| ?[^\\s\\p{L}\\p{N}]+|\\s+(?!\\S)|\\s+","gu"),this.byte_encoder=le,this.text_encoder=new TextEncoder}pre_tokenize_text(V,se){return this.add_prefix_space&&!V.startsWith(" ")&&(V=" "+V),(this.use_regex?V.match(this.pattern)||[]:[V]).map(be=>Array.from(this.text_encoder.encode(be),Se=>this.byte_encoder[Se]).join(""))}}class ze extends he{constructor(V){super(),this.config=V,this.pattern=y(this.config.pattern,this.config.invert)}pre_tokenize_text(V,se){var me;return this.pattern===null?[]:this.config.invert?V.match(this.pattern)||[]:((me=this.config.behavior)==null?void 0:me.toLowerCase())==="removed"?V.split(this.pattern).filter(be=>be):m(V,this.pattern)}}class Re extends he{constructor(V){super(),this.config=V,this.pattern=new RegExp(`[^${C}]+|[${C}]+`,"gu")}pre_tokenize_text(V,se){return V.match(this.pattern)||[]}}class He extends he{constructor(V){super(),this.config=V;const se=`[^\\d]+|\\d${this.config.individual_digits?"":"+"}`;this.pattern=new RegExp(se,"gu")}pre_tokenize_text(V,se){return V.match(this.pattern)||[]}}class Ke extends s.Callable{constructor(V){super(),this.config=V}static fromConfig(V){if(V===null)return null;switch(V.type){case"TemplateProcessing":return new $e(V);case"ByteLevel":return new qe(V);case"RobertaProcessing":return new nt(V);case"BertProcessing":return new Be(V);case"Sequence":return new _t(V);default:throw new Error(`Unknown PostProcessor type: ${V.type}`)}}post_process(V,...se){throw Error("post_process should be implemented in subclass.")}_call(V,...se){return this.post_process(V,...se)}}class Be extends Ke{constructor(V){super(V),this.cls=V.cls[0],this.sep=V.sep[0]}post_process(V,se=null,{add_special_tokens:me=!0}={}){me&&(V=(0,i.mergeArrays)([this.cls],V,[this.sep]));let be=new Array(V.length).fill(0);if(se!==null){const Se=me&&this instanceof nt?[this.sep]:[],We=me?[this.sep]:[];V=(0,i.mergeArrays)(V,Se,se,We),be=(0,i.mergeArrays)(be,new Array(se.length+Se.length+We.length).fill(1))}return{tokens:V,token_type_ids:be}}}class nt extends Be{}class $e extends Ke{constructor(V){super(V),this.single=V.single,this.pair=V.pair}post_process(V,se=null,{add_special_tokens:me=!0}={}){const be=se===null?this.single:this.pair;let Se=[],We=[];for(const ht of be)"SpecialToken"in ht?me&&(Se.push(ht.SpecialToken.id),We.push(ht.SpecialToken.type_id)):"Sequence"in ht&&(ht.Sequence.id==="A"?(Se=(0,i.mergeArrays)(Se,V),We=(0,i.mergeArrays)(We,new Array(V.length).fill(ht.Sequence.type_id))):ht.Sequence.id==="B"&&(Se=(0,i.mergeArrays)(Se,se),We=(0,i.mergeArrays)(We,new Array(se.length).fill(ht.Sequence.type_id))));return{tokens:Se,token_type_ids:We}}}class qe extends Ke{post_process(V,se=null){return se&&(V=(0,i.mergeArrays)(V,se)),{tokens:V}}}class _t extends Ke{constructor(V){super(V),this.processors=V.processors.map(se=>Ke.fromConfig(se))}post_process(V,se=null,me={}){let be;for(const Se of this.processors)if(Se instanceof qe)V=Se.post_process(V).tokens,se&&(se=Se.post_process(se).tokens);else{const We=Se.post_process(V,se,me);V=We.tokens,be=We.token_type_ids}return{tokens:V,token_type_ids:be}}}class Je extends s.Callable{constructor(V){super(),this.config=V,this.added_tokens=[],this.end_of_word_suffix=null,this.trim_offsets=V.trim_offsets}static fromConfig(V){if(V===null)return null;switch(V.type){case"WordPiece":return new Ze(V);case"Metaspace":return new Fn(V);case"ByteLevel":return new rt(V);case"Replace":return new pt(V);case"ByteFallback":return new dt(V);case"Fuse":return new Gt(V);case"Strip":return new vt(V);case"Sequence":return new Nt(V);case"CTC":return new kt(V);case"BPEDecoder":return new gn(V);default:throw new Error(`Unknown Decoder type: ${V.type}`)}}_call(V){return this.decode(V)}decode(V){return this.decode_chain(V).join("")}decode_chain(V){throw Error("`decode_chain` should be implemented in subclass.")}}class pt extends Je{decode_chain(V){const se=y(this.config.pattern);return se===null?V:V.map(me=>me.replaceAll(se,this.config.content))}}class dt extends Je{constructor(V){super(V),this.text_decoder=new TextDecoder}decode_chain(V){const se=[];let me=[];for(const be of V){let Se=null;if(be.length===6&&be.startsWith("<0x")&&be.endsWith(">")){const We=parseInt(be.slice(3,5),16);isNaN(We)||(Se=We)}if(Se!==null)me.push(Se);else{if(me.length>0){const We=this.text_decoder.decode(Uint8Array.from(me));se.push(We),me=[]}se.push(be)}}if(me.length>0){const be=this.text_decoder.decode(Uint8Array.from(me));se.push(be),me=[]}return se}}class Gt extends Je{decode_chain(V){return[V.join("")]}}class vt extends Je{constructor(V){super(V),this.content=this.config.content,this.start=this.config.start,this.stop=this.config.stop}decode_chain(V){return V.map(se=>{let me=0;for(let Se=0;Se<this.start&&se[Se]===this.content;++Se){me=Se+1;continue}let be=se.length;for(let Se=0;Se<this.stop;++Se){const We=se.length-Se-1;if(se[We]===this.content){be=We;continue}else break}return se.slice(me,be)})}}class Ze extends Je{constructor(V){super(V),this.cleanup=V.cleanup}decode_chain(V){return V.map((se,me)=>(me!==0&&(se.startsWith(this.config.prefix)?se=se.replace(this.config.prefix,""):se=" "+se),this.cleanup&&(se=O(se)),se))}}class rt extends Je{constructor(V){super(V),this.byte_decoder=ae,this.text_decoder=new TextDecoder("utf-8",{fatal:!1,ignoreBOM:!0}),this.end_of_word_suffix=null}convert_tokens_to_string(V){const se=V.join(""),me=new Uint8Array([...se].map(Se=>this.byte_decoder[Se]));return this.text_decoder.decode(me)}decode_chain(V){const se=[];let me=[];for(const be of V)this.added_tokens.find(Se=>Se.content===be)!==void 0?(me.length>0&&(se.push(this.convert_tokens_to_string(me)),me=[]),se.push(be)):me.push(be);return me.length>0&&se.push(this.convert_tokens_to_string(me)),se}}class kt extends Je{constructor(V){super(V),this.pad_token=this.config.pad_token,this.word_delimiter_token=this.config.word_delimiter_token,this.cleanup=this.config.cleanup}convert_tokens_to_string(V){if(V.length===0)return"";const se=[V[0]];for(let Se=1;Se<V.length;++Se)V[Se]!==se.at(-1)&&se.push(V[Se]);let be=se.filter(Se=>Se!==this.pad_token).join("");return this.cleanup&&(be=O(be).replaceAll(this.word_delimiter_token," ").trim()),be}decode_chain(V){return[this.convert_tokens_to_string(V)]}}class Nt extends Je{constructor(V){super(V),this.decoders=V.decoders.map(se=>Je.fromConfig(se))}decode_chain(V){return this.decoders.reduce((se,me)=>me.decode_chain(se),V)}}class gn extends Je{constructor(V){super(V),this.suffix=this.config.suffix}decode_chain(V){return V.map((se,me)=>se.replaceAll(this.suffix,me===V.length-1?"":" "))}}class Jt extends Je{decode_chain(V){let se="";for(let me=1;me<V.length;me+=2)se+=V[me];return[se]}}class Cn extends he{constructor(V){super(),this.replacement=V.replacement,this.strRep=V.str_rep||this.replacement,this.prepend_scheme=V.prepend_scheme??"always"}pre_tokenize_text(V,{section_index:se=void 0}={}){let me=V.replaceAll(" ",this.strRep);return!me.startsWith(this.replacement)&&(this.prepend_scheme==="always"||this.prepend_scheme==="first"&&se===0)&&(me=this.strRep+me),[me]}}class Fn extends Je{constructor(V){super(V),this.replacement=V.replacement}decode_chain(V){const se=[];for(let me=0;me<V.length;++me){let be=V[me].replaceAll(this.replacement," ");me==0&&be.startsWith(" ")&&(be=be.substring(1)),se.push(be)}return se}}class tn extends de{constructor(V){super(V),this.charsmap=V.precompiled_charsmap}normalize(V){return V=V.replace(/[\u0001-\u0008\u000B\u000E-\u001F\u007F\u008F\u009F]/gm,""),V=V.replace(/[\u0009\u000A\u000C\u000D\u00A0\u1680\u2000-\u200F\u2028\u2029\u202F\u205F\u2581\u3000\uFEFF\uFFFD]/gm," "),V.includes("")?V=V.split("").map(me=>me.normalize("NFKC")).join(""):V=V.normalize("NFKC"),V}}class ta extends he{constructor(V){super(),this.tokenizers=V.pretokenizers.map(se=>he.fromConfig(se))}pre_tokenize_text(V,se){return this.tokenizers.reduce((me,be)=>be.pre_tokenize(me,se),[V])}}class ds extends he{constructor(V){super()}pre_tokenize_text(V,se){return V.match(/\w+|[^\w\s]+/g)||[]}}class fs extends he{constructor(V){super()}pre_tokenize_text(V,se){return M(V)}}class Wa extends he{constructor(V){super(),this.config=V,this.pattern=y(this.config.pattern),this.content=this.config.content}pre_tokenize_text(V,se){return this.pattern===null?[V]:[V.replaceAll(this.pattern,this.config.content)]}}class Vn extends he{constructor(V){super(),this._length=V.length}pre_tokenize_text(V,se){const me=[];for(let be=0;be<V.length;be+=this._length)me.push(V.slice(be,be+this._length));return me}}const Er=["bos_token","eos_token","unk_token","sep_token","pad_token","cls_token","mask_token"];function qr(Ie,V,se,me){for(const be of Object.keys(Ie)){const Se=V-Ie[be].length,We=se(be),ht=new Array(Se).fill(We);Ie[be]=me==="right"?(0,i.mergeArrays)(Ie[be],ht):(0,i.mergeArrays)(ht,Ie[be])}}function Pa(Ie,V){for(const se of Object.keys(Ie))Ie[se].length=V}class Ft extends s.Callable{constructor(se,me){super();ge(this,"return_token_type_ids",!1);ge(this,"padding_side","right");this.config=me,this.normalizer=de.fromConfig(se.normalizer),this.pre_tokenizer=he.fromConfig(se.pre_tokenizer),this.model=te.fromConfig(se.model,me),this.post_processor=Ke.fromConfig(se.post_processor),this.decoder=Je.fromConfig(se.decoder),this.special_tokens=[],this.all_special_ids=[],this.added_tokens=[];for(const be of se.added_tokens){const Se=new G(be);this.added_tokens.push(Se),this.model.tokens_to_ids.set(Se.content,Se.id),this.model.vocab[Se.id]=Se.content,Se.special&&(this.special_tokens.push(Se.content),this.all_special_ids.push(Se.id))}if(this.additional_special_tokens=me.additional_special_tokens??[],this.special_tokens.push(...this.additional_special_tokens),this.special_tokens=[...new Set(this.special_tokens)],this.decoder&&(this.decoder.added_tokens=this.added_tokens,this.decoder.end_of_word_suffix=this.model.end_of_word_suffix),this.added_tokens_splitter=new u.DictionarySplitter(this.added_tokens.map(be=>be.content)),this.added_tokens_map=new Map(this.added_tokens.map(be=>[be.content,be])),this.mask_token=this.getToken("mask_token"),this.mask_token_id=this.model.tokens_to_ids.get(this.mask_token),this.pad_token=this.getToken("pad_token","eos_token"),this.pad_token_id=this.model.tokens_to_ids.get(this.pad_token),this.sep_token=this.getToken("sep_token"),this.sep_token_id=this.model.tokens_to_ids.get(this.sep_token),this.unk_token=this.getToken("unk_token"),this.unk_token_id=this.model.tokens_to_ids.get(this.unk_token),this.bos_token=this.getToken("bos_token"),this.bos_token_id=this.model.tokens_to_ids.get(this.bos_token),this.eos_token=this.getToken("eos_token"),this.eos_token_id=this.model.tokens_to_ids.get(this.eos_token),this.model_max_length=me.model_max_length,this.remove_space=me.remove_space,this.clean_up_tokenization_spaces=me.clean_up_tokenization_spaces??!0,this.do_lowercase_and_remove_accent=me.do_lowercase_and_remove_accent??!1,me.padding_side&&(this.padding_side=me.padding_side),this.add_bos_token=me.add_bos_token,this.add_eos_token=me.add_eos_token,this.legacy=!1,this.chat_template=me.chat_template??null,Array.isArray(this.chat_template)){const be=Object.create(null);for(const{name:Se,template:We}of this.chat_template){if(typeof Se!="string"||typeof We!="string")throw new Error('Chat template must be a list of objects with "name" and "template" properties');be[Se]=We}this.chat_template=be}this._compiled_template_cache=new Map}getToken(...se){for(const me of se){const be=this.config[me];if(be)if(typeof be=="object"){if(be.__type==="AddedToken")return be.content;throw Error(`Unknown token: ${be}`)}else return be}return null}static async from_pretrained(se,{progress_callback:me=null,config:be=null,cache_dir:Se=null,local_files_only:We=!1,revision:ht="main",legacy:bt=null}={}){const yt=await p(se,{progress_callback:me,config:be,cache_dir:Se,local_files_only:We,revision:ht,legacy:bt});return new this(...yt)}_call(se,{text_pair:me=null,add_special_tokens:be=!0,padding:Se=!1,truncation:We=null,max_length:ht=null,return_tensor:bt=!0,return_token_type_ids:yt=null}={}){const Ct=Array.isArray(se);let Vt;if(Ct){if(se.length===0)throw Error("text array must be non-empty");if(me!==null){if(Array.isArray(me)){if(se.length!==me.length)throw Error("text and text_pair must have the same length")}else throw Error("text_pair must also be an array");Vt=se.map((vn,Jn)=>this._encode_plus(vn,{text_pair:me[Jn],add_special_tokens:be,return_token_type_ids:yt}))}else Vt=se.map(vn=>this._encode_plus(vn,{add_special_tokens:be,return_token_type_ids:yt}))}else{if(se==null)throw Error("text may not be null or undefined");if(Array.isArray(me))throw Error("When specifying `text_pair`, since `text` is a string, `text_pair` must also be a string (i.e., not an array).");Vt=[this._encode_plus(se,{text_pair:me,add_special_tokens:be,return_token_type_ids:yt})]}if(ht===null?ht=this.model_max_length:We===null&&(Se===!0?(console.warn("`max_length` is ignored when `padding: true` and there is no truncation strategy. To pad to max length, use `padding: 'max_length'`."),ht=this.model_max_length):Se===!1&&(console.warn("Truncation was not explicitly activated but `max_length` is provided a specific value, please use `truncation: true` to explicitly truncate examples to max length."),We=!0)),Se===!0&&(ht=Math.min((0,c.max)(Vt.map(vn=>vn.input_ids.length))[0],ht??1/0)),ht=Math.min(ht,this.model_max_length??1/0),Se||We)for(let vn=0;vn<Vt.length;++vn)Vt[vn].input_ids.length!==ht&&(Vt[vn].input_ids.length>ht?We&&Pa(Vt[vn],ht):Se&&qr(Vt[vn],ht,Jn=>Jn==="input_ids"?this.pad_token_id:0,this.padding_side));const un={};if(bt){if(!(Se&&We)&&Vt.some(Jn=>{var Tn;for(const lr of Object.keys(Jn))if(Jn[lr].length!==((Tn=Vt[0][lr])==null?void 0:Tn.length))return!0;return!1}))throw Error("Unable to create tensor, you should probably activate truncation and/or padding with 'padding=true' and 'truncation=true' to have batched tensors with the same length.");const vn=[Vt.length,Vt[0].input_ids.length];for(const Jn of Object.keys(Vt[0]))un[Jn]=new d.Tensor("int64",BigInt64Array.from(Vt.flatMap(Tn=>Tn[Jn]).map(BigInt)),vn)}else{for(const vn of Object.keys(Vt[0]))un[vn]=Vt.map(Jn=>Jn[vn]);if(!Ct)for(const vn of Object.keys(un))un[vn]=un[vn][0]}return un}_encode_text(se){if(se===null)return null;const me=this.added_tokens_splitter.split(se);for(let Se=0;Se<me.length;++Se){const We=this.added_tokens_map.get(me[Se]);We&&(We.lstrip&&Se>0&&(me[Se-1]=me[Se-1].trimEnd()),We.rstrip&&Se<me.length-1&&(me[Se+1]=me[Se+1].trimStart()))}return me.flatMap((Se,We)=>{if(Se.length===0)return[];if(this.added_tokens_map.has(Se))return[Se];if(this.remove_space===!0&&(Se=Se.trim().split(/\s+/).join(" ")),this.do_lowercase_and_remove_accent&&(Se=S(Se)),this.normalizer!==null&&(Se=this.normalizer(Se)),Se.length===0)return[];const ht=this.pre_tokenizer!==null?this.pre_tokenizer(Se,{section_index:We}):[Se];return this.model(ht)})}_encode_plus(se,{text_pair:me=null,add_special_tokens:be=!0,return_token_type_ids:Se=null}={}){const{tokens:We,token_type_ids:ht}=this._tokenize_helper(se,{pair:me,add_special_tokens:be}),bt=this.model.convert_tokens_to_ids(We),yt={input_ids:bt,attention_mask:new Array(bt.length).fill(1)};return(Se??this.return_token_type_ids)&&ht&&(yt.token_type_ids=ht),yt}_tokenize_helper(se,{pair:me=null,add_special_tokens:be=!1}={}){const Se=this._encode_text(se),We=this._encode_text(me);return this.post_processor?this.post_processor(Se,We,{add_special_tokens:be}):{tokens:(0,i.mergeArrays)(Se??[],We??[])}}tokenize(se,{pair:me=null,add_special_tokens:be=!1}={}){return this._tokenize_helper(se,{pair:me,add_special_tokens:be}).tokens}encode(se,{text_pair:me=null,add_special_tokens:be=!0,return_token_type_ids:Se=null}={}){return this._encode_plus(se,{text_pair:me,add_special_tokens:be,return_token_type_ids:Se}).input_ids}batch_decode(se,me={}){return se instanceof d.Tensor&&(se=se.tolist()),se.map(be=>this.decode(be,me))}decode(se,me={}){if(se instanceof d.Tensor&&(se=T(se)),!Array.isArray(se)||se.length===0||!(0,i.isIntegralNumber)(se[0]))throw Error("token_ids must be a non-empty array of integers.");return this.decode_single(se,me)}decode_single(se,{skip_special_tokens:me=!1,clean_up_tokenization_spaces:be=null}){let Se=this.model.convert_ids_to_tokens(se);me&&(Se=Se.filter(ht=>!this.special_tokens.includes(ht)));let We=this.decoder?this.decoder(Se):Se.join(" ");return this.decoder&&this.decoder.end_of_word_suffix&&(We=We.replaceAll(this.decoder.end_of_word_suffix," "),me&&(We=We.trim())),(be??this.clean_up_tokenization_spaces)&&(We=O(We)),We}get_chat_template({chat_template:se=null,tools:me=null}={}){if(this.chat_template&&typeof this.chat_template=="object"){const be=this.chat_template;if(se!==null&&Object.hasOwn(be,se))se=be[se];else if(se===null)if(me!==null&&"tool_use"in be)se=be.tool_use;else if("default"in be)se=be.default;else throw Error(`This model has multiple chat templates with no default specified! Please either pass a chat template or the name of the template you wish to use to the 'chat_template' argument. Available template names are ${Object.keys(be).sort()}.`)}else if(se===null)if(this.chat_template)se=this.chat_template;else throw Error("Cannot use apply_chat_template() because tokenizer.chat_template is not set and no template argument was passed! For information about writing templates and setting the tokenizer.chat_template attribute, please see the documentation at https://huggingface.co/docs/transformers/main/en/chat_templating");return se}apply_chat_template(se,{tools:me=null,documents:be=null,chat_template:Se=null,add_generation_prompt:We=!1,tokenize:ht=!0,padding:bt=!1,truncation:yt=!1,max_length:Ct=null,return_tensor:Vt=!0,return_dict:un=!1,tokenizer_kwargs:vn={},...Jn}={}){if(Se=this.get_chat_template({chat_template:Se,tools:me}),typeof Se!="string")throw Error(`chat_template must be a string, but got ${typeof Se}`);let Tn=this._compiled_template_cache.get(Se);Tn===void 0&&(Tn=new h.Template(Se),this._compiled_template_cache.set(Se,Tn));const lr=Object.create(null);for(const gr of Er){const Dr=this.getToken(gr);Dr&&(lr[gr]=Dr)}const kr=Tn.render({messages:se,add_generation_prompt:We,tools:me,documents:be,...lr,...Jn});if(ht){const gr=this._call(kr,{add_special_tokens:!1,padding:bt,truncation:yt,max_length:Ct,return_tensor:Vt,...vn});return un?gr:gr.input_ids}return kr}}class ns extends Ft{constructor(){super(...arguments);ge(this,"return_token_type_ids",!0)}}class Ha extends Ft{constructor(){super(...arguments);ge(this,"return_token_type_ids",!0)}}class Dn extends Ft{constructor(){super(...arguments);ge(this,"return_token_type_ids",!0)}}class Kr extends Ft{constructor(){super(...arguments);ge(this,"return_token_type_ids",!0)}}class an extends Ft{constructor(){super(...arguments);ge(this,"return_token_type_ids",!0)}}class Qa extends Ft{constructor(){super(...arguments);ge(this,"return_token_type_ids",!0)}}class L extends Ft{constructor(){super(...arguments);ge(this,"return_token_type_ids",!0)}}class ue extends Ft{constructor(){super(...arguments);ge(this,"return_token_type_ids",!0)}}class Y extends Ft{constructor(){super(...arguments);ge(this,"return_token_type_ids",!0)}}class oe extends Ft{}class pe extends Ft{}class Ce extends Ft{constructor(se,me){super(se,me);ge(this,"return_token_type_ids",!0);console.warn('WARNING: `XLMTokenizer` is not yet supported by Hugging Face\'s "fast" tokenizers library. Therefore, you may experience slightly inaccurate results.')}}class Ue extends Ft{constructor(){super(...arguments);ge(this,"return_token_type_ids",!0)}}class Ye extends Ft{}class ct extends Ft{}class ft extends Ft{}class Tt extends Ft{constructor(V,se){super(V,se),this.languageRegex=/^[a-z]{2}_[A-Z]{2}$/,this.language_codes=this.special_tokens.filter(me=>this.languageRegex.test(me)),this.lang_to_token=me=>me}_build_translation_inputs(V,se,me){return xa(this,V,se,me)}}class Et extends Tt{}class nn extends Ft{}class xt extends Ft{}const Zt="";class wn extends Ft{constructor(se,me){super(se,me);ge(this,"padding_side","left");this.legacy=me.legacy??!0,this.legacy||(this.normalizer=null,this.pre_tokenizer=new Cn({replacement:Zt,prepend_scheme:"first"}))}_encode_text(se){if(se===null)return null;if(this.legacy||se.length===0)return super._encode_text(se);let me=super._encode_text(Zt+se.replaceAll(Zt," "));return me.length>1&&me[0]===Zt&&this.special_tokens.includes(me[1])&&(me=me.slice(1)),me}}class Gn extends Ft{}class or extends Ft{}class Ir extends Ft{}class _a extends Ft{}class nr extends Ft{}class Tr extends Ft{}class Bs extends Ft{}class na extends Ft{}class Pr extends Ft{}function xa(Ie,V,se,me){if(!("language_codes"in Ie)||!Array.isArray(Ie.language_codes))throw new Error("Tokenizer must have `language_codes` attribute set and it should be an array of language ids.");if(!("languageRegex"in Ie)||!(Ie.languageRegex instanceof RegExp))throw new Error("Tokenizer must have `languageRegex` attribute set and it should be a regular expression.");if(!("lang_to_token"in Ie)||typeof Ie.lang_to_token!="function")throw new Error("Tokenizer must have `lang_to_token` attribute set and it should be a function.");const be=me.src_lang,Se=me.tgt_lang;if(!Ie.language_codes.includes(Se))throw new Error(`Target language code "${Se}" is not valid. Must be one of: {${Ie.language_codes.join(", ")}}`);if(be!==void 0){if(!Ie.language_codes.includes(be))throw new Error(`Source language code "${be}" is not valid. Must be one of: {${Ie.language_codes.join(", ")}}`);for(const We of Ie.post_processor.config.single)if("SpecialToken"in We&&Ie.languageRegex.test(We.SpecialToken.id)){We.SpecialToken.id=Ie.lang_to_token(be);break}}return me.forced_bos_token_id=Ie.model.convert_tokens_to_ids([Ie.lang_to_token(Se)])[0],Ie._call(V,se)}class mr extends Ft{constructor(V,se){super(V,se),this.languageRegex=/^[a-z]{3}_[A-Z][a-z]{3}$/,this.language_codes=this.special_tokens.filter(me=>this.languageRegex.test(me)),this.lang_to_token=me=>me}_build_translation_inputs(V,se,me){return xa(this,V,se,me)}}class wr extends Ft{constructor(V,se){super(V,se),this.languageRegex=/^__[a-z]{2,3}__$/,this.language_codes=this.special_tokens.filter(me=>this.languageRegex.test(me)).map(me=>me.slice(2,-2)),this.lang_to_token=me=>`__${me}__`}_build_translation_inputs(V,se,me){return xa(this,V,se,me)}}class hs extends Ft{get timestamp_begin(){return this.model.convert_tokens_to_ids(["<|notimestamps|>"])[0]+1}_decode_asr(V,{return_timestamps:se=!1,return_language:me=!1,time_precision:be=null,force_full_sequences:Se=!0}={}){if(be===null)throw Error("Must specify time_precision");let We=null;const ht=se==="word";function bt(){return{language:We,timestamp:[null,null],text:""}}const yt=[];let Ct=bt(),Vt=0;const un=this.timestamp_begin,Jn=un+1500;let Tn=[],lr=[],kr=!1,gr=null;const Dr=new Set(this.all_special_ids);for(const Wn of V){const _r=Wn.tokens,cr=ht?Wn.token_timestamps:null;let va=null,ka=un;if("stride"in Wn){const[rr,xr,Sn]=Wn.stride;if(Vt-=xr,gr=rr-Sn,xr&&(ka=xr/be+un),Sn)for(let On=_r.length-1;On>=0;--On){const aa=Number(_r[On]);if(aa>=un){if(va!==null&&(aa-un)*be<gr)break;va=aa}}}let Xr=[],Ea=[];for(let rr=0;rr<_r.length;++rr){const xr=Number(_r[rr]);if(Dr.has(xr)){const Sn=this.decode([xr]),On=g.WHISPER_LANGUAGE_MAPPING.get(Sn.slice(2,-2));if(On!==void 0){if(We!==null&&On!==We&&!se){Tn.push(Xr);const aa=this.findLongestCommonSequence(Tn)[0],Xa=this.decode(aa);Ct.text=Xa,yt.push(Ct),Tn=[],Xr=[],Ct=bt()}We=Ct.language=On}}else if(xr>=un&&xr<=Jn){const Sn=(xr-un)*be+Vt,On=(0,c.round)(Sn,2);if(va!==null&&xr>=va)kr=!0;else if(kr||Tn.length>0&&xr<ka)kr=!1;else if(Ct.timestamp[0]===null)Ct.timestamp[0]=On;else if(On!==Ct.timestamp[0]){Ct.timestamp[1]=On,Tn.push(Xr),ht&&lr.push(Ea);const[aa,Xa]=this.findLongestCommonSequence(Tn,lr),Ls=this.decode(aa);Ct.text=Ls,ht&&(Ct.words=this.collateWordTimestamps(aa,Xa,We)),yt.push(Ct),Tn=[],Xr=[],lr=[],Ea=[],Ct=bt()}}else if(Xr.push(xr),ht){let Sn=(0,c.round)(cr[rr]+Vt,2),On;if(rr+1<cr.length){On=(0,c.round)(cr[rr+1]+Vt,2);const aa=this.decode([xr]);A.test(aa)&&(On=(0,c.round)(Math.min(Sn+be,On),2))}else On=null;Ea.push([Sn,On])}}if("stride"in Wn){const[rr,xr,Sn]=Wn.stride;Vt+=rr-Sn}Xr.length>0?(Tn.push(Xr),ht&&lr.push(Ea)):Tn.every(rr=>rr.length===0)&&(Ct=bt(),Tn=[],Xr=[],lr=[],Ea=[])}if(Tn.length>0){if(Se&&se)throw new Error("Whisper did not predict an ending timestamp, which can happen if audio is cut off in the middle of a word. Also make sure WhisperTimeStampLogitsProcessor was used during generation.");const[Wn,_r]=this.findLongestCommonSequence(Tn,lr),cr=this.decode(Wn);Ct.text=cr,ht&&(Ct.words=this.collateWordTimestamps(Wn,_r,We)),yt.push(Ct)}let Mr=Object.create(null);const zr=yt.map(Wn=>Wn.text).join("");if(se||me){for(let Wn=0;Wn<yt.length;++Wn){const _r=yt[Wn];se||delete _r.timestamp,me||delete _r.language}if(ht){const Wn=[];for(const _r of yt)for(const cr of _r.words)Wn.push(cr);Mr={chunks:Wn}}else Mr={chunks:yt}}return[zr,Mr]}findLongestCommonSequence(V,se=null){let me=V[0],be=me.length,Se=[];const We=Array.isArray(se)&&se.length>0;let ht=We?[]:null,bt=We?se[0]:null;for(let yt=1;yt<V.length;++yt){const Ct=V[yt];let Vt=0,un=[be,be,0,0];const vn=Ct.length;for(let Mr=1;Mr<be+vn;++Mr){const zr=Math.max(0,be-Mr),Wn=Math.min(be,be+vn-Mr),_r=me.slice(zr,Wn),cr=Math.max(0,Mr-be),va=Math.min(vn,Mr),ka=Ct.slice(cr,va);if(_r.length!==ka.length)throw new Error("There is a bug within whisper `decode_asr` function, please report it. Dropping to prevent bad inference.");let Xr;We?Xr=_r.filter((xr,Sn)=>xr===ka[Sn]&&bt[zr+Sn]<=se[yt][cr+Sn]).length:Xr=_r.filter((xr,Sn)=>xr===ka[Sn]).length;const Ea=Mr/1e4,rr=Xr/Mr+Ea;Xr>1&&rr>Vt&&(Vt=rr,un=[zr,Wn,cr,va])}const[Jn,Tn,lr,kr]=un,gr=Math.floor((Tn+Jn)/2),Dr=Math.floor((kr+lr)/2);Se.push(...me.slice(0,gr)),me=Ct.slice(Dr),be=me.length,We&&(ht.push(...bt.slice(0,gr)),bt=se[yt].slice(Dr))}return Se.push(...me),We?(ht.push(...bt),[Se,ht]):[Se,[]]}collateWordTimestamps(V,se,me){const[be,Se,We]=this.combineTokensIntoWords(V,me),ht=[];for(let bt=0;bt<be.length;++bt){const yt=We[bt];ht.push({text:be[bt],timestamp:[se[yt.at(0)][0],se[yt.at(-1)][1]]})}return ht}combineTokensIntoWords(V,se,me=`"'([{-`,be=`"'.,!?:)]}`){se=se??"english";let Se,We,ht;return["chinese","japanese","thai","lao","myanmar"].includes(se)?[Se,We,ht]=this.splitTokensOnUnicode(V):[Se,We,ht]=this.splitTokensOnSpaces(V),this.mergePunctuations(Se,We,ht,me,be)}decode(V,se){let me;return se!=null&&se.decode_with_timestamps?(V instanceof d.Tensor&&(V=T(V)),me=this.decodeWithTimestamps(V,se)):me=super.decode(V,se),me}decodeWithTimestamps(V,se){const me=(se==null?void 0:se.time_precision)??.02,be=Array.from(this.all_special_ids).at(-1)+1;let Se=[[]];for(let We of V)if(We=Number(We),We>=be){const ht=((We-be)*me).toFixed(2);Se.push(`<|${ht}|>`),Se.push([])}else Se[Se.length-1].push(We);return Se=Se.map(We=>typeof We=="string"?We:super.decode(We,se)),Se.join("")}splitTokensOnUnicode(V){const se=this.decode(V,{decode_with_timestamps:!0}),me="",be=[],Se=[],We=[];let ht=[],bt=[],yt=0;for(let Ct=0;Ct<V.length;++Ct){const Vt=V[Ct];ht.push(Vt),bt.push(Ct);const un=this.decode(ht,{decode_with_timestamps:!0});(!un.includes(me)||se[yt+un.indexOf(me)]===me)&&(be.push(un),Se.push(ht),We.push(bt),ht=[],bt=[],yt+=un.length)}return[be,Se,We]}splitTokensOnSpaces(V){const[se,me,be]=this.splitTokensOnUnicode(V),Se=[],We=[],ht=[],bt=new RegExp(`^[${C}]$`,"gu");for(let yt=0;yt<se.length;++yt){const Ct=se[yt],Vt=me[yt],un=be[yt],vn=Vt[0]>=this.model.tokens_to_ids.get("<|endoftext|>"),Jn=Ct.startsWith(" "),Tn=Ct.trim(),lr=bt.test(Tn);if(vn||Jn||lr||Se.length===0)Se.push(Ct),We.push(Vt),ht.push(un);else{const kr=Se.length-1;Se[kr]+=Ct,We[kr].push(...Vt),ht[kr].push(...un)}}return[Se,We,ht]}mergePunctuations(V,se,me,be,Se){const We=structuredClone(V),ht=structuredClone(se),bt=structuredClone(me);let yt=We.length-2,Ct=We.length-1;for(;yt>=0;)We[yt].startsWith(" ")&&be.includes(We[yt].trim())?(We[Ct]=We[yt]+We[Ct],ht[Ct]=(0,i.mergeArrays)(ht[yt],ht[Ct]),bt[Ct]=(0,i.mergeArrays)(bt[yt],bt[Ct]),We[yt]="",ht[yt]=[],bt[yt]=[]):Ct=yt,--yt;for(yt=0,Ct=1;Ct<We.length;)!We[yt].endsWith(" ")&&Se.includes(We[Ct])?(We[yt]+=We[Ct],ht[yt]=(0,i.mergeArrays)(ht[yt],ht[Ct]),bt[yt]=(0,i.mergeArrays)(bt[yt],bt[Ct]),We[Ct]="",ht[Ct]=[],bt[Ct]=[]):yt=Ct,++Ct;return[We.filter(Vt=>Vt),ht.filter(Vt=>Vt.length>0),bt.filter(Vt=>Vt.length>0)]}}class qa extends Ft{}class Ka extends Ft{}class ra extends Ft{}class Ar extends Ft{constructor(V,se){super(V,se),this.languageRegex=/^(>>\w+<<)\s*/g,this.supported_language_codes=this.model.vocab.filter(me=>this.languageRegex.test(me)),console.warn('WARNING: `MarianTokenizer` is not yet supported by Hugging Face\'s "fast" tokenizers library. Therefore, you may experience slightly inaccurate results.')}_encode_text(V){if(V===null)return null;const[se,...me]=V.trim().split(this.languageRegex);if(me.length===0)return super._encode_text(se);if(me.length===2){const[be,Se]=me;return this.supported_language_codes.includes(be)||console.warn(`Unsupported language code "${be}" detected, which may lead to unexpected behavior. Should be one of: ${JSON.stringify(this.supported_language_codes)}`),(0,i.mergeArrays)([be],super._encode_text(Se))}}}class ua extends Ft{}class lt extends Ft{}class ut extends Ft{}class At extends Ft{}class En extends Ft{}class ni extends Ft{constructor(V,se){super(V,se),this.decoder=new Jt({})}}class Fr extends Ft{}class ps extends Ft{}class Pi{static async from_pretrained(V,{progress_callback:se=null,config:me=null,cache_dir:be=null,local_files_only:Se=!1,revision:We="main",legacy:ht=null}={}){var un;const[bt,yt]=await p(V,{progress_callback:se,config:me,cache_dir:be,local_files_only:Se,revision:We,legacy:ht}),Ct=((un=yt.tokenizer_class)==null?void 0:un.replace(/Fast$/,""))??"PreTrainedTokenizer";let Vt=this.TOKENIZER_CLASS_MAPPING[Ct];return Vt||(console.warn(`Unknown tokenizer class "${Ct}", attempting to construct from base class.`),Vt=Ft),new Vt(bt,yt)}}ge(Pi,"TOKENIZER_CLASS_MAPPING",{T5Tokenizer:Ye,DistilBertTokenizer:oe,CamembertTokenizer:pe,DebertaTokenizer:an,DebertaV2Tokenizer:Qa,BertTokenizer:ns,HerbertTokenizer:L,ConvBertTokenizer:ue,RoFormerTokenizer:Y,XLMTokenizer:Ce,ElectraTokenizer:Ue,MobileBertTokenizer:Dn,SqueezeBertTokenizer:Kr,AlbertTokenizer:Ha,GPT2Tokenizer:ct,BartTokenizer:ft,MBartTokenizer:Tt,MBart50Tokenizer:Et,RobertaTokenizer:nn,WhisperTokenizer:hs,CodeGenTokenizer:qa,CLIPTokenizer:Ka,SiglipTokenizer:ra,MarianTokenizer:Ar,BloomTokenizer:xt,NllbTokenizer:mr,M2M100Tokenizer:wr,LlamaTokenizer:wn,CodeLlamaTokenizer:Gn,XLMRobertaTokenizer:or,MPNetTokenizer:Ir,FalconTokenizer:_a,GPTNeoXTokenizer:nr,EsmTokenizer:Tr,Wav2Vec2CTCTokenizer:ua,BlenderbotTokenizer:lt,BlenderbotSmallTokenizer:ut,SpeechT5Tokenizer:At,NougatTokenizer:En,VitsTokenizer:ni,Qwen2Tokenizer:Bs,GemmaTokenizer:na,Grok1Tokenizer:Pr,CohereTokenizer:Fr,MgpstrTokenizer:ps,PreTrainedTokenizer:Ft})}),"./src/utils/audio.js":((e,t,n)=>{n.r(t),n.d(t,{RawAudio:()=>ee,hamming:()=>m,hanning:()=>p,mel_filter_bank:()=>D,read_audio:()=>h,spectrogram:()=>k,window_function:()=>R});var s=n("./src/utils/hub.js"),i=n("./src/utils/maths.js"),o=n("./src/utils/core.js"),c=n("./src/env.js"),d=n("./src/utils/tensor.js"),u=n("?7992");async function h(X,le){if(typeof AudioContext>"u")throw Error("Unable to load audio from path/URL since `AudioContext` is not available in your environment. Instead, audio data should be passed directly to the pipeline/processor. For more information and some example code, see https://huggingface.co/docs/transformers.js/guides/node-audio-processing.");const ae=await(await(0,s.getFile)(X)).arrayBuffer(),Q=new AudioContext({sampleRate:le});typeof le>"u"&&console.warn(`No sampling rate provided, using default of ${Q.sampleRate}Hz.`);const ne=await Q.decodeAudioData(ae);let de;if(ne.numberOfChannels===2){const ve=Math.sqrt(2),fe=ne.getChannelData(0),j=ne.getChannelData(1);de=new Float32Array(fe.length);for(let U=0;U<ne.length;++U)de[U]=ve*(fe[U]+j[U])/2}else de=ne.getChannelData(0);return de}function g(X,le){if(X<1)return new Float64Array;if(X===1)return new Float64Array([1]);const ae=1-le,Q=2*Math.PI/(X-1),ne=new Float64Array(X);for(let de=0;de<X;++de)ne[de]=le-ae*Math.cos(de*Q);return ne}function p(X){return g(X,.5)}function m(X){return g(X,.54)}const y={htk:X=>2595*Math.log10(1+X/700),kaldi:X=>1127*Math.log(1+X/700),slaney:(X,le=1e3,ae=15,Q=27/Math.log(6.4))=>X>=le?ae+Math.log(X/le)*Q:3*X/200};function v(X,le="htk"){const ae=y[le];if(!ae)throw new Error('mel_scale should be one of "htk", "slaney" or "kaldi".');return typeof X=="number"?ae(X):X.map(Q=>ae(Q))}const T={htk:X=>700*(10**(X/2595)-1),kaldi:X=>700*(Math.exp(X/1127)-1),slaney:(X,le=1e3,ae=15,Q=Math.log(6.4)/27)=>X>=ae?le*Math.exp(Q*(X-ae)):200*X/3};function O(X,le="htk"){const ae=T[le];if(!ae)throw new Error('mel_scale should be one of "htk", "slaney" or "kaldi".');return typeof X=="number"?ae(X):X.map(Q=>ae(Q))}function E(X,le){const ae=Float64Array.from({length:le.length-1},(ve,fe)=>le[fe+1]-le[fe]),Q=Array.from({length:X.length},()=>new Array(le.length));for(let ve=0;ve<X.length;++ve){const fe=Q[ve];for(let j=0;j<le.length;++j)fe[j]=le[j]-X[ve]}const ne=le.length-2,de=Array.from({length:ne},()=>new Array(X.length));for(let ve=0;ve<X.length;++ve){const fe=Q[ve];for(let j=0;j<ne;++j){const U=-fe[j]/ae[j],N=fe[j+2]/ae[j+1];de[j][ve]=Math.max(0,Math.min(U,N))}}return de}function S(X,le,ae){const Q=(le-X)/(ae-1);return Float64Array.from({length:ae},(ne,de)=>X+Q*de)}function D(X,le,ae,Q,ne,de=null,ve="htk",fe=!1){if(de!==null&&de!=="slaney")throw new Error('norm must be one of null or "slaney"');if(X<2)throw new Error(`Require num_frequency_bins: ${X} >= 2`);if(ae>Q)throw new Error(`Require min_frequency: ${ae} <= max_frequency: ${Q}`);const j=v(ae,ve),U=v(Q,ve),N=S(j,U,le+2);let q=O(N,ve),ce;if(fe){const Me=ne/((X-1)*2);ce=v(Float64Array.from({length:X},(Pe,Ne)=>Ne*Me),ve),q=N}else ce=S(0,Math.floor(ne/2),X);const Z=E(ce,q);if(de!==null&&de==="slaney")for(let Me=0;Me<le;++Me){const Pe=Z[Me],Ne=2/(q[Me+2]-q[Me]);for(let Oe=0;Oe<X;++Oe)Pe[Oe]*=Ne}return Z}function I(X,le,ae){const Q=new X.constructor(X.length+le+ae),ne=X.length-1;for(let de=0;de<X.length;++de)Q[le+de]=X[de];for(let de=1;de<=le;++de)Q[le-de]=X[(0,o.calculateReflectOffset)(de,ne)];for(let de=1;de<=ae;++de)Q[ne+le+de]=X[(0,o.calculateReflectOffset)(ne-de,ne)];return Q}function M(X,le,ae,Q,ne){if(ae<=0)throw new Error("reference must be greater than zero");if(Q<=0)throw new Error("min_value must be greater than zero");ae=Math.max(Q,ae);const de=Math.log10(ae);for(let ve=0;ve<X.length;++ve)X[ve]=le*Math.log10(Math.max(Q,X[ve])-de);if(ne!==null){if(ne<=0)throw new Error("db_range must be greater than zero");const ve=(0,i.max)(X)[0]-ne;for(let fe=0;fe<X.length;++fe)X[fe]=Math.max(X[fe],ve)}return X}function C(X,le=1,ae=1e-5,Q=null){return M(X,20,le,ae,Q)}function A(X,le=1,ae=1e-10,Q=null){return M(X,10,le,ae,Q)}async function k(X,le,ae,Q,{fft_length:ne=null,power:de=1,center:ve=!0,pad_mode:fe="reflect",onesided:j=!0,preemphasis:U=null,preemphasis_htk_flavor:N=!0,mel_filters:q=null,mel_floor:ce=1e-10,log_mel:Z=null,reference:Me=1,min_value:Pe=1e-10,db_range:Ne=null,remove_dc_offset:Oe=null,min_num_frames:he=null,max_num_frames:H=null,do_pad:Te=!0,transpose:ze=!1,mel_offset:Re=0}={}){const He=le.length;if(ne===null&&(ne=ae),ae>ne)throw Error(`frame_length (${ae}) may not be larger than fft_length (${ne})`);if(He!==ae)throw new Error(`Length of the window (${He}) must equal frame_length (${ae})`);if(Q<=0)throw new Error("hop_length must be greater than zero");if(de===null&&q!==null)throw new Error("You have provided `mel_filters` but `power` is `None`. Mel spectrogram computation is not yet supported for complex-valued spectrogram. Specify `power` to fix this issue.");if(!N)throw new Error("`preemphasis_htk_flavor=false` is not currently supported.");if(ve)switch(fe){case"reflect":{const Ze=Math.floor((ne-1)/2)+1;X=I(X,Ze,Ze);break}case"constant":{const Ze=Math.floor(ne/2),rt=new X.constructor(X.length+2*Ze);rt.set(X,Ze),X=rt;break}default:throw new Error(`pad_mode="${fe}" not implemented yet.`)}let Ke=Math.floor(1+Math.floor((X.length-ae)/Q));he!==null&&Ke<he&&(Ke=he);const Be=j?Math.floor(ne/2)+1:ne;let nt=Ke,$e=Ke;H!==null&&(H>Ke?Te&&($e=H):$e=nt=H);const qe=new i.FFT(ne),_t=new Float64Array(ne),Je=new Float64Array(qe.outputBufferSize),pt=new Float32Array(Be*$e);for(let Ze=0;Ze<nt;++Ze){const rt=Ze*Q,kt=Math.min(X.length-rt,ae);kt!==ae&&_t.fill(0,0,ae);for(let Nt=0;Nt<kt;++Nt)_t[Nt]=X[rt+Nt];if(Oe){let Nt=0;for(let Jt=0;Jt<kt;++Jt)Nt+=_t[Jt];const gn=Nt/kt;for(let Jt=0;Jt<kt;++Jt)_t[Jt]-=gn}if(U!==null){for(let Nt=kt-1;Nt>=1;--Nt)_t[Nt]-=U*_t[Nt-1];_t[0]*=1-U}for(let Nt=0;Nt<le.length;++Nt)_t[Nt]*=le[Nt];qe.realTransform(Je,_t);for(let Nt=0;Nt<Be;++Nt){const gn=Nt<<1;pt[Nt*$e+Ze]=Je[gn]**2+Je[gn+1]**2}}if(de!==null&&de!==2){const Ze=de/2;for(let rt=0;rt<pt.length;++rt)pt[rt]**=Ze}const dt=q.length;let Gt=await(0,d.matmul)(new d.Tensor("float32",q.flat(),[dt,Be]),new d.Tensor("float32",pt,[Be,$e]));ze&&(Gt=Gt.transpose(1,0));const vt=Gt.data;for(let Ze=0;Ze<vt.length;++Ze)vt[Ze]=Re+Math.max(ce,vt[Ze]);if(de!==null&&Z!==null){const Ze=Math.min(vt.length,nt*dt);switch(Z){case"log":for(let rt=0;rt<Ze;++rt)vt[rt]=Math.log(vt[rt]);break;case"log10":for(let rt=0;rt<Ze;++rt)vt[rt]=Math.log10(vt[rt]);break;case"dB":if(de===1)C(vt,Me,Pe,Ne);else if(de===2)A(vt,Me,Pe,Ne);else throw new Error(`Cannot use log_mel option '${Z}' with power ${de}`);break;default:throw new Error(`log_mel must be one of null, 'log', 'log10' or 'dB'. Got '${Z}'`)}}return Gt}function R(X,le,{periodic:ae=!0,frame_length:Q=null,center:ne=!0}={}){const de=ae?X+1:X;let ve;switch(le){case"boxcar":ve=new Float64Array(de).fill(1);break;case"hann":case"hann_window":ve=p(de);break;case"hamming":ve=m(de);break;case"povey":ve=p(de).map(fe=>Math.pow(fe,.85));break;default:throw new Error(`Unknown window type ${le}.`)}if(ae&&(ve=ve.subarray(0,X)),Q===null)return ve;if(X>Q)throw new Error(`Length of the window (${X}) may not be larger than frame_length (${Q})`);return ve}function G(X,le){let ae=44;const Q=new ArrayBuffer(ae+X.length*4),ne=new DataView(Q);te(ne,0,"RIFF"),ne.setUint32(4,36+X.length*4,!0),te(ne,8,"WAVE"),te(ne,12,"fmt "),ne.setUint32(16,16,!0),ne.setUint16(20,3,!0),ne.setUint16(22,1,!0),ne.setUint32(24,le,!0),ne.setUint32(28,le*4,!0),ne.setUint16(32,4,!0),ne.setUint16(34,32,!0),te(ne,36,"data"),ne.setUint32(40,X.length*4,!0);for(let de=0;de<X.length;++de,ae+=4)ne.setFloat32(ae,X[de],!0);return Q}function te(X,le,ae){for(let Q=0;Q<ae.length;++Q)X.setUint8(le+Q,ae.charCodeAt(Q))}class ee{constructor(le,ae){this.audio=le,this.sampling_rate=ae}toWav(){return G(this.audio,this.sampling_rate)}toBlob(){const le=this.toWav();return new Blob([le],{type:"audio/wav"})}async save(le){let ae;if(c.apis.IS_BROWSER_ENV){if(c.apis.IS_WEBWORKER_ENV)throw new Error("Unable to save a file from a Web Worker.");ae=o.saveBlob}else if(c.apis.IS_FS_AVAILABLE)ae=async(Q,ne)=>{let de=await ne.arrayBuffer();u.writeFileSync(Q,Buffer.from(de))};else throw new Error("Unable to save because filesystem is disabled in this environment.");await ae(le,this.toBlob())}}}),"./src/utils/constants.js":((e,t,n)=>{n.r(t),n.d(t,{CHAT_TEMPLATE_NAME:()=>u,CONFIG_NAME:()=>i,FEATURE_EXTRACTOR_NAME:()=>o,GENERATION_CONFIG_NAME:()=>h,GITHUB_ISSUE_URL:()=>s,IMAGE_PROCESSOR_NAME:()=>c,PROCESSOR_NAME:()=>d});const s="https://github.com/huggingface/transformers.js/issues/new/choose",i="config.json",o="preprocessor_config.json",c=o,d="processor_config.json",u="chat_template.jinja",h="generation_config.json"}),"./src/utils/core.js":((e,t,n)=>{n.r(t),n.d(t,{calculateDimensions:()=>h,calculateReflectOffset:()=>y,count:()=>E,dispatchCallback:()=>s,escapeRegExp:()=>o,isIntegralNumber:()=>d,isNullishDimension:()=>u,isTypedArray:()=>c,len:()=>O,mergeArrays:()=>p,pick:()=>T,pop:()=>g,product:()=>m,reverseDictionary:()=>i,saveBlob:()=>v});function s(S,D){S&&S(D)}function i(S){return Object.fromEntries(Object.entries(S).map(([D,I])=>[I,D]))}function o(S){return S.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function c(S){var D,I,M;return((M=(I=(D=S==null?void 0:S.prototype)==null?void 0:D.__proto__)==null?void 0:I.constructor)==null?void 0:M.name)==="TypedArray"}function d(S){return Number.isInteger(S)||typeof S=="bigint"}function u(S){return S==null||S===-1}function h(S){const D=[];let I=S;for(;Array.isArray(I);)D.push(I.length),I=I[0];return D}function g(S,D,I=void 0){const M=S[D];if(M!==void 0)return delete S[D],M;if(I===void 0)throw Error(`Key ${D} does not exist in object.`);return I}function p(...S){return Array.prototype.concat.apply([],S)}function m(...S){return S.reduce((D,I)=>D.flatMap(M=>I.map(C=>[M,C])))}function y(S,D){return Math.abs((S+D)%(2*D)-D)}function v(S,D){const I=URL.createObjectURL(D),M=document.createElement("a");M.href=I,M.download=S,M.click(),M.remove(),URL.revokeObjectURL(I)}function T(S,D){return Object.assign({},...D.map(I=>{if(S[I]!==void 0)return{[I]:S[I]}}))}function O(S){let D=0;for(const I of S)++D;return D}function E(S,D){let I=0;for(const M of S)M===D&&++I;return I}}),"./src/utils/data-structures.js":((e,t,n)=>{n.r(t),n.d(t,{CharTrie:()=>i,DictionarySplitter:()=>u,LRUCache:()=>h,PriorityQueue:()=>s,TokenLattice:()=>c});class s{constructor(p=(y,v)=>y>v,m=1/0){this._heap=[],this._comparator=p,this._maxSize=m}get size(){return this._heap.length}isEmpty(){return this.size===0}peek(){return this._heap[0]}push(...p){return this.extend(p)}extend(p){for(const m of p)if(this.size<this._maxSize)this._heap.push(m),this._siftUp();else{const y=this._smallest();this._comparator(m,this._heap[y])&&(this._heap[y]=m,this._siftUpFrom(y))}return this.size}pop(){const p=this.peek(),m=this.size-1;return m>0&&this._swap(0,m),this._heap.pop(),this._siftDown(),p}replace(p){const m=this.peek();return this._heap[0]=p,this._siftDown(),m}_parent(p){return(p+1>>>1)-1}_left(p){return(p<<1)+1}_right(p){return p+1<<1}_greater(p,m){return this._comparator(this._heap[p],this._heap[m])}_swap(p,m){const y=this._heap[p];this._heap[p]=this._heap[m],this._heap[m]=y}_siftUp(){this._siftUpFrom(this.size-1)}_siftUpFrom(p){for(;p>0&&this._greater(p,this._parent(p));)this._swap(p,this._parent(p)),p=this._parent(p)}_siftDown(){let p=0;for(;this._left(p)<this.size&&this._greater(this._left(p),p)||this._right(p)<this.size&&this._greater(this._right(p),p);){const m=this._right(p)<this.size&&this._greater(this._right(p),this._left(p))?this._right(p):this._left(p);this._swap(p,m),p=m}}_smallest(){return 2**Math.floor(Math.log2(this.size))-1}}class i{constructor(){this.root=o.default()}extend(p){for(const m of p)this.push(m)}push(p){let m=this.root;for(const y of p){let v=m.children.get(y);v===void 0&&(v=o.default(),m.children.set(y,v)),m=v}m.isLeaf=!0}*commonPrefixSearch(p){let m=this.root;if(m===void 0)return;let y="";for(const v of p){if(y+=v,m=m.children.get(v),m===void 0)return;m.isLeaf&&(yield y)}}}class o{constructor(p,m){this.isLeaf=p,this.children=m}static default(){return new o(!1,new Map)}}class c{constructor(p,m,y){this.chars=Array.from(p),this.len=this.chars.length,this.bosTokenId=m,this.eosTokenId=y,this.nodes=[],this.beginNodes=Array.from({length:this.len+1},()=>[]),this.endNodes=Array.from({length:this.len+1},()=>[]);const v=new d(this.bosTokenId,0,0,0,0),T=new d(this.eosTokenId,1,this.len,0,0);this.nodes.push(v.clone()),this.nodes.push(T.clone()),this.beginNodes[this.len].push(T),this.endNodes[0].push(v)}insert(p,m,y,v){const T=this.nodes.length,O=new d(v,T,p,m,y);this.beginNodes[p].push(O),this.endNodes[p+m].push(O),this.nodes.push(O)}viterbi(){const p=this.len;let m=0;for(;m<=p;){if(this.beginNodes[m].length==0)return[];for(let E of this.beginNodes[m]){E.prev=null;let S=0,D=null;for(let I of this.endNodes[m]){const M=I.backtraceScore+E.score;(D===null||M>S)&&(D=I.clone(),S=M)}if(D!==null)E.prev=D,E.backtraceScore=S;else return[]}++m}const y=[],T=this.beginNodes[p][0].prev;if(T===null)return[];let O=T.clone();for(;O.prev!==null;)y.push(O.clone()),O=O.clone().prev.clone();return y.reverse(),y}piece(p){return this.chars.slice(p.pos,p.pos+p.length).join("")}tokens(){return this.viterbi().map(m=>this.piece(m))}tokenIds(){return this.viterbi().map(m=>m.tokenId)}}class d{constructor(p,m,y,v,T){this.tokenId=p,this.nodeId=m,this.pos=y,this.length=v,this.score=T,this.prev=null,this.backtraceScore=0}clone(){const p=new d(this.tokenId,this.nodeId,this.pos,this.length,this.score);return p.prev=this.prev,p.backtraceScore=this.backtraceScore,p}}class u{constructor(p){this.trie=this._buildTrie(p)}_buildTrie(p){var y;const m=Object.create(null);for(const v of p){let T=m;for(let O=0;O<v.length;++O)T=T[y=v[O]]??(T[y]=Object.create(null));T.end=v}return m}split(p){const m=[],y=p.length;let v=0,T=0;for(;T<y;){let O=this.trie,E=null,S=T;for(;S<y&&(O=O[p[S]]);)O.end&&(E=O.end),++S;E?(T>v&&m.push(p.slice(v,T)),m.push(E),T+=E.length,v=T):++T}return v<y&&m.push(p.slice(v)),m}}class h{constructor(p){this.capacity=p,this.cache=new Map}get(p){if(!this.cache.has(p))return;const m=this.cache.get(p);return this.cache.delete(p),this.cache.set(p,m),m}put(p,m){this.cache.has(p)&&this.cache.delete(p),this.cache.set(p,m),this.cache.size>this.capacity&&this.cache.delete(this.cache.keys().next().value)}clear(){this.cache.clear()}}}),"./src/utils/devices.js":((e,t,n)=>{n.r(t),n.d(t,{DEVICE_TYPES:()=>s});const s=Object.freeze({auto:"auto",gpu:"gpu",cpu:"cpu",wasm:"wasm",webgpu:"webgpu",cuda:"cuda",dml:"dml",webnn:"webnn","webnn-npu":"webnn-npu","webnn-gpu":"webnn-gpu","webnn-cpu":"webnn-cpu"})}),"./src/utils/dtypes.js":((e,t,n)=>{n.r(t),n.d(t,{DATA_TYPES:()=>c,DEFAULT_DEVICE_DTYPE_MAPPING:()=>d,DEFAULT_DTYPE_SUFFIX_MAPPING:()=>u,isWebGpuFp16Supported:()=>o});var s=n("./src/env.js"),i=n("./src/utils/devices.js");const o=(function(){let h;return async function(){if(h===void 0)if(!s.apis.IS_WEBGPU_AVAILABLE)h=!1;else try{h=(await navigator.gpu.requestAdapter()).features.has("shader-f16")}catch{h=!1}return h}})(),c=Object.freeze({auto:"auto",fp32:"fp32",fp16:"fp16",q8:"q8",int8:"int8",uint8:"uint8",q4:"q4",bnb4:"bnb4",q4f16:"q4f16"}),d=Object.freeze({[i.DEVICE_TYPES.wasm]:c.q8}),u=Object.freeze({[c.fp32]:"",[c.fp16]:"_fp16",[c.int8]:"_int8",[c.uint8]:"_uint8",[c.q8]:"_quantized",[c.q4]:"_q4",[c.q4f16]:"_q4f16",[c.bnb4]:"_bnb4"})}),"./src/utils/generic.js":((e,t,n)=>{n.r(t),n.d(t,{Callable:()=>s});const s=class{constructor(){let i=function(...o){return i._call(...o)};return Object.setPrototypeOf(i,new.target.prototype)}_call(...i){throw Error("Must implement _call method in subclass")}}}),"./src/utils/hub.js":((e,t,n)=>{n.r(t),n.d(t,{MAX_EXTERNAL_DATA_CHUNKS:()=>d,getFile:()=>y,getModelFile:()=>S,getModelJSON:()=>I,getModelText:()=>D});var s=n("?7992"),i=n("?5af5"),o=n("./src/env.js"),c=n("./src/utils/core.js");const d=100,u={txt:"text/plain",html:"text/html",css:"text/css",js:"text/javascript",json:"application/json",png:"image/png",jpg:"image/jpeg",jpeg:"image/jpeg",gif:"image/gif"};class h{constructor(k){if(this.filePath=k,this.headers=new Headers,this.exists=s.existsSync(k),this.exists){this.status=200,this.statusText="OK";let R=s.statSync(k);this.headers.set("content-length",R.size.toString()),this.updateContentType();const G=s.createReadStream(k);this.body=new ReadableStream({start(te){G.on("data",ee=>te.enqueue(ee)),G.on("end",()=>te.close()),G.on("error",ee=>te.error(ee))},cancel(){G.destroy()}})}else this.status=404,this.statusText="Not Found",this.body=null}updateContentType(){const k=this.filePath.toString().split(".").pop().toLowerCase();this.headers.set("content-type",u[k]??"application/octet-stream")}clone(){let k=new h(this.filePath);return k.exists=this.exists,k.status=this.status,k.statusText=this.statusText,k.headers=new Headers(this.headers),k}async arrayBuffer(){return(await s.promises.readFile(this.filePath)).buffer}async blob(){const k=await s.promises.readFile(this.filePath);return new Blob([k],{type:this.headers.get("content-type")})}async text(){return await s.promises.readFile(this.filePath,"utf8")}async json(){return JSON.parse(await this.text())}}function g(A,k=null,R=null){let G;try{G=new URL(A)}catch{return!1}return!(k&&!k.includes(G.protocol)||R&&!R.includes(G.hostname))}const p=/^(\b[\w\-.]+\b\/)?\b[\w\-.]{1,96}\b$/;function m(A){return!(!p.test(A)||A.includes("..")||A.includes("--")||A.endsWith(".git")||A.endsWith(".ipynb"))}async function y(A){var k;if(o.env.useFS&&!g(A,["http:","https:","blob:"]))return new h(A instanceof URL?A.protocol==="file:"?A.pathname:A.toString():A);if(typeof process<"u"&&((k=process==null?void 0:process.release)==null?void 0:k.name)==="node"){const R=!!(Yo!=null&&Yo.TESTING_REMOTELY),G=o.env.version,te=new Headers;if(te.set("User-Agent",`transformers.js/${G}; is_ci/${R};`),g(A,["http:","https:"],["huggingface.co","hf.co"])){const X=(Yo==null?void 0:Yo.HF_TOKEN)??(Yo==null?void 0:Yo.HF_ACCESS_TOKEN);X&&te.set("Authorization",`Bearer ${X}`)}return fetch(A,{headers:te})}else return fetch(A)}const v={400:"Bad request error occurred while trying to load file",401:"Unauthorized access to file",403:"Forbidden access to file",404:"Could not locate file",408:"Request timeout error occurred while trying to load file",500:"Internal server error error occurred while trying to load file",502:"Bad gateway error occurred while trying to load file",503:"Service unavailable error occurred while trying to load file",504:"Gateway timeout error occurred while trying to load file"};function T(A,k,R){if(!R)return null;const G=v[A]??`Error (${A}) occurred while trying to load file`;throw Error(`${G}: "${k}".`)}class O{constructor(k){this.path=k}async match(k){let R=i.join(this.path,k),G=new h(R);if(G.exists)return G}async put(k,R,G=void 0){let te=i.join(this.path,k);try{const ee=R.headers.get("Content-Length"),X=parseInt(ee??"0");let le=0;await s.promises.mkdir(i.dirname(te),{recursive:!0});const ae=s.createWriteStream(te),Q=R.body.getReader();for(;;){const{done:ne,value:de}=await Q.read();if(ne)break;await new Promise((fe,j)=>{ae.write(de,U=>{if(U){j(U);return}fe()})}),le+=de.length;const ve=X?le/X*100:0;G==null||G({progress:ve,loaded:le,total:X})}ae.close()}catch(ee){try{await s.promises.unlink(te)}catch{}throw ee}}}async function E(A,...k){for(let R of k)try{let G=await A.match(R);if(G)return G}catch{continue}}async function S(A,k,R=!0,G={},te=!1){if(!o.env.allowLocalModels){if(G.local_files_only)throw Error("Invalid configuration detected: local models are disabled (`env.allowLocalModels=false`) but you have requested to only use local models (`local_files_only=true`).");if(!o.env.allowRemoteModels)throw Error("Invalid configuration detected: both local and remote models are disabled. Fix by setting `env.allowLocalModels` or `env.allowRemoteModels` to `true`.")}(0,c.dispatchCallback)(G.progress_callback,{status:"initiate",name:A,file:k});let ee;if(!ee&&o.env.useCustomCache){if(!o.env.customCache)throw Error("`env.useCustomCache=true`, but `env.customCache` is not defined.");if(!o.env.customCache.match||!o.env.customCache.put)throw new Error("`env.customCache` must be an object which implements the `match` and `put` functions of the Web Cache API. For more information, see https://developer.mozilla.org/en-US/docs/Web/API/Cache");ee=o.env.customCache}if(!ee&&o.env.useBrowserCache){if(typeof caches>"u")throw Error("Browser cache is not available in this environment.");try{ee=await caches.open("transformers-cache")}catch(ce){console.warn("An error occurred while opening the browser cache:",ce)}}if(!ee&&o.env.useFSCache){if(!o.apis.IS_FS_AVAILABLE)throw Error("File System Cache is not available in this environment.");ee=new O(G.cache_dir??o.env.cacheDir)}const X=G.revision??"main",le=C(A,k),ae=m(A),Q=ae?C(o.env.localModelPath,le):le,ne=C(o.env.remoteHost,o.env.remotePathTemplate.replaceAll("{model}",A).replaceAll("{revision}",encodeURIComponent(X)),k);let de;const ve=ee instanceof O?X==="main"?le:C(A,X,k):ne;let fe=!1,j;ee&&(j=await E(ee,Q,ve));const U=j!==void 0;if(j===void 0){if(o.env.allowLocalModels)if(g(le,["http:","https:"])){if(G.local_files_only)throw new Error(`\`local_files_only=true\`, but attempted to load a remote file from: ${le}.`);if(!o.env.allowRemoteModels)throw new Error(`\`env.allowRemoteModels=false\`, but attempted to load a remote file from: ${le}.`)}else try{j=await y(Q),de=Q}catch(Z){console.warn(`Unable to load from local path "${Q}": "${Z}"`)}if(j===void 0||j.status===404){if(G.local_files_only||!o.env.allowRemoteModels){if(R)throw Error(`\`local_files_only=true\` or \`env.allowRemoteModels=false\` and file was not found locally at "${Q}".`);return null}if(!ae)throw Error(`Local file missing at "${Q}" and download aborted due to invalid model ID "${A}".`);if(j=await y(ne),j.status!==200)return T(j.status,ne,R);de=ve}fe=ee&&typeof Response<"u"&&j instanceof Response&&j.status===200}(0,c.dispatchCallback)(G.progress_callback,{status:"download",name:A,file:k});let N;if(!(o.apis.IS_NODE_ENV&&te)){let ce;G.progress_callback?U&&typeof navigator<"u"&&/firefox/i.test(navigator.userAgent)?(ce=new Uint8Array(await j.arrayBuffer()),(0,c.dispatchCallback)(G.progress_callback,{status:"progress",name:A,file:k,progress:100,loaded:ce.length,total:ce.length})):ce=await M(j,Z=>{(0,c.dispatchCallback)(G.progress_callback,{status:"progress",name:A,file:k,...Z})}):ce=new Uint8Array(await j.arrayBuffer()),N=ce}if(fe&&de&&await ee.match(de)===void 0)if(N)await ee.put(de,new Response(N,{headers:j.headers})).catch(ce=>{console.warn(`Unable to add response to browser cache: ${ce}.`)});else{const ce=G.progress_callback?Z=>(0,c.dispatchCallback)(G.progress_callback,{status:"progress",name:A,file:k,...Z}):void 0;await ee.put(de,j,ce)}if((0,c.dispatchCallback)(G.progress_callback,{status:"done",name:A,file:k}),N){if(!o.apis.IS_NODE_ENV&&te)throw new Error("Cannot return path in a browser environment.");return N}if(j instanceof h)return j.filePath;const q=await(ee==null?void 0:ee.match(de));if(q instanceof h)return q.filePath;if(q instanceof Response)return new Uint8Array(await q.arrayBuffer());if(typeof q=="string")return q;throw new Error("Unable to get model file path or buffer.")}async function D(A,k,R=!0,G={}){const te=await S(A,k,R,G,!1);return te===null?null:new TextDecoder("utf-8").decode(te)}async function I(A,k,R=!0,G={}){const te=await D(A,k,R,G);return te===null?{}:JSON.parse(te)}async function M(A,k){const R=A.headers.get("Content-Length");R===null&&console.warn("Unable to determine content-length from response headers. Will expand buffer when needed.");let G=parseInt(R??"0"),te=new Uint8Array(G),ee=0;const X=A.body.getReader();async function le(){const{done:ae,value:Q}=await X.read();if(ae)return;const ne=ee+Q.length;if(ne>G){G=ne;const ve=new Uint8Array(G);ve.set(te),te=ve}te.set(Q,ee),ee=ne;const de=ee/G*100;return k({progress:de,loaded:ee,total:G}),le()}return await le(),te}function C(...A){return A=A.map((k,R)=>(R&&(k=k.replace(new RegExp("^/"),"")),R!==A.length-1&&(k=k.replace(new RegExp("/$"),"")),k)),A.join("/")}}),"./src/utils/image.js":((e,t,n)=>{n.r(t),n.d(t,{RawImage:()=>v,load_image:()=>T});var s=n("./src/utils/core.js"),i=n("./src/utils/hub.js"),o=n("./src/env.js"),c=n("./src/utils/tensor.js"),d=n("?2b25");let u,h,g;const p=o.apis.IS_BROWSER_ENV||o.apis.IS_WEBWORKER_ENV;if(p)u=(O,E)=>{if(!self.OffscreenCanvas)throw new Error("OffscreenCanvas not supported by this browser.");return new self.OffscreenCanvas(O,E)},g=self.createImageBitmap,h=self.ImageData;else if(d)g=async O=>{const S=(await O.metadata()).channels,{data:D,info:I}=await O.rotate().raw().toBuffer({resolveWithObject:!0}),M=new v(new Uint8ClampedArray(D),I.width,I.height,I.channels);return S!==void 0&&S!==I.channels&&M.convert(S),M};else throw new Error("Unable to load image processing library.");const m={0:"nearest",1:"lanczos",2:"bilinear",3:"bicubic",4:"box",5:"hamming"},y=new Map([["png","image/png"],["jpg","image/jpeg"],["jpeg","image/jpeg"],["gif","image/gif"]]);class v{constructor(E,S,D,I){this.data=E,this.width=S,this.height=D,this.channels=I}get size(){return[this.width,this.height]}static async read(E){if(E instanceof v)return E;if(typeof E=="string"||E instanceof URL)return await this.fromURL(E);if(E instanceof Blob)return await this.fromBlob(E);if(typeof HTMLCanvasElement<"u"&&E instanceof HTMLCanvasElement||typeof OffscreenCanvas<"u"&&E instanceof OffscreenCanvas)return this.fromCanvas(E);throw new Error(`Unsupported input type: ${typeof E}`)}static fromCanvas(E){if(!p)throw new Error("fromCanvas() is only supported in browser environments.");const D=E.getContext("2d").getImageData(0,0,E.width,E.height).data;return new v(D,E.width,E.height,4)}static async fromURL(E){const S=await(0,i.getFile)(E);if(S.status!==200)throw new Error(`Unable to read image from "${E}" (${S.status} ${S.statusText})`);const D=await S.blob();return this.fromBlob(D)}static async fromBlob(E){if(p){const S=await g(E),D=u(S.width,S.height).getContext("2d");return D.drawImage(S,0,0),new this(D.getImageData(0,0,S.width,S.height).data,S.width,S.height,4)}else{const S=d(await E.arrayBuffer());return await g(S)}}static fromTensor(E,S="CHW"){if(E.dims.length!==3)throw new Error(`Tensor should have 3 dimensions, but has ${E.dims.length} dimensions.`);if(S==="CHW")E=E.transpose(1,2,0);else if(S!=="HWC")throw new Error(`Unsupported channel format: ${S}`);if(!(E.data instanceof Uint8ClampedArray||E.data instanceof Uint8Array))throw new Error(`Unsupported tensor type: ${E.type}`);switch(E.dims[2]){case 1:case 2:case 3:case 4:return new v(E.data,E.dims[1],E.dims[0],E.dims[2]);default:throw new Error(`Unsupported number of channels: ${E.dims[2]}`)}}grayscale(){if(this.channels===1)return this;const E=new Uint8ClampedArray(this.width*this.height*1);switch(this.channels){case 3:case 4:for(let S=0,D=0;S<this.data.length;S+=this.channels){const I=this.data[S],M=this.data[S+1],C=this.data[S+2];E[D++]=Math.round(.2989*I+.587*M+.114*C)}break;default:throw new Error(`Conversion failed due to unsupported number of channels: ${this.channels}`)}return this._update(E,this.width,this.height,1)}rgb(){if(this.channels===3)return this;const E=new Uint8ClampedArray(this.width*this.height*3);switch(this.channels){case 1:for(let S=0,D=0;S<this.data.length;++S)E[D++]=this.data[S],E[D++]=this.data[S],E[D++]=this.data[S];break;case 4:for(let S=0,D=0;S<this.data.length;S+=4)E[D++]=this.data[S],E[D++]=this.data[S+1],E[D++]=this.data[S+2];break;default:throw new Error(`Conversion failed due to unsupported number of channels: ${this.channels}`)}return this._update(E,this.width,this.height,3)}rgba(){if(this.channels===4)return this;const E=new Uint8ClampedArray(this.width*this.height*4);switch(this.channels){case 1:for(let S=0,D=0;S<this.data.length;++S)E[D++]=this.data[S],E[D++]=this.data[S],E[D++]=this.data[S],E[D++]=255;break;case 3:for(let S=0,D=0;S<this.data.length;S+=3)E[D++]=this.data[S],E[D++]=this.data[S+1],E[D++]=this.data[S+2],E[D++]=255;break;default:throw new Error(`Conversion failed due to unsupported number of channels: ${this.channels}`)}return this._update(E,this.width,this.height,4)}putAlpha(E){if(E.width!==this.width||E.height!==this.height)throw new Error(`Expected mask size to be ${this.width}x${this.height}, but got ${E.width}x${E.height}`);if(E.channels!==1)throw new Error(`Expected mask to have 1 channel, but got ${E.channels}`);const S=this.data,D=E.data,I=this.width*this.height;if(this.channels===3){const M=new Uint8ClampedArray(I*4);for(let C=0,A=0,k=0;C<I;++C)M[k++]=S[A++],M[k++]=S[A++],M[k++]=S[A++],M[k++]=D[C];return this._update(M,this.width,this.height,4)}else if(this.channels===4){for(let M=0;M<I;++M)S[4*M+3]=D[M];return this}throw new Error(`Expected image to have 3 or 4 channels, but got ${this.channels}`)}async resize(E,S,{resample:D=2}={}){if(this.width===E&&this.height===S)return this;let I=m[D]??D;const M=(0,s.isNullishDimension)(E),C=(0,s.isNullishDimension)(S);if(M&&C)return this;if(M?E=S/this.height*this.width:C&&(S=E/this.width*this.height),p){const A=this.channels,k=this.toCanvas(),R=u(E,S).getContext("2d");return R.drawImage(k,0,0,E,S),new v(R.getImageData(0,0,E,S).data,E,S,4).convert(A)}else{let A=this.toSharp();switch(I){case"box":case"hamming":(I==="box"||I==="hamming")&&(console.warn(`Resampling method ${I} is not yet supported. Using bilinear instead.`),I="bilinear");case"nearest":case"bilinear":case"bicubic":A=A.affine([E/this.width,0,0,S/this.height],{interpolator:I});break;case"lanczos":A=A.resize({width:E,height:S,fit:"fill",kernel:"lanczos3"});break;default:throw new Error(`Resampling method ${I} is not supported.`)}return await g(A)}}async pad([E,S,D,I]){if(E=Math.max(E,0),S=Math.max(S,0),D=Math.max(D,0),I=Math.max(I,0),E===0&&S===0&&D===0&&I===0)return this;if(p){const M=this.channels,C=this.toCanvas(),A=this.width+E+S,k=this.height+D+I,R=u(A,k).getContext("2d");return R.drawImage(C,0,0,this.width,this.height,E,D,this.width,this.height),new v(R.getImageData(0,0,A,k).data,A,k,4).convert(M)}else{const M=this.toSharp().extend({left:E,right:S,top:D,bottom:I});return await g(M)}}async crop([E,S,D,I]){if(E=Math.max(E,0),S=Math.max(S,0),D=Math.min(D,this.width-1),I=Math.min(I,this.height-1),E===0&&S===0&&D===this.width-1&&I===this.height-1)return this;const M=D-E+1,C=I-S+1;if(p){const A=this.channels,k=this.toCanvas(),R=u(M,C).getContext("2d");return R.drawImage(k,E,S,M,C,0,0,M,C),new v(R.getImageData(0,0,M,C).data,M,C,4).convert(A)}else{const A=this.toSharp().extract({left:E,top:S,width:M,height:C});return await g(A)}}async center_crop(E,S){if(this.width===E&&this.height===S)return this;const D=(this.width-E)/2,I=(this.height-S)/2;if(p){const M=this.channels,C=this.toCanvas(),A=u(E,S).getContext("2d");let k=0,R=0,G=0,te=0;return D>=0?k=D:G=-D,I>=0?R=I:te=-I,A.drawImage(C,k,R,E,S,G,te,E,S),new v(A.getImageData(0,0,E,S).data,E,S,4).convert(M)}else{let M=this.toSharp();if(D>=0&&I>=0)M=M.extract({left:Math.floor(D),top:Math.floor(I),width:E,height:S});else if(D<=0&&I<=0){const C=Math.floor(-I),A=Math.floor(-D);M=M.extend({top:C,left:A,right:E-this.width-A,bottom:S-this.height-C})}else{let C=[0,0],A=0;I<0?(C[0]=Math.floor(-I),C[1]=S-this.height-C[0]):A=Math.floor(I);let k=[0,0],R=0;D<0?(k[0]=Math.floor(-D),k[1]=E-this.width-k[0]):R=Math.floor(D),M=M.extend({top:C[0],bottom:C[1],left:k[0],right:k[1]}).extract({left:R,top:A,width:E,height:S})}return await g(M)}}async toBlob(E="image/png",S=1){if(!p)throw new Error("toBlob() is only supported in browser environments.");return await this.toCanvas().convertToBlob({type:E,quality:S})}toTensor(E="CHW"){let S=new c.Tensor("uint8",new Uint8Array(this.data),[this.height,this.width,this.channels]);if(E!=="HWC")if(E==="CHW")S=S.permute(2,0,1);else throw new Error(`Unsupported channel format: ${E}`);return S}toCanvas(){if(!p)throw new Error("toCanvas() is only supported in browser environments.");const E=this.clone().rgba(),S=u(E.width,E.height),D=new h(E.data,E.width,E.height);return S.getContext("2d").putImageData(D,0,0),S}split(){const{data:E,width:S,height:D,channels:I}=this,M=E.constructor,C=E.length/I,A=Array.from({length:I},()=>new M(C));for(let k=0;k<C;++k){const R=I*k;for(let G=0;G<I;++G)A[G][k]=E[R+G]}return A.map(k=>new v(k,S,D,1))}_update(E,S,D,I=null){return this.data=E,this.width=S,this.height=D,I!==null&&(this.channels=I),this}clone(){return new v(this.data.slice(),this.width,this.height,this.channels)}convert(E){if(this.channels===E)return this;switch(E){case 1:this.grayscale();break;case 3:this.rgb();break;case 4:this.rgba();break;default:throw new Error(`Conversion failed due to unsupported number of channels: ${this.channels}`)}return this}async save(E){if(p){if(o.apis.IS_WEBWORKER_ENV)throw new Error("Unable to save an image from a Web Worker.");const S=E.split(".").pop().toLowerCase(),D=y.get(S)??"image/png",I=await this.toBlob(D);(0,s.saveBlob)(E,I)}else{if(o.apis.IS_FS_AVAILABLE)return await this.toSharp().toFile(E);throw new Error("Unable to save the image because filesystem is disabled in this environment.")}}toSharp(){if(p)throw new Error("toSharp() is only supported in server-side environments.");return d(this.data,{raw:{width:this.width,height:this.height,channels:this.channels}})}}const T=v.read.bind(v)}),"./src/utils/maths.js":((e,t,n)=>{n.r(t),n.d(t,{FFT:()=>T,bankers_round:()=>S,cos_sim:()=>u,dot:()=>d,dynamic_time_warping:()=>D,interpolate_data:()=>s,log_softmax:()=>c,magnitude:()=>h,max:()=>p,medianFilter:()=>O,min:()=>g,permute_data:()=>i,round:()=>E,softmax:()=>o});function s(I,[M,C,A],[k,R],G="bilinear",te=!1){const ee=R/A,X=k/C,le=new I.constructor(k*R*M),ae=C*A,Q=k*R;for(let ne=0;ne<k;++ne)for(let de=0;de<R;++de){const ve=ne*R+de,fe=(de+.5)/ee-.5,j=(ne+.5)/X-.5;let U=Math.floor(fe),N=Math.floor(j);const q=Math.min(U+1,A-1),ce=Math.min(N+1,C-1);U=Math.max(U,0),N=Math.max(N,0);const Z=fe-U,Me=j-N,Pe=(1-Z)*(1-Me),Ne=Z*(1-Me),Oe=(1-Z)*Me,he=Z*Me,H=N*A,Te=ce*A,ze=H+U,Re=H+q,He=Te+U,Ke=Te+q;for(let Be=0;Be<M;++Be){const nt=Be*ae;le[Be*Q+ve]=Pe*I[nt+ze]+Ne*I[nt+Re]+Oe*I[nt+He]+he*I[nt+Ke]}}return le}function i(I,M,C){const A=new Array(C.length),k=new Array(C.length);for(let te=C.length-1,ee=1;te>=0;--te)k[te]=ee,A[te]=M[C[te]],ee*=A[te];const R=C.map((te,ee)=>k[C.indexOf(ee)]),G=new I.constructor(I.length);for(let te=0;te<I.length;++te){let ee=0;for(let X=M.length-1,le=te;X>=0;--X)ee+=le%M[X]*R[X],le=Math.floor(le/M[X]);G[ee]=I[te]}return[G,A]}function o(I){const M=p(I)[0],C=I.map(R=>Math.exp(R-M)),A=C.reduce((R,G)=>R+G,0);return C.map(R=>R/A)}function c(I){const M=p(I)[0];let C=0;for(let R=0;R<I.length;++R)C+=Math.exp(I[R]-M);const A=Math.log(C);return I.map(R=>R-M-A)}function d(I,M){let C=0;for(let A=0;A<I.length;++A)C+=I[A]*M[A];return C}function u(I,M){const C=d(I,M),A=h(I),k=h(M);return C/(A*k)}function h(I){return Math.sqrt(I.reduce((M,C)=>M+C*C,0))}function g(I){if(I.length===0)throw Error("Array must not be empty");let M=I[0],C=0;for(let A=1;A<I.length;++A)I[A]<M&&(M=I[A],C=A);return[M,C]}function p(I){if(I.length===0)throw Error("Array must not be empty");let M=I[0],C=0;for(let A=1;A<I.length;++A)I[A]>M&&(M=I[A],C=A);return[M,C]}function m(I){return I>0&&(I&I-1)===0}class y{constructor(M){if(this.size=M|0,this.size<=1||!m(this.size))throw new Error("FFT size must be a power of two larger than 1");this._csize=M<<1,this.table=new Float64Array(this.size*2);for(let A=0;A<this.table.length;A+=2){const k=Math.PI*A/this.size;this.table[A]=Math.cos(k),this.table[A+1]=-Math.sin(k)}let C=0;for(let A=1;this.size>A;A<<=1)++C;this._width=C%2===0?C-1:C,this._bitrev=new Int32Array(1<<this._width);for(let A=0;A<this._bitrev.length;++A){this._bitrev[A]=0;for(let k=0;k<this._width;k+=2){const R=this._width-k-2;this._bitrev[A]|=(A>>>k&3)<<R}}}createComplexArray(){return new Float64Array(this._csize)}fromComplexArray(M,C){const A=C||new Array(M.length>>>1);for(let k=0;k<M.length;k+=2)A[k>>>1]=M[k];return A}toComplexArray(M,C){const A=C||this.createComplexArray();for(let k=0;k<A.length;k+=2)A[k]=M[k>>>1],A[k+1]=0;return A}transform(M,C){if(M===C)throw new Error("Input and output buffers must be different");this._transform4(M,C,1)}realTransform(M,C){if(M===C)throw new Error("Input and output buffers must be different");this._realTransform4(M,C,1)}inverseTransform(M,C){if(M===C)throw new Error("Input and output buffers must be different");this._transform4(M,C,-1);for(let A=0;A<M.length;++A)M[A]/=this.size}_transform4(M,C,A){const k=this._csize;let G=1<<this._width,te=k/G<<1,ee,X;const le=this._bitrev;if(te===4)for(ee=0,X=0;ee<k;ee+=te,++X){const Q=le[X];this._singleTransform2(C,M,ee,Q,G)}else for(ee=0,X=0;ee<k;ee+=te,++X){const Q=le[X];this._singleTransform4(C,M,ee,Q,G,A)}const ae=this.table;for(G>>=2;G>=2;G>>=2){te=k/G<<1;const Q=te>>>2;for(ee=0;ee<k;ee+=te){const ne=ee+Q-1;for(let de=ee,ve=0;de<ne;de+=2,ve+=G){const fe=de,j=fe+Q,U=j+Q,N=U+Q,q=M[fe],ce=M[fe+1],Z=M[j],Me=M[j+1],Pe=M[U],Ne=M[U+1],Oe=M[N],he=M[N+1],H=ae[ve],Te=A*ae[ve+1],ze=Z*H-Me*Te,Re=Z*Te+Me*H,He=ae[2*ve],Ke=A*ae[2*ve+1],Be=Pe*He-Ne*Ke,nt=Pe*Ke+Ne*He,$e=ae[3*ve],qe=A*ae[3*ve+1],_t=Oe*$e-he*qe,Je=Oe*qe+he*$e,pt=q+Be,dt=ce+nt,Gt=q-Be,vt=ce-nt,Ze=ze+_t,rt=Re+Je,kt=A*(ze-_t),Nt=A*(Re-Je);M[fe]=pt+Ze,M[fe+1]=dt+rt,M[j]=Gt+Nt,M[j+1]=vt-kt,M[U]=pt-Ze,M[U+1]=dt-rt,M[N]=Gt-Nt,M[N+1]=vt+kt}}}}_singleTransform2(M,C,A,k,R){const G=M[k],te=M[k+1],ee=M[k+R],X=M[k+R+1];C[A]=G+ee,C[A+1]=te+X,C[A+2]=G-ee,C[A+3]=te-X}_singleTransform4(M,C,A,k,R,G){const te=R*2,ee=R*3,X=M[k],le=M[k+1],ae=M[k+R],Q=M[k+R+1],ne=M[k+te],de=M[k+te+1],ve=M[k+ee],fe=M[k+ee+1],j=X+ne,U=le+de,N=X-ne,q=le-de,ce=ae+ve,Z=Q+fe,Me=G*(ae-ve),Pe=G*(Q-fe);C[A]=j+ce,C[A+1]=U+Z,C[A+2]=N+Pe,C[A+3]=q-Me,C[A+4]=j-ce,C[A+5]=U-Z,C[A+6]=N-Pe,C[A+7]=q+Me}_realTransform4(M,C,A){const k=this._csize;let G=1<<this._width,te=k/G<<1,ee,X;const le=this._bitrev;if(te===4)for(ee=0,X=0;ee<k;ee+=te,++X){const ne=le[X];this._singleRealTransform2(C,M,ee,ne>>>1,G>>>1)}else for(ee=0,X=0;ee<k;ee+=te,++X){const ne=le[X];this._singleRealTransform4(C,M,ee,ne>>>1,G>>>1,A)}const ae=this.table;for(G>>=2;G>=2;G>>=2){te=k/G<<1;const ne=te>>>1,de=ne>>>1,ve=de>>>1;for(ee=0;ee<k;ee+=te)for(let fe=0,j=0;fe<=ve;fe+=2,j+=G){const U=ee+fe,N=U+de,q=N+de,ce=q+de,Z=M[U],Me=M[U+1],Pe=M[N],Ne=M[N+1],Oe=M[q],he=M[q+1],H=M[ce],Te=M[ce+1],ze=Z,Re=Me,He=ae[j],Ke=A*ae[j+1],Be=Pe*He-Ne*Ke,nt=Pe*Ke+Ne*He,$e=ae[2*j],qe=A*ae[2*j+1],_t=Oe*$e-he*qe,Je=Oe*qe+he*$e,pt=ae[3*j],dt=A*ae[3*j+1],Gt=H*pt-Te*dt,vt=H*dt+Te*pt,Ze=ze+_t,rt=Re+Je,kt=ze-_t,Nt=Re-Je,gn=Be+Gt,Jt=nt+vt,Cn=A*(Be-Gt),Fn=A*(nt-vt);if(M[U]=Ze+gn,M[U+1]=rt+Jt,M[N]=kt+Fn,M[N+1]=Nt-Cn,fe===0){M[q]=Ze-gn,M[q+1]=rt-Jt;continue}if(fe===ve)continue;const tn=ee+de-fe,ta=ee+ne-fe;M[tn]=kt-A*Fn,M[tn+1]=-Nt-A*Cn,M[ta]=Ze-A*gn,M[ta+1]=-rt+A*Jt}}const Q=k>>>1;for(let ne=2;ne<Q;ne+=2)M[k-ne]=M[ne],M[k-ne+1]=-M[ne+1]}_singleRealTransform2(M,C,A,k,R){const G=M[k],te=M[k+R];C[A]=G+te,C[A+1]=0,C[A+2]=G-te,C[A+3]=0}_singleRealTransform4(M,C,A,k,R,G){const te=R*2,ee=R*3,X=M[k],le=M[k+R],ae=M[k+te],Q=M[k+ee],ne=X+ae,de=X-ae,ve=le+Q,fe=G*(le-Q);C[A]=ne+ve,C[A+1]=0,C[A+2]=de,C[A+3]=-fe,C[A+4]=ne-ve,C[A+5]=0,C[A+6]=de,C[A+7]=fe}}class v{constructor(M){const C=2*(M-1),A=2*(2*M-1),k=2**Math.ceil(Math.log2(A));this.bufferSize=k,this._a=C;const R=new Float64Array(A),G=new Float64Array(k);this._chirpBuffer=new Float64Array(k),this._buffer1=new Float64Array(k),this._buffer2=new Float64Array(k),this._outBuffer1=new Float64Array(k),this._outBuffer2=new Float64Array(k);const te=-2*Math.PI/M,ee=Math.cos(te),X=Math.sin(te);for(let le=0;le<A>>1;++le){const ae=(le+1-M)**2/2,Q=Math.sqrt(ee**2+X**2)**ae,ne=ae*Math.atan2(X,ee),de=2*le;R[de]=Q*Math.cos(ne),R[de+1]=Q*Math.sin(ne),G[de]=R[de],G[de+1]=-R[de+1]}this._slicedChirpBuffer=R.subarray(C,A),this._f=new y(k>>1),this._f.transform(this._chirpBuffer,G)}_transform(M,C,A){const k=this._buffer1,R=this._buffer2,G=this._outBuffer1,te=this._outBuffer2,ee=this._chirpBuffer,X=this._slicedChirpBuffer,le=this._a;if(A)for(let ae=0;ae<X.length;ae+=2){const Q=ae+1,ne=ae>>1,de=C[ne];k[ae]=de*X[ae],k[Q]=de*X[Q]}else for(let ae=0;ae<X.length;ae+=2){const Q=ae+1;k[ae]=C[ae]*X[ae]-C[Q]*X[Q],k[Q]=C[ae]*X[Q]+C[Q]*X[ae]}this._f.transform(G,k);for(let ae=0;ae<ee.length;ae+=2){const Q=ae+1;R[ae]=G[ae]*ee[ae]-G[Q]*ee[Q],R[Q]=G[ae]*ee[Q]+G[Q]*ee[ae]}this._f.inverseTransform(te,R);for(let ae=0;ae<te.length;ae+=2){const Q=te[ae+le],ne=te[ae+le+1],de=X[ae],ve=X[ae+1];M[ae]=Q*de-ne*ve,M[ae+1]=Q*ve+ne*de}}transform(M,C){this._transform(M,C,!1)}realTransform(M,C){this._transform(M,C,!0)}}class T{constructor(M){this.fft_length=M,this.isPowerOfTwo=m(M),this.isPowerOfTwo?(this.fft=new y(M),this.outputBufferSize=2*M):(this.fft=new v(M),this.outputBufferSize=this.fft.bufferSize)}realTransform(M,C){this.fft.realTransform(M,C)}transform(M,C){this.fft.transform(M,C)}}function O(I,M){if(M%2===0||M<=0)throw new Error("Window size must be a positive odd number");const C=new I.constructor(I.length),A=new I.constructor(M),k=Math.floor(M/2);for(let R=0;R<I.length;++R){let G=0;for(let te=-k;te<=k;++te){let ee=R+te;ee<0?ee=Math.abs(ee):ee>=I.length&&(ee=2*(I.length-1)-ee),A[G++]=I[ee]}A.sort(),C[R]=A[k]}return C}function E(I,M){const C=Math.pow(10,M);return Math.round(I*C)/C}function S(I){const M=Math.round(I);return Math.abs(I)%1===.5?M%2===0?M:M-1:M}function D(I){const M=I.length,C=I[0].length,A=[M+1,C+1],k=Array.from({length:A[0]},()=>Array(A[1]).fill(1/0));k[0][0]=0;const R=Array.from({length:A[0]},()=>Array(A[1]).fill(-1));for(let le=1;le<A[1];++le)for(let ae=1;ae<A[0];++ae){const Q=k[ae-1][le-1],ne=k[ae-1][le],de=k[ae][le-1];let ve,fe;Q<ne&&Q<de?(ve=Q,fe=0):ne<Q&&ne<de?(ve=ne,fe=1):(ve=de,fe=2),k[ae][le]=I[ae-1][le-1]+ve,R[ae][le]=fe}for(let le=0;le<A[1];++le)R[0][le]=2;for(let le=0;le<A[0];++le)R[le][0]=1;let G=M,te=C,ee=[],X=[];for(;G>0||te>0;)switch(ee.push(G-1),X.push(te-1),R[G][te]){case 0:--G,--te;break;case 1:--G;break;case 2:--te;break;default:throw new Error(`Internal error in dynamic time warping. Unexpected trace[${G}, ${te}]. Please file a bug report.`)}return ee.reverse(),X.reverse(),[ee,X]}}),"./src/utils/tensor.js":((e,t,n)=>{n.r(t),n.d(t,{DataTypeMap:()=>c,Tensor:()=>d,cat:()=>C,full:()=>X,full_like:()=>le,interpolate:()=>g,interpolate_4d:()=>p,layer_norm:()=>S,matmul:()=>m,mean:()=>G,mean_pooling:()=>E,ones:()=>ae,ones_like:()=>Q,permute:()=>h,quantize_embeddings:()=>j,rand:()=>ve,randn:()=>fe,rfft:()=>y,slice:()=>O,stack:()=>A,std_mean:()=>R,topk:()=>v,zeros:()=>ne,zeros_like:()=>de});var s=n("./src/utils/maths.js"),i=n("./src/backends/onnx.js"),o=n("./src/ops/registry.js");const c=Object.freeze({float32:Float32Array,float16:typeof Float16Array<"u"?Float16Array:Uint16Array,float64:Float64Array,string:Array,int8:Int8Array,uint8:Uint8Array,int16:Int16Array,uint16:Uint16Array,int32:Int32Array,uint32:Uint32Array,int64:BigInt64Array,uint64:BigUint64Array,bool:Uint8Array,uint4:Uint8Array,int4:Int8Array});class d{constructor(...N){ge(this,"ort_tensor");return(0,i.isONNXTensor)(N[0])?this.ort_tensor=N[0]:this.ort_tensor=new i.Tensor(N[0],N[1],N[2]),new Proxy(this,{get:(q,ce)=>{if(typeof ce=="string"){let Z=Number(ce);if(Number.isInteger(Z))return q._getitem(Z)}return q[ce]},set:(q,ce,Z)=>q[ce]=Z})}get dims(){return this.ort_tensor.dims}set dims(N){this.ort_tensor.dims=N}get type(){return this.ort_tensor.type}get data(){return this.ort_tensor.data}get size(){return this.ort_tensor.size}get location(){return this.ort_tensor.location}dispose(){this.ort_tensor.dispose()}*[Symbol.iterator](){const[N,...q]=this.dims;if(q.length>0){const ce=q.reduce((Z,Me)=>Z*Me);for(let Z=0;Z<N;++Z)yield this._subarray(Z,ce,q)}else yield*this.data}_getitem(N){const[q,...ce]=this.dims;if(N=M(N,q),ce.length>0){const Z=ce.reduce((Me,Pe)=>Me*Pe);return this._subarray(N,Z,ce)}else return new d(this.type,[this.data[N]],ce)}indexOf(N){const q=this.data;for(let ce=0;ce<q.length;++ce)if(q[ce]==N)return ce;return-1}_subarray(N,q,ce){const Z=N*q,Me=(N+1)*q,Pe="subarray"in this.data?this.data.subarray(Z,Me):this.data.slice(Z,Me);return new d(this.type,Pe,ce)}item(){const N=this.data;if(N.length!==1)throw new Error(`a Tensor with ${N.length} elements cannot be converted to Scalar`);return N[0]}tolist(){return u(this.data,this.dims)}sigmoid(){return this.clone().sigmoid_()}sigmoid_(){const N=this.data;for(let q=0;q<N.length;++q)N[q]=1/(1+Math.exp(-N[q]));return this}map(N){return this.clone().map_(N)}map_(N){const q=this.data;for(let ce=0;ce<q.length;++ce)q[ce]=N(q[ce],ce,q);return this}mul(N){return this.clone().mul_(N)}mul_(N){const q=this.data;for(let ce=0;ce<q.length;++ce)q[ce]*=N;return this}div(N){return this.clone().div_(N)}div_(N){const q=this.data;for(let ce=0;ce<q.length;++ce)q[ce]/=N;return this}add(N){return this.clone().add_(N)}add_(N){const q=this.data;for(let ce=0;ce<q.length;++ce)q[ce]+=N;return this}sub(N){return this.clone().sub_(N)}sub_(N){const q=this.data;for(let ce=0;ce<q.length;++ce)q[ce]-=N;return this}clone(){return new d(this.type,this.data.slice(),this.dims.slice())}slice(...N){const q=[],ce=[];for(let H=0;H<this.dims.length;++H){let Te=N[H];if(Te==null)ce.push([0,this.dims[H]]),q.push(this.dims[H]);else if(typeof Te=="number")Te=M(Te,this.dims[H],H),ce.push([Te,Te+1]);else if(Array.isArray(Te)&&Te.length===2){let[ze,Re]=Te;if(ze=ze===null?0:M(ze,this.dims[H],H,!1),Re=Re===null?this.dims[H]:M(Re,this.dims[H],H,!1),ze>Re)throw new Error(`Invalid slice: ${Te}`);const He=[Math.max(ze,0),Math.min(Re,this.dims[H])];ce.push(He),q.push(He[1]-He[0])}else throw new Error(`Invalid slice: ${Te}`)}const Z=ce.map(([H,Te])=>Te-H),Me=Z.reduce((H,Te)=>H*Te),Pe=this.data,Ne=new Pe.constructor(Me),Oe=this.stride();let he=!0;for(let H=1;H<Z.length;++H)if(ce[H][0]!==0||ce[H][1]!==this.dims[H]){he=!1;break}if(he){const H=ce[0][0]*Oe[0],Te=ce[0][1]*Oe[0];if(ArrayBuffer.isView(Pe))Ne.set(Pe.subarray(H,Te));else if(Array.isArray(Pe)){const ze=Pe.slice(H,Te);for(let Re=0;Re<ze.length;++Re)Ne[Re]=ze[Re]}else throw new Error("Unsupported data type for slicing")}else for(let H=0;H<Me;++H){let Te=0;for(let ze=Z.length-1,Re=H;ze>=0;--ze){const He=Z[ze];Te+=(Re%He+ce[ze][0])*Oe[ze],Re=Math.floor(Re/He)}Ne[H]=Pe[Te]}return new d(this.type,Ne,q)}permute(...N){return h(this,N)}transpose(...N){return this.permute(...N)}sum(N=null,q=!1){return this.norm(1,N,q)}norm(N="fro",q=null,ce=!1){if(N==="fro")N=2;else if(typeof N=="string")throw Error(`Unsupported norm: ${N}`);const Z=this.data,Me=(he,H)=>he+H**N;if(q===null){const he=Z.reduce(Me,0)**(1/N);return new d(this.type,[he],[])}const[Pe,Ne,Oe]=k(Me,this,q,ce);if(N!==1)for(let he=0;he<Ne.length;++he)Ne[he]=Ne[he]**(1/N);return new d(Pe,Ne,Oe)}normalize_(N=2,q=1){q=M(q,this.dims.length);const ce=this.norm(N,q,!0),Z=this.data,Me=ce.data;for(let Pe=0;Pe<Z.length;++Pe){let Ne=0;for(let Oe=this.dims.length-1,he=Pe,H=1;Oe>=0;--Oe){const Te=this.dims[Oe];if(Oe!==q){const ze=he%Te;Ne+=ze*H,H*=this.dims[Oe]}he=Math.floor(he/Te)}Z[Pe]/=Me[Ne]}return this}normalize(N=2,q=1){return this.clone().normalize_(N,q)}stride(){return te(this.dims)}squeeze(N=null){return new d(this.type,this.data,D(this.dims,N))}squeeze_(N=null){return this.dims=D(this.dims,N),this}unsqueeze(N=null){return new d(this.type,this.data,I(this.dims,N))}unsqueeze_(N=null){return this.dims=I(this.dims,N),this}flatten_(N=0,q=-1){q=(q+this.dims.length)%this.dims.length;let ce=this.dims.slice(0,N),Z=this.dims.slice(N,q+1),Me=this.dims.slice(q+1);return this.dims=[...ce,Z.reduce((Pe,Ne)=>Pe*Ne,1),...Me],this}flatten(N=0,q=-1){return this.clone().flatten_(N,q)}view(...N){let q=-1;for(let Z=0;Z<N.length;++Z)if(N[Z]===-1){if(q!==-1)throw new Error("Only one dimension can be inferred");q=Z}const ce=this.data;if(q!==-1){const Z=N.reduce((Me,Pe,Ne)=>Ne!==q?Me*Pe:Me,1);N[q]=ce.length/Z}return new d(this.type,ce,N)}neg_(){const N=this.data;for(let q=0;q<N.length;++q)N[q]=-N[q];return this}neg(){return this.clone().neg_()}gt(N){const q=new Uint8Array(this.data.length),ce=this.data;for(let Z=0;Z<ce.length;++Z)q[Z]=ce[Z]>N?1:0;return new d("bool",q,this.dims)}lt(N){const q=new Uint8Array(this.data.length),ce=this.data;for(let Z=0;Z<ce.length;++Z)q[Z]=ce[Z]<N?1:0;return new d("bool",q,this.dims)}clamp_(N,q){const ce=this.data;for(let Z=0;Z<ce.length;++Z)ce[Z]=Math.min(Math.max(ce[Z],N),q);return this}clamp(N,q){return this.clone().clamp_(N,q)}round_(){const N=this.data;for(let q=0;q<N.length;++q)N[q]=Math.round(N[q]);return this}round(){return this.clone().round_()}mean(N=null,q=!1){return G(this,N,q)}min(N=null,q=!1){if(N===null){const Pe=(0,s.min)(this.data)[0];return new d(this.type,[Pe],[])}const[ce,Z,Me]=k((Pe,Ne)=>Math.min(Pe,Ne),this,N,q,1/0);return new d(ce,Z,Me)}max(N=null,q=!1){if(N===null){const Pe=(0,s.max)(this.data)[0];return new d(this.type,[Pe],[])}const[ce,Z,Me]=k((Pe,Ne)=>Math.max(Pe,Ne),this,N,q,-1/0);return new d(ce,Z,Me)}argmin(N=null,q=!1){if(N!==null)throw new Error("`dim !== null` not yet implemented.");const ce=(0,s.min)(this.data)[1];return new d("int64",[BigInt(ce)],[])}argmax(N=null,q=!1){if(N!==null)throw new Error("`dim !== null` not yet implemented.");const ce=(0,s.max)(this.data)[1];return new d("int64",[BigInt(ce)],[])}to(N){if(this.type===N)return this;if(!c.hasOwnProperty(N))throw new Error(`Unsupported type: ${N}`);let q;const ce=["int64","uint64"].includes(this.type),Z=["int64","uint64"].includes(N);return ce&&!Z?q=Number:!ce&&Z&&(["float16","float32","float64"].includes(this.type)?q=Me=>BigInt(Math.floor(Me)):q=BigInt),new d(N,c[N].from(this.data,q),this.dims)}}function u(U,N){const q=U.length,ce=N.reduce((Me,Pe)=>Me*Pe);if(q!==ce)throw Error(`cannot reshape array of size ${q} into shape (${N})`);let Z=U;for(let Me=N.length-1;Me>=0;Me--)Z=Z.reduce((Pe,Ne)=>{let Oe=Pe[Pe.length-1];return Oe.length<N[Me]?Oe.push(Ne):Pe.push([Ne]),Pe},[[]]);return Z[0]}function h(U,N){const[q,ce]=(0,s.permute_data)(U.data,U.dims,N);return new d(U.type,q,ce)}function g(U,[N,q],ce="bilinear",Z=!1){const Me=U.dims.at(-3)??1,Pe=U.dims.at(-2),Ne=U.dims.at(-1);let Oe=(0,s.interpolate_data)(U.data,[Me,Pe,Ne],[N,q],ce,Z);return new d(U.type,Oe,[Me,N,q])}async function p(U,{size:N=null,mode:q="bilinear"}={}){if(U.dims.length!==4)throw new Error("`interpolate_4d` currently only supports 4D input.");if(!N)throw new Error("`interpolate_4d` requires a `size` argument.");let ce;if(N.length===2)ce=[...U.dims.slice(0,2),...N];else if(N.length===3)ce=[U.dims[0],...N];else if(N.length===4)ce=N;else throw new Error("`size` must be of length 2, 3, or 4.");let Z;if(q==="nearest")Z=await o.TensorOpRegistry.nearest_interpolate_4d;else if(q==="bilinear")Z=await o.TensorOpRegistry.bilinear_interpolate_4d;else if(q==="bicubic")Z=await o.TensorOpRegistry.bicubic_interpolate_4d;else throw new Error(`Unsupported mode: ${q}`);const Me=new d("int64",new BigInt64Array(ce.map(BigInt)),[ce.length]);return await Z({x:U,s:Me})}async function m(U,N){return await(await o.TensorOpRegistry.matmul)({a:U,b:N})}async function y(U,N){return await(await o.TensorOpRegistry.rfft)({x:U,a:N})}async function v(U,N){const q=await o.TensorOpRegistry.top_k;return N==null?N=U.dims.at(-1):N=Math.min(N,U.dims.at(-1)),await q({x:U,k:new d("int64",[BigInt(N)],[1])})}const T=U=>new d("int64",U,[U.length]);async function O(U,N,q,ce,Z){return await(await o.TensorOpRegistry.slice)({x:U,s:T(N),e:T(q),a:T(ce),t:T(Z??new Array(ce.length).fill(1))})}function E(U,N){const q=U.data,ce=N.data,Z=[U.dims[0],U.dims[2]],Me=new q.constructor(Z[0]*Z[1]),[Pe,Ne,Oe]=U.dims;let he=0;for(let H=0;H<Pe;++H){const Te=H*Oe*Ne;for(let ze=0;ze<Oe;++ze){let Re=0,He=0;const Ke=H*Ne,Be=Te+ze;for(let $e=0;$e<Ne;++$e){const qe=Number(ce[Ke+$e]);He+=qe,Re+=q[Be+$e*Oe]*qe}const nt=Re/He;Me[he++]=nt}}return new d(U.type,Me,Z)}function S(U,N,{eps:q=1e-5}={}){if(U.dims.length!==2)throw new Error("`layer_norm` currently only supports 2D input.");const[ce,Z]=U.dims;if(N.length!==1&&N[0]!==Z)throw new Error("`normalized_shape` must be a 1D array with shape `[input.dims[1]]`.");const[Me,Pe]=R(U,1,0,!0),Ne=Me.data,Oe=Pe.data,he=U.data,H=new he.constructor(he.length);for(let Te=0;Te<ce;++Te){const ze=Te*Z;for(let Re=0;Re<Z;++Re){const He=ze+Re;H[He]=(he[He]-Oe[Te])/(Ne[Te]+q)}}return new d(U.type,H,U.dims)}function D(U,N){return U=U.slice(),N===null?U=U.filter(q=>q!==1):typeof N=="number"?U[N]===1&&U.splice(N,1):Array.isArray(N)&&(U=U.filter((q,ce)=>q!==1||!N.includes(ce))),U}function I(U,N){return N=M(N,U.length+1),U=U.slice(),U.splice(N,0,1),U}function M(U,N,q=null,ce=!0){if(U<-N||U>=N){if(ce)throw new Error(`IndexError: index ${U} is out of bounds for dimension${q===null?"":" "+q} with size ${N}`);return U<-N?0:N}return U<0&&(U=(U%N+N)%N),U}function C(U,N=0){N=M(N,U[0].dims.length);const q=U[0].dims.slice();q[N]=U.reduce((Pe,Ne)=>Pe+Ne.dims[N],0);const ce=q.reduce((Pe,Ne)=>Pe*Ne,1),Z=new U[0].data.constructor(ce),Me=U[0].type;if(N===0){let Pe=0;for(const Ne of U){const Oe=Ne.data;Z.set(Oe,Pe),Pe+=Oe.length}}else{let Pe=0;for(let Ne=0;Ne<U.length;++Ne){const{data:Oe,dims:he}=U[Ne];for(let H=0;H<Oe.length;++H){let Te=0;for(let ze=he.length-1,Re=H,He=1;ze>=0;--ze){const Ke=he[ze];let Be=Re%Ke;ze===N&&(Be+=Pe),Te+=Be*He,He*=q[ze],Re=Math.floor(Re/Ke)}Z[Te]=Oe[H]}Pe+=he[N]}}return new d(Me,Z,q)}function A(U,N=0){return C(U.map(q=>q.unsqueeze(N)),N)}function k(U,N,q=null,ce=!1,Z=null){const Me=N.data,Pe=N.dims;q=M(q,Pe.length);const Ne=Pe.slice();Ne[q]=1;const Oe=new Me.constructor(Me.length/Pe[q]);Z!==null&&Oe.fill(Z);for(let he=0;he<Me.length;++he){let H=0;for(let Te=Pe.length-1,ze=he,Re=1;Te>=0;--Te){const He=Pe[Te];if(Te!==q){const Ke=ze%He;H+=Ke*Re,Re*=Ne[Te]}ze=Math.floor(ze/He)}Oe[H]=U(Oe[H],Me[he],he,H)}return ce||Ne.splice(q,1),[N.type,Oe,Ne]}function R(U,N=null,q=1,ce=!1){const Z=U.data,Me=U.dims;if(N===null){const Re=Z.reduce((nt,$e)=>nt+$e,0)/Z.length,He=Math.sqrt(Z.reduce((nt,$e)=>nt+($e-Re)**2,0)/(Z.length-q)),Ke=new d(U.type,[Re],[]);return[new d(U.type,[He],[]),Ke]}N=M(N,Me.length);const Pe=G(U,N,ce),Ne=Pe.data,[Oe,he,H]=k((ze,Re,He,Ke)=>ze+(Re-Ne[Ke])**2,U,N,ce);for(let ze=0;ze<he.length;++ze)he[ze]=Math.sqrt(he[ze]/(Me[N]-q));return[new d(Oe,he,H),Pe]}function G(U,N=null,q=!1){const ce=U.dims,Z=U.data;if(N===null){const Oe=Z.reduce((he,H)=>he+H,0);return new d(U.type,[Oe/Z.length],[])}N=M(N,ce.length);const[Me,Pe,Ne]=k((Oe,he)=>Oe+he,U,N,q);if(ce[N]!==1)for(let Oe=0;Oe<Pe.length;++Oe)Pe[Oe]/=ce[N];return new d(Me,Pe,Ne)}function te(U){const N=new Array(U.length);for(let q=U.length-1,ce=1;q>=0;--q)N[q]=ce,ce*=U[q];return N}function ee(U,N,q,ce){const Z=U.reduce((Me,Pe)=>Me*Pe,1);return new d(q,new ce(Z).fill(N),U)}function X(U,N){let q,ce;if(typeof N=="number")q="float32",ce=Float32Array;else if(typeof N=="bigint")q="int64",ce=BigInt64Array;else if(typeof N=="boolean")q="bool",ce=Uint8Array;else throw new Error(`Unsupported data type: ${typeof N}`);return ee(U,N,q,ce)}function le(U,N){return X(U.dims,N)}function ae(U){return ee(U,1n,"int64",BigInt64Array)}function Q(U){return ae(U.dims)}function ne(U){return ee(U,0n,"int64",BigInt64Array)}function de(U){return ne(U.dims)}function ve(U){const N=U.reduce((q,ce)=>q*ce,1);return new d("float32",Float32Array.from({length:N},()=>Math.random()),U)}function fe(U){const N=U.reduce((ce,Z)=>ce*Z,1);function q(){const ce=1-Math.random(),Z=1-Math.random();return Math.sqrt(-2*Math.log(ce))*Math.cos(2*Math.PI*Z)}return new d("float32",Float32Array.from({length:N},()=>q()),U)}function j(U,N){if(U.dims.length!==2)throw new Error("The tensor must have 2 dimensions");if(U.dims.at(-1)%8!==0)throw new Error("The last dimension of the tensor must be a multiple of 8");if(!["binary","ubinary"].includes(N))throw new Error("The precision must be either 'binary' or 'ubinary'");const q=N==="binary",ce=q?"int8":"uint8",Z=q?Int8Array:Uint8Array,Me=U.data,Pe=new Z(Me.length/8);for(let Ne=0;Ne<Me.length;++Ne){const Oe=Me[Ne]>0?1:0,he=Math.floor(Ne/8),H=Ne%8;Pe[he]|=Oe<<7-H,q&&H===0&&(Pe[he]-=128)}return new d(ce,Pe,[U.dims[0],U.dims[1]/8])}}),"./src/utils/video.js":((e,t,n)=>{n.r(t),n.d(t,{RawVideo:()=>c,RawVideoFrame:()=>o,load_video:()=>d});var s=n("./src/utils/image.js"),i=n("./src/env.js");class o{constructor(h,g){this.image=h,this.timestamp=g}}class c{constructor(h,g){h.length>0&&h[0]instanceof s.RawImage&&(h=h.map((p,m)=>new o(p,(m+1)/(h.length+1)*g))),this.frames=h,this.duration=g}get width(){return this.frames[0].image.width}get height(){return this.frames[0].image.height}get fps(){return this.frames.length/this.duration}}async function d(u,{num_frames:h=null,fps:g=null}={}){if(!i.apis.IS_BROWSER_ENV)throw new Error("`load_video` is currently only supported in browser environments.");if(h==null&&g==null)throw new Error("Either num_frames or fps must be provided.");const p=[],m=document.createElement("video");if(m.crossOrigin="anonymous",m.muted=!0,typeof u=="string")m.src=u;else if(u instanceof Blob)m.src=URL.createObjectURL(u);else if(u instanceof HTMLVideoElement)m.src=u.src;else throw new Error("Invalid URL or video element provided.");if(await new Promise(D=>m.onloadedmetadata=D),m.seekable.start(0)===m.seekable.end(0)){const I=await(await fetch(m.src)).blob();m.src=URL.createObjectURL(I),await new Promise(M=>m.onloadedmetadata=M)}const y=m.duration;let v,T;h!=null?(v=h,T=h===1?0:y/(h-1)):(T=1/g,v=Math.floor(y/T));let O=[];for(let D=0;D<v;++D)O.push(h===1?y/2:D*T);const E=document.createElement("canvas");E.width=m.videoWidth,E.height=m.videoHeight;const S=E.getContext("2d",{willReadFrequently:!0});for(const D of O){m.currentTime=D,await new Promise(A=>{m.onseeked=A}),S.drawImage(m,0,0,E.width,E.height);const I=S.getImageData(0,0,E.width,E.height),M=new s.RawImage(I.data,E.width,E.height,4),C=new o(M,D);p.push(C)}return m.remove(),new c(p,y)}})},v1={};function zn(e){var t=v1[e];if(t!==void 0)return t.exports;var n=v1[e]={exports:{}};return HD[e](n,n.exports,zn),n.exports}(()=>{var e=Object.getPrototypeOf?n=>Object.getPrototypeOf(n):n=>n.__proto__,t;zn.t=function(n,s){if(s&1&&(n=this(n)),s&8||typeof n=="object"&&n&&(s&4&&n.__esModule||s&16&&typeof n.then=="function"))return n;var i=Object.create(null);zn.r(i);var o={};t=t||[null,e({}),e([]),e(e)];for(var c=s&2&&n;typeof c=="object"&&!~t.indexOf(c);c=e(c))Object.getOwnPropertyNames(c).forEach(d=>o[d]=()=>n[d]);return o.default=()=>n,zn.d(i,o),i}})();zn.d=(e,t)=>{for(var n in t)zn.o(t,n)&&!zn.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})};zn.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);zn.r=e=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var x={};(()=>{/*!*****************************!*\
  !*** ./src/transformers.js ***!
  \*****************************/zn.r(x),zn.d(x,{ASTFeatureExtractor:()=>p.ASTFeatureExtractor,ASTForAudioClassification:()=>n.ASTForAudioClassification,ASTModel:()=>n.ASTModel,ASTPreTrainedModel:()=>n.ASTPreTrainedModel,AlbertForMaskedLM:()=>n.AlbertForMaskedLM,AlbertForQuestionAnswering:()=>n.AlbertForQuestionAnswering,AlbertForSequenceClassification:()=>n.AlbertForSequenceClassification,AlbertModel:()=>n.AlbertModel,AlbertPreTrainedModel:()=>n.AlbertPreTrainedModel,AlbertTokenizer:()=>s.AlbertTokenizer,ArceeForCausalLM:()=>n.ArceeForCausalLM,ArceeModel:()=>n.ArceeModel,ArceePreTrainedModel:()=>n.ArceePreTrainedModel,AudioClassificationPipeline:()=>t.AudioClassificationPipeline,AutoConfig:()=>i.AutoConfig,AutoFeatureExtractor:()=>m.AutoFeatureExtractor,AutoImageProcessor:()=>T.AutoImageProcessor,AutoModel:()=>n.AutoModel,AutoModelForAudioClassification:()=>n.AutoModelForAudioClassification,AutoModelForAudioFrameClassification:()=>n.AutoModelForAudioFrameClassification,AutoModelForAudioTextToText:()=>n.AutoModelForAudioTextToText,AutoModelForCTC:()=>n.AutoModelForCTC,AutoModelForCausalLM:()=>n.AutoModelForCausalLM,AutoModelForDepthEstimation:()=>n.AutoModelForDepthEstimation,AutoModelForDocumentQuestionAnswering:()=>n.AutoModelForDocumentQuestionAnswering,AutoModelForImageClassification:()=>n.AutoModelForImageClassification,AutoModelForImageFeatureExtraction:()=>n.AutoModelForImageFeatureExtraction,AutoModelForImageMatting:()=>n.AutoModelForImageMatting,AutoModelForImageSegmentation:()=>n.AutoModelForImageSegmentation,AutoModelForImageTextToText:()=>n.AutoModelForImageTextToText,AutoModelForImageToImage:()=>n.AutoModelForImageToImage,AutoModelForMaskGeneration:()=>n.AutoModelForMaskGeneration,AutoModelForMaskedLM:()=>n.AutoModelForMaskedLM,AutoModelForNormalEstimation:()=>n.AutoModelForNormalEstimation,AutoModelForObjectDetection:()=>n.AutoModelForObjectDetection,AutoModelForPoseEstimation:()=>n.AutoModelForPoseEstimation,AutoModelForQuestionAnswering:()=>n.AutoModelForQuestionAnswering,AutoModelForSemanticSegmentation:()=>n.AutoModelForSemanticSegmentation,AutoModelForSeq2SeqLM:()=>n.AutoModelForSeq2SeqLM,AutoModelForSequenceClassification:()=>n.AutoModelForSequenceClassification,AutoModelForSpeechSeq2Seq:()=>n.AutoModelForSpeechSeq2Seq,AutoModelForTextToSpectrogram:()=>n.AutoModelForTextToSpectrogram,AutoModelForTextToWaveform:()=>n.AutoModelForTextToWaveform,AutoModelForTokenClassification:()=>n.AutoModelForTokenClassification,AutoModelForUniversalSegmentation:()=>n.AutoModelForUniversalSegmentation,AutoModelForVision2Seq:()=>n.AutoModelForVision2Seq,AutoModelForXVector:()=>n.AutoModelForXVector,AutoModelForZeroShotObjectDetection:()=>n.AutoModelForZeroShotObjectDetection,AutoProcessor:()=>S.AutoProcessor,AutoTokenizer:()=>s.AutoTokenizer,AutomaticSpeechRecognitionPipeline:()=>t.AutomaticSpeechRecognitionPipeline,BackgroundRemovalPipeline:()=>t.BackgroundRemovalPipeline,BartForConditionalGeneration:()=>n.BartForConditionalGeneration,BartForSequenceClassification:()=>n.BartForSequenceClassification,BartModel:()=>n.BartModel,BartPretrainedModel:()=>n.BartPretrainedModel,BartTokenizer:()=>s.BartTokenizer,BaseModelOutput:()=>n.BaseModelOutput,BaseStreamer:()=>D.BaseStreamer,BeitFeatureExtractor:()=>v.BeitFeatureExtractor,BeitForImageClassification:()=>n.BeitForImageClassification,BeitModel:()=>n.BeitModel,BeitPreTrainedModel:()=>n.BeitPreTrainedModel,BertForMaskedLM:()=>n.BertForMaskedLM,BertForQuestionAnswering:()=>n.BertForQuestionAnswering,BertForSequenceClassification:()=>n.BertForSequenceClassification,BertForTokenClassification:()=>n.BertForTokenClassification,BertModel:()=>n.BertModel,BertPreTrainedModel:()=>n.BertPreTrainedModel,BertTokenizer:()=>s.BertTokenizer,BitImageProcessor:()=>v.BitImageProcessor,BlenderbotForConditionalGeneration:()=>n.BlenderbotForConditionalGeneration,BlenderbotModel:()=>n.BlenderbotModel,BlenderbotPreTrainedModel:()=>n.BlenderbotPreTrainedModel,BlenderbotSmallForConditionalGeneration:()=>n.BlenderbotSmallForConditionalGeneration,BlenderbotSmallModel:()=>n.BlenderbotSmallModel,BlenderbotSmallPreTrainedModel:()=>n.BlenderbotSmallPreTrainedModel,BlenderbotSmallTokenizer:()=>s.BlenderbotSmallTokenizer,BlenderbotTokenizer:()=>s.BlenderbotTokenizer,BloomForCausalLM:()=>n.BloomForCausalLM,BloomModel:()=>n.BloomModel,BloomPreTrainedModel:()=>n.BloomPreTrainedModel,BloomTokenizer:()=>s.BloomTokenizer,CLIPFeatureExtractor:()=>v.CLIPFeatureExtractor,CLIPImageProcessor:()=>v.CLIPImageProcessor,CLIPModel:()=>n.CLIPModel,CLIPPreTrainedModel:()=>n.CLIPPreTrainedModel,CLIPSegForImageSegmentation:()=>n.CLIPSegForImageSegmentation,CLIPSegModel:()=>n.CLIPSegModel,CLIPSegPreTrainedModel:()=>n.CLIPSegPreTrainedModel,CLIPTextModel:()=>n.CLIPTextModel,CLIPTextModelWithProjection:()=>n.CLIPTextModelWithProjection,CLIPTokenizer:()=>s.CLIPTokenizer,CLIPVisionModel:()=>n.CLIPVisionModel,CLIPVisionModelWithProjection:()=>n.CLIPVisionModelWithProjection,CamembertForMaskedLM:()=>n.CamembertForMaskedLM,CamembertForQuestionAnswering:()=>n.CamembertForQuestionAnswering,CamembertForSequenceClassification:()=>n.CamembertForSequenceClassification,CamembertForTokenClassification:()=>n.CamembertForTokenClassification,CamembertModel:()=>n.CamembertModel,CamembertPreTrainedModel:()=>n.CamembertPreTrainedModel,CamembertTokenizer:()=>s.CamembertTokenizer,CausalLMOutput:()=>n.CausalLMOutput,CausalLMOutputWithPast:()=>n.CausalLMOutputWithPast,ChineseCLIPFeatureExtractor:()=>v.ChineseCLIPFeatureExtractor,ChineseCLIPModel:()=>n.ChineseCLIPModel,ChineseCLIPPreTrainedModel:()=>n.ChineseCLIPPreTrainedModel,ClapAudioModelWithProjection:()=>n.ClapAudioModelWithProjection,ClapFeatureExtractor:()=>p.ClapFeatureExtractor,ClapModel:()=>n.ClapModel,ClapPreTrainedModel:()=>n.ClapPreTrainedModel,ClapTextModelWithProjection:()=>n.ClapTextModelWithProjection,ClassifierFreeGuidanceLogitsProcessor:()=>M.ClassifierFreeGuidanceLogitsProcessor,CodeGenForCausalLM:()=>n.CodeGenForCausalLM,CodeGenModel:()=>n.CodeGenModel,CodeGenPreTrainedModel:()=>n.CodeGenPreTrainedModel,CodeGenTokenizer:()=>s.CodeGenTokenizer,CodeLlamaTokenizer:()=>s.CodeLlamaTokenizer,CohereForCausalLM:()=>n.CohereForCausalLM,CohereModel:()=>n.CohereModel,CoherePreTrainedModel:()=>n.CoherePreTrainedModel,CohereTokenizer:()=>s.CohereTokenizer,ConvBertForMaskedLM:()=>n.ConvBertForMaskedLM,ConvBertForQuestionAnswering:()=>n.ConvBertForQuestionAnswering,ConvBertForSequenceClassification:()=>n.ConvBertForSequenceClassification,ConvBertForTokenClassification:()=>n.ConvBertForTokenClassification,ConvBertModel:()=>n.ConvBertModel,ConvBertPreTrainedModel:()=>n.ConvBertPreTrainedModel,ConvBertTokenizer:()=>s.ConvBertTokenizer,ConvNextFeatureExtractor:()=>v.ConvNextFeatureExtractor,ConvNextForImageClassification:()=>n.ConvNextForImageClassification,ConvNextImageProcessor:()=>v.ConvNextImageProcessor,ConvNextModel:()=>n.ConvNextModel,ConvNextPreTrainedModel:()=>n.ConvNextPreTrainedModel,ConvNextV2ForImageClassification:()=>n.ConvNextV2ForImageClassification,ConvNextV2Model:()=>n.ConvNextV2Model,ConvNextV2PreTrainedModel:()=>n.ConvNextV2PreTrainedModel,DFineForObjectDetection:()=>n.DFineForObjectDetection,DFineModel:()=>n.DFineModel,DFinePreTrainedModel:()=>n.DFinePreTrainedModel,DINOv3ConvNextModel:()=>n.DINOv3ConvNextModel,DINOv3ConvNextPreTrainedModel:()=>n.DINOv3ConvNextPreTrainedModel,DINOv3ViTImageProcessor:()=>v.DINOv3ViTImageProcessor,DINOv3ViTModel:()=>n.DINOv3ViTModel,DINOv3ViTPreTrainedModel:()=>n.DINOv3ViTPreTrainedModel,DPTFeatureExtractor:()=>v.DPTFeatureExtractor,DPTForDepthEstimation:()=>n.DPTForDepthEstimation,DPTImageProcessor:()=>v.DPTImageProcessor,DPTModel:()=>n.DPTModel,DPTPreTrainedModel:()=>n.DPTPreTrainedModel,DacDecoderModel:()=>n.DacDecoderModel,DacDecoderOutput:()=>n.DacDecoderOutput,DacEncoderModel:()=>n.DacEncoderModel,DacEncoderOutput:()=>n.DacEncoderOutput,DacFeatureExtractor:()=>p.DacFeatureExtractor,DacModel:()=>n.DacModel,DacPreTrainedModel:()=>n.DacPreTrainedModel,DataTypeMap:()=>u.DataTypeMap,DebertaForMaskedLM:()=>n.DebertaForMaskedLM,DebertaForQuestionAnswering:()=>n.DebertaForQuestionAnswering,DebertaForSequenceClassification:()=>n.DebertaForSequenceClassification,DebertaForTokenClassification:()=>n.DebertaForTokenClassification,DebertaModel:()=>n.DebertaModel,DebertaPreTrainedModel:()=>n.DebertaPreTrainedModel,DebertaTokenizer:()=>s.DebertaTokenizer,DebertaV2ForMaskedLM:()=>n.DebertaV2ForMaskedLM,DebertaV2ForQuestionAnswering:()=>n.DebertaV2ForQuestionAnswering,DebertaV2ForSequenceClassification:()=>n.DebertaV2ForSequenceClassification,DebertaV2ForTokenClassification:()=>n.DebertaV2ForTokenClassification,DebertaV2Model:()=>n.DebertaV2Model,DebertaV2PreTrainedModel:()=>n.DebertaV2PreTrainedModel,DebertaV2Tokenizer:()=>s.DebertaV2Tokenizer,DecisionTransformerModel:()=>n.DecisionTransformerModel,DecisionTransformerPreTrainedModel:()=>n.DecisionTransformerPreTrainedModel,DeiTFeatureExtractor:()=>v.DeiTFeatureExtractor,DeiTForImageClassification:()=>n.DeiTForImageClassification,DeiTImageProcessor:()=>v.DeiTImageProcessor,DeiTModel:()=>n.DeiTModel,DeiTPreTrainedModel:()=>n.DeiTPreTrainedModel,DepthAnythingForDepthEstimation:()=>n.DepthAnythingForDepthEstimation,DepthAnythingPreTrainedModel:()=>n.DepthAnythingPreTrainedModel,DepthEstimationPipeline:()=>t.DepthEstimationPipeline,DepthProForDepthEstimation:()=>n.DepthProForDepthEstimation,DepthProPreTrainedModel:()=>n.DepthProPreTrainedModel,DetrFeatureExtractor:()=>v.DetrFeatureExtractor,DetrForObjectDetection:()=>n.DetrForObjectDetection,DetrForSegmentation:()=>n.DetrForSegmentation,DetrImageProcessor:()=>v.DetrImageProcessor,DetrModel:()=>n.DetrModel,DetrObjectDetectionOutput:()=>n.DetrObjectDetectionOutput,DetrPreTrainedModel:()=>n.DetrPreTrainedModel,DetrSegmentationOutput:()=>n.DetrSegmentationOutput,Dinov2ForImageClassification:()=>n.Dinov2ForImageClassification,Dinov2Model:()=>n.Dinov2Model,Dinov2PreTrainedModel:()=>n.Dinov2PreTrainedModel,Dinov2WithRegistersForImageClassification:()=>n.Dinov2WithRegistersForImageClassification,Dinov2WithRegistersModel:()=>n.Dinov2WithRegistersModel,Dinov2WithRegistersPreTrainedModel:()=>n.Dinov2WithRegistersPreTrainedModel,DistilBertForMaskedLM:()=>n.DistilBertForMaskedLM,DistilBertForQuestionAnswering:()=>n.DistilBertForQuestionAnswering,DistilBertForSequenceClassification:()=>n.DistilBertForSequenceClassification,DistilBertForTokenClassification:()=>n.DistilBertForTokenClassification,DistilBertModel:()=>n.DistilBertModel,DistilBertPreTrainedModel:()=>n.DistilBertPreTrainedModel,DistilBertTokenizer:()=>s.DistilBertTokenizer,DocumentQuestionAnsweringPipeline:()=>t.DocumentQuestionAnsweringPipeline,DonutFeatureExtractor:()=>v.DonutFeatureExtractor,DonutImageProcessor:()=>v.DonutImageProcessor,DonutSwinModel:()=>n.DonutSwinModel,DonutSwinPreTrainedModel:()=>n.DonutSwinPreTrainedModel,EdgeTamModel:()=>n.EdgeTamModel,EfficientNetForImageClassification:()=>n.EfficientNetForImageClassification,EfficientNetImageProcessor:()=>v.EfficientNetImageProcessor,EfficientNetModel:()=>n.EfficientNetModel,EfficientNetPreTrainedModel:()=>n.EfficientNetPreTrainedModel,ElectraForMaskedLM:()=>n.ElectraForMaskedLM,ElectraForQuestionAnswering:()=>n.ElectraForQuestionAnswering,ElectraForSequenceClassification:()=>n.ElectraForSequenceClassification,ElectraForTokenClassification:()=>n.ElectraForTokenClassification,ElectraModel:()=>n.ElectraModel,ElectraPreTrainedModel:()=>n.ElectraPreTrainedModel,ElectraTokenizer:()=>s.ElectraTokenizer,EncodecFeatureExtractor:()=>p.EncodecFeatureExtractor,EosTokenCriteria:()=>I.EosTokenCriteria,Ernie4_5ForCausalLM:()=>n.Ernie4_5ForCausalLM,Ernie4_5Model:()=>n.Ernie4_5Model,Ernie4_5PreTrainedModel:()=>n.Ernie4_5PreTrainedModel,EsmForMaskedLM:()=>n.EsmForMaskedLM,EsmForSequenceClassification:()=>n.EsmForSequenceClassification,EsmForTokenClassification:()=>n.EsmForTokenClassification,EsmModel:()=>n.EsmModel,EsmPreTrainedModel:()=>n.EsmPreTrainedModel,EsmTokenizer:()=>s.EsmTokenizer,ExaoneForCausalLM:()=>n.ExaoneForCausalLM,ExaoneModel:()=>n.ExaoneModel,ExaonePreTrainedModel:()=>n.ExaonePreTrainedModel,FFT:()=>h.FFT,FalconForCausalLM:()=>n.FalconForCausalLM,FalconModel:()=>n.FalconModel,FalconPreTrainedModel:()=>n.FalconPreTrainedModel,FalconTokenizer:()=>s.FalconTokenizer,FastViTForImageClassification:()=>n.FastViTForImageClassification,FastViTModel:()=>n.FastViTModel,FastViTPreTrainedModel:()=>n.FastViTPreTrainedModel,FeatureExtractionPipeline:()=>t.FeatureExtractionPipeline,FeatureExtractor:()=>g.FeatureExtractor,FillMaskPipeline:()=>t.FillMaskPipeline,Florence2ForConditionalGeneration:()=>n.Florence2ForConditionalGeneration,Florence2PreTrainedModel:()=>n.Florence2PreTrainedModel,Florence2Processor:()=>E.Florence2Processor,ForcedBOSTokenLogitsProcessor:()=>M.ForcedBOSTokenLogitsProcessor,ForcedEOSTokenLogitsProcessor:()=>M.ForcedEOSTokenLogitsProcessor,GLPNFeatureExtractor:()=>v.GLPNFeatureExtractor,GLPNForDepthEstimation:()=>n.GLPNForDepthEstimation,GLPNModel:()=>n.GLPNModel,GLPNPreTrainedModel:()=>n.GLPNPreTrainedModel,GPT2LMHeadModel:()=>n.GPT2LMHeadModel,GPT2Model:()=>n.GPT2Model,GPT2PreTrainedModel:()=>n.GPT2PreTrainedModel,GPT2Tokenizer:()=>s.GPT2Tokenizer,GPTBigCodeForCausalLM:()=>n.GPTBigCodeForCausalLM,GPTBigCodeModel:()=>n.GPTBigCodeModel,GPTBigCodePreTrainedModel:()=>n.GPTBigCodePreTrainedModel,GPTJForCausalLM:()=>n.GPTJForCausalLM,GPTJModel:()=>n.GPTJModel,GPTJPreTrainedModel:()=>n.GPTJPreTrainedModel,GPTNeoForCausalLM:()=>n.GPTNeoForCausalLM,GPTNeoModel:()=>n.GPTNeoModel,GPTNeoPreTrainedModel:()=>n.GPTNeoPreTrainedModel,GPTNeoXForCausalLM:()=>n.GPTNeoXForCausalLM,GPTNeoXModel:()=>n.GPTNeoXModel,GPTNeoXPreTrainedModel:()=>n.GPTNeoXPreTrainedModel,GPTNeoXTokenizer:()=>s.GPTNeoXTokenizer,Gemma2ForCausalLM:()=>n.Gemma2ForCausalLM,Gemma2Model:()=>n.Gemma2Model,Gemma2PreTrainedModel:()=>n.Gemma2PreTrainedModel,Gemma3ForCausalLM:()=>n.Gemma3ForCausalLM,Gemma3Model:()=>n.Gemma3Model,Gemma3PreTrainedModel:()=>n.Gemma3PreTrainedModel,Gemma3nAudioFeatureExtractor:()=>p.Gemma3nAudioFeatureExtractor,Gemma3nForConditionalGeneration:()=>n.Gemma3nForConditionalGeneration,Gemma3nPreTrainedModel:()=>n.Gemma3nPreTrainedModel,Gemma3nProcessor:()=>E.Gemma3nProcessor,GemmaForCausalLM:()=>n.GemmaForCausalLM,GemmaModel:()=>n.GemmaModel,GemmaPreTrainedModel:()=>n.GemmaPreTrainedModel,GemmaTokenizer:()=>s.GemmaTokenizer,GlmForCausalLM:()=>n.GlmForCausalLM,GlmModel:()=>n.GlmModel,GlmPreTrainedModel:()=>n.GlmPreTrainedModel,GraniteForCausalLM:()=>n.GraniteForCausalLM,GraniteModel:()=>n.GraniteModel,GraniteMoeHybridForCausalLM:()=>n.GraniteMoeHybridForCausalLM,GraniteMoeHybridModel:()=>n.GraniteMoeHybridModel,GraniteMoeHybridPreTrainedModel:()=>n.GraniteMoeHybridPreTrainedModel,GranitePreTrainedModel:()=>n.GranitePreTrainedModel,Grok1Tokenizer:()=>s.Grok1Tokenizer,GroundingDinoForObjectDetection:()=>n.GroundingDinoForObjectDetection,GroundingDinoImageProcessor:()=>v.GroundingDinoImageProcessor,GroundingDinoPreTrainedModel:()=>n.GroundingDinoPreTrainedModel,GroundingDinoProcessor:()=>E.GroundingDinoProcessor,GroupViTModel:()=>n.GroupViTModel,GroupViTPreTrainedModel:()=>n.GroupViTPreTrainedModel,HeliumForCausalLM:()=>n.HeliumForCausalLM,HeliumModel:()=>n.HeliumModel,HeliumPreTrainedModel:()=>n.HeliumPreTrainedModel,HerbertTokenizer:()=>s.HerbertTokenizer,HieraForImageClassification:()=>n.HieraForImageClassification,HieraModel:()=>n.HieraModel,HieraPreTrainedModel:()=>n.HieraPreTrainedModel,HubertForCTC:()=>n.HubertForCTC,HubertForSequenceClassification:()=>n.HubertForSequenceClassification,HubertModel:()=>n.HubertModel,HubertPreTrainedModel:()=>n.HubertPreTrainedModel,IJepaForImageClassification:()=>n.IJepaForImageClassification,IJepaModel:()=>n.IJepaModel,IJepaPreTrainedModel:()=>n.IJepaPreTrainedModel,Idefics3ForConditionalGeneration:()=>n.Idefics3ForConditionalGeneration,Idefics3ImageProcessor:()=>v.Idefics3ImageProcessor,Idefics3PreTrainedModel:()=>n.Idefics3PreTrainedModel,Idefics3Processor:()=>E.Idefics3Processor,ImageClassificationPipeline:()=>t.ImageClassificationPipeline,ImageFeatureExtractionPipeline:()=>t.ImageFeatureExtractionPipeline,ImageFeatureExtractor:()=>p.ImageFeatureExtractor,ImageMattingOutput:()=>n.ImageMattingOutput,ImageProcessor:()=>y.ImageProcessor,ImageSegmentationPipeline:()=>t.ImageSegmentationPipeline,ImageToImagePipeline:()=>t.ImageToImagePipeline,ImageToTextPipeline:()=>t.ImageToTextPipeline,InterruptableStoppingCriteria:()=>I.InterruptableStoppingCriteria,JAISLMHeadModel:()=>n.JAISLMHeadModel,JAISModel:()=>n.JAISModel,JAISPreTrainedModel:()=>n.JAISPreTrainedModel,JinaCLIPImageProcessor:()=>v.JinaCLIPImageProcessor,JinaCLIPModel:()=>n.JinaCLIPModel,JinaCLIPPreTrainedModel:()=>n.JinaCLIPPreTrainedModel,JinaCLIPProcessor:()=>E.JinaCLIPProcessor,JinaCLIPTextModel:()=>n.JinaCLIPTextModel,JinaCLIPVisionModel:()=>n.JinaCLIPVisionModel,Lfm2ForCausalLM:()=>n.Lfm2ForCausalLM,Lfm2Model:()=>n.Lfm2Model,Lfm2PreTrainedModel:()=>n.Lfm2PreTrainedModel,LiteWhisperForConditionalGeneration:()=>n.LiteWhisperForConditionalGeneration,Llama4ForCausalLM:()=>n.Llama4ForCausalLM,Llama4PreTrainedModel:()=>n.Llama4PreTrainedModel,LlamaForCausalLM:()=>n.LlamaForCausalLM,LlamaModel:()=>n.LlamaModel,LlamaPreTrainedModel:()=>n.LlamaPreTrainedModel,LlamaTokenizer:()=>s.LlamaTokenizer,LlavaForConditionalGeneration:()=>n.LlavaForConditionalGeneration,LlavaOnevisionForConditionalGeneration:()=>n.LlavaOnevisionForConditionalGeneration,LlavaOnevisionImageProcessor:()=>v.LlavaOnevisionImageProcessor,LlavaPreTrainedModel:()=>n.LlavaPreTrainedModel,LlavaProcessor:()=>E.LlavaProcessor,LlavaQwen2ForCausalLM:()=>n.LlavaQwen2ForCausalLM,LogitsProcessor:()=>M.LogitsProcessor,LogitsProcessorList:()=>M.LogitsProcessorList,LogitsWarper:()=>M.LogitsWarper,LongT5ForConditionalGeneration:()=>n.LongT5ForConditionalGeneration,LongT5Model:()=>n.LongT5Model,LongT5PreTrainedModel:()=>n.LongT5PreTrainedModel,M2M100ForConditionalGeneration:()=>n.M2M100ForConditionalGeneration,M2M100Model:()=>n.M2M100Model,M2M100PreTrainedModel:()=>n.M2M100PreTrainedModel,M2M100Tokenizer:()=>s.M2M100Tokenizer,MBart50Tokenizer:()=>s.MBart50Tokenizer,MBartForCausalLM:()=>n.MBartForCausalLM,MBartForConditionalGeneration:()=>n.MBartForConditionalGeneration,MBartForSequenceClassification:()=>n.MBartForSequenceClassification,MBartModel:()=>n.MBartModel,MBartPreTrainedModel:()=>n.MBartPreTrainedModel,MBartTokenizer:()=>s.MBartTokenizer,MPNetForMaskedLM:()=>n.MPNetForMaskedLM,MPNetForQuestionAnswering:()=>n.MPNetForQuestionAnswering,MPNetForSequenceClassification:()=>n.MPNetForSequenceClassification,MPNetForTokenClassification:()=>n.MPNetForTokenClassification,MPNetModel:()=>n.MPNetModel,MPNetPreTrainedModel:()=>n.MPNetPreTrainedModel,MPNetTokenizer:()=>s.MPNetTokenizer,MT5ForConditionalGeneration:()=>n.MT5ForConditionalGeneration,MT5Model:()=>n.MT5Model,MT5PreTrainedModel:()=>n.MT5PreTrainedModel,MarianMTModel:()=>n.MarianMTModel,MarianModel:()=>n.MarianModel,MarianPreTrainedModel:()=>n.MarianPreTrainedModel,MarianTokenizer:()=>s.MarianTokenizer,Mask2FormerImageProcessor:()=>v.Mask2FormerImageProcessor,MaskFormerFeatureExtractor:()=>v.MaskFormerFeatureExtractor,MaskFormerForInstanceSegmentation:()=>n.MaskFormerForInstanceSegmentation,MaskFormerImageProcessor:()=>v.MaskFormerImageProcessor,MaskFormerModel:()=>n.MaskFormerModel,MaskFormerPreTrainedModel:()=>n.MaskFormerPreTrainedModel,MaskedLMOutput:()=>n.MaskedLMOutput,MaxLengthCriteria:()=>I.MaxLengthCriteria,Metric3DForDepthEstimation:()=>n.Metric3DForDepthEstimation,Metric3DPreTrainedModel:()=>n.Metric3DPreTrainedModel,Metric3Dv2ForDepthEstimation:()=>n.Metric3Dv2ForDepthEstimation,Metric3Dv2PreTrainedModel:()=>n.Metric3Dv2PreTrainedModel,MgpstrForSceneTextRecognition:()=>n.MgpstrForSceneTextRecognition,MgpstrModelOutput:()=>n.MgpstrModelOutput,MgpstrPreTrainedModel:()=>n.MgpstrPreTrainedModel,MgpstrProcessor:()=>E.MgpstrProcessor,MgpstrTokenizer:()=>s.MgpstrTokenizer,MimiDecoderModel:()=>n.MimiDecoderModel,MimiDecoderOutput:()=>n.MimiDecoderOutput,MimiEncoderModel:()=>n.MimiEncoderModel,MimiEncoderOutput:()=>n.MimiEncoderOutput,MimiModel:()=>n.MimiModel,MimiPreTrainedModel:()=>n.MimiPreTrainedModel,MinLengthLogitsProcessor:()=>M.MinLengthLogitsProcessor,MinNewTokensLengthLogitsProcessor:()=>M.MinNewTokensLengthLogitsProcessor,Ministral3ForCausalLM:()=>n.Ministral3ForCausalLM,Ministral3Model:()=>n.Ministral3Model,Ministral3PreTrainedModel:()=>n.Ministral3PreTrainedModel,MinistralForCausalLM:()=>n.MinistralForCausalLM,MinistralModel:()=>n.MinistralModel,MinistralPreTrainedModel:()=>n.MinistralPreTrainedModel,Mistral3ForConditionalGeneration:()=>n.Mistral3ForConditionalGeneration,MistralForCausalLM:()=>n.MistralForCausalLM,MistralModel:()=>n.MistralModel,MistralPreTrainedModel:()=>n.MistralPreTrainedModel,MobileBertForMaskedLM:()=>n.MobileBertForMaskedLM,MobileBertForQuestionAnswering:()=>n.MobileBertForQuestionAnswering,MobileBertForSequenceClassification:()=>n.MobileBertForSequenceClassification,MobileBertModel:()=>n.MobileBertModel,MobileBertPreTrainedModel:()=>n.MobileBertPreTrainedModel,MobileBertTokenizer:()=>s.MobileBertTokenizer,MobileLLMForCausalLM:()=>n.MobileLLMForCausalLM,MobileLLMModel:()=>n.MobileLLMModel,MobileLLMPreTrainedModel:()=>n.MobileLLMPreTrainedModel,MobileNetV1FeatureExtractor:()=>v.MobileNetV1FeatureExtractor,MobileNetV1ForImageClassification:()=>n.MobileNetV1ForImageClassification,MobileNetV1ForSemanticSegmentation:()=>n.MobileNetV1ForSemanticSegmentation,MobileNetV1ImageProcessor:()=>v.MobileNetV1ImageProcessor,MobileNetV1Model:()=>n.MobileNetV1Model,MobileNetV1PreTrainedModel:()=>n.MobileNetV1PreTrainedModel,MobileNetV2FeatureExtractor:()=>v.MobileNetV2FeatureExtractor,MobileNetV2ForImageClassification:()=>n.MobileNetV2ForImageClassification,MobileNetV2ForSemanticSegmentation:()=>n.MobileNetV2ForSemanticSegmentation,MobileNetV2ImageProcessor:()=>v.MobileNetV2ImageProcessor,MobileNetV2Model:()=>n.MobileNetV2Model,MobileNetV2PreTrainedModel:()=>n.MobileNetV2PreTrainedModel,MobileNetV3FeatureExtractor:()=>v.MobileNetV3FeatureExtractor,MobileNetV3ForImageClassification:()=>n.MobileNetV3ForImageClassification,MobileNetV3ForSemanticSegmentation:()=>n.MobileNetV3ForSemanticSegmentation,MobileNetV3ImageProcessor:()=>v.MobileNetV3ImageProcessor,MobileNetV3Model:()=>n.MobileNetV3Model,MobileNetV3PreTrainedModel:()=>n.MobileNetV3PreTrainedModel,MobileNetV4FeatureExtractor:()=>v.MobileNetV4FeatureExtractor,MobileNetV4ForImageClassification:()=>n.MobileNetV4ForImageClassification,MobileNetV4ForSemanticSegmentation:()=>n.MobileNetV4ForSemanticSegmentation,MobileNetV4ImageProcessor:()=>v.MobileNetV4ImageProcessor,MobileNetV4Model:()=>n.MobileNetV4Model,MobileNetV4PreTrainedModel:()=>n.MobileNetV4PreTrainedModel,MobileViTFeatureExtractor:()=>v.MobileViTFeatureExtractor,MobileViTForImageClassification:()=>n.MobileViTForImageClassification,MobileViTImageProcessor:()=>v.MobileViTImageProcessor,MobileViTModel:()=>n.MobileViTModel,MobileViTPreTrainedModel:()=>n.MobileViTPreTrainedModel,MobileViTV2ForImageClassification:()=>n.MobileViTV2ForImageClassification,MobileViTV2Model:()=>n.MobileViTV2Model,MobileViTV2PreTrainedModel:()=>n.MobileViTV2PreTrainedModel,ModelOutput:()=>n.ModelOutput,ModernBertDecoderForCausalLM:()=>n.ModernBertDecoderForCausalLM,ModernBertDecoderModel:()=>n.ModernBertDecoderModel,ModernBertDecoderPreTrainedModel:()=>n.ModernBertDecoderPreTrainedModel,ModernBertForMaskedLM:()=>n.ModernBertForMaskedLM,ModernBertForSequenceClassification:()=>n.ModernBertForSequenceClassification,ModernBertForTokenClassification:()=>n.ModernBertForTokenClassification,ModernBertModel:()=>n.ModernBertModel,ModernBertPreTrainedModel:()=>n.ModernBertPreTrainedModel,Moondream1ForConditionalGeneration:()=>n.Moondream1ForConditionalGeneration,MoonshineFeatureExtractor:()=>p.MoonshineFeatureExtractor,MoonshineForConditionalGeneration:()=>n.MoonshineForConditionalGeneration,MoonshineModel:()=>n.MoonshineModel,MoonshinePreTrainedModel:()=>n.MoonshinePreTrainedModel,MoonshineProcessor:()=>E.MoonshineProcessor,MptForCausalLM:()=>n.MptForCausalLM,MptModel:()=>n.MptModel,MptPreTrainedModel:()=>n.MptPreTrainedModel,MultiModalityCausalLM:()=>n.MultiModalityCausalLM,MultiModalityPreTrainedModel:()=>n.MultiModalityPreTrainedModel,MusicgenForCausalLM:()=>n.MusicgenForCausalLM,MusicgenForConditionalGeneration:()=>n.MusicgenForConditionalGeneration,MusicgenModel:()=>n.MusicgenModel,MusicgenPreTrainedModel:()=>n.MusicgenPreTrainedModel,NanoChatForCausalLM:()=>n.NanoChatForCausalLM,NanoChatModel:()=>n.NanoChatModel,NanoChatPreTrainedModel:()=>n.NanoChatPreTrainedModel,NeoBertForMaskedLM:()=>n.NeoBertForMaskedLM,NeoBertForQuestionAnswering:()=>n.NeoBertForQuestionAnswering,NeoBertForSequenceClassification:()=>n.NeoBertForSequenceClassification,NeoBertForTokenClassification:()=>n.NeoBertForTokenClassification,NeoBertModel:()=>n.NeoBertModel,NeoBertPreTrainedModel:()=>n.NeoBertPreTrainedModel,NllbTokenizer:()=>s.NllbTokenizer,NoBadWordsLogitsProcessor:()=>M.NoBadWordsLogitsProcessor,NoRepeatNGramLogitsProcessor:()=>M.NoRepeatNGramLogitsProcessor,NomicBertModel:()=>n.NomicBertModel,NomicBertPreTrainedModel:()=>n.NomicBertPreTrainedModel,NougatImageProcessor:()=>v.NougatImageProcessor,NougatTokenizer:()=>s.NougatTokenizer,OPTForCausalLM:()=>n.OPTForCausalLM,OPTModel:()=>n.OPTModel,OPTPreTrainedModel:()=>n.OPTPreTrainedModel,ObjectDetectionPipeline:()=>t.ObjectDetectionPipeline,Olmo2ForCausalLM:()=>n.Olmo2ForCausalLM,Olmo2Model:()=>n.Olmo2Model,Olmo2PreTrainedModel:()=>n.Olmo2PreTrainedModel,OlmoForCausalLM:()=>n.OlmoForCausalLM,OlmoModel:()=>n.OlmoModel,OlmoPreTrainedModel:()=>n.OlmoPreTrainedModel,OpenELMForCausalLM:()=>n.OpenELMForCausalLM,OpenELMModel:()=>n.OpenELMModel,OpenELMPreTrainedModel:()=>n.OpenELMPreTrainedModel,OwlViTFeatureExtractor:()=>v.OwlViTFeatureExtractor,OwlViTForObjectDetection:()=>n.OwlViTForObjectDetection,OwlViTImageProcessor:()=>v.OwlViTImageProcessor,OwlViTModel:()=>n.OwlViTModel,OwlViTPreTrainedModel:()=>n.OwlViTPreTrainedModel,OwlViTProcessor:()=>E.OwlViTProcessor,Owlv2ForObjectDetection:()=>n.Owlv2ForObjectDetection,Owlv2ImageProcessor:()=>v.Owlv2ImageProcessor,Owlv2Model:()=>n.Owlv2Model,Owlv2PreTrainedModel:()=>n.Owlv2PreTrainedModel,PaliGemmaForConditionalGeneration:()=>n.PaliGemmaForConditionalGeneration,PaliGemmaPreTrainedModel:()=>n.PaliGemmaPreTrainedModel,PaliGemmaProcessor:()=>E.PaliGemmaProcessor,ParakeetFeatureExtractor:()=>p.ParakeetFeatureExtractor,ParakeetForCTC:()=>n.ParakeetForCTC,ParakeetPreTrainedModel:()=>n.ParakeetPreTrainedModel,PatchTSMixerForPrediction:()=>n.PatchTSMixerForPrediction,PatchTSMixerModel:()=>n.PatchTSMixerModel,PatchTSMixerPreTrainedModel:()=>n.PatchTSMixerPreTrainedModel,PatchTSTForPrediction:()=>n.PatchTSTForPrediction,PatchTSTModel:()=>n.PatchTSTModel,PatchTSTPreTrainedModel:()=>n.PatchTSTPreTrainedModel,Phi3ForCausalLM:()=>n.Phi3ForCausalLM,Phi3Model:()=>n.Phi3Model,Phi3PreTrainedModel:()=>n.Phi3PreTrainedModel,Phi3VForCausalLM:()=>n.Phi3VForCausalLM,Phi3VImageProcessor:()=>v.Phi3VImageProcessor,Phi3VPreTrainedModel:()=>n.Phi3VPreTrainedModel,Phi3VProcessor:()=>E.Phi3VProcessor,PhiForCausalLM:()=>n.PhiForCausalLM,PhiModel:()=>n.PhiModel,PhiPreTrainedModel:()=>n.PhiPreTrainedModel,Pipeline:()=>t.Pipeline,PixtralImageProcessor:()=>v.PixtralImageProcessor,PixtralProcessor:()=>E.PixtralProcessor,PreTrainedModel:()=>n.PreTrainedModel,PreTrainedTokenizer:()=>s.PreTrainedTokenizer,PretrainedConfig:()=>i.PretrainedConfig,PretrainedMixin:()=>n.PretrainedMixin,Processor:()=>O.Processor,PvtForImageClassification:()=>n.PvtForImageClassification,PvtImageProcessor:()=>v.PvtImageProcessor,PvtModel:()=>n.PvtModel,PvtPreTrainedModel:()=>n.PvtPreTrainedModel,PyAnnoteFeatureExtractor:()=>p.PyAnnoteFeatureExtractor,PyAnnoteForAudioFrameClassification:()=>n.PyAnnoteForAudioFrameClassification,PyAnnoteModel:()=>n.PyAnnoteModel,PyAnnotePreTrainedModel:()=>n.PyAnnotePreTrainedModel,PyAnnoteProcessor:()=>E.PyAnnoteProcessor,QuestionAnsweringModelOutput:()=>n.QuestionAnsweringModelOutput,QuestionAnsweringPipeline:()=>t.QuestionAnsweringPipeline,Qwen2ForCausalLM:()=>n.Qwen2ForCausalLM,Qwen2Model:()=>n.Qwen2Model,Qwen2PreTrainedModel:()=>n.Qwen2PreTrainedModel,Qwen2Tokenizer:()=>s.Qwen2Tokenizer,Qwen2VLForConditionalGeneration:()=>n.Qwen2VLForConditionalGeneration,Qwen2VLImageProcessor:()=>v.Qwen2VLImageProcessor,Qwen2VLPreTrainedModel:()=>n.Qwen2VLPreTrainedModel,Qwen2VLProcessor:()=>E.Qwen2VLProcessor,Qwen3ForCausalLM:()=>n.Qwen3ForCausalLM,Qwen3Model:()=>n.Qwen3Model,Qwen3PreTrainedModel:()=>n.Qwen3PreTrainedModel,RFDetrForObjectDetection:()=>n.RFDetrForObjectDetection,RFDetrModel:()=>n.RFDetrModel,RFDetrObjectDetectionOutput:()=>n.RFDetrObjectDetectionOutput,RFDetrPreTrainedModel:()=>n.RFDetrPreTrainedModel,RTDetrForObjectDetection:()=>n.RTDetrForObjectDetection,RTDetrImageProcessor:()=>v.RTDetrImageProcessor,RTDetrModel:()=>n.RTDetrModel,RTDetrObjectDetectionOutput:()=>n.RTDetrObjectDetectionOutput,RTDetrPreTrainedModel:()=>n.RTDetrPreTrainedModel,RTDetrV2ForObjectDetection:()=>n.RTDetrV2ForObjectDetection,RTDetrV2Model:()=>n.RTDetrV2Model,RTDetrV2ObjectDetectionOutput:()=>n.RTDetrV2ObjectDetectionOutput,RTDetrV2PreTrainedModel:()=>n.RTDetrV2PreTrainedModel,RawAudio:()=>o.RawAudio,RawImage:()=>c.RawImage,RawVideo:()=>d.RawVideo,RawVideoFrame:()=>d.RawVideoFrame,RepetitionPenaltyLogitsProcessor:()=>M.RepetitionPenaltyLogitsProcessor,ResNetForImageClassification:()=>n.ResNetForImageClassification,ResNetModel:()=>n.ResNetModel,ResNetPreTrainedModel:()=>n.ResNetPreTrainedModel,RoFormerForMaskedLM:()=>n.RoFormerForMaskedLM,RoFormerForQuestionAnswering:()=>n.RoFormerForQuestionAnswering,RoFormerForSequenceClassification:()=>n.RoFormerForSequenceClassification,RoFormerForTokenClassification:()=>n.RoFormerForTokenClassification,RoFormerModel:()=>n.RoFormerModel,RoFormerPreTrainedModel:()=>n.RoFormerPreTrainedModel,RoFormerTokenizer:()=>s.RoFormerTokenizer,RobertaForMaskedLM:()=>n.RobertaForMaskedLM,RobertaForQuestionAnswering:()=>n.RobertaForQuestionAnswering,RobertaForSequenceClassification:()=>n.RobertaForSequenceClassification,RobertaForTokenClassification:()=>n.RobertaForTokenClassification,RobertaModel:()=>n.RobertaModel,RobertaPreTrainedModel:()=>n.RobertaPreTrainedModel,RobertaTokenizer:()=>s.RobertaTokenizer,Sam2ImageProcessor:()=>v.Sam2ImageProcessor,Sam2ImageSegmentationOutput:()=>n.Sam2ImageSegmentationOutput,Sam2Model:()=>n.Sam2Model,Sam2PreTrainedModel:()=>n.Sam2PreTrainedModel,Sam2Processor:()=>E.Sam2Processor,Sam2VideoProcessor:()=>E.Sam2VideoProcessor,Sam3ImageProcessor:()=>v.Sam3ImageProcessor,Sam3TrackerModel:()=>n.Sam3TrackerModel,SamImageProcessor:()=>v.SamImageProcessor,SamImageSegmentationOutput:()=>n.SamImageSegmentationOutput,SamModel:()=>n.SamModel,SamPreTrainedModel:()=>n.SamPreTrainedModel,SamProcessor:()=>E.SamProcessor,SapiensForDepthEstimation:()=>n.SapiensForDepthEstimation,SapiensForNormalEstimation:()=>n.SapiensForNormalEstimation,SapiensForSemanticSegmentation:()=>n.SapiensForSemanticSegmentation,SapiensPreTrainedModel:()=>n.SapiensPreTrainedModel,SeamlessM4TFeatureExtractor:()=>p.SeamlessM4TFeatureExtractor,SegformerFeatureExtractor:()=>v.SegformerFeatureExtractor,SegformerForImageClassification:()=>n.SegformerForImageClassification,SegformerForSemanticSegmentation:()=>n.SegformerForSemanticSegmentation,SegformerImageProcessor:()=>v.SegformerImageProcessor,SegformerModel:()=>n.SegformerModel,SegformerPreTrainedModel:()=>n.SegformerPreTrainedModel,Seq2SeqLMOutput:()=>n.Seq2SeqLMOutput,SequenceClassifierOutput:()=>n.SequenceClassifierOutput,SiglipImageProcessor:()=>v.SiglipImageProcessor,SiglipModel:()=>n.SiglipModel,SiglipPreTrainedModel:()=>n.SiglipPreTrainedModel,SiglipTextModel:()=>n.SiglipTextModel,SiglipTokenizer:()=>s.SiglipTokenizer,SiglipVisionModel:()=>n.SiglipVisionModel,SmolLM3ForCausalLM:()=>n.SmolLM3ForCausalLM,SmolLM3Model:()=>n.SmolLM3Model,SmolLM3PreTrainedModel:()=>n.SmolLM3PreTrainedModel,SmolVLMForConditionalGeneration:()=>n.SmolVLMForConditionalGeneration,SmolVLMImageProcessor:()=>v.SmolVLMImageProcessor,SmolVLMProcessor:()=>E.SmolVLMProcessor,SnacDecoderModel:()=>n.SnacDecoderModel,SnacEncoderModel:()=>n.SnacEncoderModel,SnacFeatureExtractor:()=>p.SnacFeatureExtractor,SnacModel:()=>n.SnacModel,SnacPreTrainedModel:()=>n.SnacPreTrainedModel,SpeechT5FeatureExtractor:()=>p.SpeechT5FeatureExtractor,SpeechT5ForSpeechToText:()=>n.SpeechT5ForSpeechToText,SpeechT5ForTextToSpeech:()=>n.SpeechT5ForTextToSpeech,SpeechT5HifiGan:()=>n.SpeechT5HifiGan,SpeechT5Model:()=>n.SpeechT5Model,SpeechT5PreTrainedModel:()=>n.SpeechT5PreTrainedModel,SpeechT5Processor:()=>E.SpeechT5Processor,SpeechT5Tokenizer:()=>s.SpeechT5Tokenizer,SqueezeBertForMaskedLM:()=>n.SqueezeBertForMaskedLM,SqueezeBertForQuestionAnswering:()=>n.SqueezeBertForQuestionAnswering,SqueezeBertForSequenceClassification:()=>n.SqueezeBertForSequenceClassification,SqueezeBertModel:()=>n.SqueezeBertModel,SqueezeBertPreTrainedModel:()=>n.SqueezeBertPreTrainedModel,SqueezeBertTokenizer:()=>s.SqueezeBertTokenizer,StableLmForCausalLM:()=>n.StableLmForCausalLM,StableLmModel:()=>n.StableLmModel,StableLmPreTrainedModel:()=>n.StableLmPreTrainedModel,Starcoder2ForCausalLM:()=>n.Starcoder2ForCausalLM,Starcoder2Model:()=>n.Starcoder2Model,Starcoder2PreTrainedModel:()=>n.Starcoder2PreTrainedModel,StoppingCriteria:()=>I.StoppingCriteria,StoppingCriteriaList:()=>I.StoppingCriteriaList,StyleTextToSpeech2Model:()=>n.StyleTextToSpeech2Model,StyleTextToSpeech2PreTrainedModel:()=>n.StyleTextToSpeech2PreTrainedModel,SummarizationPipeline:()=>t.SummarizationPipeline,SupertonicForConditionalGeneration:()=>n.SupertonicForConditionalGeneration,SupertonicPreTrainedModel:()=>n.SupertonicPreTrainedModel,SuppressTokensAtBeginLogitsProcessor:()=>M.SuppressTokensAtBeginLogitsProcessor,Swin2SRForImageSuperResolution:()=>n.Swin2SRForImageSuperResolution,Swin2SRImageProcessor:()=>v.Swin2SRImageProcessor,Swin2SRModel:()=>n.Swin2SRModel,Swin2SRPreTrainedModel:()=>n.Swin2SRPreTrainedModel,SwinForImageClassification:()=>n.SwinForImageClassification,SwinForSemanticSegmentation:()=>n.SwinForSemanticSegmentation,SwinModel:()=>n.SwinModel,SwinPreTrainedModel:()=>n.SwinPreTrainedModel,T5ForConditionalGeneration:()=>n.T5ForConditionalGeneration,T5Model:()=>n.T5Model,T5PreTrainedModel:()=>n.T5PreTrainedModel,T5Tokenizer:()=>s.T5Tokenizer,TableTransformerForObjectDetection:()=>n.TableTransformerForObjectDetection,TableTransformerModel:()=>n.TableTransformerModel,TableTransformerObjectDetectionOutput:()=>n.TableTransformerObjectDetectionOutput,TableTransformerPreTrainedModel:()=>n.TableTransformerPreTrainedModel,TemperatureLogitsWarper:()=>M.TemperatureLogitsWarper,Tensor:()=>u.Tensor,Text2TextGenerationPipeline:()=>t.Text2TextGenerationPipeline,TextClassificationPipeline:()=>t.TextClassificationPipeline,TextGenerationPipeline:()=>t.TextGenerationPipeline,TextStreamer:()=>D.TextStreamer,TextToAudioPipeline:()=>t.TextToAudioPipeline,TokenClassificationPipeline:()=>t.TokenClassificationPipeline,TokenClassifierOutput:()=>n.TokenClassifierOutput,TokenizerModel:()=>s.TokenizerModel,TopKLogitsWarper:()=>M.TopKLogitsWarper,TopPLogitsWarper:()=>M.TopPLogitsWarper,TrOCRForCausalLM:()=>n.TrOCRForCausalLM,TrOCRPreTrainedModel:()=>n.TrOCRPreTrainedModel,TranslationPipeline:()=>t.TranslationPipeline,UltravoxModel:()=>n.UltravoxModel,UltravoxPreTrainedModel:()=>n.UltravoxPreTrainedModel,UltravoxProcessor:()=>E.UltravoxProcessor,UniSpeechForCTC:()=>n.UniSpeechForCTC,UniSpeechForSequenceClassification:()=>n.UniSpeechForSequenceClassification,UniSpeechModel:()=>n.UniSpeechModel,UniSpeechPreTrainedModel:()=>n.UniSpeechPreTrainedModel,UniSpeechSatForAudioFrameClassification:()=>n.UniSpeechSatForAudioFrameClassification,UniSpeechSatForCTC:()=>n.UniSpeechSatForCTC,UniSpeechSatForSequenceClassification:()=>n.UniSpeechSatForSequenceClassification,UniSpeechSatModel:()=>n.UniSpeechSatModel,UniSpeechSatPreTrainedModel:()=>n.UniSpeechSatPreTrainedModel,VLChatProcessor:()=>E.VLChatProcessor,VLMImageProcessor:()=>v.VLMImageProcessor,VaultGemmaForCausalLM:()=>n.VaultGemmaForCausalLM,VaultGemmaModel:()=>n.VaultGemmaModel,VaultGemmaPreTrainedModel:()=>n.VaultGemmaPreTrainedModel,ViTFeatureExtractor:()=>v.ViTFeatureExtractor,ViTForImageClassification:()=>n.ViTForImageClassification,ViTImageProcessor:()=>v.ViTImageProcessor,ViTMAEModel:()=>n.ViTMAEModel,ViTMAEPreTrainedModel:()=>n.ViTMAEPreTrainedModel,ViTMSNForImageClassification:()=>n.ViTMSNForImageClassification,ViTMSNModel:()=>n.ViTMSNModel,ViTMSNPreTrainedModel:()=>n.ViTMSNPreTrainedModel,ViTModel:()=>n.ViTModel,ViTPreTrainedModel:()=>n.ViTPreTrainedModel,VisionEncoderDecoderModel:()=>n.VisionEncoderDecoderModel,VitMatteForImageMatting:()=>n.VitMatteForImageMatting,VitMatteImageProcessor:()=>v.VitMatteImageProcessor,VitMattePreTrainedModel:()=>n.VitMattePreTrainedModel,VitPoseForPoseEstimation:()=>n.VitPoseForPoseEstimation,VitPoseImageProcessor:()=>v.VitPoseImageProcessor,VitPosePreTrainedModel:()=>n.VitPosePreTrainedModel,VitsModel:()=>n.VitsModel,VitsModelOutput:()=>n.VitsModelOutput,VitsPreTrainedModel:()=>n.VitsPreTrainedModel,VitsTokenizer:()=>s.VitsTokenizer,VoxtralForConditionalGeneration:()=>n.VoxtralForConditionalGeneration,VoxtralProcessor:()=>E.VoxtralProcessor,Wav2Vec2BertForCTC:()=>n.Wav2Vec2BertForCTC,Wav2Vec2BertForSequenceClassification:()=>n.Wav2Vec2BertForSequenceClassification,Wav2Vec2BertModel:()=>n.Wav2Vec2BertModel,Wav2Vec2BertPreTrainedModel:()=>n.Wav2Vec2BertPreTrainedModel,Wav2Vec2CTCTokenizer:()=>s.Wav2Vec2CTCTokenizer,Wav2Vec2FeatureExtractor:()=>p.Wav2Vec2FeatureExtractor,Wav2Vec2ForAudioFrameClassification:()=>n.Wav2Vec2ForAudioFrameClassification,Wav2Vec2ForCTC:()=>n.Wav2Vec2ForCTC,Wav2Vec2ForSequenceClassification:()=>n.Wav2Vec2ForSequenceClassification,Wav2Vec2Model:()=>n.Wav2Vec2Model,Wav2Vec2PreTrainedModel:()=>n.Wav2Vec2PreTrainedModel,Wav2Vec2Processor:()=>E.Wav2Vec2Processor,Wav2Vec2ProcessorWithLM:()=>E.Wav2Vec2ProcessorWithLM,WavLMForAudioFrameClassification:()=>n.WavLMForAudioFrameClassification,WavLMForCTC:()=>n.WavLMForCTC,WavLMForSequenceClassification:()=>n.WavLMForSequenceClassification,WavLMForXVector:()=>n.WavLMForXVector,WavLMModel:()=>n.WavLMModel,WavLMPreTrainedModel:()=>n.WavLMPreTrainedModel,WeSpeakerFeatureExtractor:()=>p.WeSpeakerFeatureExtractor,WeSpeakerResNetModel:()=>n.WeSpeakerResNetModel,WeSpeakerResNetPreTrainedModel:()=>n.WeSpeakerResNetPreTrainedModel,WhisperFeatureExtractor:()=>p.WhisperFeatureExtractor,WhisperForConditionalGeneration:()=>n.WhisperForConditionalGeneration,WhisperModel:()=>n.WhisperModel,WhisperPreTrainedModel:()=>n.WhisperPreTrainedModel,WhisperProcessor:()=>E.WhisperProcessor,WhisperTextStreamer:()=>D.WhisperTextStreamer,WhisperTimeStampLogitsProcessor:()=>M.WhisperTimeStampLogitsProcessor,WhisperTokenizer:()=>s.WhisperTokenizer,XLMForQuestionAnswering:()=>n.XLMForQuestionAnswering,XLMForSequenceClassification:()=>n.XLMForSequenceClassification,XLMForTokenClassification:()=>n.XLMForTokenClassification,XLMModel:()=>n.XLMModel,XLMPreTrainedModel:()=>n.XLMPreTrainedModel,XLMRobertaForMaskedLM:()=>n.XLMRobertaForMaskedLM,XLMRobertaForQuestionAnswering:()=>n.XLMRobertaForQuestionAnswering,XLMRobertaForSequenceClassification:()=>n.XLMRobertaForSequenceClassification,XLMRobertaForTokenClassification:()=>n.XLMRobertaForTokenClassification,XLMRobertaModel:()=>n.XLMRobertaModel,XLMRobertaPreTrainedModel:()=>n.XLMRobertaPreTrainedModel,XLMRobertaTokenizer:()=>s.XLMRobertaTokenizer,XLMTokenizer:()=>s.XLMTokenizer,XLMWithLMHeadModel:()=>n.XLMWithLMHeadModel,XVectorOutput:()=>n.XVectorOutput,YolosFeatureExtractor:()=>v.YolosFeatureExtractor,YolosForObjectDetection:()=>n.YolosForObjectDetection,YolosImageProcessor:()=>v.YolosImageProcessor,YolosModel:()=>n.YolosModel,YolosObjectDetectionOutput:()=>n.YolosObjectDetectionOutput,YolosPreTrainedModel:()=>n.YolosPreTrainedModel,ZeroShotAudioClassificationPipeline:()=>t.ZeroShotAudioClassificationPipeline,ZeroShotClassificationPipeline:()=>t.ZeroShotClassificationPipeline,ZeroShotImageClassificationPipeline:()=>t.ZeroShotImageClassificationPipeline,ZeroShotObjectDetectionPipeline:()=>t.ZeroShotObjectDetectionPipeline,bankers_round:()=>h.bankers_round,cat:()=>u.cat,cos_sim:()=>h.cos_sim,dot:()=>h.dot,dynamic_time_warping:()=>h.dynamic_time_warping,env:()=>e.env,full:()=>u.full,full_like:()=>u.full_like,getCacheShapes:()=>i.getCacheShapes,hamming:()=>o.hamming,hanning:()=>o.hanning,interpolate:()=>u.interpolate,interpolate_4d:()=>u.interpolate_4d,interpolate_data:()=>h.interpolate_data,is_chinese_char:()=>s.is_chinese_char,layer_norm:()=>u.layer_norm,load_image:()=>c.load_image,load_video:()=>d.load_video,log_softmax:()=>h.log_softmax,magnitude:()=>h.magnitude,matmul:()=>u.matmul,max:()=>h.max,mean:()=>u.mean,mean_pooling:()=>u.mean_pooling,medianFilter:()=>h.medianFilter,mel_filter_bank:()=>o.mel_filter_bank,min:()=>h.min,ones:()=>u.ones,ones_like:()=>u.ones_like,permute:()=>u.permute,permute_data:()=>h.permute_data,pipeline:()=>t.pipeline,quantize_embeddings:()=>u.quantize_embeddings,rand:()=>u.rand,randn:()=>u.randn,read_audio:()=>o.read_audio,rfft:()=>u.rfft,round:()=>h.round,slice:()=>u.slice,softmax:()=>h.softmax,spectrogram:()=>o.spectrogram,stack:()=>u.stack,std_mean:()=>u.std_mean,topk:()=>u.topk,window_function:()=>o.window_function,zeros:()=>u.zeros,zeros_like:()=>u.zeros_like});var e=zn("./src/env.js"),t=zn("./src/pipelines.js"),n=zn("./src/models.js"),s=zn("./src/tokenizers.js"),i=zn("./src/configs.js"),o=zn("./src/utils/audio.js"),c=zn("./src/utils/image.js"),d=zn("./src/utils/video.js"),u=zn("./src/utils/tensor.js"),h=zn("./src/utils/maths.js"),g=zn("./src/base/feature_extraction_utils.js"),p=zn("./src/models/feature_extractors.js"),m=zn("./src/models/auto/feature_extraction_auto.js"),y=zn("./src/base/image_processors_utils.js"),v=zn("./src/models/image_processors.js"),T=zn("./src/models/auto/image_processing_auto.js"),O=zn("./src/base/processing_utils.js"),E=zn("./src/models/processors.js"),S=zn("./src/models/auto/processing_auto.js"),D=zn("./src/generation/streamers.js"),I=zn("./src/generation/stopping_criteria.js"),M=zn("./src/generation/logits_process.js")})();x.ASTFeatureExtractor;x.ASTForAudioClassification;x.ASTModel;x.ASTPreTrainedModel;x.AlbertForMaskedLM;x.AlbertForQuestionAnswering;x.AlbertForSequenceClassification;x.AlbertModel;x.AlbertPreTrainedModel;x.AlbertTokenizer;x.ArceeForCausalLM;x.ArceeModel;x.ArceePreTrainedModel;x.AudioClassificationPipeline;x.AutoConfig;x.AutoFeatureExtractor;x.AutoImageProcessor;x.AutoModel;x.AutoModelForAudioClassification;x.AutoModelForAudioFrameClassification;x.AutoModelForAudioTextToText;x.AutoModelForCTC;x.AutoModelForCausalLM;x.AutoModelForDepthEstimation;x.AutoModelForDocumentQuestionAnswering;x.AutoModelForImageClassification;x.AutoModelForImageFeatureExtraction;x.AutoModelForImageMatting;x.AutoModelForImageSegmentation;x.AutoModelForImageTextToText;x.AutoModelForImageToImage;x.AutoModelForMaskGeneration;x.AutoModelForMaskedLM;x.AutoModelForNormalEstimation;x.AutoModelForObjectDetection;x.AutoModelForPoseEstimation;x.AutoModelForQuestionAnswering;x.AutoModelForSemanticSegmentation;x.AutoModelForSeq2SeqLM;x.AutoModelForSequenceClassification;x.AutoModelForSpeechSeq2Seq;x.AutoModelForTextToSpectrogram;x.AutoModelForTextToWaveform;x.AutoModelForTokenClassification;x.AutoModelForUniversalSegmentation;var _$=x.AutoModelForVision2Seq;x.AutoModelForXVector;x.AutoModelForZeroShotObjectDetection;x.AutoProcessor;x.AutoTokenizer;x.AutomaticSpeechRecognitionPipeline;x.BackgroundRemovalPipeline;x.BartForConditionalGeneration;x.BartForSequenceClassification;x.BartModel;x.BartPretrainedModel;x.BartTokenizer;x.BaseModelOutput;x.BaseStreamer;x.BeitFeatureExtractor;x.BeitForImageClassification;x.BeitModel;x.BeitPreTrainedModel;x.BertForMaskedLM;x.BertForQuestionAnswering;x.BertForSequenceClassification;x.BertForTokenClassification;x.BertModel;x.BertPreTrainedModel;x.BertTokenizer;x.BitImageProcessor;x.BlenderbotForConditionalGeneration;x.BlenderbotModel;x.BlenderbotPreTrainedModel;x.BlenderbotSmallForConditionalGeneration;x.BlenderbotSmallModel;x.BlenderbotSmallPreTrainedModel;x.BlenderbotSmallTokenizer;x.BlenderbotTokenizer;x.BloomForCausalLM;x.BloomModel;x.BloomPreTrainedModel;x.BloomTokenizer;x.CLIPFeatureExtractor;x.CLIPImageProcessor;x.CLIPModel;x.CLIPPreTrainedModel;x.CLIPSegForImageSegmentation;x.CLIPSegModel;x.CLIPSegPreTrainedModel;x.CLIPTextModel;x.CLIPTextModelWithProjection;x.CLIPTokenizer;x.CLIPVisionModel;x.CLIPVisionModelWithProjection;x.CamembertForMaskedLM;x.CamembertForQuestionAnswering;x.CamembertForSequenceClassification;x.CamembertForTokenClassification;x.CamembertModel;x.CamembertPreTrainedModel;x.CamembertTokenizer;x.CausalLMOutput;x.CausalLMOutputWithPast;x.ChineseCLIPFeatureExtractor;x.ChineseCLIPModel;x.ChineseCLIPPreTrainedModel;x.ClapAudioModelWithProjection;x.ClapFeatureExtractor;x.ClapModel;x.ClapPreTrainedModel;x.ClapTextModelWithProjection;x.ClassifierFreeGuidanceLogitsProcessor;x.CodeGenForCausalLM;x.CodeGenModel;x.CodeGenPreTrainedModel;x.CodeGenTokenizer;x.CodeLlamaTokenizer;x.CohereForCausalLM;x.CohereModel;x.CoherePreTrainedModel;x.CohereTokenizer;x.ConvBertForMaskedLM;x.ConvBertForQuestionAnswering;x.ConvBertForSequenceClassification;x.ConvBertForTokenClassification;x.ConvBertModel;x.ConvBertPreTrainedModel;x.ConvBertTokenizer;x.ConvNextFeatureExtractor;x.ConvNextForImageClassification;x.ConvNextImageProcessor;x.ConvNextModel;x.ConvNextPreTrainedModel;x.ConvNextV2ForImageClassification;x.ConvNextV2Model;x.ConvNextV2PreTrainedModel;x.DFineForObjectDetection;x.DFineModel;x.DFinePreTrainedModel;x.DINOv3ConvNextModel;x.DINOv3ConvNextPreTrainedModel;x.DINOv3ViTImageProcessor;x.DINOv3ViTModel;x.DINOv3ViTPreTrainedModel;x.DPTFeatureExtractor;x.DPTForDepthEstimation;x.DPTImageProcessor;x.DPTModel;x.DPTPreTrainedModel;x.DacDecoderModel;x.DacDecoderOutput;x.DacEncoderModel;x.DacEncoderOutput;x.DacFeatureExtractor;x.DacModel;x.DacPreTrainedModel;x.DataTypeMap;x.DebertaForMaskedLM;x.DebertaForQuestionAnswering;x.DebertaForSequenceClassification;x.DebertaForTokenClassification;x.DebertaModel;x.DebertaPreTrainedModel;x.DebertaTokenizer;x.DebertaV2ForMaskedLM;x.DebertaV2ForQuestionAnswering;x.DebertaV2ForSequenceClassification;x.DebertaV2ForTokenClassification;x.DebertaV2Model;x.DebertaV2PreTrainedModel;x.DebertaV2Tokenizer;x.DecisionTransformerModel;x.DecisionTransformerPreTrainedModel;x.DeiTFeatureExtractor;x.DeiTForImageClassification;x.DeiTImageProcessor;x.DeiTModel;x.DeiTPreTrainedModel;x.DepthAnythingForDepthEstimation;x.DepthAnythingPreTrainedModel;x.DepthEstimationPipeline;x.DepthProForDepthEstimation;x.DepthProPreTrainedModel;x.DetrFeatureExtractor;x.DetrForObjectDetection;x.DetrForSegmentation;x.DetrImageProcessor;x.DetrModel;x.DetrObjectDetectionOutput;x.DetrPreTrainedModel;x.DetrSegmentationOutput;x.Dinov2ForImageClassification;x.Dinov2Model;x.Dinov2PreTrainedModel;x.Dinov2WithRegistersForImageClassification;x.Dinov2WithRegistersModel;x.Dinov2WithRegistersPreTrainedModel;x.DistilBertForMaskedLM;x.DistilBertForQuestionAnswering;x.DistilBertForSequenceClassification;x.DistilBertForTokenClassification;x.DistilBertModel;x.DistilBertPreTrainedModel;x.DistilBertTokenizer;x.DocumentQuestionAnsweringPipeline;x.DonutFeatureExtractor;x.DonutImageProcessor;x.DonutSwinModel;x.DonutSwinPreTrainedModel;x.EdgeTamModel;x.EfficientNetForImageClassification;x.EfficientNetImageProcessor;x.EfficientNetModel;x.EfficientNetPreTrainedModel;x.ElectraForMaskedLM;x.ElectraForQuestionAnswering;x.ElectraForSequenceClassification;x.ElectraForTokenClassification;x.ElectraModel;x.ElectraPreTrainedModel;x.ElectraTokenizer;x.EncodecFeatureExtractor;x.EosTokenCriteria;x.Ernie4_5ForCausalLM;x.Ernie4_5Model;x.Ernie4_5PreTrainedModel;x.EsmForMaskedLM;x.EsmForSequenceClassification;x.EsmForTokenClassification;x.EsmModel;x.EsmPreTrainedModel;x.EsmTokenizer;x.ExaoneForCausalLM;x.ExaoneModel;x.ExaonePreTrainedModel;x.FFT;x.FalconForCausalLM;x.FalconModel;x.FalconPreTrainedModel;x.FalconTokenizer;x.FastViTForImageClassification;x.FastViTModel;x.FastViTPreTrainedModel;x.FeatureExtractionPipeline;x.FeatureExtractor;x.FillMaskPipeline;x.Florence2ForConditionalGeneration;x.Florence2PreTrainedModel;x.Florence2Processor;x.ForcedBOSTokenLogitsProcessor;x.ForcedEOSTokenLogitsProcessor;x.GLPNFeatureExtractor;x.GLPNForDepthEstimation;x.GLPNModel;x.GLPNPreTrainedModel;x.GPT2LMHeadModel;x.GPT2Model;x.GPT2PreTrainedModel;x.GPT2Tokenizer;x.GPTBigCodeForCausalLM;x.GPTBigCodeModel;x.GPTBigCodePreTrainedModel;x.GPTJForCausalLM;x.GPTJModel;x.GPTJPreTrainedModel;x.GPTNeoForCausalLM;x.GPTNeoModel;x.GPTNeoPreTrainedModel;x.GPTNeoXForCausalLM;x.GPTNeoXModel;x.GPTNeoXPreTrainedModel;x.GPTNeoXTokenizer;x.Gemma2ForCausalLM;x.Gemma2Model;x.Gemma2PreTrainedModel;x.Gemma3ForCausalLM;x.Gemma3Model;x.Gemma3PreTrainedModel;x.Gemma3nAudioFeatureExtractor;x.Gemma3nForConditionalGeneration;x.Gemma3nPreTrainedModel;x.Gemma3nProcessor;x.GemmaForCausalLM;x.GemmaModel;x.GemmaPreTrainedModel;x.GemmaTokenizer;x.GlmForCausalLM;x.GlmModel;x.GlmPreTrainedModel;x.GraniteForCausalLM;x.GraniteModel;x.GraniteMoeHybridForCausalLM;x.GraniteMoeHybridModel;x.GraniteMoeHybridPreTrainedModel;x.GranitePreTrainedModel;x.Grok1Tokenizer;x.GroundingDinoForObjectDetection;x.GroundingDinoImageProcessor;x.GroundingDinoPreTrainedModel;x.GroundingDinoProcessor;x.GroupViTModel;x.GroupViTPreTrainedModel;x.HeliumForCausalLM;x.HeliumModel;x.HeliumPreTrainedModel;x.HerbertTokenizer;x.HieraForImageClassification;x.HieraModel;x.HieraPreTrainedModel;x.HubertForCTC;x.HubertForSequenceClassification;x.HubertModel;x.HubertPreTrainedModel;x.IJepaForImageClassification;x.IJepaModel;x.IJepaPreTrainedModel;x.Idefics3ForConditionalGeneration;x.Idefics3ImageProcessor;x.Idefics3PreTrainedModel;x.Idefics3Processor;x.ImageClassificationPipeline;x.ImageFeatureExtractionPipeline;x.ImageFeatureExtractor;x.ImageMattingOutput;x.ImageProcessor;x.ImageSegmentationPipeline;x.ImageToImagePipeline;x.ImageToTextPipeline;x.InterruptableStoppingCriteria;x.JAISLMHeadModel;x.JAISModel;x.JAISPreTrainedModel;x.JinaCLIPImageProcessor;x.JinaCLIPModel;x.JinaCLIPPreTrainedModel;x.JinaCLIPProcessor;x.JinaCLIPTextModel;x.JinaCLIPVisionModel;x.Lfm2ForCausalLM;x.Lfm2Model;x.Lfm2PreTrainedModel;x.LiteWhisperForConditionalGeneration;x.Llama4ForCausalLM;x.Llama4PreTrainedModel;x.LlamaForCausalLM;x.LlamaModel;x.LlamaPreTrainedModel;x.LlamaTokenizer;x.LlavaForConditionalGeneration;x.LlavaOnevisionForConditionalGeneration;x.LlavaOnevisionImageProcessor;x.LlavaPreTrainedModel;x.LlavaProcessor;x.LlavaQwen2ForCausalLM;x.LogitsProcessor;x.LogitsProcessorList;x.LogitsWarper;x.LongT5ForConditionalGeneration;x.LongT5Model;x.LongT5PreTrainedModel;x.M2M100ForConditionalGeneration;x.M2M100Model;x.M2M100PreTrainedModel;x.M2M100Tokenizer;x.MBart50Tokenizer;x.MBartForCausalLM;x.MBartForConditionalGeneration;x.MBartForSequenceClassification;x.MBartModel;x.MBartPreTrainedModel;x.MBartTokenizer;x.MPNetForMaskedLM;x.MPNetForQuestionAnswering;x.MPNetForSequenceClassification;x.MPNetForTokenClassification;x.MPNetModel;x.MPNetPreTrainedModel;x.MPNetTokenizer;x.MT5ForConditionalGeneration;x.MT5Model;x.MT5PreTrainedModel;x.MarianMTModel;x.MarianModel;x.MarianPreTrainedModel;x.MarianTokenizer;x.Mask2FormerImageProcessor;x.MaskFormerFeatureExtractor;x.MaskFormerForInstanceSegmentation;x.MaskFormerImageProcessor;x.MaskFormerModel;x.MaskFormerPreTrainedModel;x.MaskedLMOutput;x.MaxLengthCriteria;x.Metric3DForDepthEstimation;x.Metric3DPreTrainedModel;x.Metric3Dv2ForDepthEstimation;x.Metric3Dv2PreTrainedModel;x.MgpstrForSceneTextRecognition;x.MgpstrModelOutput;x.MgpstrPreTrainedModel;x.MgpstrProcessor;x.MgpstrTokenizer;x.MimiDecoderModel;x.MimiDecoderOutput;x.MimiEncoderModel;x.MimiEncoderOutput;x.MimiModel;x.MimiPreTrainedModel;x.MinLengthLogitsProcessor;x.MinNewTokensLengthLogitsProcessor;x.Ministral3ForCausalLM;x.Ministral3Model;x.Ministral3PreTrainedModel;x.MinistralForCausalLM;x.MinistralModel;x.MinistralPreTrainedModel;x.Mistral3ForConditionalGeneration;x.MistralForCausalLM;x.MistralModel;x.MistralPreTrainedModel;x.MobileBertForMaskedLM;x.MobileBertForQuestionAnswering;x.MobileBertForSequenceClassification;x.MobileBertModel;x.MobileBertPreTrainedModel;x.MobileBertTokenizer;x.MobileLLMForCausalLM;x.MobileLLMModel;x.MobileLLMPreTrainedModel;x.MobileNetV1FeatureExtractor;x.MobileNetV1ForImageClassification;x.MobileNetV1ForSemanticSegmentation;x.MobileNetV1ImageProcessor;x.MobileNetV1Model;x.MobileNetV1PreTrainedModel;x.MobileNetV2FeatureExtractor;x.MobileNetV2ForImageClassification;x.MobileNetV2ForSemanticSegmentation;x.MobileNetV2ImageProcessor;x.MobileNetV2Model;x.MobileNetV2PreTrainedModel;x.MobileNetV3FeatureExtractor;x.MobileNetV3ForImageClassification;x.MobileNetV3ForSemanticSegmentation;x.MobileNetV3ImageProcessor;x.MobileNetV3Model;x.MobileNetV3PreTrainedModel;x.MobileNetV4FeatureExtractor;x.MobileNetV4ForImageClassification;x.MobileNetV4ForSemanticSegmentation;x.MobileNetV4ImageProcessor;x.MobileNetV4Model;x.MobileNetV4PreTrainedModel;x.MobileViTFeatureExtractor;x.MobileViTForImageClassification;x.MobileViTImageProcessor;x.MobileViTModel;x.MobileViTPreTrainedModel;x.MobileViTV2ForImageClassification;x.MobileViTV2Model;x.MobileViTV2PreTrainedModel;x.ModelOutput;x.ModernBertDecoderForCausalLM;x.ModernBertDecoderModel;x.ModernBertDecoderPreTrainedModel;x.ModernBertForMaskedLM;x.ModernBertForSequenceClassification;x.ModernBertForTokenClassification;x.ModernBertModel;x.ModernBertPreTrainedModel;x.Moondream1ForConditionalGeneration;x.MoonshineFeatureExtractor;x.MoonshineForConditionalGeneration;x.MoonshineModel;x.MoonshinePreTrainedModel;x.MoonshineProcessor;x.MptForCausalLM;x.MptModel;x.MptPreTrainedModel;x.MultiModalityCausalLM;x.MultiModalityPreTrainedModel;x.MusicgenForCausalLM;x.MusicgenForConditionalGeneration;x.MusicgenModel;x.MusicgenPreTrainedModel;x.NanoChatForCausalLM;x.NanoChatModel;x.NanoChatPreTrainedModel;x.NeoBertForMaskedLM;x.NeoBertForQuestionAnswering;x.NeoBertForSequenceClassification;x.NeoBertForTokenClassification;x.NeoBertModel;x.NeoBertPreTrainedModel;x.NllbTokenizer;x.NoBadWordsLogitsProcessor;x.NoRepeatNGramLogitsProcessor;x.NomicBertModel;x.NomicBertPreTrainedModel;x.NougatImageProcessor;x.NougatTokenizer;x.OPTForCausalLM;x.OPTModel;x.OPTPreTrainedModel;x.ObjectDetectionPipeline;x.Olmo2ForCausalLM;x.Olmo2Model;x.Olmo2PreTrainedModel;x.OlmoForCausalLM;x.OlmoModel;x.OlmoPreTrainedModel;x.OpenELMForCausalLM;x.OpenELMModel;x.OpenELMPreTrainedModel;x.OwlViTFeatureExtractor;x.OwlViTForObjectDetection;x.OwlViTImageProcessor;x.OwlViTModel;x.OwlViTPreTrainedModel;x.OwlViTProcessor;x.Owlv2ForObjectDetection;x.Owlv2ImageProcessor;x.Owlv2Model;x.Owlv2PreTrainedModel;x.PaliGemmaForConditionalGeneration;x.PaliGemmaPreTrainedModel;x.PaliGemmaProcessor;x.ParakeetFeatureExtractor;x.ParakeetForCTC;x.ParakeetPreTrainedModel;x.PatchTSMixerForPrediction;x.PatchTSMixerModel;x.PatchTSMixerPreTrainedModel;x.PatchTSTForPrediction;x.PatchTSTModel;x.PatchTSTPreTrainedModel;x.Phi3ForCausalLM;x.Phi3Model;x.Phi3PreTrainedModel;x.Phi3VForCausalLM;x.Phi3VImageProcessor;x.Phi3VPreTrainedModel;x.Phi3VProcessor;x.PhiForCausalLM;x.PhiModel;x.PhiPreTrainedModel;x.Pipeline;x.PixtralImageProcessor;x.PixtralProcessor;x.PreTrainedModel;x.PreTrainedTokenizer;x.PretrainedConfig;x.PretrainedMixin;x.Processor;x.PvtForImageClassification;x.PvtImageProcessor;x.PvtModel;x.PvtPreTrainedModel;x.PyAnnoteFeatureExtractor;x.PyAnnoteForAudioFrameClassification;x.PyAnnoteModel;x.PyAnnotePreTrainedModel;x.PyAnnoteProcessor;x.QuestionAnsweringModelOutput;x.QuestionAnsweringPipeline;x.Qwen2ForCausalLM;x.Qwen2Model;x.Qwen2PreTrainedModel;x.Qwen2Tokenizer;x.Qwen2VLForConditionalGeneration;x.Qwen2VLImageProcessor;x.Qwen2VLPreTrainedModel;x.Qwen2VLProcessor;x.Qwen3ForCausalLM;x.Qwen3Model;x.Qwen3PreTrainedModel;x.RFDetrForObjectDetection;x.RFDetrModel;x.RFDetrObjectDetectionOutput;x.RFDetrPreTrainedModel;x.RTDetrForObjectDetection;x.RTDetrImageProcessor;x.RTDetrModel;x.RTDetrObjectDetectionOutput;x.RTDetrPreTrainedModel;x.RTDetrV2ForObjectDetection;x.RTDetrV2Model;x.RTDetrV2ObjectDetectionOutput;x.RTDetrV2PreTrainedModel;x.RawAudio;x.RawImage;x.RawVideo;x.RawVideoFrame;x.RepetitionPenaltyLogitsProcessor;x.ResNetForImageClassification;x.ResNetModel;x.ResNetPreTrainedModel;x.RoFormerForMaskedLM;x.RoFormerForQuestionAnswering;x.RoFormerForSequenceClassification;x.RoFormerForTokenClassification;x.RoFormerModel;x.RoFormerPreTrainedModel;x.RoFormerTokenizer;x.RobertaForMaskedLM;x.RobertaForQuestionAnswering;x.RobertaForSequenceClassification;x.RobertaForTokenClassification;x.RobertaModel;x.RobertaPreTrainedModel;x.RobertaTokenizer;x.Sam2ImageProcessor;x.Sam2ImageSegmentationOutput;x.Sam2Model;x.Sam2PreTrainedModel;x.Sam2Processor;x.Sam2VideoProcessor;x.Sam3ImageProcessor;x.Sam3TrackerModel;x.SamImageProcessor;x.SamImageSegmentationOutput;x.SamModel;x.SamPreTrainedModel;x.SamProcessor;x.SapiensForDepthEstimation;x.SapiensForNormalEstimation;x.SapiensForSemanticSegmentation;x.SapiensPreTrainedModel;x.SeamlessM4TFeatureExtractor;x.SegformerFeatureExtractor;x.SegformerForImageClassification;x.SegformerForSemanticSegmentation;x.SegformerImageProcessor;x.SegformerModel;x.SegformerPreTrainedModel;x.Seq2SeqLMOutput;x.SequenceClassifierOutput;x.SiglipImageProcessor;x.SiglipModel;x.SiglipPreTrainedModel;x.SiglipTextModel;x.SiglipTokenizer;x.SiglipVisionModel;x.SmolLM3ForCausalLM;x.SmolLM3Model;x.SmolLM3PreTrainedModel;x.SmolVLMForConditionalGeneration;x.SmolVLMImageProcessor;x.SmolVLMProcessor;x.SnacDecoderModel;x.SnacEncoderModel;x.SnacFeatureExtractor;x.SnacModel;x.SnacPreTrainedModel;x.SpeechT5FeatureExtractor;x.SpeechT5ForSpeechToText;x.SpeechT5ForTextToSpeech;x.SpeechT5HifiGan;x.SpeechT5Model;x.SpeechT5PreTrainedModel;x.SpeechT5Processor;x.SpeechT5Tokenizer;x.SqueezeBertForMaskedLM;x.SqueezeBertForQuestionAnswering;x.SqueezeBertForSequenceClassification;x.SqueezeBertModel;x.SqueezeBertPreTrainedModel;x.SqueezeBertTokenizer;x.StableLmForCausalLM;x.StableLmModel;x.StableLmPreTrainedModel;x.Starcoder2ForCausalLM;x.Starcoder2Model;x.Starcoder2PreTrainedModel;x.StoppingCriteria;x.StoppingCriteriaList;x.StyleTextToSpeech2Model;x.StyleTextToSpeech2PreTrainedModel;x.SummarizationPipeline;x.SupertonicForConditionalGeneration;x.SupertonicPreTrainedModel;x.SuppressTokensAtBeginLogitsProcessor;x.Swin2SRForImageSuperResolution;x.Swin2SRImageProcessor;x.Swin2SRModel;x.Swin2SRPreTrainedModel;x.SwinForImageClassification;x.SwinForSemanticSegmentation;x.SwinModel;x.SwinPreTrainedModel;x.T5ForConditionalGeneration;x.T5Model;x.T5PreTrainedModel;x.T5Tokenizer;x.TableTransformerForObjectDetection;x.TableTransformerModel;x.TableTransformerObjectDetectionOutput;x.TableTransformerPreTrainedModel;x.TemperatureLogitsWarper;x.Tensor;x.Text2TextGenerationPipeline;x.TextClassificationPipeline;x.TextGenerationPipeline;x.TextStreamer;x.TextToAudioPipeline;x.TokenClassificationPipeline;x.TokenClassifierOutput;x.TokenizerModel;x.TopKLogitsWarper;x.TopPLogitsWarper;x.TrOCRForCausalLM;x.TrOCRPreTrainedModel;x.TranslationPipeline;x.UltravoxModel;x.UltravoxPreTrainedModel;x.UltravoxProcessor;x.UniSpeechForCTC;x.UniSpeechForSequenceClassification;x.UniSpeechModel;x.UniSpeechPreTrainedModel;x.UniSpeechSatForAudioFrameClassification;x.UniSpeechSatForCTC;x.UniSpeechSatForSequenceClassification;x.UniSpeechSatModel;x.UniSpeechSatPreTrainedModel;x.VLChatProcessor;x.VLMImageProcessor;x.VaultGemmaForCausalLM;x.VaultGemmaModel;x.VaultGemmaPreTrainedModel;x.ViTFeatureExtractor;x.ViTForImageClassification;x.ViTImageProcessor;x.ViTMAEModel;x.ViTMAEPreTrainedModel;x.ViTMSNForImageClassification;x.ViTMSNModel;x.ViTMSNPreTrainedModel;x.ViTModel;x.ViTPreTrainedModel;x.VisionEncoderDecoderModel;x.VitMatteForImageMatting;x.VitMatteImageProcessor;x.VitMattePreTrainedModel;x.VitPoseForPoseEstimation;x.VitPoseImageProcessor;x.VitPosePreTrainedModel;x.VitsModel;x.VitsModelOutput;x.VitsPreTrainedModel;x.VitsTokenizer;x.VoxtralForConditionalGeneration;x.VoxtralProcessor;x.Wav2Vec2BertForCTC;x.Wav2Vec2BertForSequenceClassification;x.Wav2Vec2BertModel;x.Wav2Vec2BertPreTrainedModel;x.Wav2Vec2CTCTokenizer;x.Wav2Vec2FeatureExtractor;x.Wav2Vec2ForAudioFrameClassification;x.Wav2Vec2ForCTC;x.Wav2Vec2ForSequenceClassification;x.Wav2Vec2Model;x.Wav2Vec2PreTrainedModel;x.Wav2Vec2Processor;x.Wav2Vec2ProcessorWithLM;x.WavLMForAudioFrameClassification;x.WavLMForCTC;x.WavLMForSequenceClassification;x.WavLMForXVector;x.WavLMModel;x.WavLMPreTrainedModel;x.WeSpeakerFeatureExtractor;x.WeSpeakerResNetModel;x.WeSpeakerResNetPreTrainedModel;x.WhisperFeatureExtractor;x.WhisperForConditionalGeneration;x.WhisperModel;x.WhisperPreTrainedModel;x.WhisperProcessor;x.WhisperTextStreamer;x.WhisperTimeStampLogitsProcessor;x.WhisperTokenizer;x.XLMForQuestionAnswering;x.XLMForSequenceClassification;x.XLMForTokenClassification;x.XLMModel;x.XLMPreTrainedModel;x.XLMRobertaForMaskedLM;x.XLMRobertaForQuestionAnswering;x.XLMRobertaForSequenceClassification;x.XLMRobertaForTokenClassification;x.XLMRobertaModel;x.XLMRobertaPreTrainedModel;x.XLMRobertaTokenizer;x.XLMTokenizer;x.XLMWithLMHeadModel;x.XVectorOutput;x.YolosFeatureExtractor;x.YolosForObjectDetection;x.YolosImageProcessor;x.YolosModel;x.YolosObjectDetectionOutput;x.YolosPreTrainedModel;x.ZeroShotAudioClassificationPipeline;x.ZeroShotClassificationPipeline;x.ZeroShotImageClassificationPipeline;x.ZeroShotObjectDetectionPipeline;x.bankers_round;x.cat;x.cos_sim;x.dot;x.dynamic_time_warping;var QD=x.env;x.full;x.full_like;x.getCacheShapes;x.hamming;x.hanning;x.interpolate;x.interpolate_4d;x.interpolate_data;x.is_chinese_char;x.layer_norm;x.load_image;x.load_video;x.log_softmax;x.magnitude;x.matmul;x.max;x.mean;x.mean_pooling;x.medianFilter;x.mel_filter_bank;x.min;x.ones;x.ones_like;x.permute;x.permute_data;x.pipeline;x.quantize_embeddings;x.rand;x.randn;x.read_audio;x.rfft;x.round;x.slice;x.softmax;x.spectrogram;x.stack;x.std_mean;x.topk;x.window_function;x.zeros;x.zeros_like;/*!
 * hash-wasm (https://www.npmjs.com/package/hash-wasm)
 * (c) Dani Biro
 * @license MIT
 */function jg(e,t,n,s){function i(o){return o instanceof n?o:new n(function(c){c(o)})}return new(n||(n=Promise))(function(o,c){function d(g){try{h(s.next(g))}catch(p){c(p)}}function u(g){try{h(s.throw(g))}catch(p){c(p)}}function h(g){g.done?o(g.value):i(g.value).then(d,u)}h((s=s.apply(e,[])).next())})}class Qr{constructor(){this.mutex=Promise.resolve()}lock(){let t=()=>{};return this.mutex=this.mutex.then(()=>new Promise(t)),new Promise(n=>{t=n})}dispatch(t){return jg(this,void 0,void 0,function*(){const n=yield this.lock();try{return yield Promise.resolve(t())}finally{n()}})}}var H0;function qD(){return typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global}const Iv=qD(),Q0=(H0=Iv.Buffer)!==null&&H0!==void 0?H0:null,KD=Iv.TextEncoder?new Iv.TextEncoder:null;function cC(e,t){return(e&15)+(e>>6|e>>3&8)<<4|(t&15)+(t>>6|t>>3&8)}function XD(e,t){const n=t.length>>1;for(let s=0;s<n;s++){const i=s<<1;e[s]=cC(t.charCodeAt(i),t.charCodeAt(i+1))}}function YD(e,t){if(e.length!==t.length*2)return!1;for(let n=0;n<t.length;n++){const s=n<<1;if(t[n]!==cC(e.charCodeAt(s),e.charCodeAt(s+1)))return!1}return!0}const y1=87,b1=48;function w1(e,t,n){let s=0;for(let i=0;i<n;i++){let o=t[i]>>>4;e[s++]=o>9?o+y1:o+b1,o=t[i]&15,e[s++]=o>9?o+y1:o+b1}return String.fromCharCode.apply(null,e)}const M1=Q0!==null?e=>{if(typeof e=="string"){const t=Q0.from(e,"utf8");return new Uint8Array(t.buffer,t.byteOffset,t.length)}if(Q0.isBuffer(e))return new Uint8Array(e.buffer,e.byteOffset,e.length);if(ArrayBuffer.isView(e))return new Uint8Array(e.buffer,e.byteOffset,e.byteLength);throw new Error("Invalid data type!")}:e=>{if(typeof e=="string")return KD.encode(e);if(ArrayBuffer.isView(e))return new Uint8Array(e.buffer,e.byteOffset,e.byteLength);throw new Error("Invalid data type!")},x1="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",lm=new Uint8Array(256);for(let e=0;e<x1.length;e++)lm[x1.charCodeAt(e)]=e;function JD(e){let t=Math.floor(e.length*.75);const n=e.length;return e[n-1]==="="&&(t-=1,e[n-2]==="="&&(t-=1)),t}function ZD(e){const t=JD(e),n=e.length,s=new Uint8Array(t);let i=0;for(let o=0;o<n;o+=4){const c=lm[e.charCodeAt(o)],d=lm[e.charCodeAt(o+1)],u=lm[e.charCodeAt(o+2)],h=lm[e.charCodeAt(o+3)];s[i]=c<<2|d>>4,i+=1,s[i]=(d&15)<<4|u>>2,i+=1,s[i]=(u&3)<<6|h&63,i+=1}return s}const Pg=16*1024,nm=4,eO=new Qr,q0=new Map;function tO(e,t){return jg(this,void 0,void 0,function*(){let n=null,s=null,i=!1;if(typeof WebAssembly>"u")throw new Error("WebAssembly is not supported in this environment!");const o=(C,A=0)=>{s.set(C,A)},c=()=>s,d=()=>n.exports,u=C=>{n.exports.Hash_SetMemorySize(C);const A=n.exports.Hash_GetBuffer(),k=n.exports.memory.buffer;s=new Uint8Array(k,A,C)},h=()=>new DataView(n.exports.memory.buffer).getUint32(n.exports.STATE_SIZE,!0),g=eO.dispatch(()=>jg(this,void 0,void 0,function*(){if(!q0.has(e.name)){const A=ZD(e.data),k=WebAssembly.compile(A);q0.set(e.name,k)}const C=yield q0.get(e.name);n=yield WebAssembly.instantiate(C,{})})),p=()=>jg(this,void 0,void 0,function*(){n||(yield g);const C=n.exports.Hash_GetBuffer(),A=n.exports.memory.buffer;s=new Uint8Array(A,C,Pg)}),m=(C=null)=>{i=!0,n.exports.Hash_Init(C)},y=C=>{let A=0;for(;A<C.length;){const k=C.subarray(A,A+Pg);A+=k.length,s.set(k),n.exports.Hash_Update(k.length)}},v=C=>{if(!i)throw new Error("update() called before init()");const A=M1(C);y(A)},T=new Uint8Array(t*2),O=(C,A=null)=>{if(!i)throw new Error("digest() called before init()");return i=!1,n.exports.Hash_Final(A),C==="binary"?s.slice(0,t):w1(T,s,t)},E=()=>{if(!i)throw new Error("save() can only be called after init() and before digest()");const C=n.exports.Hash_GetState(),A=h(),k=n.exports.memory.buffer,R=new Uint8Array(k,C,A),G=new Uint8Array(nm+A);return XD(G,e.hash),G.set(R,nm),G},S=C=>{if(!(C instanceof Uint8Array))throw new Error("load() expects an Uint8Array generated by save()");const A=n.exports.Hash_GetState(),k=h(),R=nm+k,G=n.exports.memory.buffer;if(C.length!==R)throw new Error(`Bad state length (expected ${R} bytes, got ${C.length})`);if(!YD(e.hash,C.subarray(0,nm)))throw new Error("This state was written by an incompatible hash implementation");const te=C.subarray(nm);new Uint8Array(G,A,k).set(te),i=!0},D=C=>typeof C=="string"?C.length<Pg/4:C.byteLength<Pg;let I=D;switch(e.name){case"argon2":case"scrypt":I=()=>!0;break;case"blake2b":case"blake2s":I=(C,A)=>A<=512&&D(C);break;case"blake3":I=(C,A)=>A===0&&D(C);break;case"xxhash64":case"xxhash3":case"xxhash128":case"crc64":I=()=>!1;break}const M=(C,A=null,k=null)=>{if(!I(C,A))return m(A),v(C),O("hex",k);const R=M1(C);return s.set(R),n.exports.Hash_Calculate(R.length,A,k),w1(T,s,t)};return yield p(),{getMemory:c,writeMemory:o,getExports:d,setMemorySize:u,init:m,update:v,digest:O,save:E,load:S,calculate:M,hashLength:t}})}new Qr;new Qr;new Qr;new Qr;new Qr;new Qr;new Qr;new Qr;new Qr;new Qr;new Qr;var nO="sha256",rO="AGFzbQEAAAABEQRgAAF/YAF/AGAAAGACf38AAwgHAAEBAQIAAwUEAQECAgYOAn8BQfCJBQt/AEGACAsHcAgGbWVtb3J5AgAOSGFzaF9HZXRCdWZmZXIAAAlIYXNoX0luaXQAAQtIYXNoX1VwZGF0ZQACCkhhc2hfRmluYWwABA1IYXNoX0dldFN0YXRlAAUOSGFzaF9DYWxjdWxhdGUABgpTVEFURV9TSVpFAwEKnEoHBQBBgAkLnQEAQQBCADcDwIkBQQBBHEEgIABB4AFGIgAbNgLoiQFBAEKnn+anxvST/b5/Qquzj/yRo7Pw2wAgABs3A+CJAUEAQrGWgP6fooWs6ABC/6S5iMWR2oKbfyAAGzcD2IkBQQBCl7rDg5Onlod3QvLmu+Ojp/2npX8gABs3A9CJAUEAQti9loj8oLW+NkLnzKfQ1tDrs7t/IAAbNwPIiQEL7wICAX4Gf0EAQQApA8CJASIBIACtfDcDwIkBAkACQAJAIAGnQT9xIgINAEGACSEDDAELAkBBwAAgAmsiBCAAIAQgAEkbIgNFDQAgA0EDcSEFIAJBgIkBaiEGQQAhAgJAIANBBEkNACADQfwAcSEHQQAhAgNAIAYgAmoiAyACQYAJai0AADoAACADQQFqIAJBgQlqLQAAOgAAIANBAmogAkGCCWotAAA6AAAgA0EDaiACQYMJai0AADoAACAHIAJBBGoiAkcNAAsLIAVFDQADQCAGIAJqIAJBgAlqLQAAOgAAIAJBAWohAiAFQX9qIgUNAAsLIAAgBEkNAUGAiQEQAyAAIARrIQAgBEGACWohAwsCQCAAQcAASQ0AA0AgAxADIANBwABqIQMgAEFAaiIAQT9LDQALCyAARQ0AQQAhAkEAIQUDQCACQYCJAWogAyACai0AADoAACACQQFqIQIgACAFQQFqIgVB/wFxSw0ACwsLoz4BRX9BACAAKAI8IgFBGHQgAUGA/gNxQQh0ciABQQh2QYD+A3EgAUEYdnJyIgFBGXcgAUEOd3MgAUEDdnMgACgCOCICQRh0IAJBgP4DcUEIdHIgAkEIdkGA/gNxIAJBGHZyciICaiAAKAIgIgNBGHQgA0GA/gNxQQh0ciADQQh2QYD+A3EgA0EYdnJyIgRBGXcgBEEOd3MgBEEDdnMgACgCHCIDQRh0IANBgP4DcUEIdHIgA0EIdkGA/gNxIANBGHZyciIFaiAAKAIEIgNBGHQgA0GA/gNxQQh0ciADQQh2QYD+A3EgA0EYdnJyIgZBGXcgBkEOd3MgBkEDdnMgACgCACIDQRh0IANBgP4DcUEIdHIgA0EIdkGA/gNxIANBGHZyciIHaiAAKAIkIgNBGHQgA0GA/gNxQQh0ciADQQh2QYD+A3EgA0EYdnJyIghqIAJBD3cgAkENd3MgAkEKdnNqIgNqIAAoAhgiCUEYdCAJQYD+A3FBCHRyIAlBCHZBgP4DcSAJQRh2cnIiCkEZdyAKQQ53cyAKQQN2cyAAKAIUIglBGHQgCUGA/gNxQQh0ciAJQQh2QYD+A3EgCUEYdnJyIgtqIAJqIAAoAhAiCUEYdCAJQYD+A3FBCHRyIAlBCHZBgP4DcSAJQRh2cnIiDEEZdyAMQQ53cyAMQQN2cyAAKAIMIglBGHQgCUGA/gNxQQh0ciAJQQh2QYD+A3EgCUEYdnJyIg1qIAAoAjAiCUEYdCAJQYD+A3FBCHRyIAlBCHZBgP4DcSAJQRh2cnIiDmogACgCCCIJQRh0IAlBgP4DcUEIdHIgCUEIdkGA/gNxIAlBGHZyciIPQRl3IA9BDndzIA9BA3ZzIAZqIAAoAigiCUEYdCAJQYD+A3FBCHRyIAlBCHZBgP4DcSAJQRh2cnIiEGogAUEPdyABQQ13cyABQQp2c2oiCUEPdyAJQQ13cyAJQQp2c2oiEUEPdyARQQ13cyARQQp2c2oiEkEPdyASQQ13cyASQQp2c2oiE2ogACgCNCIUQRh0IBRBgP4DcUEIdHIgFEEIdkGA/gNxIBRBGHZyciIVQRl3IBVBDndzIBVBA3ZzIA5qIBJqIAAoAiwiAEEYdCAAQYD+A3FBCHRyIABBCHZBgP4DcSAAQRh2cnIiFkEZdyAWQQ53cyAWQQN2cyAQaiARaiAIQRl3IAhBDndzIAhBA3ZzIARqIAlqIAVBGXcgBUEOd3MgBUEDdnMgCmogAWogC0EZdyALQQ53cyALQQN2cyAMaiAVaiANQRl3IA1BDndzIA1BA3ZzIA9qIBZqIANBD3cgA0ENd3MgA0EKdnNqIhRBD3cgFEENd3MgFEEKdnNqIhdBD3cgF0ENd3MgF0EKdnNqIhhBD3cgGEENd3MgGEEKdnNqIhlBD3cgGUENd3MgGUEKdnNqIhpBD3cgGkENd3MgGkEKdnNqIhtBD3cgG0ENd3MgG0EKdnNqIhxBGXcgHEEOd3MgHEEDdnMgAkEZdyACQQ53cyACQQN2cyAVaiAYaiAOQRl3IA5BDndzIA5BA3ZzIBZqIBdqIBBBGXcgEEEOd3MgEEEDdnMgCGogFGogE0EPdyATQQ13cyATQQp2c2oiHUEPdyAdQQ13cyAdQQp2c2oiHkEPdyAeQQ13cyAeQQp2c2oiH2ogE0EZdyATQQ53cyATQQN2cyAYaiADQRl3IANBDndzIANBA3ZzIAFqIBlqIB9BD3cgH0ENd3MgH0EKdnNqIiBqIBJBGXcgEkEOd3MgEkEDdnMgF2ogH2ogEUEZdyARQQ53cyARQQN2cyAUaiAeaiAJQRl3IAlBDndzIAlBA3ZzIANqIB1qIBxBD3cgHEENd3MgHEEKdnNqIiFBD3cgIUENd3MgIUEKdnNqIiJBD3cgIkENd3MgIkEKdnNqIiNBD3cgI0ENd3MgI0EKdnNqIiRqIBtBGXcgG0EOd3MgG0EDdnMgHmogI2ogGkEZdyAaQQ53cyAaQQN2cyAdaiAiaiAZQRl3IBlBDndzIBlBA3ZzIBNqICFqIBhBGXcgGEEOd3MgGEEDdnMgEmogHGogF0EZdyAXQQ53cyAXQQN2cyARaiAbaiAUQRl3IBRBDndzIBRBA3ZzIAlqIBpqICBBD3cgIEENd3MgIEEKdnNqIiVBD3cgJUENd3MgJUEKdnNqIiZBD3cgJkENd3MgJkEKdnNqIidBD3cgJ0ENd3MgJ0EKdnNqIihBD3cgKEENd3MgKEEKdnNqIilBD3cgKUENd3MgKUEKdnNqIipBD3cgKkENd3MgKkEKdnNqIitBGXcgK0EOd3MgK0EDdnMgH0EZdyAfQQ53cyAfQQN2cyAbaiAnaiAeQRl3IB5BDndzIB5BA3ZzIBpqICZqIB1BGXcgHUEOd3MgHUEDdnMgGWogJWogJEEPdyAkQQ13cyAkQQp2c2oiLEEPdyAsQQ13cyAsQQp2c2oiLUEPdyAtQQ13cyAtQQp2c2oiLmogJEEZdyAkQQ53cyAkQQN2cyAnaiAgQRl3ICBBDndzICBBA3ZzIBxqIChqIC5BD3cgLkENd3MgLkEKdnNqIi9qICNBGXcgI0EOd3MgI0EDdnMgJmogLmogIkEZdyAiQQ53cyAiQQN2cyAlaiAtaiAhQRl3ICFBDndzICFBA3ZzICBqICxqICtBD3cgK0ENd3MgK0EKdnNqIjBBD3cgMEENd3MgMEEKdnNqIjFBD3cgMUENd3MgMUEKdnNqIjJBD3cgMkENd3MgMkEKdnNqIjNqICpBGXcgKkEOd3MgKkEDdnMgLWogMmogKUEZdyApQQ53cyApQQN2cyAsaiAxaiAoQRl3IChBDndzIChBA3ZzICRqIDBqICdBGXcgJ0EOd3MgJ0EDdnMgI2ogK2ogJkEZdyAmQQ53cyAmQQN2cyAiaiAqaiAlQRl3ICVBDndzICVBA3ZzICFqIClqIC9BD3cgL0ENd3MgL0EKdnNqIjRBD3cgNEENd3MgNEEKdnNqIjVBD3cgNUENd3MgNUEKdnNqIjZBD3cgNkENd3MgNkEKdnNqIjdBD3cgN0ENd3MgN0EKdnNqIjhBD3cgOEENd3MgOEEKdnNqIjlBD3cgOUENd3MgOUEKdnNqIjogOCA0IC4gLCAhIBsgGSADIA4gBEEAKALYiQEiO0EadyA7QRV3cyA7QQd3c0EAKALkiQEiPGpBACgC4IkBIj1BACgC3IkBIj5zIDtxID1zaiAHakGY36iUBGoiB0EAKALUiQEiP2oiACAMaiA7IA1qID4gD2ogPSAGaiAAID4gO3NxID5zaiAAQRp3IABBFXdzIABBB3dzakGRid2JB2oiQEEAKALQiQEiQWoiDCAAIDtzcSA7c2ogDEEadyAMQRV3cyAMQQd3c2pBz/eDrntqIkJBACgCzIkBIkNqIg0gDCAAc3EgAHNqIA1BGncgDUEVd3MgDUEHd3NqQaW3181+aiJEQQAoAsiJASIAaiIPIA0gDHNxIAxzaiAPQRp3IA9BFXdzIA9BB3dzakHbhNvKA2oiRSBBIEMgAHNxIEMgAHFzIABBHncgAEETd3MgAEEKd3NqIAdqIgZqIgdqIAUgD2ogCiANaiALIAxqIAcgDyANc3EgDXNqIAdBGncgB0EVd3MgB0EHd3NqQfGjxM8FaiIKIAYgAHMgQ3EgBiAAcXMgBkEedyAGQRN3cyAGQQp3c2ogQGoiDGoiBCAHIA9zcSAPc2ogBEEadyAEQRV3cyAEQQd3c2pBpIX+kXlqIgsgDCAGcyAAcSAMIAZxcyAMQR53IAxBE3dzIAxBCndzaiBCaiINaiIPIAQgB3NxIAdzaiAPQRp3IA9BFXdzIA9BB3dzakHVvfHYemoiQCANIAxzIAZxIA0gDHFzIA1BHncgDUETd3MgDUEKd3NqIERqIgZqIgcgDyAEc3EgBHNqIAdBGncgB0EVd3MgB0EHd3NqQZjVnsB9aiJCIAYgDXMgDHEgBiANcXMgBkEedyAGQRN3cyAGQQp3c2ogRWoiDGoiBWogFiAHaiAQIA9qIAggBGogBSAHIA9zcSAPc2ogBUEadyAFQRV3cyAFQQd3c2pBgbaNlAFqIgggDCAGcyANcSAMIAZxcyAMQR53IAxBE3dzIAxBCndzaiAKaiINaiIPIAUgB3NxIAdzaiAPQRp3IA9BFXdzIA9BB3dzakG+i8ahAmoiDiANIAxzIAZxIA0gDHFzIA1BHncgDUETd3MgDUEKd3NqIAtqIgZqIgcgDyAFc3EgBXNqIAdBGncgB0EVd3MgB0EHd3NqQcP7sagFaiIQIAYgDXMgDHEgBiANcXMgBkEedyAGQRN3cyAGQQp3c2ogQGoiDGoiBCAHIA9zcSAPc2ogBEEadyAEQRV3cyAEQQd3c2pB9Lr5lQdqIhYgDCAGcyANcSAMIAZxcyAMQR53IAxBE3dzIAxBCndzaiBCaiINaiIFaiABIARqIAIgB2ogFSAPaiAFIAQgB3NxIAdzaiAFQRp3IAVBFXdzIAVBB3dzakH+4/qGeGoiByANIAxzIAZxIA0gDHFzIA1BHncgDUETd3MgDUEKd3NqIAhqIgFqIgYgBSAEc3EgBHNqIAZBGncgBkEVd3MgBkEHd3NqQaeN8N55aiIEIAEgDXMgDHEgASANcXMgAUEedyABQRN3cyABQQp3c2ogDmoiAmoiDCAGIAVzcSAFc2ogDEEadyAMQRV3cyAMQQd3c2pB9OLvjHxqIgUgAiABcyANcSACIAFxcyACQR53IAJBE3dzIAJBCndzaiAQaiIDaiINIAwgBnNxIAZzaiANQRp3IA1BFXdzIA1BB3dzakHB0+2kfmoiCCADIAJzIAFxIAMgAnFzIANBHncgA0ETd3MgA0EKd3NqIBZqIgFqIg8gF2ogESANaiAUIAxqIAkgBmogDyANIAxzcSAMc2ogD0EadyAPQRV3cyAPQQd3c2pBho/5/X5qIgYgASADcyACcSABIANxcyABQR53IAFBE3dzIAFBCndzaiAHaiICaiIJIA8gDXNxIA1zaiAJQRp3IAlBFXdzIAlBB3dzakHGu4b+AGoiDCACIAFzIANxIAIgAXFzIAJBHncgAkETd3MgAkEKd3NqIARqIgNqIhEgCSAPc3EgD3NqIBFBGncgEUEVd3MgEUEHd3NqQczDsqACaiINIAMgAnMgAXEgAyACcXMgA0EedyADQRN3cyADQQp3c2ogBWoiAWoiFCARIAlzcSAJc2ogFEEadyAUQRV3cyAUQQd3c2pB79ik7wJqIg8gASADcyACcSABIANxcyABQR53IAFBE3dzIAFBCndzaiAIaiICaiIXaiATIBRqIBggEWogEiAJaiAXIBQgEXNxIBFzaiAXQRp3IBdBFXdzIBdBB3dzakGqidLTBGoiGCACIAFzIANxIAIgAXFzIAJBHncgAkETd3MgAkEKd3NqIAZqIgNqIgkgFyAUc3EgFHNqIAlBGncgCUEVd3MgCUEHd3NqQdzTwuUFaiIUIAMgAnMgAXEgAyACcXMgA0EedyADQRN3cyADQQp3c2ogDGoiAWoiESAJIBdzcSAXc2ogEUEadyARQRV3cyARQQd3c2pB2pHmtwdqIhcgASADcyACcSABIANxcyABQR53IAFBE3dzIAFBCndzaiANaiICaiISIBEgCXNxIAlzaiASQRp3IBJBFXdzIBJBB3dzakHSovnBeWoiGSACIAFzIANxIAIgAXFzIAJBHncgAkETd3MgAkEKd3NqIA9qIgNqIhNqIB4gEmogGiARaiAdIAlqIBMgEiARc3EgEXNqIBNBGncgE0EVd3MgE0EHd3NqQe2Mx8F6aiIaIAMgAnMgAXEgAyACcXMgA0EedyADQRN3cyADQQp3c2ogGGoiAWoiCSATIBJzcSASc2ogCUEadyAJQRV3cyAJQQd3c2pByM+MgHtqIhggASADcyACcSABIANxcyABQR53IAFBE3dzIAFBCndzaiAUaiICaiIRIAkgE3NxIBNzaiARQRp3IBFBFXdzIBFBB3dzakHH/+X6e2oiFCACIAFzIANxIAIgAXFzIAJBHncgAkETd3MgAkEKd3NqIBdqIgNqIhIgESAJc3EgCXNqIBJBGncgEkEVd3MgEkEHd3NqQfOXgLd8aiIXIAMgAnMgAXEgAyACcXMgA0EedyADQRN3cyADQQp3c2ogGWoiAWoiE2ogICASaiAcIBFqIB8gCWogEyASIBFzcSARc2ogE0EadyATQRV3cyATQQd3c2pBx6KerX1qIhkgASADcyACcSABIANxcyABQR53IAFBE3dzIAFBCndzaiAaaiICaiIJIBMgEnNxIBJzaiAJQRp3IAlBFXdzIAlBB3dzakHRxqk2aiIaIAIgAXMgA3EgAiABcXMgAkEedyACQRN3cyACQQp3c2ogGGoiA2oiESAJIBNzcSATc2ogEUEadyARQRV3cyARQQd3c2pB59KkoQFqIhggAyACcyABcSADIAJxcyADQR53IANBE3dzIANBCndzaiAUaiIBaiISIBEgCXNxIAlzaiASQRp3IBJBFXdzIBJBB3dzakGFldy9AmoiFCABIANzIAJxIAEgA3FzIAFBHncgAUETd3MgAUEKd3NqIBdqIgJqIhMgI2ogJiASaiAiIBFqICUgCWogEyASIBFzcSARc2ogE0EadyATQRV3cyATQQd3c2pBuMLs8AJqIhcgAiABcyADcSACIAFxcyACQR53IAJBE3dzIAJBCndzaiAZaiIDaiIJIBMgEnNxIBJzaiAJQRp3IAlBFXdzIAlBB3dzakH827HpBGoiGSADIAJzIAFxIAMgAnFzIANBHncgA0ETd3MgA0EKd3NqIBpqIgFqIhEgCSATc3EgE3NqIBFBGncgEUEVd3MgEUEHd3NqQZOa4JkFaiIaIAEgA3MgAnEgASADcXMgAUEedyABQRN3cyABQQp3c2ogGGoiAmoiEiARIAlzcSAJc2ogEkEadyASQRV3cyASQQd3c2pB1OapqAZqIhggAiABcyADcSACIAFxcyACQR53IAJBE3dzIAJBCndzaiAUaiIDaiITaiAoIBJqICQgEWogJyAJaiATIBIgEXNxIBFzaiATQRp3IBNBFXdzIBNBB3dzakG7laizB2oiFCADIAJzIAFxIAMgAnFzIANBHncgA0ETd3MgA0EKd3NqIBdqIgFqIgkgEyASc3EgEnNqIAlBGncgCUEVd3MgCUEHd3NqQa6Si454aiIXIAEgA3MgAnEgASADcXMgAUEedyABQRN3cyABQQp3c2ogGWoiAmoiESAJIBNzcSATc2ogEUEadyARQRV3cyARQQd3c2pBhdnIk3lqIhkgAiABcyADcSACIAFxcyACQR53IAJBE3dzIAJBCndzaiAaaiIDaiISIBEgCXNxIAlzaiASQRp3IBJBFXdzIBJBB3dzakGh0f+VemoiGiADIAJzIAFxIAMgAnFzIANBHncgA0ETd3MgA0EKd3NqIBhqIgFqIhNqICogEmogLSARaiApIAlqIBMgEiARc3EgEXNqIBNBGncgE0EVd3MgE0EHd3NqQcvM6cB6aiIYIAEgA3MgAnEgASADcXMgAUEedyABQRN3cyABQQp3c2ogFGoiAmoiCSATIBJzcSASc2ogCUEadyAJQRV3cyAJQQd3c2pB8JauknxqIhQgAiABcyADcSACIAFxcyACQR53IAJBE3dzIAJBCndzaiAXaiIDaiIRIAkgE3NxIBNzaiARQRp3IBFBFXdzIBFBB3dzakGjo7G7fGoiFyADIAJzIAFxIAMgAnFzIANBHncgA0ETd3MgA0EKd3NqIBlqIgFqIhIgESAJc3EgCXNqIBJBGncgEkEVd3MgEkEHd3NqQZnQy4x9aiIZIAEgA3MgAnEgASADcXMgAUEedyABQRN3cyABQQp3c2ogGmoiAmoiE2ogMCASaiAvIBFqICsgCWogEyASIBFzcSARc2ogE0EadyATQRV3cyATQQd3c2pBpIzktH1qIhogAiABcyADcSACIAFxcyACQR53IAJBE3dzIAJBCndzaiAYaiIDaiIJIBMgEnNxIBJzaiAJQRp3IAlBFXdzIAlBB3dzakGF67igf2oiGCADIAJzIAFxIAMgAnFzIANBHncgA0ETd3MgA0EKd3NqIBRqIgFqIhEgCSATc3EgE3NqIBFBGncgEUEVd3MgEUEHd3NqQfDAqoMBaiIUIAEgA3MgAnEgASADcXMgAUEedyABQRN3cyABQQp3c2ogF2oiAmoiEiARIAlzcSAJc2ogEkEadyASQRV3cyASQQd3c2pBloKTzQFqIhcgAiABcyADcSACIAFxcyACQR53IAJBE3dzIAJBCndzaiAZaiIDaiITIDZqIDIgEmogNSARaiAxIAlqIBMgEiARc3EgEXNqIBNBGncgE0EVd3MgE0EHd3NqQYjY3fEBaiIZIAMgAnMgAXEgAyACcXMgA0EedyADQRN3cyADQQp3c2ogGmoiAWoiCSATIBJzcSASc2ogCUEadyAJQRV3cyAJQQd3c2pBzO6hugJqIhogASADcyACcSABIANxcyABQR53IAFBE3dzIAFBCndzaiAYaiICaiIRIAkgE3NxIBNzaiARQRp3IBFBFXdzIBFBB3dzakG1+cKlA2oiGCACIAFzIANxIAIgAXFzIAJBHncgAkETd3MgAkEKd3NqIBRqIgNqIhIgESAJc3EgCXNqIBJBGncgEkEVd3MgEkEHd3NqQbOZ8MgDaiIUIAMgAnMgAXEgAyACcXMgA0EedyADQRN3cyADQQp3c2ogF2oiAWoiE2ogLEEZdyAsQQ53cyAsQQN2cyAoaiA0aiAzQQ93IDNBDXdzIDNBCnZzaiIXIBJqIDcgEWogMyAJaiATIBIgEXNxIBFzaiATQRp3IBNBFXdzIBNBB3dzakHK1OL2BGoiGyABIANzIAJxIAEgA3FzIAFBHncgAUETd3MgAUEKd3NqIBlqIgJqIgkgEyASc3EgEnNqIAlBGncgCUEVd3MgCUEHd3NqQc+U89wFaiIZIAIgAXMgA3EgAiABcXMgAkEedyACQRN3cyACQQp3c2ogGmoiA2oiESAJIBNzcSATc2ogEUEadyARQRV3cyARQQd3c2pB89+5wQZqIhogAyACcyABcSADIAJxcyADQR53IANBE3dzIANBCndzaiAYaiIBaiISIBEgCXNxIAlzaiASQRp3IBJBFXdzIBJBB3dzakHuhb6kB2oiHCABIANzIAJxIAEgA3FzIAFBHncgAUETd3MgAUEKd3NqIBRqIgJqIhNqIC5BGXcgLkEOd3MgLkEDdnMgKmogNmogLUEZdyAtQQ53cyAtQQN2cyApaiA1aiAXQQ93IBdBDXdzIBdBCnZzaiIUQQ93IBRBDXdzIBRBCnZzaiIYIBJqIDkgEWogFCAJaiATIBIgEXNxIBFzaiATQRp3IBNBFXdzIBNBB3dzakHvxpXFB2oiCSACIAFzIANxIAIgAXFzIAJBHncgAkETd3MgAkEKd3NqIBtqIgNqIhEgEyASc3EgEnNqIBFBGncgEUEVd3MgEUEHd3NqQZTwoaZ4aiIbIAMgAnMgAXEgAyACcXMgA0EedyADQRN3cyADQQp3c2ogGWoiAWoiEiARIBNzcSATc2ogEkEadyASQRV3cyASQQd3c2pBiISc5nhqIhkgASADcyACcSABIANxcyABQR53IAFBE3dzIAFBCndzaiAaaiICaiITIBIgEXNxIBFzaiATQRp3IBNBFXdzIBNBB3dzakH6//uFeWoiGiACIAFzIANxIAIgAXFzIAJBHncgAkETd3MgAkEKd3NqIBxqIgNqIhQgPGo2AuSJAUEAID8gAyACcyABcSADIAJxcyADQR53IANBE3dzIANBCndzaiAJaiIBIANzIAJxIAEgA3FzIAFBHncgAUETd3MgAUEKd3NqIBtqIgIgAXMgA3EgAiABcXMgAkEedyACQRN3cyACQQp3c2ogGWoiAyACcyABcSADIAJxcyADQR53IANBE3dzIANBCndzaiAaaiIJajYC1IkBQQAgPSAvQRl3IC9BDndzIC9BA3ZzICtqIDdqIBhBD3cgGEENd3MgGEEKdnNqIhggEWogFCATIBJzcSASc2ogFEEadyAUQRV3cyAUQQd3c2pB69nBonpqIhkgAWoiEWo2AuCJAUEAIEEgCSADcyACcSAJIANxcyAJQR53IAlBE3dzIAlBCndzaiAZaiIBajYC0IkBQQAgPiAwQRl3IDBBDndzIDBBA3ZzIC9qIBdqIDpBD3cgOkENd3MgOkEKdnNqIBJqIBEgFCATc3EgE3NqIBFBGncgEUEVd3MgEUEHd3NqQffH5vd7aiIXIAJqIhJqNgLciQFBACBDIAEgCXMgA3EgASAJcXMgAUEedyABQRN3cyABQQp3c2ogF2oiAmo2AsyJAUEAIDsgNEEZdyA0QQ53cyA0QQN2cyAwaiA4aiAYQQ93IBhBDXdzIBhBCnZzaiATaiASIBEgFHNxIBRzaiASQRp3IBJBFXdzIBJBB3dzakHy8cWzfGoiESADamo2AtiJAUEAIAAgAiABcyAJcSACIAFxcyACQR53IAJBE3dzIAJBCndzaiARamo2AsiJAQuyBgIEfwF+QQAoAsCJASIAQQJ2QQ9xIgFBAnRBgIkBaiICIAIoAgBBfyAAQQN0IgB0QX9zcUGAASAAdHM2AgACQAJAAkAgAUEOSQ0AAkAgAUEORw0AQQBBADYCvIkBC0GAiQEQA0EAIQIMAQsgAUENRg0BIAFBAWohAgsgAiEDAkBBBiACa0EHcSIARQ0AIAIgAGohAyACQQJ0QYCJAWohAQNAIAFBADYCACABQQRqIQEgAEF/aiIADQALCyACQXlqQQdJDQAgA0ECdCEBA0AgAUGYiQFqQgA3AgAgAUGQiQFqQgA3AgAgAUGIiQFqQgA3AgAgAUGAiQFqQgA3AgAgAUEgaiIBQThHDQALC0EAIQFBAEEAKQPAiQEiBKciAEEbdCAAQQt0QYCA/AdxciAAQQV2QYD+A3EgAEEDdEEYdnJyNgK8iQFBACAEQh2IpyIAQRh0IABBgP4DcUEIdHIgAEEIdkGA/gNxIABBGHZycjYCuIkBQYCJARADQQBBACgC5IkBIgBBGHQgAEGA/gNxQQh0ciAAQQh2QYD+A3EgAEEYdnJyNgLkiQFBAEEAKALgiQEiAEEYdCAAQYD+A3FBCHRyIABBCHZBgP4DcSAAQRh2cnI2AuCJAUEAQQAoAtyJASIAQRh0IABBgP4DcUEIdHIgAEEIdkGA/gNxIABBGHZycjYC3IkBQQBBACgC2IkBIgBBGHQgAEGA/gNxQQh0ciAAQQh2QYD+A3EgAEEYdnJyNgLYiQFBAEEAKALUiQEiAEEYdCAAQYD+A3FBCHRyIABBCHZBgP4DcSAAQRh2cnI2AtSJAUEAQQAoAtCJASIAQRh0IABBgP4DcUEIdHIgAEEIdkGA/gNxIABBGHZycjYC0IkBQQBBACgCzIkBIgBBGHQgAEGA/gNxQQh0ciAAQQh2QYD+A3EgAEEYdnJyNgLMiQFBAEEAKALIiQEiAEEYdCAAQYD+A3FBCHRyIABBCHZBgP4DcSAAQRh2cnI2AsiJAQJAQQAoAuiJASICRQ0AQQAhAANAIAFBgAlqIAFByIkBai0AADoAACABQQFqIQEgAiAAQQFqIgBB/wFxSw0ACwsLBgBBgIkBC6MBAEEAQgA3A8CJAUEAQRxBICABQeABRiIBGzYC6IkBQQBCp5/mp8b0k/2+f0Krs4/8kaOz8NsAIAEbNwPgiQFBAEKxloD+n6KFrOgAQv+kuYjFkdqCm38gARs3A9iJAUEAQpe6w4OTp5aHd0Ly5rvjo6f9p6V/IAEbNwPQiQFBAELYvZaI/KC1vjZC58yn0NbQ67O7fyABGzcDyIkBIAAQAhAECwsLAQBBgAgLBHAAAAA=",aO="8c18dd94",sO={name:nO,data:rO,hash:aO};new Qr;new Qr;function iO(){return tO(sO,32).then(e=>{e.init(256);const t={init:()=>(e.init(256),t),update:n=>(e.update(n),t),digest:n=>e.digest(n),save:()=>e.save(),load:n=>(e.load(n),t),blockSize:64,digestSize:32};return t})}new Qr;new Qr;new Qr;new Qr;new Qr;new Qr;new Qr;new Qr;new Qr;const oO=QD.cacheName||"transformers-cache";class bu{constructor(){this.activeDownloads=new Map,this.queue=[],this.activeCount=0,this.MAX_CONCURRENT_FILES=2,this.quotaErrorHandler=null,this.quotaErrorAcknowledged=!1,this.store=new lv}isQuotaError(t){return t instanceof DOMException?t.name==="QuotaExceededError"||t.code===22||t.message.includes("quota"):t instanceof Error?t.message.toLowerCase().includes("quota")||t.message.toLowerCase().includes("storage"):!1}async handleQuotaError(){if(this.quotaErrorAcknowledged)return!0;if(this.quotaErrorHandler){const t=await this.quotaErrorHandler();return this.quotaErrorAcknowledged=!0,t}return console.warn("Quota exceeded and no handler registered"),!1}static getInstance(){return bu.instance||(bu.instance=new bu),bu.instance}getCache(){return caches.open(oO)}async isCached(t){return!!await(await this.getCache()).match(t)}extractFilename(t){return t.split("/").pop()||"unknown"}setQuotaErrorHandler(t){this.quotaErrorHandler=t}async downloadFile(t,n){const s=await this.getCache(),i=await s.match(t);if(i){const o=i.headers.get("Content-Length"),c=o?parseInt(o,10):0;if(c>0){n==null||n({loaded:c,total:c,file:this.extractFilename(t)});return}}await this.scheduleDownload(t,n),await this.finalizeCache(t,s)}async scheduleDownload(t,n){if(this.activeDownloads.has(t)){for(;this.activeDownloads.has(t);)await new Promise(s=>setTimeout(s,100));return}return new Promise((s,i)=>{this.queue.push({url:t,onProgress:n,resolve:s,reject:i}),this.processQueue()})}async processQueue(){if(this.activeCount>=this.MAX_CONCURRENT_FILES)return;const t=this.queue.shift();if(!t)return;this.activeCount++;const{url:n,onProgress:s,resolve:i,reject:o}=t,c=new qP(n,this.store,{onProgress:d=>{s==null||s({loaded:d.loaded,total:d.total,file:this.extractFilename(n)})}});this.activeDownloads.set(n,c);try{await c.start(),i()}catch(d){o(d)}finally{this.activeDownloads.delete(n),this.activeCount--,this.processQueue()}}async finalizeCache(t,n){const s=await this.store.getMetadata(t);if(!s)throw new Error(`Download failed: Metadata missing for ${t}`);const i=await this.store.getStream(t),o=new Response(i,{headers:{"Content-Length":s.totalBytes.toString(),"Content-Type":s.mimeType||"application/octet-stream"}});try{await n.put(t,o),await this.store.deleteFile(t)}catch(c){if(this.isQuotaError(c)){if(console.warn(`Quota exceeded when caching ${t}`,c),!await this.handleQuotaError())throw await this.store.deleteFile(t),new Error("Download aborted by user: storage quota exceeded");console.warn("Continuing without persistent cache storage")}else throw c}}async computeSha256(t){const n=await iO();if(n.init(),t.stream){const s=t.stream().getReader();for(;;){const{done:i,value:o}=await s.read();if(i)break;o&&n.update(o)}}else{const s=await t.arrayBuffer();n.update(new Uint8Array(s))}return n.digest()}async checkCacheIntegrity(t,n){const i=await(await this.getCache()).match(t);if(!i)return{ok:!1,missing:!0,reason:"File not found in cache"};const o=i.headers.get("Content-Length");if(!o)return{ok:!0};const c=parseInt(o,10),d=await i.clone().blob();if(d.size!==c)return{ok:!1,reason:`Size mismatch: expected ${c}, got ${d.size}`};if(n)try{const u=await this.computeSha256(d);if(u!==n)return{ok:!1,reason:`Checksum mismatch: expected ${n}, got ${u}`}}catch(u){return console.error("Checksum verification failed:",u),{ok:!1,reason:`Checksum calculation failed: ${u}`}}return{ok:!0}}async cancelDownload(t){const n=this.activeDownloads.get(t);if(n){n.abort();return}const s=this.queue.findIndex(i=>i.url===t);if(s!==-1){const i=this.queue[s];this.queue.splice(s,1),i.reject(new Error("Download cancelled"))}}async deleteFromCache(t){await this.cancelDownload(t),await(await this.getCache()).delete(t),await this.store.deleteFile(t)}async clearCache(){for(const s of this.activeDownloads.keys())await this.cancelDownload(s);this.queue=[];const t=await this.getCache(),n=await t.keys();for(const s of n)await t.delete(s);await this.store.clearAll()}}const uC=bu.getInstance(),wy=Object.freeze(Object.defineProperty({__proto__:null,DownloadManager:bu,downloadManager:uC},Symbol.toStringTag,{value:"Module"}));function lO(){const{theme:e}=gm(),{performanceProfile:t,setPerformanceProfile:n,encoderQuantization:s,setEncoderQuantization:i,decoderQuantization:o,setDecoderQuantization:c,provider:d}=ti(),[u,h]=we.useState(!1),g=(I=!1)=>({control:M=>({...M,width:"100%",backgroundColor:e==="dark"?"rgba(255, 255, 255, 0.05)":"rgba(0, 0, 0, 0.05)",border:`1px solid ${e==="dark"?"rgba(255, 255, 255, 0.1)":"rgba(0, 0, 0, 0.1)"}`,borderRadius:"0.5rem",boxShadow:"none",cursor:"pointer",padding:"2px 8px",minHeight:"38px",fontSize:I?"0.8rem":"0.9rem","&:hover":{backgroundColor:e==="dark"?"rgba(255, 255, 255, 0.08)":"rgba(0, 0, 0, 0.08)",borderColor:e==="dark"?"rgba(255, 255, 255, 0.2)":"rgba(0, 0, 0, 0.2)"}}),menu:M=>({...M,backgroundColor:e==="dark"?"#1a1a1a":"white",border:`1px solid ${e==="dark"?"rgba(255, 255, 255, 0.1)":"rgba(0, 0, 0, 0.1)"}`,borderRadius:"0.5rem",zIndex:100}),option:(M,{isSelected:C,isFocused:A})=>({...M,backgroundColor:C?"rgb(6 182 212)":A?e==="dark"?"rgba(255, 255, 255, 0.05)":"rgba(0, 0, 0, 0.05)":"transparent",color:C?"white":e==="dark"?"rgba(255, 255, 255, 0.8)":"#1f2937",cursor:"pointer",fontSize:"0.85rem"}),singleValue:M=>({...M,color:e==="dark"?"rgba(255, 255, 255, 0.9)":"rgba(0, 0, 0, 0.9)"}),input:M=>({...M,color:e==="dark"?"white":"black"}),indicatorSeparator:()=>({display:"none"})}),p=I=>{n(I)},m=(I,M)=>{I==="encoder"&&i(M),I==="decoder"&&c(M)},y=Db.find(I=>I.value===t),v=mg.find(I=>I.value===s),T=mg.find(I=>I.value===o),O=I=>{switch(I){case"fp32":return"encoder_model.onnx";case"fp16":return"encoder_model_fp16.onnx";case"int8":return"encoder_model_int8.onnx";case"int4":return"encoder_model_int4.onnx";default:return null}},E=I=>{switch(I){case"fp32":return"decoder_model_merged.onnx";case"fp16":return"decoder_model_merged.onnx";case"int8":return"decoder_model_merged_int8.onnx";case"int4":return"decoder_model_merged_int4.onnx";default:return null}},[S,D]=we.useState(null);return ma.useEffect(()=>{(async()=>{const M=O(s),C=E(o);let A=0;const k=[];M&&k.push(M),C&&k.push(C);for(const R of k){const G=`https://huggingface.co/${Ln.ID}/resolve/main/onnx/${R}`;await uC.isCached(G)||(A+=Ln.FILE_SIZES[R]||0)}D(A)})()},[s,o]),z.jsxs("div",{className:"flex flex-col gap-3",children:[z.jsxs("div",{children:[z.jsx("div",{className:"flex items-center justify-between mb-2",children:z.jsxs("div",{className:"flex items-center gap-1.5",children:[z.jsx("div",{className:"text-xs font-bold uppercase text-slate-400 dark:text-white/40",children:"Performance Profile"}),z.jsx(Yg,{content:"Select a preset for the best balance of quality and speed.",children:z.jsx(Jg,{})})]})}),z.jsx(Lg,{value:y,onChange:I=>I&&p(I.value),options:Db.filter(I=>d==="wasm"?I.value!=="fast":I.value!=="balanced"&&I.value!=="low_memory"),styles:g(),isSearchable:!1,formatOptionLabel:I=>{const M=I;return z.jsxs("div",{className:"flex flex-col gap-0.5",children:[z.jsx("span",{className:"font-medium",children:M.label}),M.description&&z.jsx("span",{className:"text-[10px] opacity-60",children:M.description})]})}}),z.jsx("div",{className:"flex justify-end mt-1",children:z.jsx("span",{className:"text-[10px] text-slate-400 dark:text-white/30",children:S!==null?S===0?z.jsx("span",{className:"text-green-500",children:"Fully Downloaded"}):z.jsxs(z.Fragment,{children:["Est. Download: ~",(S/(1024*1024)).toFixed(0)," MB"]}):z.jsx(z.Fragment,{children:"Calculating..."})})})]}),z.jsx("div",{children:z.jsxs("button",{onClick:()=>h(!u),className:"flex items-center gap-2 text-xs text-cyan-600 dark:text-cyan-400 font-medium hover:underline focus:outline-none",children:[z.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:2,stroke:"currentColor",className:`w-3 h-3 transition-transform ${u?"rotate-90":""}`,children:z.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8.25 4.5l7.5 7.5-7.5 7.5"})}),"Advanced Settings"]})}),u&&z.jsxs("div",{className:"flex flex-col gap-3 pl-3 border-l-2 border-slate-100 dark:border-white/5 animate-in slide-in-from-top-2 duration-200",children:[z.jsxs("div",{className:"p-2 rounded bg-blue-500/10 border border-blue-500/20 text-[10px] text-blue-600 dark:text-blue-300",children:[z.jsx("p",{className:"font-semibold mb-0.5",children:"Note:"}),"The FP16 decoder has been removed as it is slower than FP32."]}),z.jsxs("div",{className:"flex flex-col gap-1",children:[z.jsx("span",{className:"text-[10px] font-bold uppercase text-slate-400 dark:text-white/40",children:"Encoder"}),z.jsx(Lg,{value:v,onChange:I=>I&&m("encoder",I.value),options:mg.filter(I=>d==="wasm"?I.value!=="fp16":I.value!=="int8"&&I.value!=="int4"),styles:g(!0),isSearchable:!1})]}),z.jsxs("div",{className:"flex flex-col gap-1",children:[z.jsx("div",{className:"flex items-center gap-1.5",children:z.jsx("span",{className:"text-[10px] font-bold uppercase text-slate-400 dark:text-white/40",children:"Decoder"})}),z.jsx(Lg,{value:T,options:mg.filter(I=>I.value==="fp16"?!1:d==="webgpu"?I.value!=="int8"&&I.value!=="int4":!0),onChange:I=>I&&m("decoder",I.value),styles:g(!0),isSearchable:!1})]})]})]})}const dC=()=>{const{setCustomNotification:e,openDialog:t,closeDialog:n,provider:s,customModelId:i}=ti();return{verifyDownloads:async()=>{const{modelLoader:c}=await vf(async()=>{const{modelLoader:p}=await import("./ModelLoader-jS5SprEl.js");return{modelLoader:p}},__vite__mapDeps([0,1]),import.meta.url),{downloadManager:d}=await vf(async()=>{const{downloadManager:p}=await Promise.resolve().then(()=>wy);return{downloadManager:p}},void 0,import.meta.url),{getSessionOptions:u}=await vf(async()=>{const{getSessionOptions:p}=await import("./index-CBPy_vyv.js");return{getSessionOptions:p}},[],import.meta.url),h=p=>{e(typeof p=="string"?{message:p}:p)},g=async()=>{try{h("Verifying files...");const p=i||Ln.ID,m=u(s),y=await c.validateModelFiles(p,m);if(y.length>0){const T=(y.reduce((O,E)=>{const S=E.split("/").pop();return O+(Ln.FILE_SIZES[S]||0)},0)/(1024*1024)).toFixed(0);h(null),t({title:"Missing or Corrupted Files",message:`Found ${y.length} file(s) (~${T} MB) that need to be downloaded. Fix them now?`,confirmText:"Download",isDangerous:!1,onConfirm:async()=>{n();for(const O of y)await d.deleteFromCache(O);await c.preDownloadModels(p,m,(O,E)=>{h({message:O,progress:E})}),h({message:"Repaired corrupted files!",isLoading:!1}),setTimeout(()=>h(null),3e3)}})}else h({message:"All files verified successfully.",isLoading:!1}),setTimeout(()=>h(null),3e3)}catch(p){console.error(p),h({message:"Error detecting corruption. Check console.",isLoading:!1}),setTimeout(()=>h(null),5e3)}};t({title:"Verify Downloads",message:"This will verify the integrity of downloaded model files and re-download any corrupted ones. Continue?",confirmText:"Verify",isDangerous:!1,onConfirm:()=>{n(),g()}})}}},cO=()=>{const[e,t]=ma.useState(!1),n=we.useRef(null),s=we.useRef(null),{provider:i,setProvider:o,showPreviewInput:c,setShowPreviewInput:d,customModelId:u,setCustomModelId:h,isSettingsOpen:g,openSettings:p,closeSettings:m,settingsFocus:y,numCandidates:v,setNumCandidates:T,doSample:O,setDoSample:E,temperature:S,setTemperature:D,topK:I,setTopK:M,topP:C,setTopP:A}=ti(),{theme:k,toggleTheme:R}=gm(),{filterMode:G,setFilterMode:te}=i_(),{verifyDownloads:ee}=dC();return we.useEffect(()=>{const X=le=>{n.current&&!n.current.contains(le.target)&&n.current&&!n.current.contains(le.target)&&m()};return document.addEventListener("mousedown",X),()=>document.removeEventListener("mousedown",X)},[m]),we.useEffect(()=>{g&&y==="modelId"&&s.current&&setTimeout(()=>{var X,le;(X=s.current)==null||X.focus(),(le=s.current)==null||le.select()},50)},[g,y]),z.jsxs("div",{className:"relative",ref:n,children:[z.jsx("button",{onClick:()=>g?m():p(),className:`w-9 h-9 rounded-xl flex items-center justify-center transition-all duration-200 border ${g?"bg-cyan-500/10 border-cyan-500/30 text-cyan-600 dark:text-cyan-400":"bg-black/5 dark:bg-white/5 border-black/5 dark:border-white/5 text-slate-500 dark:text-white/40 hover:text-slate-800 dark:hover:text-white hover:bg-black/10 dark:hover:bg-white/10"}`,title:"Settings",children:z.jsxs("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:[z.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"}),z.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"})]})}),g&&z.jsx("div",{className:"absolute right-0 top-full mt-3 w-64 max-h-[80vh] bg-white dark:bg-[#111] border border-black/10 dark:border-white/10 rounded-2xl shadow-xl backdrop-blur-xl z-50 flex flex-col animate-in fade-in zoom-in-95 duration-200 origin-top-right overflow-hidden",children:z.jsxs("div",{className:"overflow-y-auto p-2 flex flex-col gap-2",children:[z.jsxs("button",{onClick:R,className:"flex items-center justify-between p-3 rounded-xl hover:bg-black/5 dark:hover:bg-white/5 transition-colors text-sm text-slate-700 dark:text-white",children:[z.jsx("span",{className:"font-medium",children:"Theme"}),z.jsx("div",{className:"flex items-center gap-2 text-slate-400 dark:text-white/40",children:k==="dark"?z.jsxs("div",{className:"flex items-center gap-2",children:[z.jsx("span",{className:"text-xs",children:"Dark"}),z.jsx("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:z.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"})})]}):z.jsxs("div",{className:"flex items-center gap-2",children:[z.jsx("span",{className:"text-xs",children:"Light"}),z.jsx("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:z.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"})})]})})]}),z.jsx("div",{className:"h-px bg-black/5 dark:bg-white/5 mx-2"}),z.jsxs("div",{className:"p-3",children:[z.jsx("div",{className:"text-xs font-bold uppercase text-slate-400 dark:text-white/40 mb-2",children:"Provider"}),z.jsx(QP,{value:i,onChange:o})]}),z.jsx("div",{className:"h-px bg-black/5 dark:bg-white/5 mx-2"}),z.jsx("div",{className:"p-3",children:z.jsx(lO,{})}),z.jsx("div",{className:"h-px bg-black/5 dark:bg-white/5 mx-2"}),z.jsxs("div",{className:"p-3",children:[z.jsx("div",{className:"text-xs font-bold uppercase text-slate-400 dark:text-white/40 mb-2",children:"Generation"}),z.jsxs("div",{className:"flex items-center justify-between mb-2",children:[z.jsx("span",{className:"text-xs text-slate-600 dark:text-slate-300",children:"Candidates"}),z.jsxs("div",{className:"flex items-center gap-2",children:[z.jsx("input",{type:"range",min:"1",max:"5",step:"1",value:v,onChange:X=>T(parseInt(X.target.value)),className:"w-20 accent-cyan-500"}),z.jsx("span",{className:"text-xs font-mono w-4 text-right text-slate-600 dark:text-slate-300",children:v})]})]}),z.jsxs("div",{className:"flex items-center justify-between mb-2",children:[z.jsxs("div",{className:"flex items-center gap-1.5",children:[z.jsx("span",{className:"text-xs text-slate-600 dark:text-slate-300",children:"Beam Search Approx."}),z.jsx(Yg,{content:"Enable multinomial sampling to approximate beam search exploration. Faster but non-deterministic. Recommended for generating diverse candidates.",children:z.jsx(Jg,{})})]}),z.jsx("button",{onClick:()=>E(!O),className:`w-8 h-4 rounded-full transition-colors relative ${O?"bg-cyan-500":"bg-slate-300 dark:bg-zinc-700"}`,children:z.jsx("div",{className:`absolute top-0.5 w-3 h-3 bg-white rounded-full shadow-sm transition-transform ${O?"left-4.5":"left-0.5"}`})})]}),O&&z.jsxs("div",{className:"space-y-2 pl-2 border-l-2 border-black/5 dark:border-white/5 ml-1",children:[z.jsxs("div",{className:"flex items-center justify-between",children:[z.jsx("span",{className:"text-xs text-slate-500 dark:text-slate-400",children:"Temperature"}),z.jsxs("div",{className:"flex items-center gap-2",children:[z.jsx("input",{type:"range",min:"0.1",max:"2.0",step:"0.1",value:S,onChange:X=>D(parseFloat(X.target.value)),className:"w-16 accent-cyan-500 h-1"}),z.jsx("span",{className:"text-[10px] font-mono w-6 text-right text-slate-500 dark:text-slate-400",children:S.toFixed(1)})]})]}),z.jsxs("div",{className:"flex items-center justify-between",children:[z.jsx("span",{className:"text-xs text-slate-500 dark:text-slate-400",children:"Top K"}),z.jsxs("div",{className:"flex items-center gap-2",children:[z.jsx("input",{type:"range",min:"0",max:"100",step:"1",value:I,onChange:X=>M(parseInt(X.target.value)),className:"w-16 accent-cyan-500 h-1"}),z.jsx("span",{className:"text-[10px] font-mono w-6 text-right text-slate-500 dark:text-slate-400",children:I})]})]}),z.jsxs("div",{className:"flex items-center justify-between",children:[z.jsx("span",{className:"text-xs text-slate-500 dark:text-slate-400",children:"Top P"}),z.jsxs("div",{className:"flex items-center gap-2",children:[z.jsx("input",{type:"range",min:"0.1",max:"1.0",step:"0.05",value:C,onChange:X=>A(parseFloat(X.target.value)),className:"w-16 accent-cyan-500 h-1"}),z.jsx("span",{className:"text-[10px] font-mono w-6 text-right text-slate-500 dark:text-slate-400",children:C.toFixed(2)})]})]})]})]}),z.jsxs("div",{className:"p-3",children:[z.jsxs("div",{className:"flex items-center justify-between mb-2",children:[z.jsxs("div",{className:"flex items-center gap-1.5",children:[z.jsx("div",{className:"text-xs font-bold uppercase text-slate-400 dark:text-white/40",children:"HuggingFace Model ID"}),z.jsx(Yg,{content:"This feature requires an ONNX model compatible with Transformers.js. Check the HuggingFace model card for 'onnx' tag or ONNX weights.",children:z.jsx(Jg,{})})]}),z.jsx("button",{onClick:()=>h(Ln.ID),className:"text-slate-400 hover:text-cyan-600 dark:hover:text-cyan-400 transition-colors p-1 rounded-md hover:bg-black/5 dark:hover:bg-white/5",title:`Reset to ${Ln.ID}`,children:z.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:2,stroke:"currentColor",className:"w-3.5 h-3.5",children:z.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})})})]}),z.jsx("input",{ref:s,type:"text",value:u,onChange:X=>h(X.target.value),onKeyDown:X=>{X.key==="Enter"&&X.currentTarget.blur()},className:"w-full text-xs font-mono bg-black/5 dark:bg-white/5 rounded-lg border border-black/10 dark:border-white/10 px-2 py-1.5 focus:outline-none focus:border-cyan-500 dark:focus:border-cyan-400 text-slate-700 dark:text-white transition-all",placeholder:"user/repo"})]}),z.jsx("div",{className:"h-px bg-black/5 dark:bg-white/5 mx-2"}),z.jsxs("div",{className:"p-3",children:[z.jsx("div",{className:"text-xs font-bold uppercase text-slate-400 dark:text-white/40 mb-2",children:"Storage & Downloads"}),z.jsxs("button",{onClick:()=>{m(),ee()},className:"w-full py-1.5 px-3 rounded-md text-xs font-medium bg-red-50 dark:bg-red-900/20 text-red-600 dark:text-red-400 hover:bg-red-100 dark:hover:bg-red-900/30 transition-colors flex items-center justify-center gap-2",children:[z.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-4 h-4",children:z.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M11.25 11.25l.041-.02a.75.75 0 011.063.852l-.708 2.836a.75.75 0 001.063.853l.041-.021M21 12a9 9 0 11-18 0 9 9 0 0118 0zm-9-3.75h.008v.008H12V8.25z"})}),"Verify & Repair Downloads"]}),z.jsx("div",{className:"mt-2 pt-2 border-t border-black/5 dark:border-white/5",children:e?z.jsxs("div",{className:"flex flex-col gap-2 p-2 bg-red-500/5 rounded-lg border border-red-500/20",children:[z.jsx("span",{className:"text-[10px] text-red-600 dark:text-red-400 font-medium text-center",children:"Are you sure? All models will need re-downloading."}),z.jsxs("div",{className:"flex gap-2",children:[z.jsx("button",{onClick:async()=>{const{downloadManager:X}=await vf(async()=>{const{downloadManager:le}=await Promise.resolve().then(()=>wy);return{downloadManager:le}},void 0,import.meta.url);await X.clearCache(),t(!1),m()},className:"flex-1 py-1 rounded text-[10px] font-bold bg-red-600 text-white hover:bg-red-700 transition-colors",children:"Yes, Clear"}),z.jsx("button",{onClick:()=>t(!1),className:"flex-1 py-1 rounded text-[10px] font-medium bg-black/5 dark:bg-white/5 text-slate-600 dark:text-slate-300 hover:bg-black/10 dark:hover:bg-white/10 transition-colors",children:"Cancel"})]})]}):z.jsxs("button",{onClick:()=>t(!0),className:"w-full py-1.5 px-3 rounded-md text-xs font-medium bg-red-500/10 text-red-600 dark:text-red-400 hover:bg-red-500/20 transition-colors flex items-center justify-center gap-2",children:[z.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-4 h-4",children:z.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M14.74 9l-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 01-2.244 2.077H8.084a2.25 2.25 0 01-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 00-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 013.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 00-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 00-7.5 0"})}),"Clear All Models"]})})]}),z.jsx("div",{className:"h-px bg-black/5 dark:bg-white/5 mx-2"}),z.jsxs("div",{className:"p-3",children:[z.jsx("div",{className:"text-xs font-bold uppercase text-slate-400 dark:text-white/40 mb-2",children:"History Filter"}),z.jsxs("div",{className:"flex bg-black/5 dark:bg-white/5 p-1 rounded-lg",children:[z.jsx("button",{onClick:()=>te("all"),className:`flex-1 py-1.5 px-3 rounded-md text-xs font-medium transition-all ${G==="all"?"bg-white dark:bg-zinc-800 text-cyan-600 dark:text-cyan-400 shadow-sm":"text-slate-500 dark:text-zinc-400 hover:text-slate-700 dark:hover:text-zinc-200"}`,children:"All History"}),z.jsx("button",{onClick:()=>te("current"),className:`flex-1 py-1.5 px-3 rounded-md text-xs font-medium transition-all ${G==="current"?"bg-white dark:bg-zinc-800 text-cyan-600 dark:text-cyan-400 shadow-sm":"text-slate-500 dark:text-zinc-400 hover:text-slate-700 dark:hover:text-zinc-200"}`,children:"Active Tab"})]})]}),z.jsx("div",{className:"h-px bg-black/5 dark:bg-white/5 mx-2"}),z.jsxs("button",{onClick:()=>d(!c),className:"flex items-center justify-between p-3 rounded-xl hover:bg-black/5 dark:hover:bg-white/5 transition-colors text-sm text-slate-700 dark:text-white",children:[z.jsx("span",{className:"font-medium",children:"Preview Model Input"}),z.jsx("div",{className:`w-10 h-5 rounded-full relative transition-colors ${c?"bg-cyan-500":"bg-slate-200 dark:bg-white/10"}`,children:z.jsx("div",{className:`absolute top-1 w-3 h-3 rounded-full bg-white shadow-sm transition-transform ${c?"left-6":"left-1"}`})})]})]})})]})},uO=({className:e="w-8 h-8"})=>z.jsxs("svg",{className:e,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round",children:[z.jsxs("g",{className:"origin-center transform transition-transform duration-500 group-hover:-rotate-45",children:[z.jsx("path",{d:"M12 19l7-7 3 3-7 7-3-3z"}),z.jsx("path",{d:"M18 13l-1.5-7.5L2 2l3.5 14.5L13 18l5-5z"}),z.jsx("path",{d:"M2 2l7.586 7.586"}),z.jsx("circle",{cx:"11",cy:"11",r:"2"})]}),z.jsx("path",{d:"M 2 2 A 14.14 14.14 0 0 0 -2.14 12",className:"opacity-0 group-hover:opacity-100 transition-opacity duration-500",strokeWidth:"2"})]}),dO=({className:e="w-6 h-6"})=>z.jsx("svg",{className:e,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:z.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 6h16M4 12h16M4 18h16"})}),fO=({className:e="w-3.5 h-3.5"})=>z.jsx("svg",{className:e,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:z.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"})}),hO=({className:e="w-3.5 h-3.5"})=>z.jsx("svg",{className:e,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:z.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"})}),Ug=({icon:e,label:t,isActive:n=!1,variant:s="pill",className:i="",...o})=>{const c="transition-all duration-300 flex items-center justify-center gap-2 font-semibold";let d="";return s==="pill"?d=n?"bg-white dark:bg-[#222] text-cyan-600 dark:text-cyan-400 shadow-sm px-4 py-1.5 rounded-full text-xs":"text-slate-500 dark:text-white/40 hover:text-slate-700 dark:hover:text-white px-4 py-1.5 rounded-full text-xs bg-transparent":s==="ghost"&&(d="p-2 text-slate-500 dark:text-white/40 hover:text-cyan-600 dark:hover:text-cyan-400 hover:bg-black/5 dark:hover:bg-white/5 rounded-xl"),z.jsxs("button",{className:`${c} ${d} ${i}`,...o,children:[e,t&&z.jsx("span",{children:t})]})},pO=()=>{const{numCandidates:e,setNumCandidates:t,activeTab:n,setActiveTab:s,toggleSidebar:i}=ti();return z.jsxs("div",{className:"relative h-14 md:h-16 flex-none flex items-center justify-between px-3 md:px-6 border-b border-black/5 dark:border-white/5 bg-white/40 dark:bg-black/20 select-none z-30 backdrop-blur-md",children:[z.jsxs("div",{className:"flex items-center gap-2 md:gap-3 group",children:[z.jsx("div",{className:"-ml-2 md:hidden",children:z.jsx(Ug,{onClick:i,variant:"ghost",icon:z.jsx(dO,{})})}),z.jsxs("div",{className:"relative flex items-center justify-center",children:[z.jsx("div",{className:"absolute inset-0 bg-cyan-500/20 blur-xl rounded-full opacity-0 group-hover:opacity-100 transition-opacity duration-500"}),z.jsx(uO,{})]}),z.jsx(eS,{className:"h-8 w-auto"})]}),z.jsxs("div",{className:"hidden md:flex md:absolute md:left-1/2 md:-translate-x-1/2 items-center bg-black/5 dark:bg-white/5 p-1 rounded-full border border-black/5 dark:border-white/5",children:[z.jsx(Ug,{label:"Draw",onClick:()=>s("draw"),isActive:n==="draw",icon:z.jsx(fO,{}),variant:"pill"}),z.jsx(Ug,{label:"Upload",onClick:()=>s("upload"),isActive:n==="upload",icon:z.jsx(hO,{}),variant:"pill"})]}),z.jsxs("div",{className:"flex items-center gap-3",children:[z.jsx("div",{className:"flex items-center p-1 bg-black/5 dark:bg-white/5 rounded-xl border border-black/5 dark:border-white/5",children:z.jsxs("div",{className:"flex items-center gap-2 px-2",children:[z.jsx("span",{className:"hidden sm:inline text-[10px] font-bold uppercase text-slate-400 dark:text-white/40",children:"Candidates"}),z.jsx("input",{type:"number",min:"1",max:"5",value:e,onChange:o=>{const c=parseInt(o.target.value);isNaN(c)||t(Math.min(5,Math.max(1,c)))},className:"w-12 h-7 text-center text-xs font-mono bg-black/[0.05] dark:bg-white/[0.05] rounded-lg border border-black/10 dark:border-white/10 focus:outline-none focus:border-cyan-500 dark:focus:border-cyan-400 text-slate-700 dark:text-white transition-all hover:bg-black/[0.08] dark:hover:bg-white/[0.08] hover:border-black/20 dark:hover:border-white/20"}),z.jsx(Yg,{content:"The model generates multiple guesses for your input to improve accuracy. Choosing more candidates may be slightly slower.",children:z.jsx(Jg,{})})]})}),z.jsx(cO,{})]})]})},Pv=(e,t,n)=>{we.useEffect(()=>{typeof window<"u"&&window.MathJax&&window.MathJax.typesetPromise&&requestAnimationFrame(()=>{let i=[];if(t){const o=document.getElementById(t);o&&i.push(o)}if(n){const o=document.querySelectorAll(`.${n}`);i=[...i,...Array.from(o)]}i.length>0&&(window.MathJax.typesetClear&&window.MathJax.typesetClear(i),window.MathJax.typesetPromise(i).catch(o=>console.log("MathJax Error:",o)))})},[e,t,n])},My=()=>z.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[z.jsx("path",{d:"M3 6h18"}),z.jsx("path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"}),z.jsx("path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"})]}),mO=()=>z.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:z.jsx("polyline",{points:"20 6 9 17 4 12"})}),gO=()=>z.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[z.jsx("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),z.jsx("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]}),_O=()=>z.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[z.jsx("path",{d:"M12 19l7-7 3 3-7 7-3-3z"}),z.jsx("path",{d:"M18 13l-1.5-7.5L2 2l3.5 14.5L13 18l5-5z"}),z.jsx("path",{d:"M2 2l7.586 7.586"}),z.jsx("circle",{cx:"11",cy:"11",r:"2"})]}),vO=e=>{const[t,n]=we.useState(null);return{confirmDeleteId:t,sanitizeLatex:d=>d.replace(/\\\[/g,"").replace(/\\\]/g,"").replace(/\\\(/g,"").replace(/\\\)/g,"").replace(/\$\$/g,"").replace(/^\$|\$$/g,"").trim(),handleDeleteClick:(d,u)=>{d.stopPropagation(),n(u)},handleConfirm:(d,u)=>{d.stopPropagation(),e(u),n(null)},handleCancel:d=>{d.stopPropagation(),n(null)}}},yO=({latex:e})=>{const t=we.useRef(null),n=we.useRef(null),[s,i]=ma.useState(1),o=e.replace(/\\\[/g,"").replace(/\\\]/g,"").replace(/\\\(/g,"").replace(/\\\)/g,"").replace(/\$\$/g,"").replace(/^\$|\$$/g,"").trim(),c=ma.useCallback(()=>{if(t.current&&n.current){const d=t.current.scrollWidth,h=n.current.clientWidth-40;if(d>h){const g=Math.max(.6,h/d);i(g)}else i(1)}},[]);return we.useEffect(()=>{let d=!0,u=null;const h=()=>{!d||!t.current||(window.MathJax&&window.MathJax.typesetPromise?(t.current.innerHTML=`\\(${o}\\)`,window.MathJax.typesetPromise([t.current]).then(()=>{d&&c()}).catch(g=>console.error("MathJax error:",g))):u=setTimeout(h,100))};return h(),()=>{d=!1,u&&clearTimeout(u)}},[o,c]),we.useEffect(()=>{const d=()=>requestAnimationFrame(c);window.addEventListener("resize",d);const u=new ResizeObserver(d);return n.current&&u.observe(n.current),()=>{window.removeEventListener("resize",d),u.disconnect()}},[c]),z.jsx("div",{ref:n,className:"relative min-h-8 h-auto py-2 flex items-center w-full group/item",children:z.jsx("div",{ref:t,className:"text-xs text-slate-700 dark:text-white/80 font-mono w-full whitespace-nowrap transition-transform origin-left",style:{transform:`scale(${s})`,width:"fit-content"},children:`\\(${o}\\)`})})},bO=({item:e,onSelect:t,onVersionSelect:n,isExpanded:s,onToggleExpand:i,isConfirming:o,onDeleteClick:c,onConfirmDelete:d,onCancelDelete:u,sanitizeLatex:h})=>z.jsxs("div",{className:"group relative p-3 rounded-lg hover:bg-black/5 dark:hover:bg-white/5 transition-colors cursor-pointer",onClick:()=>t(e),children:[z.jsxs("div",{className:"flex items-center justify-between mb-1 whitespace-nowrap overflow-hidden",children:[z.jsxs("div",{className:"flex items-center gap-2 overflow-hidden",children:[e.source==="upload"&&z.jsx("span",{className:"flex-none p-1 rounded-md bg-purple-100 dark:bg-purple-500/20 text-purple-600 dark:text-purple-300",title:"Uploaded Image",children:z.jsx("svg",{className:"w-3 h-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:z.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"})})}),e.source==="draw"&&z.jsx("span",{className:"flex-none p-1 rounded-md bg-cyan-100 dark:bg-cyan-500/20 text-cyan-600 dark:text-cyan-400",title:"Drawn Equation",children:z.jsx(_O,{})}),e.source!=="upload"&&e.versions&&e.versions.length>1&&z.jsx("button",{onClick:i,className:`
                                p-1 rounded-md text-slate-400 dark:text-white/30 hover:text-cyan-600 dark:hover:text-cyan-400 hover:bg-black/5 dark:hover:bg-white/5 transition-all
                                ${s?"rotate-90 text-cyan-600 dark:text-cyan-400":""}
                            `,children:z.jsx("svg",{className:"w-3 h-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:z.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 5l7 7-7 7"})})})]}),!o&&z.jsx("button",{onClick:c,className:"p-1 opacity-100 md:opacity-0 md:group-hover:opacity-100 hover:bg-red-500/10 hover:text-red-500 rounded transition-all",children:z.jsx(My,{})})]}),e.source==="upload"&&e.imageData&&z.jsx("div",{className:"mb-2 mt-1 w-full flex justify-center bg-black/5 dark:bg-white/5 rounded-lg overflow-hidden py-1",children:z.jsx("img",{src:e.imageData,alt:"Source",className:"h-16 object-contain rounded-md"})}),z.jsx(yO,{latex:e.latex}),z.jsx("span",{className:"absolute bottom-1 right-2 text-[9px] font-mono text-slate-300 dark:text-white/20 select-none",children:new Date(e.timestamp).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}),o&&z.jsxs("div",{className:"absolute inset-0 z-10 bg-white/90 dark:bg-black/90 backdrop-blur-sm flex items-center justify-center gap-2 rounded-xl animate-in fade-in duration-200",children:[z.jsx("button",{onClick:u,className:"p-1.5 bg-slate-200 dark:bg-slate-700 text-slate-600 dark:text-slate-300 rounded-lg hover:bg-slate-300 dark:hover:bg-slate-600 transition-colors",title:"Cancel",children:z.jsx(gO,{})}),z.jsx("button",{onClick:d,className:"p-1.5 bg-red-500 text-white rounded-lg hover:bg-red-600 transition-colors shadow-sm",title:"Confirm Delete",children:z.jsx(mO,{})})]}),s&&e.versions&&z.jsx("div",{className:"mt-2 border-t border-black/5 dark:border-white/5 pt-2 space-y-1 animate-in slide-in-from-top-1 duration-200",children:e.versions.map((g,p)=>z.jsx("div",{onClick:m=>{m.stopPropagation(),n(g)},className:"px-2 py-1.5 rounded-lg hover:bg-black/5 dark:hover:bg-white/5 cursor-pointer flex items-center justify-between group/version transition-colors",children:z.jsxs("div",{className:"flex items-center gap-2 overflow-hidden w-full",children:[z.jsx("div",{className:"text-[9px] text-slate-400 dark:text-white/20 font-mono w-3 shrink-0",children:p+1}),z.jsx("div",{className:"text-[10px] text-slate-600 dark:text-white/60 font-mono truncate history-math-version w-full",children:`\\(${h(g.latex)}\\)`})]})},p))})]}),wO=({history:e,onSelect:t,expandedItems:n,onToggleExpand:s,confirmDeleteId:i,onDeleteClick:o,onConfirmDelete:c,onCancelDelete:d,sanitizeLatex:u,emptyMessage:h})=>e.length===0?z.jsx("div",{className:"flex flex-col items-center justify-center h-48 px-4 text-center whitespace-nowrap overflow-hidden",children:z.jsx("span",{className:"text-xs text-slate-400 dark:text-white/20 italic",children:h})}):z.jsx(z.Fragment,{children:e.map(g=>z.jsx(bO,{item:g,onSelect:t,onVersionSelect:t,isExpanded:n.has(g.id),onToggleExpand:p=>s(p,g.id),isConfirming:i===g.id,onDeleteClick:p=>o(p,g.id),onConfirmDelete:p=>c(p,g.id),onCancelDelete:d,sanitizeLatex:u},g.id))}),MO=({isOpen:e,onConfirm:t,onCancel:n})=>e?z.jsx("div",{className:"fixed inset-0 z-[100] flex items-center justify-center bg-black/50 backdrop-blur-sm animate-in fade-in duration-200",children:z.jsx("div",{className:"bg-white dark:bg-[#111] border border-black/10 dark:border-white/10 rounded-2xl shadow-2xl max-w-sm w-full p-6 m-4 transform animate-in zoom-in-95 duration-200",children:z.jsxs("div",{className:"flex flex-col items-center text-center space-y-4",children:[z.jsx("div",{className:"w-12 h-12 rounded-full bg-red-100 dark:bg-red-900/20 flex items-center justify-center text-red-600 dark:text-red-400",children:z.jsx(My,{})}),z.jsx("h3",{className:"text-lg font-bold text-slate-900 dark:text-white",children:"Clear All History?"}),z.jsx("p",{className:"text-sm text-slate-500 dark:text-white/60",children:"This action cannot be undone. All your math history and sessions will be permanently deleted."}),z.jsxs("div",{className:"grid grid-cols-2 gap-3 w-full pt-2",children:[z.jsx("button",{onClick:n,className:"px-4 py-3 rounded-xl text-sm font-bold text-slate-700 dark:text-white/80 bg-slate-100 dark:bg-white/5 hover:bg-slate-200 dark:hover:bg-white/10 transition-colors",children:"Cancel"}),z.jsx("button",{onClick:t,className:"px-4 py-3 rounded-xl text-sm font-bold text-white bg-red-600 hover:bg-red-500 shadow-lg shadow-red-500/20 transition-all active:scale-95 whitespace-nowrap",children:"Clear All"})]})]})})}):null,xO=({className:e="w-5 h-5"})=>z.jsxs("svg",{className:e,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:[z.jsx("rect",{x:"3",y:"3",width:"18",height:"18",rx:"2",ry:"2"}),z.jsx("line",{x1:"9",y1:"3",x2:"9",y2:"21"}),z.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M13 9l3 3-3 3"})]}),EO=({className:e="w-5 h-5"})=>z.jsxs("svg",{className:e,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:[z.jsx("rect",{x:"3",y:"3",width:"18",height:"18",rx:"2",ry:"2"}),z.jsx("line",{x1:"9",y1:"3",x2:"9",y2:"21"}),z.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 9l-3 3 3 3"})]}),TO=({history:e,onSelect:t,onDelete:n,onClearAll:s,isOpen:i})=>{const{toggleSidebar:o,activeTab:c}=ti(),{filterMode:d}=i_(),[u,h]=ma.useState(new Set),[g,p]=ma.useState(!1),m=e.filter(C=>d==="all"?!0:(C.source||"draw")===c),y=(C,A)=>{C.stopPropagation(),h(k=>{const R=new Set(k);return R.has(A)?R.delete(A):R.add(A),R})},{confirmDeleteId:v,sanitizeLatex:T,handleDeleteClick:O,handleConfirm:E,handleCancel:S}=vO(n),D=()=>p(!0),I=()=>{s(),p(!1)};Pv([m,u],void 0,"history-math"),Pv([m,u],void 0,"history-math-version");const M=`No ${d==="all"?"history":c==="draw"?"drawings":"uploads"} yet.`;return z.jsxs(z.Fragment,{children:[z.jsx("div",{className:`absolute inset-0 z-40 bg-black/20 backdrop-blur-sm md:hidden transition-opacity duration-300 ${i?"opacity-100":"opacity-0 pointer-events-none"}`,onClick:o}),z.jsxs("div",{className:`absolute md:relative z-50 h-full flex-none flex flex-col border-r border-black/5 dark:border-white/5 bg-white dark:bg-[#0c0c0c] transition-all duration-300 ease-in-out shadow-2xl md:shadow-none ${i?"translate-x-0 w-64":"-translate-x-full w-64 md:translate-x-0 md:w-16"}`,children:[z.jsx("div",{className:"flex-none flex flex-col border-b border-black/5 dark:border-white/5 overflow-hidden",children:z.jsxs("div",{className:"h-16 flex items-center",children:[z.jsx("div",{className:"flex-none w-16 h-16 flex items-center justify-center",children:z.jsx(Ug,{onClick:o,variant:"ghost",title:i?"Collapse Sidebar":"Expand Sidebar",icon:i?z.jsx(EO,{}):z.jsx(xO,{})})}),z.jsx("div",{className:`flex-1 flex items-center transition-opacity duration-200 ${i?"opacity-100 delay-75":"opacity-0"} whitespace-nowrap overflow-hidden`,children:z.jsx("h2",{className:"text-sm font-bold text-slate-400 dark:text-white/40 tracking-widest uppercase pl-2",children:"History"})})]})}),z.jsx("div",{className:"flex-1 overflow-y-auto overflow-x-hidden p-2 space-y-2 custom-scrollbar",children:z.jsx("div",{className:`transition-opacity duration-200 ${i?"opacity-100 delay-100":"opacity-0 pointer-events-none"}`,children:z.jsx(wO,{history:m,onSelect:t,expandedItems:u,onToggleExpand:y,confirmDeleteId:v,onDeleteClick:O,onConfirmDelete:E,onCancelDelete:S,sanitizeLatex:T,emptyMessage:M})})}),z.jsx("div",{className:`p-4 border-t border-black/5 dark:border-white/5 transition-opacity duration-200 ${i?"opacity-100":"opacity-0 pointer-events-none"}`,children:m.length>0&&z.jsxs("button",{onClick:D,className:"w-full py-2 px-3 rounded-lg text-xs font-medium text-slate-500 dark:text-white/40 hover:text-red-600 dark:hover:text-red-400 hover:bg-red-50 dark:hover:bg-red-900/10 transition-colors flex items-center justify-center gap-2 group/clear whitespace-nowrap",children:[z.jsx("span",{className:"shrink-0",children:z.jsx(My,{})}),z.jsx("span",{children:"Clear All History"})]})}),z.jsx(MO,{isOpen:g,onConfirm:I,onCancel:()=>p(!1)})]})]})},AO=({isDismissed:e,onDismiss:t})=>{const{status:n,userConfirmed:s,setUserConfirmed:i,isLoadedFromCache:o,openSettings:c,encoderQuantization:d,decoderQuantization:u}=ti(),{verifyDownloads:h}=dC(),{isInitialized:g}=ti(),p=n==="error"?"Failed to load models. Please check your internet connection and try again.":void 0,m=g&&!s&&!o,y=()=>i(!0),v=D=>{switch(D){case"fp32":return Ln.FILE_SIZES["encoder_model.onnx"];case"fp16":return Ln.FILE_SIZES["encoder_model_fp16.onnx"];case"int8":return Ln.FILE_SIZES["encoder_model_int8.onnx"];case"int4":return Ln.FILE_SIZES["encoder_model_int4.onnx"];default:return 0}},T=D=>{switch(D){case"fp32":return Ln.FILE_SIZES["decoder_model_merged.onnx"];case"fp16":return Ln.FILE_SIZES["decoder_model_merged.onnx"];case"int8":return Ln.FILE_SIZES["decoder_model_merged_int8.onnx"];case"int4":return Ln.FILE_SIZES["decoder_model_merged_int4.onnx"];default:return 0}},E=`~${((v(d)+T(u))/(1024*1024)).toFixed(0)} MB`;return g&&!e&&(n==="error"||m)?z.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm animate-in fade-in duration-200",children:z.jsxs("div",{className:"bg-white dark:bg-gray-900 rounded-2xl p-8 shadow-2xl max-w-md w-full mx-4 relative transform animate-in zoom-in-95 duration-200",children:[z.jsx("button",{onClick:()=>{t()},className:"absolute top-4 right-4 text-gray-400 hover:text-gray-600 dark:hover:text-gray-200 transition-colors",title:"Dismiss",children:z.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:z.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),z.jsx("div",{className:"text-center",children:p?z.jsxs(z.Fragment,{children:[z.jsx("div",{className:"text-red-500 text-6xl mb-4",children:""}),z.jsx("h2",{className:"text-2xl font-bold text-gray-900 dark:text-white mb-2",children:"Loading Failed"}),z.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-4 text-sm",children:p}),z.jsx("button",{onClick:()=>{t(),h()},className:"px-6 py-2 bg-blue-500 hover:bg-blue-600 text-white rounded-lg transition-colors",children:"Verify & Repair Files"})]}):m?z.jsxs(z.Fragment,{children:[z.jsx("div",{className:"text-6xl mb-4",children:""}),z.jsx("h2",{className:"text-2xl font-bold text-gray-900 dark:text-white mb-2",children:"Confirm Model Download"}),z.jsxs("p",{className:"text-gray-600 dark:text-gray-400 mb-2 text-sm",children:["The AI models will be downloaded to your browser's cache (",E,"). This will only happen once."]}),z.jsx("p",{className:"text-gray-500 dark:text-gray-500 mb-6 text-xs italic",children:"You can also choose your own custom models in Settings."}),z.jsxs("div",{className:"flex flex-col gap-3",children:[z.jsx("button",{onClick:y,className:"px-6 py-2 bg-blue-500 hover:bg-blue-600 text-white rounded-lg transition-colors font-medium shadow-lg shadow-blue-500/20",children:"Start Download"}),z.jsx("button",{onClick:()=>{t(),c("modelId")},className:"text-sm text-gray-500 hover:text-gray-700 dark:hover:text-gray-300 transition-colors",children:"Configure Manually"})]})]}):null})]})}):null},E1=({phase:e,progress:t,isQueued:n,isLoading:s=!0})=>{const i=e.split("|"),o=i.length>1;return z.jsxs("div",{className:"absolute inset-x-0 bottom-8 z-30 flex flex-col items-center justify-end pointer-events-none gap-3",children:[n&&z.jsxs("div",{className:"px-4 py-2 bg-amber-500/90 backdrop-blur-md text-white rounded-full text-xs font-semibold shadow-lg animate-in slide-in-from-bottom-2 duration-300 flex items-center gap-2 pointer-events-auto",children:[z.jsx("div",{className:"w-2 h-2 rounded-full bg-white animate-pulse"}),"Generation Queued"]}),z.jsxs("div",{className:`px-6 py-3 bg-white/90 dark:bg-[#111]/90 backdrop-blur-md border border-cyan-500/30 dark:border-cyan-400/30 ${o?"rounded-2xl":"rounded-full"} flex items-center gap-3 shadow-xl pointer-events-auto animate-in slide-in-from-bottom-5 duration-300`,children:[s&&z.jsxs("div",{className:"relative w-4 h-4 flex-none self-center",children:[z.jsx("div",{className:"absolute inset-0 border-2 border-cyan-500/30 rounded-full"}),z.jsx("div",{className:"absolute inset-0 border-2 border-cyan-500 border-t-transparent rounded-full animate-spin"})]}),z.jsxs("div",{className:"flex flex-col text-sm font-medium text-slate-700 dark:text-white/90 text-center min-w-[200px]",children:[i.map((c,d)=>z.jsx("span",{className:"whitespace-nowrap",children:c.trim()},d)),t>0&&t<100&&z.jsxs("span",{className:"whitespace-nowrap text-xs text-slate-500 dark:text-slate-400 mt-0.5",children:["Progress: ",Math.round(t),"%"]})]})]})]})},CO=({className:e="w-6 h-6"})=>z.jsxs("svg",{className:e,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:[z.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),z.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})]}),SO=({className:e="w-4 h-4"})=>z.jsx("svg",{className:e,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:z.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})}),IO=()=>z.jsx("div",{className:"w-12 h-12 p-0 flex items-center justify-center cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-800 text-gray-500 dark:text-gray-400",children:z.jsx(CO,{})}),PO=({debugImage:e,onClose:t})=>z.jsxs("div",{className:"w-64 p-3 flex flex-col gap-2",children:[z.jsxs("div",{className:"flex justify-between items-center border-b border-gray-200 dark:border-gray-700 pb-2",children:[z.jsx("span",{className:"text-xs font-bold text-gray-500 uppercase tracking-wider",children:"Preview Model Input"}),z.jsx("button",{onClick:n=>{n.stopPropagation(),t()},className:"text-gray-400 hover:text-gray-600 dark:hover:text-gray-200",children:z.jsx(SO,{})})]}),z.jsx("div",{className:"relative aspect-square w-full bg-gray-100 dark:bg-black rounded border border-gray-200 dark:border-gray-800 overflow-hidden",children:z.jsx("img",{src:e,alt:"Debug Input",className:"w-full h-full object-contain",style:{imageRendering:"pixelated"}})}),z.jsx("div",{className:"text-[10px] text-gray-400 font-mono text-center",children:"448x448  Grayscale"})]}),kO=({debugImage:e})=>{const[t,n]=we.useState(!1);return e?z.jsx("div",{className:"absolute bottom-4 left-4 z-50 flex flex-col items-start gap-2",children:z.jsx("div",{className:`
                    bg-white/90 dark:bg-gray-900/90 backdrop-blur-md 
                    border border-gray-200 dark:border-gray-700 
                    rounded-lg shadow-xl overflow-hidden transition-all duration-300 ease-in-out
                    ${t?"":"cursor-pointer"}
                `,title:t?void 0:"Preview Model Input",onClick:()=>!t&&n(!0),children:t?z.jsx(PO,{debugImage:e,onClose:()=>n(!1)}):z.jsx(IO,{})})}):null};function T1(e,t){return Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2))}function DO(e,t,n=0){return e.x>=t.minX-n&&e.x<=t.maxX+n&&e.y>=t.minY-n&&e.y<=t.maxY+n}function OO(e,t,n,s){const i=(o,c,d)=>(d.y-o.y)*(c.x-o.x)>(c.y-o.y)*(d.x-o.x);return i(e,n,s)!==i(t,n,s)&&i(e,t,n)!==i(e,t,s)}function $O(e,t,n,s){const i=Math.pow(t.x-n.x,2)+Math.pow(t.y-n.y,2);if(i===0)return T1(e,t)<s;let o=((e.x-t.x)*(n.x-t.x)+(e.y-t.y)*(n.y-t.y))/i;o=Math.max(0,Math.min(1,o));const c={x:t.x+o*(n.x-t.x),y:t.y+o*(n.y-t.y)};return T1(e,c)<s}function A1(e,t,n){for(let s=0;s<t.points.length-1;s++)if($O(e,t.points[s],t.points[s+1],n))return!0;return!1}function BO(e,t){let n=1/0,s=1/0,i=-1/0,o=-1/0;return e.points.forEach(c=>{n=Math.min(n,c.x),s=Math.min(s,c.y),i=Math.max(i,c.x),o=Math.max(o,c.y)}),!(n>t.x+t.w||i<t.x||s>t.y+t.h||o<t.y)}function LO(e,t){if(t.length<3)return!1;let n=!1;for(let s=0,i=t.length-1;s<t.length;i=s++){const o=t[s].x,c=t[s].y,d=t[i].x,u=t[i].y;c>e.y!=u>e.y&&e.x<(d-o)*(e.y-c)/(u-c)+o&&(n=!n)}return n}function FO(e,t){if(t.length<3)return!1;for(const n of e.points)if(LO(n,t))return!0;for(let n=0;n<e.points.length-1;n++){const s=e.points[n],i=e.points[n+1];for(let o=0,c=t.length-1;o<t.length;c=o++)if(OO(s,i,t[o],t[c]))return!0}return!1}function zO(e,t,n){const s=n*n,i=[];return e.forEach(o=>{let c=[],d=!1;o.points.forEach(u=>{Math.pow(u.x-t.x,2)+Math.pow(u.y-t.y,2)>s?c.push(u):(d=!0,c.length>1&&i.push({...o,points:[...c]}),c=[])}),c.length>1?i.push({...o,points:[...c]}):!d&&c.length>0}),i}function NO(e,t,n){if(!(t.points.length<2)){e.beginPath(),e.moveTo(t.points[0].x,t.points[0].y);for(let s=1;s<t.points.length;s++)e.lineTo(t.points[s].x,t.points[s].y);e.globalCompositeOperation="source-over",e.lineCap="round",e.lineJoin="round",e.lineWidth=t.width||3,e.strokeStyle=t.color||(n==="dark"?"#ffffff":"#000000"),e.stroke()}}function RO(e,t,n){e.globalCompositeOperation="source-over",e.lineCap="round",e.lineJoin="round",e.lineWidth=3,e.strokeStyle=n==="dark"?"#ffffff":"#000000",t.forEach(s=>{NO(e,s,n)})}function fC(e,t){let n=1/0,s=1/0,i=-1/0,o=-1/0;return t.forEach(c=>{const d=e[c];d&&d.points.forEach(u=>{n=Math.min(n,u.x),s=Math.min(s,u.y),i=Math.max(i,u.x),o=Math.max(o,u.y)})}),n===1/0?null:{minX:n,minY:s,maxX:i,maxY:o}}function jO(e,t,n,s=5){const i=fC(t,n);i&&(e.save(),e.strokeStyle="#3b82f6",e.lineWidth=1,e.setLineDash([5,5]),e.strokeRect(i.minX-s,i.minY-s,i.maxX-i.minX+s*2,i.maxY-i.minY+s*2),e.restore())}function UO(e,t,n){e.save(),e.strokeStyle="#3b82f6",e.fillStyle="rgba(59, 130, 246, 0.1)",e.lineWidth=1;const s=Math.min(t.x,n.x),i=Math.min(t.y,n.y),o=Math.abs(n.x-t.x),c=Math.abs(n.y-t.y);e.fillRect(s,i,o,c),e.strokeRect(s,i,o,c),e.restore()}function VO(e,t){const n=t.getContext("2d",{willReadFrequently:!0});n&&(n.save(),n.resetTransform(),n.clearRect(0,0,t.width,t.height),n.drawImage(e,0,0),n.restore())}function GO(e,t){if(!(t.length<2)){e.save(),e.strokeStyle="#3b82f6",e.fillStyle="rgba(59, 130, 246, 0.1)",e.lineWidth=1,e.beginPath(),e.moveTo(t[0].x,t[0].y);for(let n=1;n<t.length;n++)e.lineTo(t[n].x,t[n].y);e.closePath(),e.fill(),e.stroke(),e.restore()}}const kg=20,WO=({onStrokeEnd:e,onStrokeAdded:t,refCallback:n,contentRefCallback:s,theme:i,activeTool:o,strokesRef:c})=>{const d=we.useRef(null),u=we.useRef(null),h=we.useRef(null),g=we.useRef(!1),p=we.useRef({x:0,y:0}),m=we.useRef(null),y=we.useRef(null),v=we.useRef([]),T=c||v,O=we.useRef([]),[E,S]=we.useState([]),D=we.useRef(null),I=we.useRef(!1),M=we.useRef([]),C=we.useRef(!1),A=we.useRef(null),k=we.useRef(!1),R=we.useRef(null),G=we.useCallback(()=>{const fe=d.current,j=u.current;if(!fe||!j)return;const{width:U,height:N}=j.getBoundingClientRect(),q=window.devicePixelRatio||1,ce=U*q,Z=N*q;if(!R.current){R.current=document.createElement("canvas"),R.current.width=ce,R.current.height=Z;const Ne=R.current.getContext("2d",{willReadFrequently:!0});Ne&&Ne.drawImage(fe,0,0)}const Me=R.current;if(fe.width!==ce||fe.height!==Z){if(Me.width<ce||Me.height<Z){const Ne=document.createElement("canvas");Ne.width=Math.max(Me.width,ce),Ne.height=Math.max(Me.height,Z);const Oe=Ne.getContext("2d",{willReadFrequently:!0});Oe&&Oe.drawImage(Me,0,0),R.current=Ne}fe.width=ce,fe.height=Z,fe.style.width="100%",fe.style.height="100%"}const Pe=fe.getContext("2d",{willReadFrequently:!0});Pe&&(Pe.clearRect(0,0,fe.width,fe.height),Pe.drawImage(R.current,0,0),Pe.resetTransform(),Pe.scale(q,q),Pe.lineCap="round",Pe.lineJoin="round",Pe.lineWidth=3,Pe.strokeStyle=i==="dark"?"#ffffff":"#000000"),n(fe),s(R.current)},[n,s,i]),te=we.useCallback(()=>{const fe=R.current;if(!fe)return;const j=fe.getContext("2d",{willReadFrequently:!0});if(!j)return;j.clearRect(0,0,fe.width,fe.height),RO(j,T.current,i),E.length>0&&jO(j,T.current,E),C.current&&M.current.length>1&&GO(j,M.current),k.current&&A.current&&m.current&&UO(j,A.current,p.current);const U=d.current;U&&VO(fe,U)},[i,E,T]);we.useEffect(()=>{te()},[te]),we.useEffect(()=>{o!=="select-rect"&&o!=="select-lasso"&&S([])},[o]),we.useEffect(()=>{const fe=R.current;if(!fe)return;const j=fe.getContext("2d",{willReadFrequently:!0});if(!j)return;j.save();const U=window.devicePixelRatio||1;j.scale(U,U),j.globalCompositeOperation="source-in",j.fillStyle=i==="dark"?"#ffffff":"#000000",j.fillRect(0,0,fe.width,fe.height),j.restore(),j.strokeStyle=i==="dark"?"#ffffff":"#000000";const N=d.current;if(N){const q=N.getContext("2d",{willReadFrequently:!0});q&&(q.save(),q.resetTransform(),q.clearRect(0,0,N.width,N.height),q.drawImage(fe,0,0),q.restore())}},[i]),we.useEffect(()=>{G();const fe=()=>requestAnimationFrame(G);window.addEventListener("resize",fe);const j=new ResizeObserver(()=>requestAnimationFrame(G));return u.current&&j.observe(u.current),()=>{window.removeEventListener("resize",fe),j.disconnect()}},[G]);const ee=fe=>{const j=d.current;if(!j)return{x:0,y:0};const U=j.getBoundingClientRect();let N,q;if("touches"in fe)if(fe.touches.length>0)N=fe.touches[0].clientX,q=fe.touches[0].clientY;else if(fe.changedTouches&&fe.changedTouches.length>0)N=fe.changedTouches[0].clientX,q=fe.changedTouches[0].clientY;else return{x:0,y:0};else N=fe.clientX,q=fe.clientY;return{x:N-U.left,y:q-U.top}},X=fe=>{if(!(!h.current||!u.current))if(fe){const j=u.current.getBoundingClientRect();h.current.style.display="block",h.current.style.transform=`translate(${fe.x+j.left}px, ${fe.y+j.top}px) translate(-50%, -50%)`}else h.current.style.display="none"},le=fe=>{g.current=!0,y.current&&clearTimeout(y.current);const j=ee(fe.nativeEvent),U=window.devicePixelRatio||1,N={x:j.x*U,y:j.y*U};if(p.current=N,m.current=j,o==="pen")O.current=[N];else if(o==="select-rect"||o==="select-lasso"){if(E.length>0){const ce=fC(T.current,E);if(ce&&DO(N,ce,5*U)){I.current=!0,D.current=N;return}}const q=T.current.findIndex(ce=>A1(N,ce,10*U));q!==-1?E.includes(q)?(I.current=!0,D.current=N):(S([q]),I.current=!0,D.current=N):(S([]),I.current=!1,D.current=null,o==="select-lasso"?(C.current=!0,M.current=[N]):(k.current=!0,A.current=N))}},ae=fe=>{if(!g.current)return;const j=window.devicePixelRatio||1,U={x:fe.x*j,y:fe.y*j},N=R.current,q=N==null?void 0:N.getContext("2d",{willReadFrequently:!0});if(!N||!q)return;if(q.lineCap="round",q.lineJoin="round",o==="pen")q.beginPath(),q.moveTo(p.current.x,p.current.y),q.lineTo(U.x,U.y),q.globalCompositeOperation="source-over",q.lineWidth=3*j,q.strokeStyle=i==="dark"?"#ffffff":"#000000",q.stroke(),O.current.push(U);else if(o==="eraser-radial")q.globalCompositeOperation="destination-out",q.lineWidth=kg*j,q.beginPath(),q.moveTo(p.current.x,p.current.y),q.lineTo(U.x,U.y),q.stroke(),q.globalCompositeOperation="source-over",T.current=zO(T.current,U,kg/2*j);else if(o==="eraser-line"){const Z=T.current.length;T.current=T.current.filter(Me=>!A1(U,Me,10*j)),T.current.length!==Z&&te()}else if((o==="select-rect"||o==="select-lasso")&&I.current&&D.current){const Z=U.x-p.current.x,Me=U.y-p.current.y;E.forEach(Pe=>{const Ne=T.current[Pe];Ne&&(T.current[Pe]={...Ne,points:Ne.points.map(Oe=>({x:Oe.x+Z,y:Oe.y+Me,pressure:Oe.pressure}))})}),te()}else if(o==="select-lasso"&&C.current){M.current.push(U);const Z=[];T.current.forEach((Me,Pe)=>{FO(Me,M.current)&&Z.push(Pe)}),S(Me=>Me.length===Z.length&&Me.every((Pe,Ne)=>Pe===Z[Ne])?Me:Z),te()}else if(o==="select-rect"&&k.current&&A.current){const Z=[],Me=Math.min(A.current.x,U.x),Pe=Math.min(A.current.y,U.y),Ne=Math.abs(U.x-A.current.x),Oe=Math.abs(U.y-A.current.y),he={x:Me,y:Pe,w:Ne,h:Oe};T.current.forEach((H,Te)=>{BO(H,he)&&Z.push(Te)}),S(H=>H.length===Z.length&&H.every((Te,ze)=>Te===Z[ze])?H:Z),te()}p.current=U;const ce=d.current;if(ce){const Z=ce.getContext("2d",{willReadFrequently:!0});Z&&(Z.save(),Z.resetTransform(),Z.clearRect(0,0,ce.width,ce.height),Z.drawImage(N,0,0),Z.restore())}},Q=()=>{g.current&&(g.current=!1,I.current=!1,D.current=null,C.current&&(C.current=!1,M.current=[],te()),k.current&&(k.current=!1,A.current=null,te()),o==="pen"&&O.current.length>1&&T.current.push({points:[...O.current],tool:"pen",color:i==="dark"?"#ffffff":"#000000",width:3}),O.current=[],t&&t(),y.current&&clearTimeout(y.current),y.current=setTimeout(()=>{e()},600))},ne=fe=>{const j=ee(fe.nativeEvent);m.current=j,X(j),g.current&&ae(j)},de=()=>{m.current=null,X(null),Q()},ve=o==="eraser-radial"||o==="eraser-line";return z.jsxs("div",{ref:u,className:"w-full h-full touch-none overflow-hidden transition-all duration-500 relative",style:{cursor:"none",backgroundImage:`radial-gradient(${i==="dark"?"rgba(255, 255, 255, 0.1)":"rgba(0, 0, 0, 0.06)"} 1px, transparent 1px)`,backgroundSize:"24px 24px",backgroundPosition:"0 0"},children:[z.jsx("canvas",{ref:d,className:"block touch-none select-none",onMouseDown:le,onMouseMove:ne,onMouseUp:Q,onMouseLeave:de,onTouchStart:le,onTouchMove:fe=>{const j=ee(fe.nativeEvent);m.current=j,X(j),g.current&&ae(j)},onTouchEnd:Q,onDragStart:fe=>fe.preventDefault(),onContextMenu:fe=>fe.preventDefault()}),z.jsx("div",{ref:h,className:"pointer-events-none fixed z-50 rounded-full",style:{display:"none",left:0,top:0,width:ve&&o==="eraser-radial"?kg:ve?20:6,height:ve&&o==="eraser-radial"?kg:ve?20:6,borderWidth:ve?"2px":"0px",borderColor:i==="dark"?"rgba(255,255,255,0.5)":"rgba(0,0,0,0.5)",borderStyle:o==="eraser-line"?"dashed":"solid",backgroundColor:ve?"transparent":i==="dark"?"#fff":"#000",transform:"translate(-9999px, -9999px)"}})]})},HO=()=>z.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:z.jsx("path",{d:"M17 3a2.828 2.828 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5L17 3z"})}),QO=()=>z.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[z.jsx("path",{d:"m7 21-4.3-4.3c-1-1-1-2.5 0-3.4l9.6-9.6c1-1 2.5-1 3.4 0l5.6 5.6c1 1 1 2.5 0 3.4L13 21"}),z.jsx("path",{d:"M22 21H7"}),z.jsx("path",{d:"m5 11 9 9"})]}),qO=()=>z.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:z.jsx("circle",{cx:"12",cy:"12",r:"10"})}),KO=()=>z.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:z.jsx("line",{x1:"5",y1:"19",x2:"19",y2:"5"})}),XO=()=>z.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[z.jsx("path",{d:"M3 7v6h6"}),z.jsx("path",{d:"M21 17a9 9 0 0 0-9-9 9 9 0 0 0-6 2.3L3 13"})]}),YO=()=>z.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[z.jsx("path",{d:"M21 7v6h-6"}),z.jsx("path",{d:"M3 17a9 9 0 0 1 9-9 9 9 0 0 1 6 2.3L21 13"})]}),JO=()=>z.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[z.jsx("path",{d:"M3 3l7.07 16.97 2.51-7.39 7.39-2.51L3 3z"}),z.jsx("path",{d:"M13 13l6 6"})]}),ZO=()=>z.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:z.jsx("rect",{x:"3",y:"3",width:"18",height:"18",rx:"2",strokeDasharray:"3 3"})}),e$=()=>z.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:z.jsx("path",{d:"M 12 3 A 9 9 0 1 1 3 12 Q 10 10 12 3",strokeDasharray:"3 3"})}),t$=({activeTool:e,onToolChange:t,onUndo:n,onRedo:s,canUndo:i,canRedo:o})=>{const[c,d]=we.useState(!1),[u,h]=we.useState(!1),g=e==="eraser-radial"||e==="eraser-line",p=e==="select-rect"||e==="select-lasso",m=()=>{g?(d(!c),h(!1)):(t("eraser-line"),d(!0),h(!1))},y=()=>{p?(h(!u),d(!1)):(t("select-rect"),h(!0),d(!1))},v=O=>{t(O),d(!1)},T=O=>{t(O),h(!1)};return z.jsxs("div",{className:"absolute bottom-24 right-6 flex flex-col items-center gap-2 z-20",children:[z.jsxs("div",{className:"flex flex-col items-center gap-1 p-1.5 bg-white/80 dark:bg-[#1a1a1a] backdrop-blur-sm border border-black/5 dark:border-white/10 rounded-full shadow-lg",children:[z.jsx("button",{onClick:n,disabled:!i,className:`p-3 md:p-2 rounded-full transition-all flex items-center justify-center min-w-[44px] min-h-[44px] md:min-w-0 md:min-h-0 ${i?"text-slate-500 dark:text-white/40 hover:bg-black/5 dark:hover:bg-white/5 hover:text-slate-900 dark:hover:text-white":"text-slate-300 dark:text-white/10 cursor-not-allowed"}`,title:"Undo",children:z.jsx(XO,{})}),z.jsx("button",{onClick:s,disabled:!o,className:`p-3 md:p-2 rounded-full transition-all flex items-center justify-center min-w-[44px] min-h-[44px] md:min-w-0 md:min-h-0 ${o?"text-slate-500 dark:text-white/40 hover:bg-black/5 dark:hover:bg-white/5 hover:text-slate-900 dark:hover:text-white":"text-slate-300 dark:text-white/10 cursor-not-allowed"}`,title:"Redo",children:z.jsx(YO,{})})]}),z.jsxs("div",{className:"relative flex flex-col items-center gap-1 p-1.5 bg-white/80 dark:bg-[#1a1a1a] backdrop-blur-sm border border-black/5 dark:border-white/10 rounded-full shadow-lg",children:[z.jsxs("div",{className:"relative",children:[z.jsx("button",{onClick:y,className:`p-3 md:p-2 rounded-full transition-all flex items-center justify-center min-w-[44px] min-h-[44px] md:min-w-0 md:min-h-0 ${p?"bg-black text-white dark:bg-white dark:text-black shadow-sm":"text-slate-500 dark:text-white/40 hover:bg-black/5 dark:hover:bg-white/5"}`,title:"Select",children:z.jsx(JO,{})}),u&&z.jsxs("div",{className:"absolute right-full mr-2 top-1/2 -translate-y-1/2 flex items-center gap-1 p-1 bg-white/90 dark:bg-[#1a1a1a] backdrop-blur-sm border border-black/5 dark:border-white/10 rounded-full shadow-lg animate-in slide-in-from-right-2 duration-150",children:[z.jsx("button",{onClick:()=>T("select-rect"),className:`p-2 rounded-full transition-all ${e==="select-rect"?"bg-black text-white dark:bg-white dark:text-black shadow-sm":"text-slate-500 dark:text-white/40 hover:bg-black/5 dark:hover:bg-white/5"}`,title:"Rectangle Selection",children:z.jsx(ZO,{})}),z.jsx("button",{onClick:()=>T("select-lasso"),className:`p-2 rounded-full transition-all ${e==="select-lasso"?"bg-black text-white dark:bg-white dark:text-black shadow-sm":"text-slate-500 dark:text-white/40 hover:bg-black/5 dark:hover:bg-white/5"}`,title:"Lasso Selection",children:z.jsx(e$,{})})]})]}),z.jsx("button",{onClick:()=>{t("pen"),d(!1),h(!1)},className:`p-3 md:p-2 rounded-full transition-all flex items-center justify-center min-w-[44px] min-h-[44px] md:min-w-0 md:min-h-0 ${e==="pen"?"bg-black text-white dark:bg-white dark:text-black shadow-sm":"text-slate-500 dark:text-white/40 hover:bg-black/5 dark:hover:bg-white/5"}`,title:"Pen",children:z.jsx(HO,{})}),z.jsxs("div",{className:"relative",children:[z.jsx("button",{onClick:m,className:`p-3 md:p-2 rounded-full transition-all flex items-center justify-center min-w-[44px] min-h-[44px] md:min-w-0 md:min-h-0 ${g?"bg-black text-white dark:bg-white dark:text-black shadow-sm":"text-slate-500 dark:text-white/40 hover:bg-black/5 dark:hover:bg-white/5"}`,title:"Eraser",children:z.jsx(QO,{})}),c&&z.jsxs("div",{className:"absolute right-full mr-2 top-1/2 -translate-y-1/2 flex items-center gap-1 p-1 bg-white/90 dark:bg-[#1a1a1a] backdrop-blur-sm border border-black/5 dark:border-white/10 rounded-full shadow-lg animate-in slide-in-from-right-2 duration-150",children:[z.jsx("button",{onClick:()=>v("eraser-radial"),className:`p-2 rounded-full transition-all ${e==="eraser-radial"?"bg-black text-white dark:bg-white dark:text-black shadow-sm":"text-slate-500 dark:text-white/40 hover:bg-black/5 dark:hover:bg-white/5"}`,title:"Radial Eraser",children:z.jsx(qO,{})}),z.jsx("button",{onClick:()=>v("eraser-line"),className:`p-2 rounded-full transition-all ${e==="eraser-line"?"bg-black text-white dark:bg-white dark:text-black shadow-sm":"text-slate-500 dark:text-white/40 hover:bg-black/5 dark:hover:bg-white/5"}`,title:"Stroke Eraser",children:z.jsx(KO,{})})]})]})]})]})},n$=50,r$=()=>{const e=we.useRef([]),t=we.useRef(-1),[n,s]=we.useState(!1),[i,o]=we.useState(!1),c=we.useCallback(()=>{s(t.current>0),o(t.current<e.current.length-1)},[]),d=we.useCallback((p,m)=>{const y=p.getContext("2d",{willReadFrequently:!0});if(!y)return;const v=y.getImageData(0,0,p.width,p.height);e.current=e.current.slice(0,t.current+1),e.current.push({image:v,strokes:[...m]}),e.current.length>n$?e.current.shift():t.current++,c()},[c]),u=we.useCallback(p=>{if(t.current<=0)return null;t.current--;const m=e.current[t.current],y=p.getContext("2d",{willReadFrequently:!0});return!y||!m?null:(y.putImageData(m.image,0,0),c(),m.strokes)},[c]),h=we.useCallback(p=>{if(t.current>=e.current.length-1)return null;t.current++;const m=e.current[t.current],y=p.getContext("2d",{willReadFrequently:!0});return!y||!m?null:(y.putImageData(m.image,0,0),c(),m.strokes)},[c]),g=we.useCallback(()=>{e.current=[],t.current=-1,c()},[c]);return{saveSnapshot:d,undo:u,redo:h,clear:g,canUndo:n,canRedo:i}},a$=({theme:e,onStrokeEnd:t,onClear:n,initialStrokes:s})=>{const i=we.useRef(null),o=we.useRef(null),c=we.useRef([]),[d,u]=we.useState("pen"),{saveSnapshot:h,undo:g,redo:p,canUndo:m,canRedo:y}=r$(),v=we.useCallback(M=>{i.current=M},[]),T=we.useCallback(M=>{o.current=M},[]);ma.useEffect(()=>{const M=o.current,C=i.current;if(!M||!C)return;const A=M.getContext("2d",{willReadFrequently:!0}),k=C.getContext("2d",{willReadFrequently:!0});if(!A||!k)return;const R=M.width,G=M.height;if(A.clearRect(0,0,R,G),k.clearRect(0,0,R,G),!s||s.length===0){c.current=[];return}A.lineCap="round",A.lineJoin="round",s.forEach(te=>{if(A.beginPath(),A.strokeStyle=te.color,A.lineWidth=te.width,te.points.length>0){A.moveTo(te.points[0].x,te.points[0].y);for(let ee=1;ee<te.points.length;ee++)A.lineTo(te.points[ee].x,te.points[ee].y)}A.stroke()}),k.save(),k.resetTransform(),k.drawImage(M,0,0),k.restore(),c.current=[...s],h(M,c.current)},[s]);const O=we.useCallback(()=>{if(o.current){const M=c.current.map(C=>({...C,points:C.points.map(A=>({...A}))}));t(o.current,M)}},[t]),E=we.useCallback(()=>{o.current&&h(o.current,c.current)},[h]),S=()=>{const M=i.current,C=o.current;if(M){const A=M.getContext("2d",{willReadFrequently:!0});A&&A.clearRect(0,0,M.width,M.height)}if(C){const A=C.getContext("2d",{willReadFrequently:!0});A&&A.clearRect(0,0,C.width,C.height),c.current=[],h(C,[]),n()}},D=we.useCallback(()=>{const M=i.current,C=o.current;if(C&&M){const A=g(C);A&&(c.current=[...A]);const k=M.getContext("2d",{willReadFrequently:!0});k&&(k.save(),k.resetTransform(),k.clearRect(0,0,M.width,M.height),k.drawImage(C,0,0),k.restore())}},[g]),I=we.useCallback(()=>{const M=i.current,C=o.current;if(C&&M){const A=p(C);A&&(c.current=[...A]);const k=M.getContext("2d",{willReadFrequently:!0});k&&(k.save(),k.resetTransform(),k.clearRect(0,0,M.width,M.height),k.drawImage(C,0,0),k.restore())}},[p]);return z.jsxs("div",{className:"flex-1 relative bg-transparent group cursor-crosshair overflow-hidden transition-colors duration-500",children:[z.jsx(t$,{activeTool:d,onToolChange:u,onUndo:D,onRedo:I,canUndo:m,canRedo:y}),z.jsx(WO,{theme:e,activeTool:d,strokesRef:c,onStrokeEnd:O,onStrokeAdded:E,refCallback:v,contentRefCallback:T}),z.jsx("button",{onClick:S,className:"absolute bottom-6 right-6 p-4 rounded-full bg-white/80 dark:bg-[#1a1a1a] border border-black/5 dark:border-white/10 text-slate-400 dark:text-white/40 hover:text-red-500 dark:hover:text-red-400 hover:scale-105 transition-all shadow-lg hover:shadow-xl z-20",title:"Clear Canvas",children:z.jsxs("svg",{className:"w-5 h-5",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[z.jsx("polyline",{points:"3 6 5 6 21 6"}),z.jsx("path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"}),z.jsx("line",{x1:"10",y1:"11",x2:"10",y2:"17"}),z.jsx("line",{x1:"14",y1:"11",x2:"14",y2:"17"})]})})]})},hC=({latex:e,isInferencing:t=!1,className:n})=>{Pv({latex:e,isInferencing:t},"latex-output");const s=ma.useRef(null),i=ma.useRef(null),[o,c]=ma.useState(1);ma.useEffect(()=>{const h=()=>{if(s.current&&i.current&&e){const p=s.current.clientWidth,m=s.current.clientHeight,y=i.current.scrollWidth,v=i.current.scrollHeight,T=0,O=p-T,E=m-T;let S=1;if(y>O||v>E){const D=O/y,I=E/v;S=Math.min(D,I)}S=Math.max(.4,S),c(S)}else c(1)};h();const g=new ResizeObserver(h);return s.current&&g.observe(s.current),i.current&&g.observe(i.current),()=>g.disconnect()},[e,t]);const d=()=>{e&&navigator.clipboard.writeText(e)},u=h=>h?h.replace(/\\\[/g,"").replace(/\\\]/g,"").replace(/\\\(/g,"").replace(/\\\)/g,"").replace(/\$\$/g,"").replace(/^\$|\$$/g,"").trim():"";return z.jsxs("div",{ref:s,className:`relative flex flex-col items-center justify-center z-10 overflow-hidden ${n||"h-[30%] md:h-[35%]"}`,children:[z.jsx("div",{className:"w-full h-full flex items-center justify-center relative",children:z.jsx("div",{ref:i,id:"latex-output",className:"text-center text-2xl md:text-5xl text-slate-800 dark:text-white px-4 md:px-8 py-4 leading-relaxed transition-transform duration-200 origin-center flex items-center justify-center whitespace-nowrap",style:{transform:`scale(${o})`},children:t?z.jsxs("div",{className:"flex items-center justify-center gap-3 text-cyan-500 dark:text-cyan-400",children:[z.jsxs("div",{className:"relative w-6 h-6",children:[z.jsx("div",{className:"absolute inset-0 border-2 border-cyan-500/30 dark:border-cyan-400/30 rounded-full"}),z.jsx("div",{className:"absolute inset-0 border-2 border-cyan-500 dark:border-cyan-400 border-t-transparent rounded-full animate-spin"})]}),z.jsx("span",{className:"font-medium text-lg animate-pulse",children:"Generating LaTeX..."})]}):e?`\\[${u(e)}\\]`:z.jsx("span",{className:"text-slate-200 dark:text-white/5 font-medium text-3xl tracking-tight select-none",children:"Equation preview..."})})}),z.jsx("div",{className:"absolute top-4 right-4 flex gap-2",children:z.jsx("button",{onClick:d,disabled:!e,className:"p-2 text-slate-400 dark:text-white/30 hover:text-slate-800 dark:hover:text-white hover:bg-black/5 dark:hover:bg-white/10 rounded-lg transition-colors disabled:opacity-0",title:"Copy LaTeX",children:z.jsx("svg",{className:"w-6 h-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:z.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M8 5H6a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2v-1M8 5a2 2 0 002 2h2a2 2 0 002-2M8 5a2 2 0 012-2h2a2 2 0 012 2m0 0h2a2 2 0 012 2v3m2 4H10m0 0l3-3m-3 3l3 3"})})})})]})},s$=({latex:e})=>{const t=we.useRef(null),n=we.useRef(null),[s,i]=ma.useState(1),o=e.replace(/\\\[/g,"").replace(/\\\]/g,"").replace(/\\\(/g,"").replace(/\\\)/g,"").replace(/\$\$/g,"").replace(/^\$|\$$/g,"").trim(),c=ma.useCallback(()=>{if(t.current&&n.current){const d=t.current.offsetWidth,u=t.current.offsetHeight,h=n.current.offsetWidth,g=n.current.offsetHeight,p=0,m=4,y=h-p,v=g-m,T=y/d,O=v/u,E=Math.min(Math.min(T,O),1.5);i(E)}},[]);return we.useEffect(()=>{let d=!0,u=null,h=null;const g=()=>{!d||!t.current||(window.MathJax&&window.MathJax.typesetPromise?(t.current.innerHTML=`\\(${o}\\)`,window.MathJax.typesetPromise([t.current]).then(()=>{d&&(h=setTimeout(c,10))}).catch(p=>{console.error("MathJax error:",p),t.current&&d&&(t.current.textContent=o)})):u=setTimeout(g,100))};return g(),()=>{d=!1,u&&clearTimeout(u),h&&clearTimeout(h)}},[o,c]),we.useEffect(()=>(window.addEventListener("resize",c),()=>window.removeEventListener("resize",c)),[c]),z.jsx("div",{ref:n,className:"w-full h-full flex items-center justify-center overflow-hidden",children:z.jsx("span",{ref:t,className:"relative z-10 whitespace-nowrap transition-transform origin-center text-xl",style:{transform:`scale(${s})`},children:o})})},i$=ma.memo(s$,(e,t)=>e.latex===t.latex),pC=()=>{const{candidates:e,selectedIndex:t,selectCandidate:n,sessionId:s,activeTab:i}=ti(),{addToHistory:o}=i_(),c=we.useCallback(d=>{if(d!==t&&e[d]){const u=e[d],h=Date.now();o({id:h.toString(),latex:u.latex,timestamp:h,source:i,sessionId:s})}n(d)},[t,e,o,i,s,n]);return z.jsxs("div",{className:"flex-none h-20 flex items-center relative z-20 transition-colors duration-500",children:[z.jsx("div",{className:"w-full h-full overflow-x-auto flex items-center px-4 gap-4 no-scrollbar",children:e.map((d,u)=>z.jsx("button",{onClick:()=>c(u),className:`
                relative group flex-none h-12 px-4 rounded-xl text-lg transition-all duration-300 flex items-center justify-center overflow-hidden max-w-[240px] min-w-[64px]
                ${t===u?"text-cyan-600 dark:text-cyan-400 scale-105":"text-slate-400 dark:text-white/30 hover:text-slate-600 dark:hover:text-white/60 hover:bg-black/5 dark:hover:bg-white/5"}
              `,children:z.jsx(i$,{latex:d.latex})},`${u}-${d.latex}`))}),z.jsx("style",{children:`
        .no-scrollbar::-webkit-scrollbar {
          display: none;
        }
        .no-scrollbar {
          -ms-overflow-style: none;
          scrollbar-width: none;
        }
      `})]})},o$=({onInference:e,renderLoadingOverlay:t})=>{const{status:n,latex:s,clearModel:i,userConfirmed:o,activeInferenceTab:c,loadedStrokes:d,refreshSession:u,customNotification:h}=ti(),{theme:g}=gm(),p=c==="draw",m=()=>{i(),u()};return z.jsxs(z.Fragment,{children:[z.jsxs("div",{className:"flex-none h-1/4 md:h-2/5 flex flex-col w-full relative z-10 shrink-0",children:[z.jsx(hC,{latex:s,isInferencing:p,className:"flex-1 w-full"}),z.jsx(pC,{})]}),z.jsx("div",{className:"flex-1 relative overflow-hidden flex flex-col",children:z.jsxs("div",{className:"flex-1 flex flex-col absolute inset-0 z-10",children:[z.jsx(a$,{theme:g,onStrokeEnd:e,initialStrokes:d,onClear:m}),(n==="loading"&&o||!!h)&&t()]})})]})},l$=({onImageSelect:e,onConvert:t,isInferencing:n,previewUrl:s})=>{const[i,o]=we.useState(!1),c=we.useRef(null),d=p=>{p.preventDefault(),o(!0)},u=p=>{p.preventDefault(),o(!1)},h=p=>{p.preventDefault(),o(!1);const m=p.dataTransfer.files[0];m&&m.type.startsWith("image/")&&e(m)},g=p=>{var y;const m=(y=p.target.files)==null?void 0:y[0];m&&e(m)};return ma.useEffect(()=>{const p=m=>{if(m.clipboardData&&m.clipboardData.files.length>0){const y=m.clipboardData.files[0];y.type.startsWith("image/")&&(m.preventDefault(),e(y))}};return window.addEventListener("paste",p),()=>window.removeEventListener("paste",p)},[e]),z.jsx("div",{className:"flex-1 flex flex-col items-center justify-center p-2 bg-transparent w-full h-full",children:s?z.jsxs("div",{className:`w-full max-w-xl flex flex-col items-center gap-6 animate-in fade-in zoom-in duration-300 transition-all ${i?"scale-[0.98] opacity-80":""}`,onDragOver:d,onDragLeave:u,onDrop:h,children:[z.jsxs("div",{className:`relative w-full aspect-square md:aspect-video rounded-3xl overflow-hidden shadow-2xl border transition-colors ${i?"border-cyan-500 bg-cyan-500/10":"border-black/10 dark:border-white/10 bg-white dark:bg-black/50"}`,children:[!i&&z.jsx("img",{src:s,alt:"Preview",className:"w-full h-full object-contain"}),i&&z.jsxs("div",{className:"absolute inset-0 flex flex-col items-center justify-center text-cyan-500",children:[z.jsx("svg",{className:"w-16 h-16 mb-4 animate-bounce",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:z.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"})}),z.jsx("span",{className:"text-xl font-bold",children:"Drop new image here"})]}),z.jsx("button",{onClick:()=>{var p;return(p=c.current)==null?void 0:p.click()},className:"absolute top-4 right-4 p-2.5 rounded-xl bg-white/10 dark:bg-white/5 hover:bg-white/20 dark:hover:bg-white/10 border border-black/10 dark:border-white/10 text-slate-700 dark:text-white/80 transition-all backdrop-blur-md z-10 hover:border-cyan-500/50 dark:hover:border-cyan-400/50 hover:text-cyan-600 dark:hover:text-cyan-400",title:"Change Image",children:z.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:z.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})})})]}),z.jsxs("div",{className:"flex gap-4 w-full",children:[z.jsx("button",{onClick:t,disabled:n,className:`
                                flex-1 py-4 rounded-xl font-bold text-lg transition-all active:scale-[0.98] backdrop-blur-md border
                                ${n?"bg-black/5 dark:bg-white/5 border-black/10 dark:border-white/10 text-slate-400 dark:text-white/40 cursor-not-allowed":"bg-cyan-500/10 dark:bg-cyan-500/10 border-cyan-500/50 dark:border-cyan-400/50 text-cyan-600 dark:text-cyan-400 hover:bg-cyan-500/20 dark:hover:bg-cyan-500/20 hover:border-cyan-500 dark:hover:border-cyan-400 hover:shadow-lg hover:shadow-cyan-500/20"}
                            `,children:n?z.jsxs("span",{className:"flex items-center justify-center gap-3",children:[z.jsxs("svg",{className:"animate-spin h-5 w-5",viewBox:"0 0 24 24",children:[z.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4",fill:"none"}),z.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Processing..."]}):"Convert to LaTeX"}),z.jsx("input",{type:"file",ref:c,className:"hidden",accept:"image/*",onChange:g})]})]}):z.jsxs("div",{className:`
                        w-full h-full max-w-4xl border-4 border-dashed rounded-xl flex flex-col items-center justify-center cursor-pointer transition-all duration-300
                        ${i?"border-cyan-500 bg-cyan-50/10 dark:bg-cyan-900/10 scale-[0.99]":"border-black/10 dark:border-white/10 hover:border-cyan-400 dark:hover:border-cyan-600 hover:bg-black/5 dark:hover:bg-white/5"}
                    `,onDragOver:d,onDragLeave:u,onDrop:h,onClick:()=>{var p;return(p=c.current)==null?void 0:p.click()},children:[z.jsx("input",{type:"file",ref:c,className:"hidden",accept:"image/*",onChange:g}),z.jsx("div",{className:"w-20 h-20 mb-6 rounded-2xl bg-black/5 dark:bg-white/5 flex items-center justify-center",children:z.jsx("svg",{className:"w-10 h-10 text-slate-400 dark:text-white/40",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:z.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})})}),z.jsx("h3",{className:"text-xl font-bold text-slate-700 dark:text-white mb-2",children:"Upload Image"}),z.jsx("p",{className:"text-slate-500 dark:text-white/50 text-center max-w-xs",children:i?"Drop it here!":"Drag & drop an image here, or click to browse"}),z.jsx("p",{className:"mt-4 text-xs text-slate-400 dark:text-white/30 font-mono",children:"Supports PNG, JPG, JPEG"})]})})},c$=({onImageSelect:e,onConvert:t,onUploadAnother:n,renderLoadingOverlay:s})=>{const{status:i,latex:o,userConfirmed:c,activeInferenceTab:d,uploadPreview:u,showUploadResult:h,customNotification:g}=ti(),p=d==="upload";return z.jsx("div",{className:"flex-1 relative overflow-hidden flex flex-col",children:z.jsxs("div",{className:"absolute inset-0 z-10 bg-transparent p-4 flex flex-col overflow-hidden",children:[z.jsx("div",{className:`flex-1 bg-white/50 dark:bg-black/20 rounded-2xl overflow-hidden backdrop-blur-sm w-full h-full flex flex-col ${h?"relative":"items-center justify-center"}`,children:h?z.jsxs("div",{className:"flex-1 flex w-full h-full animate-in fade-in duration-500 flex-col divide-y divide-black/5 dark:divide-white/5",children:[z.jsxs("div",{className:"h-1/2 flex flex-col relative bg-white/40 dark:bg-transparent min-h-0",children:[z.jsx(hC,{latex:o,isInferencing:p,className:"flex-1 w-full"}),z.jsx(pC,{})]}),z.jsxs("div",{onClick:n,className:"flex-1 relative bg-black/5 dark:bg-white/5 min-h-0 cursor-pointer group hover:bg-black/10 dark:hover:bg-white/10 transition-colors",children:[z.jsxs("div",{className:"absolute inset-x-0 top-0 bottom-24 flex items-center justify-center p-4",children:[u&&z.jsx("img",{src:u,alt:"Original",className:"max-w-full max-h-full object-contain shadow-lg rounded-lg transition-transform duration-300 group-hover:scale-[1.02]"}),z.jsx("div",{className:"absolute top-4 left-4 inline-flex items-center px-2 py-1 bg-black/20 backdrop-blur-sm rounded text-xs text-white/50",children:"Original Image"})]}),z.jsxs("button",{onClick:m=>{m.stopPropagation(),n()},className:"absolute bottom-6 left-1/2 -translate-x-1/2 px-6 py-2 md:px-8 md:py-3 text-sm md:text-base bg-cyan-500/10 dark:bg-cyan-500/10 hover:bg-cyan-500/20 dark:hover:bg-cyan-500/20 text-cyan-600 dark:text-cyan-400 font-bold rounded-full border border-cyan-500/50 dark:border-cyan-400/50 hover:border-cyan-500 dark:hover:border-cyan-400 hover:shadow-lg hover:shadow-cyan-500/20 active:scale-95 transition-all flex items-center gap-2 backdrop-blur-md z-10",children:[z.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:z.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"})}),"Upload Another Image"]})]})]}):z.jsx(l$,{onImageSelect:e,onConvert:t,isInferencing:p,previewUrl:u})}),(i==="loading"&&c||!!g)&&s()]})})},u$=()=>{const{activeTab:e,setActiveTab:t}=ti();return z.jsxs("div",{className:"md:hidden flex-none h-16 bg-white/80 dark:bg-[#111]/80 backdrop-blur-md border-t border-black/5 dark:border-white/5 flex items-center justify-around px-2 z-30 pb-safe",children:[z.jsxs("button",{onClick:()=>t("draw"),className:`flex-1 flex flex-col items-center justify-center gap-1 py-1 px-2 rounded-xl transition-colors ${e==="draw"?"text-cyan-600 dark:text-cyan-400 bg-cyan-50 dark:bg-cyan-900/10":"text-slate-400 dark:text-white/30 hover:text-slate-600 dark:hover:text-white/60"}`,children:[z.jsx("svg",{className:"w-6 h-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:e==="draw"?2:1.5,children:z.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"})}),z.jsx("span",{className:"text-[10px] font-medium",children:"Draw"})]}),z.jsxs("button",{onClick:()=>t("upload"),className:`flex-1 flex flex-col items-center justify-center gap-1 py-1 px-2 rounded-xl transition-colors ${e==="upload"?"text-cyan-600 dark:text-cyan-400 bg-cyan-50 dark:bg-cyan-900/10":"text-slate-400 dark:text-white/30 hover:text-slate-600 dark:hover:text-white/60"}`,children:[z.jsx("svg",{className:"w-6 h-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:e==="upload"?2:1.5,children:z.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"})}),z.jsx("span",{className:"text-[10px] font-medium",children:"Upload"})]})]})},d$=({isOpen:e,title:t,message:n,confirmText:s="Confirm",cancelText:i="Cancel",onConfirm:o,onCancel:c,isDangerous:d=!1})=>{const[u,h]=we.useState(!1);return we.useEffect(()=>{h(!0)},[]),!e||!u?null:Nv.createPortal(z.jsxs("div",{className:"fixed inset-0 z-[100] flex items-center justify-center p-4",children:[z.jsx("div",{className:"absolute inset-0 bg-black/20 dark:bg-black/50 backdrop-blur-sm animate-in fade-in duration-200",onClick:c}),z.jsxs("div",{className:"relative w-full max-w-sm bg-white/90 dark:bg-[#111]/90 backdrop-blur-xl border border-white/20 dark:border-white/10 shadow-2xl rounded-2xl p-6 transform transition-all animate-in zoom-in-95 duration-200",children:[z.jsx("h3",{className:"text-lg font-semibold text-slate-900 dark:text-white mb-2",children:t}),z.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-300 mb-6 leading-relaxed",children:n}),z.jsxs("div",{className:"flex justify-end gap-3",children:[z.jsx("button",{onClick:c,className:"px-4 py-2 text-sm font-medium text-slate-600 dark:text-slate-400 hover:text-slate-900 dark:hover:text-white transition-colors rounded-lg hover:bg-black/5 dark:hover:bg-white/5",children:i}),z.jsx("button",{onClick:o,className:`px-4 py-2 text-sm font-medium text-white rounded-lg shadow-sm transition-all transform active:scale-95 ${d?"bg-red-500 hover:bg-red-600 shadow-red-500/20":"bg-cyan-500 hover:bg-cyan-600 shadow-cyan-500/20"}`,children:s})]})]})]}),document.body)},f$=()=>{const[e,t]=we.useState(!1),{status:n,infer:s,inferFromUrl:i,progress:o,loadingPhase:c,isGenerationQueued:d,userConfirmed:u,isLoadedFromCache:h,loadFromHistory:g,isSidebarOpen:p,debugImage:m,showPreviewInput:y,activeTab:v,setActiveTab:T,sessionId:O,uploadPreview:E,setUploadPreview:S,setShowUploadResult:D,customNotification:I,dialogConfig:M,closeDialog:C}=ti(),{history:A,addToHistory:k,deleteHistoryItem:R,clearHistory:G}=i_(),te=we.useRef(null),ee=we.useCallback(j=>{var N;const U=(N=j.target.files)==null?void 0:N[0];if(U&&U.type.startsWith("image/")){const q=URL.createObjectURL(U);S(q),D(!1)}j.target.value=""},[S,D]);ma.useEffect(()=>{if(v!=="upload")return;const j=U=>{if(U.clipboardData&&U.clipboardData.files.length>0){const N=U.clipboardData.files[0];if(N.type.startsWith("image/")){U.preventDefault();const q=URL.createObjectURL(N);S(q),D(!1)}}};return window.addEventListener("paste",j),()=>window.removeEventListener("paste",j)},[v,S,D]);const X=async(j,U)=>{if(!u&&!h){t(!1);return}const N=await s(j);N&&k({id:Date.now().toString(),latex:N.latex,timestamp:Date.now(),source:"draw",sessionId:O,strokes:U})},le=j=>{const U=URL.createObjectURL(j);S(U),D(!1)},ae=async j=>{const N=await(await fetch(j)).blob();return new Promise((q,ce)=>{const Z=new FileReader;Z.onloadend=()=>q(Z.result),Z.onerror=ce,Z.readAsDataURL(N)})},Q=async()=>{if(!E)return;if(!u&&!h){t(!1);return}const j=await i(E);if(j){const U=await ae(E);k({id:Date.now().toString(),latex:j.latex,timestamp:Date.now(),source:"upload",sessionId:O,imageData:U}),D(!0)}},ne=j=>{j.source==="upload"&&j.imageData&&(S(j.imageData),D(!0),T("upload")),g(j)},de=()=>{var j;(j=te.current)==null||j.click()},ve=()=>I?z.jsx(E1,{phase:I.message,progress:I.progress??0,isQueued:!1,isLoading:I.isLoading}):z.jsx(E1,{phase:c,progress:o,isQueued:d}),fe=!u&&!h||n==="error";return z.jsxs("div",{className:"relative h-[100dvh] w-full overflow-hidden font-sans bg-[#fafafa] dark:bg-black transition-colors duration-500 flex flex-row",children:[z.jsx(ZC,{}),z.jsx("input",{type:"file",ref:te,className:"hidden",accept:"image/*",onChange:ee}),z.jsx("div",{className:"absolute inset-0 z-0 bg-white/60 dark:bg-[#0c0c0c]/80 backdrop-blur-md transition-colors duration-500 pointer-events-none"}),z.jsx("div",{className:"relative z-10 flex w-full h-full",children:z.jsxs("div",{className:"flex-1 flex min-h-0 relative",children:[z.jsx(TO,{history:A,onSelect:ne,onDelete:R,onClearAll:G,isOpen:p}),z.jsxs("div",{className:"flex-1 flex flex-col min-w-0 relative",children:[z.jsx(pO,{}),v==="draw"?z.jsx(o$,{onInference:X,renderLoadingOverlay:ve}):z.jsx(c$,{onImageSelect:le,onConvert:Q,onUploadAnother:de,renderLoadingOverlay:ve}),z.jsx(u$,{})]})]})}),y&&z.jsx(kO,{debugImage:m}),fe&&z.jsx(AO,{isDismissed:e,onDismiss:()=>t(!0)}),z.jsx(d$,{isOpen:M.isOpen,onCancel:C,onConfirm:M.onConfirm,title:M.title,message:M.message,confirmText:M.confirmText,isDangerous:M.isDangerous})]})},h$=()=>z.jsx(XC,{children:z.jsx(JC,{children:z.jsx(qC,{children:z.jsx(f$,{})})})}),mC=document.getElementById("root");if(!mC)throw new Error("Could not find root element to mount to");const p$=jC.createRoot(mC);p$.render(z.jsx(ma.StrictMode,{children:z.jsx(h$,{})}));export{wy as D,cg as G,Ln as M,vf as _,_$ as a};
